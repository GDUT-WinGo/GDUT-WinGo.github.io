{"meta":{"title":"Wingo's Blog","subtitle":"","description":"","author":"Wingo","url":"http://yoursite.com","root":"/"},"pages":[{"title":"","date":"2020-04-19T06:45:50.304Z","updated":"2020-01-20T15:06:03.000Z","comments":true,"path":"tags/index.html","permalink":"http://yoursite.com/tags/index.html","excerpt":"","text":""},{"title":"","date":"2020-04-19T06:45:50.304Z","updated":"2020-01-20T15:05:42.000Z","comments":true,"path":"categories/index.html","permalink":"http://yoursite.com/categories/index.html","excerpt":"","text":""}],"posts":[{"title":"Hive","slug":"BigData/Hive","date":"2020-04-28T03:27:12.000Z","updated":"2020-04-30T03:48:21.289Z","comments":true,"path":"2020/04/28/BigData/Hive/","link":"","permalink":"http://yoursite.com/2020/04/28/BigData/Hive/","excerpt":"Hive åŸºæœ¬ä»‹ç»åŠç®€å•ä½¿ç”¨ã€‚","text":"Hive åŸºæœ¬ä»‹ç»åŠç®€å•ä½¿ç”¨ã€‚ åŸºæœ¬æ¦‚å¿µHive æ˜¯åŸºäº Hadoop çš„ä¸€ä¸ªæ•°æ®ä»“åº“å·¥å…·ï¼Œå¯ä»¥å°†ç»“æ„åŒ–çš„æ•°æ®æ–‡ä»¶æ˜ å°„ä¸ºä¸€å¼ è¡¨ï¼Œå¹¶æä¾›ç±» SQL æŸ¥è¯¢åŠŸèƒ½ã€‚ æœ¬è´¨ä¸Šæ˜¯å°† HQL è½¬åŒ–ä¸º MapReduce ç¨‹åºã€‚ Hive å¤„ç†çš„æ•°æ®å­˜å‚¨åœ¨ HDFSï¼›Hive åˆ†ææ•°æ®åº•å±‚çš„å®ç°æ˜¯ MapReduceï¼›æ‰§è¡Œç¨‹åºè¿è¡Œåœ¨ Yarn ä¸Š HQL VS SQL Hive RDBMS æŸ¥è¯¢è¯­è¨€ HQL SQL æ•°æ®å­˜å‚¨ HDFS LOCAL FS æ‰§è¡Œ MapReduce Executor æ‰§è¡Œå»¶è¿Ÿ é«˜ ä½ å¤„ç†æ•°æ®è§„æ¨¡ å¤§ å° ç´¢å¼• ä½å›¾ç´¢å¼• å¤æ‚ç´¢å¼• ç”¨æˆ·æ¥å£ Clientï¼šCLIï¼ˆhive shellï¼‰ã€JDBC / ODBCï¼ˆjava è®¿é—® hiveï¼‰ã€WEBUIï¼ˆæµè§ˆå™¨è®¿é—® hiveï¼‰ã€‚ å…ƒæ•°æ® Metastoreï¼šå…ƒæ•°æ®åŒ…æ‹¬è¡¨åã€è¡¨æ‰€å±çš„æ•°æ®ï¼ˆé»˜è®¤æ˜¯ defaultï¼‰ã€è¡¨çš„æ‹¥æœ‰è€…ã€åˆ— / åˆ†åŒºå­—æ®µã€è¡¨çš„ç±»å‹ï¼ˆæ˜¯å¦æ˜¯å¤–éƒ¨è¡¨ï¼‰ã€è¡¨çš„æ•°æ®æ‰€åœ¨ç›®å½•ç­‰ï¼›é»˜è®¤å­˜å‚¨åœ¨è‡ªå¸¦çš„ derby æ•°æ®åº“ä¸­ï¼Œæ¨èä½¿ç”¨ MySQL å­˜å‚¨ Metastoreã€‚ Hadoopä½¿ç”¨ HDFS è¿›è¡Œå­˜å‚¨ï¼Œä½¿ç”¨ MapReduce è¿›è¡Œè®¡ç®—ã€‚ é©±åŠ¨å™¨ Driverè§£æå™¨ SQL Parserï¼šå°† SQL å­—ç¬¦ä¸²è½¬æ¢æˆæŠ½è±¡è¯­æ³•æ ‘ ASTï¼›ç¼–è¯‘å™¨ Physical Planï¼š å°† AST ç¼–è¯‘ç”Ÿæˆé€»è¾‘æ‰§è¡Œè®¡åˆ’ï¼›ä¼˜åŒ–å™¨ Query Optimizerï¼šå¯¹é€»è¾‘æ‰§è¡Œè®¡åˆ’è¿›è¡Œä¼˜åŒ–ï¼›æ‰§è¡Œå™¨ Executionï¼šæŠŠé€»è¾‘æ‰§è¡Œè®¡åˆ’è½¬æ¢æˆå¯ä»¥è¿è¡Œçš„ç‰©ç†è®¡åˆ’ã€‚å¯¹äº Hive æ¥ è¯´ï¼Œå°±æ˜¯ MR / Sparkã€‚ Hive é€šè¿‡ç»™ç”¨æˆ·æä¾›çš„ä¸€ç³»åˆ—äº¤äº’æ¥å£ï¼Œæ¥æ”¶åˆ°ç”¨æˆ·çš„æŒ‡ä»¤ï¼ˆSQLï¼‰ï¼Œä½¿ç”¨è‡ªå·±çš„ Driverï¼Œ ç»“åˆå…ƒæ•°æ®ï¼ˆMetaStoreï¼‰ï¼Œå°†è¿™äº›æŒ‡ä»¤ç¿»è¯‘æˆ MapReduceï¼Œæäº¤åˆ° Hadoop ä¸­æ‰§è¡Œï¼Œæœ€åï¼Œå°†æ‰§è¡Œè¿”å›çš„ç»“æœè¾“å‡ºåˆ°ç”¨æˆ·äº¤äº’æ¥å£ã€‚ å®‰è£…é…ç½®1234567891011121314# hive å®‰è£…tar -zxvf apache-hive-1.2.1-bin.tar.gz -C /opt/module/mv apache-hive-1.2.1-bin/ hivemv hive-env.sh.template hive-env.shvi hive-env.sh # export HADOOP_HOME=/opt/module/hadoop-2.7.2 # export HIVE_CONF_DIR=/opt/module/hive/conf# å¯åŠ¨ hive å‰å¿…é¡»å¯åŠ¨é›†ç¾¤sbin/start-dfs.shsbin/start-yarn.sh# åˆ›å»ºç›®å½•bin/hadoop fs -mkdir -p /user/hive/warehousebin/hadoop fs -chmod g+w /user/hive/warehouse# æˆ–è€…ç›´æ¥åœ¨é…ç½®æ–‡ä»¶ä¸­å…³é—­æƒé™æ£€æŸ¥ 123456&lt;!-- hdfs-site.xml --&gt;&lt;property&gt; &lt;name&gt;dfs.permissions.enable&lt;/name&gt; &lt;value&gt;false&lt;/value&gt;&lt;/property&gt; åŸºæœ¬æ“ä½œ1234567891011bin/hive# è¿›å…¥ hive shellhive&gt; show databases;hive&gt; use default;hive&gt; show tables;hive&gt; create table student(id int, name string);hive&gt; show tables;hive&gt; desc student;hive&gt; insert into student values(1000,\"ss\");hive&gt; select * from student;hive&gt; quit; æ–‡ä»¶å¯¼å…¥1234# å°† /opt/module/datas/student.txt æ–‡ä»¶å¯¼å…¥ hive çš„ student(id int, name string) è¡¨ä¸­hive&gt; create table student(id int, name string) ROW FORMAT DELIMITED FIELDS TERMINATED BY '\\t';hive&gt; load data local inpath '/opt/module/datas/student.txt' into table student; å†æ‰“å¼€ä¸€ä¸ªå®¢æˆ·ç«¯çª—å£å¯åŠ¨ hiveï¼Œä¼šäº§ç”Ÿ java.sql.SQLException å¼‚å¸¸ã€‚åŸå› æ˜¯ï¼ŒMetastore é»˜è®¤å­˜å‚¨åœ¨è‡ªå¸¦çš„ derby æ•°æ®åº“ä¸­ï¼Œæ¨èä½¿ç”¨ MySQL å­˜å‚¨ Metastoreã€‚ MySQL å®‰è£…1234567891011121314151617181920212223242526272829303132# æ£€æŸ¥ç¯å¢ƒrpm -qa|grep mysqlrpm -e --nodepsunzip mysql-libs.zip # MySQL-client-5.6.24-1.el6.x86_64.rpm # mysql-connector-java-5.1.27.tar.gz é©±åŠ¨åŒ… # MySQL-server-5.6.24-1.el6.x86_64.rpm# å®‰è£…æœåŠ¡rpm -ivh MySQL-server-5.6.24-1.el6.x86_64.rpm# è·å–éšæœºå¯†ç cat /root/.mysql_secret# æ£€æŸ¥æœåŠ¡çŠ¶æ€service mysql statusservice mysql start# å®‰è£…å®¢æˆ·ç«¯rpm -ivh MySQL-client-5.6.24-1.el6.x86_64.rpm# åˆ©ç”¨å¥½éšæœºå¯†ç è¿›è¡Œç™»å½•mysql -uroot -pOEXaQuS8IWkG19Xs# ä¿®æ”¹å¯†ç mysql&gt;SET PASSWORD=PASSWORD('000000');# ä¿®æ”¹ user è¡¨ä¸­çš„ä¸»æœºé…ç½®mysql&gt;show databases;mysql&gt;use mysql;mysql&gt;show tables;mysql&gt;desc user;mysql&gt;select User, Host, Password from user;mysql&gt;update user set host='%' where host='localhost';mysql&gt;delete from user where Host='127.0.0.1';mysql&gt;delete from user where Host='::1';# é…ç½®ç”Ÿæ•ˆmysql&gt;flush privileges;mysql&gt;quit; å…ƒæ•°æ®é…ç½®12# æ‹·è´æ‰€éœ€é©±åŠ¨cp mysql-connector-java-5.1.27-bin.jar /opt/module/hive/lib/ 123456789101112131415161718192021222324252627&lt;!-- åœ¨ /opt/module/hive/conf ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª hive-site.xml --&gt;&lt;!-- æ‹·è´å®˜æ–¹æ–‡æ¡£çš„é…ç½®å‚æ•° --&gt;&lt;?xml version=\"1.0\"?&gt;&lt;?xml-stylesheet type=\"text/xsl\" href=\"configuration.xsl\"?&gt;&lt;configuration&gt; &lt;property&gt; &lt;name&gt;javax.jdo.option.ConnectionURL&lt;/name&gt; &lt;value&gt;jdbc:mysql://[ip_address]:3306/metastore?createDatabaseIfNotExist=true&lt;/value&gt; &lt;description&gt;JDBC connect string for a JDBC metastore&lt;/description&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;javax.jdo.option.ConnectionDriverName&lt;/name&gt; &lt;value&gt;com.mysql.jdbc.Driver&lt;/value&gt; &lt;description&gt;Driver class name for a JDBC metastore&lt;/description&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;javax.jdo.option.ConnectionUserName&lt;/name&gt; &lt;value&gt;root&lt;/value&gt; &lt;description&gt;username to use against metastore database&lt;/description&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;javax.jdo.option.ConnectionPassword&lt;/name&gt; &lt;value&gt;000000&lt;/value&gt; &lt;description&gt;password to use against metastore database&lt;/description&gt; &lt;/property&gt;&lt;/configuration&gt; æŸ¥çœ‹ MySQL æ•°æ®åº“ï¼Œæ˜¾ç¤ºå¢åŠ äº† metastore æ•°æ®åº“ã€‚ äº¤äº’å‘½ä»¤1234567891011121314# æŸ¥çœ‹å¸®åŠ©bin/hive -help# ä¸è¿›å…¥ hive çš„äº¤äº’çª—å£æ‰§è¡Œ sql è¯­å¥bin/hive -e \"select id from student;\"# æ‰§è¡Œè„šæœ¬ä¸­ sql è¯­å¥bin/hive -f /opt/module/datas/hivef.sql# æ‰§è¡Œè„šæœ¬ï¼Œå¹¶å†™å‡ºç»“æœbin/hive -f /opt/module/datas/hivef.sql &gt; /opt/module/datas/hive_result.txt# åœ¨ hive cli å‘½ä»¤çª—å£ä¸­æŸ¥çœ‹ hdfs æ–‡ä»¶ç³»ç»Ÿhive(default)&gt;dfs -ls /;# åœ¨ hive cli å‘½ä»¤çª—å£ä¸­æŸ¥çœ‹æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿhive(default)&gt;! ls /opt/module/datas;# æŸ¥çœ‹åœ¨ hive ä¸­è¾“å…¥çš„æ‰€æœ‰å†å²å‘½ä»¤ï¼Œç”¨æˆ·å®¶ç›®å½•ä¸‹cat .hivehistory å±æ€§é…ç½®ä»“åº“è·¯å¾„Default æ•°æ®ä»“åº“çš„æœ€åŸå§‹ä½ç½®æ˜¯åœ¨ hdfs ä¸Šçš„ï¼š/user/hive/warehouse è·¯å¾„ä¸‹ï¼› åœ¨ä»“åº“ç›®å½•ä¸‹ï¼Œæ²¡æœ‰å¯¹é»˜è®¤çš„æ•°æ®åº“ default åˆ›å»ºæ–‡ä»¶å¤¹ã€‚å¦‚æœæŸå¼ è¡¨å±äº default æ•°æ®åº“ï¼Œç›´æ¥åœ¨æ•°æ®ä»“åº“ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ã€‚ æ”¹ default æ•°æ®ä»“åº“åŸå§‹ä½ç½®ï¼ˆå°† hive-default.xml.template å¦‚ä¸‹é…ç½®ä¿¡æ¯æ‹·è´åˆ° hive-site.xml æ–‡ä»¶ä¸­ï¼‰ 12345678910111213141516&lt;property&gt; &lt;name&gt;hive.metastore.warehouse.dir&lt;/name&gt; &lt;value&gt;/user/hive/warehouse&lt;/value&gt; &lt;description&gt;location of default database for the warehouse&lt;/description&gt;&lt;/property&gt;&lt;!-- æ˜¾ç¤ºæ•°æ®è¡¨å¤´ä¿¡æ¯ --&gt;&lt;property&gt; &lt;name&gt;hive.cli.print.header&lt;/name&gt; &lt;value&gt;true&lt;/value&gt;&lt;/property&gt;&lt;!-- æ˜¾ç¤ºå½“å‰æ•°æ®åº“åç§°ä¿¡æ¯ --&gt;&lt;property&gt; &lt;name&gt;hive.cli.print.current.db&lt;/name&gt; &lt;value&gt;true&lt;/value&gt;&lt;/property&gt; 12# é…ç½®åŒç»„ç”¨æˆ·æœ‰æ‰§è¡Œæƒé™bin/hdfs dfs -chmod g+w /user/hive/warehouse æ—¥å¿—ä¿¡æ¯12345678910# æ–¹å¼ä¸€mv hive-log4j.properties.template hive-log4j.propertiesvi hive-log4j.properties # hive.log.dir=/opt/module/hive/logs# æ–¹å¼äºŒï¼Œä»…å¯¹æœ¬æ¬¡ hive å¯åŠ¨æœ‰æ•ˆbin/hive -hiveconf hive.log.dir=/opt/module/hive/logs# æ–¹å¼ä¸‰ï¼Œä»…å¯¹æœ¬æ¬¡ hive å¯åŠ¨æœ‰æ•ˆhive (default)&gt; set hive.log.dir=/opt/module/hive/logs;# æŸ¥çœ‹æ‰€æœ‰å‚æ•°é…ç½®hive (default)&gt; set [æŸä¸€å‚æ•°] æ•°æ®ç±»å‹ç®€å•ç±»å‹ ç±»å‹ æè¿° ç¤ºä¾‹ boolean true / false TRUE tinyint 1 å­—èŠ‚çš„æœ‰ç¬¦å·æ•´æ•° -128~127 1Y smallint 2 ä¸ªå­—èŠ‚çš„æœ‰ç¬¦å·æ•´æ•°ï¼Œ-32768~32767 1S int 4 ä¸ªå­—èŠ‚çš„å¸¦ç¬¦å·æ•´æ•° 1 bigint 8 å­—èŠ‚å¸¦ç¬¦å·æ•´æ•° 1L float 4 å­—èŠ‚å•ç²¾åº¦æµ®ç‚¹æ•° 1.0 double 8 å­—èŠ‚åŒç²¾åº¦æµ®ç‚¹æ•° 1.0 deicimal ä»»æ„ç²¾åº¦çš„å¸¦ç¬¦å·å°æ•° 1.0 String å­—ç¬¦ä¸²ï¼Œå˜é•¿ â€œaâ€,â€™bâ€™ varchar å˜é•¿å­—ç¬¦ä¸² â€œaâ€,â€™bâ€™ char å›ºå®šé•¿åº¦å­—ç¬¦ä¸² â€œaâ€,â€™bâ€™ binary å­—èŠ‚æ•°ç»„ æ— æ³•è¡¨ç¤º timestamp æ—¶é—´æˆ³ï¼Œçº³ç§’ç²¾åº¦ 122327493795 date æ—¥æœŸ â€˜2018-04-07â€™ å¤æ‚ç±»å‹ ç±»å‹ æè¿° ç¤ºä¾‹ array æœ‰åºçš„çš„åŒç±»å‹çš„é›†åˆ array(1,2) map key-valueï¼Œkey å¿…é¡»ä¸ºåŸå§‹ç±»å‹ï¼Œvalue å¯ä»¥ä»»æ„ç±»å‹ map(â€˜aâ€™,1,â€™bâ€™,2) struct å­—æ®µé›†åˆ,ç±»å‹å¯ä»¥ä¸åŒ struct(â€˜1â€™,1,1.0), named_stract(â€˜col1â€™,â€™1â€™,â€™col2â€™,1,â€™clo3â€™,1.0) å®ä¾‹æ“ä½œ123456789101112&#123; \"name\": \"songsong\", \"friends\": [\"bingbing\" , \"lili\"] , // åˆ—è¡¨ Array \"children\": &#123; // é”®å€¼ Map \"xiao song\": 18 , \"xiaoxiao song\": 19 &#125; \"address\": &#123; // ç»“æ„ Struct, \"street\": \"hui long guan\" , \"city\": \"beijing\"&#125;&#125; åŸºäºä¸Šè¿°æ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬åœ¨ Hive é‡Œåˆ›å»ºå¯¹åº”çš„è¡¨ï¼Œå¹¶å¯¼å…¥æ•°æ®ã€‚ 12songsong,bingbing_lili,xiao song:18_xiaoxiao song:19,hui long guan_beijing &#x2F;&#x2F; ç¬¬ä¸€æ¡ JSONyangyang,caicai_susu,xiao yang:18_xiaoxiao yang:19,chao yang_beijing &#x2F;&#x2F; ç¬¬äºŒæ¡ JSON MAPï¼ŒSTRUCT å’Œ ARRAY é‡Œçš„å…ƒç´ é—´å…³ç³»éƒ½å¯ä»¥ç”¨åŒä¸€ä¸ªå­—ç¬¦è¡¨ç¤ºï¼Œè¿™é‡Œç”¨ â€œ_â€ã€‚ 1234567891011create table test( name string, friends array&lt;string&gt;, children map&lt;string, int&gt;, address struct&lt;street:string, city:string&gt;)row format delimitedfields terminated by ','collection items terminated by '_'map keys terminated by ':'lines terminated by '\\n'; 12345678# å¯¼å…¥æ•°æ®hive (default)&gt; load data local inpath â€˜/opt/module/datas/test.txtâ€™ into table test# è®¿é—®ä¸‰ç§é›†åˆåˆ—é‡Œçš„æ•°æ®ï¼Œä»¥ä¸‹åˆ†åˆ«æ˜¯ ARRAYï¼ŒMAPï¼ŒSTRUCT çš„è®¿é—®æ–¹å¼select friends[1],children['xiao song'],address.city from test where name=\"songsong\";OK_c0 _c1 citylili 18 beijingTime taken: 0.076 seconds, Fetched: 1 row(s) ç±»å‹è½¬åŒ–Hive çš„åŸå­æ•°æ®ç±»å‹æ˜¯å¯ä»¥è¿›è¡Œéšå¼è½¬æ¢çš„ï¼Œç±»ä¼¼äº Java çš„ç±»å‹è½¬æ¢ï¼Œä¾‹å¦‚æŸè¡¨è¾¾å¼ ä½¿ç”¨ INT ç±»å‹ï¼ŒTINYINT ä¼šè‡ªåŠ¨è½¬æ¢ä¸º INT ç±»å‹ï¼Œä½†æ˜¯ Hive ä¸ä¼šè¿›è¡Œåå‘è½¬åŒ–ï¼Œä¾‹å¦‚ï¼Œ æŸè¡¨è¾¾å¼ä½¿ç”¨ TINYINT ç±»å‹ï¼ŒINT ä¸ä¼šè‡ªåŠ¨è½¬æ¢ä¸º TINYINT ç±»å‹ï¼Œå®ƒä¼šè¿”å›é”™è¯¯ï¼Œé™¤éä½¿ç”¨ CAST æ“ä½œã€‚ éšå¼ç±»å‹è½¬æ¢è§„åˆ™ï¼š ä»»ä½•æ•´æ•°ç±»å‹éƒ½å¯ä»¥éšå¼åœ°è½¬æ¢ä¸ºä¸€ä¸ªèŒƒå›´æ›´å¹¿çš„ç±»å‹ï¼Œå¦‚ TINYINT å¯ä»¥è½¬æ¢æˆ INTï¼ŒINT å¯ä»¥è½¬æ¢æˆ BIGINTï¼›æ‰€æœ‰æ•´æ•°ç±»å‹ã€FLOAT å’Œ STRING ç±»å‹éƒ½å¯ä»¥éšå¼åœ°è½¬æ¢æˆ DOUBLEï¼›TINYINTã€SMALLINTã€INT éƒ½å¯ä»¥è½¬æ¢ä¸º FLOATï¼›BOOLEAN ç±»å‹ä¸å¯ä»¥è½¬æ¢ä¸ºä»»ä½•å…¶å®ƒçš„ç±»å‹ã€‚ å¯ä»¥ä½¿ç”¨ CAST æ“ä½œæ˜¾ç¤ºè¿›è¡Œæ•°æ®ç±»å‹è½¬æ¢ ä¾‹å¦‚ CAST(â€˜1â€™ AS INT) å°†æŠŠå­—ç¬¦ä¸² â€˜1â€™ è½¬æ¢æˆæ•´æ•° 1ï¼›å¦‚æœå¼ºåˆ¶ç±»å‹è½¬æ¢å¤±è´¥ï¼Œå¦‚æ‰§è¡Œ CAST(â€˜Xâ€™ AS INT)ï¼Œè¡¨è¾¾å¼è¿”å›ç©ºå€¼ NULLã€‚ DDL Data Definition Language æ•°æ®å®šä¹‰ã€‚ åº“æ“ä½œåˆ›å»º åˆ›å»ºä¸€ä¸ªæ•°æ®åº“ï¼Œæ•°æ®åº“åœ¨ HDFS ä¸Šçš„é»˜è®¤å­˜å‚¨è·¯å¾„æ˜¯ /user/hive/warehouse/*.db 123create database if not exists db_hive;# æŒ‡å®šåº“å­˜å‚¨è·¯å¾„create database db_hive location '/db_hive.db'; æ˜¾ç¤º123456# æ˜¾ç¤ºæ•°æ®åº“ä¿¡æ¯desc database db_hive;# æ˜¾ç¤ºæ•°æ®åº“è¯¦ç»†ä¿¡æ¯ extendeddesc database extended db_hive;# åˆ‡æ¢å½“å‰æ•°æ®åº“use db_hive; ä¿®æ”¹ç”¨æˆ·å¯ä»¥ä½¿ç”¨ ALTER DATABASE å‘½ä»¤ä¸ºæŸä¸ªæ•°æ®åº“çš„ DBPROPERTIES è®¾ç½®é”®-å€¼å¯¹å±æ€§å€¼ï¼Œæ¥æè¿°è¿™ä¸ªæ•°æ®åº“çš„å±æ€§ä¿¡æ¯ã€‚ æ•°æ®åº“çš„å…¶ä»–å…ƒæ•°æ®ä¿¡æ¯éƒ½æ˜¯ä¸å¯æ›´æ”¹çš„ï¼ŒåŒ…æ‹¬æ•°æ®åº“åå’Œæ•°æ®åº“æ‰€åœ¨çš„ç›®å½•ä½ç½®ã€‚ä¿®æ”¹å½“å‰æ­£åœ¨ä½¿ç”¨çš„æ•°æ®åº“ï¼Œè¦å…ˆé€€å‡ºä½¿ç”¨. 1alter database db_hive set dbproperties(&#39;createtime&#39;&#x3D;&#39;20170830&#39;); åˆ é™¤1234# é‡‡ç”¨ if exists åˆ¤æ–­æ•°æ®åº“æ˜¯å¦å­˜åœ¨drop database if exists [db_name];# å¦‚æœæ•°æ®åº“ä¸ä¸ºç©ºï¼Œå¯ä»¥é‡‡ç”¨ cascade å‘½ä»¤å¼ºåˆ¶åˆ é™¤drop database [db_name] cascade; è¡¨æ“ä½œè¡¨ç±»å‹123456789101112CREATE [EXTERNAL] TABLE [IF NOT EXISTS] table_name [(col_name data_type [COMMENT col_comment], ...)] [COMMENT table_comment] [PARTITIONED BY (col_name data_type [COMMENT col_comment], ...)] [CLUSTERED BY (col_name, col_name, ...) [SORTED BY (col_name [ASC|DESC], ...)] INTO num_buckets BUCKETS] [ROW FORMAT row_format] [STORED AS file_format] [LOCATION hdfs_path]# é‡å‘½åALTER TABLE table_name RENAME TO new_table_name EXTERNAL å…³é”®å­—å¯ä»¥è®©ç”¨æˆ·åˆ›å»ºä¸€ä¸ªå¤–éƒ¨è¡¨ï¼Œåœ¨å»ºè¡¨çš„åŒæ—¶æŒ‡å®šä¸€ä¸ªæŒ‡å‘å®é™…æ•°æ®çš„è·¯å¾„ï¼ˆLOCATIONï¼‰ã€‚ Hive åˆ›å»ºå†…éƒ¨è¡¨æ—¶ï¼Œä¼šå°†æ•°æ®ç§»åŠ¨åˆ°æ•°æ®ä»“åº“æŒ‡å‘çš„è·¯å¾„ï¼›è‹¥åˆ›å»ºå¤–éƒ¨è¡¨ï¼Œä»…è®°å½•æ•°æ®æ‰€åœ¨çš„è·¯å¾„ï¼Œä¸å¯¹æ•°æ®çš„ä½ç½®åšä»»ä½•æ”¹å˜ã€‚åœ¨åˆ é™¤è¡¨çš„æ—¶å€™ï¼Œå†…éƒ¨è¡¨çš„å…ƒæ•°æ®å’Œæ•°æ®ä¼šè¢«ä¸€èµ·åˆ é™¤ï¼Œè€Œå¤–éƒ¨è¡¨åªåˆ é™¤å…ƒæ•°æ®ï¼Œä¸åˆ é™¤æ•°æ®ã€‚ PARTITIONED è¡¨ç¤ºæ ¹æ®æŸä¸€ä¸ª key ï¼ˆä¸åœ¨ create table é‡Œé¢ï¼‰å¯¹æ•°æ®è¿›è¡Œåˆ†åŒºï¼Œä½“ç°åœ¨ HDFS ä¸Šå°±æ˜¯ table ç›®å½•ä¸‹æœ‰ n ä¸ªä¸åŒçš„åˆ†åŒºæ–‡ä»¶å¤¹ï¼ˆcountry=China,country=USAï¼‰ã€‚ CLUSTERED å¯¹äºæ¯ä¸€ä¸ªè¡¨ï¼ˆtableï¼‰æˆ–è€…åˆ†åŒºï¼Œ Hive å¯ä»¥è¿›ä¸€æ­¥ç»„ç»‡æˆæ¡¶ï¼Œä¹Ÿå°±æ˜¯è¯´æ¡¶æ˜¯æ›´ä¸ºç»†ç²’åº¦çš„æ•°æ®èŒƒå›´åˆ’åˆ†ã€‚Hive ä¹Ÿæ˜¯é’ˆå¯¹æŸä¸€åˆ—è¿›è¡Œæ¡¶çš„ç»„ç»‡ã€‚Hive é‡‡ç”¨å¯¹åˆ—å€¼å“ˆå¸Œï¼Œç„¶åé™¤ä»¥æ¡¶çš„ä¸ªæ•°æ±‚ä½™çš„æ–¹å¼å†³å®šè¯¥æ¡è®°å½•å­˜æ”¾åœ¨å“ªä¸ªæ¡¶å½“ä¸­ã€‚ è·å¾—æ›´é«˜çš„æŸ¥è¯¢å¤„ç†æ•ˆç‡ã€‚æ¡¶ä¸ºè¡¨åŠ ä¸Šäº†é¢å¤–çš„ç»“æ„ï¼ŒHive åœ¨å¤„ç†æœ‰äº›æŸ¥è¯¢æ—¶èƒ½åˆ©ç”¨è¿™ä¸ªç»“æ„ã€‚ä½¿å–æ ·ï¼ˆsamplingï¼‰æ›´é«˜æ•ˆã€‚ ROW FORMAT ç”¨æˆ·åœ¨å»ºè¡¨çš„æ—¶å€™å¯ä»¥è‡ªå®šä¹‰ SerDe æˆ–è€…ä½¿ç”¨è‡ªå¸¦çš„ SerDeã€‚SerDe æ˜¯ Serialize / Deserilize çš„ç®€ç§°ï¼Œç›®çš„æ˜¯ç”¨äºåºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚ STORED AS æŒ‡å®šå­˜å‚¨æ–‡ä»¶ç±»å‹ã€‚å¸¸ç”¨çš„å­˜å‚¨æ–‡ä»¶ç±»å‹ï¼šSEQUENCEFILEï¼ˆäºŒè¿›åˆ¶åºåˆ—æ–‡ä»¶ï¼‰ã€TEXTFILEï¼ˆæ–‡æœ¬ï¼‰ã€ RCFILEï¼ˆåˆ—å¼å­˜å‚¨æ ¼å¼æ–‡ä»¶ï¼‰ å¦‚æœæ–‡ä»¶æ•°æ®æ˜¯çº¯æ–‡æœ¬ï¼Œå¯ä»¥ä½¿ç”¨ STORED AS TEXTFILEã€‚å¦‚æœæ•°æ®éœ€è¦å‹ç¼©ï¼Œ ä½¿ç”¨ STORED AS SEQUENCEFILEã€‚ LOCATION æŒ‡å®šè¡¨åœ¨ HDFS ä¸Šçš„å­˜å‚¨ä½ç½®ã€‚ LIKE å…è®¸ç”¨æˆ·å¤åˆ¶ç°æœ‰çš„è¡¨ç»“æ„ï¼Œä½†æ˜¯ä¸å¤åˆ¶æ•°æ®ã€‚ å†…éƒ¨è¡¨ é»˜è®¤åˆ›å»ºçš„è¡¨éƒ½æ˜¯æ‰€è°“çš„ç®¡ç†è¡¨ï¼Œæœ‰æ—¶ä¹Ÿè¢«ç§°ä¸ºå†…éƒ¨è¡¨ã€‚å› ä¸ºè¿™ç§è¡¨ï¼ŒHive ä¼šï¼ˆæˆ–å¤šæˆ–å°‘åœ°ï¼‰æ§åˆ¶ç€æ•°æ®çš„ç”Ÿå‘½å‘¨æœŸã€‚Hive é»˜è®¤æƒ…å†µä¸‹ä¼šå°†è¿™äº›è¡¨çš„æ•°æ®å­˜å‚¨åœ¨ç”±é…ç½®é¡¹ hive.metastore.warehouse.dirï¼ˆä¾‹å¦‚ï¼Œ/user/hive/warehouseï¼‰æ‰€å®šä¹‰çš„ç›®å½•çš„å­ç›®å½•ä¸‹ã€‚å½“åˆ é™¤ä¸€ä¸ªç®¡ç†è¡¨æ—¶ï¼ŒHive ä¹Ÿä¼šåˆ é™¤è¿™ä¸ªè¡¨ä¸­æ•°æ®ã€‚å†…éƒ¨è¡¨ä¸é€‚åˆå’Œå…¶ä»–å·¥å…·å…±äº«æ•°æ®ã€‚ 12345678910111213# åˆ›å»ºå†…éƒ¨è¡¨create table if not exists student(id int, name string)row format delimited fields terminated by '\\t'stored as textfilelocation '/user/hive/warehouse/student';# æ ¹æ®æŸ¥è¯¢ç»“æœåˆ›å»ºè¡¨ï¼ˆæŸ¥è¯¢çš„ç»“æœä¼šæ·»åŠ åˆ°æ–°åˆ›å»ºçš„è¡¨ä¸­ï¼‰create table if not exists student01 as select id, name from student;# æ ¹æ®å·²ç»å­˜åœ¨çš„è¡¨ç»“æ„åˆ›å»ºè¡¨create table if not exists student02 like student;# æŸ¥è¯¢è¡¨çš„ç±»å‹desc formatted student01 å¤–éƒ¨è¡¨ å› ä¸ºè¡¨æ˜¯å¤–éƒ¨è¡¨ï¼Œæ‰€ä»¥ Hive å¹¶éè®¤ä¸ºå…¶å®Œå…¨æ‹¥æœ‰è¿™ä»½æ•°æ®ã€‚åˆ é™¤è¯¥è¡¨å¹¶ä¸ä¼šåˆ é™¤æ‰è¿™ ä»½æ•°æ®ï¼Œä¸è¿‡æè¿°è¡¨çš„å…ƒæ•°æ®ä¿¡æ¯ä¼šè¢«åˆ é™¤æ‰ã€‚ æ¯å¤©å°†æ”¶é›†åˆ°çš„ç½‘ç«™æ—¥å¿—å®šæœŸæµå…¥ HDFS æ–‡æœ¬æ–‡ä»¶ã€‚åœ¨å¤–éƒ¨è¡¨ï¼ˆåŸå§‹æ—¥å¿—è¡¨ï¼‰çš„åŸºç¡€ ä¸Šåšå¤§é‡çš„ç»Ÿè®¡åˆ†æï¼Œç”¨åˆ°çš„ä¸­é—´è¡¨ã€ç»“æœè¡¨ä½¿ç”¨å†…éƒ¨è¡¨å­˜å‚¨ï¼Œæ•°æ®é€šè¿‡ SELECT+INSERT è¿›å…¥å†…éƒ¨è¡¨ã€‚ 12345678910111213141516171819202122232425262728293031323334# åˆ›å»ºå¤–éƒ¨è¡¨éƒ¨é—¨è¡¨create external table if not exists default.dept( deptno int, dname string, loc int)row format delimited fields terminated by '\\t';# åˆ›å»ºå¤–éƒ¨è¡¨å‘˜å·¥è¡¨create external table if not exists default.emp( empno int, ename string, job string, mgr int, hiredate string, sal double, comm double, deptno int)row format delimited fields terminated by '\\t';# æŸ¥è¯¢è¡¨ç»“æ„hive (default)&gt; show tables;OKtab_namedeptemp# å‘å¤–éƒ¨è¡¨ä¸­å¯¼å…¥æ•°æ®hive (default)&gt; load data local inpath '/opt/module/datas/dept.txt' into table default.dept;hive (default)&gt; load data local inpath '/opt/module/datas/emp.txt' into table default.emp;# æŸ¥è¯¢ç»“æœhive (default)&gt; select * from emp;hive (default)&gt; select * from dept;# æŸ¥çœ‹è¡¨çš„ç±»å‹hive (default)&gt; desc formatted dept;Table Type: EXTERNAL_TABLE è¡¨è½¬æ¢ åªèƒ½ç”¨å•å¼•å·ï¼Œä¸¥æ ¼åŒºåˆ†å¤§å°å†™ï¼Œå¦‚æœä¸æ˜¯å®Œå…¨ç¬¦åˆï¼Œé‚£ä¹ˆåªä¼šæ·»åŠ  K V è€Œä¸ç”Ÿæ•ˆã€‚ 1234567891011# æŸ¥è¯¢è¡¨çš„ç±»å‹hive (default)&gt; desc formatted student;Table Type: MANAGED_TABLE# ä¿®æ”¹å†…éƒ¨è¡¨ student ä¸ºå¤–éƒ¨è¡¨alter table student set tblproperties('EXTERNAL'='TRUE');hive (default)&gt; desc formatted student;Table Type: EXTERNAL_TABLE# ä¿®æ”¹å¤–éƒ¨è¡¨ student ä¸ºå†…éƒ¨è¡¨alter table student set tblproperties('EXTERNAL'='FALSE');hive (default)&gt; desc formatted student;Table Type: MANAGED_TABLE åˆ†åŒºè¡¨ åˆ†åŒºè¡¨å®é™…ä¸Šå°±æ˜¯å¯¹åº”ä¸€ä¸ª HDFS æ–‡ä»¶ç³»ç»Ÿä¸Šçš„ç‹¬ç«‹çš„æ–‡ä»¶å¤¹ï¼Œè¯¥æ–‡ä»¶å¤¹ä¸‹æ˜¯è¯¥åˆ†åŒºæ‰€æœ‰çš„æ•°æ®æ–‡ä»¶ã€‚Hive ä¸­çš„åˆ†åŒºå°±æ˜¯åˆ†ç›®å½•ï¼ŒæŠŠä¸€ä¸ªå¤§çš„æ•°æ®é›†æ ¹æ®ä¸šåŠ¡éœ€è¦åˆ†å‰²æˆå°çš„æ•°æ®é›†ã€‚åœ¨æŸ¥è¯¢æ—¶é€šè¿‡ WHERE å­å¥ä¸­çš„è¡¨è¾¾å¼é€‰æ‹©æŸ¥è¯¢æ‰€éœ€è¦çš„æŒ‡å®šçš„åˆ†åŒºï¼Œè¿™æ ·çš„æŸ¥è¯¢æ•ˆç‡ä¼šæé«˜å¾ˆå¤šã€‚ ä¸€çº§åˆ†åŒº 12345678910111213141516171819202122232425262728293031323334353637383940# å¼•å…¥åˆ†åŒºè¡¨ï¼ˆéœ€è¦æ ¹æ®æ—¥æœŸå¯¹æ—¥å¿—è¿›è¡Œç®¡ç†ï¼‰/user/hive/warehouse/log_partition/20170702/20170702.log/user/hive/warehouse/log_partition/20170703/20170703.log/user/hive/warehouse/log_partition/20170704/20170704.log# åˆ›å»ºåˆ†åŒºè¡¨è¯­æ³•hive (default)&gt; create table dept_partition( deptno int, dname string, loc string)partitioned by (month string)row format delimited fields terminated by '\\t';# åˆ†åŒºåŸŸå¯¼å…¥æ•°æ®hive (default)&gt; load data local inpath '/opt/module/datas/dept.txt' into tabledefault.dept_partition partition(month='201709');hive (default)&gt; load data local inpath '/opt/module/datas/dept.txt' into tabledefault.dept_partition partition(month='201708');hive (default)&gt; load data local inpath '/opt/module/datas/dept.txt' into tabledefault.dept_partition partition(month='201707â€™);# å•åˆ†åŒºæŸ¥è¯¢hive (default)&gt; select * from dept_partition where month='201709';# å¤šåˆ†åŒºè”åˆæŸ¥è¯¢ unionï¼ˆæ’åºï¼‰ or in ä¸‰ç§æ–¹å¼hive (default)&gt; select * from dept_partition where month='201709'unionselect * from dept_partition where month='201708'unionselect * from dept_partition where month='201707';# å¢åŠ åˆ†åŒºhive (default)&gt; alter table dept_partition add partition(month='201706') ;# åŒæ—¶åˆ›å»ºå¤šä¸ªåˆ†åŒº ç”¨ç©ºæ ¼åˆ†å¼€hive (default)&gt; alter table dept_partition add partition(month='201705') partition(month='201704');# åˆ é™¤å•ä¸ªåˆ†åŒºhive (default)&gt; alter table dept_partition drop partition (month='201704');# åŒæ—¶åˆ é™¤å¤šä¸ªåˆ†åŒº ç”¨é€—å·åˆ†å¼€hive (default)&gt; alter table dept_partition drop partition (month='201705'), partition (month='201706');# æŸ¥çœ‹åˆ†åŒºè¡¨æœ‰å¤šå°‘åˆ†åŒºhive&gt; show partitions dept_partition;# æŸ¥çœ‹åˆ†åŒºè¡¨ç»“æ„hive&gt; desc formatted dept_partition; # Partition Information # col_name data_type # comment month string äºŒçº§åˆ†åŒº 1234567891011121314151617181920212223242526272829303132333435# åˆ›å»ºäºŒçº§åˆ†åŒºè¡¨hive (default)&gt; create table dept_partition2( deptno int, dname string, loc string)partitioned by (month string, day string)row format delimited fields terminated by '\\t';# åŠ è½½æ•°æ®åˆ°äºŒçº§åˆ†åŒºè¡¨ä¸­hive (default)&gt; load data local inpath '/opt/module/datas/dept.txt' into table default.dept_partition2 partition(month='201709', day='13');hive (default)&gt; select * from dept_partition2 where month='201709' and day='13';# æŠŠæ•°æ®ç›´æ¥ä¸Šä¼ åˆ°åˆ†åŒºç›®å½•ä¸Šï¼Œè®©åˆ†åŒºè¡¨å’Œæ•°æ®äº§ç”Ÿå…³è”çš„ä¸‰ç§æ–¹å¼# æ–¹å¼ä¸€ï¼šä¸Šä¼ æ•°æ®åä¿®å¤# ä¸Šä¼ æ•°æ®hive (default)&gt; dfs -mkdir -p /user/hive/warehouse/dept_partition2/month=201709/day=12;hive (default)&gt; dfs -put /opt/module/datas/dept.txt /user/hive/warehouse/dept_partition2/month=201709/day=12; # æŸ¥è¯¢æ•°æ®ï¼ˆæŸ¥è¯¢ä¸åˆ°åˆšä¸Šä¼ çš„æ•°æ®ï¼‰hive (default)&gt; select * from dept_partition2 where month='201709' and day='12'; # æ‰§è¡Œä¿®å¤å‘½ä»¤hive&gt; msck repair table dept_partition2; # å†æ¬¡æŸ¥è¯¢æ•°æ®hive (default)&gt; select * from dept_partition2 where month='201709' and day='12';# æ–¹å¼äºŒï¼šä¸Šä¼ æ•°æ®åæ·»åŠ åˆ†åŒº# ä¸Šä¼ æ•°æ®hive (default)&gt; dfs -mkdir -p /user/hive/warehouse/dept_partition2/month=201709/day=11;hive (default)&gt; dfs -put /opt/module/datas/dept.txt /user/hive/warehouse/dept_partition2/month=201709/day=11; # æ‰§è¡Œæ·»åŠ åˆ†åŒºhive (default)&gt; alter table dept_partition2 add partition(month='201709',day='11'); # æŸ¥è¯¢æ•°æ®hive (default)&gt; select * from dept_partition2 where month='201709' and day='11';# æ–¹å¼ä¸‰ï¼šä¸Šä¼ æ•°æ®å load æ•°æ®åˆ°åˆ†åŒº# åˆ›å»ºç›®å½•hive (default)&gt; dfs -mkdir -p /user/hive/warehouse/dept_partition2/month=201709/day=10; # ä¸Šä¼ æ•°æ®hive (default)&gt; load data local inpath '/opt/module/datas/dept.txt' into table dept_partition2 partition(month='201709',day='10');# æŸ¥è¯¢æ•°æ®hive (default)&gt; select * from dept_partition2 where month='201709' and day='10'; åˆ—ä¿¡æ¯1234# æ›´æ–°åˆ—ALTER TABLE table_name CHANGE [COLUMN] col_old_name col_new_name column_type [COMMENT col_comment] [FIRST|AFTER column_name]ALTER TABLE table_name ADD|REPLACE COLUMNS (col_name data_type [COMMENT col_comment], ...)# ADD æ˜¯ä»£è¡¨æ–°å¢ä¸€å­—æ®µï¼Œå­—æ®µä½ç½®åœ¨æ‰€æœ‰åˆ—åé¢ï¼ˆpartition åˆ—å‰ï¼‰ï¼ŒREPLACE åˆ™æ˜¯è¡¨ç¤ºæ›¿æ¢è¡¨ä¸­æ‰€æœ‰å­—æ®µ åˆ é™¤è¡¨1hive (default)&gt; drop table [table_name]; DMLæ•°æ®å¯¼å…¥123456789# åˆ›å»ºä¸€å¼ è¡¨hive (default)&gt; create table student(id string, name string) row format delimited fields terminated by '\\t';# åŠ è½½æœ¬åœ°æ–‡ä»¶åˆ° hivehive (default)&gt; load data local inpath '/opt/module/datas/student.txt' into table default.student;# åŠ è½½ HDFS æ–‡ä»¶åˆ° hive ä¸­# ä¸Šä¼ æ–‡ä»¶åˆ° HDFShive (default)&gt; dfs -put /opt/module/datas/student.txt /user/atguigu/hive;# åŠ è½½ HDFS ä¸Šçš„æ•°æ®hive (default)&gt; load data inpath '/user/atguigu/hive/student.txt' into table default.student; åŠ è½½æ•°æ®è¦†ç›–è¡¨ä¸­å·²æœ‰çš„æ•°æ®ã€‚ 1234# ä¸Šä¼ æ–‡ä»¶åˆ° HDFShive (default)&gt; dfs -put /opt/module/datas/student.txt /user/atguigu/hive;# åŠ è½½æ•°æ®è¦†ç›–è¡¨ä¸­å·²æœ‰çš„æ•°æ®hive (default)&gt; load data inpath '/user/atguigu/hive/student.txt' overwrite into table default.student; é€šè¿‡æŸ¥è¯¢è¯­å¥å‘è¡¨ä¸­æ’å…¥æ•°æ®ï¼ˆInsertï¼‰ã€‚ 12345678910111213# åˆ›å»ºä¸€å¼ åˆ†åŒºè¡¨hive (default)&gt; create table student(id int, name string) partitioned by (month string) row format delimited fields terminated by '\\t';# åŸºæœ¬æ’å…¥æ•°æ®hive (default)&gt; insert into table student partition(month='201709') values(1,'wangwu');# åŸºæœ¬æ¨¡å¼æ’å…¥ï¼ˆæ ¹æ®å•å¼ è¡¨æŸ¥è¯¢ç»“æœï¼‰hive (default)&gt; insert overwrite table student partition(month='201708') select id, name from student where month='201709';# å¤šæ’å…¥æ¨¡å¼ï¼ˆæ ¹æ®å¤šå¼ è¡¨æŸ¥è¯¢ç»“æœï¼‰hive (default)&gt; from student insert overwrite table student partition(month='201707') select id, name where month='201709' insert overwrite table student partition(month='201706') select id, name where month='201709'; æŸ¥è¯¢è¯­å¥ä¸­åˆ›å»ºè¡¨å¹¶åŠ è½½æ•°æ®ï¼ˆAs Selectï¼‰ã€‚ 12# æ ¹æ®æŸ¥è¯¢ç»“æœåˆ›å»ºè¡¨ï¼ˆæŸ¥è¯¢çš„ç»“æœä¼šæ·»åŠ åˆ°æ–°åˆ›å»ºçš„è¡¨ä¸­ï¼‰create table if not exists student_new as select id, name from student; åˆ›å»ºè¡¨æ—¶é€šè¿‡ Location æŒ‡å®šåŠ è½½æ•°æ®è·¯å¾„. 12345678910# åˆ›å»ºè¡¨ï¼Œå¹¶æŒ‡å®šåœ¨ hdfs ä¸Šçš„ä½ç½®hive (default)&gt; create table if not exists student( id int, name string)row format delimited fields terminated by '\\t'location '/user/hive/warehouse/student';# ä¸Šä¼ æ•°æ®åˆ° hdfs ä¸Šhive (default)&gt; dfs -put /opt/module/datas/student.txt /user/hive/warehouse/student;# æŸ¥è¯¢æ•°æ®hive (default)&gt; select * from student; Import æ•°æ®ï¼ˆexport åˆ°å¤„çš„æ•°æ®ï¼‰åˆ°æŒ‡å®š Hive è¡¨ä¸­ã€‚ 1hive (default)&gt; import table student partition(month='201709') from '/user/hive/warehouse/export/student'; æ•°æ®å¯¼å‡º Insert å¯¼å‡ºã€‚ 123456# å°†æŸ¥è¯¢çš„ç»“æœå¯¼å‡ºåˆ°æœ¬åœ°hive (default)&gt; insert overwrite local directory '/opt/module/datas/export/student' select * from student;# å°†æŸ¥è¯¢çš„ç»“æœæ ¼å¼åŒ–å¯¼å‡ºåˆ°æœ¬åœ°hive (default)&gt; insert overwrite local directory '/opt/module/datas/export/student' ROW FORMAT DELIMITED FIELDS TERMINATED BY '\\t' select * from student;# å°†æŸ¥è¯¢çš„ç»“æœå¯¼å‡ºåˆ° HDFS ä¸Šï¼ˆæ²¡æœ‰ localï¼‰hive (default)&gt; insert overwrite directory '/user/wingo/student' ROW FORMAT DELIMITED FIELDS TERMINATED BY '\\t' select * from student; Hadoop å‘½ä»¤å¯¼å‡ºåˆ°æœ¬åœ°ã€‚ 1hive (default)&gt; dfs -get /user/hive/warehouse/student/month=201709/000000_0 /opt/module/datas/export/student.txt; Hive Shell å‘½ä»¤å¯¼å‡ºã€‚ 1bin/hive -e 'select * from default.student;' &gt; /opt/module/datas/export/student.txt; Export å¯¼å‡ºåˆ° HDFS ä¸Šã€‚ 1hive (default) &gt;export table default.student to '/user/hive/warehouse/export/student'; æ¸…é™¤è¡¨ Truncate åªèƒ½åˆ é™¤ç®¡ç†è¡¨ï¼Œä¸èƒ½åˆ é™¤å¤–éƒ¨è¡¨ä¸­æ•°æ®ã€‚ 1hive (default)&gt; truncate table student; æŸ¥è¯¢ åŸºæœ¬æŸ¥è¯¢ 123456# å…¨è¡¨æŸ¥è¯¢hive (default)&gt; select * from emp;# é€‰æ‹©ç‰¹å®šåˆ—æŸ¥è¯¢hive (default)&gt; select empno, ename from emp;# åˆ—åˆ«åhive (default)&gt; select ename AS name, deptno dn from emp; è¿ç®—ç¬¦æŸ¥è¯¢ 12# ç®—æœ¯è¿ç®—ç¬¦ï¼šæŸ¥è¯¢å‡ºæ‰€æœ‰å‘˜å·¥çš„è–ªæ°´ååŠ  1 æ˜¾ç¤ºhive (default)&gt; select sal+1 from emp; å‡½æ•°æŸ¥è¯¢ 12345678910# æ±‚æ€»è¡Œæ•°ï¼ˆcountï¼‰hive (default)&gt; select count(*) cnt from emp;# æ±‚å·¥èµ„çš„æœ€å¤§å€¼ï¼ˆmaxï¼‰hive (default)&gt; select max(sal) max_sal from emp;# æ±‚å·¥èµ„çš„æœ€å°å€¼ï¼ˆminï¼‰hive (default)&gt; select min(sal) min_sal from emp;# æ±‚å·¥èµ„çš„æ€»å’Œï¼ˆsumï¼‰hive (default)&gt; select sum(sal) sum_sal from emp;# æ±‚å·¥èµ„çš„å¹³å‡å€¼ï¼ˆavgï¼‰hive (default)&gt; select avg(sal) avg_sal from emp; Limit è¯­å¥ å…¸å‹çš„æŸ¥è¯¢ä¼šè¿”å›å¤šè¡Œæ•°æ®ã€‚LIMIT å­å¥ç”¨äºé™åˆ¶è¿”å›çš„è¡Œæ•°ã€‚ 1hive (default)&gt; select * from emp limit 5; Where12# æŸ¥è¯¢å‡ºè–ªæ°´å¤§äº 1000 çš„æ‰€æœ‰å‘˜å·¥hive (default)&gt; select * from emp where sal &gt;1000; æ¯”è¾ƒè¿ç®—ç¬¦ï¼ˆBetween/In/ Is Nullï¼‰ï¼Œè¿™äº›æ“ä½œç¬¦åŒæ ·å¯ä»¥ç”¨äº JOINâ€¦ON å’Œ HAVING è¯­å¥ä¸­ã€‚ 12345678# æŸ¥è¯¢å‡ºè–ªæ°´ç­‰äº 5000 çš„æ‰€æœ‰å‘˜å·¥hive (default)&gt; select * from emp where sal =5000;# æŸ¥è¯¢å·¥èµ„åœ¨ 500 åˆ° 1000 çš„å‘˜å·¥ä¿¡æ¯hive (default)&gt; select * from emp where sal between 500 and 1000;# æŸ¥è¯¢ comm ä¸ºç©ºçš„æ‰€æœ‰å‘˜å·¥ä¿¡æ¯hive (default)&gt; select * from emp where comm is null;# æŸ¥è¯¢å·¥èµ„æ˜¯ 1500 å’Œ 5000 çš„å‘˜å·¥ä¿¡æ¯hive (default)&gt; select * from emp where sal IN (1500, 5000); Like å’Œ RLike % ä»£è¡¨é›¶ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ï¼ˆä»»æ„ä¸ªå­—ç¬¦ï¼‰ï¼›_ ä»£è¡¨ä¸€ä¸ªå­—ç¬¦RLIKE å­å¥æ˜¯ Hive ä¸­è¿™ä¸ªåŠŸèƒ½çš„ä¸€ä¸ªæ‰©å±•ï¼Œå…¶å¯ä»¥é€šè¿‡ Java çš„æ­£åˆ™è¡¨è¾¾å¼è¿™ä¸ªæ›´å¼ºå¤§çš„è¯­è¨€æ¥æŒ‡å®šåŒ¹é…æ¡ä»¶ã€‚ 123456# æŸ¥æ‰¾ä»¥ 2 å¼€å¤´è–ªæ°´çš„å‘˜å·¥ä¿¡æ¯hive (default)&gt; select * from emp where sal LIKE '2%';# æŸ¥æ‰¾ç¬¬äºŒä¸ªæ•°å€¼ä¸º 2 çš„è–ªæ°´çš„å‘˜å·¥ä¿¡æ¯hive (default)&gt; select * from emp where sal LIKE '_2%';# æŸ¥æ‰¾è–ªæ°´ä¸­å«æœ‰ 2 çš„å‘˜å·¥ä¿¡æ¯hive (default)&gt; select * from emp where sal RLIKE '[2]'; é€»è¾‘è¿ç®—ç¬¦ï¼ˆAnd/Or/Notï¼‰ 123456# æŸ¥è¯¢è–ªæ°´å¤§äº 1000ï¼Œéƒ¨é—¨æ˜¯ 30hive (default)&gt; select * from emp where sal&gt;1000 and deptno=30;# æŸ¥è¯¢è–ªæ°´å¤§äº 1000ï¼Œæˆ–è€…éƒ¨é—¨æ˜¯ 30hive (default)&gt; select * from emp where sal&gt;1000 or deptno=30;# æŸ¥è¯¢é™¤äº† 20 éƒ¨é—¨å’Œ 30 éƒ¨é—¨ä»¥å¤–çš„å‘˜å·¥ä¿¡æ¯hive (default)&gt; select * from emp where deptno not IN(30, 20); åˆ†ç»„ GROUP BY è¯­å¥é€šå¸¸ä¼šå’Œèšåˆå‡½æ•°ä¸€èµ·ä½¿ç”¨ï¼ŒæŒ‰ç…§ä¸€ä¸ªæˆ–è€…å¤šä¸ªåˆ—é˜Ÿç»“æœè¿›è¡Œåˆ†ç»„ï¼Œç„¶åå¯¹æ¯ä¸ªç»„æ‰§è¡Œèšåˆæ“ä½œã€‚ 1234# è®¡ç®— emp è¡¨æ¯ä¸ªéƒ¨é—¨çš„å¹³å‡å·¥èµ„hive (default)&gt; select t.deptno, avg(t.sal) avg_sal from emp t group by t.deptno;# è®¡ç®— emp æ¯ä¸ªéƒ¨é—¨ä¸­æ¯ä¸ªå²—ä½çš„æœ€é«˜è–ªæ°´hive (default)&gt; select t.deptno, t.job, max(t.sal) max_sal from emp t group by t.deptno, t.job; Having è¯­å¥ where é’ˆå¯¹è¡¨ä¸­çš„åˆ—å‘æŒ¥ä½œç”¨ï¼ŒæŸ¥è¯¢æ•°æ®ï¼›Having é’ˆå¯¹æŸ¥è¯¢ç»“æœä¸­çš„åˆ—å‘æŒ¥ä½œç”¨ï¼Œ ç­›é€‰æ•°æ®ã€‚ 12# æ±‚æ¯ä¸ªéƒ¨é—¨çš„å¹³å‡è–ªæ°´å¤§äº 2000 çš„éƒ¨é—¨hive (default)&gt; select deptno, avg(sal) avg_sal from emp group by deptno having avg_sal &gt; 2000; Join æ˜¯åªæ”¯æŒç­‰å€¼è¿æ¥ï¼Œä¸æ”¯æŒéç­‰å€¼è¿æ¥ 123456789101112# æ ¹æ®å‘˜å·¥è¡¨å’Œéƒ¨é—¨è¡¨ä¸­çš„éƒ¨é—¨ç¼–å·ç›¸ç­‰ï¼ŒæŸ¥è¯¢å‘˜å·¥ç¼–å·ã€å‘˜å·¥åç§°å’Œéƒ¨é—¨ç¼–å·ï¼›hive (default)&gt; select e.empno, e.ename, d.deptno, d.dname from emp e join dept d on e.deptno = d.deptno;# åˆå¹¶å‘˜å·¥è¡¨å’Œéƒ¨é—¨è¡¨hive (default)&gt; select e.empno, e.ename, d.deptno from emp e join dept d on e.deptno = d.deptno;# å†…è¿æ¥ï¼šåªæœ‰è¿›è¡Œè¿æ¥çš„ä¸¤ä¸ªè¡¨ä¸­éƒ½å­˜åœ¨ä¸è¿æ¥æ¡ä»¶ç›¸åŒ¹é…çš„æ•°æ®æ‰ä¼šè¢«ä¿ç•™ä¸‹æ¥ã€‚hive (default)&gt; select e.empno, e.ename, d.deptno from emp e join dept d on e.deptno = d.deptno;# å·¦å¤–è¿æ¥ï¼šJOIN æ“ä½œç¬¦å·¦è¾¹è¡¨ä¸­ç¬¦åˆ WHERE å­å¥çš„æ‰€æœ‰è®°å½•å°†ä¼šè¢«è¿”å›ã€‚hive (default)&gt; select e.empno, e.ename, d.deptno from emp e left join dept d on e.deptno = d.deptno;# å³å¤–è¿æ¥ï¼šJOIN æ“ä½œç¬¦å³è¾¹è¡¨ä¸­ç¬¦åˆ WHERE å­å¥çš„æ‰€æœ‰è®°å½•å°†ä¼šè¢«è¿”å›ã€‚hive (default)&gt; select e.empno, e.ename, d.deptno from emp e right join dept d on e.deptno = d.deptno;# æ»¡å¤–è¿æ¥ï¼šå°†ä¼šè¿”å›æ‰€æœ‰è¡¨ä¸­ç¬¦åˆ WHERE è¯­å¥æ¡ä»¶çš„æ‰€æœ‰è®°å½•ã€‚å¦‚æœä»»ä¸€è¡¨çš„æŒ‡å®šå­—æ®µæ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„å€¼çš„è¯ï¼Œé‚£ä¹ˆå°±ä½¿ç”¨ NULL å€¼æ›¿ä»£ã€‚hive (default)&gt; select e.empno, e.ename, d.deptno from emp e full join dept d on e.deptno = d.deptno; å¤šè¡¨è¿æ¥ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒHive ä¼šå¯¹æ¯å¯¹ JOIN è¿æ¥å¯¹è±¡å¯åŠ¨ä¸€ä¸ª MapReduce ä»»åŠ¡ã€‚Hive æ€»æ˜¯æŒ‰ç…§ä»å·¦åˆ°å³çš„ é¡ºåºæ‰§è¡Œçš„ã€‚ æ’åºå…¨å±€æ’åº Order Byï¼šå…¨å±€æ’åºï¼Œä¸€ä¸ª MapReduceã€‚ ASCï¼ˆascendï¼‰: å‡åºï¼ˆé»˜è®¤ï¼‰ï¼›DESCï¼ˆdescendï¼‰: é™åºã€‚ 12345678# æŸ¥è¯¢å‘˜å·¥ä¿¡æ¯æŒ‰å·¥èµ„å‡åºæ’åˆ—hive (default)&gt; select * from emp order by sal;# æŸ¥è¯¢å‘˜å·¥ä¿¡æ¯æŒ‰å·¥èµ„é™åºæ’åˆ—hive (default)&gt; select * from emp order by sal desc;# æŒ‰ç…§åˆ«åæ’åºï¼ŒæŒ‰ç…§å‘˜å·¥è–ªæ°´çš„ 2 å€æ’åºhive (default)&gt; select ename, sal*2 twosal from emp order by twosal;# æŒ‰ç…§éƒ¨é—¨å’Œå·¥èµ„å‡åºæ’åºhive (default)&gt; select ename, deptno, sal from emp order by deptno, sal ; å†…éƒ¨æ’åº æ¯ä¸ª MapReduce å†…éƒ¨æ’åºï¼ˆSort Byï¼‰ã€‚ Sort Byï¼šæ¯ä¸ª MapReduce å†…éƒ¨è¿›è¡Œæ’åºï¼Œå¯¹å…¨å±€ç»“æœé›†æ¥è¯´ä¸æ˜¯æ’åºã€‚ 1234567# è®¾ç½® reduce ä¸ªæ•°hive (default)&gt; set mapreduce.job.reduces=3;# æŸ¥çœ‹è®¾ç½® reduce ä¸ªæ•°hive (default)&gt; set mapreduce.job.reduces;# æ ¹æ®éƒ¨é—¨ç¼–å·é™åºæŸ¥çœ‹å‘˜å·¥ä¿¡æ¯hive (default)&gt; select * from emp sort by empno desc;hive (default)&gt; insert overwrite local directory '/opt/module/datas/sortby-result' select * from emp sort by deptno desc; åˆ†åŒºæ’åº Distribute Byï¼šç±»ä¼¼ MR ä¸­ partitionï¼Œè¿›è¡Œåˆ†åŒºï¼Œç»“åˆ sort by ä½¿ç”¨ã€‚ Hive è¦æ±‚ DISTRIBUTE BY è¯­å¥è¦å†™åœ¨ SORT BY è¯­å¥ä¹‹å‰ 1234# å…ˆæŒ‰ç…§éƒ¨é—¨ç¼–å·åˆ†åŒºï¼Œå†æŒ‰ç…§å‘˜å·¥ç¼–å·é™åºæ’åºã€‚hive (default)&gt; set mapreduce.job.reduces=3;hive (default)&gt; insert overwrite local directory '/opt/module/datas/distribute-result' select * from emp distribute by deptno sort by empno desc; Cluster By é™¤äº†å…·æœ‰ Distribute By çš„åŠŸèƒ½å¤–è¿˜å…¼å…· Sort By çš„åŠŸèƒ½ã€‚ä½†æ˜¯æ’åºåªèƒ½æ˜¯å€’åºæ’åºï¼Œä¸èƒ½æŒ‡å®šæ’åºè§„åˆ™ä¸º ASC æˆ–è€… DESCã€‚ 123hive (default)&gt; select * from emp cluster by deptno;# ç­‰ä»·äºhive (default)&gt; select * from emp distribute by deptno sort by deptno; æ¡¶ åˆ†åŒºé’ˆå¯¹çš„æ˜¯æ•°æ®çš„å­˜å‚¨è·¯å¾„ï¼›åˆ†æ¡¶é’ˆå¯¹çš„æ˜¯æ•°æ®æ–‡ä»¶ã€‚ 123456789101112131415161718192021222324252627282930# ç¬¬ä¸€æ¬¡å°è¯•# åˆ›å»ºåˆ†æ¡¶è¡¨ï¼ŒæŒ‰ id å–æ¨¡create table stu_buck(id int, name string) clustered by(id) into 4 buckets row format delimited fields terminated by '\\t';# æŸ¥çœ‹è¡¨ç»“æ„hive (default)&gt; desc formatted stu_buck; # Num Buckets: 4# å¯¼å…¥æ•°æ®åˆ°åˆ†æ¡¶è¡¨ä¸­ï¼Œç›´æ¥ load ä¸ä¼šè¿›è¡Œåˆ†æ¡¶ï¼Œè¿˜æ˜¯ä¸€æ•´ä¸ªæ–‡ä»¶ï¼Œé‚£ä¹ˆé€šè¿‡ MR å¯¼å…¥å‘¢ï¼Ÿhive (default)&gt; load data local inpath '/opt/module/datas/student.txt' into table stu_buck;# ç¬¬äºŒæ¬¡å°è¯•ï¼Œåˆ›å»ºåˆ†æ¡¶è¡¨æ—¶ï¼Œæ•°æ®é€šè¿‡å­æŸ¥è¯¢çš„æ–¹å¼å¯¼å…¥# åˆ›å»ºç”¨äºå­æŸ¥è¯¢çš„è¡¨create table stu(id int, name string) row format delimited fields terminated by '\\t';# å‘æ™®é€šçš„ stu è¡¨ä¸­å¯¼å…¥æ•°æ®load data local inpath '/opt/module/datas/student.txt' into table stu;# æ¸…ç©º stu_buck è¡¨ä¸­æ•°æ®truncate table stu_buck;select * from stu_buck;# å¯¼å…¥æ•°æ®åˆ°åˆ†æ¡¶è¡¨ï¼Œé€šè¿‡å­æŸ¥è¯¢çš„æ–¹å¼insert into table stu_buck select id, name from stu;# å‘ç°è¿˜æ˜¯åªæœ‰ä¸€ä¸ªåˆ†æ¡¶# éœ€è¦è®¾ç½®ä¸€ä¸ªå±æ€§hive (default)&gt; set hive.enforce.bucketing=true;hive (default)&gt; set mapreduce.job.reduces=-1;hive (default)&gt; insert into table stu_buck select id, name from stu;# æŸ¥è¯¢åˆ†æ¡¶çš„æ•°æ®ï¼Œåˆ†æ¡¶æˆåŠŸhive (default)&gt; select * from stu_buck; åˆ†æ¡¶æŠ½æ ·æŸ¥è¯¢ å¯¹äºéå¸¸å¤§çš„æ•°æ®é›†ï¼Œæœ‰æ—¶ç”¨æˆ·éœ€è¦ä½¿ç”¨çš„æ˜¯ä¸€ä¸ªå…·æœ‰ä»£è¡¨æ€§çš„æŸ¥è¯¢ç»“æœè€Œä¸æ˜¯å…¨éƒ¨ç»“ æœã€‚Hive å¯ä»¥é€šè¿‡å¯¹è¡¨è¿›è¡ŒæŠ½æ ·æ¥æ»¡è¶³è¿™ä¸ªéœ€æ±‚ã€‚ 12# æŸ¥è¯¢è¡¨ stu_buck ä¸­çš„æ•°æ®hive (default)&gt; select * from stu_buck tablesample (bucket 1 out of 4 on id); TABLESAMPLE(BUCKET x OUT OF y) y å¿…é¡»æ˜¯ table æ€» bucket æ•°çš„å€æ•°æˆ–è€…å› å­ã€‚hive æ ¹æ® y çš„å¤§å°ï¼Œå†³å®šæŠ½æ ·çš„æ¯”ä¾‹ã€‚table æ€» bucket æ•°ä¸º 4ï¼Œtablesample(bucket 1 out of 2)ï¼Œè¡¨ç¤ºæ€»å…±æŠ½å–ï¼ˆ4/2=ï¼‰2 ä¸ª bucket çš„æ•°æ®ï¼ŒæŠ½å–ç¬¬ 1(x) ä¸ªå’Œç¬¬ 4(x+y) ä¸ª bucket çš„æ•°æ®ã€‚ å…¶å®ƒç©ºå­—æ®µèµ‹å€¼12# å¦‚æœå‘˜å·¥çš„ comm ä¸º NULLï¼Œåˆ™ç”¨-1 ä»£æ›¿hive (default)&gt; select nvl(comm,-1) from emp; CASE WHEN 12345678910111213141516171819202122232425262728# æ±‚å‡ºä¸åŒéƒ¨é—¨ç”·å¥³å„å¤šå°‘äººvi emp_sex.txt # æ‚Ÿç©º A ç”· # å¤§æµ· A ç”· # å®‹å®‹ B ç”· # å‡¤å§ A å¥³ # å©·å§ B å¥³ # å©·å©· B å¥³# åˆ›å»º hive è¡¨å¹¶å¯¼å…¥æ•°æ®create table emp_sex( name string, dept_id int, sex string)row format delimited fields terminated by \"\\t\";load data local inpath '/opt/module/datas/emp_sex.txt' into table emp_sex;# æŒ‰éœ€æ±‚æŸ¥è¯¢æ•°æ®select dept_id, sum(case sex when 'ç”·' then 1 else 0 end) male_count, sum(case sex when 'å¥³' then 1 else 0 end) female_countfrom emp_sexgroup by dept_id;# ç»“æœ # A 2 1 # B 1 2 è¡Œè½¬åˆ— CONCAT(string A/col, string B/colâ€¦)ï¼šè¿”å›è¾“å…¥å­—ç¬¦ä¸²è¿æ¥åçš„ç»“æœï¼Œæ”¯æŒä»»æ„ä¸ªè¾“å…¥ å­—ç¬¦ä¸²ï¼› CONCAT_WS(separator, str1, str2,â€¦)ï¼šå®ƒæ˜¯ä¸€ä¸ªç‰¹æ®Šå½¢å¼çš„ CONCAT()ã€‚ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºå‚æ•°é—´çš„åˆ†éš”ç¬¦ã€‚åˆ†éš”ç¬¦å¯ä»¥æ˜¯ä¸å‰©ä½™å‚æ•°ä¸€æ ·çš„å­—ç¬¦ä¸²ã€‚å¦‚æœåˆ†éš”ç¬¦æ˜¯ NULLï¼Œ è¿”å›å€¼ä¹Ÿå°†ä¸º NULLã€‚è¿™ä¸ªå‡½æ•°ä¼šè·³è¿‡åˆ†éš”ç¬¦å‚æ•°åçš„ä»»ä½• NULL å’Œç©ºå­—ç¬¦ä¸²ã€‚åˆ†éš”ç¬¦å°†è¢«åŠ åˆ°è¢«è¿æ¥çš„å­—ç¬¦ä¸²ä¹‹é—´ï¼› COLLECT_SET(col)ï¼šå‡½æ•°åªæ¥å—åŸºæœ¬æ•°æ®ç±»å‹ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯å°†æŸå­—æ®µçš„å€¼è¿›è¡Œå»é‡æ±‡æ€»ï¼Œäº§ç”Ÿ array ç±»å‹å­—æ®µã€‚ 1234567891011121314151617181920212223242526272829vi constellation.txt # å­™æ‚Ÿç©º ç™½ç¾Šåº§ A # å¤§æµ· å°„æ‰‹åº§ A # å®‹å®‹ ç™½ç¾Šåº§ B # çŒªå…«æˆ’ ç™½ç¾Šåº§ A # å‡¤å§ å°„æ‰‹åº§ A# æŒ‰æ•°æ®æ ¼å¼åˆ›å»ºè¡¨create table person_info( name string, constellation string, blood_type string)row format delimited fields terminated by \"\\t\";load data local inpath â€œ/opt/module/datas/person_info.txtâ€ into table person_info;# æŒ‰éœ€æ±‚æŸ¥è¯¢æ•°æ®select t1.base, concat_ws('|', collect_set(t1.name)) namefrom (select name,concat(constellation, \",\", blood_type) base # æ˜Ÿåº§,è¡€å‹ from person_info ) t1group by t1.base;# ç»“æœ # å°„æ‰‹åº§,A å¤§æµ·|å‡¤å§ # ç™½ç¾Šåº§,A å­™æ‚Ÿç©º|çŒªå…«æˆ’ # ç™½ç¾Šåº§,B å®‹å®‹ åˆ—è½¬è¡Œ EXPLODE(col)ï¼šå°† hive ä¸€åˆ—ä¸­å¤æ‚çš„ array æˆ–è€… map ç»“æ„æ‹†åˆ†æˆå¤šè¡Œã€‚ LATERAL VIEW ç”¨æ³•ï¼šLATERAL VIEW udtf(expression) tableAlias AS columnAliasè§£é‡Šï¼šä¸ split, explode ç­‰ UDTF ä¸€èµ·ä½¿ç”¨ï¼Œå®ƒèƒ½å¤Ÿå°†ä¸€åˆ—æ•°æ®æ‹†æˆå¤šè¡Œæ•°æ®ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šå¯ä»¥å¯¹æ‹†åˆ†åçš„æ•°æ®è¿›è¡Œèšåˆã€‚ 1234567891011121314151617181920212223242526272829303132# åˆ›å»ºæœ¬åœ° movie.txtï¼Œå¯¼å…¥æ•°æ®vi movie.txt # ã€Šç–‘çŠ¯è¿½è¸ªã€‹ æ‚¬ç–‘,åŠ¨ä½œ,ç§‘å¹»,å‰§æƒ… # ã€ŠLie to meã€‹ æ‚¬ç–‘,è­¦åŒª,åŠ¨ä½œ,å¿ƒç†,å‰§æƒ… # ã€Šæˆ˜ç‹¼ 2ã€‹ æˆ˜äº‰,åŠ¨ä½œ,ç¾éš¾create table movie_info( movie string, category array&lt;string&gt;)row format delimited fields terminated by \"\\t\"collection items terminated by \",\";load data local inpath \"/opt/module/datas/movie.txt\" into table movie_info;# æŒ‰éœ€æ±‚æŸ¥è¯¢æ•°æ®select movie,category_namefrom movie_info lateral view explode(category) table_tmp as category_name;# ç»“æœ # ã€Šç–‘çŠ¯è¿½è¸ªã€‹ æ‚¬ç–‘ # ã€Šç–‘çŠ¯è¿½è¸ªã€‹ åŠ¨ä½œ # ã€Šç–‘çŠ¯è¿½è¸ªã€‹ ç§‘å¹» # ã€Šç–‘çŠ¯è¿½è¸ªã€‹ å‰§æƒ… # ã€ŠLie to meã€‹ æ‚¬ç–‘ # ã€ŠLie to meã€‹ è­¦åŒª # ã€ŠLie to meã€‹ åŠ¨ä½œ # ã€ŠLie to meã€‹ å¿ƒç† # ã€ŠLie to meã€‹ å‰§æƒ… # ã€Šæˆ˜ç‹¼ 2ã€‹ æˆ˜äº‰ # ã€Šæˆ˜ç‹¼ 2ã€‹ åŠ¨ä½œ # ã€Šæˆ˜ç‹¼ 2ã€‹ ç¾éš¾ çª—å£å‡½æ•° OVER()ï¼šæŒ‡å®šåˆ†æå‡½æ•°å·¥ä½œçš„æ•°æ®çª—å£å¤§å°ï¼Œè¿™ä¸ªæ•°æ®çª—å£å¤§å°å¯èƒ½ä¼šéšç€è¡Œçš„å˜è€Œå˜åŒ–ï¼›CURRENT ROWï¼šå½“å‰è¡Œï¼›n PRECEDINGï¼šå¾€å‰ n è¡Œæ•°æ®ï¼›n FOLLOWINGï¼šå¾€å n è¡Œæ•°æ®ï¼›UNBOUNDEDï¼šèµ·ç‚¹ï¼ŒUNBOUNDED PRECEDING è¡¨ç¤ºä»å‰é¢çš„èµ·ç‚¹ï¼ŒUNBOUNDED FOLLOWING è¡¨ç¤ºåˆ°åé¢çš„ç»ˆç‚¹ï¼›LAG(col,n)ï¼šå¾€å‰ç¬¬ n è¡Œæ•°æ®LEAD(col,n)ï¼šå¾€åç¬¬ n è¡Œæ•°æ®NTILE(n)ï¼šæŠŠæœ‰åºåˆ†åŒºä¸­çš„è¡Œåˆ†å‘åˆ°æŒ‡å®šæ•°æ®çš„ç»„ä¸­ï¼Œå„ä¸ªç»„æœ‰ç¼–å·ï¼Œç¼–å·ä» 1 å¼€å§‹ï¼Œ å¯¹äºæ¯ä¸€è¡Œï¼ŒNTILE è¿”å›æ­¤è¡Œæ‰€å±çš„ç»„çš„ç¼–å·ã€‚æ³¨æ„ï¼šn å¿…é¡»ä¸º int ç±»å‹ã€‚ 12345678910111213141516# æ•°æ®å‡†å¤‡name,orderdate,costjack,2017-01-01,10tony,2017-01-02,15jack,2017-02-03,23tony,2017-01-04,29jack,2017-01-05,46jack,2017-04-06,42tony,2017-01-07,50jack,2017-01-08,55mart,2017-04-08,62mart,2017-04-09,68neil,2017-05-10,12mart,2017-04-11,75neil,2017-06-12,80mart,2017-04-13,94 1234567891011121314151617181920212223242526272829303132333435363738394041# åˆ›å»ºæœ¬åœ° business.txtï¼Œå¯¼å…¥æ•°æ®vi business.txt# åˆ›å»º hive è¡¨å¹¶å¯¼å…¥æ•°æ®create table business( name string, orderdate string,cost int) ROW FORMAT DELIMITED FIELDS TERMINATED BY ',';load data local inpath \"/opt/module/datas/business.txt\" into table business;# æŸ¥è¯¢åœ¨ 2017 å¹´ 4 æœˆä»½è´­ä¹°è¿‡çš„é¡¾å®¢åŠæ€»äººæ•°select name,count(*) over() # group by ç»Ÿè®¡æ¯ä¸€æ¬¡æ¡ä»¶ä¸‹çš„æ•°æ®ï¼›over() å¼€çª—æŠŠæ•´ä¸ªæ•°æ®å³å¼€ç»™ä½ ç”¨from businesswhere substring(orderdate,1,7) = '2017-04'group by name;# æŸ¥è¯¢é¡¾å®¢çš„è´­ä¹°æ˜ç»†åŠæœˆè´­ä¹°æ€»é¢select name,orderdate,cost,sum(cost) over(partition by month(orderdate)) from business;# ä¸Šè¿°çš„åœºæ™¯,è¦å°† cost æŒ‰ç…§æ—¥æœŸè¿›è¡Œç´¯åŠ select name,orderdate,cost,sum(cost) over() as sample1,-- æ‰€æœ‰è¡Œç›¸åŠ sum(cost) over(partition by name) as sample2,-- æŒ‰ name åˆ†ç»„ï¼Œç»„å†…æ•°æ®ç›¸åŠ sum(cost) over(partition by name order by orderdate) as sample3,-- æŒ‰ name åˆ†ç»„ï¼Œç»„å†…æ•°æ®ç´¯åŠ sum(cost) over(partition by name order by orderdate rows between UNBOUNDED PRECEDINGand current row ) as sample4 ,-- å’Œ sample3 ä¸€æ ·,ç”±èµ·ç‚¹åˆ°å½“å‰è¡Œçš„èšåˆsum(cost) over(partition by name order by orderdate rows between 1 PRECEDING and currentrow) as sample5, -- å½“å‰è¡Œå’Œå‰é¢ä¸€è¡Œåšèšåˆsum(cost) over(partition by name order by orderdate rows between 1 PRECEDING AND 1FOLLOWING ) as sample6,-- å½“å‰è¡Œå’Œå‰è¾¹ä¸€è¡ŒåŠåé¢ä¸€è¡Œsum(cost) over(partition by name order by orderdate rows between current row andUNBOUNDED FOLLOWING ) as sample7 -- å½“å‰è¡ŒåŠåé¢æ‰€æœ‰è¡Œfrom business;# æŸ¥çœ‹é¡¾å®¢ä¸Šæ¬¡çš„è´­ä¹°æ—¶é—´select name,orderdate,cost,lag(orderdate,1,'1900-01-01') over(partition by name order by orderdate ) as time1,lag(orderdate,2) over (partition by name order by orderdate) as time2from business;# æŸ¥è¯¢å‰ 20% æ—¶é—´çš„è®¢å•ä¿¡æ¯select * from (select name,orderdate,cost, ntile(5) over(order by orderdate) sorted from business) twhere sorted = 1; Rank RANK() æ’åºç›¸åŒæ—¶ä¼šé‡å¤ï¼Œæ€»æ•°ä¸ä¼šå˜ï¼›DENSE_RANK()æ’åºç›¸åŒæ—¶ä¼šé‡å¤ï¼Œæ€»æ•°ä¼šå‡å°‘ï¼›ROW_NUMBER() ä¼šæ ¹æ®é¡ºåºè®¡ç®—ã€‚ 12345678910111213select name, subject, score,rank() over(partition by subject order by score desc) rp,dense_rank() over(partition by subject order by score desc) drp,row_number() over(partition by subject order by score desc) rmpfrom score;# ç»“æœname subject score rp drp rmpå®‹å®‹ è‹±è¯­ 84 1 1 1å¤§æµ· è‹±è¯­ 84 1 1 2å©·å©· è‹±è¯­ 78 3 2 3 å‡½æ•°123456# æŸ¥çœ‹ç³»ç»Ÿè‡ªå¸¦çš„å‡½æ•°hive&gt; show functions;# æ˜¾ç¤ºè‡ªå¸¦çš„å‡½æ•°çš„ç”¨æ³•hive&gt; desc function upper;# è¯¦ç»†æ˜¾ç¤ºè‡ªå¸¦çš„å‡½æ•°çš„ç”¨æ³•hive&gt; desc function extended upper; è‡ªå®šä¹‰å‡½æ•°å®˜æ–¹æ–‡æ¡£åœ°å€","categories":[{"name":"Big Data","slug":"Big-Data","permalink":"http://yoursite.com/categories/Big-Data/"}],"tags":[{"name":"Hive","slug":"Hive","permalink":"http://yoursite.com/tags/Hive/"}]},{"title":"Linux åŸºç¡€","slug":"Software/Linux åŸºç¡€","date":"2020-04-26T01:15:17.000Z","updated":"2020-04-26T01:48:57.042Z","comments":true,"path":"2020/04/26/Software/Linux åŸºç¡€/","link":"","permalink":"http://yoursite.com/2020/04/26/Software/Linux%20%E5%9F%BA%E7%A1%80/","excerpt":"æ±‡æ€» Linux ä¸­å¸¸ç”¨çš„æ“ä½œå‘½ä»¤ã€‚","text":"æ±‡æ€» Linux ä¸­å¸¸ç”¨çš„æ“ä½œå‘½ä»¤ã€‚ ç³»ç»Ÿå®‰è£… å®‰è£…VMware ğŸ‘‰ æ–°å»ºè™šæ‹Ÿæœº ğŸ‘‰ å®‰è£…Linux ğŸ‘‰ åˆæ­¥é…ç½® ğŸ‘‰ å…‹éš† ğŸ‘‰ å®Œå–„é…ç½® æ–°å»ºè™šæ‹Ÿæœº è‡ªå®šä¹‰ç±»å‹é…ç½® ğŸ‘‰ ç¨åå®‰è£…æ“ä½œç³»ç»Ÿ ğŸ‘‰ å®¢æˆ·æœºæ“ä½œç³»ç»Ÿï¼šLinuxï¼ˆç‰ˆæœ¬ï¼šCentOS 64ä½ï¼‰ ğŸ‘‰ ä½¿ç”¨ç½‘ç»œåœ°å€è½¬æ¢ï¼ˆNATï¼‰ğŸ‘‰ å°†è™šæ‹Ÿç£ç›˜æ‹†åˆ†æˆå¤šä¸ªæ–‡ä»¶ å®‰è£… Linuxé€‰ä¸­æ–°å»ºè™šæ‹Ÿæœºä½¿ç”¨ IOS æ˜ åƒæ–‡ä»¶ ğŸ‘‰ Create Custom Layout ğŸ‘‰ Add Partition ğŸ‘‰ /boot â€“ ext4 â€“ 200 â€“ Fixed sizenullï¼ˆä¾›ç³»ç»Ÿä½¿ç”¨ï¼‰ â€“ swap â€“ 2048 â€“ Fixed size/ â€“ ext4 â€“ 200 â€“ Fill to maximum allowable size Install boot loader on /dev/sad. ğŸ‘‰ Boot loader operating system list ğŸ‘‰ CentOS /dev/sda3 åˆæ­¥é…ç½®è®¾ç½®IPï¼šVMï¼šç¼–è¾‘ -&gt; è™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨ å­ç½‘å­ç½‘æ©ç NATè®¾ç½®ç½‘å…³ vi /etc/sysconfig/network-scripts/ifcfg-eth0 1234567# åˆ é™¤ UUID å’Œ MAC åœ°å€ONBOOT=yesBOOTPROTO=staticIPADDR=NETMASK=GATEWAY=DNS1=114.114.114.114 rm -fr /etc/udev/rules.d/70-persistent-net.rules æ¥å£ä¸ç¡¬ä»¶åœ°å€å…³è”è§„åˆ™ï¼Œä¸åˆ é™¤å…‹éš†å enth0 æ¥å£å¤±æ•ˆã€‚ VMï¼šé»˜è®¤ç»´æŠ¤æ¯ä¸€å°è™šæ‹Ÿæœºçš„ MAC åœ°å€ï¼Œäº’ä¸é‡å¤ å…³é—­é˜²ç«å¢™ &amp; Selinux 1234service iptables stopchkconfig iptables offvi /etc/selinux/config # SELINUX=disabled å…³æœº ğŸ‘‰ æ‹æ‘„å¿«ç…§ï¼ï¼ï¼ å…‹éš†è™šæ‹Ÿæœºå‡†å¤‡å››å°è™šæ‹Ÿæœº ğŸ‘‰ é…ç½®IP ğŸ‘‰ é…ç½®ä¸»æœºå 12vi /etc/sysconfig/network # HOSTNAME= é…ç½® hosts Linuxï¼švi /etc/hostsWindowï¼š/windows/system32/drivers/etc/hosts å…³æœº ğŸ‘‰ æ‹æ‘„å¿«ç…§ï¼ˆå…‹éš†ï¼‰ ç³»ç»Ÿç›®å½• /bootï¼šç³»ç»Ÿå¯åŠ¨ç›¸å…³æ–‡ä»¶ /devï¼šè®¾å¤‡æ–‡ä»¶ /etcï¼šé…ç½® /homeï¼šç”¨æˆ·çš„å®¶ç›®å½• /rootï¼šç®¡ç†å‘˜å®¶ç›®å½• /libï¼šåº“æ–‡ä»¶ /optï¼šè‡ªå®šä¹‰ç¨‹åºå®‰è£…ç›®å½• /binï¼šå¯æ‰§è¡Œæ–‡ä»¶ï¼ˆç”¨æˆ·å‘½ä»¤ï¼‰ /sbinï¼šç®¡ç†å‘½ä»¤ ç”¨æˆ·ç®¡ç†12345678910111213groupaddgroupdeluseradduserdelusermodidpasswdsudosu# æƒé™chmodchownugo -&gt; rwx -&gt; 111/000 -&gt; 7/0 exampleï¼ˆåˆ›å»ºæŒ‡å®šç”¨æˆ·çš„æ•°æ®å…±äº«åŒºåŸŸï¼‰ 1234567891011121314151617181920# åˆ›å»ºç”¨æˆ·useradd user01passwd user01useradd user02passwd user02# åˆ›å»ºå…±äº«ç›®å½•mkdir /var/swapdata# ä¿®æ­£æƒé™chmod 770 swapdata == chmod o-rwx g+rwx swapdata# ä¿®æ­£æ‰€å±ç»„groupadd swapareausermod -a -G swaparea user01usermod -a -G swaparea user02chown root:swaparea swapdata# ä¿®æ­£æ–‡ä»¶æƒé™chown root:swaparea share.filechmod 770 share.file# æŸ¥çœ‹ç”¨æˆ·å…ƒç´ æ®id user01id user02 è½¯ä»¶å®‰è£…12345yum clean allyum makecacheyum search man-pagesyum install man man-pages man-pages-zh-CNman bash(é‡ç‚¹å­¦ä¹ ) å¸¸ç”¨å‘½ä»¤123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566# shell bashtypeï¼šå‘½ä»¤ç±»å‹ å†…éƒ¨å‘½ä»¤ å¤–éƒ¨å‘½ä»¤helpï¼šå†…éƒ¨å‘½ä»¤å¸®åŠ©manï¼šå¸®åŠ©æ‰‹å†Œyum install man man-pages -ywhereisï¼šå®šä½å‘½ä»¤ä½ç½®fileï¼šæ–‡ä»¶ç±»å‹echoï¼šæ‰“å°åˆ°æ ‡å‡†è¾“å‡º $PATHï¼šç¯å¢ƒå˜é‡ï¼šè·¯å¾„ $LANG echo $$ï¼šå½“å‰shellçš„PIDhash -rï¼šæ¸…é™¤ç¼“å­˜# æ–‡ä»¶ç³»ç»Ÿå‘½ä»¤ls -l æ–‡ä»¶ç±»å‹ -ï¼šæ™®é€šæ–‡ä»¶ dï¼šç›®å½•æ–‡ä»¶ bï¼šå—è®¾å¤‡æ–‡ä»¶ cï¼šå­—ç¬¦è®¾å¤‡æ–‡ä»¶ lï¼šç¬¦å·é“¾æ¥æ–‡ä»¶ pï¼šå‘½ä»¤ç®¡é“æ–‡ä»¶ sï¼šå¥—æ¥å­—æ–‡ä»¶# æ–‡ä»¶æƒé™ï¼šä¸‰ä½ä¸€ç»„ï¼ˆrwxï¼‰ Uï¼ˆUSerï¼‰ Gï¼ˆGroupï¼‰ Oï¼ˆOtherï¼‰# æ–‡ä»¶ç¡¬é“¾æ¥æ¬¡æ•°ï¼ˆè½¯è¿æ¥å¯¹æ¯”ï¼‰ownergroupsizetimestamp accsee modify changedfï¼šæ˜¾ç¤ºç£ç›˜ä½¿ç”¨æƒ…å†µ -hduï¼šæ˜¾ç¤ºæ–‡ä»¶ç³»ç»Ÿä½¿ç”¨æƒ…å†µlsï¼šæ˜¾ç¤ºç›®å½•cdï¼šåˆ‡æ¢å·¥ä½œç›®å½•pwdï¼šæ˜¾ç¤ºå½“å‰å·¥ä½œç›®å½•mkdirï¼šåˆ›å»ºç›®å½• mkdir -p ./a/b/c mkdir a/&#123;1,2,3&#125;dirrmï¼šåˆ é™¤ rm -f rm -rfcpï¼šæ‹·è´ cp -r ./a ./new cp -lmvï¼šç§»åŠ¨lnï¼šé“¾æ¥ -sï¼ˆè½¯è¿æ¥ï¼‰statï¼šå…ƒæ•°æ®touch# æ–‡æœ¬æ“ä½œcat more less head -num tail -num| cat b.txt | head -3 å·¦è¾¹è¾“å‡ºä¸ºå³è¾¹çš„è¾“å…¥ æ–‡æœ¬å¤„ç†1234567891011121314151617181920212223242526cutï¼šæ˜¾ç¤ºåˆ‡å‰²çš„è¡Œæ•°æ® fï¼šé€‰æ‹©æ˜¾ç¤ºçš„åˆ— sï¼šä¸æ˜¾ç¤ºæ²¡æœ‰åˆ†éš”ç¬¦çš„è¡Œ dï¼šè‡ªå®šä¹‰åˆ†éš”ç¬¦sortï¼šæ’åºæ–‡ä»¶çš„è¡Œ nï¼šæŒ‰æ•°å€¼æ’åº rï¼šå€’åº tï¼šè‡ªå®šä¹‰åˆ†éš”ç¬¦ kï¼šé€‰æ‹©æ’åºåˆ— uï¼šåˆå¹¶ç›¸åŒè¡Œ fï¼šå¿½ç•¥å¤§å°å†™sedï¼šè¡Œç¼–è¾‘å™¨sed [options] '' filename options nï¼šé™é»˜æ¨¡å¼ iï¼šç›´æ¥ä¿®æ”¹åŸæ–‡ä»¶ 'Command' dï¼šåˆ é™¤ç¬¦åˆæ¡ä»¶çš„è¡Œ pï¼šæ˜¾ç¤ºç¬¦åˆæ¡ä»¶çš„è¡Œ a\\stringï¼šæŒ‡å®šè¡Œåæ·»åŠ æ–°è¡Œ i\\stringï¼šæŒ‡å®šè¡Œå‰æ·»åŠ æ–°è¡Œ s/pattern/string/ï¼šæŸ¥æ‰¾å¹¶æ›¿æ¢ \\(\\),\\(\\)--&gt;\\1,\\2awkï¼šå¼ºå¤§çš„æ–‡æœ¬åˆ†æå·¥å…· å°†æ–‡ä»¶é€è¡Œè¯»å…¥ï¼Œç”¨é»˜è®¤åˆ†éš”ç¬¦å°†æ¯è¡Œåˆ‡ç‰‡ï¼Œåˆ‡å¼€éƒ¨åˆ†å†è¿›è¡Œå„ç§åˆ†æå¤„ç† awk -F'' '&#123;pattern+action&#125;' filename æ­£åˆ™è¡¨è¾¾å¼1234567891011121314151617181920grepï¼šæ˜¾ç¤ºåŒ¹é…è¡Œ vï¼šåæ˜¾ç¤º eï¼šä½¿ç”¨æ‰©å±•æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æ“ä½œç¬¦ \\ï¼šè½¬ä¹‰å­—ç¬¦ .ï¼šåŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦ [0-9],[a-z]ï¼šå­—ç¬¦åºåˆ—å•å­—ç¬¦å ä½ ^ï¼šè¡Œé¦– $ï¼šè¡Œå°¾ &lt;,&gt;ï¼šå•è¯é¦–å°¾è¾¹ç•Œ |ï¼šè¿æ¥æ“ä½œç¬¦ (,)ï¼šé€‰æ‹©æ“ä½œç¬¦ \\nï¼šåå‘å¼•ç”¨é‡å¤æ“ä½œç¬¦ ?ï¼šåŒ¹é…0-1æ¬¡ *ï¼š0-å¤šæ¬¡ +ï¼š1-å¤šæ¬¡ &#123;n&#125;ï¼šnæ¬¡ &#123;n,&#125;ï¼šn-å¤šæ¬¡ &#123;n,m&#125;ï¼šn-mæ¬¡ VI12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152# æ‰“å¼€æ–‡ä»¶ vi /path :num :/PATTERN# å…³é—­æ–‡ä»¶ :q :wq :q! :w :w! :x == :wq zz# ç¼–è¾‘ iï¼šåœ¨å­—ç¬¦å‰è½¬ä¸ºè¾“å…¥æ¨¡å¼ aï¼šåœ¨å­—ç¬¦åè½¬ä¸ºè¾“å…¥æ¨¡å¼ oï¼šåœ¨ä¸‹ä¸€è¡Œè½¬ä¸ºè¾“å…¥æ¨¡å¼ Oï¼šåœ¨ä¸Šä¸€è¡Œè½¬ä¸ºè¾“å…¥æ¨¡å¼ lï¼šåœ¨è¡Œé¦–è½¬ä¸ºè¾“å…¥æ¨¡å¼ Aï¼šåœ¨è¡Œå°¾è½¬ä¸ºè¾“å…¥æ¨¡å¼# å•è¯ wï¼šåˆ°ä¸‹ä¸€ä¸ªå•è¯çš„è¯é¦– eï¼šåˆ°å½“å‰æˆ–ä¸‹ä¸€å•è¯è¯å°¾# è¡Œå†… 0ï¼šç»å¯¹è¡Œé¦– ^ï¼šè¡Œé¦–çš„ç¬¬ä¸€ä¸ªéç©ºç™½å­—ç¬¦ $ï¼šç»å¯¹è¡Œå°¾# è¡Œé—´ Gï¼šæ–‡ç« æœ«å°¾ 3Gï¼šç¬¬ä¸‰è¡Œ ggï¼šæ–‡ç« å¼€å¤´# ç¿»å± ctrlï¼šf,b# å•ä¸ªå­—ç¬¦ xï¼šåˆ é™¤å…‰æ ‡ä½ç½®å­—ç¬¦ 3xï¼šåˆ é™¤å…‰æ ‡å¼€å§‹ç¬¬ä¸‰ä¸ªå­—ç¬¦ rï¼šæ›¿æ¢å…‰æ ‡ä½ç½®å­—ç¬¦å¤åˆ¶ï¼šyw,yyç²˜è´´ï¼šp,Pæ’¤é”€ï¼šué‡åšæ’¤é”€ï¼šctrl+ré‡å¤ä¸Šä¸€æ­¥æ“ä½œï¼š.# è®¾ç½® set number set nonumber set readonly# æŸ¥æ‰¾ï¼š /PATTERNï¼ˆå‘ä¸‹ï¼‰,N ?PATTERNï¼ˆå‘ä¸Šï¼‰,n# æŸ¥æ‰¾å¹¶æ›¿æ¢ s/str1/str2/gi gï¼šä¸€è¡Œå†…å…¨éƒ¨æ›¿æ¢ iï¼šå¿½ç•¥å¤§å°å†™","categories":[{"name":"OS","slug":"OS","permalink":"http://yoursite.com/categories/OS/"}],"tags":[{"name":"Linux","slug":"Linux","permalink":"http://yoursite.com/tags/Linux/"}]},{"title":"Hadoop å…¥é—¨","slug":"BigData/Hadoop å…¥é—¨","date":"2020-04-25T02:09:27.000Z","updated":"2020-04-30T03:47:35.260Z","comments":true,"path":"2020/04/25/BigData/Hadoop å…¥é—¨/","link":"","permalink":"http://yoursite.com/2020/04/25/BigData/Hadoop%20%E5%85%A5%E9%97%A8/","excerpt":"å¤§æ•°æ®æŠ€æœ¯ Hadoop çš„æ•´ä½“å…¥é—¨ä»‹ç»ã€‚","text":"å¤§æ•°æ®æŠ€æœ¯ Hadoop çš„æ•´ä½“å…¥é—¨ä»‹ç»ã€‚ åŸºæœ¬æ¦‚å¿µ ä¸»è¦è§£å†³ï¼šæµ·é‡æ•°æ®çš„å­˜å‚¨å’Œæµ·é‡æ•°æ®çš„åˆ†æè®¡ç®—é—®é¢˜ã€‚ ä¸€èˆ¬å½¢å¼çš„å¤§æ•°æ®éƒ¨é—¨ç»„æˆç»“æ„ã€‚ Hadoop ä¸‰å¤§å‘è¡Œç‰ˆæœ¬ï¼š Apache ç‰ˆæœ¬æœ€åŸå§‹ï¼ˆæœ€åŸºç¡€ï¼‰çš„ç‰ˆæœ¬ï¼Œå¯¹äºå…¥é—¨å­¦ä¹ æœ€å¥½ï¼›Cloudera åœ¨å¤§å‹äº’è”ç½‘ä¼ä¸šä¸­ç”¨çš„è¾ƒå¤šï¼›Hortonworks æ–‡æ¡£è¾ƒå¥½ã€‚ Hadoop ä¼˜åŠ¿ï¼š é«˜å¯é æ€§ï¼šHadoop åº•å±‚ç»´æŠ¤å¤šä¸ªæ•°æ®å‰¯æœ¬ï¼Œæ‰€ä»¥å³ä½¿ Hadoop æŸä¸ªè®¡ç®—å…ƒç´ æˆ–å­˜å‚¨å‡ºç°æ•…éšœï¼Œä¹Ÿä¸ä¼šå¯¼è‡´æ•°æ®çš„ä¸¢å¤±ï¼›é«˜æ‰©å±•æ€§ï¼šåœ¨é›†ç¾¤é—´åˆ†é…ä»¼åŠ¡æ•°æ®ï¼Œå¯æ–¹ä¾¿çš„æ‰©å±•æ•°ä»¥å¹²è®¡çš„èŠ‚ç‚¹ï¼›é«˜æ•ˆæ€§ï¼šåœ¨ MapReduce çš„æ€æƒ³ä¸‹,ï¼ŒHadoop æ˜¯å¹¶è¡Œå·¥ä½œçš„ï¼Œä»¥åŠ å¿«ä»»åŠ¡å¤„ç†é€Ÿåº¦ï¼›é«˜å®¹é”™æ€§ï¼šèƒ½å¤Ÿè‡ªåŠ¨å°†å¤±è´¥çš„ä»»åŠ¡é‡æ–°åˆ†é…ã€‚ 1.x VS 2.x HDFSNameNodeï¼ˆnnï¼‰ï¼šå­˜å‚¨æ–‡ä»¶çš„å…ƒæ•°æ®ï¼Œå¦‚æ–‡ä»¶åã€æ–‡ä»¶ç›®å½•ç»“æ„ã€æ–‡ä»¶å±æ€§ï¼ˆç”Ÿæˆæ—¶é—´ã€å‰¯æœ¬æ•°æ–‡ä»¶æƒé™ï¼‰ï¼Œä»¥åŠæ¯ä¸ªæ–‡ä»¶çš„å—åˆ—è¡¨å’Œå—æ‰€åœ¨çš„ DataNode ç­‰ï¼› DataNodeï¼ˆdnï¼‰ï¼šåœ¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿå­˜å‚¨æ–‡ä»¶å—æ•°æ®,ä»¥åŠå—æ•°æ®çš„æ ¡éªŒå’Œã€‚ Secondary NameNodeï¼ˆ2nnï¼‰ï¼šç”¨æ¥ç›‘æ§ HDFS çŠ¶æ€çš„è¾…åŠ©åå°ç¨‹åºï¼Œæ¯éš”ä¸€æ®µæ—¶é—´è·å– HDFS å…ƒæ•°æ®çš„å¿«ç…§ã€‚ YARN ResourceManager ç”±ä¸¤ä¸ªå…³é”®ç»„ä»¶ Scheduler å’Œ ApplicationsManager ç»„æˆã€‚ Scheduler åœ¨å®¹é‡å’Œé˜Ÿåˆ—é™åˆ¶èŒƒå›´å†…è´Ÿè´£ä¸ºè¿è¡Œçš„å®¹å™¨åˆ†é…èµ„æºã€‚Scheduler æ˜¯ä¸€ä¸ªçº¯è°ƒåº¦å™¨ï¼ˆpure schedulerï¼‰ï¼Œåªè´Ÿè´£è°ƒåº¦ï¼Œå®ƒä¸ä¼šç›‘è§†æˆ–è·Ÿè¸ªåº”ç”¨ç¨‹åºçš„çŠ¶æ€ï¼Œä¹Ÿä¸è´Ÿè´£é‡å¯å¤±è´¥ä»»åŠ¡ï¼Œè¿™äº›å…¨éƒ½äº¤ç»™ ApplicationMaster å®Œæˆã€‚Scheduler æ ¹æ®å„ä¸ªåº”ç”¨ç¨‹åºçš„èµ„æºéœ€æ±‚è¿›è¡Œèµ„æºåˆ†é…ã€‚ ApplicationManager è´Ÿè´£æ¥æ”¶ä½œä¸šçš„æäº¤ï¼Œç„¶åå¯åŠ¨ä¸€ä¸ª ApplicationMaster å®¹å™¨è´Ÿè´£è¯¥åº”ç”¨ã€‚å®ƒä¹Ÿä¼šåœ¨ApplicationMaster å®¹å™¨å¤±è´¥æ—¶ï¼Œé‡æ–°å¯åŠ¨ ApplicationMaster å®¹å™¨ã€‚ Hadoop 2.X é›†ç¾¤ä¸­çš„æ¯ä¸ª DataNode éƒ½ä¼šè¿è¡Œä¸€ä¸ªNodeManager æ¥æ‰§è¡Œ Yarn çš„åŠŸèƒ½ã€‚æ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„ NodeManager æ‰§è¡Œä»¥ä¸‹åŠŸèƒ½ï¼š å®šæ—¶å‘ ResourceManager æ±‡æŠ¥æœ¬èŠ‚ç‚¹èµ„æºä½¿ç”¨æƒ…å†µå’Œå„ä¸ª Container çš„è¿è¡ŒçŠ¶å†µ ç›‘ç£åº”ç”¨ç¨‹åºå®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸ ï¼ˆç›‘æ§èµ„æºï¼‰ç›‘æ§ã€ç®¡ç†å’Œæä¾›å®¹å™¨æ¶ˆè€—çš„æœ‰å…³èµ„æºï¼ˆCPU / å†…å­˜ï¼‰çš„ä¿¡æ¯ ï¼ˆç›‘æ§èµ„æºä½¿ç”¨æƒ…å†µï¼‰ ï¼ˆç›‘æ§å®¹å™¨ï¼‰ç›‘æ§å®¹å™¨çš„èµ„æºä½¿ç”¨æƒ…å†µï¼Œæ€æ­»å¤±å»æ§åˆ¶çš„ç¨‹åº ï¼ˆå¯åŠ¨/åœæ­¢å®¹å™¨ï¼‰æ¥å—å¹¶å¤„ç†æ¥è‡ª ApplicationMaster çš„ Container å¯åŠ¨/åœæ­¢ç­‰å„ç§è¯·æ±‚ã€‚ æäº¤åˆ° YARN ä¸Šçš„æ¯ä¸€ä¸ªåº”ç”¨éƒ½æœ‰ä¸€ä¸ªä¸“ç”¨çš„ ApplicationMasterï¼ˆæ³¨æ„ï¼ŒApplicationMaster éœ€è¦å’Œ ApplicationManager åŒºåˆ†ï¼‰ã€‚ApplicationMaster è¿è¡Œåœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶çš„ç¬¬ä¸€ä¸ªå®¹å™¨å†…ã€‚ApplicationMaster ä¼šä¸ ResourceManager åå•†è·å–å®¹å™¨æ¥æ‰§è¡Œåº”ç”¨ä¸­çš„ mappers å’Œ reducersï¼Œä¹‹åä¼šå°† ResourceManager åˆ†é…çš„å®¹å™¨èµ„æºå‘ˆç°ç»™è¿è¡Œåœ¨æ¯ä¸ª DataNode ä¸Šçš„ NodeManagerã€‚ApplicationMaster è¯·æ±‚çš„èµ„æºæ˜¯å…·ä½“çš„ã€‚åŒ…æ‹¬ï¼š å¤„ç†ä½œä¸šéœ€è¦çš„æ–‡ä»¶å— ä¸ºåº”ç”¨ç¨‹åºåˆ›å»ºçš„ä»¥å®¹å™¨ä¸ºå•ä½çš„èµ„æº å®¹å™¨å¤§å°ï¼ˆä¾‹å¦‚ï¼Œ1GB å†…å­˜å’Œä¸€ä¸ªè™šæ‹Ÿæ ¸å¿ƒï¼‰ èµ„æºåœ¨ä½•å¤„åˆ†é…ï¼Œè¿™ä¸ªä¾æ®ä» NameNode è·å–çš„å—å­˜å‚¨ä½ç½®ä¿¡æ¯ï¼ˆå¦‚æœºå™¨1çš„èŠ‚ç‚¹10ä¸Šåˆ†é…4ä¸ªå®¹å™¨ï¼Œæœºå™¨2çš„èŠ‚ç‚¹20ä¸Šåˆ†é…8ä¸ªå®¹å™¨ï¼‰ èµ„æºè¯·æ±‚çš„ä¼˜å…ˆçº§ ApplicationMaster æ˜¯ä¸€ä¸ªç‰¹å®šçš„æ¡†æ¶ã€‚ä¾‹å¦‚ï¼ŒMapReduce ç¨‹åºæ˜¯ MRAppMasterï¼Œspark æ˜¯ SparkAppMasterã€‚ Container æ˜¯å¯¹äºèµ„æºçš„æŠ½è±¡, å®ƒå°è£…äº†æŸä¸ªèŠ‚ç‚¹ä¸Šçš„å¤šç»´åº¦èµ„æºï¼Œå¦‚å†…å­˜ã€CPU ç­‰ã€‚ MapReduce Map é˜¶æ®µå¹¶è¡Œå¤„ç†è¾“å…¥æ•°æ®ï¼› Reduce é˜¶æ®µå¯¹ Map ç»“æœè¿›è¡Œæ±‡æ€»ã€‚ ç”Ÿæ€ä½“ç³» Sqoop æ˜¯ä¸€æ¬¾å¼€æºçš„å·¥å…·ï¼Œä¸»è¦ç”¨äºåœ¨ Hadoopã€Hive ä¸ä¼ ç»Ÿçš„æ•°æ®åº“ï¼ˆMySqlï¼‰é—´è¿›è¡Œæ•°æ®çš„ä¼ é€’ï¼Œå¯ä»¥å°†ä¸€ä¸ªå…³ç³»å‹æ•°æ®åº“ï¼ˆä¾‹å¦‚ ï¼šMySQLï¼ŒOracle ç­‰ï¼‰ä¸­çš„æ•°æ®å¯¼è¿›åˆ° Hadoop çš„ HDFS ä¸­ï¼Œä¹Ÿå¯ä»¥å°† HDFS çš„æ•°æ®å¯¼è¿›åˆ°å…³ç³»å‹æ•°æ®åº“ä¸­ã€‚ Kafka æ˜¯ä¸€ç§é«˜ååé‡çš„åˆ†å¸ƒå¼å‘å¸ƒè®¢é˜…æ¶ˆæ¯ç³»ç»Ÿã€‚ Storm ç”¨äºè¿ç»­è®¡ç®—ï¼Œå¯¹æ•°æ®æµåšè¿ç»­æŸ¥è¯¢ï¼Œåœ¨è®¡ç®—æ—¶å°±å°†ç»“æœä»¥æµçš„å½¢å¼è¾“å‡ºç»™ç”¨æˆ·ã€‚ Spark æ˜¯å½“å‰æœ€æµè¡Œçš„å¼€æºå¤§æ•°æ®å†…å­˜è®¡ç®—æ¡†æ¶ã€‚å¯ä»¥åŸºäº Hadoop ä¸Šå­˜å‚¨çš„å¤§æ•°æ®è¿›è¡Œè®¡ç®—ã€‚ Oozie æ˜¯ä¸€ä¸ªç®¡ç† Hdoop ä½œä¸šï¼ˆjobï¼‰çš„å·¥ä½œæµç¨‹è°ƒåº¦ç®¡ç†ç³»ç»Ÿã€‚ HBase æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„ã€é¢å‘åˆ—çš„å¼€æºæ•°æ®åº“ã€‚HBase ä¸åŒäºä¸€èˆ¬çš„å…³ç³»æ•°æ®åº“ï¼Œå®ƒæ˜¯ä¸€ä¸ªé€‚åˆäºéç»“æ„åŒ–æ•°æ®å­˜å‚¨çš„æ•°æ®åº“ã€‚ Hive æ˜¯åŸºäº Hadoop çš„ä¸€ä¸ªæ•°æ®ä»“åº“å·¥å…·ï¼Œå¯ä»¥å°†ç»“æ„åŒ–çš„æ•°æ®æ–‡ä»¶æ˜ å°„ä¸ºä¸€å¼ æ•°æ®åº“è¡¨ï¼Œå¹¶æä¾›ç®€å•çš„ SQL æŸ¥è¯¢åŠŸèƒ½ï¼Œå¯ä»¥å°† SQL è¯­å¥è½¬æ¢ä¸º MapReduce ä»»åŠ¡è¿›è¡Œè¿è¡Œã€‚ å…¶ä¼˜ç‚¹æ˜¯å­¦ä¹ æˆæœ¬ä½ï¼Œå¯ä»¥é€šè¿‡ç±» SQL è¯­å¥å¿«é€Ÿå®ç°ç®€å•çš„ MapReduce ç»Ÿè®¡ï¼Œä¸å¿…å¼€å‘ä¸“é—¨çš„ MapReduce åº”ç”¨ï¼Œååˆ†é€‚åˆæ•°æ®ä»“åº“çš„ç»Ÿè®¡åˆ†æã€‚ R è¯­è¨€æ˜¯ç”¨äºç»Ÿè®¡åˆ†æã€ç»˜å›¾çš„è¯­è¨€å’Œæ“ä½œç¯å¢ƒã€‚R æ˜¯å±äº GNU ç³»ç»Ÿçš„ä¸€ä¸ªè‡ªç”±ã€å…è´¹ã€æºä»£ç å¼€æ”¾çš„è½¯ä»¶ï¼Œå®ƒæ˜¯ä¸€ä¸ªç”¨äºç»Ÿè®¡è®¡ç®—å’Œç»Ÿè®¡åˆ¶å›¾çš„ä¼˜ç§€å·¥å…·ã€‚ Apache Mahout æ˜¯ä¸ªå¯æ‰©å±•çš„æœºå™¨å­¦ä¹ å’Œæ•°æ®æŒ–æ˜åº“ã€‚ Zookeeper æ˜¯ Google çš„ Chubby ä¸€ä¸ªå¼€æºçš„å®ç°ã€‚å®ƒæ˜¯ä¸€ä¸ªé’ˆå¯¹å¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿçš„å¯é åè°ƒç³»ç»Ÿï¼Œæä¾›çš„åŠŸèƒ½åŒ…æ‹¬ï¼šé…ç½®ç»´æŠ¤ã€åå­—æœåŠ¡ã€ åˆ†å¸ƒå¼åŒæ­¥ã€ç»„æœåŠ¡ç­‰ã€‚ZooKeeper çš„ç›®æ ‡å°±æ˜¯å°è£…å¥½å¤æ‚æ˜“å‡ºé”™çš„å…³é”®æœåŠ¡ï¼Œå°†ç®€å•æ˜“ç”¨çš„æ¥å£å’Œæ€§èƒ½é«˜æ•ˆã€åŠŸèƒ½ç¨³å®šçš„ç³»ç»Ÿæä¾›ç»™ç”¨æˆ·ã€‚ ç¯å¢ƒæ­å»ºè½¯ä»¶å®‰è£…123456789101112131415161718192021222324252627282930313233# åœ¨ /opt ç›®å½•ä¸‹åˆ›å»º moduleã€software æ–‡ä»¶å¤¹mkdir modulemkdir software# ä¿®æ”¹ moduleã€software æ–‡ä»¶å¤¹çš„æ‰€æœ‰è€…chown [group]:[user] module/ software/# å®‰è£… JDK# æ£€æŸ¥æ˜¯å¦å®‰è£… Java è½¯ä»¶rpm -qa | grep javarpm -e [software]# æŸ¥çœ‹ JDK å®‰è£…è·¯å¾„which java# è§£å‹ JDK åˆ° /opt/module ç›®å½•ä¸‹tar -zxvf jdk-8u144-linux-x64.tar.gz -C /opt/module/# é…ç½® JDK ç¯å¢ƒå˜é‡pwd /opt/module/jdk1.8.0_144vi /etc/profile # æ–‡ä»¶æœ«å°¾æ·»åŠ  JDK è·¯å¾„ # export JAVA_HOME=/opt/module/jdk1.8.0_144 # export PATH=$PATH:$JAVA_HOME/bin# é…ç½®ç”Ÿæ•ˆsource /etc/profile# æµ‹è¯•ç¯å¢ƒjava -version# å®‰è£… Hadooptar -zxvf hadoop-2.7.2.tar.gz -C /opt/module/# æ·»åŠ  Hadoop ç¯å¢ƒå˜é‡pwd /opt/module/hadoop-2.7.2vi /etc/profile # export HADOOP_HOME=/opt/module/hadoop-2.7.2 # export PATH=$PATH:$HADOOP_HOME/bin # export PATH=$PATH:$HADOOP_HOME/sbinsource /etc/profilehadoop version Hadoop ç›®å½•ç»“æ„bin ç›®å½•ï¼šå­˜æ”¾å¯¹ Hadoop ç›¸å…³æœåŠ¡ï¼ˆHDFSï¼ŒYARNï¼‰è¿›è¡Œæ“ä½œçš„è„šæœ¬ï¼› etc ç›®å½•ï¼šHadoop çš„é…ç½®æ–‡ä»¶ç›®å½•ï¼Œå­˜æ”¾ Hadoop çš„é…ç½®æ–‡ä»¶ï¼› lib ç›®å½•ï¼šå­˜æ”¾ Hadoop çš„æœ¬åœ°åº“ï¼ˆå¯¹æ•°æ®è¿›è¡Œå‹ç¼©è§£å‹ç¼©åŠŸèƒ½ï¼‰ï¼› sbin ç›®å½•ï¼šå­˜æ”¾å¯åŠ¨æˆ–åœæ­¢ Hadoop ç›¸å…³æœåŠ¡çš„è„šæœ¬ï¼› share ç›®å½•ï¼šå­˜æ”¾ Hadoop çš„ä¾èµ– jar åŒ…ã€æ–‡æ¡£ã€å’Œå®˜æ–¹æ¡ˆä¾‹ã€‚ é…ç½®æ–‡ä»¶è¯´æ˜ Hadoop é…ç½®æ–‡ä»¶åˆ†ä¸¤ç±»ï¼šé»˜è®¤é…ç½®æ–‡ä»¶å’Œè‡ªå®šä¹‰é…ç½®æ–‡ä»¶ï¼Œåªæœ‰ç”¨æˆ·æƒ³ä¿®æ”¹æŸä¸€é»˜è®¤é…ç½®å€¼æ—¶ï¼Œæ‰éœ€è¦ä¿®æ”¹è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ï¼Œæ›´æ”¹ç›¸åº”å±æ€§å€¼ã€‚ è¦è·å–çš„é»˜è®¤æ–‡ä»¶ æ–‡ä»¶å­˜æ”¾åœ¨ Hadoop çš„ jar åŒ…ä¸­çš„ä½ç½® [core-default.xml] hadoop-common-2.7.2.jar/ core-default.xml [hdfs-default.xml] hadoop-hdfs-2.7.2.jar/ hdfs-default.xml [yarn-default.xml] hadoop-yarn-common-2.7.2.jar/ yarn-default.xml [mapred-default.xml] hadoop-mapreduce-client-core-2.7.2.jar/ mapred-default.xml è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ï¼š â€‹ core-site.xmlã€hdfs-site.xmlã€yarn-site.xmlã€mapred-site.xml å››ä¸ªé…ç½®æ–‡ä»¶å­˜æ”¾åœ¨ $HADOOP_HOME/etc/hadoop è¿™ä¸ªè·¯å¾„ä¸Šï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®é¡¹ç›®éœ€æ±‚é‡æ–°è¿›è¡Œä¿®æ”¹é…ç½®ã€‚ è¿è¡Œæ¨¡å¼æœ¬åœ°æ¨¡å¼12345678910# hadoop-2.7.2 ç›®å½•ä¸‹mkdir wcinputcd wcinputtouch wc.input# ç¼–å†™åˆ†ææ–‡æœ¬vi wc.input# hadoop-2.7.2 ç›®å½•ä¸‹æ‰§è¡Œhadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-2.7.2.jar wordcount wcinput wcoutput# æŸ¥çœ‹ç»“æœcat wcoutput/part-r-00000 ä¼ªåˆ†å¸ƒå¼123# é…ç½®é›†ç¾¤# é…ç½® hadoop-env.shï¼Œä¿®æ”¹ JAVA_HOME è·¯å¾„ # export JAVA_HOME=/opt/module/jdk1.8.0_144 12345678910111213&lt;!-- é…ç½® core-site.xml --&gt;&lt;!-- æŒ‡å®š HDFS ä¸­ NameNode çš„åœ°å€ --&gt;&lt;property&gt;&lt;name&gt;fs.defaultFS&lt;/name&gt; &lt;value&gt;hdfs://hadoop101:9000&lt;/value&gt;&lt;/property&gt;&lt;!-- æŒ‡å®š Hadoop è¿è¡Œæ—¶äº§ç”Ÿæ–‡ä»¶çš„å­˜å‚¨ç›®å½• --&gt;&lt;property&gt; &lt;name&gt;hadoop.tmp.dir&lt;/name&gt; &lt;value&gt;/opt/module/hadoop-2.7.2/data/tmp&lt;/value&gt;&lt;/property&gt; 1234567&lt;!-- é…ç½® hdfs-site.xml --&gt;&lt;!-- æŒ‡å®š HDFS å‰¯æœ¬çš„æ•°é‡ --&gt;&lt;property&gt; &lt;name&gt;dfs.replication&lt;/name&gt; &lt;value&gt;1&lt;/value&gt;&lt;/property&gt; 1234567891011# å¯åŠ¨é›†ç¾¤# æ ¼å¼åŒ– NameNodeï¼ˆç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶éœ€è¦æ ¼å¼åŒ–ï¼‰bin/hdfs namenode -format# å¯åŠ¨ NameNodesbin/hadoop-daemon.sh start namenode# å¯åŠ¨ DataNodesbin/hadoop-daemon.sh start datanode# æŸ¥çœ‹é›†ç¾¤æ˜¯å¦å¯åŠ¨æˆåŠŸjps# æŸ¥çœ‹äº§ç”Ÿçš„ Log æ—¥å¿—cd /opt/module/hadoop-2.7.2/logs æ ¼å¼åŒ– NameNode åä¼šäº§ç”Ÿæ–°çš„é›†ç¾¤ idï¼Œå¯¼è‡´ NameNode å’Œ DataNode çš„é›†ç¾¤ id ä¸ä¸€è‡´ï¼Œå¯¼è‡´é›†ç¾¤æ‰¾ä¸åˆ°ä¹‹å‰æ•°æ®ã€‚æ‰€ä»¥ï¼Œæ ¼å¼ NameNode å‰ä¸€å®šè¦å…ˆåˆ é™¤ data æ•°æ®å’Œ log æ—¥å¿—ï¼Œç„¶åæ‰èƒ½æ ¼å¼åŒ– NameNodeã€‚ å¯åŠ¨ YARN12# é…ç½® yarn-env.sh # export JAVA_HOME=/opt/module/jdk1.8.0_144 12345678910111213&lt;!-- é…ç½®yarn-site.xml --&gt;&lt;!-- Reducer è·å–æ•°æ®çš„æ–¹å¼ --&gt;&lt;property&gt; &lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt; &lt;value&gt;mapreduce_shuffle&lt;/value&gt;&lt;/property&gt;&lt;!-- æŒ‡å®š YARN çš„ ResourceManager çš„åœ°å€ --&gt;&lt;property&gt; &lt;name&gt;yarn.resourcemanager.hostname&lt;/name&gt; &lt;value&gt;hadoop101&lt;/value&gt;&lt;/property&gt; 1234# é…ç½® mapred-env.sh # export JAVA_HOME=/opt/module/jdk1.8.0_144# é…ç½® mapred-site.xmlmv mapred-site.xml.template mapred-site.xml 12345&lt;!-- æŒ‡å®š MR è¿è¡Œåœ¨ YARN ä¸Š --&gt;&lt;property&gt; &lt;name&gt;mapreduce.framework.name&lt;/name&gt; &lt;value&gt;yarn&lt;/value&gt;&lt;/property&gt; 1234# å¯åŠ¨é›†ç¾¤ï¼Œå¯åŠ¨å‰å¿…é¡»ä¿è¯ NameNode å’Œ DataNode å·²ç»å¯åŠ¨sbin/yarn-daemon.sh start resourcemanagersbin/yarn-daemon.sh start nodemanager# 8088 ç«¯å£æŸ¥çœ‹ web é¡µé¢ å†å²æœåŠ¡å™¨ ç”¨äºæŸ¥çœ‹ç¨‹åºçš„å†å²è¿è¡Œæƒ…å†µã€‚ 123456789101112&lt;!-- é…ç½® mapred-site.xml --&gt;&lt;!-- å†å²æœåŠ¡å™¨ç«¯åœ°å€ --&gt;&lt;property&gt;&lt;name&gt;mapreduce.jobhistory.address&lt;/name&gt;&lt;value&gt;hadoop101:10020&lt;/value&gt;&lt;/property&gt;&lt;!-- å†å²æœåŠ¡å™¨ web ç«¯åœ°å€ --&gt;&lt;property&gt; &lt;name&gt;mapreduce.jobhistory.webapp.address&lt;/name&gt; &lt;value&gt;hadoop101:19888&lt;/value&gt;&lt;/property&gt; 123# å¯åŠ¨å†å²æœåŠ¡å™¨sbin/mr-jobhistory-daemon.sh start historyserver# 19888 ç«¯å£æŸ¥çœ‹ web é¡µé¢ æ—¥å¿—èšé›† åº”ç”¨è¿è¡Œå®Œæˆä»¥åï¼Œå°†ç¨‹åºè¿è¡Œæ—¥å¿—ä¿¡æ¯ä¸Šä¼ åˆ° HDFS ç³»ç»Ÿä¸Šï¼Œæ–¹ä¾¿çš„æŸ¥çœ‹åˆ°ç¨‹åºè¿è¡Œè¯¦æƒ…å’Œå¼€å‘è°ƒè¯•ã€‚ 12345678910111213&lt;!-- yarn-site.xml --&gt;&lt;!-- å¼€å¯æ—¥å¿—èšé›†åŠŸèƒ½ --&gt;&lt;property&gt;&lt;name&gt;yarn.log-aggregation-enable&lt;/name&gt;&lt;value&gt;true&lt;/value&gt;&lt;/property&gt;&lt;!-- æ—¥å¿—ä¿ç•™æ—¶é—´è®¾ç½®7å¤© --&gt;&lt;property&gt;&lt;name&gt;yarn.log-aggregation.retain-seconds&lt;/name&gt;&lt;value&gt;604800&lt;/value&gt;&lt;/property&gt; 1234567# é‡å¯åæ—¥å¿—èšé›†æ‰ç”Ÿæ•ˆsbin/yarn-daemon.sh stop resourcemanagersbin/yarn-daemon.sh stop nodemanagersbin/mr-jobhistory-daemon.sh stop historyserversbin/yarn-daemon.sh start resourcemanagersbin/yarn-daemon.sh start nodemanagersbin/mr-jobhistory-daemon.sh start historyserver å®Œå…¨åˆ†å¸ƒå¼ ä¸‰å°è™šæ‹Ÿæœºä¹‹é—´çš„ç›¸äº’é€šè®¯ï¼Œåè°ƒå·¥ä½œã€‚ é›†ç¾¤åˆ†å‘ scpï¼ˆsecure copyï¼‰å¯ä»¥å®ç°æœåŠ¡å™¨ä¸æœåŠ¡å™¨ä¹‹é—´çš„æ•°æ®æ‹·è´ã€‚ 1234567# åœ¨ hadoop101 ä¸Šå°† hadoop101 ä¸­ /opt/module ç›®å½•ä¸‹çš„è½¯ä»¶æ‹·è´åˆ° hadoop102 ä¸Š# -r è¡¨ç¤ºé€’å½’ï¼Œå³å…¨éƒ¨éƒ½æ‹·è´è¿‡å»scp -r /opt/module root@hadoop102:/opt/module# å°† hadoop101 ä¸­ /etc/profile æ–‡ä»¶æ‹·è´åˆ° hadoop102 çš„ /etc/profile ä¸Šscp /etc/profile root@hadoop102:/etc/profile# é…ç½®ç”Ÿæ•ˆsource /etc/profile rsync ä¸»è¦ç”¨äºå¤‡ä»½å’Œé•œåƒã€‚å…·æœ‰é€Ÿåº¦å¿«ã€é¿å…å¤åˆ¶ç›¸åŒå†…å®¹å’Œæ”¯æŒç¬¦å·é“¾æ¥çš„ä¼˜ç‚¹ã€‚ rsync å’Œ scp åŒºåˆ«ï¼šç”¨ rsync åšæ–‡ä»¶çš„å¤åˆ¶è¦æ¯” scp çš„é€Ÿåº¦å¿«ï¼Œrsync åªå¯¹å·®å¼‚æ–‡ä»¶åšæ›´æ–°ã€‚scp æ˜¯æŠŠæ‰€æœ‰æ–‡ä»¶éƒ½å¤åˆ¶è¿‡å»ã€‚ é€‰é¡¹ åŠŸèƒ½ -r é€’å½’ -v æ˜¾ç¤ºå¤åˆ¶è¿‡ç¨‹ -l æ‹·è´ç¬¦å·è¿æ¥ 12# æŠŠ hadoop101 æœºå™¨ä¸Šçš„ /opt/software ç›®å½•åŒæ­¥åˆ° hadoop102 æœåŠ¡å™¨çš„ root ç”¨æˆ·ä¸‹çš„ /opt/ ç›®å½•rsync -rvl /opt/software/ root@hadoop102:/opt/software 12345# ç¼–å†™é›†ç¾¤åˆ†å‘è„šæœ¬# /usr/local/bin ç›®å½•ä¸‹çš„è„šæœ¬å…¨å±€å¯ç”¨# /home/wingo/bin è¿™ä¸ªç›®å½•ä¸‹å­˜æ”¾çš„è„šæœ¬ï¼Œwingo ç”¨æˆ·å¯ä»¥åœ¨ç³»ç»Ÿä»»ä½•åœ°æ–¹ç›´æ¥æ‰§è¡Œtouch xsyncvi xsync 12345678910111213141516171819202122232425#!/bin/bash# è·å–è¾“å…¥å‚æ•°ä¸ªæ•°ï¼Œå¦‚æœæ²¡æœ‰å‚æ•°ï¼Œç›´æ¥é€€å‡ºpcount=$#if((pcount==0)); thenecho no args;exit;fi# è·å–æ–‡ä»¶åç§°ï¼Œbasename è·å–è·¯åŠ²æœ€åé‚£ä¸ªåç§°p1=$1fname=`basename $p1`echo fname=$fname# è·å–ä¸Šçº§ç›®å½•åˆ°ç»å¯¹è·¯å¾„pdir=`cd -P $(dirname $p1); pwd`echo pdir=$pdir# è·å–å½“å‰ç”¨æˆ·åç§°user=`whoami`# å¾ªç¯ï¼Œè¿™é‡Œæ ¹æ®éœ€æ±‚ä¿®æ”¹å¾ªç¯for((host=103; host&lt;105; host++)); do echo ------------------- hadoop$host -------------- rsync -rvl $pdir/$fname $user@hadoop$host:$pdirdone é›†ç¾¤é…ç½® å…ˆåœ¨ hadoop102 ä¸­è¿›è¡Œé…ç½®ï¼Œç„¶åå°†é…ç½®åˆ†å‘åˆ°å…¶ä½™çš„èŠ‚ç‚¹ã€‚ hadoop102 hadoop103 hadoop104 HDFS NameNodeã€DataNode DataNode SecondaryNameNodeã€DataNode YARN NodeManager ResourceManagerã€NodeManager NodeManager 12345678910111213&lt;!-- é…ç½® core-site.xml --&gt;&lt;!-- æŒ‡å®š HDFS ä¸­ NameNode çš„åœ°å€ --&gt;&lt;property&gt; &lt;name&gt;fs.defaultFS&lt;/name&gt; &lt;value&gt;hdfs://hadoop102:9000&lt;/value&gt;&lt;/property&gt;&lt;!-- æŒ‡å®š Hadoop è¿è¡Œæ—¶äº§ç”Ÿæ–‡ä»¶çš„å­˜å‚¨ç›®å½• --&gt;&lt;property&gt; &lt;name&gt;hadoop.tmp.dir&lt;/name&gt; &lt;value&gt;/opt/module/hadoop-2.7.2/data/tmp&lt;/value&gt;&lt;/property&gt; 123# é…ç½®é›†ç¾¤# é…ç½® hadoop-env.shï¼Œä¿®æ”¹ JAVA_HOME è·¯å¾„ # export JAVA_HOME=/opt/module/jdk1.8.0_144 12345678910111213&lt;!-- é…ç½® hdfs-site.xml --&gt;&lt;property&gt; &lt;name&gt;dfs.replication&lt;/name&gt; &lt;!-- åˆ†ç‰‡æ•°å¿…é¡»è¦å°äºèŠ‚ç‚¹æ•° --&gt; &lt;value&gt;3&lt;/value&gt;&lt;/property&gt;&lt;!-- æŒ‡å®š Hadoop è¾…åŠ©åç§°èŠ‚ç‚¹ä¸»æœºé…ç½® --&gt;&lt;property&gt; &lt;name&gt;dfs.namenode.secondary.http-address&lt;/name&gt; &lt;value&gt;hadoop104:50090&lt;/value&gt;&lt;/property&gt; 12# é…ç½® yarn-env.sh # export JAVA_HOME=/opt/module/jdk1.8.0_144 12345678910111213&lt;!-- é…ç½®yarn-site.xml --&gt;&lt;!-- Reducer è·å–æ•°æ®çš„æ–¹å¼ --&gt;&lt;property&gt; &lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt; &lt;value&gt;mapreduce_shuffle&lt;/value&gt;&lt;/property&gt;&lt;!-- æŒ‡å®š YARN çš„ ResourceManager çš„åœ°å€ --&gt;&lt;property&gt; &lt;name&gt;yarn.resourcemanager.hostname&lt;/name&gt; &lt;value&gt;hadoop103&lt;/value&gt;&lt;/property&gt; 1234# é…ç½® mapred-env.sh # export JAVA_HOME=/opt/module/jdk1.8.0_144# é…ç½® mapred-site.xmlmv mapred-site.xml.template mapred-site.xml 12345&lt;!-- æŒ‡å®š MR è¿è¡Œåœ¨ YARN ä¸Š --&gt;&lt;property&gt; &lt;name&gt;mapreduce.framework.name&lt;/name&gt; &lt;value&gt;yarn&lt;/value&gt;&lt;/property&gt; 12# åœ¨é›†ç¾¤ä¸Šåˆ†å‘é…ç½®å¥½çš„Hadoopé…ç½®æ–‡ä»¶xsync /opt/module/hadoop-2.7.2/ å•ç‚¹å¯åŠ¨12345# NameNode ç¬¬ä¸€æ¬¡å¯åŠ¨åˆå§‹åŒ–hadoop namenode -formathadoop-daemon.sh start namenode# åˆ†åˆ«åœ¨ä¸‰ä¸ªèŠ‚ç‚¹ä¸Šå¯åŠ¨ DataNodehadoop-daemon.sh start datanode é›†ç¾¤å¯åŠ¨1234567891011vi /opt/module/hadoop-2.7.2/etc/hadoop/slaves # hadoop102 # hadoop103 # hadoop104# åŒæ­¥é…ç½®xsync slaves# NameNode èŠ‚ç‚¹bin/hdfs namenode -formatsbin/start-dfs.sh# ResourceManage èŠ‚ç‚¹sbin/start-yarn.sh SSH é…ç½®1234567# ~/.ssh ç”Ÿæˆå¯†é’¥ssh-keygen -t rsa# æ¯ä¸ªèŠ‚ç‚¹éƒ½éœ€è¦è¿›è¡Œæ­¤æ“ä½œ# å°†å…¬é’¥æ‹·è´åˆ°è¦å…å¯†ç™»å½•çš„ç›®æ ‡æœºå™¨ä¸Šssh-copy-id hadoop102ssh-copy-id hadoop103ssh-copy-id hadoop104 æ–‡ä»¶å åŠŸèƒ½ known_hosts è®°å½•sshè®¿é—®è¿‡è®¡ç®—æœºçš„å…¬é’¥(public key) id_rsa ç”Ÿæˆçš„ç§é’¥ id_rsa.pub ç”Ÿæˆçš„å…¬é’¥ authorized_keys å­˜æ”¾æˆæƒè¿‡å¾—æ— å¯†ç™»å½•æœåŠ¡å™¨å…¬é’¥ æ—¶é—´åŒæ­¥ NPTï¼ˆNetwork Time Protocolï¼‰ æ—¶é—´åŒæ­¥çš„æ–¹å¼ï¼šæ‰¾ä¸€ä¸ªèŠ‚ç‚¹ä½œä¸ºæ—¶é—´æœåŠ¡å™¨ï¼Œæ‰€æœ‰çš„æœºå™¨ä¸è¿™å°é›†ç¾¤æ—¶é—´è¿›è¡Œå®šæ—¶çš„åŒæ­¥ï¼Œæ¯”å¦‚ï¼Œæ¯éš”ååˆ†é’Ÿï¼ŒåŒæ­¥ä¸€æ¬¡æ—¶é—´ã€‚ 12345678910111213141516171819202122232425262728# æ£€æŸ¥å®‰è£…rpm -qa | grep ntpvi /etc/ntp.confyum install -y ntp# ä¿®æ”¹é…ç½®vi /etc/ntp.conf # æˆæƒ192.168.1.0-192.168.1.255ç½‘æ®µä¸Šçš„æ‰€æœ‰æœºå™¨å¯ä»¥ä»è¿™å°æœºå™¨ä¸ŠæŸ¥è¯¢å’ŒåŒæ­¥æ—¶é—´ # restrict 192.168.1.0 mask 255.255.255.0 nomodify notrap # é›†ç¾¤åœ¨å±€åŸŸç½‘ä¸­ï¼Œä¸ä½¿ç”¨å…¶ä»–äº’è”ç½‘ä¸Šçš„æ—¶é—´ # #server 0.centos.pool.ntp.org iburst # #server 1.centos.pool.ntp.org iburst # #server 2.centos.pool.ntp.org iburst # #server 3.centos.pool.ntp.org iburst # å½“è¯¥èŠ‚ç‚¹ä¸¢å¤±ç½‘ç»œè¿æ¥ï¼Œä¾ç„¶å¯ä»¥é‡‡ç”¨æœ¬åœ°æ—¶é—´ä½œä¸ºæ—¶é—´æœåŠ¡å™¨ä¸ºé›†ç¾¤ä¸­çš„å…¶ä»–èŠ‚ç‚¹æä¾›æ—¶é—´åŒæ­¥ # server 127.127.1.0 # fudge 127.127.1.0 stratum 10vim /etc/sysconfig/ntpd # SYNC_HWCLOCK=yesservice ntpd restart# å¼€æœºå¯åŠ¨æ­¤æœåŠ¡chkconfig ntpd on# å…¶å®ƒèŠ‚ç‚¹é…ç½®crontab -e # */10 * * * * /usr/sbin/ntpdate hadoop102# ä¿®æ”¹æ—¶é—´date -s \"2017-9-11 11:11:11\"# ä¸€æ®µæ—¶é—´åæŸ¥çœ‹æ˜¯å¦åŒæ­¥date æ“ä½œé›†ç¾¤123456789101112131415161718# åœ¨ HDFS æ–‡ä»¶ç³»ç»Ÿä¸Šåˆ›å»ºä¸€ä¸ª input æ–‡ä»¶å¤¹bin/hdfs dfs -mkdir -p /user/wingo/input# å°†æµ‹è¯•æ–‡ä»¶å†…å®¹ä¸Šä¼ åˆ°æ–‡ä»¶ç³»ç»Ÿä¸Šbin/hdfs dfs -put wcinput/wc.input /user/wingo/input/# æŸ¥çœ‹ä¸Šä¼ çš„æ–‡ä»¶bin/hdfs dfs -ls /user/wingo/input/bin/hdfs dfs -cat /user/wingo/input/# è¿è¡Œ MapReduce ç¨‹åºbin/hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-2.7.2.jar wordcount /user/wingo/input/ /user/wingo/output# æŸ¥çœ‹è¾“å‡ºç»“æœï¼Œå¯åœ¨ 50070 ç«¯å£ Web æŸ¥çœ‹bin/hdfs dfs -cat /user/wingo/output/*# ä¸‹è½½æ–‡ä»¶åˆ°æœ¬åœ°bin/hdfs dfs -get /user/wingo/output/part-r-00000 ./wcoutput/# åˆ é™¤è¾“å‡ºç»“æœbin/hdfs dfs -rm -r /user/wingo/output å¯åŠ¨åœæ­¢æ“ä½œ123456789# åˆ†åˆ«å¯åŠ¨ / åœæ­¢ HDFS ç»„ä»¶hadoop-daemon.sh start / stop namenode / datanode / secondarynamenode# å¯åŠ¨ / åœæ­¢ YARNyarn-daemon.sh start / stop resourcemanager / nodemanager# é…ç½®äº† ssh åå¯ä¸€æ¬¡æ€§å¯åŠ¨é›†ç¾¤# æ•´ä½“å¯åŠ¨ / åœæ­¢ HDFSstart-dfs.sh / stop-dfs.sh# æ•´ä½“å¯åŠ¨/åœæ­¢ YARNstart-yarn.sh / stop-yarn.sh HDFSHDFS( Hadoop Distributed File Systemï¼‰å®ƒæ˜¯ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œç”¨äºå­˜å‚¨æ–‡ä»¶ï¼Œé€šè¿‡ç›®å½•æ ‘æ¥å®šä½æ–‡ä»¶ï¼›å…¶æ¬¡ï¼Œå®ƒæ˜¯åˆ†å¸ƒå¼çš„ï¼Œç”±å¾ˆå¤šæœåŠ¡å™¨è”åˆèµ·æ¥å®ç°å…¶åŠŸèƒ½ï¼Œé›†ç¾¤ä¸­çš„æœåŠ¡å™¨æœ‰å„è‡ªçš„è§’è‰²ã€‚ HDFSçš„ä½¿ç”¨åœºæ™¯ï¼šé€‚åˆä¸€æ¬¡å†™å…¥ï¼Œå¤šæ¬¡è¯»å‡ºçš„åœºæ™¯ï¼Œä¸”ä¸æ”¯æŒæ–‡ä»¶çš„ä¿®æ”¹ã€‚é€‚åˆç”¨æ¥åšæ•°æ®åˆ†æï¼Œå¹¶ä¸é€‚åˆç”¨æ¥åšç½‘ç›˜åº”ç”¨ã€‚ å…·æœ‰é«˜å®¹é”™æ€§ï¼Œå¤„ç†å¤§æ•°æ®ï¼Œå¯æ„å»ºåœ¨å»‰ä»·æœºå™¨ä¸Šç­‰ä¼˜ç‚¹ï¼›å…·æœ‰å»¶è¿Ÿè¾ƒé«˜ï¼Œæ— æ³•é«˜æ•ˆå­˜å‚¨å¤§é‡å°æ•°æ®ï¼Œä¸æ”¯æŒå¹¶å‘å†™å…¥åŠæ–‡ä»¶éšæœºä¿®æ”¹ç­‰ç¼ºé™·ã€‚ æ¶æ„ NameNode å°±æ˜¯ Masterï¼Œå®ƒæ˜¯ä¸€ä¸ªä¸»ç®¡ã€ç®¡ç†è€…ã€‚ ç®¡ç†HDFSçš„åç§°ç©ºé—´ï¼›é…ç½®å‰¯æœ¬ç­–ç•¥;ç®¡ç†æ•°æ®å—( Blockï¼‰æ˜ å°„ä¿¡æ¯;å¤„ç†å®¢æˆ·ç«¯è¯»å†™è¯·æ±‚ã€‚ DataNodeï¼šå°±æ˜¯ Slaveã€‚ NameNode ä¸‹è¾¾å‘½ä»¤, DataNode æ‰§è¡Œå®é™…çš„æ“ä½œã€‚ å­˜å‚¨å®é™…çš„æ•°æ®å—;æ‰§è¡Œæ•°æ®å—çš„è¯»å†™æ“ä½œã€‚ Clientï¼šå®¢æˆ·ç«¯ã€‚ æ–‡ä»¶åˆ‡åˆ†ã€‚æ–‡ä»¶ä¸Šä¼  HDFS çš„æ—¶å€™ï¼ŒClient å°†æ–‡ä»¶åˆ‡åˆ†æˆä¸€ä¸ªä¸€ä¸ªçš„ Block ç„¶åè¿›è¡Œä¸Šä¼ ï¼›ä¸ NameNode äº¤äº’ï¼Œè·å–æ–‡ä»¶çš„ä½ç½®ä¿¡æ¯ï¼›ä¸ DataNode äº¤äº’ï¼Œè¯»å–æˆ–è€…å†™å…¥æ•°æ®ï¼›Client æä¾›ä¸€äº›å‘½ä»¤æ¥ç®¡ç† HDFS,æ¯”å¦‚ NameNode æ ¼å¼åŒ–ï¼›Client å¯ä»¥é€šè¿‡ä¸€äº›å‘½ä»¤æ¥è®¿é—® HDFSï¼Œæ¯”å¦‚å¯¹ HDFS å¢åˆ æŸ¥æ”¹æ“ä½œã€‚ Secondary NameNodeï¼šå¹¶é NameNode çš„çƒ­å¤‡ã€‚ è¾…åŠ© NameNodeï¼Œåˆ†æ‹…å…¶å·¥ä½œé‡ï¼Œæ¯”å¦‚å®šæœŸåˆå¹¶ Silage å’Œ Editsï¼Œå¹¶æ¨é€ç»™ NameNodeï¼›åœ¨ç´§æ€¥æƒ…å†µä¸‹,å¯è¾…åŠ©æ¢å¤ NameNodeã€‚ æ–‡ä»¶å¿«å¤§å°HDFS ä¸­çš„æ–‡ä»¶åœ¨ç‰©ç†ä¸Šæ˜¯åˆ†å—å­˜å‚¨ï¼ˆBlockï¼‰ï¼Œå—çš„å¤§å°å¯ä»¥é€šè¿‡é…ç½®å‚æ•°ï¼ˆdfs.blocksizeï¼‰æ¥è§„å®š,é»˜è®¤å¤§å°åœ¨ Hadoop2x ç‰ˆæœ¬ä¸­æ˜¯ 128Mï¼Œè€ç‰ˆæœ¬ä¸­æ˜¯ 64Mã€‚ HDFS çš„å—è®¾ç½®å¤ªå°ï¼Œä¼šå¢åŠ å¯»å€æ—¶é—´ï¼Œç¨‹åºä¸€ç›´åœ¨æ‰¾å—çš„å¼€å§‹ä½ç½®ï¼›å¦‚æœå—è®¾ç½®çš„å¤ªå¤§ï¼Œä»ç£ç›˜ä¼ è¾“æ•°æ®çš„æ—¶é—´ä¼šæ˜æ˜¾å¤§äºå®šä½è¿™ä¸ªå—å¼€å§‹ä½ç½®æ‰€éœ€çš„æ—¶é—´ã€‚å¯¼è‡´ç¨‹åºåœ¨å¤„ç†è¿™å—æ•°æ®æ—¶ï¼Œä¼šéå¸¸æ…¢ã€‚æ€»ç»“ï¼šHDFS å—çš„å¤§å°è®¾ç½®ä¸»è¦å–å†³äºç£ç›˜ä¼ è¾“é€Ÿç‡ã€‚ï¼ˆå¯»å€æ—¶é—´ä¸ºä¼ è¾“æ—¶é—´çš„ 1% æ—¶æœ€åˆé€‚ï¼‰ Shell æ“ä½œ hfs æ˜¯ fs çš„å…·ä½“å®ç°ç±»ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738# å‘½ä»¤å¤§å…¨bin/hadoop fs# è¾“å‡ºè¿™ä¸ªå‘½ä»¤å‚æ•°hadoop fs -help rm# æ˜¾ç¤ºç›®å½•ä¿¡æ¯hadoop fs -ls /# åœ¨ HDFS ä¸Šåˆ›å»ºç›®å½•hadoop fs -mkdir -p /win/go# ä»æœ¬åœ°å‰ªåˆ‡ç²˜è´´åˆ° HDFShadoop fs -moveFromLocal ./win.txt /win/go# è¿½åŠ ä¸€ä¸ªæ–‡ä»¶åˆ°å·²ç»å­˜åœ¨çš„æ–‡ä»¶æœ«å°¾hadoop fs -appendToFile go.txt /win/go/win.txt# æ˜¾ç¤ºæ–‡ä»¶å†…å®¹hadoop fs -cat /win/go/win.txt# ä¿®æ”¹æ–‡ä»¶æ‰€å±æƒé™ï¼ŒHDFS æ“ä½œçš„ç”¨æˆ·åŠç”¨æˆ·ç»„å¿…é¡»æ˜¯ç³»ç»Ÿä¸­å­˜åœ¨çš„hadoop fs -chmod 666 /win/go/win.txthadoop fs -chown win:go /win/go/win.txt# ä» HDFS æ‹·è´åˆ°æœ¬åœ°hadoop fs -copyToLocal /win/go/win.txt ./# ä» HDFS çš„ä¸€ä¸ªè·¯å¾„æ‹·è´åˆ° HDFS çš„å¦ä¸€ä¸ªè·¯å¾„hadoop fs -cp /win/go/win.txt /other.txt# åœ¨ HDFS ç›®å½•ä¸­ç§»åŠ¨æ–‡ä»¶hadoop fs -mv /other.txt /win/go/# ä» HDFS ä¸‹è½½æ–‡ä»¶åˆ°æœ¬åœ°hadoop fs -get /win/go/win.txt ./# åˆå¹¶ä¸‹è½½å¤šä¸ª HDFS æ–‡ä»¶hadoop fs -getmerge /user/wingo/test/* ./together.txt# ç­‰åŒäº copyFromLocalhadoop fs -put ./local.txt /user/wingo/test/# æ˜¾ç¤ºä¸€ä¸ªæ–‡ä»¶çš„æœ«å°¾hadoop fs -tail /win/go/win.txt# åˆ é™¤æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹hadoop fs -rm /user/wingo/test/delete.txthadoop fs -rmdir /test# ç»Ÿè®¡æ–‡ä»¶å¤¹çš„å¤§å°ä¿¡æ¯hadoop fs -du -h /user/wingo/test# è®¾ç½® HDFS ä¸­æ–‡ä»¶çš„å‰¯æœ¬æ•°é‡ï¼šè‹¥æ¡ä»¶å…è®¸çš„è¯æ‰ä¼šè¾¾åˆ°hadoop fs -setrep 10 /win/go/win.txt å†™æµç¨‹ å‘ HDFS å†™æ•°æ®æ—¶ï¼Œå®¢æˆ·ç«¯ä¸ NameNodeã€DataNode é€šä¿¡è¿‡ç¨‹ã€‚ ç½‘ç»œæ‹“æ‰‘ åœ¨ HDFS å†™æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼ŒNameNode ä¼šé€‰æ‹©è·ç¦»å¾…ä¸Šä¼ æ•°æ®æœ€è¿‘è·ç¦»çš„ DataNode æ¥æ”¶æ•°æ®ã€‚ èŠ‚ç‚¹è·ç¦»ï¼šä¸¤ä¸ªèŠ‚ç‚¹åˆ°è¾¾æœ€è¿‘çš„å…±åŒç¥–å…ˆçš„è·ç¦»æ€»å’Œã€‚ æœºæ¶æ„ŸçŸ¥ å‰¯æœ¬èŠ‚ç‚¹é€‰æ‹©ã€‚ è¯»æµç¨‹ åœ¨ HDFS è¯»æ•°æ®æ—¶ï¼Œå®¢æˆ·ç«¯ä¸ NameNodeã€DataNode é€šä¿¡è¿‡ç¨‹ã€‚ 2NNå¦‚æœå­˜å‚¨åœ¨ NameNode èŠ‚ç‚¹çš„ç£ç›˜ä¸­ï¼Œå› ä¸ºç»å¸¸éœ€è¦è¿›è¡Œéšæœºè®¿é—®ï¼Œè¿˜æœ‰å“åº”å®¢æˆ·è¯·æ±‚ï¼Œå¿…ç„¶æ˜¯æ•ˆç‡è¿‡ä½ã€‚å› æ­¤ï¼Œå…ƒæ•°æ®éœ€è¦å­˜æ”¾åœ¨å†…å­˜ä¸­ã€‚ä½†å¦‚æœåªå­˜åœ¨å†…å­˜ä¸­ï¼Œä¸€æ—¦æ–­ç”µï¼Œå…ƒæ•°æ®ä¸¢å¤±ï¼Œæ•´ä¸ªé›†ç¾¤å°±æ— æ³•å·¥ä½œäº†ã€‚å› æ­¤äº§ç”Ÿåœ¨ç£ç›˜ä¸­å¤‡ä»½å…ƒæ•°æ®çš„ FsImageã€‚ è¿™æ ·åˆä¼šå¸¦æ¥æ–°çš„é—®é¢˜ï¼Œå½“åœ¨å†…å­˜ä¸­çš„å…ƒæ•°æ®æ›´æ–°æ—¶ï¼Œå¦‚æœåŒæ—¶æ›´æ–° FsImageï¼Œå°±ä¼šå¯¼è‡´æ•ˆç‡è¿‡ä½ï¼Œä½†å¦‚æœä¸æ›´æ–°ï¼Œå°±ä¼šå‘ç”Ÿä¸€è‡´æ€§é—®é¢˜ï¼Œä¸€æ—¦ NameNode èŠ‚ç‚¹æ–­ç”µï¼Œå°±ä¼šäº§ç”Ÿæ•°æ®ä¸¢å¤±ã€‚å› æ­¤ï¼Œå¼•å…¥ Edits æ–‡ä»¶ï¼ˆåªè¿›è¡Œè¿½åŠ æ“ä½œï¼Œæ•ˆç‡å¾ˆé«˜ï¼‰ã€‚æ¯å½“å…ƒæ•°æ®æœ‰æ›´æ–°æˆ–è€…æ·»åŠ å…ƒæ•°æ®æ—¶ï¼Œä¿®æ”¹å†…å­˜ä¸­çš„å…ƒæ•°æ®å¹¶è¿½åŠ åˆ° Edits ä¸­ã€‚è¿™æ ·ï¼Œä¸€æ—¦ NameNode èŠ‚ç‚¹æ–­ç”µï¼Œå¯ä»¥é€šè¿‡ FsImage å’Œ Edits çš„åˆå¹¶ï¼Œåˆæˆå…ƒæ•°æ®ã€‚ ä½†æ˜¯ï¼Œå¦‚æœé•¿æ—¶é—´æ·»åŠ æ•°æ®åˆ° Edits ä¸­ï¼Œä¼šå¯¼è‡´è¯¥æ–‡ä»¶æ•°æ®è¿‡å¤§ï¼Œæ•ˆç‡é™ä½ï¼Œè€Œä¸”ä¸€æ—¦æ–­ç”µï¼Œæ¢å¤å…ƒæ•°æ®éœ€è¦çš„æ—¶é—´è¿‡é•¿ã€‚å› æ­¤ï¼Œéœ€è¦å®šæœŸè¿›è¡Œ FsImage å’Œ Edits çš„åˆå¹¶ï¼Œå¦‚æœè¿™ä¸ªæ“ä½œç”± NameNode èŠ‚ç‚¹å®Œæˆï¼Œåˆä¼šæ•ˆç‡è¿‡ä½ã€‚å› æ­¤ï¼Œå¼•å…¥ä¸€ä¸ªæ–°çš„èŠ‚ç‚¹ SecondaryNamenodeï¼Œä¸“é—¨ç”¨äº FsImage å’Œ Edits çš„åˆå¹¶ã€‚ Fsimage å’Œ Edits12345# oiv æŸ¥çœ‹ Fsimage æ–‡ä»¶pwd # /opt/module/hadoop-2.7.2/data/tmp/dfs/name/currenthdfs oiv -p XML -i fsimage_0000000000000000025 -o /opt/module/hadoop-2.7.2/fsimage.xmlcat /opt/module/hadoop-2.7.2/fsimage.xml 12345678910&lt;!-- è®°å½•äº† NameNode çš„ä¿¡æ¯ï¼ŒDataNode ä¿¡æ¯å®šæ—¶åŒæ­¥åˆ° NameNode --&gt;&lt;inode&gt; &lt;id&gt;16386&lt;/id&gt; &lt;type&gt;DIRECTORY&lt;/type&gt; &lt;name&gt;user&lt;/name&gt; &lt;mtime&gt;1512722284477&lt;/mtime&gt; &lt;permission&gt;wingo:supergroup:rwxr-xr-x&lt;/permission&gt; &lt;nsquota&gt;-1&lt;/nsquota&gt; &lt;dsquota&gt;-1&lt;/dsquota&gt;&lt;/inode&gt; 123# oev æŸ¥çœ‹ Edits æ–‡ä»¶hdfs oev -p XML -i edits_0000000000000000012-0000000000000000013 -o /opt/module/hadoop-2.7.2/edits.xmlcat /opt/module/hadoop-2.7.2/edits.xml 12345678910&lt;!-- è®°å½•äº†æ“ä½œä¿¡æ¯ --&gt;&lt;EDITS&gt; &lt;EDITS_VERSION&gt;-63&lt;/EDITS_VERSION&gt; &lt;RECORD&gt; &lt;OPCODE&gt;OP_START_LOG_SEGMENT&lt;/OPCODE&gt; &lt;DATA&gt; &lt;TXID&gt;129&lt;/TXID&gt; &lt;/DATA&gt; &lt;/RECORD&gt;&lt;/EDITS &gt; CheckPoint12345678910111213141516171819&lt;!-- é»˜è®¤é…ç½® hdfs-default.xml --&gt;&lt;property&gt; &lt;name&gt;dfs.namenode.checkpoint.period&lt;/name&gt; &lt;!-- ä¸€å°æ—¶æ‰§è¡Œä¸€æ¬¡ --&gt; &lt;value&gt;3600&lt;/value&gt;&lt;/property&gt;&lt;property&gt; &lt;name&gt;dfs.namenode.checkpoint.txns&lt;/name&gt; &lt;value&gt;1000000&lt;/value&gt; &lt;description&gt;æ“ä½œæ¬¡æ•°è¾¾ä¸€ç™¾ä¸‡æ¬¡&lt;/description&gt;&lt;/property&gt;&lt;property&gt; &lt;name&gt;dfs.namenode.checkpoint.check.period&lt;/name&gt; &lt;value&gt;60&lt;/value&gt; &lt;description&gt;ä¸€åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡æ“ä½œæ¬¡æ•°&lt;/description&gt;&lt;/property &gt; æ•…éšœå¤„ç† NameNode æ•…éšœåï¼Œå¯ä»¥é‡‡ç”¨å¦‚ä¸‹ä¸¤ç§æ–¹æ³•æ¢å¤æ•°æ®ã€‚ 123456789# æ–¹æ³•ä¸€ å°† SecondaryNameNode ä¸­æ•°æ®æ‹·è´åˆ° NameNode å­˜å‚¨æ•°æ®çš„ç›®å½•# æ€æ‰ NameNode ç›¸å…³è¿›ç¨‹kill -9 [pid]# åˆ é™¤ NameNode å­˜å‚¨çš„æ•°æ®rm -rf /opt/module/hadoop-2.7.2/data/tmp/dfs/name/*# æ‹·è´ SecondaryNameNode ä¸­æ•°æ®åˆ°åŸ NameNode å­˜å‚¨æ•°æ®ç›®å½•scp -r root@hadoop104:/opt/module/hadoop-2.7.2/data/tmp/dfs/namesecondary/* ./name/# é‡æ–°å¯åŠ¨ NameNodesbin/hadoop-daemon.sh start namenode 1# æ–¹æ³•äºŒ ä½¿ç”¨ -importCheckpoint é€‰é¡¹å¯åŠ¨ NameNode å®ˆæŠ¤è¿›ç¨‹ï¼Œä»è€Œå°† Secondary NameNode ä¸­æ•°æ®æ‹·è´åˆ° NameNode ç›®å½•ä¸­ã€‚ 1234567891011&lt;!-- ä¿®æ”¹hdfs-site.xml --&gt;&lt;property&gt; &lt;name&gt;dfs.namenode.checkpoint.period&lt;/name&gt; &lt;value&gt;120&lt;/value&gt;&lt;/property&gt;&lt;property&gt; &lt;name&gt;dfs.namenode.name.dir&lt;/name&gt; &lt;value&gt;/opt/module/hadoop-2.7.2/data/tmp/dfs/name&lt;/value&gt;&lt;/property&gt; 123456789101112# æ€æ‰ NameNode ç›¸å…³è¿›ç¨‹kill -9 [pid]# åˆ é™¤ NameNode å­˜å‚¨çš„æ•°æ®rm -rf /opt/module/hadoop-2.7.2/data/tmp/dfs/name/*# å¦‚æœ SecondaryNameNode ä¸å’Œ NameNode åœ¨ä¸€ä¸ªä¸»æœºèŠ‚ç‚¹ä¸Šï¼Œ# éœ€è¦å°† SecondaryNameNode å­˜å‚¨æ•°æ®çš„ç›®å½•æ‹·è´åˆ° NameNode å­˜å‚¨æ•°æ®çš„å¹³çº§ç›®å½•ï¼Œå¹¶åˆ é™¤ in_use.lock æ–‡ä»¶scp -r root@hadoop104:/opt/module/hadoop-2.7.2/data/tmp/dfs/namesecondary ./rm -rf in_use.lock# å¯¼å…¥æ£€æŸ¥ç‚¹æ•°æ®ï¼ˆç­‰å¾…ä¸€ä¼š ctrl+c ç»“æŸæ‰ï¼‰bin/hdfs namenode -importCheckpoint# å¯åŠ¨ NameNodesbin/hadoop-daemon.sh start namenode å®‰å…¨æ¨¡å¼NameNode å¯åŠ¨æ—¶ï¼Œé¦–å…ˆå°†é•œåƒæ–‡ä»¶(ï¼ˆFsimageï¼‰è½½å…¥å…§å­˜ï¼Œå¹¶æ‰§è¡Œç¼–è¾‘æ—¥å¿—(ï¼ˆEditsï¼‰ä¸­çš„å„é¡¹æ“ä½œï¼Œä¸€æ—¦åœ¨å†…å­˜ä¸­æˆåŠŸå»ºç«‹æ–‡ä»¶ç³»ç»Ÿå…ƒæ•°æ®çš„æ˜ åƒï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„ Silageæ–‡ä»¶å’Œä¸€ä¸ªç©ºçš„ç¼–è¾‘æ—¥å¿—ã€‚æ­¤æ—¶ï¼ŒNameNode å¼€å§‹ç›‘å¬ DataNode è¯·æ±‚ã€‚è¿™ä¸ªè¿‡ç¨‹æœŸé—´ï¼ŒNamenode ä¸€ç›´è¿è¡Œåœ¨å®‰å…¨æ¨¡å¼ï¼Œå³ NameNode çš„æ–‡ä»¶ç³»ç»Ÿå¯¹äºå®¢æˆ·ç«¯æ¥è¯´æ˜¯åªè¯»çš„ã€‚ ç³»ç»Ÿä¸­çš„æ•°æ®å—çš„ä½ç½®å¹¶ä¸æ˜¯ç”± NameNode ç»´æŠ¤çš„ï¼Œè€Œæ˜¯ä»¥å—åˆ—è¡¨çš„å½¢å¼å­˜å‚¨åœ¨ DataNode ä¸­ã€‚åœ¨ç³»ç»Ÿçš„æ­£å¸¸æ“ä½œæœŸé—´, NameNodeä¼šåœ¨å†…å­˜ä¸­ä¿ç•™æ‰€æœ‰å—ä½ç½®çš„æ˜ å°„ä¿¡æ¯ã€‚åœ¨å®‰å…¨æ¨¡å¼ä¸‹ï¼Œå„ä¸ª Datanode ä¼šå‘ NameNode å‘é€æœ€æ–°çš„å—åˆ—è¡¨ä¿¡æ¯,ï¼ŒNameNode äº†è§£åˆ°è¶³å¤Ÿå¤šçš„å—ä½ç½®ä¿¡æ¯ä¹‹åï¼Œå³å¯é«˜æ•ˆè¿è¡Œæ–‡ä»¶ç³»ç»Ÿã€‚ å¦‚æœæ»¡è¶³â€œæœ€å°å‰¯æœ¬æ¡ä»¶â€,ï¼ŒNameNode ä¼šåœ¨ 30 ç§’é’Ÿä¹‹åå°±é€€å‡ºå®‰å…¨æ¨¡å¼ã€‚æ‰€è°“çš„æœ€å°å‰¯æœ¬æ¡ä»¶æŒ‡çš„æ˜¯åœ¨æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿä¸­ 99.9% çš„å—æ»¡è¶³æœ€å°å‰¯æœ¬çº§åˆ«ï¼ˆé»˜è®¤å€¼ï¼šdfs.replication.min=1ï¼‰ã€‚åœ¨å¯åŠ¨ä¸€ä¸ªåˆšåˆšæ ¼å¼åŒ–çš„ HDFS é›†ç¾¤æ—¶ï¼Œå› ä¸ºç³»ç»Ÿä¸­è¿˜æ²¡æœ‰ä»»ä½•å—ï¼Œæ‰€ä»¥ NameNode ä¸ä¼šè¿›å…¥å®‰å…¨æ¨¡å¼ã€‚ 12345bin/hdfs dfsadmin -safemode get # æŸ¥çœ‹å®‰å…¨æ¨¡å¼çŠ¶æ€bin/hdfs dfsadmin -safemode enter # åŠŸèƒ½æè¿°ï¼šè¿›å…¥å®‰å…¨æ¨¡å¼çŠ¶æ€bin/hdfs dfsadmin -safemode leave # ç¦»å¼€å®‰å…¨æ¨¡å¼çŠ¶æ€bin/hdfs dfsadmin -safemode wait # ç­‰å¾…å®‰å…¨æ¨¡å¼ç»“æŸçŠ¶æ€# å¯ä»¥ç¼–å†™è„šæœ¬ï¼Œåœ¨å®‰å…¨æ¨¡å¼ä¸‹å µå¡ç­‰å¾…å®‰å…¨æ¨¡å¼ç»“æŸè¿è¡Œæ¥ä¸‹æ¥çš„å‘½ä»¤ å¤šç›®å½• NameNode çš„æœ¬åœ°ç›®å½•å¯ä»¥é…ç½®æˆå¤šä¸ªï¼Œä¸”æ¯ä¸ªç›®å½•å­˜æ”¾å†…å®¹ç›¸åŒï¼Œå¢åŠ äº†å¯é æ€§ã€‚ 1234567891011&lt;!-- hdfs-site.xml é…ç½® --&gt;&lt;property&gt; &lt;name&gt;hadoop.tmp.dir&lt;/name&gt; &lt;value&gt;/opt/module/hadoop-2.7.2/data/tmp&lt;/value&gt;&lt;/property&gt;&lt;property&gt; &lt;name&gt;dfs.namenode.name.dir&lt;/name&gt; &lt;value&gt;file:///$&#123;hadoop.tmp.dir&#125;/dfs/name1,file:///$&#123;hadoop.tmp.dir&#125;/dfs/name2&lt;/value&gt;&lt;/property&gt; DataNode ä¹Ÿå¯ä»¥é…ç½®æˆå¤šä¸ªç›®å½•ï¼Œæ¯ä¸ªç›®å½•å­˜å‚¨çš„æ•°æ®ä¸ä¸€æ ·ã€‚å³ï¼šæ•°æ®ä¸æ˜¯å‰¯æœ¬ã€‚ 123456&lt;!-- hdfs-site.xml é…ç½® --&gt;&lt;property&gt; &lt;name&gt;dfs.datanode.data.dir&lt;/name&gt; &lt;value&gt;file:///$&#123;hadoop.tmp.dir&#125;/dfs/data1,file:///$&#123;hadoop.tmp.dir&#125;/dfs/data2&lt;/value&gt;&lt;/property&gt; DataNode DataNode æ‰çº¿æ—¶é™å‚æ•°è®¾ç½® 12345678910111213&lt;!-- Timeout = 2*dfs.namenode.heartbeat.recheck-interval + 10*dfs.heartbeat.interval --&gt;&lt;!-- hdfs-default.xml é»˜è®¤é…ç½® --&gt;&lt;property&gt; &lt;name&gt;dfs.namenode.heartbeat.recheck-interval&lt;/name&gt; &lt;value&gt;300000&lt;/value&gt; &lt;!-- å•ä½ ms --&gt;&lt;/property&gt;&lt;property&gt; &lt;name&gt;dfs.heartbeat.interval&lt;/name&gt; &lt;value&gt;3&lt;/value&gt; &lt;!-- å•ä½ s --&gt;&lt;/property&gt; æ•°æ®å®Œæ•´æ€§ æ£€æµ‹ DataNode èŠ‚ç‚¹ä¸Šçš„æ•°æ®æ˜¯å¦å®Œæ•´ï¼Ÿ å½“ DataNode è¯»å– Block çš„æ—¶å€™ï¼Œå®ƒä¼šè®¡ç®— CheckSumï¼Œå¦‚æœè®¡ç®—åçš„ CheckSumï¼Œä¸ Block åˆ›å»ºæ—¶å€¼ä¸ä¸€æ ·ï¼Œè¯´æ˜ Block å·²ç»æŸåã€‚ Client è¯»å–å…¶ä»– DataNode ä¸Šçš„ Blockï¼ŒDataNode åœ¨å…¶æ–‡ä»¶åˆ›å»ºåå‘¨æœŸéªŒè¯ CheckSumã€‚ é»‘ç™½åå• æ·»åŠ åˆ°ç™½åå•çš„ä¸»æœºèŠ‚ç‚¹ï¼Œéƒ½å…è®¸è®¿é—® NameNodeï¼Œä¸åœ¨ç™½åå•çš„ä¸»æœºèŠ‚ç‚¹ï¼Œéƒ½ä¼šè¢«é€€å‡ºã€‚ 1234# ç™½åå•# åœ¨ NameNode çš„ /opt/module/hadoop-2.7.2/etc/hadoop ç›®å½•ä¸‹åˆ›å»º dfs.hosts æ–‡ä»¶vi dfs.hosts # æ·»åŠ å…è®¸çš„ä¸»æœºå 123456&lt;!-- hdfs-site.xml --&gt;&lt;property&gt; &lt;name&gt;dfs.hosts&lt;/name&gt; &lt;value&gt;/opt/module/hadoop-2.7.2/etc/hadoop/dfs.hosts&lt;/value&gt;&lt;/property&gt; 1234567# åˆ†å‘é…ç½®æ–‡ä»¶xsync hdfs-site.xml# æ›´æ–°èŠ‚ç‚¹ä¿¡æ¯hdfs dfsadmin -refreshNodesyarn rmadmin -refreshNodes# å¦‚æœæ•°æ®ä¸å‡è¡¡ï¼Œå¯ä»¥ç”¨å‘½ä»¤å®ç°é›†ç¾¤çš„å†å¹³è¡¡./start-balancer.sh åœ¨é»‘åå•ä¸Šé¢çš„ä¸»æœºéƒ½ä¼šè¢«å¼ºåˆ¶é€€å‡ºã€‚ 123# é»‘åå•vi dfs.hosts.exclude # æ·»åŠ ä¸å…è®¸çš„ä¸»æœºå 123456&lt;!-- hdfs-site.xml --&gt;&lt;property&gt; &lt;name&gt;dfs.hosts.exclude&lt;/name&gt; &lt;value&gt;/opt/module/hadoop-2.7.2/etc/hadoop/dfs.hosts.exclude&lt;/value&gt;&lt;/property&gt; 1234567# æ›´æ–°èŠ‚ç‚¹ä¿¡æ¯hdfs dfsadmin -refreshNodesyarn rmadmin -refreshNodes# å¦‚æœæ•°æ®ä¸å‡è¡¡ï¼Œå¯ä»¥ç”¨å‘½ä»¤å®ç°é›†ç¾¤çš„å†å¹³è¡¡./start-balancer.sh# æ£€æŸ¥ Web æµè§ˆå™¨ï¼Œé€€å½¹èŠ‚ç‚¹çš„çŠ¶æ€ä¸º decommission in progressï¼ˆé€€å½¹ä¸­ï¼‰ï¼Œè¯´æ˜æ•°æ®èŠ‚ç‚¹æ­£åœ¨å¤åˆ¶å—åˆ°å…¶ä»–èŠ‚ç‚¹# ç­‰å¾…é€€å½¹èŠ‚ç‚¹çŠ¶æ€ä¸º decommissionedï¼ˆæ‰€æœ‰å—å·²ç»å¤åˆ¶å®Œæˆï¼‰ï¼Œåœæ­¢è¯¥èŠ‚ç‚¹åŠèŠ‚ç‚¹èµ„æºç®¡ç†å™¨ å›æ”¶ç«™ å¼€å¯å›æ”¶ç«™åŠŸèƒ½ï¼Œå¯ä»¥å°†åˆ é™¤çš„æ–‡ä»¶åœ¨ä¸è¶…æ—¶çš„æƒ…å†µä¸‹ï¼Œæ¢å¤åŸæ•°æ®ï¼Œèµ·åˆ°é˜²æ­¢è¯¯åˆ é™¤ã€å¤‡ä»½ç­‰ä½œç”¨ã€‚ 1234# 0 è¡¨ç¦ç”¨ï¼Œå…¶ä»–å€¼è¡¨ç¤ºè®¾ç½®æ–‡ä»¶çš„å­˜æ´»æ—¶é—´# fs.trash.interval=0# æ£€æŸ¥å›æ”¶ç«™çš„é—´éš”æ—¶é—´ã€‚å¦‚æœè¯¥å€¼ä¸º 0ï¼Œåˆ™è¯¥å€¼è®¾ç½®å’Œ fs.trash.interval çš„å‚æ•°å€¼ç›¸ç­‰ã€‚# fs.trash.checkpoint.interval=0 12345678910111213&lt;!-- core-site.xml --&gt;&lt;property&gt; &lt;name&gt;fs.trash.interval&lt;/name&gt; &lt;value&gt;1&lt;/value&gt; &lt;!-- min --&gt;&lt;/property&gt;&lt;property&gt; &lt;name&gt;hadoop.http.staticuser.user&lt;/name&gt; &lt;value&gt;wingo&lt;/value&gt; &lt;!-- è¿›å…¥å›æ”¶ç«™çš„åç§° --&gt;&lt;/property&gt; 123456789# å›æ”¶ç«™åœ¨é›†ç¾¤ä¸­çš„è·¯å¾„/user/wingo/.Trash/...# é€šè¿‡ç¨‹åºåˆ é™¤çš„æ–‡ä»¶ä¸ä¼šç»è¿‡å›æ”¶ç«™ï¼Œéœ€è¦è°ƒç”¨ moveToTrash() æ‰è¿›å…¥å›æ”¶ç«™# Trash trash = New Trash(conf);# trash.moveToTrash(path);# å›å¤å›æ”¶ç«™æ•°æ®hadoop fs -mv /user/wingo/.Trash/Current/user/wingo/input /user/wingo/input# æ¸…ç©ºå›æ”¶ç«™hadoop fs -expunge å¿«ç…§ç®¡ç†12345678hdfs dfsadmin -allowSnapshot [è·¯å¾„] # å¼€å¯æŒ‡å®šç›®å½•çš„å¿«ç…§åŠŸèƒ½hdfs dfsadmin -disallowSnapshot [è·¯å¾„] # ç¦ç”¨æŒ‡å®šç›®å½•çš„å¿«ç…§åŠŸèƒ½ï¼Œé»˜è®¤æ˜¯ç¦ç”¨hdfs dts -createSnapshot [è·¯å¾„] # å¯¹ç›®å½•åˆ›å»ºå¿«ç…§hdfs dts -createSnapshot [è·¯å¾„] [åç§°] # æŒ‡å®šåç§°åˆ›å»ºå¿«ç…§hdts dfs -renameSnapshot [è·¯å¾„] [æ—§åç§°] [æ–°åç§°] # é‡å‘½åå¿«ç…§hdfs lsSnapshottableDir # åˆ—å‡ºå½“å‰ç”¨æˆ·æ‰€æœ‰å¯å¿«ç…§ç›®å½•hdfs snapshotDiff [è·¯å¾„] [è·¯å¾„] # æ¯”è¾ƒä¸¤ä¸ªå¿«ç…§ç›®å½•çš„ä¸åŒä¹‹å¤„hdfs dfs -deleteSnapshot &lt;path&gt; &lt;snapshotname&gt; # åˆ é™¤å¿«ç…§ MapReduceMapReduce æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼è¿ç®—ç¨‹åºçš„ç¼–ç¨‹æ¡†æ¶,æ˜¯ç”¨æˆ·å¼€å‘â€œåŸºäº Hadoop çš„æ•°æ®åˆ†æåº”ç”¨â€çš„æ ¸å¿ƒæ¡†æ¶ã€‚ MapReduce æ ¸å¿ƒåŠŸèƒ½æ˜¯å°†ç”¨æˆ·ç¼–å†™çš„ä¸šåŠ¡é€»è¾‘ä»£ç å’Œè‡ªå¸¦é»˜è®¤ç»„ä»¶æ•´åˆæˆä¸€ä¸ªå®Œæ•´çš„åˆ†å¸ƒå¼è¿ç®—ç¨‹åºï¼Œå¹¶å‘è¿è¡Œåœ¨ä¸€ä¸ª Hadoop é›†ç¾¤ä¸Šã€‚ å…·æœ‰æ˜“äºç¼–ç¨‹ã€æ‰©å±•æ€§è‰¯å¥½ã€é«˜å®¹é”™æ€§ã€PB çº§åˆ«æµ·é‡æ•°æ®å¤„ç†èƒ½åŠ›ç­‰ä¼˜ç‚¹ï¼›å…·æœ‰ä¸æ“…é•¿å®æ—¶è®¡ç®—ã€ä¸æ“…é•¿æµå¼è®¡ç®—ã€ä¸æ“…é•¿ DAG ï¼ˆæœ‰å‘å›¾ï¼‰è®¡ç®—ï¼Œå³éœ€è¦è¿­ä»£çš„è®¡ç®—ç­‰ç¼ºé™·ã€‚ å®ä¾‹è¿›ç¨‹ MrAppMasterï¼šè´Ÿè´£æ•´ä¸ªç¨‹åºçš„è¿‡ç¨‹è°ƒåº¦åŠçŠ¶æ€åè°ƒï¼›MapTaskï¼šè´Ÿè´£ Map é˜¶æ®µçš„æ•´ä¸ªæ•°æ®å¤„ç†æµç¨‹ï¼›ReduceTaskï¼šè´Ÿè´£ Reduce é˜¶æ®µçš„æ•´ä¸ªæ•°æ®å¤„ç†æµç¨‹ã€‚ åºåˆ—åŒ–ç±»å‹ Javaç±»å‹ Hadoop Writableç±»å‹ boolean BooleanWritable byte ByteWritable int IntWritable float FloatWritable long LongWritable double DoubleWritable String Text map MapWritable array ArrayWritable ç¼–ç¨‹è§„èŒƒ ç”¨æˆ·ç¼–å†™çš„ç¨‹åºåˆ†æˆä¸‰ä¸ªéƒ¨åˆ†ï¼šMapperã€Reducer å’Œ Driverã€‚ Mapper é˜¶æ®µ ç”¨æˆ·è‡ªå®šä¹‰çš„ Mapper è¦ç»§æ‰¿æŒ‡å®šçš„çˆ¶ç±»ï¼›Mapper çš„è¾“å…¥æ•°æ®æ˜¯ K V å¯¹çš„å¼€å¼ï¼ˆK V çš„ç±»å‹å¯è‡ªå®šä¹‰ï¼‰ï¼›Mapper ä¸­çš„ä¸šåŠ¡é€»è¾‘å†™åœ¨ map() æ–¹æ³•ä¸­ï¼›Mapper çš„è¾“å‡ºæ•°æ®æ˜¯ K â…¤ å¯¹çš„å½¢å¼ï¼ˆK V çš„ç±»å‹å¯è‡ªå®šä¹‰ï¼‰ï¼›map() æ–¹æ³•( MapTask è¿›ç¨‹ï¼‰å¯¹æ¯ä¸€ä¸ª K V&gt;è°ƒç”¨ä¸€æ¬¡ã€‚ 123456789101112131415161718192021222324// Key åç§»é‡ è¾“å…¥æ•°æ® Value ç±»å‹ è¾“å‡ºæ•°æ®ç±»å‹çš„ K V ğŸ‘‰ å¯¹åº” Reduce çš„è¾“å…¥public class WordcountMapper extends Mapper&lt;LongWritable, Text, Text, IntWritable&gt;&#123; Text k = new Text(); IntWritable v = new IntWritable(1); // æ­¤æ–¹æ³•æ¯æ¬¡åªè·å–ä¸€è¡Œ @Override protected void map(LongWritable key, Text value, Context context) throws IOException, InterruptedException &#123; // è·å–ä¸€è¡Œ String line = value.toString(); // åˆ‡å‰² String[] words = line.split(\" \"); // è¾“å‡º for (String word : words) &#123; k.set(word); // (word, 1) context.write(k, v); &#125; &#125;&#125; Reduce é˜¶æ®µ ç”¨æˆ·è‡ªå®šä¹‰çš„ Reducer è¦ç»§æ‰¿è‡ªå·±çš„çˆ¶ç±»ï¼›Reducer çš„è¾“å…¥æ•°æ®ç±»å‹å¯¹åº” Mapper çš„è¾“å‡ºæ•°æ®ç±»å‹ï¼Œä¹Ÿæ˜¯ K V å¯¹çš„å½¢å¼Reducer çš„ä¸šåŠ¡é€»è¾‘å†™åœ¨ reduce() æ–¹æ³•ä¸­ReduceTask è¿›ç¨‹å¯¹æ¯ä¸€ç»„ç›¸åŒ K çš„ K V ç»„è°ƒç”¨ä¸€æ¬¡ reduce() æ–¹æ³• 12345678910111213141516171819public class WordcountReducer extends Reducer&lt;Text, IntWritable, Text, IntWritable&gt;&#123; int sum; IntWritable v = new IntWritable(); // è¿™é‡Œç›´æ¥ç©¿å…¥ä¸€ä¸ªè¿­ä»£å™¨äº†ï¼Œç›´æ¥å¾ªç¯å–å€¼å³å¯ @Override protected void reduce(Text key, Iterable&lt;IntWritable&gt; values,Context context) throws IOException, InterruptedException &#123; // ç´¯åŠ æ±‚å’Œ sum = 0; for (IntWritable count : values) &#123; sum += count.get(); &#125; // è¾“å‡º v.set(sum); context.write(key,v); &#125;&#125; Driver é˜¶æ®µ ç›¸å½“äº YARN é›†ç¾¤çš„å®¢æˆ·ç«¯ï¼Œç”¨äºæäº¤æˆ‘ä»¬æ•´ä¸ªç¨‹åºåˆ° YARN é›†ç¾¤,æäº¤çš„æ˜¯å°è£…äº† MapReduce ç¨‹åºç›¸å…³è¿è¡Œå‚æ•°çš„ job å¯¹è±¡ã€‚ 123456789101112131415161718192021222324252627282930313233public class WordcountDriver &#123; public static void main(String[] args) throws IOException, ClassNotFoundException, InterruptedException &#123; // è·å–é…ç½®ä¿¡æ¯ä»¥åŠå°è£…ä»»åŠ¡ Configuration configuration = new Configuration(); Job job = Job.getInstance(configuration); // è®¾ç½® jar åŠ è½½è·¯å¾„ job.setJarByClass(WordcountDriver.class); // è®¾ç½® map å’Œ reduce ç±» job.setMapperClass(WordcountMapper.class); job.setReducerClass(WordcountReducer.class); // è®¾ç½® map è¾“å‡º job.setMapOutputKeyClass(Text.class); job.setMapOutputValueClass(IntWritable.class); // è®¾ç½®æœ€ç»ˆè¾“å‡º K V ç±»å‹ job.setOutputKeyClass(Text.class); job.setOutputValueClass(IntWritable.class); // è®¾ç½®è¾“å…¥å’Œè¾“å‡ºè·¯å¾„ FileInputFormat.setInputPaths(job, new Path(args[0])); FileOutputFormat.setOutputPath(job, new Path(args[1])); // æäº¤ boolean result = job.waitForCompletion(true); System.exit(result ? 0 : 1); &#125;&#125; Shuffle Map æ–¹æ³•ä¹‹åï¼ŒReduce æ–¹æ³•ä¹‹å‰çš„æ•°æ®å¤„ç†è¿‡ç¨‹ç§°ä¹‹ä¸º Shuffleï¼ŒåŒ…å«äº†ä¸¤ç«¯çš„ Combiner å’Œ Partitionã€‚ Partition è¦æ±‚å°†ç»Ÿè®¡ç»“æœæŒ‰ç…§æ¡ä»¶è¾“å‡ºåˆ°ä¸åŒæ–‡ä»¶ä¸­ï¼ˆåˆ†åŒºï¼‰ã€‚ 1234567// é»˜è®¤ Partition åˆ†åŒºæœºåˆ¶ï¼Œç”¨æˆ·æ— æ³•æ§åˆ¶ Key çš„å­˜å‚¨åˆ†åŒºpublic class HashPartironer&lt;K, V&gt; extends Partitioner&lt;K, V&gt; &#123; public int getPartition(K key, V vlaue, int numReduceTasks) &#123; return (key.hashCode() &amp; Integer.MAX_VALUE) % numberReduceTasks; &#125;&#125; è‡ªå®šä¹‰12345678910111213141516171819202122232425262728293031323334// éœ€æ±‚ï¼šå°†ç»Ÿè®¡ç»“æœæŒ‰ç…§æ‰‹æœºå½’å±åœ°ä¸åŒçœä»½è¾“å‡ºåˆ°ä¸åŒæ–‡ä»¶ä¸­ï¼ˆåˆ†åŒºï¼‰public class ProvincePartitioner extends Partitioner&lt;Text, FlowBean&gt; &#123; @Override public int getPartition(Text key, FlowBean value, int numPartitions) &#123; // è·å–ç”µè¯å·ç çš„å‰ä¸‰ä½ String preNum = key.toString().substring(0, 3); int partition = 4; // åˆ¤æ–­æ˜¯å“ªä¸ªçœ if (\"136\".equals(preNum)) &#123; partition = 0; &#125;else if (\"137\".equals(preNum)) &#123; partition = 1; &#125;else if (\"138\".equals(preNum)) &#123; partition = 2; &#125;else if (\"139\".equals(preNum)) &#123; partition = 3; &#125; return partition; &#125;&#125;// Driver// æŒ‡å®šè‡ªå®šä¹‰æ•°æ®åˆ†åŒºjob.setPartitionerClass(ProvincePartitioner.class);// åŒæ—¶æŒ‡å®šç›¸åº”æ•°é‡çš„ reduce taskjob.setNumReduceTasks(5);// job.setNumReduceTasks(1) ä¼šæ­£å¸¸è¿è¡Œ,åªä¸è¿‡ä¼šäº§ç”Ÿä¸€ä¸ªè¾“å‡ºæ–‡ä»¶// job.setNumReduceTasks(2) ä¼šæŠ¥é”™// job.setNumReduceTasks(6) å¤§äº 5 ç¨‹åºæ­£å¸¸è¿è¡Œï¼Œä¼šäº§ç”Ÿç©ºæ–‡ä»¶ æ’åºMapTask å’Œ ReduceTask å‡ä¼šå¯¹æ•°æ®æŒ‰ç…§ key è¿›è¡Œæ’åºï¼Œè¯¥æ“ä½œå± Hadoop çš„é»˜è®¤è¡Œä¸ºã€‚ä»»ä½•åº”ç”¨ç¨‹åºä¸­çš„æ•°æ®å‡ä¼šè¢«æ’åºï¼Œè€Œä¸ç®¡é€»è¾‘ä¸Šå¦éœ€è¦ã€‚ é»˜è®¤æ’åºæ˜¯æŒ‰ç…§å­—æ›²é¡ºåºæ’åºï¼Œä¸”å®ç°è¯¥æ’åºçš„æ–¹æ³•æ˜¯å¿«é€Ÿæ’åºã€‚ å¯¹äº MapTaskï¼Œå®ƒä¼šå°†å¤„ç†çš„ç»“æœæš‚æ—¶æ”¾åˆ°ç¯å½¢ç¼“å†²åŒºä¸­ï¼Œå½“ç¯å½¢ç¼“å†²åŒºä½¿ç”¨ç‡è¾¾åˆ°ä¸€å®šé˜ˆå€¼åï¼Œå†å¯¹ç¼“å†²åŒºä¸­çš„æ•°æ®è¿›è¡Œä¸€æ¬¡å¿«é€Ÿæ’åºï¼Œå¹¶å°†è¿™äº›æœ‰åºæ•°æ®æº¢å†™åˆ°ç£ç›˜ä¸Šï¼Œè€Œå½“æ•°æ®å¤„ç†å®Œæ¯•åï¼Œå®ƒä¼šå¯¹ç£ç›˜ä¸Šæ‰€æœ‰æ–‡ä»¶è¿›è¡Œå½’å¹¶æ’åºã€‚ å¯¹äº ReduceTaskï¼Œå®ƒä»æ¯ä¸ª MapTask ä¸Šè¿œç¨‹æ‹·è´ç›¸åº”çš„æ•°æ®æ–‡ä»¶ï¼Œå¦‚æœæ–‡ä»¶å¤§å°è¶…è¿‡ä¸€å®šé˜ˆå€¼ï¼Œåˆ™æº¢å†™ç£ç›˜ä¸Šï¼Œå¦åˆ™å­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚å¦‚æœç£ç›˜ä¸Šæ–‡ä»¶æ•°ç›®è¾¾åˆ°ä¸€å®šé˜ˆå€¼ï¼Œåˆ™è¿›è¡Œä¸€æ¬¡å½’å¹¶æ’åºä»¥ç”Ÿæˆä¸€ä¸ªæ›´å¤§æ–‡ä»¶ï¼›å¦‚æœå†…å­˜ä¸­æ–‡ä»¶å¤§å°æˆ–è€…æ•°ç›®è¶…è¿‡ä¸€å®šé˜ˆå€¼ï¼Œåˆ™è¿›è¡Œä¸€æ¬¡åˆå¹¶åå°†æ•°æ®æº¢å†™åˆ°ç£ç›˜ä¸Šã€‚å½“æ‰€æœ‰æ•°æ®æ‹·è´å®Œæ¯•å, ReduceTask ç»Ÿä¸€å¯¹å†…å­˜å’Œç£ç›˜ä¸Šçš„æ‰€æœ‰æ•°æ®è¿›è¡Œä¸€æ¬¡å½’å¹¶æ’åºã€‚ è‡ªå®šä¹‰123456789101112131415161718// bean å¯¹è±¡åšä¸º key ä¼ è¾“ï¼Œéœ€è¦å®ç° WritableComparable æ¥å£é‡å†™ compareTo æ–¹æ³•ï¼Œå°±å¯ä»¥å®ç°æ’åº@Overridepublic int compareTo(FlowBean o) &#123; int result; // æŒ‰ç…§æ€»æµé‡å¤§å°ï¼Œå€’åºæ’åˆ— if (sumFlow &gt; bean.getSumFlow()) &#123; result = -1; &#125;else if (sumFlow &lt; bean.getSumFlow()) &#123; result = 1; &#125;else &#123; result = 0; &#125; return result;&#125; åˆå¹¶ Combiner ç»„ä»¶çš„çˆ¶ç±»å°±æ˜¯ Reducerã€‚Combiner æ˜¯åœ¨æ¯ä¸€ä¸ª MapTask æ‰€åœ¨çš„èŠ‚ç‚¹è¿è¡Œï¼Œè¿›è¡Œå±€éƒ¨æ±‡æ€»ï¼Œå‡å°‘ç½‘ç»œä¼ è¾“é‡ï¼›Reducer æ˜¯æ¥æ”¶å…¨å±€æ‰€æœ‰ Mapper çš„è¾“å‡ºç»“æœã€‚ 123456789101112131415161718192021// è‡ªå®šä¹‰ä¸€ä¸ª Combiner ç»§æ‰¿ Reducerï¼Œé‡å†™ Reduce æ–¹æ³•// Combiner K V å¯¹åº” Reducer K Vpublic class WordcountCombiner extends Reducer&lt;Text, IntWritable, Text , IntWritable&gt;&#123; @Override protected void reduce(Text key, Iterable&lt;IntWritable&gt; values,Context context) throws IOException, InterruptedException &#123; // æ±‡æ€»æ“ä½œ int count = 0; for(IntWritable v : values)&#123; count += v.get(); &#125; // å†™å‡º context.write(key, new IntWritable(count)); &#125;&#125;// Driverjob.setCombinerClass(WordcountCombiner.class); åˆ†ç»„ å¯¹ Reduce é˜¶æ®µçš„æ•°æ®æ ¹æ®æŸä¸€ä¸ªæˆ–å‡ ä¸ªå­—æ®µè¿›è¡Œåˆ†ç»„ã€‚ è‡ªå®šä¹‰ç±»ç»§æ‰¿ WritableComparatorï¼›é‡å†™ compare() æ–¹æ³•ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354// OrderBeanpublic class OrderBean implements WritableComparable&lt;OrderBean&gt; &#123; private int order_id; // è®¢å•idå· private double price; // ä»·æ ¼ public OrderBean() &#123; super(); &#125; public OrderBean(int order_id, double price) &#123; super(); this.order_id = order_id; this.price = price; &#125; // åºåˆ—åŒ– @Override public void write(DataOutput out) throws IOException &#123; out.writeInt(order_id); out.writeDouble(price); &#125; // ååºåˆ—åŒ– @Override public void readFields(DataInput in) throws IOException &#123; order_id = in.readInt(); price = in.readDouble(); &#125; @Override public String toString() &#123; return order_id + \"\\t\" + price; &#125; // Getter / Setter // äºŒæ¬¡æ’åºï¼Œå³ map ç»“æŸä¹‹å‰çš„ä¸€æ¬¡æ’åºï¼Œæ’åºåè¾“å‡ºåˆ° reduce @Override public int compareTo(OrderBean o) &#123; int result; if (order_id &gt; o.getOrder_id()) &#123; result = 1; &#125; else if (order_id &lt; o.getOrder_id()) &#123; result = -1; &#125; else &#123; // ä»·æ ¼å€’åºæ’åº result = price &gt; o.getPrice() ? -1 : 1; &#125; return result; &#125;&#125; 123456789101112131415161718192021222324// ç¼–å†™ OrderSortMapper ç±»// 0000001 Pdt_01 222.8public class OrderMapper extends Mapper&lt;LongWritable, Text, OrderBean, NullWritable&gt; &#123; OrderBean k = new OrderBean(); @Override protected void map(LongWritable key, Text value, Context context) throws IOException, InterruptedException &#123; // è·å–ä¸€è¡Œ String line = value.toString(); // æˆªå– String[] fields = line.split(\"\\t\"); // å°è£…å¯¹è±¡ k.setOrder_id(Integer.parseInt(fields[0])); k.setPrice(Double.parseDouble(fields[2])); // å†™å‡º context.write(k, NullWritable.get()); &#125;&#125; 12345678910111213141516171819202122232425262728// ç¼–å†™ OrderSortGroupingComparator ç±»// åœ¨ reduce å‰é€šè¿‡æ­¤æ’åºè¿›è¡Œåˆ†ç»„public class OrderGroupingComparator extends WritableComparator &#123; // åˆ›å»ºä¸€ä¸ªæ„é€ å°†æ¯”è¾ƒå¯¹è±¡çš„ç±»ä¼ ç»™çˆ¶ç±» protected OrderGroupingComparator() &#123; super(OrderBean.class, true); &#125; @Override public int compare(WritableComparable a, WritableComparable b) &#123; OrderBean aBean = (OrderBean) a; OrderBean bBean = (OrderBean) b; int result; if (aBean.getOrder_id() &gt; bBean.getOrder_id()) &#123; result = 1; &#125; else if (aBean.getOrder_id() &lt; bBean.getOrder_id()) &#123; result = -1; &#125; else &#123; result = 0; &#125; return result; &#125;&#125; 123456789101112131415// ç¼–å†™ OrderSortReducer ç±»public class OrderReducer extends Reducer&lt;OrderBean, NullWritable, OrderBean, NullWritable&gt; &#123; @Override protected void reduce(OrderBean key, Iterable&lt;NullWritable&gt; values, Context context) throws IOException, InterruptedException &#123; // åªèƒ½é€šè¿‡ NullWritable.get() è·å–ç©ºå€¼ context.write(key, NullWritable.get()); &#125;&#125;// Driver// è®¾ç½® reduce ç«¯çš„åˆ†ç»„job.setGroupingComparatorClass(OrderGroupingComparator.class); MapTaskRead é˜¶æ®µï¼šMapTask é€šè¿‡ç”¨æˆ·ç¼–å†™çš„ RecordReaderï¼Œä»è¾“å…¥ InputSplit ä¸­è§£æå‡ºä¸€ä¸ªä¸ª key / valueï¼› Map é˜¶æ®µï¼šè¯¥é˜¶æ®µä¸»è¦æ˜¯å°†è§£æå‡ºçš„ key / value äº¤ç»™ç”¨æˆ·ç¼–å†™ map() å‡½æ•°å¤„ç†ï¼Œå¹¶äº§ç”Ÿä¸€ç³»åˆ—æ–°çš„ key / valueï¼› Collect æ”¶é›†é˜¶æ®µï¼šåœ¨ç”¨æˆ·ç¼–å†™ map() å‡½æ•°ä¸­ï¼Œå½“æ•°æ®å¤„ç†å®Œæˆåï¼Œä¸€èˆ¬ä¼šè°ƒç”¨ OutputCollector.collect() è¾“å‡ºç»“æœã€‚åœ¨è¯¥å‡½æ•°å†…éƒ¨ï¼Œå®ƒä¼šå°†ç”Ÿæˆçš„ key / value åˆ†åŒºï¼ˆè°ƒç”¨ Partitionerï¼‰ï¼Œå¹¶å†™å…¥ä¸€ä¸ªç¯å½¢å†…å­˜ç¼“å†²åŒºä¸­ï¼› Spill é˜¶æ®µï¼šå³â€œæº¢å†™â€ï¼Œå½“ç¯å½¢ç¼“å†²åŒºæ»¡åï¼ŒMapReduce ä¼šå°†æ•°æ®å†™åˆ°æœ¬åœ°ç£ç›˜ä¸Šï¼Œç”Ÿæˆä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå°†æ•°æ®å†™å…¥æœ¬åœ°ç£ç›˜ä¹‹å‰ï¼Œå…ˆè¦å¯¹æ•°æ®è¿›è¡Œä¸€æ¬¡æœ¬åœ°æ’åºï¼Œå¹¶åœ¨å¿…è¦æ—¶å¯¹æ•°æ®è¿›è¡Œåˆå¹¶ã€å‹ç¼©ç­‰æ“ä½œã€‚ æº¢å†™é˜¶æ®µè¯¦æƒ…ï¼š åˆ©ç”¨å¿«é€Ÿæ’åºç®—æ³•å¯¹ç¼“å­˜åŒºå†…çš„æ•°æ®è¿›è¡Œæ’åºï¼Œæ’åºæ–¹å¼æ˜¯ï¼Œå…ˆæŒ‰ç…§åˆ†åŒºç¼–å· Partition è¿›è¡Œæ’åºï¼Œç„¶åæŒ‰ç…§ key è¿›è¡Œæ’åºã€‚è¿™æ ·ï¼Œç»è¿‡æ’åºåï¼Œæ•°æ®ä»¥åˆ†åŒºä¸ºå•ä½èšé›†åœ¨ä¸€èµ·ï¼Œä¸”åŒä¸€åˆ†åŒºå†…æ‰€æœ‰æ•°æ®æŒ‰ç…§ key æœ‰åºã€‚ æŒ‰ç…§åˆ†åŒºç¼–å·ç”±å°åˆ°å¤§ä¾æ¬¡å°†æ¯ä¸ªåˆ†åŒºä¸­çš„æ•°æ®å†™å…¥ä»»åŠ¡å·¥ä½œç›®å½•ä¸‹çš„ä¸´æ—¶æ–‡ä»¶ output/spillN.outï¼ˆNè¡¨ç¤ºå½“å‰æº¢å†™æ¬¡æ•°ï¼‰ä¸­ã€‚å¦‚æœç”¨æˆ·è®¾ç½®äº† Combinerï¼Œåˆ™å†™å…¥æ–‡ä»¶ä¹‹å‰ï¼Œå¯¹æ¯ä¸ªåˆ†åŒºä¸­çš„æ•°æ®è¿›è¡Œä¸€æ¬¡èšé›†æ“ä½œã€‚ å°†åˆ†åŒºæ•°æ®çš„å…ƒä¿¡æ¯å†™åˆ°å†…å­˜ç´¢å¼•æ•°æ®ç»“æ„ SpillRecord ä¸­ï¼Œå…¶ä¸­æ¯ä¸ªåˆ†åŒºçš„å…ƒä¿¡æ¯åŒ…æ‹¬åœ¨ä¸´æ—¶æ–‡ä»¶ä¸­çš„åç§»é‡ã€å‹ç¼©å‰æ•°æ®å¤§å°å’Œå‹ç¼©åæ•°æ®å¤§å°ã€‚å¦‚æœå½“å‰å†…å­˜ç´¢å¼•å¤§å°è¶…è¿‡ 1MBï¼Œåˆ™å°†å†…å­˜ç´¢å¼•å†™åˆ°æ–‡ä»¶output/spillN.out.index ä¸­ã€‚ Combineé˜¶æ®µï¼šå½“æ‰€æœ‰æ•°æ®å¤„ç†å®Œæˆåï¼ŒMapTask å¯¹æ‰€æœ‰ä¸´æ—¶æ–‡ä»¶è¿›è¡Œä¸€æ¬¡åˆå¹¶ï¼Œä»¥ç¡®ä¿æœ€ç»ˆåªä¼šç”Ÿæˆä¸€ä¸ªæ•°æ®æ–‡ä»¶ã€‚ å½“æ‰€æœ‰æ•°æ®å¤„ç†å®Œåï¼ŒMapTask ä¼šå°†æ‰€æœ‰ä¸´æ—¶æ–‡ä»¶åˆå¹¶æˆä¸€ä¸ªå¤§æ–‡ä»¶ï¼Œå¹¶ä¿å­˜åˆ°æ–‡ä»¶ output/file.out ä¸­ï¼ŒåŒæ—¶ç”Ÿæˆç›¸åº”çš„ç´¢å¼•æ–‡ä»¶ output/file.out.indexã€‚ åœ¨è¿›è¡Œæ–‡ä»¶åˆå¹¶è¿‡ç¨‹ä¸­ï¼ŒMapTask ä»¥åˆ†åŒºä¸ºå•ä½è¿›è¡Œåˆå¹¶ã€‚å¯¹äºæŸä¸ªåˆ†åŒºï¼Œå®ƒå°†é‡‡ç”¨å¤šè½®é€’å½’åˆå¹¶çš„æ–¹å¼ã€‚æ¯è½®åˆå¹¶ io.sort.factorï¼ˆé»˜è®¤10ï¼‰ä¸ªæ–‡ä»¶ï¼Œå¹¶å°†äº§ç”Ÿçš„æ–‡ä»¶é‡æ–°åŠ å…¥å¾…åˆå¹¶åˆ—è¡¨ä¸­ï¼Œå¯¹æ–‡ä»¶æ’åºåï¼Œé‡å¤ä»¥ä¸Šè¿‡ç¨‹ï¼Œç›´åˆ°æœ€ç»ˆå¾—åˆ°ä¸€ä¸ªå¤§æ–‡ä»¶ã€‚ è®©æ¯ä¸ªMapTaskæœ€ç»ˆåªç”Ÿæˆä¸€ä¸ªæ•°æ®æ–‡ä»¶ï¼Œå¯é¿å…åŒæ—¶æ‰“å¼€å¤§é‡æ–‡ä»¶å’ŒåŒæ—¶è¯»å–å¤§é‡å°æ–‡ä»¶äº§ç”Ÿçš„éšæœºè¯»å–å¸¦æ¥çš„å¼€é”€ã€‚ ReduceTaskCopy é˜¶æ®µï¼šReduceTask ä»å„ä¸ª MapTask ä¸Šè¿œç¨‹æ‹·è´ä¸€ç‰‡æ•°æ®ï¼Œå¹¶é’ˆå¯¹æŸä¸€ç‰‡æ•°æ®ï¼Œå¦‚æœå…¶å¤§å°è¶…è¿‡ä¸€å®šé˜ˆå€¼ï¼Œåˆ™å†™åˆ°ç£ç›˜ä¸Šï¼Œå¦åˆ™ç›´æ¥æ”¾åˆ°å†…å­˜ä¸­ã€‚ Merge é˜¶æ®µï¼šåœ¨è¿œç¨‹æ‹·è´æ•°æ®çš„åŒæ—¶ï¼ŒReduceTask å¯åŠ¨äº†ä¸¤ä¸ªåå°çº¿ç¨‹å¯¹å†…å­˜å’Œç£ç›˜ä¸Šçš„æ–‡ä»¶è¿›è¡Œåˆå¹¶ï¼Œä»¥é˜²æ­¢å†…å­˜ä½¿ç”¨è¿‡å¤šæˆ–ç£ç›˜ä¸Šæ–‡ä»¶è¿‡å¤šã€‚ Sort é˜¶æ®µï¼šæŒ‰ç…§ MapReduce è¯­ä¹‰ï¼Œç”¨æˆ·ç¼–å†™ reduce() å‡½æ•°è¾“å…¥æ•°æ®æ˜¯æŒ‰ key è¿›è¡Œèšé›†çš„ä¸€ç»„æ•°æ®ã€‚ä¸ºäº†å°† key ç›¸åŒçš„æ•°æ®èšåœ¨ä¸€èµ·ï¼ŒHadoop é‡‡ç”¨äº†åŸºäºæ’åºçš„ç­–ç•¥ã€‚ç”±äºå„ä¸ª MapTask å·²ç»å®ç°å¯¹è‡ªå·±çš„å¤„ç†ç»“æœè¿›è¡Œäº†å±€éƒ¨æ’åºï¼Œå› æ­¤ï¼ŒReduceTask åªéœ€å¯¹æ‰€æœ‰æ•°æ®è¿›è¡Œä¸€æ¬¡å½’å¹¶æ’åºå³å¯ã€‚ Reduce é˜¶æ®µï¼šreduce() å‡½æ•°å°†è®¡ç®—ç»“æœå†™åˆ° HDFSä¸Šã€‚ ReduceTask çš„å¹¶è¡Œåº¦åŒæ ·å½±å“æ•´ä¸ª Job çš„æ‰§è¡Œå¹¶å‘åº¦å’Œæ‰§è¡Œæ•ˆç‡ï¼Œä½†ä¸ MapTask çš„å¹¶å‘æ•°ç”±åˆ‡ç‰‡æ•°å†³å®šä¸åŒï¼ŒReduceTask æ•°é‡çš„å†³å®šæ˜¯å¯ä»¥ç›´æ¥æ‰‹åŠ¨è®¾ç½®ã€‚ 12// é»˜è®¤å€¼æ˜¯ 1ï¼Œæ‰‹åŠ¨è®¾ç½®ä¸º 4job.setNumReduceTasks(4); å·¥ä½œæµç¨‹ Hadoop åºåˆ—åŒ–åºåˆ—åŒ–å°±æ˜¯æŠŠå†…å­˜ä¸­çš„å¯¹è±¡ï¼Œè½¬æ¢æˆå­—èŠ‚åºåˆ—ï¼ˆæˆ–å…¶ä»–æ•°æ®ä¼ è¾“åè®®ï¼‰ä»¥ä¾¿äºå­˜å‚¨åˆ°ç£ç›˜ï¼ˆæŒä¹…åŒ–ï¼‰å’Œç½‘ç»œä¼ è¾“ã€‚ååºåˆ—åŒ–å°±æ˜¯åºåˆ—åŒ–çš„é€†è¿‡ç¨‹ã€‚ Java çš„åºåˆ—åŒ–æ˜¯ä¸€ä¸ªé‡é‡çº§åºåˆ—åŒ–æ¡†æ¶ï¼ˆSerializableï¼‰ï¼Œä¸€ä¸ªå¯¹è±¡è¢«åºåˆ—åŒ–åä¼šé™„å¸¦å¾ˆå¤šé¢å¤–çš„ä¿¡æ¯ï¼ˆå„ç§æ ¡éªŒä¿¡æ¯ã€Headerã€ç»§æ‰¿ä½“ç³»ç­‰ï¼‰ä¸ä¾¿äºåœ¨ç½‘ç»œä¸­é«˜ä¼ è¾“ã€‚ æ‰€ä»¥ Hadoop è‡ªå·±å¼€å‘äº†ä¸€å¥—åºåˆ—åŒ–æœºåˆ¶ï¼ˆWritableï¼‰ã€‚ ç´§å‡‘ï¼šé«˜æ•ˆä½¿ç”¨å­˜å‚¨ç©ºé—´ï¼› å¿«é€Ÿï¼šè¯»å†™æ•°æ®çš„é¢å¤–å¼€é”€å°ï¼› å¯æ‰©å±•ï¼šéšç€é€šä¿¡åè®®çš„å‡çº§è€Œå¯å‡çº§ï¼› äº’æ“ä½œï¼šæ”¯æŒå¤šè¯­è¨€çš„äº¤äº’ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445// è‡ªå®šä¹‰ bean å¯¹è±¡å®ç°åºåˆ—åŒ–æ¥å£// å®ç° writable æ¥å£public class FlowBean implements Writable&#123; private long upFlow; private long downFlow; private long sumFlow; // ååºåˆ—åŒ–æ—¶ï¼Œéœ€è¦åå°„è°ƒç”¨ç©ºå‚æ„é€ å‡½æ•°ï¼Œæ‰€ä»¥å¿…é¡»æœ‰ public FlowBean() &#123; super(); &#125; public FlowBean(long upFlow, long downFlow) &#123; super(); this.upFlow = upFlow; this.downFlow = downFlow; this.sumFlow = upFlow + downFlow; &#125; // å†™åºåˆ—åŒ–æ–¹æ³• @Override public void write(DataOutput out) throws IOException &#123; out.writeLong(upFlow); out.writeLong(downFlow); out.writeLong(sumFlow); &#125; // ååºåˆ—åŒ–æ–¹æ³• // ååºåˆ—åŒ–æ–¹æ³•è¯»é¡ºåºå¿…é¡»å’Œå†™åºåˆ—åŒ–æ–¹æ³•çš„å†™é¡ºåºå¿…é¡»ä¸€è‡´ @Override public void readFields(DataInput in) throws IOException &#123; this.upFlow = in.readLong(); this.downFlow = in.readLong(); this.sumFlow = in.readLong(); &#125; // ç¼–å†™toStringæ–¹æ³•ï¼Œæ–¹ä¾¿åç»­æ‰“å°åˆ°æ–‡æœ¬ @Override public String toString() &#123; return upFlow + \"\\t\" + downFlow + \"\\t\" + sumFlow; &#125; // Getter / Setter&#125; InputFormatMapTask å¹¶è¡Œåº¦å†³å®šæœºåˆ¶ï¼š æ•°æ®å—ï¼šBlock æ˜¯ HDFS ç‰©ç†ä¸ŠæŠŠæ•°æ®åˆ†æˆä¸€å—ä¸€å—ã€‚ æ•°æ®åˆ‡ç‰‡ï¼šæ•°æ®åˆ‡ç‰‡åªæ˜¯åœ¨é€»è¾‘ä¸Šå¯¹è¾“å…¥è¿›è¡Œåˆ†ç‰‡ï¼Œå¹¶ä¸ä¼šåœ¨ç£ç›˜ä¸Šå°†å…¶åˆ‡åˆ†æˆç‰‡è¿›è¡Œå­˜å‚¨ã€‚åˆ‡ç‰‡æ—¶ä¸è€ƒè™‘æ•°æ®é›†æ•´ä½“ï¼Œè€Œæ˜¯é€ä¸ªé’ˆå¯¹æ¯ä¸€ä¸ªæ–‡ä»¶å•ç‹¬åˆ‡ç‰‡ã€‚ Block çš„å¤§å°ï¼šlocal 32 1.x 64 2.x 128 FileInputFormatTextInputFormat æ˜¯é»˜è®¤çš„ FilelnputFormat å®ç°ç±»ã€‚æŒ‰è¡Œè¯»å–æ¯æ¡è®°å½•ã€‚é”®æ˜¯å­˜å‚¨è¯¥è¡Œåœ¨æ•´ä¸ªæ–‡ä»¶ä¸­çš„èµ·å§‹å­—èŠ‚åç§»é‡ï¼ŒLong writableç±»å‹ã€‚å€¼æ˜¯è¿™è¡Œçš„å†…å®¹ï¼Œä¸åŒ…æ‹¬ä»»ä½•è¡Œç»ˆæ­¢ç¬¦ï¼ˆæ¢è¡Œç¬¦å’Œå›è½¦ç¬¦ï¼‰Text ç±»å‹ã€‚ 123456789101112131415161718192021222324252627282930313233343536// æºç  Debug ä¸»è¦æµç¨‹waitForCompletion()submit(); // å»ºç«‹è¿æ¥ connect(); // åˆ›å»ºæäº¤ Job çš„ä»£ç† new Cluster(getConfiguration()); // åˆ¤æ–­æ˜¯ LocalJobRunner è¿˜æ˜¯ YarnRunner initialize(jobTrackAddr, conf); // æäº¤ job submitter.submitJobInternal(Job.this, cluster) // åˆ›å»ºç»™é›†ç¾¤æäº¤æ•°æ®çš„ Stag è·¯å¾„ Path jobStagingArea = JobSubmissionFiles.getStagingDir(cluster, conf); // è·å– jobid ï¼Œå¹¶åˆ›å»º Job è·¯å¾„ JobID jobId = submitClient.getNewJobID(); // æ‹·è´ jar åŒ…åˆ°é›†ç¾¤ copyAndConfigureFiles(job, submitJobDir); rUploader.uploadFiles(job, jobSubmitDir); // è®¡ç®—åˆ‡ç‰‡ï¼Œç”Ÿæˆåˆ‡ç‰‡è§„åˆ’æ–‡ä»¶ writeSplits(job, submitJobDir); maps = writeNewSplits(job, jobSubmitDir); input.getSplits(job); // å‘ Stag è·¯å¾„å†™ XML é…ç½®æ–‡ä»¶ writeConf(conf, submitJobFile); conf.writeXml(out); // æäº¤ Jobï¼Œè¿”å›æäº¤çŠ¶æ€ status = submitClient.submitJob(jobId, submitJobDir.toString(), job.getCredentials()); 12345// è·å–åˆ‡ç‰‡ä¿¡æ¯ API// è·å–åˆ‡ç‰‡æ–‡ä»¶åç§°String name = inputSplit.getPath().getName();// æ ¹æ®æ–‡ä»¶ç±»å‹è·å–åˆ‡ç‰‡ä¿¡æ¯FileSplit inputSpli = (FileSplit)context. getInputSplit() CombineTextæ¡†æ¶é»˜è®¤çš„ TextInputFormat åˆ‡ç‰‡æœºåˆ¶æ˜¯å¯¹ä»»åŠ¡æŒ‰æ–‡ä»¶è§„åˆ’åˆ‡ç‰‡ï¼Œä¸ç®¡æ–‡ä»¶å¤šå°ï¼Œéƒ½ä¼šæ˜¯ä¸€ä¸ªå•ç‹¬çš„åˆ‡ç‰‡ï¼Œéƒ½ä¼šäº¤ç»™ä¸€ä¸ª MapTaskï¼Œè¿™æ ·å¦‚æœæœ‰å¤§é‡å°æ–‡ä»¶ï¼Œå°±ä¼šäº§ç”Ÿå¤§é‡çš„ MapTaskï¼Œå¤„ç†æ•ˆç‡æå…¶ä½ä¸‹ã€‚ CombineTextInputFormat ç”¨äºå°æ–‡ä»¶è¿‡å¤šçš„åœºæ™¯ï¼Œå®ƒå¯ä»¥å°†å¤šä¸ªå°æ–‡ä»¶ä»é€»è¾‘ä¸Šè§„åˆ’åˆ°ä¸€ä¸ªåˆ‡ç‰‡ä¸­ï¼Œè¿™æ ·ï¼Œå¤šä¸ªå°æ–‡ä»¶å°±å¯ä»¥äº¤ç»™ä¸€ä¸ª MapTask å¤„ç†ã€‚ 12345// å¦‚æœä¸è®¾ç½® InputFormatï¼Œå®ƒé»˜è®¤ç”¨çš„æ˜¯ TextInputFormat.classjob.setInputFormatClass(CombineTextInputFormat.class);// è™šæ‹Ÿå­˜å‚¨åˆ‡ç‰‡æœ€å¤§å€¼è®¾ç½®CombineTextInputFormat.setMaxInputSplitSize(job, 4194304); // 4m å°†è¾“å…¥ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶å¤§å°ï¼Œä¾æ¬¡å’Œè®¾ç½®çš„ setMaxInputSplitSize å€¼æ¯”è¾ƒï¼Œå¦‚æœä¸å¤§äºè®¾ç½®çš„æœ€å¤§å€¼ï¼Œé€»è¾‘ä¸Šåˆ’åˆ†ä¸€ä¸ªå—ã€‚å¦‚æœè¾“å…¥æ–‡ä»¶å¤§äºè®¾ç½®çš„æœ€å¤§å€¼ä¸”å¤§äºä¸¤å€ï¼Œé‚£ä¹ˆä»¥æœ€å¤§å€¼åˆ‡å‰²ä¸€å—ï¼›å½“å‰©ä½™æ•°æ®å¤§å°è¶…è¿‡è®¾ç½®çš„æœ€å¤§å€¼ä¸”ä¸å¤§äºæœ€å¤§å€¼ 2 å€ï¼Œæ­¤æ—¶å°†æ–‡ä»¶å‡åˆ†æˆ 2 ä¸ªè™šæ‹Ÿå­˜å‚¨å—ï¼ˆé˜²æ­¢å‡ºç°å¤ªå°åˆ‡ç‰‡ï¼‰ã€‚ KeyValueText KeyValueTextInputFormat æ¯ä¸€è¡Œå‡ä¸ºä¸€æ¡è®°å½•è¢«åˆ†éš”ç¬¦åˆ†å‰²ä¸º K Vã€‚å¯ä»¥é€šè¿‡åœ¨é©±åŠ¨ç±»ä¸­è®¾å®šåˆ†éš”ç¬¦ã€‚é»˜è®¤åˆ†éš”ç¬¦æ˜¯ tabï¼ˆ\\tï¼‰ã€‚ 1conf.set(KeyValueLineRecordReader.KEY_VALUE_SEPERATOR,\"\\t\") 1234567891011121314// éœ€æ±‚ï¼šç»Ÿè®¡è¾“å…¥æ–‡ä»¶ä¸­æ¯ä¸€è¡Œçš„ç¬¬ä¸€ä¸ªå•è¯ç›¸åŒçš„è¡Œæ•°// Mapper ç¼–å†™public class KVTextMapper extends Mapper&lt;Text, Text, Text, LongWritable&gt;&#123; // è®¾ç½® value LongWritable v = new LongWritable(1); @Override protected void map(Text key, Text value, Context context) throws IOException, InterruptedException &#123; // å†™å‡º (ç¬¬ä¸€ä¸ªå•è¯, 1) context.write(key, v); &#125;&#125; 123456789101112131415161718192021public class KVTextReducer extends Reducer&lt;Text, LongWritable, Text, LongWritable&gt;&#123; LongWritable v = new LongWritable(); @Override protected void reduce(Text key, Iterable&lt;LongWritable&gt; values, Context context) throws IOException, InterruptedException &#123; long sum = 0L; // æ±‡æ€»ç»Ÿè®¡ for (LongWritable value : values) &#123; sum += value.get(); &#125; v.set(sum); // è¾“å‡º context.write(key, v); &#125;&#125; 123456789101112131415161718192021222324252627282930313233343536public class KVTextDriver &#123; public static void main(String[] args) throws IOException, ClassNotFoundException, InterruptedException &#123; Configuration conf = new Configuration(); // è®¾ç½®åˆ‡å‰²ç¬¦ conf.set(KeyValueLineRecordReader.KEY_VALUE_SEPERATOR, \" \"); // è·å– job å¯¹è±¡ Job job = Job.getInstance(conf); // è®¾ç½® jar åŒ…ä½ç½®ï¼Œå…³è” mapper å’Œ reducer job.setJarByClass(KVTextDriver.class); job.setMapperClass(KVTextMapper.class); job.setReducerClass(KVTextReducer.class); // è®¾ç½® map è¾“å‡º k v ç±»å‹ job.setMapOutputKeyClass(Text.class); job.setMapOutputValueClass(LongWritable.class); // è®¾ç½®æœ€ç»ˆè¾“å‡º k v ç±»å‹ job.setOutputKeyClass(Text.class); job.setOutputValueClass(LongWritable.class); // è®¾ç½®è¾“å…¥æ•°æ®è·¯å¾„ FileInputFormat.setInputPaths(job, new Path(args[0])); // è®¾ç½®è¾“å…¥æ ¼å¼ job.setInputFormatClass(KeyValueTextInputFormat.class); // è®¾ç½®è¾“å‡ºæ•°æ®è·¯å¾„ FileOutputFormat.setOutputPath(job, new Path(args[1])); // æäº¤ job job.waitForCompletion(true); &#125;&#125; NLine NLineInputFormat ä»£è¡¨æ¯ä¸ª map è¿›ç¨‹å¤„ç†çš„ InputSplit ä¸å†æŒ‰ Blockå—å»åˆ’åˆ†,è€Œæ˜¯æŒ‰ NLineInputFormat æŒ‡å®šçš„è¡Œæ•°æ¥åˆ’åˆ†ã€‚å³è¾“å…¥æ–‡ä»¶çš„æ€»è¡Œæ•° N = åˆ‡ç‰‡æ•°ï¼Œå¦‚æœä¸æ•´é™¤åˆ™åˆ‡ç‰‡æ•° = å•† + 1ã€‚ 1234567// å¯¹æ¯ä¸ªå•è¯è¿›è¡Œä¸ªæ•°ç»Ÿè®¡,è¦æ±‚æ ¹æ®æ¯ä¸ªè¾“å…¥æ–‡ä»¶çš„è¡Œæ•°æ¥è§„å®šè¾“å‡ºå¤šå°‘ä¸ªåˆ‡ç‰‡ã€‚æ­¤æ¡ˆä¾‹è¦æ±‚æ¯ä¸‰è¡Œæ”¾å…¥ä¸€ä¸ªåˆ‡ç‰‡ä¸­// è®¾ç½®æ¯ä¸ªåˆ‡ç‰‡ InputSplit ä¸­åˆ’åˆ†ä¸‰æ¡è®°å½•NLineInputFormat.setNumLinesPerSplit(job, 3);// ä½¿ç”¨ NLineInputFormat å¤„ç†è®°å½•æ•° job.setInputFormatClass(NLineInputFormat.class); è‡ªå®šä¹‰ æ— è®º HDFS è¿˜æ˜¯ MapReduceï¼Œåœ¨å¤„ç†å°æ–‡ä»¶æ—¶æ•ˆç‡éƒ½éå¸¸ä½ï¼Œä½†åˆéš¾å…é¢ä¸´å¤„ç†å¤§é‡å°æ–‡ä»¶çš„åœºæ™¯ï¼Œæ­¤æ—¶ï¼Œå°±éœ€è¦æœ‰ç›¸åº”è§£å†³æ–¹æ¡ˆã€‚å¯ä»¥è‡ªå®šä¹‰ InputFormat å®ç°å°æ–‡ä»¶çš„åˆå¹¶ã€‚ 123456789101112131415161718192021222324252627/** * å°†å¤šä¸ªå°æ–‡ä»¶åˆå¹¶æˆä¸€ä¸ª SequenceFile æ–‡ä»¶ * SequenceFile æ–‡ä»¶æ˜¯ Hadoop ç”¨æ¥å­˜å‚¨äºŒè¿›åˆ¶å½¢å¼çš„ key-value å¯¹çš„æ–‡ä»¶æ ¼å¼ * SequenceFile é‡Œé¢å­˜å‚¨ç€å¤šä¸ªæ–‡ä»¶ï¼Œå­˜å‚¨çš„å½¢å¼ä¸ºï¼ˆæ–‡ä»¶è·¯å¾„ + åç§°ï¼‰keyï¼Œæ–‡ä»¶å†…å®¹ value*/// è‡ªå®šä¹‰ InputFormat// å®šä¹‰ç±»ç»§æ‰¿ FileInputFormatpublic class WholeFileInputformat extends FileInputFormat&lt;Text, BytesWritable&gt;&#123; // å®šä¹‰æ˜¯å¦å¯åˆ‡å‰²ï¼Œæ­¤ç¨‹åºä¸å¯åˆ‡ç‰‡ï¼Œæœ€ç»ˆæŠŠæ‰€æœ‰æ–‡ä»¶å°è£…åˆ°äº† value ä¸­ @Override protected boolean isSplitable(JobContext context, Path filename) &#123; return false; &#125; // å®ç°ä¸€æ¬¡è¯»å–ä¸€ä¸ªå®Œæ•´æ–‡ä»¶å°è£…ä¸º K V @Override public RecordReader&lt;Text, BytesWritable&gt; createRecordReader( InputSplit split, TaskAttemptContext context) throws IOException, InterruptedException &#123; WholeRecordReader recordReader = new WholeRecordReader(); recordReader.initialize(split, context); return recordReader; &#125;&#125; 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182// è‡ªå®šä¹‰ RecordReader ç±»public class WholeRecordReader extends RecordReader&lt;Text, BytesWritable&gt;&#123; private Configuration configuration; private FileSplit split; private boolean isProgress = true; private BytesWritable value = new BytesWritable(); private Text k = new Text(); @Override public void initialize(InputSplit split, TaskAttemptContext context) throws IOException, InterruptedException &#123; // åˆå§‹åŒ–æ•°æ®ä»¥åŠé…ç½® this.split = (FileSplit)split; configuration = context.getConfiguration(); &#125; // æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œå³æ‹¼æ¥è‡ªå®šä¹‰çš„ K @Override public boolean nextKeyValue() throws IOException, InterruptedException &#123; if (isProgress) &#123; // å®šä¹‰ç¼“å­˜åŒºï¼Œè·å–åˆ‡ç‰‡é•¿åº¦ byte[] contents = new byte[(int)split.getLength()]; FileSystem fs = null; FSDataInputStream fis = null; try &#123; // è·å–æ–‡ä»¶ç³»ç»Ÿï¼Œé€šè¿‡è·¯å¾„è·å–æ–‡ä»¶ç³»ç»Ÿï¼Œä¸€æ³¢åå‘æ“ä½œ Path path = split.getPath(); fs = path.getFileSystem(configuration); // è¯»å–æ•°æ® fis = fs.open(path); // è¯»å–æ–‡ä»¶å†…å®¹ IOUtils.readFully(fis, contents, 0, contents.length); // è¾“å‡ºæ–‡ä»¶å†…å®¹ value.set(contents, 0, contents.length); // è·å–æ–‡ä»¶è·¯å¾„åŠåç§° String name = split.getPath().toString(); // è®¾ç½®è¾“å‡ºçš„ key å€¼ k.set(name); &#125; catch (Exception e) &#123; &#125;finally &#123; IOUtils.closeStream(fis); &#125; // æœ¬åˆ‡ç‰‡å·²å¤„ç†å®Œï¼Œæ¸…æ ‡è®°ä½ isProgress = false; // è¿›è¡Œå…¶å®ƒåˆ‡ç‰‡çš„å¤„ç† return true; &#125; return false; &#125; @Override public Text getCurrentKey() throws IOException, InterruptedException &#123; return k; &#125; @Override public BytesWritable getCurrentValue() throws IOException, InterruptedException &#123; return value; &#125; @Override public float getProgress() throws IOException, InterruptedException &#123; return 0; &#125; @Override public void close() throws IOException &#123; &#125;&#125; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263// ç¼–å†™ SequenceFileMapper ç±»å¤„ç†æµç¨‹public class SequenceFileMapper extends Mapper&lt;Text, BytesWritable, Text, BytesWritable&gt;&#123; @Override protected void map(Text key, BytesWritable value, Context context) throws IOException, InterruptedException &#123; context.write(key, value); &#125;&#125;// ç¼–å†™ SequenceFileReducer ç±»å¤„ç†æµç¨‹public class SequenceFileReducer extends Reducer&lt;Text, BytesWritable, Text, BytesWritable&gt; &#123; @Override protected void reduce(Text key, Iterable&lt;BytesWritable&gt; values, Context context) throws IOException, InterruptedException &#123; context.write(key, values.iterator().next()); &#125;&#125;// ç¼–å†™SequenceFileDriverç±»å¤„ç†æµç¨‹public class SequenceFileDriver &#123; public static void main(String[] args) throws IOException, ClassNotFoundException, InterruptedException &#123; // è¾“å…¥è¾“å‡ºè·¯å¾„éœ€è¦æ ¹æ®è‡ªå·±ç”µè„‘ä¸Šå®é™…çš„è¾“å…¥è¾“å‡ºè·¯å¾„è®¾ç½® args = new String[] &#123; \"e:/input/inputinputformat\", \"e:/output1\" &#125;; // è·å– job å¯¹è±¡ Configuration conf = new Configuration(); Job job = Job.getInstance(conf); // è®¾ç½® jar åŒ…å­˜å‚¨ä½ç½®ã€å…³è”è‡ªå®šä¹‰çš„ mapper å’Œ reducer job.setJarByClass(SequenceFileDriver.class); job.setMapperClass(SequenceFileMapper.class); job.setReducerClass(SequenceFileReducer.class); // è®¾ç½®è¾“å…¥çš„ inputFormat job.setInputFormatClass(WholeFileInputformat.class); // è®¾ç½®è¾“å‡ºçš„ outputFormat job.setOutputFormatClass(SequenceFileOutputFormat.class); // è®¾ç½® map è¾“å‡ºç«¯çš„ K V ç±»å‹ job.setMapOutputKeyClass(Text.class); job.setMapOutputValueClass(BytesWritable.class); // è®¾ç½®æœ€ç»ˆè¾“å‡ºç«¯çš„ K V ç±»å‹ job.setOutputKeyClass(Text.class); job.setOutputValueClass(BytesWritable.class); // è®¾ç½®è¾“å…¥è¾“å‡ºè·¯å¾„ FileInputFormat.setInputPaths(job, new Path(args[0])); FileOutputFormat.setOutputPath(job, new Path(args[1])); // æäº¤ job boolean result = job.waitForCompletion(true); System.exit(result ? 0 : 1); &#125;&#125; OutputFormaté»˜è®¤çš„è¾“å‡ºæ ¼å¼æ˜¯ TextOutputFormat ï¼Œå®ƒæŠŠæ¯æ¡è®°å½•å†™ä¸ºæ–‡æœ¬è¡Œï¼Œå®ƒçš„é”®å’Œå€¼å¯ä»¥æ˜¯ä»»æ„ç±»å‹ï¼Œå› ä¸º TextOutputFormatè°ƒç”¨ toString() æ–¹æ³•æŠŠå®ƒä»¬è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚ å°† SequenceFileOutputFormat è¾“å‡ºä½œä¸ºåç»­ MapReduce ä»»åŠ¡çš„è¾“å…¥ï¼Œå› ä¸ºå…¶æ ¼å¼ç´§å‡‘ï¼Œå¾ˆå®¹æ˜“è¢«å‹ç¼©ã€‚ è‡ªå®šä¹‰ ä¸ºäº†å®ç°æ§åˆ¶æœ€ç»ˆæ–‡ä»¶çš„è¾“å²€è·¯å¾„å’Œè¾“å‡ºæ ¼å¼ï¼Œå¯è¿›è¡Œè‡ªå®šä¹‰ã€‚ è‡ªå®šä¹‰ä¸€ä¸ªç±»ç»§æ‰¿ FileOutputFormatï¼›æ”¹å†™ RecordWriterï¼Œå…·ä½“æ”¹å†™è¾“å‡ºæ•°æ®çš„æ–¹æ³• write()ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162// ç»§æ‰¿ FileOutputFormatpublic class FilterOutputFormat extends FileOutputFormat&lt;Text, NullWritable&gt;&#123; @Override public RecordWriter&lt;Text, NullWritable&gt; getRecordWriter(TaskAttemptContext job) throws IOException, InterruptedException &#123; // åˆ›å»ºä¸€ä¸ªRecordWriter return new FilterRecordWriter(job); &#125;&#125;// é‡å†™ write()public class FilterRecordWriter extends RecordWriter&lt;Text, NullWritable&gt; &#123; FSDataOutputStream wingoOut = null; FSDataOutputStream otherOut = null; public FilterRecordWriter(TaskAttemptContext job) &#123; FileSystem fs; try &#123; // è·å–æ–‡ä»¶ç³»ç»Ÿ fs = FileSystem.get(job.getConfiguration()); // åˆ›å»ºè¾“å‡ºæ–‡ä»¶è·¯å¾„ Path wingoPath = new Path(\"e:/wingo.log\"); Path otherPath = new Path(\"e:/other.log\"); // åˆ›å»ºè¾“å‡ºæµ atguiguOut = fs.create(wingoPath); otherOut = fs.create(otherPath); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; @Override public void write(Text key, NullWritable value) throws IOException, InterruptedException &#123; // åˆ¤æ–­æ˜¯å¦åŒ…å« wingo è¾“å‡ºåˆ°ä¸åŒæ–‡ä»¶ if (key.toString().contains(\"wingo\")) &#123; wingoOut.write(key.toString().getBytes()); &#125; else &#123; otherOut.write(key.toString().getBytes()); &#125; &#125; @Override public void close(TaskAttemptContext context) throws IOException, InterruptedException &#123; // å…³é—­èµ„æº IOUtils.closeStream(wingoOut); IOUtils.closeStream(otherOut); &#125;&#125;// å°†è‡ªå®šä¹‰çš„è¾“å‡ºæ ¼å¼ç»„ä»¶è®¾ç½®åˆ° job ä¸­job.setOutputFormatClass(FilterOutputFormat.class);// è™½ç„¶æˆ‘ä»¬è‡ªå®šä¹‰äº† outputformatï¼Œä½†æ˜¯å› ä¸ºæˆ‘ä»¬çš„ outputformat ç»§æ‰¿è‡ª fileoutputformat// è€Œ fileoutputformat è¦è¾“å‡ºä¸€ä¸ª _SUCCESS æ–‡ä»¶ï¼Œæ‰€ä»¥ï¼Œåœ¨è¿™è¿˜å¾—æŒ‡å®šä¸€ä¸ªè¾“å‡ºç›®å½• Reduce Join order(1001 01 1) join pd(01 å°ç±³) ğŸ‘‰ result(001 å°ç±³ 1) Bean1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950// åˆå¹¶åçš„ Bean ç±»public class TableBean implements Writable &#123; private String order_id; // è®¢å• id private String p_id; // äº§å“ id private int amount; // äº§å“æ•°é‡ private String pname; // äº§å“åç§° private String flag; // è¡¨çš„æ ‡è®° public TableBean() &#123; super(); &#125; public TableBean(String order_id, String p_id, int amount, String pname, String flag) &#123; super(); this.order_id = order_id; this.p_id = p_id; this.amount = amount; this.pname = pname; this.flag = flag; &#125; // Getter / Setter @Override public void write(DataOutput out) throws IOException &#123; out.writeUTF(order_id); out.writeUTF(p_id); out.writeInt(amount); out.writeUTF(pname); out.writeUTF(flag); &#125; @Override public void readFields(DataInput in) throws IOException &#123; this.order_id = in.readUTF(); this.p_id = in.readUTF(); this.amount = in.readInt(); this.pname = in.readUTF(); this.flag = in.readUTF(); &#125; @Override public String toString() &#123; return order_id + \"\\t\" + pname + \"\\t\" + amount + \"\\t\" ; &#125;&#125; Mapper12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849public class TableMapper extends Mapper&lt;LongWritable, Text, Text, TableBean&gt;&#123; String name; TableBean bean = new TableBean(); Text k = new Text(); @Override protected void setup(Context context) throws IOException, InterruptedException &#123; // è·å–è¾“å…¥æ–‡ä»¶åˆ‡ç‰‡ FileSplit split = (FileSplit) context.getInputSplit(); // è·å–è¾“å…¥æ–‡ä»¶åç§° name = split.getPath().getName(); &#125; @Override protected void map(LongWritable key, Text value, Context context) throws IOException, InterruptedException &#123; // è·å–è¾“å…¥æ•°æ® String line = value.toString(); // ä¸åŒæ–‡ä»¶åˆ†åˆ«å¤„ç† if (name.startsWith(\"order\")) &#123;// è®¢å•è¡¨å¤„ç† // åˆ‡å‰² String[] fields = line.split(\"\\t\"); // å°è£…beanå¯¹è±¡ bean.setOrder_id(fields[0]); bean.setP_id(fields[1]); bean.setAmount(Integer.parseInt(fields[2])); bean.setPname(\"\"); bean.setFlag(\"order\"); k.set(fields[1]); &#125;else &#123; // äº§å“è¡¨å¤„ç† // åˆ‡å‰² String[] fields = line.split(\"\\t\"); // å°è£…beanå¯¹è±¡ bean.setP_id(fields[0]); bean.setPname(fields[1]); bean.setFlag(\"pd\"); bean.setAmount(0); bean.setOrder_id(\"\"); k.set(fields[0]); &#125; // å†™å‡º context.write(k, bean); &#125;&#125; Reduce å¤„ç†å‹åŠ›å¤§ï¼Œå¹¶ä¸”ææ˜“äº§ç”Ÿæ•°æ®å€¾æ–œã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940public class TableReducer extends Reducer&lt;Text, TableBean, TableBean, NullWritable&gt; &#123; @Override protected void reduce(Text key, Iterable&lt;TableBean&gt; values, Context context) throws IOException, InterruptedException &#123; // å‡†å¤‡å­˜å‚¨è®¢å•çš„é›†åˆ ArrayList&lt;TableBean&gt; orderBeans = new ArrayList&lt;&gt;(); // å‡†å¤‡ bean å¯¹è±¡ TableBean pdBean = new TableBean(); // ä¾¿åˆ© key = 1 çš„é›†åˆ for (TableBean bean : values) &#123; if (\"order\".equals(bean.getFlag())) &#123; // è®¢å•è¡¨ // æ‹·è´ä¼ é€’è¿‡æ¥çš„æ¯æ¡è®¢å•æ•°æ®åˆ°é›†åˆä¸­ TableBean orderBean = new TableBean(); try &#123; BeanUtils.copyProperties(orderBean, bean); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; orderBeans.add(orderBean); &#125; else &#123; // äº§å“è¡¨ try &#123; // æ­¤å¤„å·²åœ¨ Map åšå¥½æŒ‰ p_id æ’åºå·¥ä½œï¼Œæœ€åä¸€å®šæ˜¯ä¸€ä¸ª pd è¡¨ä¿¡æ¯ // æ‹·è´ä¼ é€’è¿‡æ¥çš„äº§å“è¡¨åˆ°å†…å­˜ä¸­ BeanUtils.copyProperties(pdBean, bean); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125; &#125; // è¡¨çš„æ‹¼æ¥ for(TableBean bean : orderBeans)&#123; bean.setPname (pdBean.getPname()); // æ•°æ®å†™å‡ºå» context.write(bean, NullWritable.get()); &#125; &#125;&#125; Driver1234567891011121314151617181920212223242526272829303132333435public class TableDriver &#123; public static void main(String[] args) throws Exception &#123; // è·¯å¾„ args = new String[]&#123;\"e:/input/inputtable\",\"e:/output1\"&#125;; // è·å–é…ç½®ä¿¡æ¯ï¼Œæˆ–è€… job å¯¹è±¡å®ä¾‹ Configuration configuration = new Configuration(); Job job = Job.getInstance(configuration); // æŒ‡å®šæœ¬ç¨‹åºçš„ jar åŒ…æ‰€åœ¨çš„æœ¬åœ°è·¯å¾„ job.setJarByClass(TableDriver.class); // æŒ‡å®šæœ¬ä¸šåŠ¡ job è¦ä½¿ç”¨çš„ Mapper / Reducer ä¸šåŠ¡ç±» job.setMapperClass(TableMapper.class); job.setReducerClass(TableReducer.class); // æŒ‡å®š Mapper è¾“å‡ºæ•°æ®çš„ k v ç±»å‹ job.setMapOutputKeyClass(Text.class); job.setMapOutputValueClass(TableBean.class); // æŒ‡å®šæœ€ç»ˆè¾“å‡ºçš„æ•°æ®çš„ k v ç±»å‹ job.setOutputKeyClass(TableBean.class); job.setOutputValueClass(NullWritable.class); // æŒ‡å®š job çš„è¾“å…¥åŸå§‹æ–‡ä»¶æ‰€åœ¨ç›®å½• FileInputFormat.setInputPaths(job, new Path(args[0])); FileOutputFormat.setOutputPath(job, new Path(args[1])); // å°† job ä¸­é…ç½®çš„ç›¸å…³å‚æ•°ï¼Œä»¥åŠ job æ‰€ç”¨çš„ java ç±»æ‰€åœ¨çš„ jar åŒ…ï¼Œ æäº¤ç»™ yarn å»è¿è¡Œ boolean result = job.waitForCompletion(true); System.exit(result ? 0 : 1); &#125;&#125; Map Join é€‚ç”¨äºä¸€å¼ è¡¨ååˆ†å°ã€ä¸€å¼ è¡¨å¾ˆå¤§çš„åœºæ™¯ã€‚ é‡‡ç”¨ Distributed cacheï¼šåœ¨ Mapper çš„ setup é˜¶æ®µï¼Œå°†æ–‡ä»¶è¯»å–åˆ°ç¼“å­˜é›†åˆä¸­ã€‚ job.addCacheFile(new URI(â€œfile://e:/cache/pd.txtâ€)); Driver æ·»åŠ ç¼“å­˜æ–‡ä»¶ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041public class TableDriver &#123; public static void main(String[] args) throws Exception &#123; // è·¯å¾„ args = new String[]&#123;\"e:/input/inputtable\",\"e:/output1\"&#125;; // è·å–é…ç½®ä¿¡æ¯ï¼Œæˆ–è€… job å¯¹è±¡å®ä¾‹ Configuration configuration = new Configuration(); Job job = Job.getInstance(configuration); // æŒ‡å®šæœ¬ç¨‹åºçš„ jar åŒ…æ‰€åœ¨çš„æœ¬åœ°è·¯å¾„ job.setJarByClass(TableDriver.class); // æŒ‡å®šæœ¬ä¸šåŠ¡ job è¦ä½¿ç”¨çš„ Mapper / Reducer ä¸šåŠ¡ç±» job.setMapperClass(TableMapper.class); job.setReducerClass(TableReducer.class); // æŒ‡å®š Mapper è¾“å‡ºæ•°æ®çš„ k v ç±»å‹ job.setMapOutputKeyClass(Text.class); job.setMapOutputValueClass(TableBean.class); // æŒ‡å®šæœ€ç»ˆè¾“å‡ºçš„æ•°æ®çš„ k v ç±»å‹ job.setOutputKeyClass(TableBean.class); job.setOutputValueClass(NullWritable.class); // æŒ‡å®š job çš„è¾“å…¥åŸå§‹æ–‡ä»¶æ‰€åœ¨ç›®å½• FileInputFormat.setInputPaths(job, new Path(args[0])); FileOutputFormat.setOutputPath(job, new Path(args[1])); // åŠ è½½ç¼“å­˜æ•°æ® job.addCacheFile(new URI(\"file:///e:/input/inputcache/pd.txt\")); // Map ç«¯ Join çš„é€»è¾‘ä¸éœ€è¦ Reduce é˜¶æ®µï¼Œè®¾ç½® reduceTask æ•°é‡ä¸º 0 job.setNumReduceTasks(0); // å°† job ä¸­é…ç½®çš„ç›¸å…³å‚æ•°ï¼Œä»¥åŠ job æ‰€ç”¨çš„ java ç±»æ‰€åœ¨çš„ jar åŒ…ï¼Œ æäº¤ç»™ yarn å»è¿è¡Œ boolean result = job.waitForCompletion(true); System.exit(result ? 0 : 1); &#125;&#125; Map1234567891011121314151617181920212223242526272829303132333435363738394041424344public class DistributedCacheMapper extends Mapper&lt;LongWritable, Text, Text, NullWritable&gt;&#123; Map&lt;String, String&gt; pdMap = new HashMap&lt;&gt;(); Text k = new Text(); @Override protected void setup(Mapper&lt;LongWritable, Text, Text, NullWritable&gt;.Context context) throws IOException, InterruptedException &#123; // è·å–ç¼“å­˜çš„æ–‡ä»¶ URI[] cacheFiles = context.getCacheFiles(); String path = cacheFiles[0].getPath().toString(); BufferedReader reader = new BufferedReader (new InputStreamReader(new FileInputStream(path), \"UTF-8\")); String line; while(StringUtils.isNotEmpty(line = reader.readLine()))&#123; // åˆ‡å‰² String[] fields = line.split(\"\\t\"); // ç¼“å­˜æ•°æ®åˆ°é›†åˆ (01 å°ç±³) pdMap.put(fields[0], fields[1]); &#125; // å…³æµ reader.close(); &#125; @Override protected void map(LongWritable key, Text value, Context context) throws IOException, InterruptedException &#123; // è·å–ä¸€è¡Œ String line = value.toString(); // æˆªå– String[] fields = line.split(\"\\t\"); // è·å–äº§å“ id String pId = fields[1]; // è·å–å•†å“åç§° String pdName = pdMap.get(pId); // æ‹¼æ¥ k.set(line + \"\\t\"+ pdName); // å†™å‡º context.write(k, NullWritable.get()); &#125;&#125; æ•°æ®æ¸…æ´— ETL Hadoop ä¸ºæ¯ä¸ªä½œä¸šç»´æŠ¤è‹¥å¹²å†…ç½®è®¡æ•°å™¨ï¼Œä»¥æè¿°å¤šé¡¹æŒ‡æ ‡ã€‚ä¾‹å¦‚ï¼ŒæŸäº›è®¡æ•°å™¨è®°å½•å·²å¤„ç†çš„å­—èŠ‚æ•°å’Œè®°å½•æ•°ï¼Œä½¿ç”¨æˆ·å¯ç›‘æ§å·²å¤„ç†çš„è¾“å…¥æ•°æ®é‡å’Œå·²äº§ç”Ÿçš„è¾“å‡ºæ•°æ®é‡ã€‚ Map12345678910111213141516171819202122232425262728293031323334353637383940414243public class LogMapper extends Mapper&lt;LongWritable, Text, Text, NullWritable&gt;&#123; Text k = new Text(); @Override protected void map(LongWritable key, Text value, Context context) throws IOException, InterruptedException &#123; // è·å– 1 è¡Œæ•°æ® String line = value.toString(); // è§£ææ—¥å¿—ï¼Œå³æ­¤æ¡æ—¥å¿—æ˜¯å¦æœ‰æ„ä¹‰ boolean result = parseLog(line,context); // æ—¥å¿—ä¸åˆæ³•é€€å‡º if (!result) &#123; return; &#125; // è®¾ç½® key k.set(line); // å†™å‡ºæ•°æ® context.write(k, NullWritable.get()); &#125; // è§£ææ—¥å¿— private boolean parseLog(String line, Context context) &#123; // æˆªå– String[] fields = line.split(\" \"); // æ—¥å¿—é•¿åº¦å¤§äº 11 çš„ä¸ºåˆæ³• if (fields.length &gt; 11) &#123; // ç³»ç»Ÿè®¡æ•°å™¨ï¼Œè®°å½•ä¸€æ¡åˆæ³•çš„æ—¥å¿— context.getCounter(\"map\", \"true\").increment(1); return true; &#125;else &#123; // è®°å½•ä¸€æ¡ä¸åˆæ³•çš„æ—¥å¿— context.getCounter(\"map\", \"false\").increment(1); return false; &#125; &#125;&#125; Driver1234567891011121314151617181920212223242526272829303132333435363738394041public class TableDriver &#123; public static void main(String[] args) throws Exception &#123; // è·¯å¾„ args = new String[]&#123;\"e:/input/inputlog\", \"e:/output1\"&#125;; // è·å–é…ç½®ä¿¡æ¯ï¼Œæˆ–è€… job å¯¹è±¡å®ä¾‹ Configuration configuration = new Configuration(); Job job = Job.getInstance(configuration); // æŒ‡å®šæœ¬ç¨‹åºçš„ jar åŒ…æ‰€åœ¨çš„æœ¬åœ°è·¯å¾„ job.setJarByClass(TableDriver.class); // æŒ‡å®šæœ¬ä¸šåŠ¡ job è¦ä½¿ç”¨çš„ Mapper / Reducer ä¸šåŠ¡ç±» job.setMapperClass(TableMapper.class); job.setReducerClass(TableReducer.class); // æŒ‡å®š Mapper è¾“å‡ºæ•°æ®çš„ k v ç±»å‹ job.setMapOutputKeyClass(Text.class); job.setMapOutputValueClass(TableBean.class); // æŒ‡å®šæœ€ç»ˆè¾“å‡ºçš„æ•°æ®çš„ k v ç±»å‹ job.setOutputKeyClass(TableBean.class); job.setOutputValueClass(NullWritable.class); // æŒ‡å®š job çš„è¾“å…¥åŸå§‹æ–‡ä»¶æ‰€åœ¨ç›®å½• FileInputFormat.setInputPaths(job, new Path(args[0])); FileOutputFormat.setOutputPath(job, new Path(args[1])); // åŠ è½½ç¼“å­˜æ•°æ® job.addCacheFile(new URI(\"file:///e:/input/inputcache/pd.txt\")); // Map ç«¯ Join çš„é€»è¾‘ä¸éœ€è¦ Reduce é˜¶æ®µï¼Œè®¾ç½® reduceTask æ•°é‡ä¸º 0 job.setNumReduceTasks(0); // å°† job ä¸­é…ç½®çš„ç›¸å…³å‚æ•°ï¼Œä»¥åŠ job æ‰€ç”¨çš„ java ç±»æ‰€åœ¨çš„ jar åŒ…ï¼Œ æäº¤ç»™ yarn å»è¿è¡Œ boolean result = job.waitForCompletion(true); System.exit(result ? 0 : 1); &#125;&#125; æ•°æ®å‹ç¼© é€‚å½“å‹ç¼©æ˜¯æé«˜ Hadoop è¿è¡Œæ•ˆç‡çš„ä¸€ç§ä¼˜åŒ–ç­–ç•¥ã€‚ å‹ç¼©æ ¼å¼ hadoopè‡ªå¸¦ï¼Ÿ ç®—æ³• æ–‡ä»¶æ‰©å±•å æ˜¯å¦å¯åˆ‡åˆ† æ¢æˆå‹ç¼©æ ¼å¼åï¼ŒåŸæ¥çš„ç¨‹åºæ˜¯å¦éœ€è¦ä¿®æ”¹ DEFLATE æ˜¯ï¼Œç›´æ¥ä½¿ç”¨ DEFLATE .deflate å¦ å’Œæ–‡æœ¬å¤„ç†ä¸€æ ·ï¼Œä¸éœ€è¦ä¿®æ”¹ Gzip æ˜¯ï¼Œç›´æ¥ä½¿ç”¨ DEFLATE .gz å¦ å’Œæ–‡æœ¬å¤„ç†ä¸€æ ·ï¼Œä¸éœ€è¦ä¿®æ”¹ bzip2 æ˜¯ï¼Œç›´æ¥ä½¿ç”¨ bzip2 .bz2 æ˜¯ å’Œæ–‡æœ¬å¤„ç†ä¸€æ ·ï¼Œä¸éœ€è¦ä¿®æ”¹ LZO å¦ï¼Œéœ€è¦å®‰è£… LZO .lzo æ˜¯ éœ€è¦å»ºç´¢å¼•ï¼Œè¿˜éœ€è¦æŒ‡å®šè¾“å…¥æ ¼å¼ Snappy å¦ï¼Œéœ€è¦å®‰è£… Snappy .snappy å¦ å’Œæ–‡æœ¬å¤„ç†ä¸€æ ·ï¼Œä¸éœ€è¦ä¿®æ”¹ ä¸ºäº†æ”¯æŒå¤šç§å‹ç¼© / è§£å‹ç¼©ç®—æ³•ï¼ŒHadoop å¼•å…¥äº†ç¼–ç  / è§£ç å™¨ å‹ç¼©æ ¼å¼ å¯¹åº”çš„ç¼–ç /è§£ç å™¨ DEFLATE org.apache.hadoop.io.compress.DefaultCodec gzip org.apache.hadoop.io.compress.GzipCodec bzip2 org.apache.hadoop.io.compress.BZip2Codec LZO com.hadoop.compression.lzo.LzopCodec Snappy org.apache.hadoop.io.compress.SnappyCodec å¯åŠ¨å‹ç¼©åŠŸèƒ½çš„å‚æ•°é…ç½®ã€‚ å‚æ•° é˜¶æ®µ å»ºè®® io.compression.codecs è¾“å…¥å‹ç¼© æ–‡ä»¶æ‰©å±•ååˆ¤æ–­æ˜¯å¦æ”¯æŒæŸç§ç¼–è§£ç å™¨ mapreduce.map.output.compress mapper è¾“å‡º è¿™ä¸ªå‚æ•°è®¾ä¸º true å¯ç”¨å‹ç¼© mapreduce.map.output.compress.codec mapper è¾“å‡º ä¼ä¸šå¤šä½¿ç”¨ LZO æˆ– Snappy ç¼–è§£ç å™¨åœ¨æ­¤é˜¶æ®µå‹ç¼©æ•°æ® mapreduce.output.fileoutputformat.compress reducer è¾“å‡º è¿™ä¸ªå‚æ•°è®¾ä¸º true å¯ç”¨å‹ç¼© mapreduce.output.fileoutputformat.compress.codec reducer è¾“å‡º ä½¿ç”¨æ ‡å‡†å·¥å…·æˆ–è€…ç¼–è§£ç å™¨ï¼Œå¦‚ gzip å’Œ bzip2 mapreduce.output.fileoutputformat.compress.type reducer è¾“å‡º SequenceFile å‹ç¼©ç±»å‹ï¼š NONE å’Œ BLOCK Driver å®šä¹‰å‹ç¼©123456789101112131415161718192021// Map è¾“å‡ºç«¯é‡‡ç”¨å‹ç¼©public class WordCountDriver &#123; public static void main(String[] args) throws IOException, ClassNotFoundException, InterruptedException &#123; Configuration configuration = new Configuration(); // å¼€å¯ map ç«¯è¾“å‡ºå‹ç¼© configuration.setBoolean(\"mapreduce.map.output.compress\", true); // è®¾ç½® map ç«¯è¾“å‡ºå‹ç¼©æ–¹å¼ configuration.setClass(\"mapreduce.map.output.compress.codec\", BZip2Codec.class, CompressionCodec.class); // ... &#125;&#125;// Reduce è¾“å‡ºç«¯é‡‡ç”¨å‹ç¼©// è®¾ç½®reduceç«¯è¾“å‡ºå‹ç¼©å¼€å¯FileOutputFormat.setCompressOutput(job, true);// è®¾ç½®å‹ç¼©çš„æ–¹å¼FileOutputFormat.setOutputCompressorClass(job, BZip2Codec.class); YARN èµ„æºè°ƒåº¦å™¨ Hadoop ä½œä¸šè°ƒåº¦å™¨ä¸»è¦æœ‰ä¸‰ç§ï¼š FIFO å…ˆåˆ°å…ˆæœåŠ¡ã€Capacity Scheduler å’Œ Fair Scheduleã€‚ 1234567&lt;!-- yarn-default.xml --&gt;&lt;property&gt; &lt;description&gt;The class to use as the resource scheduler.&lt;/description&gt; &lt;name&gt;yarn.resourcemanager.scheduler.class&lt;/name&gt; &lt;value&gt;org.apache.hadoop.yarn.server.resourcemanager.scheduler.capacity.CapacityScheduler&lt;/value&gt;&lt;/property&gt; Capacity Schedulerï¼Œå®¹é‡è°ƒåº¦å™¨ã€‚ æ”¯æŒå¤šé˜Ÿåˆ—ï¼Œæ¯ä¸ªé˜Ÿåˆ—é…ç½®ä¸€å®šçš„èµ„æºé‡ï¼Œæ¯ä¸ªé˜Ÿåˆ—é‡‡ç”¨ FIFO è°ƒåº¦ç­–ç•¥ï¼›ä¸ºé˜²æ­¢åŒä¸€ç”¨æˆ·çš„ä½œä¸šç‹¬å é˜Ÿåˆ—ä¸­çš„èµ„æºï¼Œè¯¥è°ƒåº¦å™¨ä¼šå¯¹åŒä¸€ç”¨æˆ·æäº¤çš„ä½œä¸šæ‰€å èµ„æºé‡è¿›è¡Œé™å®šï¼›è¿è¡Œä»»åŠ¡æ•° / è®¡ç®—èµ„æº ğŸ‘‰ ç‹æœ€é—²çš„é˜Ÿåˆ—é‡Œäº¤ä»»åŠ¡ã€‚ Fair Schedulerï¼Œå…¬å¹³è°ƒåº¦å™¨ã€‚ æ”¯æŒå¤šé˜Ÿåˆ—å¤šç”¨æˆ·ï¼Œæ¯ä¸ªé˜Ÿåˆ—ä¸­çš„èµ„æºé‡å¯ä»¥é…ç½®ï¼ŒåŒé˜Ÿåˆ—ä¸­çš„ä½œä¸šå…¬å¹³å…±äº«é˜Ÿåˆ—ä¸­æ‰€æœ‰èµ„æºï¼›æ¯ä¸ªé˜Ÿåˆ—ä¸­çš„ job æŒ‰ç…§ä¼˜å…ˆçº§åˆ†é…èµ„æºï¼Œä¼˜å…ˆçº§è¶Šé«˜åˆ†é…çš„èµ„æºè¶Šå¤šï¼Œä½†æ˜¯æ¯ä¸ª job éƒ½ä¼šåˆ†é…åˆ°èµ„æºä»¥ç¡®ä¿å…¬å¹³ï¼›ï¼ˆå·®é¢ï¼šjob éœ€è¦çš„èµ„æº - job å®é™…è·å–çš„èµ„æºï¼‰åœ¨åŒä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œjob æ—³èµ„æºç¼ºé¢è¶Šå¤§ï¼Œè¶Šå…ˆè·å¾—èµ„æºä¼˜å…ˆæ‰§è¡Œã€‚ æ¨æµ‹æ‰§è¡Œ æŸäº›ä»»åŠ¡è¿‡æ…¢ï¼Œåˆ™ä¸ºå…¶å¯åŠ¨å¤šä¸ªå¤‡ä»½ä»»åŠ¡ï¼ŒåŒæ—¶è¿è¡Œï¼Œè°å…ˆè¿è¡Œå®Œæˆç”¨è°çš„ç»“æœã€‚ æ¯ä¸ª Task åªèƒ½æœ‰ä¸€ä¸ªå¤‡ä»½ä»»åŠ¡ï¼›å½“å‰ Job å·²å®Œæˆçš„ Task å¿…é¡»ä¸å°äº0.05ï¼ˆ5%ï¼‰ï¼›å¼€å¯æ¨æµ‹æ‰§è¡Œå‚æ•°è®¾ç½®ã€‚mapred-site.xml æ–‡ä»¶ä¸­é»˜è®¤æ˜¯æ‰“å¼€çš„ã€‚","categories":[{"name":"BigData","slug":"BigData","permalink":"http://yoursite.com/categories/BigData/"}],"tags":[{"name":"Hadoop","slug":"Hadoop","permalink":"http://yoursite.com/tags/Hadoop/"},{"name":"HDFS","slug":"HDFS","permalink":"http://yoursite.com/tags/HDFS/"},{"name":"MapReduce","slug":"MapReduce","permalink":"http://yoursite.com/tags/MapReduce/"}]},{"title":"sklearn","slug":"Python/sklearn","date":"2020-04-23T03:07:44.000Z","updated":"2020-04-30T03:49:06.999Z","comments":true,"path":"2020/04/23/Python/sklearn/","link":"","permalink":"http://yoursite.com/2020/04/23/Python/sklearn/","excerpt":"ç®€å•äº†è§£æœºå™¨å­¦ä¹ çš„åŸºæœ¬æ¦‚å¿µä»¥åŠå¸¸è§„æµç¨‹ï¼Œå¹¶ç®€å•ä»‹ç» Python çš„æœºå™¨å­¦ä¹ åº“ sklearn çš„ä½¿ç”¨ã€‚","text":"ç®€å•äº†è§£æœºå™¨å­¦ä¹ çš„åŸºæœ¬æ¦‚å¿µä»¥åŠå¸¸è§„æµç¨‹ï¼Œå¹¶ç®€å•ä»‹ç» Python çš„æœºå™¨å­¦ä¹ åº“ sklearn çš„ä½¿ç”¨ã€‚ Jupyter å®‰è£…é…ç½®123456pip3 install jupyter -i https://pypi.tuna.tsinghua.edu.cn/simple/ # å›½å†…é•œåƒä¸‹è½½ jupyterjupyter notebook --generate-config # ç”Ÿæˆé»˜è®¤çš„é…ç½®æ–‡ä»¶## Writing default config to: C:\\Users\\wingo\\.jupyter\\jupyter_notebook_config.py## C.NotebookApp.notebook_dir='' ä¿®æ”¹æ­¤é¡¹é…ç½®jupyter notebook # å¯åŠ¨ Jupyter notebookpip3 install -U scikit-learn -i https://pypi.tuna.tsinghua.edu.cn/simple/ # ä¸‹è½½åº“ æœºå™¨å­¦ä¹ æ¦‚è¿°æ•°æ® ğŸ‘‰ æ¨¡å‹ ğŸ‘‰ é¢„æµ‹ï¼Œå³ä»å†å²æ•°æ®ä¸­è·å¾—è§„å¾‹ã€‚ æ•°æ®é›†çš„æ„æˆï¼šç‰¹å¾å€¼ + ç›®æ ‡å€¼ã€‚ æ ¹æ®æ˜¯å¦æœ‰ç›®æ ‡å€¼ï¼Œå¯ä»¥åˆ†ä¸ºæ— ç›‘ç£å­¦ä¹ ï¼ˆæ— ç›®æ ‡å€¼ï¼‰ã€ç›‘ç£å­¦ä¹ ï¼ˆæœ‰ç›®æ ‡å€¼ï¼‰ã€‚ æ ¹æ®æ•°æ®çš„å½¢å¼ï¼Œå¯ä»¥åˆ†ä¸ºåˆ†ç±»é—®é¢˜ï¼ˆç±»åˆ«ï¼‰ã€å›å½’é—®é¢˜ï¼ˆè¿ç»­æ€§æ•°æ®ï¼‰ã€‚ æœºå™¨å­¦ä¹ çš„æ™®éå¼€å‘æµç¨‹ï¼š 1ï¼‰è·å–æ•°æ®ï¼›2ï¼‰æ•°æ®å¤„ç†ï¼›3ï¼‰ç‰¹å¾å·¥ç¨‹ï¼›4ï¼‰æ¨¡å‹è®­ç»ƒï¼›5ï¼‰æ¨¡å‹è¯„ä¼°ï¼›6ï¼‰å®é™…åº”ç”¨ã€‚ æ•°æ®è·å–sklearn è‡ªå¸¦äº†è®¸å¤šæ•°æ®ï¼Œä¾›å¼€å‘è€…è¿›è¡Œæµ‹è¯•ä½¿ç”¨ã€‚ 123456789# å¯¼å…¥æ»¡æ»¡çš„æ•°æ®åº“from sklearn import datasets# åˆ†å‰²æ•°æ®çš„æ¨¡å—ï¼ŒæŠŠæ•°æ®é›†åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†from sklearn.model_selection import train_test_split# è½½å…¥æ•°æ®ï¼Œç»å…¸é¸¢å°¾èŠ±æ•°æ®iris = datasets.load_iris()# random_state ä¸ºäº†ä¿è¯ç¨‹åºæ¯æ¬¡è¿è¡Œéƒ½åˆ†å‰²ä¸€æ ·çš„è®­ç»ƒé›†åˆæµ‹è¯•é›†ã€‚å¦åˆ™ï¼ŒåŒæ ·çš„ç®—æ³•æ¨¡å‹åœ¨ä¸åŒçš„è®­ç»ƒé›†å’Œæµ‹è¯•é›†ä¸Šçš„æ•ˆæœä¸ä¸€æ ·ã€‚x_train, x_test, y_train, y_test = train_test_split(iris.data, iris.target, test_size=0.2, random_state=0) æŸ¥çœ‹æ­¤æ•°æ®é›†çš„è¯¦ç»†æè¿°ï¼š æ•°æ®é›†çš„åˆ’åˆ†ï¼š è®­ç»ƒæ•°æ®ï¼Œç”¨äºè®­ç»ƒï¼Œæ„å»ºæ¨¡å‹ï¼›æµ‹è¯•æ•°æ®ï¼Œåœ¨æ¨¡å‹æ£€éªŒæ—¶ä½¿ç”¨ï¼Œç”¨äºè¯„ä¼°æ¨¡å‹æ˜¯å¦æœ‰æ•ˆã€‚ ç‰¹å¾å·¥ç¨‹ Feature Engineeringï¼šç‰¹å¾å·¥ç¨‹å°±æ˜¯å¯¹ç‰¹å¾å€¼è¿›è¡Œå¤„ç†ï¼Œé€‰æ‹©æœ‰æ„ä¹‰çš„ç‰¹å¾è¾“å…¥æœºå™¨å­¦ä¹ çš„ç®—æ³•å’Œæ¨¡å‹è¿›è¡Œè®­ç»ƒã€‚ å­—å…¸ç‰¹å¾æå–12345678910111213141516171819202122232425262728from sklearn.feature_extraction import DictVectorizer# list:[dict&#123;&#125;, dict&#123;&#125;, dict&#123;&#125;]data = [&#123;'city': 'åŒ—äº¬','temperature':100&#125;, &#123;'city': 'ä¸Šæµ·','temperature':60&#125;, &#123;'city': 'æ·±åœ³','temperature':30&#125;]# å®ä¾‹åŒ–ä¸€ä¸ªè½¬æ¢å™¨ç±»ï¼Œæ­¤å¤„ sparse=True è®¾ç½®ç»“æœä¸ºç¨€ç–çŸ©é˜µæ–¹ä¾¿æŸ¥çœ‹transfer = DictVectorizer(sparse=True)# è°ƒç”¨ fit_transform() è¿›è¡Œç‰¹å¾æå–data_new = transfer.fit_transform(data)# æ‰“å°ç‰¹å¾æå–ç»“æœprint(\"data_new_sparse:\\n\", data_new, \"\\n\", type(data_new))print(\"data_new:\\n\", data_new.toarray())print(\"ç‰¹å¾åå­—:\\n\", transfer.get_feature_names())\"\"\" æ‰“å°ç»“æœdata_new_sparse: (0, 1) 1.0 (0, 3) 100.0 (1, 0) 1.0 (1, 3) 60.0 (2, 2) 1.0 (2, 3) 30.0 &lt;class 'scipy.sparse.csr.csr_matrix'&gt;data_new: [[ 0. 1. 0. 100.] [ 1. 0. 0. 60.] [ 0. 0. 1. 30.]]ç‰¹å¾åå­—: ['city=ä¸Šæµ·', 'city=åŒ—äº¬', 'city=æ·±åœ³', 'temperature']\"\"\" ç”±ä¸Šé¢çš„ä¾‹å­å¯ä»¥çœ‹å‡ºï¼Œç»è¿‡ sklearn çš„å­—å…¸ç‰¹å¾è½¬æ¢åï¼Œå…¶ç±»å‹è½¬æ¢ä¸º matrixï¼Œå³ä¸€ä¸ªçŸ©é˜µç±»å‹ã€‚ åŸå§‹æ•°æ®ä¸­çš„ç‰¹å¾å€¼åªæœ‰ 2 ä¸ªï¼šcityã€temperatureï¼›ä½†è½¬æ¢å‡ºæ¥çš„ç‰¹å¾çŸ©é˜µå´æœ‰ 4 åˆ—ï¼Œè¿™æ˜¯ä¸ºäº†å°†ç‰¹å¾å€¼å˜é‡è½¬æ¢ä¸ºæœºå™¨å­¦ä¹ ç®—æ³•æ˜“äºåˆ©ç”¨çš„ä¸€ç§å½¢å¼ï¼Œæ­¤è½¬æ¢è¿‡ç¨‹ç§°ä¸º one hot ç¼–ç ã€‚ æ–‡æœ¬ç‰¹å¾æå–CountVectorizer123456789101112131415from sklearn.feature_extraction.text import CountVectorizerdata = [\"How to shift your mindset and choose your future\", \"I like python, Do you like python?\"]# å®ä¾‹åŒ–ä¸€ä¸ªè½¬æ¢å™¨ç±»ï¼Œå¯ä»¥å±è”½ä¸€äº›æ²¡æœ‰æ„ä¹‰çš„è¯è¯­transfer = CountVectorizer(stop_words=[\"and\", \"to\"])# è°ƒç”¨ fit_transformdata_new = transfer.fit_transform(data)print(\"data_new:\\n\", data_new.toarray())print(\"ç‰¹å¾åå­—ï¼š\\n\", transfer.get_feature_names())\"\"\" æ‰“å°ç»“æœdata_new: [[1 0 1 1 0 1 0 1 0 2] [0 1 0 0 2 0 2 0 1 0]]ç‰¹å¾åå­—ï¼š ['choose', 'do', 'future', 'how', 'like', 'mindset', 'python', 'shift', 'you', 'your']\"\"\" æ€è€ƒï¼šè‹¥æ˜¯å¯¹ä¸€å¥ä¸­æ–‡æ–‡æœ¬è¿›è¡Œæ–‡æœ¬ç‰¹å¾æå–ï¼Œé‚£ä¼šå‡ºç°ä»€ä¹ˆç»“æœï¼Ÿ å¯¹äºä¸­æ–‡æ–‡æœ¬ï¼Œå› ä¸ºè¯è¯­ä¹‹é—´ä¸å­˜åœ¨ç©ºæ ¼ï¼Œæ‰€ä»¥éœ€è¦åˆ†è¯åº“å…ˆè¿›è¡Œåˆ†è¯ï¼š&quot; &quot;.join(list(jieba.cut(text))) TfidfVectorizer Term Frequency - Inverse Document Frequencyï¼Œå³è¯é¢‘ - é€†æ–‡æœ¬é¢‘ç‡ï¼Œç”± TF å’Œ IDF ç»„æˆã€‚ TFï¼Œå³æ™®é€šçš„è¯é¢‘ç»Ÿè®¡ï¼Œè¿™ä¸ªæ¯”è¾ƒå¥½ç†è§£ï¼ŒIDFï¼Œç”¨äºååº”ä¸€ä¸ªè¯çš„é‡è¦æ€§ï¼Œè¿›è€Œä¿®æ­£ä»…ä»…ç”¨è¯é¢‘è¡¨ç¤ºçš„è¯ç‰¹å¾å€¼ã€‚æ¯”å¦‚ï¼Œâ€toâ€ è¿™ä¸ªè¯çš„è¯é¢‘éå¸¸é«˜ï¼Œä½†å®ƒåœ¨æ¯ä¸€ç¯‡æ–‡ç« ä¸­éƒ½å‡ºç°äº†ï¼Œé‚£ä¹ˆå®ƒè¿™ä¸ªé«˜è¯é¢‘å°±æ²¡æœ‰ä»€ä¹ˆå¤ªå¤§çš„æ„ä¹‰ã€‚ 1234567891011121314151617181920212223242526272829303132333435from sklearn.feature_extraction.text import TfidfVectorizerfrom sklearn.feature_extraction.text import CountVectorizerimport jiebadata = [\"ä»Šå¤©æ˜¯æ˜ŸæœŸä¸€ï¼Œæœ‰ç‚¹å¿«ä¹\", \"ä»Šå¤©æ˜¯æ˜ŸæœŸäºŒï¼Œæ— æ•Œå¿«ä¹\", \"ä»Šå¤©æ˜¯æ˜ŸæœŸä¸‰ï¼Œè¶…çº§å¿«ä¹\"]data_new = []for sent in data: data_new.append(\" \".join(list(jieba.cut(sent))))\"\"\"data_new['ä»Šå¤© æ˜¯ æ˜ŸæœŸä¸€ ï¼Œ æœ‰ç‚¹ å¿«ä¹', 'ä»Šå¤© æ˜¯ æ˜ŸæœŸäºŒ ï¼Œ æ— æ•Œ å¿«ä¹', 'ä»Šå¤© æ˜¯ æ˜ŸæœŸä¸‰ ï¼Œ è¶…çº§ å¿«ä¹']\"\"\"# è½¬æ¢å™¨transfer = TfidfVectorizer()transfer_normal = CountVectorizer()# ç‰¹å¾æå–data_final = transfer.fit_transform(data_new)data_normal = transfer_normal.fit_transform(data_new)print(\"data_new:\\n\", data_final.toarray())print(\"data_new_normal:\\n\", data_normal.toarray())print(\"ç‰¹å¾åå­—ï¼š\\n\", transfer.get_feature_names())\"\"\"æ‰“å°ç»“æœdata_new: [[0.35959372 0.35959372 0. 0.6088451 0. 0. 0.6088451 0. ] [0.35959372 0.35959372 0.6088451 0. 0. 0.6088451 0. 0. ] [0.35959372 0.35959372 0. 0. 0.6088451 0. 0. 0.6088451 ]]data_new_normal: [[1 1 0 1 0 0 1 0] [1 1 1 0 0 1 0 0] [1 1 0 0 1 0 0 1]]ç‰¹å¾åå­—ï¼š ['ä»Šå¤©', 'å¿«ä¹', 'æ— æ•Œ', 'æ˜ŸæœŸä¸€', 'æ˜ŸæœŸä¸‰', 'æ˜ŸæœŸäºŒ', 'æœ‰ç‚¹', 'è¶…çº§']\"\"\" åˆ†æä¸Šè¿°ç»“æœï¼Œæ™®é€šçš„è¯é¢‘åˆ†æå¾—å‡ºçš„ç»“æœæ˜¯è¯é¢‘ç›¸åŒï¼Œè€Œ tf-idf åˆ†æï¼Œå¯¹äºæ¯ä¸ªå¥å­ä¸­éƒ½å‡ºç°çš„è¯çš„é‡è¦æ€§ä¼šæœ‰æ‰€é™ä½ã€‚ ç‰¹å¾é¢„å¤„ç† æ— é‡çº²åŒ–ï¼šè¿›è¡Œæ— é‡çº²åŒ–åè¡¨å¾ä¸åŒå±æ€§ï¼ˆå•ä½ä¸åŒï¼‰çš„å„ç‰¹å¾ä¹‹é—´æ‰æœ‰å¯æ¯”æ€§ï¼Œå¦‚ 1cm ä¸ 0.1kg å¦‚ä½•æ¯”è¾ƒï¼Ÿ å½’ä¸€åŒ– æ— æ³•å¤„ç†å¼‚å¸¸å€¼ï¼ˆæœ€å¤§å€¼ï¼Œæœ€å°å€¼ï¼‰ï¼› 123456789from sklearn.preprocessing import MinMaxScalerx_mm = [[1,-1,2],[2,0,0],[0,1,-1]]x_mm_new = MinMaxScaler().fit_transform(x_mm)\"\"\"x_mm_newarray([[0.5 , 0. , 1. ], [1. , 0.5 , 0.33333333], [0. , 1. , 0. ]])\"\"\" æ ‡å‡†åŒ– æ ‡å‡†å·®ï¼ˆæè¿°æ ·æœ¬é›†ä¸­ç¨‹åº¦ï¼Œå¼‚å¸¸å€¼å¯¹æ€»æ ·æœ¬çš„é›†ä¸­ç¨‹åº¦çš„å½±å“ä¸å¤§ï¼‰ï¼Œåœ¨å·²æœ‰æ ·æœ¬è¶³å¤Ÿå¤šçš„æƒ…å†µä¸‹æ¯”è¾ƒç¨³å®šï¼Œé€‚åˆç°ä»£å˜ˆæ‚å¤§æ•°æ®åœºæ™¯ã€‚ 12345678from sklearn.preprocessing import StandardScalerx = [[1,2,3],[4,5,6],[1,2,1]]x_new = StandardScaler().fit_transform(x)\"\"\"x_newarray([[-0.70710678, -0.70710678, -0.16222142], [ 1.41421356, 1.41421356, 1.29777137], [-0.70710678, -0.70710678, -1.13554995]])\"\"\" ç‰¹å¾é™ç»´ è¿™é‡Œçš„é™ç»´çš„ç»´åº¦ï¼Œä¸æ˜¯æŒ‡çŸ©é˜µã€å‘é‡ã€æ ‡é‡ç­‰ï¼Œè€Œæ˜¯æŒ‡é™ä½ç‰¹å¾çš„ä¸ªæ•°ï¼Œè®©æœ€ç»ˆå¾—åˆ°çš„æ•°æ®ä¸­çš„æ¯ä¸ªç‰¹å¾ä¹‹é—´äº’ä¸ç›¸å…³ã€‚ æ€è€ƒï¼šç‰¹å¾ä¹‹é—´ç›¸å…³åº¦è¿‡é«˜ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿï¼Ÿï¼Ÿè‹¥ mã€n éƒ½å¯ä»¥å¾—å‡º rï¼Œé‚£ä¹ˆå»æ‰ m ã€n ä¸­çš„ä»»æ„ä¸€ä¸ªç‰¹å¾å¯¹ç»“æœéƒ½ä¸ä¼šå½±å“ï¼Œåœ¨ä¸€ä¸ªåºå¤§çš„æ•°æ®ä¸­ï¼Œå»æ‰æŸäº›ç›¸å…³æ€§ç‰¹åˆ«é«˜çš„ç‰¹å¾å¯ä»¥èŠ‚çœå¾ˆå¤šç®—åŠ›ä¸å†…å­˜ç©ºé—´ï¼Œæ¨¡å‹æ›´åŠ é«˜æ•ˆã€‚ Filter æ–¹å·®é€‰æ‹©æ³•ï¼šä½æ–¹å·®ç‰¹å¾è¿‡æ»¤ï¼Œå³è¿‡æ»¤å·®åˆ«ä¸å¤§çš„ç‰¹å¾ã€‚ 12345678910111213141516171819202122232425262728293031323334from sklearn.feature_selection import VarianceThresholdimport pandas as pdfrom scipy.stats import pearsonr# è·å–æ•°æ®data = pd.read_csv(\"factor_returns.csv\")# ä¿ç•™æ¯ä¸€è¡Œï¼Œä¿ç•™ä»[ç¬¬äºŒåˆ—åˆ°å€’æ•°ç¬¬äºŒåˆ—)data = data.iloc[:, 1:-2]data_v = data.valuesprint(\"data:\\n\", data_v.shape)# å®ä¾‹åŒ–ä¸€ä¸ªè½¬æ¢å™¨ç±»transfer = VarianceThreshold(threshold=10)# è°ƒç”¨ fit_transformdata_new = transfer.fit_transform(data)print(\"data_new:\\n\",data_new.shape)# è®¡ç®—æŸä¸¤ä¸ªå˜é‡ä¹‹é—´çš„ç›¸å…³ç³»æ•°r1 = pearsonr(data[\"pe_ratio\"], data[\"pb_ratio\"])print(\"pe_ratio ä¸ pb_ratio ä¹‹é—´çš„ç›¸å…³æ€§ï¼š\\n\", r1)r2 = pearsonr(data['revenue'], data['total_expense'])print(\"revenue ä¸ total_expense ä¹‹é—´çš„ç›¸å…³æ€§ï¼š\\n\", r2)\"\"\"æ‰“å°ç»“æœdata: (2318, 9)data_new: (2318, 7)pe_ratio ä¸ pb_ratio ä¹‹é—´çš„ç›¸å…³æ€§ï¼š (-0.0043893227799362685, 0.8327205496564927)revenue ä¸ total_expense ä¹‹é—´çš„ç›¸å…³æ€§ï¼š (0.9958450413136116, 0.0)\"\"\" pearsonrï¼šçš®å°”é€Šç›¸å…³ç³»æ•°ï¼Œå–å€¼èŒƒå›´ï¼šâ€“1â‰¤ r â‰¤+1ã€‚ è‹¥ç‰¹å¾ä¸ç‰¹å¾ä¹‹é—´ç›¸å…³æ€§å¾ˆé«˜ï¼š é€‰å–å…¶ä¸­ä¸€ä¸ªï¼›åŠ æƒæ±‚å’Œï¼›ä¸»æˆåˆ†åˆ†æï¼› ä¸»æˆåˆ†åˆ†æ PCAï¼ŒPrincipal components analysisã€‚ 1transfer = PCA(n_components=0.95) # è¿›è¡Œ PCA é™ç»´ï¼Œå¹¶ä¿å­˜ 95% çš„ä¿¡æ¯ã€‚ æ¡ˆä¾‹åˆ†æï¼šè´­ç‰©è½¦ é¢„æµ‹æŸä¸ª user_id ä¸‹æ¬¡ä¼šè´­ä¹° aisleã€‚ 123456789101112131415161718192021222324252627282930313233343536import pandas as pd# è·å–æ•°æ®# è®¢å•ä¸å•†å“ä¿¡æ¯order_products = pd.read_csv(\"./instacart/order_products__prior.csv\")# å•†å“è¯¦ç»†ä¿¡æ¯products = pd.read_csv(\"./instacart/products.csv\")# è®¢å•è¯¦ç»†ä¿¡æ¯orders = pd.read_csv(\"./instacart/orders.csv\")# å•†å“æ‰€å±ç±»åˆ«ä¿¡æ¯aisles = pd.read_csv(\"./instacart/aisles.csv\")# æ‰“å°ç‰¹å¾å€¼æ‰¾è§„å¾‹ï¼Œå°†æ‰€æœ‰çš„ç‰¹å¾å€¼åˆå¹¶åˆ°ä¸€å¼ è¡¨ä¸­ç„¶åè¿›è¡Œ PCA é™ç»´print(order_products.columns.values.tolist(),\"\\n\", products.columns.values.tolist(), \"\\n\", orders.columns.values.tolist(),\"\\n\", aisles.columns.values.tolist())\"\"\"æ‰“å°ç»“æœ['order_id', 'product_id', 'add_to_cart_order', 'reordered'] ['product_id', 'product_name', 'aisle_id', 'department_id'] ['order_id', 'user_id', 'eval_set', 'order_number', 'order_dow', 'order_hour_of_day', 'days_since_prior_order'] ['aisle_id', 'aisle']\"\"\"tab1 = pd.merge(aisles, products, on=[\"aisle_id\", \"aisle_id\"])tab2 = pd.merge(tab1, order_products, on=[\"product_id\", \"product_id\"])tab3 = pd.merge(tab2, orders, on=[\"order_id\", \"order_id\"])tab3.columns.values.tolist()\"\"\"æ‰“å°ç»“æœ['aisle_id', 'aisle', 'product_id', 'product_name', 'department_id', 'order_id', 'add_to_cart_order', 'reordered', 'user_id', 'eval_set', 'order_number', 'order_dow', 'order_hour_of_day', 'days_since_prior_order']\"\"\"# è™½ç„¶æ‰€æœ‰çš„æ•°æ®ç‰¹å¾éƒ½åœ¨ä¸€ä¸ªè¡¨ä¸­ï¼Œä½†è¡¨çš„å½¢å¼ä¸æ˜¯éœ€è¦çš„ user_id ä¸ aisle çš„å…³ç³»# åˆ©ç”¨äº¤å‰è¡¨åæ˜ çš„ user_id å’Œ aisle ä¹‹é—´çš„å…³ç³»table = pd.crosstab(tab3[\"user_id\"], tab3[\"aisle\"]) 123456789101112# æœ‰å¤§é‡çš„ç‰¹å¾å€¼ï¼Œå¯¹æ•°æ®è¿›è¡Œé™ç»´å¤„ç†from sklearn.decomposition import PCAdata = table[:10000]data.shape# (10000, 134)from sklearn.decomposition import PCA# å®ä¾‹åŒ–ä¸€ä¸ªè½¬æ¢å™¨ç±»transfer = PCA(n_components=0.95)# è°ƒç”¨ fit_transformdata_new = transfer.fit_transform(data)data_new.shape# (10000, 42) åœ¨ä¸Šè¿°æ¡ˆä¾‹ä¸­ï¼Œé€šè¿‡ PCA é™ç»´ï¼Œå°† 134 ä¸ªç‰¹å¾å€¼é™åˆ°äº† 42 ä¸ªï¼Œå¹¶ä¸”è¿˜ä¿ç•™äº†åŸæœ¬æ•°æ® 95% çš„ä¿¡æ¯ï¼Œå¯è§ PCA é™ç»´è¿˜æ˜¯æŒºå¥½ç”¨çš„ã€‚ åˆ†ç±»ç®—æ³•sklearn çš„è½¬æ¢å™¨å’Œä¼°è®¡å™¨ã€‚ è½¬æ¢å™¨ï¼ˆtransformerï¼‰ï¼Œç‰¹å¾å·¥ç¨‹çš„çˆ¶ç±»ï¼› fit_transform() å…¶å®æ˜¯ä¸¤ä¸ªè¿‡ç¨‹ï¼šfit() è®¡ç®—æ¯ä¸€åˆ—çš„å¹³å‡å€¼ã€æ ‡å‡†å·®ï¼›transform() å®ç°æœ€ç»ˆçš„è½¬æ¢ã€‚ ä¼°è®¡å™¨ï¼ˆestimatorï¼‰ï¼Œæœºå™¨å­¦ä¹ ç®—æ³•çš„å®ç°ã€‚ 1234estimator.fit(x_train, y_train) # è®¡ç®—ç”Ÿæˆæ¨¡å‹y_predict = estimator.predict(x_test) # å¯¹æµ‹è¯•æ•°æ®è¿›è¡Œæµ‹è¯•y_test == y_predict # æµ‹è¯•ç»“æœä¸åŸæœ‰ç»“æœè¿›è¡Œå¯¹æ¯”accuracy = estimator.score(x_test, y_test) # è®¡ç®—å‡†ç¡®ç‡ K - è¿‘é‚»ç®—æ³• å³ï¼Œæ ¹æ®é‚»è¿‘çš„ç±»å‹æ¥æ¨æµ‹å‡ºè‡ªèº«ç±»å‹ã€‚é‚»è¿‘æŒ‡çš„æ˜¯è·ç¦»ï¼š æ¬§æ°è·ç¦»ï¼›æ›¼å“ˆé¡¿è·ç¦»ï¼ˆç»å¯¹å€¼è·ç¦»ï¼‰ï¼Œæ˜å¯å¤«æ–¯åŸºè·ç¦»ã€‚ é¸¢å°¾èŠ±åˆ†ç±»æ¡ˆä¾‹12345678910111213141516171819202122232425262728293031323334353637383940414243from sklearn.datasets import load_irisfrom sklearn.model_selection import train_test_splitfrom sklearn.preprocessing import StandardScalerfrom sklearn.neighbors import KNeighborsClassifier# è·å–æ•°æ®iris = load_iris()# åˆ’åˆ†æ•°æ®é›†x_train, x_test, y_train, y_test = train_test_split(iris.data, iris.target, random_state=0)# ç‰¹å¾å·¥ç¨‹transfer = StandardScaler()# è®­ç»ƒé›†å’Œæµ‹è¯•é›†éƒ½è¦åšä¸€æ ·çš„å¤„ç†x_train = transfer.fit_transform(x_train)# æµ‹è¯•åŸºä½¿ç”¨æµ‹è¯•æœºçš„ fit() è¿›è¡Œè®¡ç®—x_test = transfer.transform(x_test)# KNN ç®—æ³•é¢„ä¼°å™¨ï¼Œè‡ªå®šä¹‰è·ç¦»ï¼ˆä¸æ–­å°è¯•å‡ºä¸€ä¸ªå‡†ç¡®ç‡è¾ƒé«˜çš„è·ç¦»ï¼‰estimator = KNeighborsClassifier(n_neighbors=3)estimator.fit(x_train, y_train)# æ¨¡å‹è¯„ä¼°y_predict = estimator.predict(x_test)print(\"y_predict:\\n\", y_predict)print(\"ç›´æ¥æ¯”å¯¹çœŸå®å€¼å’Œé¢„æµ‹å€¼:\\n\", y_test == y_predict)\"\"\"ç»“æœæ‰“å°y_predict: [2 1 0 2 0 2 0 1 1 1 2 1 1 1 1 0 1 1 0 0 2 1 0 0 2 0 0 1 1 0 2 1 0 2 2 1 0 2]ç›´æ¥æ¯”å¯¹çœŸå®å€¼å’Œé¢„æµ‹å€¼: [ True True True True True True True True True True True True True True True True True True True True True True True True True True True True True True True True True True True True True False]\"\"\"# è®¡ç®—å‡†ç¡®ç‡score = estimator.score(x_test, y_test)print(\"å‡†ç¡®ç‡ä¸ºï¼š\\n\", score)\"\"\"ç»“æœæ‰“å°å‡†ç¡®ç‡ä¸ºï¼š 0.9736842105263158\"\"\" ä¼˜ç‚¹ï¼šç®€å•ï¼Œæ˜“äºç†è§£ï¼Œæ˜“äºå®ç°ï¼Œæ— éœ€è®­ç»ƒ;ç¼ºç‚¹ï¼šå¿…é¡»æŒ‡å®š K å€¼ï¼ŒK å€¼é€‰æ‹©ä¸å½“åˆ™åˆ†ç±»ç²¾åº¦ä¸èƒ½ä¿è¯ï¼›æ‡’æƒ°ç®—æ³•ï¼Œå¯¹æµ‹è¯•æ ·æœ¬åˆ†ç±»æ—¶çš„è®¡ç®—é‡å¤§ï¼Œå†…å­˜å¼€é”€å¤§ï¼›ä½¿ç”¨åœºæ™¯ï¼šå°æ•°æ®åœºæ™¯ï¼Œå‡ åƒï½å‡ ä¸‡æ ·æœ¬ï¼Œå…·ä½“åœºæ™¯å…·ä½“ä¸šåŠ¡å»æµ‹è¯•ã€‚ æ¨¡å‹é€‰æ‹©ä¸è°ƒä¼˜ æœ‰æ—¶å€™å¾—åˆ°çš„æ¨¡å‹çš„å‡†ç¡®ç‡ä¸å°½äººæ„ï¼Œè¿™æ—¶å°±éœ€è¦ä½¿ç”¨æŸäº›ç®—æ³•å¯¹æ¨¡å‹è¿›è¡Œé€‰æ‹©å’Œè°ƒä¼˜äº†ã€‚ äº¤å‰éªŒè¯ éªŒè¯é›†çš„æ•°é‡ä¸å¤Ÿï¼Œé‚£ä¹ˆæœ€å¥½è¿˜æ˜¯ç”¨äº¤å‰éªŒè¯å§ã€‚è‡³äºåˆ†æˆå‡ ä»½æ¯”è¾ƒå¥½ï¼Œä¸€èˆ¬éƒ½æ˜¯åˆ†æˆ 3ã€5 å’Œ 10 ä»½ã€‚ ç½‘æ ¼æœç´¢ åˆç§°ä¸ºè¶…å‚æ•°æœç´¢ã€‚å¯¹ KNN çš„ K å€¼è¿›è¡Œå‚æ•°è°ƒä¼˜ï¼ŒæŠŠä¸€ç»„ K å€¼ä¼ å…¥ç½‘æ ¼æœç´¢ä¸­ï¼Œæ‰¾å‡ºæœ€ä¼˜å€¼ã€‚ é¸¢å°¾èŠ± K å€¼è°ƒä¼˜1234567891011121314151617181920212223estimator = KNeighborsClassifier()# åŠ å…¥ç½‘æ ¼æœç´¢ä¸äº¤å‰éªŒè¯# å‚æ•°å‡†å¤‡param_dict = &#123;\"n_neighbors\": [1, 3, 5, 7, 9, 11]&#125;# cv=10ï¼Œè¿›è¡Œ10æŠ˜äº¤å‰éªŒè¯estimator = GridSearchCV(estimator, param_grid=param_dict, cv=10)estimator.fit(x_train, y_train)y_predict = estimator.predict(x_test)print(\"y_predict:\\n\", y_predict)print(\"ç›´æ¥æ¯”å¯¹çœŸå®å€¼å’Œé¢„æµ‹å€¼:\\n\", y_test == y_predict)score = estimator.score(x_test, y_test)print(\"å‡†ç¡®ç‡ä¸ºï¼š\\n\", score)# æœ€ä½³å‚æ•°ï¼šbest_params_print(\"æœ€ä½³å‚æ•°ï¼š\\n\", estimator.best_params_)# æœ€ä½³ç»“æœï¼šbest_score_print(\"æœ€ä½³ç»“æœï¼š\\n\", estimator.best_score_)# æœ€ä½³ä¼°è®¡å™¨ï¼šbest_estimator_print(\"æœ€ä½³ä¼°è®¡å™¨:\\n\", estimator.best_estimator_)# äº¤å‰éªŒè¯ç»“æœï¼šcv_results_print(\"äº¤å‰éªŒè¯ç»“æœ:\\n\", estimator.cv_results_) æœ´ç´ è´å¶æ–¯ Naive Bayesianã€‚æœ´ç´ ï¼Ÿå³ï¼Œå‡è®¾ç‰¹å¾ä¸ç‰¹å¾ä¹‹é—´æ˜¯ç›¸äº’ç‹¬ç«‹ã€‚ åº”ç”¨åœºæ™¯ï¼šæ–‡æœ¬åˆ†ç±»ï¼Œå•è¯ä½œä¸ºç‰¹å¾ã€‚ å†³ç­–æ ‘å“ªä¸ªç‰¹å¾å€¼çš„ä¿¡æ¯å¢ç›Šå¤§ï¼Œé‚£å°±åº”è¯¥å…ˆç”¨è¿™ä¸ªç‰¹å¾å€¼åšè¿‡æ»¤ã€‚ ç¼ºç‚¹ï¼šå®¹æ˜“äº§ç”Ÿè¿‡æ‹Ÿåˆï¼Œå³ä¸€ä¸ª overfitted æ¨¡å‹è®°ä½å¤ªå¤š training data çš„ç»†èŠ‚ä»è€Œé™ä½äº† generalization çš„èƒ½åŠ›ã€‚ æ¬ æ‹Ÿåˆï¼šå…‰çœ‹ä¹¦ä¸åšé¢˜è§‰å¾—è‡ªå·±ä¼šäº†ï¼Œä¸Šäº†è€ƒåœºå•¥éƒ½ä¸ä¼šï¼›è¿‡æ‹Ÿåˆ: åšè¯¾åé¢˜å…¨éƒ½èƒ½åšå¯¹ï¼Œä¸Šäº†è€ƒåœºè¿˜æ˜¯å•¥éƒ½ä¸ä¼šã€‚ 123456789101112131415161718192021222324252627282930313233343536373839from sklearn.datasets import load_irisfrom sklearn.model_selection import train_test_splitfrom sklearn.tree import DecisionTreeClassifier, export_graphviz# è·å–æ•°æ®é›†iris = load_iris()# åˆ’åˆ†æ•°æ®é›†x_train, x_test, y_train, y_test = train_test_split(iris.data, iris.target, random_state=0)# å†³ç­–æ ‘é¢„ä¼°å™¨estimator = DecisionTreeClassifier(criterion=\"entropy\")estimator.fit(x_train, y_train)# æ¨¡å‹è¯„ä¼°# ç›´æ¥æ¯”å¯¹çœŸå®å€¼å’Œé¢„æµ‹å€¼y_predict = estimator.predict(x_test)print(\"y_predict:\\n\", y_predict)print(\"ç›´æ¥æ¯”å¯¹çœŸå®å€¼å’Œé¢„æµ‹å€¼:\\n\", y_test == y_predict)# è®¡ç®—å‡†ç¡®ç‡score = estimator.score(x_test, y_test)print(\"å‡†ç¡®ç‡ä¸ºï¼š\\n\", score)\"\"\"ç»“æœæ‰“å°y_predict: [0 2 1 2 1 1 1 1 1 0 2 1 2 2 0 2 1 1 1 1 0 2 0 1 2 0 2 2 2 1 0 0 1 1 1 0 0 0]ç›´æ¥æ¯”å¯¹çœŸå®å€¼å’Œé¢„æµ‹å€¼: [ True True True True True True True False True True True True True True True True True True False True True True True True True True True True True False True True True True True True True True]å‡†ç¡®ç‡ä¸ºï¼š 0.9210526315789473\"\"\"# å¯è§†åŒ–å†³ç­–æ ‘export_graphviz(estimator, out_file=\"iris_tree.dot\", feature_names=iris.feature_names) åœ¨çº¿å¯è§†åŒ– éšæœºæ£®æ— æ£®æ—ï¼šåŒ…å«å¤šä¸ªå†³ç­–æ ‘çš„åˆ†ç±»å™¨ã€‚ 12345678# æ•°æ®åŒå†³ç­–æ ‘from sklearn.ensemble import RandomForestClassifier# ä½¿ç”¨éšæœºæ£®æ—estimator = RandomForestClassifier()estimator.fit(x_train, y_train)y_predict = estimator.predict(x_test)print(estimator.score(x_test, y_test)) æ¡ˆä¾‹åˆ†æï¼šç­¾åˆ°é¢„æµ‹ æ ¹æ®ç»™å®šçš„æ•°æ®ï¼Œé¢„æµ‹äººä»¬æœ€å¯èƒ½åœ¨åœ°å›¾ä¸Šçš„å“ªä¸ªä½ç½®è¿›è¡Œç­¾åˆ°ã€‚ 12345import pandas as pd# è·å–æ•°æ®data = pd.read_csv(\"./FBlocation/train.csv\")data.head() 123456789101112131415161718192021# ç¼©å°èŒƒå›´ï¼Œæ–¹ä¾¿å®éªŒdata = data.query(\"x &lt; 2.5 &amp; x &gt; 2 &amp; y &lt; 1.5 &amp; y &gt; 1.0\")# å¯¹æ•°æ®è¿›è¡Œå¤„ç†ï¼Œè¿™ä¸ªæ—¶é—´çœ‹çš„å¾ˆéš¾å—# æ—¶é—´å¤„ç†æˆä¾¿äºè§‚å¯Ÿçš„å½¢å¼time_value = pd.to_datetime(data[\"time\"], unit=\"s\")time_value.head()# å¹´æœˆçš„å·®åˆ«ä¸å¤§ï¼Œå¯ä¸è€ƒè™‘\"\"\"ç»“æœæ‰“å°112 1970-01-08 05:06:14180 1970-01-08 01:29:55367 1970-01-07 17:01:07874 1970-01-02 15:52:461022 1970-01-03 09:46:33Name: time, dtype: datetime64[ns]\"\"\"# å¾—åˆ°æ—¶é—´åˆ—date = pd.DatetimeIndex(time_value)# ç»™æ•°æ®å¢åŠ æ—¥æœŸï¼Œæ˜ŸæœŸï¼Œæ—¶é—´è¿™äº›ç‰¹å¾å€¼data[\"day\"] = date.daydata[\"weekday\"] = date.weekdaydata[\"hour\"] = date.hour 12# æ ¹æ® place_id æˆç»„ï¼Œè¿‡æ»¤ç­¾åˆ°æ¬¡æ•°æ¯”è¾ƒå°‘çš„åœ°ç‚¹place_count = data.groupby(\"place_id\").count()[\"row_id\"] 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748# è¿‡æ»¤place_count[place_count &gt; 3].head()# æ ¹æ®å¾—åˆ°çš„ place_id å¯¹æ•°æ®è¿›è¡Œè¿‡æ»¤data_final = data[data[\"place_id\"].isin(place_count[place_count &gt; 3].index.values)]# ç­›é€‰ç‰¹å¾å€¼å’Œç›®æ ‡å€¼x = data_final[[\"x\", \"y\", \"accuracy\", \"day\", \"weekday\", \"hour\"]]y = data_final[\"place_id\"]from sklearn.model_selection import train_test_splitfrom sklearn.preprocessing import StandardScalerfrom sklearn.neighbors import KNeighborsClassifierfrom sklearn.model_selection import GridSearchCV# æ•°æ®é›†åˆ’åˆ†x_train, x_test, y_train, y_test = train_test_split(x, y)# ç‰¹å¾å·¥ç¨‹ï¼šæ ‡å‡†åŒ–transfer = StandardScaler()x_train = transfer.fit_transform(x_train)x_test = transfer.transform(x_test)# KNN ç®—æ³•é¢„ä¼°å™¨estimator = KNeighborsClassifier()# åŠ å…¥ç½‘æ ¼æœç´¢ä¸äº¤å‰éªŒè¯# å‚æ•°å‡†å¤‡param_dict = &#123;\"n_neighbors\": [3, 5, 7, 9]&#125;estimator = GridSearchCV(estimator, param_grid=param_dict, cv=3)estimator.fit(x_train, y_train)# æ¨¡å‹è¯„ä¼°# ç›´æ¥æ¯”å¯¹çœŸå®å€¼å’Œé¢„æµ‹å€¼y_predict = estimator.predict(x_test)print(\"y_predict:\\n\", y_predict)print(\"ç›´æ¥æ¯”å¯¹çœŸå®å€¼å’Œé¢„æµ‹å€¼:\\n\", y_test == y_predict)# è®¡ç®—å‡†ç¡®ç‡score = estimator.score(x_test, y_test)print(\"å‡†ç¡®ç‡ä¸ºï¼š\\n\", score)# æœ€ä½³å‚æ•°ï¼šbest_params_print(\"æœ€ä½³å‚æ•°ï¼š\\n\", estimator.best_params_)# æœ€ä½³ç»“æœï¼šbest_score_print(\"æœ€ä½³ç»“æœï¼š\\n\", estimator.best_score_)# æœ€ä½³ä¼°è®¡å™¨ï¼šbest_estimator_print(\"æœ€ä½³ä¼°è®¡å™¨:\\n\", estimator.best_estimator_)# äº¤å‰éªŒè¯ç»“æœï¼šcv_results_print(\"äº¤å‰éªŒè¯ç»“æœ:\\n\", estimator.cv_results_) æ¡ˆä¾‹åˆ†æï¼šç”Ÿå­˜é¢„æµ‹ æ ¹æ®äººçš„ä¿¡æ¯é¢„æµ‹æ­¤äººåœ¨æ­¤ç¾éš¾ä¸­å­˜æ´»ä¸‹æ¥çš„æ¦‚ç‡ã€‚ 123456789101112131415161718192021222324252627282930313233343536import pandas as pdtitanic = pd.read_csv(\"titanic.csv\")# ç­›é€‰ç‰¹å¾å€¼å’Œç›®æ ‡å€¼x = titanic[[\"pclass\", \"age\", \"sex\"]]y = titanic[\"survived\"]# ç¼ºå¤±å€¼å¤„ç†x[\"age\"].fillna(x[\"age\"].mean(), inplace=True)# è½¬æ¢æˆå­—å…¸ï¼Œæ–¹ä¾¿å¤„ç†x = x.to_dict(orient=\"records\")from sklearn.model_selection import train_test_split# æ•°æ®é›†åˆ’åˆ†x_train, x_test, y_train, y_test = train_test_split(x, y, random_state=0)# å­—å…¸ç‰¹å¾æŠ½å–from sklearn.feature_extraction import DictVectorizerfrom sklearn.tree import DecisionTreeClassifiertransfer = DictVectorizer()x_train = transfer.fit_transform(x_train)x_test = transfer.transform(x_test)# é¢„ä¼°å™¨estimator = DecisionTreeClassifier(criterion=\"entropy\", max_depth=3)estimator.fit(x_train, y_train)y_predict = estimator.predict(x_test)print(\"y_predict:\\n\", y_predict)print(\"ç›´æ¥æ¯”å¯¹çœŸå®å€¼å’Œé¢„æµ‹å€¼:\\n\", y_test == y_predict)score = estimator.score(x_test, y_test)print(\"å‡†ç¡®ç‡ä¸ºï¼š\\n\", score) å›å½’ç®—æ³•çº¿æ€§å›å½’ ç›®æ ‡å€¼ä¸ºè¿ç»­æ€§çš„æ•°æ®ã€‚ æ­£è§„æ–¹ç¨‹12345678910111213141516171819202122232425262728293031from sklearn.datasets import load_bostonfrom sklearn.model_selection import train_test_splitfrom sklearn.preprocessing import StandardScalerfrom sklearn.linear_model import LinearRegressionfrom sklearn.metrics import mean_squared_error# æ­£è§„æ–¹ç¨‹çš„ä¼˜åŒ–æ–¹æ³•å¯¹æ³¢å£«é¡¿æˆ¿ä»·è¿›è¡Œé¢„æµ‹# è·å–æ•°æ®boston = load_boston()# åˆ’åˆ†æ•°æ®é›†x_train, x_test, y_train, y_test = train_test_split(boston.data, boston.target, random_state=22)# æ ‡å‡†åŒ–transfer = StandardScaler()x_train = transfer.fit_transform(x_train)x_test = transfer.transform(x_test)# é¢„ä¼°å™¨estimator = LinearRegression()estimator.fit(x_train, y_train)# å¾—å‡ºæ¨¡å‹print(\"æ­£è§„æ–¹ç¨‹-æƒé‡ç³»æ•°ä¸ºï¼š\\n\", estimator.coef_)print(\"æ­£è§„æ–¹ç¨‹-åç½®ä¸ºï¼š\\n\", estimator.intercept_)# æ¨¡å‹è¯„ä¼°y_predict = estimator.predict(x_test)print(\"é¢„æµ‹æˆ¿ä»·ï¼š\\n\", y_predict)error = mean_squared_error(y_test, y_predict)print(\"æ­£è§„æ–¹ç¨‹-å‡æ–¹è¯¯å·®ä¸ºï¼š\\n\", error) æ¢¯åº¦ä¸‹é™ ä¸€ä¸ªä¸æ–­é€¼è¿‘çš„ï¼Œå‹¤å¥‹åŠªåŠ›çš„ç®—æ³•ã€‚ 12345678910111213141516171819202122232425262728293031from sklearn.datasets import load_bostonfrom sklearn.model_selection import train_test_splitfrom sklearn.preprocessing import StandardScalerfrom sklearn.linear_model import SGDRegressorfrom sklearn.metrics import mean_squared_error# æ¢¯åº¦ä¸‹é™çš„ä¼˜åŒ–æ–¹æ³•å¯¹æ³¢å£«é¡¿æˆ¿ä»·è¿›è¡Œé¢„æµ‹# è·å–æ•°æ®boston = load_boston()# åˆ’åˆ†æ•°æ®é›†x_train, x_test, y_train, y_test = train_test_split(boston.data, boston.target, random_state=22)# æ ‡å‡†åŒ–transfer = StandardScaler()x_train = transfer.fit_transform(x_train)x_test = transfer.transform(x_test)# é¢„ä¼°å™¨estimator = SGDRegressor(learning_rate=\"constant\", eta0=0.01, max_iter=10000, penalty=\"l1\")estimator.fit(x_train, y_train)# å¾—å‡ºæ¨¡å‹print(\"æ¢¯åº¦ä¸‹é™-æƒé‡ç³»æ•°ä¸ºï¼š\\n\", estimator.coef_)print(\"æ¢¯åº¦ä¸‹é™-åç½®ä¸ºï¼š\\n\", estimator.intercept_)# æ¨¡å‹è¯„ä¼°y_predict = estimator.predict(x_test)print(\"é¢„æµ‹æˆ¿ä»·ï¼š\\n\", y_predict)error = mean_squared_error(y_test, y_predict)print(\"æ¢¯åº¦ä¸‹é™-å‡æ–¹è¯¯å·®ä¸ºï¼š\\n\", error) å²­å›å½’ å¸¦æœ‰ L2 æ­£åˆ™åŒ–çš„çº¿æ€§å›å½’ï¼šå²­å›å½’ 12345678910111213141516171819202122232425262728293031from sklearn.datasets import load_bostonfrom sklearn.model_selection import train_test_splitfrom sklearn.preprocessing import StandardScalerfrom sklearn.linear_model import Ridgefrom sklearn.metrics import mean_squared_error# æ¢¯åº¦ä¸‹é™çš„ä¼˜åŒ–æ–¹æ³•å¯¹æ³¢å£«é¡¿æˆ¿ä»·è¿›è¡Œé¢„æµ‹# è·å–æ•°æ®boston = load_boston()# åˆ’åˆ†æ•°æ®é›†x_train, x_test, y_train, y_test = train_test_split(boston.data, boston.target, random_state=22)# æ ‡å‡†åŒ–transfer = StandardScaler()x_train = transfer.fit_transform(x_train)x_test = transfer.transform(x_test)# é¢„ä¼°å™¨estimator = Ridge(alpha=0.5, max_iter=10000)estimator.fit(x_train, y_train)# å¾—å‡ºæ¨¡å‹print(\"å²­å›å½’-æƒé‡ç³»æ•°ä¸ºï¼š\\n\", estimator.coef_)print(\"å²­å›å½’-åç½®ä¸ºï¼š\\n\", estimator.intercept_)# æ¨¡å‹è¯„ä¼°y_predict = estimator.predict(x_test)print(\"é¢„æµ‹æˆ¿ä»·ï¼š\\n\", y_predict)error = mean_squared_error(y_test, y_predict)print(\"å²­å›å½’-å‡æ–¹è¯¯å·®ä¸ºï¼š\\n\", error) é€»è¾‘å›å½’ é€»è¾‘å›å½’ï¼ˆLogistic Regressionï¼‰æ˜¯ä¸€ç§ç”¨äºè§£å†³äºŒåˆ†ç±»ï¼ˆ0 or 1ï¼‰é—®é¢˜çš„æœºå™¨å­¦ä¹ æ–¹æ³•ï¼Œç”¨äºä¼°è®¡æŸç§äº‹ç‰©çš„å¯èƒ½æ€§ã€‚ ç²¾ç¡®ç‡ Precision å³ï¼ŒæŸ¥çš„å‡†ä¸å‡†ã€‚ å¬å›ç‡ Recall å³ï¼ŒæŸ¥çš„å…¨ä¸å…¨ã€‚ F1-score æ¨¡å‹çš„ç¨³å¥æ€§ã€‚ æ¡ˆä¾‹åˆ†æï¼šè‚¿ç˜¤é¢„æµ‹12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455import pandas as pdimport numpy as np# è¯»å–æ•°æ®path = \"https://archive.ics.uci.edu/ml/machine-learning-databases/breast-cancer-wisconsin/breast-cancer-wisconsin.data\"column_name = ['Sample code number', 'Clump Thickness', 'Uniformity of Cell Size', 'Uniformity of Cell Shape', 'Marginal Adhesion', 'Single Epithelial Cell Size', 'Bare Nuclei', 'Bland Chromatin', 'Normal Nucleoli', 'Mitoses', 'Class']data = pd.read_csv(path, names=column_name)# ç¼ºå¤±å€¼å¤„ç†# æ›¿æ¢ ã€‹ np.nandata = data.replace(to_replace=\"?\", value=np.nan)# åˆ é™¤ç¼ºå¤±æ ·æœ¬data.dropna(inplace=True)# æ£€æŸ¥æ˜¯å¦è¿˜å­˜åœ¨ç¼ºå¤±å€¼data.isnull().any()# åˆ’åˆ†æ•°æ®é›†from sklearn.model_selection import train_test_split# ç­›é€‰ç‰¹å¾å€¼å’Œç›®æ ‡å€¼x = data.iloc[:, 1:-1]y = data[\"Class\"]x_train, x_test, y_train, y_test = train_test_split(x, y, random_state=0)# æ ‡å‡†åŒ–from sklearn.preprocessing import StandardScalertransfer = StandardScaler()x_train = transfer.fit_transform(x_train)x_test = transfer.transform(x_test)# é€»è¾‘å›å½’é¢„æµ‹from sklearn.linear_model import LogisticRegressionestimator = LogisticRegression()estimator.fit(x_train, y_train)# é€»è¾‘å›å½’çš„æ¨¡å‹å‚æ•°ï¼šå›å½’ç³»æ•°å’Œåç½®print(\"é€»è¾‘å›å½’-å›å½’ç³»æ•°ï¼š\", estimator.coef_, \"é€»è¾‘å›å½’-åç½®ï¼š\" , estimator.intercept_)y_predict = estimator.predict(x_test)print(\"y_predict:\\n\", y_predict)print(\"ç›´æ¥æ¯”å¯¹çœŸå®å€¼å’Œé¢„æµ‹å€¼:\\n\", y_test == y_predict)score = estimator.score(x_test, y_test)print(\"å‡†ç¡®ç‡ä¸ºï¼š\\n\", score)# æŸ¥çœ‹ç²¾ç¡®ç‡ã€å¬å›ç‡ã€F1-scorefrom sklearn.metrics import classification_reportreport = classification_report(y_test, y_predict, target_names=[\"è‰¯æ€§\", \"æ¶æ€§\"])# y_trueï¼šæ¯ä¸ªæ ·æœ¬çš„çœŸå®ç±»åˆ«ï¼Œå¿…é¡»ä¸º 0 åï¼Œ1 æ­£æ ‡è®°# å°† y_test è½¬æ¢æˆ 0 1y_true = np.where(y_test &gt; 3, 1, 0)from sklearn.metrics import roc_auc_scoreroc_auc_score(y_true, y_predict) K-means æ— ç›‘ç£ç®—æ³•ã€‚ è´­ç‰©è½¦æ¡ˆä¾‹123456789101112# é¢„ä¼°å™¨æµç¨‹from sklearn.cluster import KMeansestimator &#x3D; KMeans(n_clusters&#x3D;3)estimator.fit(data_new)y_predict &#x3D; estimator.predict(data_new)y_predict[:300]# æ¨¡å‹è¯„ä¼°-è½®å»“ç³»æ•°from sklearn.metrics import silhouette_scoresilhouette_score(data_new, y_predict)","categories":[{"name":"Python","slug":"Python","permalink":"http://yoursite.com/categories/Python/"}],"tags":[{"name":"Machine Learning","slug":"Machine-Learning","permalink":"http://yoursite.com/tags/Machine-Learning/"},{"name":"sklearn","slug":"sklearn","permalink":"http://yoursite.com/tags/sklearn/"}]},{"title":"RabbitMQ åˆæ­¥ä½¿ç”¨","slug":"Software/RabbitMQ åˆæ­¥ä½¿ç”¨","date":"2020-04-20T06:02:25.000Z","updated":"2020-04-30T03:49:46.237Z","comments":true,"path":"2020/04/20/Software/RabbitMQ åˆæ­¥ä½¿ç”¨/","link":"","permalink":"http://yoursite.com/2020/04/20/Software/RabbitMQ%20%E5%88%9D%E6%AD%A5%E4%BD%BF%E7%94%A8/","excerpt":"RabbitMQ çš„ç®€å•ä»‹ç»åŠé¡¹ç›®ä½¿ç”¨ã€‚","text":"RabbitMQ çš„ç®€å•ä»‹ç»åŠé¡¹ç›®ä½¿ç”¨ã€‚ åœ¨è™šæ‹Ÿæœºä¸­åŸºäº Docker å®‰è£… RabbitMQ é•œåƒï¼Œå¯åŠ¨é•œåƒå¹¶æš´éœ²å…¶ç«¯å£ã€‚ 1docker run -d -p 5672:5672 -p 15672:15672 --hostname my_rabbitmq --name rabbitmq rabbitmq:management è®¿é—® [è™šæ‹Ÿæœº IP]:15672 è¿›å…¥ RabbitMQ çš„æ§åˆ¶å°é¡µé¢ï¼Œé»˜è®¤è´¦å·å¯†ç çš†ä¸º guestã€‚ åŸºæœ¬æ¦‚å¿µ é«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼Œå³ Advanced Message Queuing Protocolï¼ˆAMQPï¼‰æ˜¯é¢å‘æ¶ˆæ¯ä¸­é—´ä»¶æä¾›çš„å¼€æ”¾çš„åº”ç”¨å±‚åè®®ï¼Œå…¶è®¾è®¡ç›®æ ‡æ˜¯å¯¹äºæ¶ˆæ¯çš„æ’åºã€è·¯ç”±ï¼ˆåŒ…æ‹¬ç‚¹å¯¹ç‚¹å’Œè®¢é˜…-å‘å¸ƒï¼‰ã€ä¿æŒå¯é æ€§ã€ä¿è¯å®‰å…¨æ€§ã€‚ RabbitMQ å®ç°äº† AMQPã€‚ RabbitMQ çš„åŸºæœ¬ä½¿ç”¨æµç¨‹ï¼š å®¢æˆ·ç«¯è¿æ¥åˆ°æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡å™¨ï¼Œæ‰“å¼€ä¸€ä¸ª channelï¼›å®¢æˆ·ç«¯å£°æ˜ä¸€ä¸ª exchangeï¼Œå¹¶è®¾ç½®ç›¸å…³å±æ€§ï¼›å®¢æˆ·ç«¯å£°æ˜ä¸€ä¸ª queueï¼Œå¹¶è®¾ç½®ç›¸å…³å±æ€§ï¼›å®¢æˆ·ç«¯ä½¿ç”¨ routing keyï¼Œåœ¨ exchange å’Œ queue ä¹‹é—´å»ºç«‹å¥½ç»‘å®šå…³ç³»ï¼›å®¢æˆ·ç«¯æŠ•é€’æ¶ˆæ¯åˆ° exchangeã€‚ Brokerï¼šç®€å•æ¥è¯´å°±æ˜¯æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡å™¨å®ä½“ã€‚Exchangeï¼šæ¶ˆæ¯äº¤æ¢æœºï¼Œå®ƒæŒ‡å®šæ¶ˆæ¯æŒ‰ä»€ä¹ˆè§„åˆ™ï¼Œè·¯ç”±åˆ°å“ªä¸ªé˜Ÿåˆ—ã€‚Queueï¼šæ¶ˆæ¯é˜Ÿåˆ—è½½ä½“ï¼Œæ¯ä¸ªæ¶ˆæ¯éƒ½ä¼šè¢«æŠ•å…¥åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªé˜Ÿåˆ—ã€‚Bindingï¼šç»‘å®šï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯æŠŠ exchange å’Œ queue æŒ‰ç…§è·¯ç”±è§„åˆ™ç»‘å®šèµ·æ¥ã€‚Routing Keyï¼šè·¯ç”±å…³é”®å­—ï¼Œexchange æ ¹æ®è¿™ä¸ªå…³é”®å­—è¿›è¡Œæ¶ˆæ¯æŠ•é€’ã€‚vhostï¼šè™šæ‹Ÿä¸»æœºï¼Œä¸€ä¸ª broker é‡Œå¯ä»¥å¼€è®¾å¤šä¸ª vhostï¼Œç”¨ä½œä¸åŒç”¨æˆ·çš„æƒé™åˆ†ç¦»ã€‚producerï¼šæ¶ˆæ¯ç”Ÿäº§è€…ï¼Œå°±æ˜¯æŠ•é€’æ¶ˆæ¯çš„ç¨‹åºã€‚consumerï¼šæ¶ˆæ¯æ¶ˆè´¹è€…ï¼Œå°±æ˜¯æ¥å—æ¶ˆæ¯çš„ç¨‹åºã€‚channelï¼šæ¶ˆæ¯é€šé“ï¼Œåœ¨å®¢æˆ·ç«¯çš„æ¯ä¸ªè¿æ¥é‡Œï¼Œå¯å»ºç«‹å¤šä¸ª channelï¼Œæ¯ä¸ª channel ä»£è¡¨ä¸€ä¸ªä¼šè¯ä»»åŠ¡ã€‚ ç®€å•ç¤ºä¾‹ ç¼–å†™ä¸€ä¸ªåŸºæœ¬çš„ consumer ä»¥åŠ provider è¿›è¡Œæ¶ˆæ¯çš„æ¥å—ä¸æŠ•é€’ã€‚ simple-consumer ç¼–å†™ä¸€ä¸ªç®€å•çš„æ¶ˆè´¹è€…è¿æ¥åˆ° RabbitMQï¼Œå¹¶ä¸”åˆå§‹åŒ–æ‰€éœ€çš„ Exchangeã€Queueã€Routing Keyã€Binding ç­‰ã€‚ 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-amqp&lt;/artifactId&gt;&lt;/dependency&gt; 123456789spring.rabbitmq.addresses=192.168.31.100:5672spring.rabbitmq.username=guestspring.rabbitmq.password=guestspring.rabbitmq.virtual-host=/spring.rabbitmq.connection-timeout=15000spring.rabbitmq.listener.simple.acknowledge-mode=manualspring.rabbitmq.listener.simple.concurrency=5spring.rabbitmq.listener.simple.max-concurrency=10 Receiver é€šè¿‡ @RabbitListenerè¿›è¡Œåˆå§‹åŒ–å¹¶ç»‘å®šï¼šå¯åœ¨é…ç½®æ–‡ä»¶ä¸­ç¼–å†™åé€šè¿‡${xxx.xxx...}è¿›è¡Œå–å€¼ã€‚ ï¼ï¼ï¼æ³¨æ„ï¼ï¼ï¼æ­¤å¤„çš„ Order ç±»ä¾èµ–äº provider æ¨¡å—çš„ Order ç±»ã€‚ 12345678910111213141516171819202122@Componentpublic class RabbitReceiver &#123; @RabbitListener( bindings = @QueueBinding( value = @Queue(value = \"queue-1\", durable=\"true\"), exchange = @Exchange(value = \"exchange-1\", durable = \"true\", type = \"topic\", ignoreDeclarationExceptions = \"true\"), key = \"springboot.*\" ) ) @RabbitHandler public void onOrderMessage(@Payload Order order, Channel channel, @Headers Map&lt;String, Object&gt; headers) throws Exception &#123; System.err.println(\"--------------------------------------\"); System.err.println(\"æ¶ˆè´¹ç«¯ Order: \" + order.getId()); Long deliveryTag = (Long)headers.get(AmqpHeaders.DELIVERY_TAG); //æ‰‹å·¥ACK channel.basicAck(deliveryTag, false); &#125;&#125; è¿è¡Œé¡¹ç›®ã€‚ æç¤ºï¼šè¿æ¥æˆåŠŸã€‚æ‰“å¼€ RabbitMQ æ§åˆ¶å°ã€‚ å¯ä»¥çœ‹åˆ°æœ‰ä¸€æ¡æ¥è‡ªæœ¬åœ°ç«¯å£ 9371 çš„è¿æ¥ã€‚ æŸ¥çœ‹ Exchange å¯ä»¥çœ‹åˆ°å®¢æˆ·ç«¯æ‰€ç»‘å®šçš„è§„åˆ™å·²ç»è¢«è‡ªåŠ¨åˆå§‹åŒ–ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥é€‰æ‹©æ‰‹å·¥ç»‘å®šï¼‰ simple-provider ç¼–å†™ä¸€ä¸ªç®€å•çš„æä¾›è€…è¿æ¥åˆ° RabbitMQï¼Œå¹¶å‘é€æ¶ˆæ¯åˆ°å¯¹åº”çš„é˜Ÿåˆ—ä¸­ã€‚ 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-amqp&lt;/artifactId&gt;&lt;/dependency&gt; 12345678910spring.rabbitmq.addresses=192.168.31.100:5672spring.rabbitmq.username=guestspring.rabbitmq.password=guestspring.rabbitmq.virtual-host=/spring.rabbitmq.connection-timeout=15000# å¯ç”¨å›è°ƒspring.rabbitmq.publisher-confirm-type=correlatedspring.rabbitmq.publisher-returns=truespring.rabbitmq.template.mandatory=true æ–°å»ºä¸€ä¸ªå®ä½“å¯¹è±¡ç”¨äºå‘é€ã€‚ 12345678910public class Order implements Serializable &#123; private static final long serialVersionUID = -3603050220195298978L; private String id; private String name; // ...&#125; Sender ç¼–å†™å‘é€æ–¹æ³•ï¼Œå¹¶è‡ªå®šä¹‰å›è°ƒå½¢å¼ã€‚ 12345678910111213141516171819202122232425262728293031323334353637@Componentpublic class RabbitSender &#123; @Autowired private RabbitTemplate rabbitTemplate; // å›è°ƒå‡½æ•°: confirm ç¡®è®¤ final RabbitTemplate.ConfirmCallback confirmCallback = new RabbitTemplate.ConfirmCallback() &#123; @Override public void confirm(CorrelationData correlationData, boolean ack, String cause) &#123; System.err.println(\"correlationData: \" + correlationData); System.err.println(\"ack: \" + ack); if(!ack)&#123; System.err.println(\"å¼‚å¸¸å¤„ç†....\"); &#125; &#125; &#125;; // å›è°ƒå‡½æ•°: return è¿”å› final RabbitTemplate.ReturnCallback returnCallback = new RabbitTemplate.ReturnCallback() &#123; @Override public void returnedMessage(org.springframework.amqp.core.Message message, int replyCode, String replyText, String exchange, String routingKey) &#123; System.err.println(\"return exchange: \" + exchange + \", routingKey: \" + routingKey + \", replyCode: \" + replyCode + \", replyText: \" + replyText); &#125; &#125;; // å‘é€æ¶ˆæ¯æ–¹æ³•è°ƒç”¨: æ„å»ºè‡ªå®šä¹‰å¯¹è±¡æ¶ˆæ¯ public void sendOrder(Order order) throws Exception &#123; rabbitTemplate.setConfirmCallback(confirmCallback); rabbitTemplate.setReturnCallback(returnCallback); // id + æ—¶é—´æˆ³ å…¨å±€å”¯ä¸€ CorrelationData correlationData = new CorrelationData(\"987654321\"); rabbitTemplate.convertAndSend(\"exchange-1\", \"springboot.order\", order, correlationData); &#125;&#125; ç¼–å†™æµ‹è¯•æ–¹æ³•è¿›è¡Œæµ‹è¯•ã€‚ 12345678910111213@RunWith(SpringRunner.class)@SpringBootTestclass SimpleProviderApplicationTests &#123; @Autowired private RabbitSender rabbitSender; @Test public void testSender() throws Exception &#123; Order order = new Order(\"001\", \"ç¬¬ä¸€ä¸ªè®¢å•\"); rabbitSender.sendOrder(order); &#125;&#125; æ§åˆ¶å°æ‰“å°äº†äº†è‡ªå®šä¹‰å›è°ƒçš„ç¡®è®¤ä¿¡æ¯ã€‚ RabbitMQ æ§åˆ¶å°å¯ä»¥æŸ¥çœ‹åˆ°å‘é€çš„æ¶ˆæ¯çš„è¯¦ç»†ä¿¡æ¯ã€‚ å¯åŠ¨æ¶ˆè´¹è€…åï¼Œæ¶ˆè´¹è€…ç›‘å¬åˆ°é˜Ÿåˆ—ä¸­æœ‰æ¶ˆæ¯å¹¶äº†è¿›è¡Œæ¶ˆè´¹ã€‚ å¯é äº¤ä»˜ å¯é äº¤ä»˜å³å°† RabbitMQ å¤„ç†è®¢å•çš„çŠ¶æ€æŒä¹…åŒ–åˆ°æ•°æ®åº“ä¸­ï¼Œå¹¶æ ¹æ®æ­¤çŠ¶æ€è¡¨å¯¹ä¸åŒçŠ¶æ€çš„äº¤ä»˜ä»»åŠ¡è¿›è¡Œå¤„ç†ï¼š 1ï¼‰åœ¨è¾¾åˆ°è§„å®šçš„æœ€å¤§é‡è¯•æ¬¡æ•°ä¹‹å‰ï¼Œå®šæ—¶ä»»åŠ¡åœ¨è§„å®šçš„æ—¶é—´é—´éš”è‡ªåŠ¨è¿›è¡Œä»»åŠ¡çš„é‡æ–°äº¤ä»˜ï¼›2ï¼‰ä»»åŠ¡è¾¾åˆ°äº†æœ€å¤§çš„é‡è¯•æ¬¡æ•°åï¼Œä¸ºé¿å…æµªè´¹èµ„æºå°†å…¶çŠ¶æ€æ›´æ–°ä¸ºå¤±è´¥ï¼Œä¹‹åäººå·¥å¤„ç†ã€‚ 12345678910111213141516171819-- è¡¨ my_order è®¢å•ç»“æ„CREATE TABLE IF NOT EXISTS `my_order` ( `id` varchar(128) NOT NULL, -- è®¢å• ID `name` varchar(128), -- è®¢å•åç§° å…¶ä»–ä¸šåŠ¡ç†Ÿæ‚‰å¿½ç•¥ `message_id` varchar(128) NOT NULL, -- æ¶ˆæ¯å”¯ä¸€ ID PRIMARY KEY (`id`)) ENGINE=InnoDB DEFAULT CHARSET=utf8;-- è¡¨ log æ¶ˆæ¯è®°å½•ç»“æ„CREATE TABLE IF NOT EXISTS `log` ( `message_id` varchar(128) NOT NULL, -- æ¶ˆæ¯å”¯ä¸€ ID `message` varchar(4000) DEFAULT NULL, -- æ¶ˆæ¯å†…å®¹ `try_count` int(4) DEFAULT '0', -- é‡è¯•æ¬¡æ•° `status` varchar(10) DEFAULT '', -- æ¶ˆæ¯æŠ•é€’çŠ¶æ€ï¼š0 æŠ•é€’ä¸­ 1 æŠ•é€’æˆåŠŸ 2 æŠ•é€’å¤±è´¥ `next_retry` timestamp NOT NULL DEFAULT '0000-00-00 00:00:00', -- ä¸‹ä¸€æ¬¡é‡è¯•æ—¶é—´ `create_time` timestamp NOT NULL DEFAULT '0000-00-00 00:00:00', -- åˆ›å»ºæ—¶é—´ `update_time` timestamp NOT NULL DEFAULT '0000-00-00 00:00:00', -- æ›´æ–°æ—¶é—´ PRIMARY KEY (`message_id`)) ENGINE=InnoDB DEFAULT CHARSET=utf8; é¡¹ç›®ä¾èµ–1234567891011121314151617181920212223242526272829303132333435363738394041424344&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;&lt;/dependency&gt;&lt;!-- RabbitMQ --&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-amqp&lt;/artifactId&gt;&lt;/dependency&gt;&lt;!-- mybatis-plus --&gt;&lt;dependency&gt; &lt;groupId&gt;com.baomidou&lt;/groupId&gt; &lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt; &lt;version&gt;3.2.0&lt;/version&gt;&lt;/dependency&gt;&lt;!-- mysqlé©±åŠ¨ --&gt;&lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;!-- å¯åŠ¨å™¨ä¸­é»˜è®¤çš„ç‰ˆæœ¬è¾ƒé«˜ --&gt; &lt;version&gt;5.1.47&lt;/version&gt; &lt;scope&gt;runtime&lt;/scope&gt;&lt;/dependency&gt;&lt;!-- å¸¸ç”¨å·¥å…·ç±» --&gt;&lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;fastjson&lt;/artifactId&gt; &lt;version&gt;1.1.26&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.commons&lt;/groupId&gt; &lt;artifactId&gt;commons-lang3&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;commons-io&lt;/groupId&gt; &lt;artifactId&gt;commons-io&lt;/artifactId&gt; &lt;version&gt;2.4&lt;/version&gt;&lt;/dependency&gt;&lt;!-- Lombok --&gt;&lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;version&gt;1.18.12&lt;/version&gt;&lt;/dependency&gt; 12345678910111213141516171819## é…ç½®æ•°æ®æºspring.datasource.username=rootspring.datasource.password=123456spring.datasource.url=jdbc:mysql://localhost:3306/rabbitmq_test?useSSL=falsespring.datasource.driver-class-name=com.mysql.jdbc.Driver# æ‰“å° SQL è¯­å¥#mybatis-plus.configuration.log-impl=org.apache.ibatis.logging.stdout.StdOutImplmybatis-plus.mapper-locations=classpath:/mapper/*.xml## RabbitMQspring.rabbitmq.addresses=192.168.31.100:5672spring.rabbitmq.username=guestspring.rabbitmq.password=guestspring.rabbitmq.virtual-host=/spring.rabbitmq.connection-timeout=15000# å›è°ƒé…ç½®spring.rabbitmq.publisher-confirm-type=correlatedspring.rabbitmq.publisher-returns=truespring.rabbitmq.template.mandatory=true æ–°å»ºä¸€ä¸ª rabbitmq-entity æ¨¡å—ï¼Œç¼–å†™ä¼ è¾“å®ä½“ç±»ã€‚ 12345678910public class Order implements Serializable &#123; private static final long serialVersionUID = 2584584237793643231L; private String id; private String name; private String messageId; //...&#125; æ–°å»ºä¸€ä¸ª stable-provider æ¨¡å—ï¼Œç¼–å†™å¯é çš„äº¤ä»˜è€…ã€‚ ç¼–å†™çŠ¶æ€çš„å®ä½“ç±»ï¼Œä»¥åŠå¸¸é‡ç±» 12345678910111213@Datapublic class Log implements Serializable &#123; private static final long serialVersionUID = -8716210355448974538L; private String messageId; private String message; private Integer tryCount = 0; private String status; private Date nextRetry; private Date createTime; private Date updateTime;&#125; 1234567891011121314151617public class Constant &#123; private Constant() &#123; throw new IllegalStateException(\"Utility class\"); &#125; /** è®¢å•çŠ¶æ€ 0 è¡¨ç¤ºå¾…å‘é€ */ public static final String ORDER_SENDING = \"0\"; /** è®¢å•çŠ¶æ€ 1 è¡¨ç¤ºå‘é€æˆåŠŸ */ public static final String ORDER_SEND_SUCCESS = \"1\"; /** è®¢å•çŠ¶æ€ 2 è¡¨ç¤ºå‘é€å¤±è´¥ */ public static final String ORDER_SEND_FAILURE = \"2\"; /** è®¢å•è¶…æ—¶æ—¶é—´ï¼Œå³ä¸€åˆ†é’Ÿåè®¢å•è¿›è¡Œäº¤ä»˜é‡è¯• */ public static final Integer ORDER_TIMEOUT = 1; /** è®¢å•æœ€å¤§é‡è¯•æ¬¡æ•° */ public static final Integer ORDER_RETRY_MAX_TIMES = 3;&#125; ç¼–å†™ Mapperã€‚ 1234567891011121314151617181920212223242526@Componentpublic interface LogMapper extends BaseMapper&lt;Log&gt; &#123; /** * æ›´æ–°æœ€ç»ˆæ¶ˆæ¯å‘é€ç»“æœ æˆåŠŸ or å¤±è´¥ * @param messageId æ¶ˆæ¯çš„å”¯ä¸€ ID * @param status è®¢å•çŠ¶æ€ * @param updateTime è®¢å•çŠ¶æ€æ›´æ–°æ—¶é—´ */ void changeBrokerMessageLogStatus(@Param(\"messageId\") String messageId , @Param(\"status\") String status , @Param(\"updateTime\") Date updateTime ); /** * æŸ¥è¯¢æ¶ˆæ¯çŠ¶æ€ä¸º 0 ä¸”å·²ç»è¶…æ—¶çš„æ¶ˆæ¯é›†åˆ * @return ç¬¦åˆæ¡ä»¶çš„è®¢å•é›†åˆ */ List&lt;Log&gt; query4StatusAndTimeoutMessage(); /** * @param messageId æ¶ˆæ¯çš„å”¯ä¸€ ID * @param date æ—¶é—´ */ void update4ReSend(@Param(\"messageId\") String messageId, @Param(\"updateTime\") Date date);&#125; 12345678910// Order ä¸º SQL å…³é”®å­—ï¼Œå¹¶ä¸”åªæœ‰ä¸€ä¸ªæ’å…¥æ–¹æ³•ï¼Œæ•…å®Œå…¨ä½¿ç”¨è‡ªå®šä¹‰æ–¹æ³•ä¸ç»§æ‰¿@Componentpublic interface OrderMapper&#123; /** * @param order è®¢å• */ void insert(Order order);&#125; 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;!DOCTYPE mapper PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"&gt;&lt;mapper namespace=\"com.wingo.stableprovider.mapper.LogMapper\"&gt; &lt;!-- é€šç”¨æŸ¥è¯¢æ˜ å°„ç»“æœ --&gt; &lt;resultMap id=\"BaseResultMap\" type=\"com.wingo.stableprovider.entity.Log\"&gt; &lt;id column=\"message_id\" property=\"messageId\" jdbcType=\"VARCHAR\" /&gt; &lt;result column=\"message\" property=\"message\" jdbcType=\"VARCHAR\" /&gt; &lt;result column=\"try_count\" property=\"tryCount\" jdbcType=\"INTEGER\" /&gt; &lt;result column=\"status\" property=\"status\" jdbcType=\"VARCHAR\" /&gt; &lt;result column=\"next_retry\" property=\"nextRetry\" jdbcType=\"TIMESTAMP\" /&gt; &lt;result column=\"create_time\" property=\"createTime\" jdbcType=\"TIMESTAMP\" /&gt; &lt;result column=\"update_time\" property=\"updateTime\" jdbcType=\"TIMESTAMP\" /&gt; &lt;/resultMap&gt; &lt;!-- é€šç”¨æŸ¥è¯¢ç»“æœåˆ— --&gt; &lt;sql id=\"Base_Column_List\"&gt; message_id, message, try_count, status, next_retry, create_time, update_time &lt;/sql&gt; &lt;update id=\"changeBrokerMessageLogStatus\" &gt; UPDATE log SET status = #&#123;status&#125;, update_time = #&#123;updateTime&#125; WHERE message_id = #&#123;messageId&#125; &lt;/update&gt; &lt;select id=\"query4StatusAndTimeoutMessage\" resultMap=\"BaseResultMap\"&gt; SELECT &lt;include refid=\"Base_Column_List\" /&gt; FROM log WHERE status = '0' AND next_retry &lt;![CDATA[ &lt;= ]]&gt; sysdate() &lt;/select&gt; &lt;update id=\"update4ReSend\" &gt; UPDATE log SET try_count = try_count + 1, update_time = #&#123;updateTime&#125; WHERE message_id = #&#123;messageId&#125; &lt;/update&gt;&lt;/mapper&gt; 1234567891011121314151617181920212223&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;!DOCTYPE mapper PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"&gt;&lt;mapper namespace=\"com.wingo.stableprovider.mapper.OrderMapper\"&gt; &lt;!-- é€šç”¨æŸ¥è¯¢æ˜ å°„ç»“æœ --&gt; &lt;resultMap id=\"BaseResultMap\" type=\"com.wingo.entity.Order\"&gt; &lt;id column=\"id\" property=\"id\" jdbcType=\"VARCHAR\" /&gt; &lt;result column=\"name\" property=\"name\" jdbcType=\"VARCHAR\" /&gt; &lt;result column=\"message_id\" property=\"messageId\" jdbcType=\"VARCHAR\" /&gt; &lt;/resultMap&gt; &lt;!-- é€šç”¨æŸ¥è¯¢ç»“æœåˆ— --&gt; &lt;sql id=\"Base_Column_List\"&gt; id, name, message_id &lt;/sql&gt; &lt;insert id=\"insert\" parameterType=\"com.wingo.entity.Order\" &gt; INSERT INTO my_order (id, name, message_id) VALUES (#&#123;id&#125;, #&#123;name&#125;, #&#123;messageId&#125;) &lt;/insert&gt;&lt;/mapper&gt; ç¼–å†™ä¸€ä¸ªæœåŠ¡ç”¨äºå‘æ•°æ®åº“åˆå§‹åŒ–è®¢å•æ•°æ®ä»¥åŠæ¶ˆæ¯çŠ¶æ€ä¿¡æ¯ã€‚ 123456789101112131415161718192021222324252627282930313233@Servicepublic class OrderService &#123; @Autowired private OrderMapper orderMapper; @Autowired private LogMapper logMapper; @Autowired private OrderSender orderSender; public void createOrder(Order order) throws Exception &#123; // æ•°æ®åº“æ’å…¥è®¢å•ä¿¡æ¯ orderMapper.insert(order); // åˆå§‹åŒ–æ—¥å¿—ä¿¡æ¯ Log log = new Log(); Date orderTime = new Date(); log.setMessageId(order.getMessageId()); // å°†è®¢å•è½¬ä¸º JSON å­—ç¬¦ä¸²åœ¨é‡æ–°å‘é€æ—¶ä½¿ç”¨ String jOrder = JSON.toJSONString(order); log.setMessage(jOrder); log.setStatus(\"0\"); log.setNextRetry(DateUtils.addMinutes(orderTime, Constant.ORDER_TIMEOUT)); log.setCreateTime(new Date()); log.setUpdateTime(new Date()); // æ•°æ®åº“æ’å…¥æ—¥å¿—ä¿¡æ¯ logMapper.insert(log); // order message sender orderSender.sendOrder(order); &#125;&#125; Sender ç¼–å†™ RabbitMQ çš„äº¤ä»˜ç±»ã€‚ 12345678910111213141516171819202122232425262728293031323334@Componentpublic class OrderSender &#123; @Autowired private RabbitTemplate rabbitTemplate; @Autowired private LogMapper logMapper; // å›è°ƒå‡½æ•°: confirm ç¡®è®¤ final RabbitTemplate.ConfirmCallback confirmCallback = new RabbitTemplate.ConfirmCallback() &#123; @Override public void confirm(CorrelationData correlationData, boolean ack, String cause) &#123; System.err.println(\"correlationData: \" + correlationData); String messageId = correlationData.getId(); if(ack)&#123; // å¦‚æœ confirm è¿”å›æˆåŠŸï¼Œåˆ™å¯¹ Order è¡¨ä¸­å¯¹åº”çš„è®¢å•çŠ¶æ€è¿›è¡Œæ›´æ–° logMapper.changeBrokerMessageLogStatus(messageId, Constant.ORDER_SEND_SUCCESS, new Date()); &#125; else &#123; // å¤±è´¥åˆ™è¿›è¡Œå…·ä½“çš„åç»­æ“ä½œï¼šé‡è¯•æˆ–è€…è¡¥å¿ç­‰æ‰‹æ®µ System.err.println(\"å¼‚å¸¸å¤„ç†...\"); &#125; &#125; &#125;; // å‘é€æ¶ˆæ¯æ–¹æ³•è°ƒç”¨: æ„å»ºè‡ªå®šä¹‰å¯¹è±¡æ¶ˆæ¯ public void sendOrder(Order order) throws Exception &#123; // è®¾ç½®è‡ªå®šä¹‰å›è°ƒæ–¹æ³• rabbitTemplate.setConfirmCallback(confirmCallback); // æ¶ˆæ¯å”¯ä¸€ ID CorrelationData correlationData = new CorrelationData(order.getMessageId()); rabbitTemplate.convertAndSend(\"order-exchange\", \"order.stable\", order, correlationData); &#125;&#125; Task ç¼–å†™å®šæ—¶ä»»åŠ¡ï¼Œå®šæœŸå¯¹æ•°æ®åº“ä¸­çš„ä»»åŠ¡çŠ¶æ€è¿›è¡Œè¯»å–ï¼Œå¯¹é‡è¯•æ»¡è¶³æ¡ä»¶çš„äº¤ä»˜ä»»åŠ¡è¿›è¡Œé‡æ–°å‘é€ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738@Componentpublic class RetryMessage &#123; @Autowired private OrderSender orderSender; @Autowired private LogMapper logMapper; // 3 ç§’åæ‰§è¡Œï¼Œä¹‹åæ¯ 10 ç§’æ‰§è¡Œä¸€æ¬¡ @Scheduled(initialDelay = 3000, fixedDelay = 10000) public void reSend()&#123; System.err.println(\"---------------å®šæ—¶ä»»åŠ¡å¼€å§‹---------------\"); // å–æ•°æ®åº“ä¸­æ‰€æœ‰çš„çŠ¶æ€ä¸º 0 å¹¶ä¸”å·²ç»è¶…æ—¶çš„è®¢å• List&lt;Log&gt; list = logMapper.query4StatusAndTimeoutMessage(); if(list.isEmpty())&#123; System.out.println(\"æ— äº¤ä»˜å¤±è´¥è®¢å•\"); &#125; list.forEach(messageLog -&gt; &#123; if(messageLog.getTryCount() &gt;= Constant.ORDER_RETRY_MAX_TIMES)&#123; // å¦‚æœé‡è¯•æ¬¡æ•°è¶…è¿‡è§„å®šçš„æœ€å¤§æ¬¡æ•°åˆ™è¡¨ç¤ºäº¤ä»˜å¤±è´¥ logMapper.changeBrokerMessageLogStatus(messageLog.getMessageId(), Constant.ORDER_SEND_FAILURE, new Date()); System.out.println(\"æœ‰æ–°çš„äº¤ä»˜å¤±è´¥è®¢å•\"); &#125; else &#123; // å¢åŠ é‡è¯•æ¬¡æ•° logMapper.update4ReSend(messageLog.getMessageId(), new Date()); Order reSendOrder = JSON.parseObject(messageLog.getMessage(), Order.class); try &#123; orderSender.sendOrder(reSendOrder); System.out.println(\"é‡è¯•è®¢å•äº¤ä»˜\"); &#125; catch (Exception e) &#123; e.printStackTrace(); System.err.println(\"-----------å¼‚å¸¸å¤„ç†-----------\"); &#125; &#125; &#125;); // forEach ç»“æŸ &#125;&#125; ä¸»ç±»ä¸Šè¿˜éœ€è¦åŠ ä¸Šå‡ ä¸ªæ³¨è§£ã€‚ 123@MapperScan(\"com.wingo.stableprovider.mapper\")@EnableScheduling@SpringBootApplication äº¤ä»˜å¤±è´¥æ—¶çš„æ§åˆ¶å°æ‰“å°ä¿¡æ¯ã€‚ åºåˆ—åŒ–é”™è¯¯åœºæ™¯ï¼š consumer å’Œ provider æ¨¡å—å„è‡ªæœ‰ä¸€ä¸ªå¯åºåˆ—åŒ–çš„ entity.Order ç±»ï¼› åºåˆ—åŒ–ä¸ååºåˆ—åŒ–æ—¶ï¼Œä¸¤ä¸ª Order è™½ç„¶ä»£ç ç›¸åŒï¼Œä½†åº•å±‚åºåˆ—åŒ–åçš„æ ‡è®°ä¸åŒï¼Œè™šæ‹Ÿæœºä¸ä¼šè®¤ä¸ºå®ƒä»¬æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œå‡ºç°ååºåˆ—åŒ–é”™è¯¯ã€‚ 1Caused by: org.springframework.messaging.converter.MessageConversionException: Cannot convert from è§£å†³æ–¹æ¡ˆï¼š 1ï¼‰consumer å’Œ provider å¼•ç”¨åŒä¸€ä¸ª entity.Order ç±»ï¼› 2ï¼‰åˆ©ç”¨ jackson å·¥å…·è¿›è¡Œè½¬åŒ–ï¼Œä¼ é€’ Json ä¸²ã€‚","categories":[{"name":"Distributed","slug":"Distributed","permalink":"http://yoursite.com/categories/Distributed/"}],"tags":[{"name":"RabbitMQ","slug":"RabbitMQ","permalink":"http://yoursite.com/tags/RabbitMQ/"}]},{"title":"Dubbo åˆæ­¥ä½¿ç”¨","slug":"Software/Dubbo åˆæ­¥ä½¿ç”¨","date":"2020-04-17T01:50:34.000Z","updated":"2020-04-19T06:40:55.273Z","comments":true,"path":"2020/04/17/Software/Dubbo åˆæ­¥ä½¿ç”¨/","link":"","permalink":"http://yoursite.com/2020/04/17/Software/Dubbo%20%E5%88%9D%E6%AD%A5%E4%BD%BF%E7%94%A8/","excerpt":"Dubbo + Zookeeper çš„ç®€å•ä»‹ç»ï¼Œä»¥åŠæ•´åˆä½¿ç”¨ã€‚","text":"Dubbo + Zookeeper çš„ç®€å•ä»‹ç»ï¼Œä»¥åŠæ•´åˆä½¿ç”¨ã€‚ åŸºç¡€ç†è®ºåº”ç”¨çš„å‘å±•ä¸æ¼”å˜ï¼š å½“ç½‘ç«™æµé‡å¾ˆå°æ—¶ï¼Œåªéœ€ä¸€ä¸ªåº”ç”¨ï¼Œå°†æ‰€æœ‰åŠŸèƒ½éƒ½éƒ¨ç½²åœ¨ä¸€èµ·ï¼Œä»¥å‡å°‘éƒ¨ç½²èŠ‚ç‚¹å’Œæˆæœ¬ã€‚æ­¤æ—¶ï¼Œç”¨äºç®€åŒ–å¢åˆ æ”¹æŸ¥å·¥ä½œé‡çš„æ•°æ®è®¿é—®æ¡†æ¶ï¼ˆORMï¼‰æ˜¯å…³é”®ï¼› å½“è®¿é—®é‡é€æ¸å¢å¤§ï¼Œå•ä¸€åº”ç”¨å¢åŠ æœºå™¨å¸¦æ¥çš„åŠ é€Ÿåº¦è¶Šæ¥è¶Šå°ï¼Œå°†åº”ç”¨æ‹†æˆäº’ä¸ç›¸å¹²çš„å‡ ä¸ªåº”ç”¨ï¼Œä»¥æå‡æ•ˆç‡ã€‚æ­¤æ—¶ï¼Œç”¨äºåŠ é€Ÿå‰ç«¯é¡µé¢å¼€å‘çš„ Web æ¡†æ¶ï¼ˆMVCï¼‰æ˜¯å…³é”®ï¼› å½“å‚ç›´åº”ç”¨è¶Šæ¥è¶Šå¤šï¼Œåº”ç”¨ä¹‹é—´äº¤äº’ä¸å¯é¿å…ï¼Œå°†æ ¸å¿ƒä¸šåŠ¡æŠ½å–å‡ºæ¥ï¼Œä½œä¸ºç‹¬ç«‹çš„æœåŠ¡ï¼Œé€æ¸å½¢æˆç¨³å®šçš„æœåŠ¡ä¸­å¿ƒï¼Œä½¿å‰ç«¯åº”ç”¨èƒ½æ›´å¿«é€Ÿçš„å“åº”å¤šå˜çš„å¸‚åœºéœ€æ±‚ã€‚æ­¤æ—¶ï¼Œç”¨äºæé«˜ä¸šåŠ¡å¤ç”¨åŠæ•´åˆçš„åˆ†å¸ƒå¼æœåŠ¡æ¡†æ¶ï¼ˆRPCï¼‰æ˜¯å…³é”®ï¼› Dubbo æ˜¯ä¸€æ¬¾é«˜æ€§èƒ½ã€è½»é‡çº§çš„å¼€æº Java RPC æ¡†æ¶ï¼Œå®ƒæä¾›äº†ä¸‰å¤§æ ¸å¿ƒèƒ½åŠ›ï¼šé¢å‘æ¥å£çš„è¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼Œæ™ºèƒ½å®¹é”™å’Œè´Ÿè½½å‡è¡¡ï¼Œä»¥åŠæœåŠ¡è‡ªåŠ¨æ³¨å†Œå’Œå‘ç°ã€‚ å½“æœåŠ¡è¶Šæ¥è¶Šå¤šï¼Œå®¹é‡çš„è¯„ä¼°ï¼Œå°æœåŠ¡èµ„æºçš„æµªè´¹ç­‰é—®é¢˜é€æ¸æ˜¾ç°ï¼Œæ­¤æ—¶éœ€å¢åŠ ä¸€ä¸ªè°ƒåº¦ä¸­å¿ƒåŸºäºè®¿é—®å‹åŠ›å®æ—¶ç®¡ç†é›†ç¾¤å®¹é‡ï¼Œæé«˜é›†ç¾¤åˆ©ç”¨ç‡ã€‚æ­¤æ—¶ï¼Œç”¨äºæé«˜æœºå™¨åˆ©ç”¨ç‡çš„èµ„æºè°ƒåº¦å’Œæ²»ç†ä¸­å¿ƒï¼ˆSOAï¼‰å³ Service Oriented Architecture æ˜¯å…³é”®ã€‚ ç¯å¢ƒæ­å»ºJavayum search java-1.8 ï¼ï¼ï¼æ³¨æ„ï¼Œéœ€è¦ä¸‹è½½ä¸¤ä¸ª java-1.8.0-openjdk.x86_64 / java-1.8.0-openjdk-devel.x86_64 yum install ... whereis javaæŸ¥çœ‹ java è·¯å¾„ï¼ˆ/usr/lib/jvm/ï¼‰ ä¿®æ”¹ç¯å¢ƒå˜é‡ï¼švim /etc/profile 123export JAVA_HOME&#x3D;&#x2F;usr&#x2F;lib&#x2F;jvm&#x2F;java-1.8.0-openjdk-...export PATH&#x3D;$JAVA_HOME&#x2F;bin:$PATHexport CLASSPATH&#x3D;.:$JAVA_HOME&#x2F;lib&#x2F;dt.jar:$JAVA_HOME&#x2F;lib&#x2F;tools.jar javacç¯å¢ƒå˜é‡æ˜¯å¦é…ç½®æ­£ç¡® Zookeeperä¸‹è½½ zookeeper ï¼šæ¸…åå¤§å­¦å¼€æºè½¯ä»¶é•œåƒç«™ wget [ä¸‹è½½è¿æ¥]ä¸‹è½½å‹ç¼©åŒ… tar -zxvf zookeeper-x.x.x.tar.gz åœ¨ /usr/local/ ä¸‹æ–°å»º zookeeper ç›®å½•è¿›è¡Œè§£å‹ ä¿®æ”¹ zookeeper é…ç½®æ–‡ä»¶åï¼šzoo_sample.cfg æ”¹ä¸º zoo.cfg é…ç½®ç¯å¢ƒå˜é‡ï¼švi ~/.bash_profile 123export PATHexport ZOOKEEPER_HOME&#x3D;&#x2F;usr&#x2F;local&#x2F;zookeeper&#x2F;zookeeper-3.4.11&#x2F;export PATH&#x3D;$ZOOKEEPER_HOME&#x2F;bin:$PATH å¸¸ç”¨æ“ä½œ 123zkServer.sh start # å¼€å¯ zookeeperjps # æ˜¾ç¤ºå½“å‰æ‰€æœ‰ java è¿›ç¨‹ pidzkServer.sh stop # åœæ­¢ zookeeper dubbo-admin netstat -aon|findstr â€œport-numâ€ æŸ¥çœ‹å ç”¨ç«¯å£çš„ç¨‹åºçš„ PID Dubbo å®˜æ–¹é¡¹ç›®ä¸‹è½½ ä¿®æ”¹ dubbo-admin é¡¹ç›®çš„é…ç½®ï¼ˆï¼ï¼ï¼zookeeper çš„åœ°å€ä¿®æ”¹ä¸ºè‡ªå·±é…ç½®çš„åœ°å€ï¼‰ åœ¨ pom.xml ç›®å½•ä¸‹ï¼šcmd è¾“å…¥å‘½ä»¤mvn clean packageå¯¹é¡¹ç›®è¿›è¡Œæ‰“åŒ… æ‰“åŒ…æˆåŠŸåç”Ÿæˆ target æ–‡ä»¶å¤¹ï¼Œtarget ç›®å½•ä¸‹æœ‰ä¸€ä¸ªå¯æ‰§è¡Œ jar åŒ… java -jar [jara_name]è¿è¡Œé¡¹ç›®ï¼Œè¿è¡ŒæˆåŠŸåæ ¹æ®é…ç½®çš„è·¯å¾„è¿›è¡Œè®¿é—® dubbo-monitorç”Ÿæˆçš„ target æ–‡ä»¶ä¸­æœ‰ä¸€ä¸ªå‹ç¼©åŒ…ï¼Œè§£å‹åçš„ assembly.bin ç›®å½•ä¸­è¿è¡Œ start.bat è„šæœ¬è¿›è¡Œé¡¹ç›®è¿è¡Œ é¡¹ç›®æ¶æ„å…ˆæ¥çœ‹ä¸€å¼ å®˜ç½‘ç»™çš„æ¶æ„å›¾ï¼š èŠ‚ç‚¹ è§’è‰²è¯´æ˜ Provider æš´éœ²æœåŠ¡çš„æœåŠ¡æä¾›æ–¹ Consumer è°ƒç”¨è¿œç¨‹æœåŠ¡çš„æœåŠ¡æ¶ˆè´¹æ–¹ Registry æœåŠ¡æ³¨å†Œä¸å‘ç°çš„æ³¨å†Œä¸­å¿ƒ Monitor ç»Ÿè®¡æœåŠ¡çš„è°ƒç”¨æ¬¡æ•°å’Œè°ƒç”¨æ—¶é—´çš„ç›‘æ§ä¸­å¿ƒ Container æœåŠ¡è¿è¡Œå®¹å™¨ å„èŠ‚ç‚¹é—´çš„è°ƒç”¨å…³ç³»è¯´æ˜ï¼š â€‹ æœåŠ¡å®¹å™¨è´Ÿè´£å¯åŠ¨ï¼ŒåŠ è½½ï¼Œè¿è¡ŒæœåŠ¡æä¾›è€…ã€‚â€‹ æœåŠ¡æä¾›è€…åœ¨å¯åŠ¨æ—¶ï¼Œå‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±æä¾›çš„æœåŠ¡ã€‚â€‹ æœåŠ¡æ¶ˆè´¹è€…åœ¨å¯åŠ¨æ—¶ï¼Œå‘æ³¨å†Œä¸­å¿ƒè®¢é˜…è‡ªå·±æ‰€éœ€çš„æœåŠ¡ã€‚â€‹ æ³¨å†Œä¸­å¿ƒè¿”å›æœåŠ¡æä¾›è€…åœ°å€åˆ—è¡¨ç»™æ¶ˆè´¹è€…ï¼Œå¦‚æœæœ‰å˜æ›´ï¼Œæ³¨å†Œä¸­å¿ƒå°†åŸºäºé•¿è¿æ¥æ¨é€å˜æ›´æ•°æ®ç»™æ¶ˆè´¹è€…ã€‚â€‹ æœåŠ¡æ¶ˆè´¹è€…ï¼Œä»æä¾›è€…åœ°å€åˆ—è¡¨ä¸­ï¼ŒåŸºäºè½¯è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œé€‰ä¸€å°æä¾›è€…è¿›è¡Œè°ƒç”¨ï¼Œå¦‚æœè°ƒç”¨å¤±è´¥ï¼Œå†é€‰å¦ä¸€å°è°ƒç”¨ã€‚â€‹ æœåŠ¡æ¶ˆè´¹è€…å’Œæä¾›è€…ï¼Œåœ¨å†…å­˜ä¸­ç´¯è®¡è°ƒç”¨æ¬¡æ•°å’Œè°ƒç”¨æ—¶é—´ï¼Œå®šæ—¶æ¯åˆ†é’Ÿå‘é€ä¸€æ¬¡ç»Ÿè®¡æ•°æ®åˆ°ç›‘æ§ä¸­å¿ƒã€‚ é¡¹ç›®åˆ›å»ºåŸºäºå¯¹å®˜ç½‘ç»™å‡ºçš„æ¶æ„åˆ†æå¾—çŸ¥æˆ‘ä»¬éœ€è¦ä¸¤ä¸ªè§’è‰²ï¼šæœåŠ¡çš„æä¾›è€…ï¼›æœåŠ¡çš„æ¶ˆè´¹è€…ã€‚ æ¶ˆè´¹è€…åœ¨è‡ªèº«çš„é¡¹ç›®ä¸­å¯ä»¥å¦‚åŒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€èˆ¬è°ƒç”¨æä¾›è€…çš„æ–¹æ³•ï¼›é‚£ä¹ˆæ¶ˆè´¹è€…å’Œæä¾›è€…å¿…é¡»éƒ½å—åˆ°åŒä¸€å¥—æ¥å£çš„è§„èŒƒï¼Œåœ¨ä¸¤ä¸ªé¡¹ç›®ä¸­éƒ½ç¼–å†™æ¥å£æ˜¾å¾—æœ‰äº›ç¹çï¼Œæ‰€ä»¥å¯ä»¥æ–°å»ºä¸€ä¸ª Maven é¡¹ç›®ä¸“é—¨ç”¨äºå®šä¹‰æ¥å£ã€‚ æœ€å¤–å±‚å¥—ä¸€å±‚å£³ï¼Œæ·»åŠ ä¸‰ä¸ª moduleï¼Œå…¶ä¸­å¤–å£³é¡¹ç›®å’Œæä¾›æ¥å£çš„é¡¹ç›®ä¸º Maven é¡¹ç›®å³å¯ã€‚ dubbo-api æ­¤é¡¹ç›®ç”¨äºæä¾›æ¥å£è§„èŒƒï¼Œä¸éœ€è¦æ·»åŠ ä»»ä½•ä¾èµ–ã€‚ç¼–å†™ä¸€ä¸ªå®ä½“ç±»å’Œä¸€ä¸ªæœåŠ¡ç±»æ¥å£å³å¯ã€‚ 1234567891011public class User implements Serializable &#123; private static final long serialVersionUID = 5433406871746033298L; private Integer userId; private String username; private String password; // ...&#125; å®šä¹‰æ¥å£ã€‚ 123456789public interface UserService &#123; /** * è·å–ç”¨æˆ·åˆ—è¡¨çš„æ–¹æ³• * * @return ç”¨æˆ·çš„ä¿¡æ¯åˆ—è¡¨ */ List&lt;User&gt; getUserList();&#125; è¦è®© dubbo-consumer ä»¥åŠ dubbo-provider è·å–æ­¤æ¥å£ï¼Œéœ€è¦ç»™è¿™ä¸¤ä¸ªé¡¹ç›®æ·»åŠ  dubbo-api é¡¹ç›®çš„ä¾èµ–ã€‚ 123456&lt;!-- æ·»åŠ è‡ªå®šä¹‰æ¥å£ä¾èµ– --&gt;&lt;dependency&gt; &lt;groupId&gt;com.wingo&lt;/groupId&gt; &lt;artifactId&gt;dubbo-api&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;&lt;/dependency&gt; dubbo-provider æœåŠ¡æä¾›è€…ç¼–å†™äº†æ¥å£çš„å…·ä½“å®ç°æ–¹æ³•ï¼Œå¹¶ä¸”è¦æŠŠå®ç°çš„æ–¹æ³•é€šè¿‡ Dubbo æš´éœ²å‡ºå»ã€‚ 123456&lt;!-- æ·»åŠ  Dubbo ä¾èµ– --&gt;&lt;dependency&gt; &lt;groupId&gt;com.alibaba.boot&lt;/groupId&gt; &lt;artifactId&gt;dubbo-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;0.2.0&lt;/version&gt;&lt;/dependency&gt; Spring ä»¥åŠ Dubbo éƒ½è¦ç®¡ç†è¿™ä¸ªç±»ã€‚ 12345678910@com.alibaba.dubbo.config.annotation.Service@Servicepublic class UserServiceImpl implements UserService &#123; @Override public List&lt;User&gt; getUserList() &#123; User user1 = new User(1,\"wingo\",\"123456\"); User user2 = new User(2,\"admin\",\"654321\"); return Arrays.asList(user1, user2); &#125;&#125; åœ¨ä¸»ç±»ä¸Šæ ‡æ³¨ @EnableDubbo(scanBasePackages = â€œcom.wingo.dubboprovider.serviceâ€)ï¼Œå¹¶æ·»åŠ é…ç½®ã€‚ 12345678910# æ­¤æœåŠ¡çš„åç§°dubbo.application.name=user-service-provider# æ³¨å†Œä¸­å¿ƒçš„åè®®åŠåœ°å€dubbo.registry.address=127.0.0.1:2181dubbo.registry.protocol=zookeeper# æš´éœ²çš„åè®®åŠç«¯å£dubbo.protocol.name=dubbodubbo.protocol.port=20881## æ³¨å†Œä¸­å¿ƒè·å–ç›‘æ§ä¸­å¿ƒçš„ä¿¡æ¯dubbo.monitor.protocol=registry å¯åŠ¨é¡¹ç›®ï¼Œæ¥åˆ° dubbo-admin çš„é¡µé¢æŸ¥çœ‹æœåŠ¡ã€‚ åœ¨ dubbo-admin å¤šäº†ä¸€ä¸ªæˆ‘ä»¬åˆšåˆšæš´éœ²å‡ºæ¥çš„æœåŠ¡ï¼Œç”±åç§°å¯ä»¥å¾—çŸ¥å…¶æš´éœ²çš„æ˜¯ä¸€ä¸ªæ¥å£ã€‚ ç‚¹å‡»æŸ¥çœ‹å…¶å¯¹åº”çš„ IP åœ°å€ä»¥åŠåŸŸåï¼Œæ­£æ˜¯æœ¬æœºçš„ IP ä»¥åŠè‡ªå®šä¹‰çš„æ¥å£ 20881 dubbo-monitor ä¸­å¯ä»¥çœ‹åˆ°è¿™ä¸ªåº”ç”¨çš„åç§°æ­£æ˜¯é…ç½®æ–‡ä»¶ä¸­çš„ user-service-provider dubbo-consumer æ¶ˆè´¹è€…å‘ dubbo è¯·æ±‚æ‰€éœ€è¦çš„æœåŠ¡ã€‚ 1234567891011@RestControllerpublic class UserController &#123; @Reference UserService userService; @GetMapping(\"/users\") public List&lt;User&gt; userList ()&#123; return userService.getUserList(); &#125;&#125; 12345server.port=8082dubbo.application.name=dubbo-user-consumerdubbo.registry.address=zookeeper://127.0.0.1:2181dubbo.monitor.protocol=registry å¯åŠ¨æ¶ˆè´¹è€…ã€‚ å¯ä»¥çœ‹å‡ºï¼Œæä¾›è€…ä¸æ¶ˆè´¹è€…ç¡®å®æ˜¯é€šè¿‡æ¥å£é€šè®¯çš„ã€‚ æˆåŠŸè¯·æ±‚æ•°æ®ã€‚ Dubbo ç‰¹æ€§ ä»‹ç»ä¸€äº› Dubbo çš„ä½¿ç”¨ç‰¹æ€§ã€‚ é«˜å¯ç”¨Zookeeper å®•æœºä¸ Dubbo ç›´è¿ï¼šæ³¨å†Œä¸­å¿ƒå…¨éƒ¨å®•æ‰åï¼ŒæœåŠ¡æä¾›è€…å’ŒæœåŠ¡æ¶ˆè´¹è€…ä»èƒ½é€šè¿‡æœ¬åœ°ç¼“å­˜é€šè®¯ã€‚ é›†ç¾¤è´Ÿè½½å‡è¡¡Random LoadBalanceï¼š éšæœºï¼ŒæŒ‰æƒé‡è®¾ç½®éšæœºæ¦‚ç‡ã€‚åœ¨ä¸€ä¸ªæˆªé¢ä¸Šç¢°æ’çš„æ¦‚ç‡é«˜ï¼Œä½†è°ƒç”¨é‡è¶Šå¤§åˆ†å¸ƒè¶Šå‡åŒ€ï¼Œè€Œä¸”æŒ‰æ¦‚ç‡ä½¿ç”¨æƒé‡åä¹Ÿæ¯”è¾ƒå‡åŒ€ï¼Œæœ‰åˆ©äºåŠ¨æ€è°ƒæ•´æä¾›è€…æƒé‡ã€‚ RoundRobin LoadBalanceï¼š è½®å¾ªï¼ŒæŒ‰å…¬çº¦åçš„æƒé‡è®¾ç½®è½®å¾ªæ¯”ç‡ã€‚å­˜åœ¨æ…¢çš„æä¾›è€…ç´¯ç§¯è¯·æ±‚çš„é—®é¢˜ï¼Œæ¯”å¦‚ï¼šç¬¬äºŒå°æœºå™¨å¾ˆæ…¢ï¼Œä½†æ²¡æŒ‚ï¼Œå½“è¯·æ±‚è°ƒåˆ°ç¬¬äºŒå°æ—¶å°±å¡åœ¨é‚£ï¼Œä¹…è€Œä¹…ä¹‹ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½å¡åœ¨è°ƒåˆ°ç¬¬äºŒå°ä¸Šã€‚ LeastActive LoadBalanceï¼š æœ€å°‘æ´»è·ƒè°ƒç”¨æ•°ï¼Œç›¸åŒæ´»è·ƒæ•°çš„éšæœºï¼Œæ´»è·ƒæ•°æŒ‡è°ƒç”¨å‰åè®¡æ•°å·®ã€‚ä½¿æ…¢çš„æä¾›è€…æ”¶åˆ°æ›´å°‘è¯·æ±‚ï¼Œå› ä¸ºè¶Šæ…¢çš„æä¾›è€…çš„è°ƒç”¨å‰åè®¡æ•°å·®ä¼šè¶Šå¤§ã€‚ ConsistentHash LoadBalanceï¼š ä¸€è‡´æ€§ Hashï¼Œç›¸åŒå‚æ•°çš„è¯·æ±‚æ€»æ˜¯å‘åˆ°åŒä¸€æä¾›è€…ã€‚å½“æŸä¸€å°æä¾›è€…æŒ‚æ—¶ï¼ŒåŸæœ¬å‘å¾€è¯¥æä¾›è€…çš„è¯·æ±‚ï¼ŒåŸºäºè™šæ‹ŸèŠ‚ç‚¹ï¼Œå¹³æ‘Šåˆ°å…¶å®ƒæä¾›è€…ï¼Œä¸ä¼šå¼•èµ·å‰§çƒˆå˜åŠ¨ã€‚ æœåŠ¡é™çº§ å½“æœåŠ¡å™¨å‹åŠ›å‰§å¢çš„æƒ…å†µä¸‹ï¼Œæ ¹æ®å®é™…ä¸šåŠ¡æƒ…å†µåŠæµé‡ï¼Œå¯¹ä¸€äº›æœåŠ¡å’Œé¡µé¢æœ‰ç­–ç•¥çš„ä¸å¤„ç†æˆ–æ¢ç§ç®€å•çš„æ–¹å¼å¤„ç†ï¼Œä»è€Œé‡Šæ”¾æœåŠ¡å™¨èµ„æºä»¥ä¿è¯æ ¸å¿ƒäº¤æ˜“æ­£å¸¸è¿ä½œæˆ–é«˜æ•ˆè¿ä½œã€‚ mock=force:return+null è¡¨ç¤ºæ¶ˆè´¹æ–¹å¯¹è¯¥æœåŠ¡çš„æ–¹æ³•è°ƒç”¨éƒ½ç›´æ¥è¿”å› null å€¼ï¼Œä¸å‘èµ·è¿œç¨‹è°ƒç”¨ã€‚ç”¨æ¥å±è”½ä¸é‡è¦æœåŠ¡ä¸å¯ç”¨æ—¶å¯¹è°ƒç”¨æ–¹çš„å½±å“ã€‚ mock=fail:return+null è¡¨ç¤ºæ¶ˆè´¹æ–¹å¯¹è¯¥æœåŠ¡çš„æ–¹æ³•è°ƒç”¨åœ¨å¤±è´¥åï¼Œå†è¿”å› null å€¼ï¼Œä¸æŠ›å¼‚å¸¸ã€‚ç”¨æ¥å®¹å¿ä¸é‡è¦æœåŠ¡ä¸ç¨³å®šæ—¶å¯¹è°ƒç”¨æ–¹çš„å½±å“ã€‚ é›†ç¾¤å®¹é”™Failfast Clusterï¼šå¿«é€Ÿå¤±è´¥ï¼Œåªå‘èµ·ä¸€æ¬¡è°ƒç”¨ï¼Œå¤±è´¥ç«‹å³æŠ¥é”™ã€‚é€šå¸¸ç”¨äºéå¹‚ç­‰æ€§çš„å†™æ“ä½œï¼Œæ¯”å¦‚æ–°å¢è®°å½•ï¼› Failsafe Clusterï¼šå¤±è´¥å®‰å…¨ï¼Œå‡ºç°å¼‚å¸¸æ—¶ï¼Œç›´æ¥å¿½ç•¥ã€‚é€šå¸¸ç”¨äºå†™å…¥å®¡è®¡æ—¥å¿—ç­‰æ“ä½œï¼› Failback Clusterï¼šå¤±è´¥è‡ªåŠ¨æ¢å¤ï¼Œåå°è®°å½•å¤±è´¥è¯·æ±‚ï¼Œå®šæ—¶é‡å‘ã€‚é€šå¸¸ç”¨äºæ¶ˆæ¯é€šçŸ¥æ“ä½œï¼› Forking Clusterï¼šå¹¶è¡Œè°ƒç”¨å¤šä¸ªæœåŠ¡å™¨ï¼Œåªè¦ä¸€ä¸ªæˆåŠŸå³è¿”å›ã€‚é€šå¸¸ç”¨äºå®æ—¶æ€§è¦æ±‚è¾ƒé«˜çš„è¯»æ“ä½œï¼Œä½†éœ€è¦æµªè´¹æ›´å¤šæœåŠ¡èµ„æºã€‚å¯é€šè¿‡ forks=â€2â€ æ¥è®¾ç½®æœ€å¤§å¹¶è¡Œæ•°ï¼› Broadcast Clusterï¼šå¹¿æ’­è°ƒç”¨æ‰€æœ‰æä¾›è€…ï¼Œé€ä¸ªè°ƒç”¨ï¼Œä»»æ„ä¸€å°æŠ¥é”™åˆ™æŠ¥é”™ [2]ã€‚é€šå¸¸ç”¨äºé€šçŸ¥æ‰€æœ‰æä¾›è€…æ›´æ–°ç¼“å­˜æˆ–æ—¥å¿—ç­‰æœ¬åœ°èµ„æºä¿¡æ¯ã€‚","categories":[{"name":"Distributed","slug":"Distributed","permalink":"http://yoursite.com/categories/Distributed/"}],"tags":[{"name":"Dubbo","slug":"Dubbo","permalink":"http://yoursite.com/tags/Dubbo/"}]},{"title":"Redis ç‚¹èµ","slug":"Demo/Redis ç‚¹èµ","date":"2020-04-09T06:29:14.000Z","updated":"2020-04-21T09:11:57.774Z","comments":true,"path":"2020/04/09/Demo/Redis ç‚¹èµ/","link":"","permalink":"http://yoursite.com/2020/04/09/Demo/Redis%20%E7%82%B9%E8%B5%9E/","excerpt":"Redis å®ç°ç‚¹èµåŠŸèƒ½ã€‚","text":"Redis å®ç°ç‚¹èµåŠŸèƒ½ã€‚ ç¯å¢ƒæ­å»º12345678910111213141516171819202122232425262728293031323334353637383940&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;&lt;/dependency&gt;&lt;!-- Redis --&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt;&lt;/dependency&gt;&lt;!-- Jackson --&gt;&lt;dependency&gt; &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt; &lt;artifactId&gt;jackson-core&lt;/artifactId&gt; &lt;version&gt;2.9.8&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt; &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt; &lt;version&gt;2.9.8&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt; &lt;artifactId&gt;jackson-annotations&lt;/artifactId&gt; &lt;version&gt;2.9.8&lt;/version&gt;&lt;/dependency&gt;&lt;!-- spring-jsonä¾èµ– --&gt; Redis é…ç½®123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354package com.wingo.springbootredis01.config;import com.fasterxml.jackson.annotation.JsonAutoDetect;import com.fasterxml.jackson.annotation.PropertyAccessor;import com.fasterxml.jackson.databind.ObjectMapper;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;import org.springframework.data.redis.connection.RedisConnectionFactory;import org.springframework.data.redis.core.RedisTemplate;import org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;import org.springframework.data.redis.serializer.StringRedisSerializer;/** * @Author Wingo * @Date 2020-04-11 12:13 * @Description */@Configurationpublic class RedisConfig &#123; @Bean public StringRedisSerializer stringRedisSerializer() &#123; return new StringRedisSerializer(); &#125; @Bean public ObjectMapper objectMapper() &#123; ObjectMapper objectMapper = new ObjectMapper(); // æ”¯æŒä»»æ„å¯¹è±¡çš„ json åºåˆ—åŒ–å’Œååºåˆ—åŒ– objectMapper.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY); objectMapper.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL); return objectMapper; &#125; @Bean public Jackson2JsonRedisSerializer jackson2JsonRedisSerializer() &#123; Jackson2JsonRedisSerializer jackson2JsonRedisSerializer = new Jackson2JsonRedisSerializer&lt;&gt;(Object.class); jackson2JsonRedisSerializer.setObjectMapper(objectMapper()); return jackson2JsonRedisSerializer; &#125; @Bean public RedisTemplate redisTemplate(@Autowired RedisConnectionFactory redisConnectionFactory)&#123; RedisTemplate&lt;String,Object&gt; redisTemplate= new RedisTemplate&lt;&gt;(); redisTemplate.setConnectionFactory(redisConnectionFactory); // è®¾ç½®äº†é»˜è®¤çš„åºåˆ—åŒ–å™¨ redisTemplate.setDefaultSerializer(jackson2JsonRedisSerializer()); // å¼€å¯äº‹åŠ¡æ”¯æŒ redisTemplate.setEnableTransactionSupport(true); return redisTemplate; &#125;&#125; properties123456789101112131415161718# Redisæ•°æ®åº“ç´¢å¼•(é»˜è®¤ä¸ºÎ¸)spring.redis.database=0# RedisæœåŠ¡å™¨åœ°å€spring.redis.host=192.168.31.100# RedisæœåŠ¡å™¨è¿æ¥ç«¯å£spring.redis.port=6379# RedisæœåŠ¡å™¨è¿æ¥å¯†ç (é»˜è®¤ä¸ºç©º)spring.redis.password=# è¿æ¥æ± æœ€å¤§è¿æ¥æ•°(ä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶)spring.redis.jedis.pool.max-active=10# è¿æ¥æ± æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´(ä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶)spring.redis.jedis.pool.max-wait=-1# è¿æ¥æ± ä¸­çš„æœ€å¤§ç©ºé—²è¿æ¥spring.redis.jedis.pool.max-idle=5# è¿æ¥æ± ä¸­çš„æœ€å°ç©ºé—²è¿æ¥spring.redis.jedis.pool.min-idle=0# è¿æ¥è¶…æ—¶æ—¶é—´(æ¯«ç§’)spring.redis.timeout=1000 å•å…ƒæµ‹è¯•123456789101112131415@RunWith(SpringRunner.class)@Slf4j@SpringBootTestclass SpringBootRedis01ApplicationTests &#123; @Autowired private RedisTemplate redisTemplate; @Test void simpleAdd() &#123; redisTemplate.opsForValue().set(\"test01\",\"è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•01\"); log.info(redisTemplate.opsForValue().get(\"test01\").toString()); &#125;&#125; Redis å®¢æˆ·ç«¯å­˜å‚¨æ­£å¸¸ï¼Œæ§åˆ¶å°æ­£å¸¸è¾“å‡ºï¼Œé¡¹ç›®ç¯å¢ƒæ­å»ºå®Œæˆã€‚ ç‚¹èµç±»å‹æšä¸¾ç±» LIKED ARTICLE æ–‡ç« ç‚¹èµï¼›LIKED â…¥DEO è§†é¢‘ç‚¹èµï¼› ä»£ç å®ç° 12345678910111213141516171819public enum MyType &#123; /** LIKED_ARTICLE */ LIKED_ARTICLE (\"æ–‡ç« ç‚¹èµ\"), /** LIKED_VIDEO */ LIKED_VIDEO (\"è§†é¢‘ç‚¹èµ\"), /** LIKED_VIDEO */ UNKONW_TYPE (\"æœªçŸ¥ç±»å‹\"); private String myType; /** * æ„é€ å™¨ç±» * @param myType */ MyType(String myType) &#123; this.myType = myType; &#125;&#125; ç‚¹èµå·¥å…·ç±»1234567891011121314151617181920public class LikedUtil &#123; /** ç”Ÿæˆ Key */ public static String getKey(MyType myType, String subjectId) &#123; return myType + \":\" + subjectId; &#125; public static String getReportKey(MyType myType) &#123; MyType type; switch (myType) &#123; case LIKED_ARTICLE: type = MyType.LIKED_ARTICLE; break; case LIKED_VIDEO: type = MyType.LIKED_VIDEO; break; default: type = MyType.UNKONW_TYPE; &#125; return type + \"\"; &#125;&#125; å•å…ƒæµ‹è¯•123456@Testvoid keyTest()&#123; MyType type = MyType.LIKED_ARTICLE; String result = LikedUtil.getKey(type, â€œ1â€); log.info(result);&#125; è‡ªå®šä¹‰çš„ Key æ ¼å¼ï¼šç±»å‹ + ç±»å‹å®ä½“çš„ id ç®€å•å®ç°è¯¥æ–¹æ¡ˆ Redis æ•°æ®åº“åªå­˜å‚¨ç‚¹èµä¸»ä½“å’Œè¢«ç‚¹èµä¸»ä½“çš„IDä¿¡æ¯ï¼Œæ•°æ®ç±»å‹é‡‡ç”¨ Hash ç±»å‹ã€‚ key ï¼šLIKED_TYPE + subject_idï¼Œå³ä½¿ç”¨æ–‡ç« çš„ id ä½œä¸º key ã€‚field ï¼š post_id ç‚¹èµäººçš„id ï¼› value å›ºå®šå€¼ 1 ï¼šè¡¨ç¤ºä¸€ä¸ªç‚¹èµä¸»ä½“å¯¹è¢«ç‚¹èµä¸»ä½“ç‚¹äº†ä¸€æ¬¡èµã€‚ è‡ªå®šä¹‰æ¥å£1234567891011121314151617181920212223242526/** * @Author Wingo * @Date 2020-04-11 14:41 * @Description */public interface LikedSimpleService &#123; /** * ç‚¹èµ / å–æ¶ˆç‚¹èµåŠŸèƒ½ * * @param myType ç‚¹èµçš„ç±»å‹ * @param subjectId è¢«ç‚¹èµçš„ä¸»ä½“çš„ id * @param postId ç‚¹èµä¸»ä½“çš„ id */ void liked(MyType myType, String subjectId, String postId); /** * å¾—åˆ°ä¸»ä½“çš„æ€»ç‚¹èµæ•° * * @param myType ç‚¹èµçš„ç±»å‹ * @param subjectId è¢«ç‚¹èµçš„ä¸»ä½“çš„ id * @return æ€»ç‚¹èµæ•° */ Long count(MyType myType, String subjectId);&#125; æ¥å£å®ç°12345678910111213141516171819202122232425262728293031/** * @Author Wingo * @Date 2020-04-11 15:09 * @Description */@Servicepublic class LikedSimpleServiceImpl implements LikedSimpleService &#123; @Autowired private StringRedisTemplate redisTemplate; @Override public void liked(MyType myType, String subjectId, String postId) &#123; String key = LikedUtil.getKey(myType, subjectId); // åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å·²ç»ç‚¹èµï¼Œå¦‚æœç‚¹è¿‡èµï¼Œå–æ¶ˆç‚¹èµï¼Œå¦‚æœæ²¡æœ‰ç‚¹è¿‡ç‚¹èµ Boolean liked = redisTemplate.opsForHash().hasKey(key, postId); if (Boolean.TRUE.equals(liked)) &#123; // å–æ¶ˆç‚¹èµ redisTemplate.opsForHash().delete(key, postId); &#125; else &#123; // ç‚¹èµ redisTemplate.opsForHash().put(key, postId, \"1\"); &#125; &#125; @Override public Long count(MyType myType, String subjectId) &#123; String key = LikedUtil.getKey(myType, subjectId); return redisTemplate.opsForHash().size(key); &#125;&#125; å•å…ƒæµ‹è¯•12345678910111213141516171819202122232425262728293031@RunWith(SpringRunner.class)@Slf4j@SpringBootTestclass SpringBootRedis01ApplicationTests &#123; @Autowired private LikedSimpleService likedSimpleService; @Autowired private RedisTemplate redisTemplate; @Test void keyTest()&#123; MyType myType = MyType.LIKED_ARTICLE; for (int j = 1; j &lt;= 100; j++) &#123; for (int i = 1; i &lt;= j; i++) &#123; likedSimpleService.liked(myType, j+\"\", i+\"\"); &#125; &#125; &#125; @Test void countTest()&#123; MyType myType = MyType.LIKED_ARTICLE; int num = 0; while(num &lt;= 10)&#123; int subjectId = new Random().nextInt(100) + 1; long count = likedSimpleService.count(myType, Integer.toString(subjectId)); log.info(\"ID ä¸º\" + subjectId + \"çš„æ–‡ç« ç‚¹èµæ•°ä¸º\" + count); num++; &#125;&#125; åˆå§‹åŒ– 100 ç¯‡æ–‡ç« çš„ç‚¹èµä¿¡æ¯ï¼Œå¹¶ä¸” id = num çš„æ–‡ç« å…¶ç‚¹èµæ•°ä¸º num å¤æ‚å®ç° å‰é¢çš„ç®€å•å®ç°åªç¼“å­˜äº† ID çš„æ•°æ®ï¼Œè€Œå®é™…çš„åº”ç”¨åœºæ™¯ä¸­å¸¸å¸¸è¿˜éœ€è¦æ›´å¤šçš„ä¿¡æ¯ï¼Œæ¯”å¦‚æ–‡ç« æ ‡é¢˜ã€æ–‡ç« å†…å®¹ç®€ä»‹ã€ç”¨æˆ·æ˜µç§°ã€ç”¨æˆ·å¤´åƒã€ç‚¹èµæ’è¡Œç­‰ä¿¡æ¯ã€‚æ ¹æ®éœ€æ±‚ç»§ç»­å®Œå–„é¡¹ç›®ã€‚ æ–¹æ¡ˆè®¾è®¡ ç‚¹èµæ•°é‡ç»Ÿè®¡ï¼šHash key ï¼šLIKED_TYPE + subject_idã€‚ field ï¼š post_idï¼› value { json } ç‚¹èµçš„äººçš„ä¿¡æ¯ã€‚ ç‚¹èµæ’åç»Ÿè®¡ï¼š zSet key ï¼šLIKED_TYPE_TOPã€‚ field ï¼š value { json } è¢«ç‚¹èµä¸»ä½“çš„å†…å®¹ï¼› score è®°å½•è¢«ç‚¹èµä¸»ä½“çš„æ€»èµæ•°ã€‚ ç±»å‹æ·»åŠ 123456789101112131415161718192021222324252627public enum MyType &#123; /** LIKED_ARTICLE */ LIKED_ARTICLE (\"æ–‡ç« ç‚¹èµ\"), /** LIKED_VIDEO */ LIKED_VIDEO (\"è§†é¢‘ç‚¹èµ\"), /** LIKED_ARTICLE_TOP */ LIKED_ARTICLE_TOP (\"æ–‡ç« ç‚¹èµæ’è¡Œ\"), /** LIKED_VIDEO_TOP */ LIKED_VIDEO_TOP (\"è§†é¢‘ç‚¹èµæ’è¡Œ\"), /** LIKED_VIDEO */ UNKONW_TYPE (\"æœªçŸ¥ç±»å‹\"); private String myType; /** * æ„é€ å™¨ç±» * @param myType */ MyType(String myType) &#123; this.myType = myType; &#125; public String getMyType()&#123; return this.myType; &#125;&#125; 1234567891011121314151617181920212223242526public class LikedUtil &#123; LikedUtil()&#123; throw new IllegalStateException(\"Utility class\"); &#125; /** ç”Ÿæˆ Key */ public static String getKey(MyType myType, String subjectId) &#123; return myType + \":\" + subjectId; &#125; /** ç”Ÿæˆæ’è¡Œæ¦œ Key */ public static String getTopKey(MyType myType) &#123; MyType type; switch (myType) &#123; case LIKED_ARTICLE: type = MyType.LIKED_ARTICLE_TOP; break; case LIKED_VIDEO: type = MyType.LIKED_VIDEO_TOP; break; default: type = MyType.UNKONW_TYPE; &#125; return type.toString(); &#125;&#125; 12345678@Datapublic class Article &#123; private Integer articleId; private String title; private String summary; private String img;&#125; 1234567@Datapublic class User &#123; private Integer userId; private String username; private String avatar;&#125; è‡ªå®šä¹‰æ¥å£1234567891011121314151617181920212223242526272829303132333435363738394041424344/** * @Author Wingo * @Date 2020-04-12 12:45 * @Description */public interface LikedService &#123; /** * ç‚¹èµ/å–æ¶ˆç‚¹èµ * * @param type ç±»å‹ * @param subjectId è¢«ç‚¹èµä¸»ä½“ ID * @param postId ç‚¹èµä¸»ä½“ ID * @param postUser ç‚¹èµä¸»ä½“çš„æ¦‚è¦ä¿¡æ¯ * @param subject è¢«ç‚¹èµä¸»ä½“æ¦‚è¦ä¿¡æ¯ */ void liked(MyType type, String subjectId, String postId, Object subject, Object postUser); /** * è·å–ä¸»ä½“ç‚¹èµæ•°é‡ * * @param type ç±»å‹ * @param subjectId è¢«ç‚¹èµä¸»ä½“ ID * @return ç‚¹èµæ•°é‡ */ Long count(MyType type, String subjectId); /** * è·å–ç‚¹èµä¸»ä½“çš„è¯¦æƒ…åˆ—è¡¨ * * @param type ç±»å‹ * @param subjectId è¢«ç‚¹èµä¸»ä½“ ID * @return ç‚¹èµä¸»ä½“çš„è¯¦æƒ…åˆ—è¡¨ */ List&lt;Object&gt; getPostUserSet(MyType type, String subjectId); /** * æ’è¡ŒæŸ¥è¯¢ * * @param type ä¸šåŠ¡ç±»å‹ * @param top å‰ top å * @return æ’è¡Œåˆ—è¡¨ */ Set&lt;Object&gt; getSubjectTopN(MyType type, Long top);&#125; æ¥å£å®ç°123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172package com.wingo.springbootredis01.service.impl;import com.wingo.springbootredis01.constant.Common;import com.wingo.springbootredis01.constant.MyType;import com.wingo.springbootredis01.service.LikedService;import com.wingo.springbootredis01.util.LikedUtil;import lombok.extern.slf4j.Slf4j;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.data.redis.core.RedisTemplate;import org.springframework.stereotype.Service;import java.util.List;import java.util.Set;/** * @Author Wingo * @Date 2020-04-12 12:50 * @Description */@Slf4j@Servicepublic class LikedServiceImpl implements LikedService &#123; @Autowired private RedisTemplate&lt;String,Object&gt; redisTemplate; @Override public void liked(MyType type, String subjectId, String postId, Object subject, Object postUser) &#123; String key = LikedUtil.getKey(type, subjectId); Boolean liked = redisTemplate.opsForHash().hasKey(key, postId); if (Boolean.TRUE.equals(liked)) &#123; // å–æ¶ˆèµ redisTemplate.opsForHash().delete(key, postId); &#125; else &#123; // ç‚¹èµ redisTemplate.opsForHash().put(key, postId, postUser); &#125; String reportKey = LikedUtil.getTopKey(type); if (Boolean.TRUE.equals(liked)) &#123; redisTemplate.opsForZSet().incrementScore(reportKey, subject, Common.DECLINE); &#125; else &#123; Double score = redisTemplate.opsForZSet().score(reportKey, subject); if (score == null) &#123; redisTemplate.opsForZSet().add(reportKey, subject, Common.INCREASE); &#125; else &#123; redisTemplate.opsForZSet().incrementScore(reportKey, subject, Common.INCREASE); &#125; &#125; &#125; @Override public Long count(MyType type, String subjectId) &#123; String key = LikedUtil.getKey(type, subjectId); return redisTemplate.opsForHash().size(key); &#125; @Override public List&lt;Object&gt; getPostUserSet(MyType type, String subjectId) &#123; String key = LikedUtil.getKey(type, subjectId); return redisTemplate.opsForHash().values(key); &#125; @Override public Set&lt;Object&gt; getSubjectTopN(MyType type, Long top) &#123; String key = LikedUtil.getTopKey(type); return redisTemplate.opsForZSet().reverseRange(key, 0, top); &#125;&#125; å•å…ƒæµ‹è¯•12345678910111213141516171819202122232425@Testvoid keyTest()&#123; MyType myType = MyType.LIKED_ARTICLE; for (int j = 1; j &lt;= 100; j++) &#123; Article article= new Article(); article.setArticleId(j); article.setTitle(\"æ–‡ç« æ ‡é¢˜\"+j); article.setImg(\"æ–‡ç« å›¾ç‰‡\"+j); article.setSummary(\"æ–‡ç« æ‘˜è¦\"+j); for (int i = 1; i &lt;= j; i++) &#123; User user = new User(); user.setUserId (i); user.setUsername(\"user\"+ i); user.setAvatar(\"avatar\"+ i); likedService.liked(myType, j+\"\", i+\"\", article, user); &#125; &#125;&#125;@Testvoid countTest()&#123; MyType myType = MyType.LIKED_ARTICLE; log.info(likedService.getSubjectTopN(myType, (long) 10).toString());&#125; ç”¨æˆ·ä¿¡æ¯è¢«å†™å…¥ç¼“å­˜ã€‚ â€‹ å–å¾—æ’åå‰åçš„æ–‡ç« ä¿¡æ¯ã€‚","categories":[{"name":"Demo","slug":"Demo","permalink":"http://yoursite.com/categories/Demo/"}],"tags":[{"name":"Redis","slug":"Redis","permalink":"http://yoursite.com/tags/Redis/"}]},{"title":"H2 é…ç½®","slug":"Software/H2 é…ç½®","date":"2020-04-06T09:33:57.000Z","updated":"2020-04-19T06:41:20.626Z","comments":true,"path":"2020/04/06/Software/H2 é…ç½®/","link":"","permalink":"http://yoursite.com/2020/04/06/Software/H2%20%E9%85%8D%E7%BD%AE/","excerpt":"Spring Boot æ•´åˆ H2 æ•°æ®åº“.","text":"Spring Boot æ•´åˆ H2 æ•°æ®åº“. æ·»åŠ ä¾èµ–12345678910111213&lt;dependency&gt; &lt;groupId&gt;com.h2database&lt;/groupId&gt; &lt;artifactId&gt;h2&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;&lt;/dependency&gt; å¸¸ç”¨é…ç½®12345678910111213141516171819202122# è‹¥ä½¿ç”¨å†…å­˜æ•°æ®åº“ spring.datasource.url=jdbc:h2:mem:test# ./ è¡¨ç¤ºæ ¹ç›®å½•ä¸‹ç”Ÿæˆæ•°æ®åº“æ–‡ä»¶ ~/ è¡¨ç¤ºç”¨æˆ·æ ¹ç›®å½• spring.datasource.url=jdbc:h2:./db/testspring.datasource.driverClassName=org.h2.Driverspring.datasource.username=saspring.datasource.password=# ä½¿ç”¨ H2 æ•°æ®å¹³å°spring.datasource.platform=h2# å†…å­˜æ¨¡å¼çš„æ•°æ®åº“ä¿¡æ¯è¯»å–# spring.datasource.schema=classpath:db/schema.sql# spring.datasource.data=classpath:db/data.sqlspring.h2.console.settings.web-allow-others=true# æµè§ˆå™¨è®¿é—®è·¯å¾„ &#123;path&#125;/h2spring.h2.console.path=/h2# ç¨‹åºå¯åŠ¨æ—¶å¯åŠ¨ H2spring.h2.console.enabled=truespring.jpa.database-platform=org.hibernate.dialect.H2Dialectspring.jpa.generate-ddl=truespring.jpa.show-sql=truespring.jpa.hibernate.ddl-auto=update","categories":[{"name":"Tool","slug":"Tool","permalink":"http://yoursite.com/categories/Tool/"}],"tags":[{"name":"H2","slug":"H2","permalink":"http://yoursite.com/tags/H2/"}]},{"title":"Mybatis-Plus","slug":"Software/Mybatis/Mybatis-Plus","date":"2020-04-06T03:44:35.000Z","updated":"2020-04-19T06:41:50.713Z","comments":true,"path":"2020/04/06/Software/Mybatis/Mybatis-Plus/","link":"","permalink":"http://yoursite.com/2020/04/06/Software/Mybatis/Mybatis-Plus/","excerpt":"Mybatis-Plus æ•´åˆ H2 æ•°æ®åº“å°æ¡ˆä¾‹ã€‚","text":"Mybatis-Plus æ•´åˆ H2 æ•°æ®åº“å°æ¡ˆä¾‹ã€‚ Mybatis-Plus å®˜æ–¹æ–‡æ¡£ SQL è¯­å¥ 12345678910111213141516-- å»ºè¡¨è¯­å¥CREATE TABLE user( id BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID', name VARCHAR(30) NULL DEFAULT NULL COMMENT 'å§“å', age INT(11) NULL DEFAULT NULL COMMENT 'å¹´é¾„', email VARCHAR(50) NULL DEFAULT NULL COMMENT 'é‚®ç®±', PRIMARY KEY (id));-- æ’å…¥æ•°æ®INSERT INTO user (name, age, email) VALUES('Jone', 18, 'test1@baomidou.com'),('Jack', 20, 'test2@baomidou.com'),('Tom', 28, 'test3@baomidou.com'),('Sandy', 21, 'test4@baomidou.com'),('Billie', 24, 'test5@baomidou.com'); ç¯å¢ƒæ­å»ºçƒ­éƒ¨ç½² ctrl + shift + alt + /å‹¾é€‰ 1234567891011121314151617181920212223242526272829303132333435363738394041424344&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;!-- mybatis-plus --&gt; &lt;dependency&gt; &lt;groupId&gt;com.baomidou&lt;/groupId&gt; &lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt; &lt;version&gt;3.3.1.tmp&lt;/version&gt; &lt;/dependency&gt; &lt;!-- H2 æ•°æ®åº“ --&gt; &lt;dependency&gt; &lt;groupId&gt;com.h2database&lt;/groupId&gt; &lt;artifactId&gt;h2&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- ç”¨äºè¿”å› JSON --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;fastjson&lt;/artifactId&gt; &lt;version&gt;1.2.6&lt;/version&gt; &lt;/dependency&gt; &lt;!-- çƒ­éƒ¨ç½² --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;scope&gt;true&lt;/scope&gt; &lt;/dependency&gt; 1234567891011121314151617181920# è‹¥ä½¿ç”¨å†…å­˜æ•°æ®åº“ spring.datasource.url=jdbc:h2:mem:test# ./ è¡¨ç¤ºæ ¹ç›®å½•ä¸‹ç”Ÿæˆæ•°æ®åº“æ–‡ä»¶ ~/ è¡¨ç¤ºç”¨æˆ·æ ¹ç›®å½•spring.datasource.url=jdbc:h2:./db/testspring.datasource.driverClassName=org.h2.Driverspring.datasource.username=saspring.datasource.password=# ä½¿ç”¨ H2 æ•°æ®å¹³å°spring.datasource.platform=h2# å†…å­˜æ¨¡å¼çš„æ•°æ®åº“ä¿¡æ¯è¯»å–# spring.datasource.schema=classpath:db/schema.sql# spring.datasource.data=classpath:db/data.sqlspring.h2.console.settings.web-allow-others=true# æµè§ˆå™¨è®¿é—®è·¯å¾„ &#123;path&#125;/h2spring.h2.console.path=/h2# ç¨‹åºå¯åŠ¨æ—¶å¯åŠ¨ H2spring.h2.console.enabled=true# æ‰“å° SQL è¯­å¥mybatis-plus.configuration.log-impl=org.apache.ibatis.logging.stdout.StdOutImpl é¡¹ç›®æ­å»ºVO12345678910111213141516171819202122232425262728293031323334353637383940public class ResponseVO extends HashMap&lt;String, Object&gt; &#123; private static final Integer SUCCESS_STATUS = 200; private static final Integer ERROR_STATUS = -1; private static final String SUCCESS_MSG = \"ä¸€åˆ‡æ­£å¸¸\"; private static final String ERROR_MSG = \"å‡ºç°é”™è¯¯\"; private static final long serialVersionUID = 1L; public ResponseVO success(String msg) &#123; put(\"msg\", SUCCESS_MSG); put(\"status\", SUCCESS_STATUS); return this; &#125; public ResponseVO error(String msg) &#123; put(\"msg\", ERROR_MSG); put(\"status\", ERROR_STATUS); return this; &#125; public ResponseVO setData(String key, Object obj) &#123; @SuppressWarnings(\"unchecked\") HashMap&lt;String, Object&gt; data = (HashMap&lt;String, Object&gt;) get(\"data\"); if (data == null) &#123; data = new HashMap&lt;&gt;(16); put(\"data\", data); &#125; data.put(key, obj); return this; &#125; /** * è¿”å›JSONå­—ç¬¦ä¸² */ @Override public String toString() &#123; return JSONObject.toJSONString(this); // com.alibaba.fastjson &#125;&#125; Entity12345678910@Datapublic class User &#123; @TableId(type=IdType.AUTO) // è‡ªå¢ private Long id; private String name; private Integer age; private String email;&#125; Mapper1234@Component // å¯ä¸åŠ ï¼šé˜²æ­¢ç¼–è¯‘å™¨æŠ¥é”™public interface UserMapper extends BaseMapper&lt;User&gt; &#123;&#125; Controller1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253@Controllerpublic class UserController &#123; @Autowired private UserMapper userMapper; @GetMapping(value = \"/selectList\") @ResponseBody public ResponseVO selectList()&#123; ResponseVO responseVO = new ResponseVO(); List&lt;User&gt; userList = userMapper.selectList(new QueryWrapper&lt;User&gt;().orderByDesc(\"id\")); responseVO.setData(\"userList\",userList); return responseVO; &#125; @GetMapping(value = \"/insert/&#123;name&#125;/&#123;age&#125;\") public String insert(@PathVariable(\"name\") String name, @PathVariable(\"age\") Integer age)&#123; User user = new User(); user.setName(name); user.setAge(age); user.setEmail(name + age +\"@wingo-email.com\"); userMapper.insert(user); return \"redirect:/selectList\"; &#125; @GetMapping(value = \"/delete/&#123;id&#125;\") public String delete(@PathVariable(\"id\") Integer id)&#123; userMapper.deleteById(id); return \"redirect:/selectList\"; &#125; @GetMapping(value = \"/age-eq/&#123;age&#125;\") public ResponseVO ageEqual(@PathVariable(\"age\") Integer age)&#123; ResponseVO responseVO = new ResponseVO(); QueryWrapper&lt;User&gt; queryWrapper = new QueryWrapper&lt;&gt;(); queryWrapper.eq(\"age\",age); List&lt;User&gt; userList = userMapper.selectList(queryWrapper); responseVO.setData(\"userList\",userList); return responseVO; &#125; @GetMapping(value = \"/age/&#123;gt&#125;/&#123;lt&#125;\") @ResponseBody public ResponseVO age(@PathVariable(\"gt\") Integer gt, @PathVariable(\"lt\") Integer lt)&#123; ResponseVO responseVO = new ResponseVO(); QueryWrapper&lt;User&gt; queryWrapper = new QueryWrapper&lt;&gt;(); queryWrapper.gt(\"age\",gt); queryWrapper.lt(\"age\",lt); List&lt;User&gt; userList = userMapper.selectList(queryWrapper); responseVO.setData(\"userList\",userList); return responseVO; &#125;&#125; æ¥å£æµ‹è¯• åˆ†é¡µé…ç½®1234567891011121314151617@Configurationpublic class MyBatisConfig &#123; /** * MyBatis-puls åˆ†é¡µæ’ä»¶é…ç½® * @return */ @Bean public PaginationInterceptor paginationInterceptor() &#123; PaginationInterceptor paginationInterceptor = new PaginationInterceptor(); // è®¾ç½®è¯·æ±‚çš„é¡µé¢å¤§äºæœ€å¤§é¡µåæ“ä½œï¼Œ true è°ƒå›åˆ°é¦–é¡µï¼Œfalse ç»§ç»­è¯·æ±‚ é»˜è®¤ false paginationInterceptor.setOverflow(false); // è®¾ç½®æœ€å¤§å•é¡µé™åˆ¶æ•°é‡ï¼Œé»˜è®¤ 500 æ¡ï¼Œ-1 ä¸å—é™åˆ¶ paginationInterceptor.setLimit(500); return paginationInterceptor; &#125;&#125; ä»£ç ç”Ÿæˆå™¨1234567891011&lt;dependency&gt; &lt;groupId&gt;com.baomidou&lt;/groupId&gt; &lt;artifactId&gt;mybatis-plus-generator&lt;/artifactId&gt; &lt;version&gt;3.2.0&lt;/version&gt;&lt;/dependency&gt;&lt;!-- å®˜æ–¹æ–‡æ¡£æŸ¥çœ‹æ”¯æŒçš„å…¶å®ƒå¼•æ“ --&gt;&lt;dependency&gt; &lt;groupId&gt;org.freemarker&lt;/groupId&gt; &lt;artifactId&gt;freemarker&lt;/artifactId&gt; &lt;version&gt;2.3.29&lt;/version&gt;&lt;/dependency&gt; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687/*** ä»£ç ç”Ÿæˆå™¨*/public class Generator &#123; /** * è¯»å–æ§åˆ¶å°å†…å®¹ */ public static String scanner(String tip) &#123; Scanner scanner = new Scanner(System.in); StringBuilder help = new StringBuilder(); help.append(\"è¯·è¾“å…¥\" + tip + \"ï¼š\"); System.out.println(help.toString()); if (scanner.hasNext()) &#123; String ipt = scanner.next(); if (StringUtils.isNotEmpty(ipt)) &#123; return ipt; &#125; &#125; throw new MybatisPlusException(\"è¯·è¾“å…¥æ­£ç¡®çš„\" + tip + \"ï¼\"); &#125; public static void main(String[] args) &#123; // ä»£ç ç”Ÿæˆå™¨ AutoGenerator mpg = new AutoGenerator(); // å…¨å±€é…ç½® GlobalConfig gc = new GlobalConfig(); String projectPath = System.getProperty(\"user.dir\"); gc.setOutputDir(projectPath + \"/src/main/java\"); gc.setAuthor(\"wingo\"); gc.setOpen(false); // gc.setSwagger2(true); // å®ä½“å±æ€§ Swagger2 æ³¨è§£ gc.setBaseResultMap(true); gc.setBaseColumnList(true); mpg.setGlobalConfig(gc); // æ•°æ®æºé…ç½® DataSourceConfig dsc = new DataSourceConfig(); dsc.setUrl(\"jdbc:mysql://localhost:3306/[db-name]?useSSL=false\"); dsc.setDriverName(\"com.mysql.jdbc.Driver\"); dsc.setUsername(\"root\"); dsc.setPassword(\"123456\"); mpg.setDataSource(dsc); // åŒ…é…ç½® PackageConfig pc = new PackageConfig(); pc.setModuleName(scanner(\"æ¨¡å—å\")); pc.setParent(\"com.wingo.mybatisplus\"); mpg.setPackageInfo(pc); // è‡ªå®šä¹‰é…ç½® InjectionConfig cfg = new InjectionConfig() &#123; @Override public void initMap() &#123; // to do nothing &#125; &#125;; List&lt;FileOutConfig&gt; focList = new ArrayList&lt;&gt;(); // æ¨¡æ¿å¼•æ“æ˜¯ freemarker focList.add(new FileOutConfig(\"/templates/mapper.xml.ftl\") &#123; @Override public String outputFile(TableInfo tableInfo) &#123; // è‡ªå®šä¹‰è¾“å…¥æ–‡ä»¶åç§° return projectPath + \"/src/main/resources/mapper/\" + pc.getModuleName() + \"/\" + tableInfo.getEntityName() + \"Mapper\" + StringPool.DOT_XML; &#125; &#125;); cfg.setFileOutConfigList(focList); mpg.setCfg(cfg); mpg.setTemplate(new TemplateConfig().setXml(null)); // ç­–ç•¥é…ç½® StrategyConfig strategy = new StrategyConfig(); strategy.setNaming(NamingStrategy.underline_to_camel); strategy.setColumnNaming(NamingStrategy.underline_to_camel); strategy.setEntityLombokModel(true); // ä½¿ç”¨ Lombok æ’ä»¶ strategy.setInclude(scanner(\"è¡¨å\")); // è‡ªå®šä¹‰ç»§æ‰¿ç±»ï¼Œå¯ç›´æ¥ä½¿ç”¨å®˜æ–¹çš„é¡¶çº§å®ç° // strategy.setSuperServiceClass(\"com.wingo.common.service.IService\"); // strategy.setSuperServiceImplClass(\"com.wingo.common.service.impl.ServiceImpl\"); // Controlleré…ç½® strategy.setSkipView(false); strategy.setControllerMappingHyphenStyle(true); strategy.setRestControllerStyle(false); // @Controller @RestController strategy.setTablePrefix(pc.getModuleName() + \"_\"); mpg.setStrategy(strategy); // é€‰æ‹© freemarker å¼•æ“éœ€è¦æŒ‡å®šå¦‚ä¸‹åŠ ï¼Œæ³¨æ„ pom ä¾èµ–å¿…é¡»æœ‰ï¼ mpg.setTemplateEngine(new FreemarkerTemplateEngine()); mpg.execute(); &#125;&#125; Service é¡¶çº§å®ç°","categories":[{"name":"ORM","slug":"ORM","permalink":"http://yoursite.com/categories/ORM/"}],"tags":[{"name":"Mybatis","slug":"Mybatis","permalink":"http://yoursite.com/tags/Mybatis/"}]},{"title":"vue å…¥æ‰‹å°é¡¹ç›®","slug":"FrontEnd/Vue/Vue å°æ¡ˆä¾‹","date":"2020-04-04T07:47:41.000Z","updated":"2020-04-19T06:26:24.663Z","comments":true,"path":"2020/04/04/FrontEnd/Vue/Vue å°æ¡ˆä¾‹/","link":"","permalink":"http://yoursite.com/2020/04/04/FrontEnd/Vue/Vue%20%E5%B0%8F%E6%A1%88%E4%BE%8B/","excerpt":"Vue å®ç°ä¸€ä¸ªå° Demoã€‚","text":"Vue å®ç°ä¸€ä¸ªå° Demoã€‚ ç¯å¢ƒæ­å»º é¦–å…ˆç³»ç»Ÿéœ€è¦å®‰è£… Node.js æä¾›ä¸€ä¸ª Javascript è¿è¡Œç¯å¢ƒï¼šNode æ˜¯ä¸€ä¸ªæœåŠ¡å™¨ç«¯ JavaScript è§£é‡Šå™¨ã€‚ ç³»ç»Ÿå‘½ä»¤è¡Œè¾“å…¥node -væŸ¥çœ‹ Node.js æ˜¯å¦å®‰è£…æˆåŠŸã€‚ åˆ©ç”¨ npm å‘½ä»¤å®‰è£… Vueï¼š 12345npm install vuenpm install --global vue-clinpm install webpack -g# è¿›å…¥åˆ°å­˜æ”¾ç›®å½•çš„ç›®å½•ä¸‹è¿›è¡Œé¡¹ç›®åˆå§‹åŒ–vue init webpack demo_vue åˆå§‹åŒ–é¡¹ç›®é€‰é¡¹ï¼š å°†é¡¹ç›®å¯¼å…¥ IDEA IntelliJï¼Œå‘½ä»¤è¡Œä¸­è¾“å…¥npm run devè¿è¡Œé¡¹ç›®ã€‚ï¼ˆIDEA ä¸­éœ€è¦å®‰è£… Vue.js æ’ä»¶ï¼‰ åœ¨ IDEA ä¸­æ‰“å¼€é¡¹ç›®ç›®å½•ä¸­çš„æ–‡ä»¶æ—¶å¯èƒ½ä¼šæŠ¥é”™ï¼Œé”™è¯¯åŸå› æ˜¯ Js çš„ç‰ˆæœ¬å¤ªä½äº†ï¼Œåœ¨é…ç½®ä¸­ä¿®æ”¹ Js çš„ç‰ˆæœ¬å³å¯ã€‚ é…ç½® Element-UI ä¾èµ–ï¼Œæ‰“å¼€ package.jsonï¼Œæ‰¾åˆ° devDependencies å¹¶åœ¨æœ€ååŠ ä¸Š&quot;element-ui&quot;: â€œ^2.2.1â€ï¼Œå†é€šè¿‡cnpm installè¿›è¡Œå®‰è£…ï¼Œå®‰è£…å®Œæˆånpm run devå¯åŠ¨ã€‚æ‰“å¼€ main.js åœ¨é‡Œé¢æ·»åŠ ä¸‰è¡Œå†…å®¹ã€‚ 12345import ElementUI from 'element-ui' // å¯¼å…¥ä¾èµ–import 'element-ui/lib/theme-chalk/index.css' // é¿å…åæœŸæ‰“åŒ…æ ·å¼ä¸åŒ: ...'./App'; ä¹‹å‰// ...Vue.use(ElementUI) // æ³¨å†Œ// ... æ–°å»ºä¸€ä¸ªç»„ä»¶ NewContact.vueï¼š 123456789101112&lt;template&gt; &lt;el-row&gt; &lt;el-button type&#x3D;&quot;success&quot;&gt;1&lt;&#x2F;el-button&gt; &lt;&#x2F;el-row&gt;&lt;&#x2F;template&gt;&lt;script&gt;&lt;&#x2F;script&gt;&lt;style&gt;&lt;&#x2F;style&gt; æ‰“å¼€é¡¹ç›®çš„åˆå§‹ç»„ä»¶ HelloWorld.vue å¯¹å…¶è¿›è¡Œä¿®æ”¹ï¼Œå¹¶ä¸”æ‰“å¼€ router/index.js æ·»åŠ è‡ªå®šä¹‰çš„è·¯ç”±é…ç½®ï¼š 1234&lt;template&gt;&lt;!-- è·¯ç”±æ ‡ç­¾ --&gt; &lt;router-link to&#x3D;&quot;newcontact&quot;&gt;&lt;h1&gt;&#123;&#123; msg &#125;&#125;&lt;&#x2F;h1&gt;&lt;&#x2F;router-link&gt;&lt;&#x2F;template&gt; 12345678910111213141516171819import Vue from 'vue'import Router from 'vue-router'import HelloWorld from '@/components/HelloWorld' // å¼•å…¥ç»„ä»¶: @ ä»£è¡¨æ ¹ç›®å½•import NewContact from '@/components/NewContact'Vue.use(Router)export default new Router(&#123; routes: [ &#123; path: '/', name: 'HelloWorld', component: HelloWorld &#125;, &#123; path: '/newcontact',// ä¸ router-link to ç›¸å¯¹åº”ï¼Œè·¯ç”±åˆ° /newcontact name: 'NewContact', component: NewContact &#125; ]&#125;) é¡µé¢æ•ˆæœï¼šç‚¹å‡» Rout to NewContact è·¯ç”±åˆ° NewContact ç»„ä»¶å¯¹åº”çš„é¡µé¢ã€‚ è‡ªå®šä¹‰ç»„ä»¶NewContact ç»„ä»¶ä¸­ä»£ç å¦‚ä¸‹ï¼š @Clickç”¨äºç»‘å®šå‡½æ•°ï¼›:dataç”¨äºç»‘å®šæ•°æ®ï¼›è¡¨æ ¼ç»‘å®šæ•°æ®æƒ…å†µä¸‹Â·propÂ·ç”¨äºæ•°æ®ä¼ é€’ï¼›slot-scope=&quot;del&quot;å®šä¹‰ä½œç”¨åŸŸï¼Œç”¨äºè·å– table çš„çŠ¶æ€ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950&lt;template&gt; &lt;el-row&gt; å§“åï¼š&#123;&#123;info.name&#125;&#125; &lt;el-input v-model&#x3D;&quot;info.name&quot; placeholder&#x3D;&quot;è¯·è¾“å…¥å§“å&quot;&gt;&lt;&#x2F;el-input&gt; å¹´é¾„ï¼š&#123;&#123;info.age&#125;&#125; &lt;el-input v-model&#x3D;&quot;info.age&quot; placeholder&#x3D;&quot;è¯·è¾“å…¥å¹´é¾„&quot;&gt;&lt;&#x2F;el-input&gt; æ€§åˆ«ï¼š&#123;&#123;info.sex&#125;&#125; &lt;el-select v-model&#x3D;&quot;info.sex&quot; placeholder&#x3D;&quot;è¯·é€‰æ‹©&quot;&gt; &lt;el-option v-for&#x3D;&quot;item in options&quot; :key&#x3D;&quot;item&quot; :value&#x3D;&quot;item&quot;&gt;&lt;&#x2F;el-option&gt; &lt;&#x2F;el-select&gt; &lt;&#x2F;el-select&gt; &lt;el-button @click&#x3D;&quot;create&quot;&gt;åˆ›å»º&lt;&#x2F;el-button&gt; &lt;template&gt; &lt;el-table :data&#x3D;&quot;tabledata&quot; align&#x3D;&quot;left&quot;&gt; &lt;el-table-column prop&#x3D;&quot;name&quot; label&#x3D;&quot;å§“å&quot;&gt;&lt;&#x2F;el-table-column&gt; &lt;el-table-column prop&#x3D;&quot;age&quot; label&#x3D;&quot;å¹´é¾„&quot;&gt;&lt;&#x2F;el-table-column&gt; &lt;el-table-column prop&#x3D;&quot;sex&quot; label&#x3D;&quot;æ€§åˆ«&quot;&gt;&lt;&#x2F;el-table-column&gt; &lt;el-table-column label&#x3D;&quot;æ“ä½œ&quot;&gt; &lt;template slot-scope&#x3D;&quot;de&quot;&gt; &lt;el-button size&#x3D;&quot;mini&quot; type&#x3D;&quot;danger&quot; @click&#x3D;&quot;del(de.$index)&quot;&gt;åˆ é™¤&lt;&#x2F;el-button&gt; &lt;&#x2F;template&gt; &lt;&#x2F;el-table-column&gt; &lt;&#x2F;el-table&gt; &lt;&#x2F;template&gt; &lt;&#x2F;el-row&gt;&lt;&#x2F;template&gt;&lt;script&gt; export default &#123; name: &quot;NewContact&quot;, data() &#123; return &#123; info: &#123; name: &#39;&#39;, age: &#39;&#39;, sex: &#39;&#39; &#125;, options: [ &#39;å¥³&#39;, &#39;ç”·&#39;, ], tabledata: [ &#123;name: &#39;test01&#39;, age: 11, sex: &#39;man&#39;&#125;, &#123;name: &#39;test02&#39;, age: 22, sex: &#39;women&#39;&#125;, &#123;name: &#39;test03&#39;, age: 33, sex: &#39;men&#39;&#125; ] &#125; &#125; &#125;&lt;&#x2F;script&gt;&lt;style&gt;&lt;&#x2F;style&gt; æ­¤æ—¶è®¿é—®é¡µé¢ï¼šlocalhost:8080/#/newcontact æ˜¾ç¤ºå¦‚ä¸‹ï¼š æ–¹æ³•ç»‘å®š12345678910111213141516171819&lt;script&gt;data()&#123; export default &#123; name: &quot;NewContact&quot;, data() &#123; &#x2F;&#x2F; ... &#125; methods: &#123; create()&#123; &#x2F;&#x2F; v-model åŒå‘ç»‘å®šï¼šç”¨æˆ·å¡«å†™çš„ä¿¡æ¯è‡ªåŠ¨ç»‘å®šåˆ°å¯¹åº”çš„å¯¹è±¡ä¸­ this.tabledata.push(this.info) &#x2F;&#x2F; ç»™ tabledata æ·»åŠ ä¸€ä¸ªå¯¹è±¡ï¼ˆä¹‹å‰æˆ‘ä»¬åˆ›å»ºçš„ info ï¼‰ this.info &#x3D; &#123;name: &#39;&#39;, age: &#39;&#39;, sex: &#39;&#39;&#125; &#x2F;&#x2F; ç‚¹å‡»åˆ›å»ºåï¼Œè®©optionè¿˜åŸï¼Œè€Œä¸æ˜¯åœç•™åœ¨æ‰€é€‰çš„é¡¹ &#125;, del(index)&#123; &#x2F;&#x2F; splice(ä¿®æ”¹ä½ç½®, ç§»é™¤å…ƒç´ ä¸ªæ•°) this.tabledata.splice(index,1) &#x2F;&#x2F; åˆ é™¤ç‚¹å‡»çš„å¯¹è±¡ï¼Œindex æ˜¯ de.$indexä¼ è¿‡æ¥çš„ &#125; &#125;&lt;&#x2F;script&gt; æ·»åŠ å®Œè‡ªå®šä¹‰çš„æ–¹æ³•ä¹‹åå°±å¯ä»¥æ­£å¸¸çš„è¿›è¡Œæ·»åŠ å’Œåˆ é™¤ä¿¡æ¯çš„æ“ä½œäº†ã€‚ æœ¬åœ°å­˜å‚¨æ•°æ®åœ¨ src æ–‡ä»¶å¤¹ä¸‹æ–°å»ºä¸€ä¸ª store æ–‡ä»¶å¤¹ï¼Œå³ä¸ App.vueã€components åŒå±ä¸€ä¸ªå±‚çº§ï¼Œåœ¨é‡Œé¢æ–°å»ºä¸€ä¸ª store.jsã€‚ 12345678910const STORAGE_KEY = 'info'//åå­—éšä¾¿èµ·export default &#123;//å‘å¾€è¾“å‡ºï¼Œä»¥ä¾¿ç»„ä»¶æ¥æ”¶ fetch() &#123;//æˆ‘ä»¬å®šä¹‰çš„è·å–æ•°æ®çš„æ–¹æ³• return JSON.parse(window.localStorage.getItem(STORAGE_KEY) || '[]') &#125;, save(items) &#123;//æˆ‘ä»¬å®šä¹‰çš„ä¿å­˜æ•°æ®çš„æ–¹æ³• window.localStorage.setItem(STORAGE_KEY, JSON.stringify(items)) &#125;&#125; getItemå’ŒsetItemæ˜¯ window.localStorage çš„è·å–å’Œä¿å­˜æ•°æ®çš„æ–¹æ³•ï¼Œè·å–çš„æ•°æ®ä½¿ç”¨ JSON.stringify å’Œ JSON.parse æŠŠæ•°æ®è½¬æˆå­—ç¬¦ä¸²å’Œè§£æï¼Œæ–¹ä¾¿æˆ‘ä»¬å†™å…¥ tabledataã€‚ 12345678910111213141516171819&lt;script&gt;data()&#123; export default &#123; name: &quot;NewContact&quot;, data() &#123; &#x2F;&#x2F; ... &#125; methods: &#123; &#x2F;&#x2F; ... &#125; watch: &#123; &#x2F;&#x2F; watch æ˜¯ vue çš„ç›‘å¬ï¼Œä¸€æ—¦ç›‘å¬å¯¹è±¡æœ‰å˜åŒ–å°±ä¼šæ‰§è¡Œç›¸åº”æ“ä½œ tabledata: &#123; &#x2F;&#x2F; è¢«ç›‘å¬çš„å¯¹è±¡ handler(items)&#123; Storage.save(items) &#125;, &#x2F;&#x2F; ç›‘å¬å¯¹è±¡å˜åŒ–åæ‰€åšçš„æ“ä½œï¼Œä¿å­˜æ•°æ® deep: true &#x2F;&#x2F; æ·±åº¦ç›‘å¬ï¼Œé˜²æ­¢æ•°æ®å±‚çº§è¿‡å¤šç›‘å¬ä¸åˆ° &#125; &#125;&lt;&#x2F;script&gt; æµ‹è¯•ç»“æœï¼š é¡¹ç›®æ‰“åŒ…æ‰“å¼€ /config/index.js è¿›è¡Œä¸€ç‚¹å°ä¿®æ”¹ã€‚ 123456789build: &#123; index: path.resolve(__dirname, '../dist/index.html'), assetsRoot: path.resolve(__dirname, '../dist'), assetsSubDirectory: 'static', assetsPublicPath: './', // åŠ äº†ä¸ª . é¿å…ç”Ÿäº§è·¯å¾„çš„é”™è¯¯ productionSourceMap: false, // ä¿®æ”¹ä¸º false &#125; æ‰“åŒ…æˆåŠŸååœ¨é¡¹ç›®è·¯å¾„ä¸‹ç”Ÿæˆä¸€ä¸ª dist æ–‡ä»¶å¤¹ï¼Œæ‰“å¼€ index.html å³å¯è¿è¡Œæ­¤é¡¹ç›®ã€‚","categories":[{"name":"FrontEnd","slug":"FrontEnd","permalink":"http://yoursite.com/categories/FrontEnd/"}],"tags":[{"name":"Vue","slug":"Vue","permalink":"http://yoursite.com/tags/Vue/"}]},{"title":"Spring Boot ä»»åŠ¡","slug":"Spring Boot/Spring Boot ä»»åŠ¡","date":"2020-04-01T02:50:45.000Z","updated":"2020-04-19T06:43:44.041Z","comments":true,"path":"2020/04/01/Spring Boot/Spring Boot ä»»åŠ¡/","link":"","permalink":"http://yoursite.com/2020/04/01/Spring%20Boot/Spring%20Boot%20%E4%BB%BB%E5%8A%A1/","excerpt":"Spring Boot ä¸­çš„å¼‚æ­¥ä»»åŠ¡ï¼Œå®šæ—¶ä»»åŠ¡ï¼Œé‚®ä»¶ä»»åŠ¡çš„ä½¿ç”¨ã€‚","text":"Spring Boot ä¸­çš„å¼‚æ­¥ä»»åŠ¡ï¼Œå®šæ—¶ä»»åŠ¡ï¼Œé‚®ä»¶ä»»åŠ¡çš„ä½¿ç”¨ã€‚ å¼‚æ­¥ä»»åŠ¡ åœ¨ Java åº”ç”¨ä¸­ï¼Œç»å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½æ˜¯é€šè¿‡åŒæ­¥çš„æ–¹å¼æ¥å®ç°äº¤äº’å¤„ç†çš„ã€‚ä½†æ˜¯åœ¨å¤„ç†ä¸ç¬¬ä¸‰æ–¹ç³»ç»Ÿäº¤äº’çš„æ—¶å€™ï¼Œå®¹æ˜“é€ æˆå“åº”è¿Ÿç¼“çš„æƒ…å†µï¼Œä¹‹å‰å¤§éƒ¨åˆ†éƒ½æ˜¯ä½¿ç”¨å¤šçº¿ç¨‹æ¥å®Œæˆæ­¤ç±»ä»»åŠ¡ã€‚å…¶å®ï¼Œåœ¨Spring 3.x ä¹‹åï¼Œå°±å·²ç»å†…ç½®äº†@Asyncã€@EnableAysncæ¥å®Œç¾è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ åœ¨ Spring ä¸­è¿ç”¨ Async æ³¨è§£éœ€è¦æ³¨æ„å‡ ç‚¹ï¼š æ–¹æ³•åå¿…é¡»æ˜¯ public è¿›è¡Œä¿®é¥°çš„ï¼Œä¸”ä¸èƒ½æ˜¯ static æ–¹æ³•ï¼› ä¸èƒ½ä¸è°ƒç”¨çš„æ–¹æ³•åœ¨åŒä¸€ä¸ªç±»ä¸­ï¼› éœ€è¦æŠŠè¯¥æ–¹æ³•æ³¨å…¥åˆ° Spring å®¹å™¨ä¸­ï¼Œå°±æ˜¯åœ¨ä¸€ä¸ªç±»ä¸­æ·»åŠ å¼‚æ­¥æ–¹æ³•ï¼Œå¹¶åœ¨æ­¤ç±»ä¸Šä½¿ç”¨@Componentä¹‹ç±»çš„æ³¨è§£ã€‚ æµ‹è¯•å®ä¾‹å®šä¹‰ Task ç±»ï¼Œåˆ›å»ºä¸‰ä¸ªå¤„ç†å‡½æ•°åˆ†åˆ«æ¨¡æ‹Ÿä¸‰ä¸ªæ‰§è¡Œä»»åŠ¡çš„æ“ä½œï¼Œæ“ä½œæ¶ˆè€—æ—¶é—´éšæœºå–ï¼ˆ10 ç§’å†…ï¼‰ã€‚ 12345678910111213141516171819202122232425262728293031323334353637@Componentpublic class Task &#123; public static Random random =new Random(); @Async // æ³¨é‡Šä¸ºå¼‚æ­¥ä»»åŠ¡ï¼Œ public Future&lt;String&gt; doTaskOne() throws Exception &#123; System.out.println(\"Doing Task One\"); long start = System.currentTimeMillis(); Thread.sleep(random.nextInt(10000)); long end = System.currentTimeMillis(); System.out.println(\"Task One Finishedï¼šSpend \" + (end - start) + \" Millisecond\"); // è‹¥ä¸ç”¨ Future è¿›è¡Œå›è°ƒï¼Œæ— æ³•ç¡®å®šä»»åŠ¡å·²ç»å®Œæˆ return new AsyncResult&lt;&gt;(\"Task One Finished\"); // è¿”å›å¼‚æ­¥è°ƒç”¨ç»“æœ &#125; @Async public Future&lt;String&gt; doTaskTwo() throws Exception &#123; System.out.println(\"Doing Task Two\"); long start = System.currentTimeMillis(); Thread.sleep(random.nextInt(10000)); long end = System.currentTimeMillis(); System.out.println(\"Task Two Finishedï¼šSpend \" + (end - start) + \" Millisecond\"); return new AsyncResult&lt;&gt;(\"Task Two Finished\"); &#125; @Async public Future&lt;String&gt; doTaskThree() throws Exception &#123; System.out.println(\"Doing Task Three\"); long start = System.currentTimeMillis(); Thread.sleep(random.nextInt(10000)); long end = System.currentTimeMillis(); System.out.println(\"Task Three Finishedï¼šSpend \" + (end - start) + \" Millisecond\"); return new AsyncResult&lt;&gt;(\"Task Three Finished\"); &#125;&#125; 12345678@SpringBootApplication@EnableAsync // å¼‚æ­¥ä»»åŠ¡ç”Ÿæ•ˆpublic class Application &#123; public static void main(String[] args) &#123; SpringApplication.run(Application.class, args); &#125;&#125; 123456789101112131415161718192021@Testpublic void test() throws Exception &#123; long start = System.currentTimeMillis(); Future&lt;String&gt; taskOne = task.doTaskOne(); Future&lt;String&gt; taskTwo = task.doTaskTwo(); Future&lt;String&gt; taskThree = task.doTaskThree(); while(true) &#123; if(taskOne.isDone() &amp;&amp; taskTwo.isDone() &amp;&amp; taskThree.isDone()) &#123; // ä¸‰ä¸ªä»»åŠ¡éƒ½è°ƒç”¨å®Œæˆï¼Œé€€å‡ºå¾ªç¯ç­‰å¾… break; &#125; Thread.sleep(1000); &#125; long end = System.currentTimeMillis(); System.out.println(\"All Finishedï¼Œæ€»è€—æ—¶ï¼š\" + (end - start) + \"æ¯«ç§’\");&#125; å®šæ—¶ä»»åŠ¡ é¡¹ç›®å¼€å‘ä¸­ç»å¸¸éœ€è¦æ‰§è¡Œä¸€äº›å®šæ—¶ä»»åŠ¡ï¼Œæ¯”å¦‚éœ€è¦åœ¨æ¯å¤©å‡Œæ™¨æ—¶å€™ï¼Œåˆ†æä¸€æ¬¡å‰ä¸€å¤©çš„æ—¥å¿—ä¿¡æ¯ã€‚Spring ä¸ºæˆ‘ä»¬æä¾›äº†å¼‚æ­¥æ‰§è¡Œä»»åŠ¡è°ƒåº¦çš„æ–¹å¼ï¼Œæä¾› TaskExecutor ã€TaskScheduler æ¥å£ã€‚ æ³¨è§£ï¼š@EnableSchedulingã€@Scheduled corn è¡¨è¾¾å¼ *******ä»å·¦åˆ°å³åˆ†åˆ«ä»£è¡¨ï¼šç§’ åˆ† æ—¶ æ—¥ æœˆ æ˜ŸæœŸ å¹´ä»½ï¼Œè¿™é‡Œ * æŒ‡æ‰€æœ‰å¯èƒ½çš„å€¼ã€‚ åœ¨çº¿ Cron è¡¨è¾¾å¼ç”Ÿæˆå™¨ æµ‹è¯•1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-mail&lt;/artifactId&gt;&lt;/dependency&gt; 1234567891011121314151617@Servicepublic class TaskService &#123; /** * secondï¼ˆç§’ï¼‰, minuteï¼ˆåˆ†ï¼‰, hourï¼ˆæ—¶ï¼‰, day of monthï¼ˆæ—¥ï¼‰, monthï¼ˆæœˆï¼‰, day of weekï¼ˆå‘¨å‡ ï¼‰. * ä¾‹å­ï¼š * 0 0/5 14,18 * * ? æ¯å¤©14ç‚¹æ•´ï¼Œå’Œ18ç‚¹æ•´ï¼Œæ¯éš”5åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ * 0 15 10 ? * 1-6 æ¯ä¸ªæœˆçš„å‘¨ä¸€è‡³å‘¨å…­10:15åˆ†æ‰§è¡Œä¸€æ¬¡ * 0 0 2 ? * 6L æ¯ä¸ªæœˆçš„æœ€åä¸€ä¸ªå‘¨å…­å‡Œæ™¨2ç‚¹æ‰§è¡Œä¸€æ¬¡ * 0 0 2 LW * ? æ¯ä¸ªæœˆçš„æœ€åä¸€ä¸ªå·¥ä½œæ—¥å‡Œæ™¨2ç‚¹æ‰§è¡Œä¸€æ¬¡ * 0 0 2-4 ? * 1#1 æ¯ä¸ªæœˆçš„ç¬¬ä¸€ä¸ªå‘¨ä¸€å‡Œæ™¨2ç‚¹åˆ°4ç‚¹æœŸé—´ï¼Œæ¯ä¸ªæ•´ç‚¹éƒ½æ‰§è¡Œä¸€æ¬¡ï¼› */ @Scheduled(cron = \"0,1,2,3,4 * * * * MON-SAT\") public void runTask()&#123; System.out.println(new Date()+\"Doing Schedule Task\"); &#125;&#125; é‚®ä»¶ä»»åŠ¡ æœ€æ—©æœŸçš„æ—¶å€™ä½¿ç”¨ JavaMail ç›¸å…³ API æ¥å¼€å‘ï¼Œéœ€è¦è‡ªå·±å»å°è£…æ¶ˆæ¯ä½“ï¼Œä»£ç é‡æ¯”è¾ƒåºå¤§ï¼›åæ¥ Spring æ¨å‡ºäº† JavaMailSender ç®€åŒ–äº†é‚®ä»¶å‘é€è¿‡ç¨‹ï¼ŒJavaMailSender æä¾›äº†å¼ºå¤§çš„é‚®ä»¶å‘é€åŠŸèƒ½ï¼Œå¯æ”¯æŒå„ç§ç±»å‹çš„é‚®ä»¶å‘é€ã€‚ç°åœ¨ Spring Boot åœ¨ JavaMailSender çš„åŸºç¡€ä¸Šåˆè¿›è¡Œäº†å°è£…ï¼Œå°±æœ‰äº†ç°åœ¨çš„ spring-boot-starter-mailï¼Œè®©é‚®ä»¶å‘é€æµç¨‹æ›´åŠ ç®€æ´å’Œå®Œå–„ã€‚ æµ‹è¯•1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-mail&lt;/artifactId&gt;&lt;/dependency&gt; 123456spring.mail.username=é‚®ç®±è´¦å·# åœ¨é‚®ä»¶ç«™ç‚¹çš„ä¸ªäººä¸­å¿ƒä¸­è·å–spring.mail.password=xxxxxspring.mail.host=smtp.163.com // é‚®ä»¶åè®®å¯¹åº”çš„æœåŠ¡å™¨spring.mail.protocol=smtp // é‚®ä»¶åè®®spring.mail.properties.mail.smtp.ssl.enable=true 12345678910111213141516@AutowiredJavaMailSenderImpl mailSender;@Testpublic void testSimpleMessage()&#123; SimpleMailMessage message = new SimpleMailMessage(); message.setSubject(\"ç¬¬ä¸€å°æµ‹è¯•é‚®ä»¶\"); message.setText(\"é‚®ä»¶æµ‹è¯•...\"); message.setFrom(\"ä½ çš„é‚®ç®±è´¦å·\"); message.setTo(\"å‘é€å¯¹è±¡çš„é‚®ç®±è´¦å·\"); mailSender.send(message);&#125; 123456789101112131415161718@Testpublic void testMimeMessage() throws Exception&#123; // åˆ›å»ºå¤æ‚æ¶ˆæ¯ MimeMessage mimeMessage = mailSender.createMimeMessage(); MimeMessageHelper helper = new MimeMessageHelper(mimeMessage, true); helper.setSubject(\"ç¬¬äºŒå°é‚®ä»¶\"); helper.setText(\"&lt;b style='color:red'&gt;é‚®ä»¶æµ‹è¯•....&lt;/b&gt;\",true); helper.setFrom(\"ä½ çš„é‚®ç®±è´¦å·\"); helper.setTo(\"å‘é€å¯¹è±¡çš„é‚®ç®±è´¦å·\"); // å‘é€é‚®ä»¶ helper.addAttachment(\"1.jpg\",new File(\"C:\\\\Users\\\\12746\\\\Pictures\\\\22\\\\1.jpg\")); helper.addAttachment(\"2.jpg\",new File(\"C:\\\\Users\\\\12746\\\\Pictures\\\\22\\\\2.jpg\")); mailSender.send(mimeMessage);&#125;","categories":[{"name":"Java","slug":"Java","permalink":"http://yoursite.com/categories/Java/"}],"tags":[{"name":"Spring Boot","slug":"Spring-Boot","permalink":"http://yoursite.com/tags/Spring-Boot/"},{"name":"Aysnc","slug":"Aysnc","permalink":"http://yoursite.com/tags/Aysnc/"},{"name":"Scheduled","slug":"Scheduled","permalink":"http://yoursite.com/tags/Scheduled/"},{"name":"Email","slug":"Email","permalink":"http://yoursite.com/tags/Email/"}]},{"title":"Spring Boot å®‰å…¨","slug":"Spring Boot/Spring Boot å®‰å…¨","date":"2020-04-01T02:50:45.000Z","updated":"2020-04-19T06:43:06.632Z","comments":true,"path":"2020/04/01/Spring Boot/Spring Boot å®‰å…¨/","link":"","permalink":"http://yoursite.com/2020/04/01/Spring%20Boot/Spring%20Boot%20%E5%AE%89%E5%85%A8/","excerpt":"Shiro è½»é‡çº§å®‰å…¨æ¡†æ¶çš„ä»‹ç»åŠä½¿ç”¨ï¼›Sping å®‰å…¨æ¡†æ¶ Spring Security çš„ä»‹ç»åŠä½¿ç”¨ã€‚","text":"Shiro è½»é‡çº§å®‰å…¨æ¡†æ¶çš„ä»‹ç»åŠä½¿ç”¨ï¼›Sping å®‰å…¨æ¡†æ¶ Spring Security çš„ä»‹ç»åŠä½¿ç”¨ã€‚ Spring Securityç®€ä»‹ Spring Security æ˜¯é’ˆå¯¹ Spring é¡¹ç›®çš„å®‰å…¨æ¡†æ¶ï¼Œä¹Ÿæ˜¯ Spring Boot åº•å±‚å®‰å…¨æ¨¡å—é»˜è®¤çš„æŠ€æœ¯é€‰å‹ã€‚å¯ä»¥å®ç°å¼ºå¤§çš„ web å®‰å…¨æ§åˆ¶ã€‚å¯¹äºå®‰å…¨æ§åˆ¶ï¼Œæˆ‘ä»¬ä»…éœ€å¼•å…¥ spring-boot-starter-security æ¨¡å—ï¼Œè¿›è¡Œå°‘é‡çš„é…ç½®ï¼Œå³å¯å®ç°å¼ºå¤§çš„å®‰å…¨ç®¡ç†ã€‚ WebSecurityConfigurerAdapterï¼šè‡ªå®šä¹‰ Security ç­–ç•¥ï¼› AuthenticationManagerBuilderï¼šè‡ªå®šä¹‰è®¤è¯ç­–ç•¥ï¼› @EnableWebSecurityï¼šå¼€å¯ WebSecurityã€‚ åº”ç”¨ç¨‹åºçš„ä¸¤ä¸ªä¸»è¦åŒºåŸŸæ˜¯â€œè®¤è¯â€å’Œâ€œæˆæƒâ€ï¼ˆæˆ–è€…è®¿é—®æ§åˆ¶ï¼‰ã€‚è¿™ä¸¤ä¸ªä¸»è¦åŒºåŸŸæ˜¯ Spring Security çš„ä¸¤ä¸ªç›®æ ‡ã€‚ â€œè®¤è¯â€ï¼ˆAuthenticationï¼‰ï¼Œæ˜¯å»ºç«‹ä¸€ä¸ªç»è¿‡å£°æ˜çš„ä¸»ä½“çš„è¿‡ç¨‹ï¼Œå³ä½ æ˜¯è°ï¼› â€œæˆæƒâ€ï¼ˆAuthorizationï¼‰æŒ‡ç¡®å®šä¸€ä¸ªä¸»ä½“æ˜¯å¦å…è®¸åœ¨ä½ çš„åº”ç”¨ç¨‹åºæ‰§è¡Œä¸€ä¸ªåŠ¨ä½œçš„è¿‡ç¨‹ï¼Œå³ä½ èƒ½å¹²ä»€ä¹ˆã€‚ å…¥é—¨å®ä¾‹å¼•å…¥ä¾èµ–ï¼š 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;&lt;/dependency&gt; å»ºç«‹ä¸€ä¸ª Web å±‚çš„è¯·æ±‚æ¥å£ï¼š 12345678@RestController@RequestMapping(\"/user\")public class UserController &#123; @GetMapping public String getUsers() &#123; return \"Hello Spring Security\"; &#125;&#125; è‡ªå®šä¹‰ç”¨æˆ·è®¤è¯é€»è¾‘ ç³»ç»Ÿä¸€èˆ¬éƒ½æœ‰è‡ªå®šä¹‰çš„ç”¨æˆ·ä½“ç³»ï¼ŒSpring Security æä¾›äº†æ¥å£å¯ä»¥è‡ªå®šä¹‰è®¤è¯é€»è¾‘ä»¥åŠç™»å½•ç•Œé¢ã€‚ 1234567// å¯†ç åŠ å¯†æ¥å£public interface PasswordEncoder &#123; // å¯¹å¯†ç è¿›è¡ŒåŠ å¯† String encode(CharSequence var1); // å¯¹å¯†ç è¿›è¡Œåˆ¤æ–­åŒ¹é… boolean matches(CharSequence var1, String var2);&#125; 12345// å®ç° Spring Security ä¸­çš„ PasswordEncoder æ¥ï¼Œè¿™é‡Œç”¨æä¾›çš„é»˜è®¤å®ç°@Beanpublic PasswordEncoder passwordEncoder() &#123; return new BCryptPasswordEncoder(); &#125; é…ç½®ç”¨æˆ·è®¤è¯é€»è¾‘ï¼š UserDetails å°±æ˜¯å°è£…äº†ç”¨æˆ·ä¿¡æ¯çš„å¯¹è±¡ï¼Œè¿”å› UserDetails çš„å®ç°ç±» User çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡ User çš„æ„é€ æ–¹æ³•ï¼Œè®¾ç½®å¯¹åº”çš„å‚æ•°ã€‚ 12345678910111213141516171819@Componentpublic class MyUserDetailsService implements UserDetailsService &#123; private Logger logger = LoggerFactory.getLogger(getClass()); @Override public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException &#123; logger.info(\"ç”¨æˆ·çš„ç”¨æˆ·å: &#123;&#125;\", username); // TODO æ ¹æ®ç”¨æˆ·åï¼ŒæŸ¥æ‰¾åˆ°å¯¹åº”çš„å¯†ç ï¼Œä¸æƒé™ // å°è£…ç”¨æˆ·ä¿¡æ¯ï¼Œå¹¶è¿”å›ã€‚å‚æ•°åˆ†åˆ«æ˜¯ï¼šç”¨æˆ·åï¼Œå¯†ç ï¼Œç”¨æˆ·æƒé™ String password = passwordEncoder.encode(\"123456\"); logger.info(\"password: &#123;&#125;\", password); // æ¯æ¬¡æ‰“å°çš„å¯†ç éƒ½ä¸ä¸€æ ·ï¼Œå› ä¸ºç»è¿‡äº†åŠ å¯† // å‚æ•°åˆ†åˆ«æ˜¯ï¼šç”¨æˆ·åï¼Œå¯†ç ï¼Œç”¨æˆ·æƒé™ User user = new User(username, password, AuthorityUtils.commaSeparatedStringToAuthorityList(\"admin\")); return user; &#125;&#125; è‡ªå®šä¹‰ç™»å½•é¡µé¢ï¼š 12345678910111213141516171819202122232425&lt;!DOCTYPE html&gt;&lt;html lang=\"en\"&gt;&lt;head&gt; &lt;meta charset=\"UTF-8\"&gt; &lt;title&gt;ç™»å½•é¡µé¢&lt;/title&gt;&lt;/head&gt;&lt;body&gt; &lt;h2&gt;è‡ªå®šä¹‰ç™»å½•é¡µé¢&lt;/h2&gt; &lt;form action=\"/user/login\" method=\"post\"&gt; &lt;table&gt; &lt;tr&gt; &lt;td&gt;ç”¨æˆ·åï¼š&lt;/td&gt; &lt;td&gt;&lt;input type=\"text\" name=\"username\"&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;å¯†ç ï¼š&lt;/td&gt; &lt;td&gt;&lt;input type=\"password\" name=\"password\"&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td colspan=\"2\"&gt;&lt;button type=\"submit\"&gt;ç™»å½•&lt;/button&gt;&lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; &lt;/form&gt;&lt;/body&gt;&lt;/html&gt; é…ç½®æ¨¡å—12345678910111213141516@Configurationpublic class BrowerSecurityConfig extends WebSecurityConfigurerAdapter &#123; protected void configure(HttpSecurity http) throws Exception &#123; http.formLogin() // å®šä¹‰å½“éœ€è¦ç”¨æˆ·ç™»å½•æ—¶å€™ï¼Œè½¬åˆ°çš„ç™»å½•é¡µé¢ã€‚ .loginPage(\"/login.html\") // è®¾ç½®ç™»å½•é¡µé¢ .loginProcessingUrl(\"/user/login\") // è‡ªå®šä¹‰çš„ç™»å½•æ¥å£ .and() .authorizeRequests() // å®šä¹‰å“ªäº› URL éœ€è¦è¢«ä¿æŠ¤ï¼Œå“ªäº›ä¸éœ€è¦è¢«ä¿æŠ¤ .antMatchers(\"/login.html\").permitAll() // è®¾ç½®æ‰€æœ‰äººéƒ½å¯ä»¥è®¿é—®ç™»å½•é¡µé¢ .anyRequest() // ä»»ä½•è¯·æ±‚ï¼Œç™»å½•åå¯ä»¥è®¿é—® .authenticated() .and() .csrf().disable(); // å…³é—­ csrf é˜²æŠ¤ &#125;&#125; Shiro Apache Shiroæ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ä¸”æ˜“äºä½¿ç”¨çš„ Javaå®‰ å…¨æ¡†æ¶ï¼Œå®ƒä¸ºå¼€å‘äººå‘˜æä¾›äº†ä¸€ç§ç›´è§‚ï¼Œå…¨é¢çš„èº«ä»½éªŒè¯ï¼Œæˆæƒï¼ŒåŠ å¯†å’Œä¼šè¯ç®¡ç†è§£å†³æ–¹æ¡ˆã€‚ æ ¸å¿ƒ API Subjectï¼š ç”¨æˆ·ä¸»ä½“ï¼ˆæŠŠæ“ä½œäº¤ç»™SecurityManagerï¼‰ï¼›SecurityManagerï¼šå®‰å…¨ç®¡ç†å™¨ï¼ˆå…³è”Realmï¼‰ï¼›Realmï¼šShiro è¿æ¥æ•°æ®çš„æ¡¥æ¢ã€‚ å…¥é—¨å®ä¾‹SQL å»ºè¡¨è¯­å¥ï¼š 1234567CREATE TABLE `user` ( `id` int(11) NOT NULL AUTO_INCREMENT, `username` varbinary(64) DEFAULT NULL, `password` varchar(64) DEFAULT NULL, `perms` varchar(64) DEFAULT NULL, PRIMARY KEY (`id`)) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8 å¯¼å…¥ä¾èµ–ï¼š 12345678910111213141516&lt;!-- shiro --&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.shiro&lt;/groupId&gt; &lt;artifactId&gt;shiro-web&lt;/artifactId&gt; &lt;version&gt;1.4.0&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.shiro&lt;/groupId&gt; &lt;artifactId&gt;shiro-spring&lt;/artifactId&gt; &lt;version&gt;1.4.0&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;com.github.theborakompanioni&lt;/groupId&gt; &lt;artifactId&gt;thymeleaf-extras-shiro&lt;/artifactId&gt; &lt;version&gt;2.0.0&lt;/version&gt;&lt;/dependency&gt; è‡ªå®šä¹‰ Realm ç±»123456789101112131415161718192021222324252627282930313233343536373839@Slf4jpublic class UserRealm extends AuthorizingRealm &#123; @Autowired private UserRepository userRepository; @Override protected AuthorizationInfo doGetAuthorizationInfo(PrincipalCollection arg0) &#123; log.info(\"æ‰§è¡Œæˆæƒé€»è¾‘\"); Subject subject = SecurityUtils.getSubject(); User user = userRepository.findUserByUsername((String) subject.getSession().getAttribute(\"username\")); // ç»™ç”¨æˆ·è¿›è¡Œæˆæƒ SimpleAuthorizationInfo info = new SimpleAuthorizationInfo(); info.addStringPermission(user.getPerms()); return info; &#125; @Override protected AuthenticationInfo doGetAuthenticationInfo(AuthenticationToken arg0) throws AuthenticationException &#123; log.info(\"æ‰§è¡Œè®¤è¯é€»è¾‘\"); Subject subject = SecurityUtils.getSubject(); Session session = subject.getSession(); UsernamePasswordToken token = (UsernamePasswordToken)arg0; User user = userRepository.findUserByUsername(token.getUsername()); session.setAttribute(\"username\", token.getUsername()); if(user==null)&#123; // shiro åº•å±‚ä¼šæŠ›å‡ºUnKnowAccountException return null; &#125; // åˆ¤æ–­å¯†ç  return new SimpleAuthenticationInfo(user,user.getPassword(),getName()); &#125;&#125; Shiro é…ç½®ç±»1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162@Slf4j@Configurationpublic class ShiroConfig &#123; @Autowired @Qualifier(\"shiroCacheManager\") private ShiroCacheManager shiroCacheManager; @Bean public ShiroFilterFactoryBean getShiroFilterFactoryBean(@Autowired DefaultWebSecurityManager securityManager)&#123; ShiroFilterFactoryBean shiroFilterFactoryBean = new ShiroFilterFactoryBean(); // è®¾ç½®å®‰å…¨ç®¡ç†å™¨ shiroFilterFactoryBean.setSecurityManager(securityManager); // æ³¨å…¥ç¼“å­˜ç®¡ç†å™¨ securityManager.setCacheManager(shiroCacheManager); // è®¾ç½®è¿‡æ»¤å™¨é“¾ Map&lt;String,String&gt; filterMap = new LinkedHashMap&lt;&gt;(16); filterMap.put(\"/index\", \"anon\"); filterMap.put(\"/favicon.ico\", \"anon\"); // æ·»åŠ è®¿é—®æƒé™ filterMap.put(\"/toAdd\", \"perms[user:add]\"); filterMap.put(\"/toUpdate\", \"perms[user:update]\"); // æ³¨æ„ï¼šè¦æ”¾åœ¨å…è®¸è®¿é—®çš„é¡µé¢åé¢ï¼Œå¦åˆ™å…è®¸è®¿é—®æ— æ•ˆ filterMap.put(\"/**\", \"authc\"); // å¦‚æœæ²¡æœ‰è®¤è¯é€šè¿‡ è·³è½¬åˆ°çš„ url åœ°å€ shiroFilterFactoryBean.setLoginUrl(\"/login\"); shiroFilterFactoryBean.setSuccessUrl(\"/index\"); // æœªæˆæƒè·³è½¬é¡µé¢ shiroFilterFactoryBean.setUnauthorizedUrl(\"/error\"); shiroFilterFactoryBean.setFilterChainDefinitionMap(filterMap); return shiroFilterFactoryBean; &#125; // å®‰å…¨ç®¡ç†å™¨ @Bean public DefaultWebSecurityManager getDefaultWebSecurityManager(@Autowired UserRealm userRealm)&#123; DefaultWebSecurityManager securityManager = new DefaultWebSecurityManager(); // å…³è” realm securityManager.setRealm(userRealm); return securityManager; &#125; @Bean public UserRealm getRealm()&#123; return new UserRealm(); &#125; /** é…ç½® ShiroDialectï¼Œç”¨äº Thymeleaf å’Œ Shiro æ ‡ç­¾é…åˆä½¿ç”¨ */ // æ·»åŠ  xmlns:shiro=\"http://www.pollix.at/thymeleaf/shiro\" æ ‡ç­¾æ ¡éªŒè§„èŒƒ @Bean public ShiroDialect getShiroDialect()&#123; return new ShiroDialect(); &#125;&#125; æ§åˆ¶å™¨ç±»1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950@Controllerpublic class UserController &#123; @GetMapping(\"/login\") public String login()&#123; return \"login\"; &#125; @GetMapping(\"/index\") public String hello(Model model)&#123; Subject subject = SecurityUtils.getSubject(); model.addAttribute(\"username\", subject.getSession().getAttribute(\"username\")); return \"index\"; &#125; @GetMapping(\"/toAdd\") public String add()&#123; return \"/user/add\"; &#125; @GetMapping(\"/toUpdate\") public String update()&#123; return \"/user/update\"; &#125; @GetMapping(\"/toExit\") public String exit()&#123; Subject subject = SecurityUtils.getSubject(); subject.logout(); return \"redirect:/login\"; &#125; @PostMapping(\"/login\") public String login(String username, String password, Model model)&#123; Subject subject = SecurityUtils.getSubject(); UsernamePasswordToken token = new UsernamePasswordToken(username,password); try &#123; Session session = subject.getSession(); session.setAttribute(\"username\", username); subject.login(token); return \"redirect:/index\"; &#125; catch (UnknownAccountException e) &#123; model.addAttribute(\"msg\", \"ç”¨æˆ·åä¸å­˜åœ¨\"); return \"login\"; &#125;catch (IncorrectCredentialsException e) &#123; model.addAttribute(\"msg\", \"å¯†ç é”™è¯¯\"); return \"login\"; &#125; &#125;&#125; é«˜çº§è‡ªå®šä¹‰ç¼“å­˜ç®¡ç†å™¨ï¼šSpring æ¥ç®¡ Shiro çš„ç¼“å­˜ç®¡ç†ã€‚ å®ç° Shiro æä¾›çš„ Cache å’Œ CacheManager æ¥å£ ğŸ‘‰ å®ç° Cache ç¼“å­˜æ¥å£åº•å±‚ä½¿ç”¨ SpringCache å®ç°ã€‚ ShiroCache12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879/*** è‡ªå®šä¹‰ Shiro ç¼“å­˜ï¼Œå®ç° ShiroCache æ¥å£** @param &lt;K&gt;* @param &lt;V&gt;*/public class ShiroCache&lt;K,V&gt; implements org.apache.shiro.cache.Cache&lt;K,V&gt; &#123; // Spring çš„ç¼“å­˜ç®¡ç†å™¨ private CacheManager springCacheManager; // Spring çš„ç¼“å­˜å¯¹è±¡ private Cache springCache; // æ„é€ å™¨ public ShiroCache(org.springframework.cache.CacheManager springCacheManager, String cacheName) &#123; this.springCacheManager = springCacheManager; this.springCache = springCacheManager.getCache(cacheName); &#125; // è‡ªå®šä¹‰å®ç°ï¼Œéƒ½ç”± Spring çš„ç¼“å­˜å¯¹è±¡è¿›è¡Œæ“ä½œ @Override public V get(K key) throws CacheException &#123; Cache.ValueWrapper valueWrapper = springCache.get(key); if (valueWrapper == null) &#123; return null; &#125; return (V) valueWrapper.get(); &#125; @Override public V put(K key, V value) throws CacheException &#123; springCache.put(key, value); return value; &#125; @Override public V remove(K key) throws CacheException &#123; V value = this.get(key); springCache.evict(key); return value; &#125; /** * æ¸…ç©ºç¼“å­˜ * @throws CacheException */ @Override public void clear() throws CacheException &#123; springCache.clear(); &#125; /** * è·å–æ‰€æœ‰ç¼“å­˜keyçš„é›†åˆ * * @return */ @Override public Set&lt;K&gt; keys() &#123; return (Set&lt;K&gt;) springCacheManager.getCacheNames(); &#125; /** * è·å–æ‰€æœ‰ç¼“å­˜valueå€¼çš„é›†åˆ * * @return */ @Override public Collection&lt;V&gt; values() &#123; List&lt;V&gt; list = new ArrayList&lt;&gt;(); Set&lt;K&gt; keys = keys(); for (K k : keys) &#123; list.add(this.get(k)); &#125; return list; &#125; /** * è·å–ç¼“å­˜å¯¹è±¡çš„æ•°é‡ * * @return */ @Override public int size() &#123; int size = keys().size(); return size; &#125;&#125; ShiroCacheManager12345678910111213public class ShiroCacheManager&lt;K, V&gt; implements CacheManager &#123; // Spring çš„ç¼“å­˜ç®¡ç†å™¨ private org.springframework.cache.CacheManager springCacheManager; public ShiroCacheManager(org.springframework.cache.CacheManager springCacheManager) &#123; this.springCacheManager = springCacheManager; &#125; @Override public &lt;K, V&gt; Cache&lt;K, V&gt; getCache(String cacheName) throws CacheException &#123; // é€šè¿‡ç¼“å­˜ååœ¨ç¼“å­˜ç®¡ç†å™¨ä¸­è·å–å¯¹åº”çš„ç¼“å­˜ return new ShiroCache&lt;&gt;(springCacheManager, cacheName); &#125;&#125; 1234567891011121314151617/*** shiro çš„ç¼“å­˜ç®¡ç†å™¨* @return*/@Bean(name = \"shiroCacheManager\")public ShiroCacheManager shiroCacheManager()&#123; // åˆ›å»ºä¸€ä¸ª Redis ç¼“å­˜çš„é»˜è®¤é…ç½® RedisCacheConfiguration conf = RedisCacheConfiguration.defaultCacheConfig(); // è®¾ç½®ä¼šè¯çš„æœ‰æ•ˆæœŸ conf = conf.entryTtl(Duration.ofSeconds(30)); RedisCacheManager cacheManager = RedisCacheManager .builder(redisConnectionFactory) .cacheDefaults(conf) .build(); // ä¸ç”¨ ShiroCacheManager è¿”å›çš„å…¶å®æ˜¯ä¸€ä¸ª RedisCacheManager return new ShiroCacheManager(cacheManager);&#125; æ³¨å…¥è‡ªå®šä¹‰çš„ç¼“å­˜ç®¡ç†å™¨ 12345678910111213141516@Slf4j@Configurationpublic class ShiroConfig &#123; @Autowired @Qualifier(\"shiroCacheManager\") private ShiroCacheManager shiroCacheManager; @Bean public ShiroFilterFactoryBean getShiroFilterFactoryBean(@Autowired DefaultWebSecurityManager securityManager)&#123; // ... // æ³¨å…¥ç¼“å­˜ç®¡ç†å™¨ securityManager.setCacheManager(shiroCacheManager); // ... &#125;&#125; ShiroSessionDAO1234567891011121314151617181920212223242526272829303132333435363738394041424344454647@Repositorypublic class ShiroSessionDAO extends AbstractSessionDAO &#123; @Autowired private RedisTemplate&lt;Serializable, Session&gt; redisTemplate; private String name = \"shiro-session:\"; private long timeout = 30; @Override protected Serializable doCreate(Session session) &#123; // ç”Ÿæˆä¼šè¯çš„å”¯ä¸€id Serializable sessionId = generateSessionId(session); super.create(session); redisTemplate.opsForValue().set(name + sessionId, session); return sessionId; &#125; @Override protected Session doReadSession(Serializable sessionId) &#123; super.readSession(sessionId); // æ›´æ–°ç¼“å­˜ redisTemplate.expire(sessionId, timeout, TimeUnit.MINUTES); return redisTemplate.opsForValue().get(sessionId); &#125; @Override public void update(Session session) throws UnknownSessionException &#123; redisTemplate.opsForValue().set(name + session.getId(), session); &#125; @Override public void delete(Session session) &#123; redisTemplate.delete(name + session.getId()); &#125; @Override public Collection&lt;Session&gt; getActiveSessions() &#123; Set&lt;Serializable&gt; set = redisTemplate.keys(name + \"*\"); List&lt;Session&gt; sessionList = new ArrayList&lt;&gt;(); for (Serializable sessionId : set) &#123; sessionList.add(redisTemplate.opsForValue().get(name + sessionId)); &#125; return sessionList; &#125;&#125; é…ç½®ç±»123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100@Configurationpublic class ShiroConfig &#123; @Autowired @Qualifier(\"shiroCacheManager\") private ShiroCacheManager shiroCacheManager; /** * é…ç½®è‡ªå®šä¹‰SessionDAO * @return */ @Bean public SessionDAO sessionDAO() &#123; SessionDAO sessionDAO = new ShiroSessionDAO(shiroCacheManager); return sessionDAO; &#125; /** * é…ç½®ä¼šè¯ç®¡ç†å™¨ * @return */ @Bean public SessionManager sessionManager()&#123; // WEB ç¯å¢ƒé HttpSession ä¼šè¯ç®¡ç†å™¨ DefaultWebSessionManager sessionManager = new DefaultWebSessionManager(); // æ³¨å…¥è‡ªå®šä¹‰çš„ SessionDao sessionManager.setSessionDAO(sessionDAO()); return sessionManager; &#125; /** * é…ç½®å®‰å…¨ç®¡ç†å™¨ * * @return */ @Bean public SecurityManager securityManager() &#123; DefaultWebSecurityManager securityManager = new DefaultWebSecurityManager(); // æ³¨å…¥è‡ªå®šä¹‰Realm securityManager.setRealm(shiroRealm()); // æ³¨å…¥ç¼“å­˜ç®¡ç†å™¨ securityManager.setCacheManager(shiroCacheManager); // æ³¨å…¥ä¼šè¯ç®¡ç†å™¨ securityManager.setSessionManager(sessionManager()); return securityManager; &#125; /** * è£…é… è‡ªå®šä¹‰Realm * * @return */ @Bean public ShiroRealm shiroRealm() &#123; return new ShiroRealm(); &#125; /** * é…ç½®æƒé™æƒé™è¿‡æ»¤å™¨ * @return */ @Bean public ShiroFilterFactoryBean shiroFilterFactoryBean() &#123; ShiroFilterFactoryBean filter = new ShiroFilterFactoryBean(); // æ³¨å…¥å®‰å…¨ç®¡ç†å™¨ filter.setSecurityManager(securityManager()); // æœªè®¤è¯çš„è·³è½¬åœ°å€ filter.setLoginUrl(\"/login\"); Map&lt;String, String&gt; chain = new LinkedHashMap&lt;&gt;(); chain.put(\"/login\", \"anon\"); // ç™»å½•é“¾æ¥ä¸æ‹¦æˆª chain.put(\"/css/**\", \"anon\"); chain.put(\"/img/**\", \"anon\"); chain.put(\"/js/**\", \"anon\"); chain.put(\"/lib/**\", \"anon\"); chain.put(\"/**\", \"user\"); filter.setFilterChainDefinitionMap(chain); return filter; &#125; /** * å¯ç”¨ Shiro æ³¨è§£ * @return */ @Bean public AuthorizationAttributeSourceAdvisor authorizationAttributeSourceAdvisor() &#123; AuthorizationAttributeSourceAdvisor advisor = new AuthorizationAttributeSourceAdvisor(); // æ³¨å…¥å®‰å…¨ç®¡ç†å™¨ advisor.setSecurityManager(securityManager()); return advisor; &#125; /** * å¯ç”¨ Shiro Thymeleaf æ ‡ç­¾æ”¯æŒ * @return */ @Bean public ShiroDialect shiroDialect() &#123; return new ShiroDialect(); &#125;&#125;","categories":[{"name":"Java","slug":"Java","permalink":"http://yoursite.com/categories/Java/"}],"tags":[{"name":"Spring Boot","slug":"Spring-Boot","permalink":"http://yoursite.com/tags/Spring-Boot/"},{"name":"Security","slug":"Security","permalink":"http://yoursite.com/tags/Security/"},{"name":"Shiro","slug":"Shiro","permalink":"http://yoursite.com/tags/Shiro/"}]},{"title":"Spring Boot æ£€ç´¢","slug":"Spring Boot/Spring Boot æ£€ç´¢","date":"2020-03-31T06:50:45.000Z","updated":"2020-04-19T06:43:37.795Z","comments":true,"path":"2020/03/31/Spring Boot/Spring Boot æ£€ç´¢/","link":"","permalink":"http://yoursite.com/2020/03/31/Spring%20Boot/Spring%20Boot%20%E6%A3%80%E7%B4%A2/","excerpt":"ElasticSearch åŸºæœ¬ä»‹ç»ä»¥åŠåœ¨ Spring Boot ä¸­çš„æ•´åˆä½¿ç”¨ã€‚","text":"ElasticSearch åŸºæœ¬ä»‹ç»ä»¥åŠåœ¨ Spring Boot ä¸­çš„æ•´åˆä½¿ç”¨ã€‚ ElasticSearchå¦‚ä»Šçš„åº”ç”¨ç»å¸¸éœ€è¦æ·»åŠ æ£€ç´¢åŠŸèƒ½ï¼Œå¼€æºçš„ ElasticSearch æ˜¯ç›®å‰å…¨æ–‡æœç´¢å¼•æ“çš„é¦–é€‰ã€‚ä»–å¯ä»¥å¿«é€Ÿçš„å­˜å‚¨ã€æœç´¢å’Œåˆ†ææµ·é‡æ•°æ®ã€‚Spring Boot é€šè¿‡æ•´åˆ Spring Data ElasticSearch ä¸ºæˆ‘ä»¬æä¾›äº†éå¸¸ä¾¿æ·çš„æ£€ç´¢åŠŸèƒ½æ”¯æŒã€‚ Elasticsearch æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æœç´¢æœåŠ¡ï¼Œæä¾› Restful APIï¼Œåº•å±‚åŸºäº Luceneï¼Œé‡‡ç”¨å¤š shardï¼ˆåˆ†ç‰‡ï¼‰çš„æ–¹å¼ä¿è¯æ•°æ®å®‰å…¨ï¼Œå¹¶ä¸”æä¾›è‡ªåŠ¨ resharding çš„åŠŸèƒ½ï¼Œgithub ç­‰å¤§å‹çš„ç«™ç‚¹ä¹Ÿæ˜¯é‡‡ç”¨äº† ElasticSearch ä½œä¸ºå…¶æœç´¢æœåŠ¡ã€‚ Elasticsearch æœ¬èº«å°±æ˜¯åˆ†å¸ƒå¼çš„ï¼Œå³ä¾¿åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼ŒElasticsearch é»˜è®¤ä¹Ÿä¼šå¯¹çš„æ•°æ®è¿›è¡Œåˆ†ç‰‡å’Œå‰¯æœ¬æ“ä½œï¼Œå‘é›†ç¾¤æ·»åŠ æ–°æ•°æ®æ—¶ï¼Œæ•°æ®ä¹Ÿä¼šåœ¨æ–°åŠ å…¥çš„èŠ‚ç‚¹ä¸­è¿›è¡Œå¹³è¡¡ ç›¸å…³æ¦‚å¿µä¸€ä¸ª ElasticSearch é›†ç¾¤å¯ä»¥åŒ…å«å¤šä¸ªç´¢å¼• ï¼Œç›¸åº”çš„æ¯ä¸ªç´¢å¼•å¯ä»¥åŒ…å«å¤šä¸ªç±»å‹ ã€‚è¿™äº›ä¸åŒçš„ç±»å‹å­˜å‚¨ç€å¤šä¸ªæ–‡æ¡£ ï¼Œæ¯ä¸ªæ–‡æ¡£åˆæœ‰å¤šä¸ªå±æ€§ ã€‚ Elasticsearch ä¹Ÿæ˜¯åŸºäº Lucene çš„å…¨æ–‡æ£€ç´¢åº“ï¼Œæœ¬è´¨ä¹Ÿæ˜¯å­˜å‚¨æ•°æ®ï¼Œå¾ˆå¤šæ¦‚å¿µä¸å…³ç³»å‹æ•°æ®åº“æ˜¯ä¸€è‡´çš„ï¼Œå¦‚ä¸‹å¯¹ç…§ï¼š ç´¢å¼•åº“ å…³ç³»å‹æ•°æ®åº“ ç±»å‹ï¼ˆtypeï¼‰ Table æ•°æ®è¡¨ æ–‡æ¡£ï¼ˆDocumentï¼‰ Row è¡Œ å­—æ®µï¼ˆFieldï¼‰ Columns åˆ— å¦å¤–ï¼Œåœ¨ Elasticsearch æœ‰ä¸€äº›é›†ç¾¤ç›¸å…³çš„æ¦‚å¿µï¼š ç´¢å¼•é›†ï¼ˆIndicesï¼Œindex çš„å¤æ•°ï¼‰ï¼šé€»è¾‘ä¸Šçš„å®Œæ•´ç´¢å¼•ï¼› åˆ†ç‰‡ï¼ˆshardï¼‰ï¼šæ•°æ®æ‹†åˆ†åçš„å„ä¸ªéƒ¨åˆ†ï¼› å‰¯æœ¬ï¼ˆreplicaï¼‰ï¼šæ¯ä¸ªåˆ†ç‰‡çš„å¤åˆ¶ã€‚ æ•´åˆ Spring Boot æä¾›äº†ä¸¤ç§æ–¹å¼æ“ä½œ Elasticsearchï¼ŒJest å’Œ SpringDataã€‚ Docker å®‰è£…éƒ¨ç½² ElasticSearch 12345# ä¸‹è½½é•œåƒdocker pull elasticsearch# Elasticsearch å¯åŠ¨æ˜¯ä¼šé»˜è®¤åˆ†é… 2G çš„å†…å­˜ ï¼Œæˆ‘ä»¬å¯åŠ¨æ˜¯è®¾ç½®å°ä¸€ç‚¹ï¼Œé˜²æ­¢æˆ‘ä»¬å†…å­˜ä¸å¤Ÿå¯åŠ¨å¤±è´¥# 9200 æ˜¯ Elasticsearch é»˜è®¤çš„ web é€šä¿¡æ¥å£ï¼Œ9300 æ˜¯åˆ†å¸ƒå¼æƒ…å†µä¸‹ï¼ŒElasticsearch å„ä¸ªèŠ‚ç‚¹çš„é€šä¿¡ç«¯å£docker run -e ES_JAVA_OPTS=\"-Xms256m -Xmx256m\" -d -p 9200:9200 -p 9300:9300 --name es01 5c1e1ecfe33a Jest ElasticSearch already has a Java API which is also used by ElasticSearch internally, but Jest fills a gap, it is the missing client for ElasticSearch Http Rest interface. æ·»åŠ ä¾èµ–ï¼š 12345&lt;dependency&gt; &lt;groupId&gt;io.searchbox&lt;/groupId&gt; &lt;artifactId&gt;jest&lt;/artifactId&gt; &lt;version&gt;5.3.3&lt;/version&gt;&lt;/dependency&gt; é…ç½®æœåŠ¡å™¨ï¼š 1spring.elasticsearch.jest.uris=http://127.0.0.1:9200 ## Elasticsearch æœåŠ¡å™¨ ç¼–å†™å®ä½“ç±»ï¼š 12345678910111213141516171819202122232425public class Article &#123; // If @JestId value is null, it will be set the value of ElasticSearch generated \"_id\". @JestId // @JestId annotation can be used to mark a property of a bean as id private Integer id; private String author; private String title; private String content; // Getter / Setter @Override public String toString() &#123; final StringBuilder sb = new StringBuilder( \"&#123;\\\"Article\\\":&#123;\" ); sb.append( \"\\\"id\\\":\" ) .append( id ); sb.append( \",\\\"author\\\":\\\"\" ) .append( author ).append( '\\\"' ); sb.append( \",\\\"title\\\":\\\"\" ) .append( title ).append( '\\\"' ); sb.append( \",\\\"content\\\":\\\"\" ) .append( content ).append( '\\\"' ); sb.append( \"&#125;&#125;\" ); return sb.toString(); &#125;&#125; æµ‹è¯•12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849@RunWith(SpringRunner.class)@SpringBootTestpublic class SpringbootElasticsearchApplicationTests &#123; @Autowired JestClient jestClient; @Test public void createIndex() &#123; // åˆå§‹åŒ–ä¸€ä¸ªæ–‡æ¡£ Article article = new Article(); article.setId( 1 ); article.setTitle( \"å¥½æ¶ˆæ¯\" ); article.setAuthor( \"å¼ ä¸‰\" ); article.setContent( \"Hello World\" ); // æ„å»ºä¸€ä¸ªç´¢å¼• Index index = new Index.Builder(article).index(\"shekou\").type(\"news\").build(); try &#123; // æ‰§è¡Œ jestClient.execute(index); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; @Test public void search() &#123; // æŸ¥è¯¢è¡¨è¾¾å¼ String query = \"&#123;\\n\" + \" \\\"query\\\" : &#123;\\n\" + \" \\\"match\\\" : &#123;\\n\" + \" \\\"content\\\" : \\\"hello\\\"\\n\" + \" &#125;\\n\" + \" &#125;\\n\" + \"&#125;\"; // æ„å»ºæœç´¢åŠŸèƒ½ Search search = new Search.Builder(query).addIndex(\"shekou\").addType(\"news\").build(); try &#123; // æ‰§è¡Œ SearchResult result = jestClient.execute(search); System.out.println(result.getJsonString()); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125;&#125; æœç´¢è¡¨è¾¾å¼æŸ¥è¯¢ï¼š Searching Document Spring Dataspring-data-elasticsearch ä½¿ç”¨ä¹‹å‰å¿…é¡»å…ˆç¡®å®š Elasticsearch ç‰ˆæœ¬ï¼šç‚¹å‡»æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ Spring Data é€šè¿‡æ³¨è§£æ¥å£°æ˜å­—æ®µçš„æ˜ å°„å±æ€§ï¼Œæ³¨è§£çš„è¯¦ç»†ç”¨æ³•ï¼š @Document ä½œç”¨åœ¨ç±»ï¼Œæ ‡è®°å®ä½“ç±»ä¸ºæ–‡æ¡£å¯¹è±¡ï¼Œä¸€èˆ¬æœ‰ä¸¤ä¸ªå±æ€§ï¼š indexNameï¼šå¯¹åº”ç´¢å¼•åº“åç§°ï¼› typeï¼šå¯¹åº”åœ¨ç´¢å¼•åº“ä¸­çš„ç±»å‹ï¼› shardsï¼šåˆ†ç‰‡æ•°é‡ï¼Œé»˜è®¤5ï¼› replicasï¼šå‰¯æœ¬æ•°é‡ï¼Œé»˜è®¤1ã€‚ @Idä½œç”¨åœ¨æˆå‘˜å˜é‡ï¼Œæ ‡è®°ä¸€ä¸ªå­—æ®µä½œä¸º id ä¸»é”®ã€‚ @Fieldä½œç”¨åœ¨æˆå‘˜å˜é‡ï¼Œæ ‡è®°ä¸ºæ–‡æ¡£çš„å­—æ®µï¼Œå¹¶æŒ‡å®šå­—æ®µæ˜ å°„å±æ€§ï¼š typeï¼šå­—æ®µç±»å‹ï¼Œæ˜¯æšä¸¾ï¼šFieldTypeï¼Œå¯ä»¥æ˜¯ textã€longã€shortã€dateã€integerã€object ç­‰ï¼š Textï¼šå­˜å‚¨æ•°æ®æ—¶å€™ï¼Œä¼šè‡ªåŠ¨åˆ†è¯ï¼Œå¹¶ç”Ÿæˆç´¢å¼•ï¼› Keywordï¼šå­˜å‚¨æ•°æ®æ—¶å€™ï¼Œä¸ä¼šåˆ†è¯å»ºç«‹ç´¢å¼•ï¼› Numericalï¼šæ•°å€¼ç±»å‹ï¼Œåˆ†ä¸¤ç±»ï¼š åŸºæœ¬æ•°æ®ç±»å‹ï¼šlongã€intergerã€shortã€byteã€doubleã€floatã€half_floatï¼› æµ®ç‚¹æ•°çš„é«˜ç²¾åº¦ç±»å‹ï¼šscaled_float éœ€è¦æŒ‡å®šä¸€ä¸ªç²¾åº¦å› å­ï¼Œæ¯”å¦‚ 10 æˆ– 100ã€‚Elasticsearch ä¼šæŠŠçœŸå®å€¼ä¹˜ä»¥è¿™ä¸ªå› å­åå­˜å‚¨ï¼Œå–å‡ºæ—¶å†è¿˜åŸã€‚ Dateï¼šæ—¥æœŸç±»å‹ Elasticsearch å¯ä»¥å¯¹æ—¥æœŸæ ¼å¼åŒ–ä¸ºå­—ç¬¦ä¸²å­˜å‚¨ï¼Œä½†æ˜¯å»ºè®®æˆ‘ä»¬å­˜å‚¨ä¸ºæ¯«ç§’å€¼ï¼Œå­˜å‚¨ä¸º longï¼ŒèŠ‚çœç©ºé—´ã€‚ indexï¼šæ˜¯å¦ç´¢å¼•ï¼Œå¸ƒå°”ç±»å‹ï¼Œé»˜è®¤æ˜¯trueï¼› storeï¼šæ˜¯å¦å­˜å‚¨ï¼Œå¸ƒå°”ç±»å‹ï¼Œé»˜è®¤æ˜¯falseï¼› analyzerï¼šåˆ†è¯å™¨åç§°ã€‚ CRUD Spring Data çš„å¼ºå¤§ä¹‹å¤„ï¼Œå°±åœ¨äºä½ ä¸ç”¨å†™ä»»ä½• DAO å¤„ç†ï¼Œè‡ªåŠ¨æ ¹æ®æ–¹æ³•åæˆ–ç±»çš„ä¿¡æ¯è¿›è¡Œ CRUD æ“ä½œã€‚åªè¦ä½ å®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œç„¶åç»§æ‰¿ Repository æä¾›çš„ä¸€äº›å­æ¥å£ï¼Œå°±èƒ½å…·å¤‡å„ç§åŸºæœ¬çš„ CRUD åŠŸèƒ½ã€‚ 123public interface ItemRepository extends ElasticsearchRepository&lt;Item,Long&gt; &#123;&#125; æµ‹è¯•12345678910111213141516171819202122// åˆ›å»ºä¸€ä¸ªå®ä½“ç±»å¹¶æ ‡æ³¨ä¸ºæ–‡æ¡£@Document(indexName = \"item\", type = \"docs\", shards = 1, replicas = 0)public class Item &#123; @Id private Long id; @Field(type = FieldType.Text) private String title; @Field(type = FieldType.Keyword) private String category; @Field(type = FieldType.Keyword) private String brand; @Field(type = FieldType.Double) private Double price; @Field(index = false, type = FieldType.Keyword) private String images;&#125; è°ƒç”¨ elasticsearchTemplate åˆ›å»ºç´¢å¼•å¹¶æ˜ å°„ï¼š 1234567891011121314151617181920@RunWith(SpringRunner.class)@SpringBootTest(classes = EsDemoApplication.class)public class EsDemoApplicationTests &#123; @Autowired private ElasticsearchTemplate elasticsearchTemplate; @Test public void testCreateIndex() &#123; // æ ¹æ® Item ç±»çš„ @Document æ³¨è§£ä¿¡æ¯æ¥åˆ›å»º elasticsearchTemplate.createIndex(Item.class); &#125; @Test public void insert() &#123; Item item = new Item(1L, \"Redmi\", \" æ‰‹æœº\", \"å°ç±³\", 1499.00, \"RedmiImage.jpg\"); itemRepository.save(item); &#125;&#125;","categories":[{"name":"Java","slug":"Java","permalink":"http://yoursite.com/categories/Java/"}],"tags":[{"name":"Spring Boot","slug":"Spring-Boot","permalink":"http://yoursite.com/tags/Spring-Boot/"},{"name":"ElasticSearch","slug":"ElasticSearch","permalink":"http://yoursite.com/tags/ElasticSearch/"}]},{"title":"Spring Boot æ¶ˆæ¯ä¸­é—´ä»¶","slug":"Spring Boot/Spring Boot æ¶ˆæ¯é˜Ÿåˆ—","date":"2020-03-31T03:50:45.000Z","updated":"2020-04-19T06:44:07.737Z","comments":true,"path":"2020/03/31/Spring Boot/Spring Boot æ¶ˆæ¯é˜Ÿåˆ—/","link":"","permalink":"http://yoursite.com/2020/03/31/Spring%20Boot/Spring%20Boot%20%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/","excerpt":"MQ åŸºæœ¬ä»‹ç»ä»¥åŠä¸ Spring Boot çš„æ•´åˆä½¿ç”¨ã€‚","text":"MQ åŸºæœ¬ä»‹ç»ä»¥åŠä¸ Spring Boot çš„æ•´åˆä½¿ç”¨ã€‚ æ¦‚è¿°åœ¨å¤§å¤šæ•°åº”ç”¨ç¨‹åºä¸­ï¼Œå¯é€šè¿‡æ¶ˆæ¯æœåŠ¡ä¸­é—´ä»¶æ¥æå‡ç³»ç»Ÿå¼‚æ­¥é€šä¿¡ã€æ‰©å±•è§£è€¦èƒ½åŠ›ã€‚ æ¶ˆæ¯ä»£ç†ï¼ˆmessage brokerï¼‰ï¼›ç›®çš„åœ°ï¼ˆdestinationï¼‰ã€‚ å½“æ¶ˆæ¯å‘é€è€…å‘é€æ¶ˆæ¯ä»¥åï¼Œå°†ç”±æ¶ˆæ¯ä»£ç†æ¥ç®¡ï¼Œæ¶ˆæ¯ä»£ç†ä¿è¯æ¶ˆæ¯ä¼ é€’åˆ°æŒ‡å®šç›®çš„åœ°ã€‚æ¶ˆæ¯é˜Ÿåˆ—ä¸»è¦æœ‰ä¸¤ç§å½¢å¼çš„ç›®çš„åœ°ã€‚ é˜Ÿåˆ—ï¼ˆqueueï¼‰ï¼šç‚¹å¯¹ç‚¹æ¶ˆæ¯é€šä¿¡ï¼ˆpoint-to-pointï¼‰ï¼›ä¸»é¢˜ï¼ˆtopicï¼‰ï¼šå‘å¸ƒï¼ˆpublishï¼‰/ è®¢é˜…ï¼ˆsubscribeï¼‰æ¶ˆæ¯é€šä¿¡ã€‚ åº”ç”¨åœºæ™¯ï¼šå¼‚æ­¥å¤„ç†ï¼ˆé‚®ä»¶ï¼‰ã€åº”ç”¨è§£è€¦ã€æµé‡å‰Šå³°ï¼ˆç§’æ€ï¼‰ã€‚ JMSï¼šJava æ¶ˆæ¯æœåŠ¡ï¼ˆJava Message Serviceï¼‰åº”ç”¨ç¨‹åºæ¥å£æ˜¯ä¸€ä¸ª Java å¹³å°ä¸­å…³äºé¢å‘æ¶ˆæ¯ä¸­é—´ä»¶ï¼ˆMOMï¼‰çš„ APIï¼Œç”¨äºåœ¨ä¸¤ä¸ªåº”ç”¨ç¨‹åºä¹‹é—´ï¼Œæˆ–åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å‘é€æ¶ˆæ¯ï¼Œè¿›è¡Œå¼‚æ­¥é€šä¿¡ã€‚Java æ¶ˆæ¯æœåŠ¡æ˜¯ä¸€ä¸ªä¸å…·ä½“å¹³å°æ— å…³çš„APIï¼Œç»å¤§å¤šæ•° MOM æä¾›å•†éƒ½å¯¹ JMS æä¾›æ”¯æŒã€‚ AMQPï¼šé«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼ˆAdvanced Message Queuing Protocolï¼‰, å¯¹äºé¢å‘æ¶ˆæ¯ä¸­é—´ä»¶çš„åº”ç”¨å±‚åè®®ã€‚ å¸¸è§æ¶ˆæ¯ä¸­é—´ä»¶ActiveMQ Apache ActiveMQ æ˜¯ Apache è½¯ä»¶åŸºé‡‘ä¼šæ‰€ç ”å‘çš„å¼€æ”¾æºä»£ç æ¶ˆæ¯ä¸­é—´ä»¶ã€‚ RabbitMQ RabbitMQ æ˜¯å®ç°äº†é«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼ˆAMQPï¼‰çš„å¼€æºæ¶ˆæ¯ä»£ç†è½¯ä»¶ï¼ˆäº¦ç§°é¢å‘æ¶ˆæ¯çš„ä¸­é—´ä»¶ï¼‰ã€‚RabbitMQ æœåŠ¡å™¨æ˜¯ç”¨ Erlang è¯­è¨€ç¼–å†™çš„ï¼Œ Kafka å‘å¸ƒè®¢é˜…æ¶ˆæ¯ç³»ç»Ÿã€åˆ†å¸ƒå¼æ—¥å¿—æœåŠ¡ã€‚æœ¬èº«æ˜¯åšæ—¥å¿—å‚¨å­˜çš„ï¼Œæ‰€ä»¥å¯¹æ¶ˆæ¯çš„é¡ºåºæœ‰ä¸¥æ ¼çš„è¦æ±‚ã€‚å¼€æºæµå¤„ç†å¹³å°ï¼Œç”± Scala å’Œ java ç¼–å†™ï¼Œç›®æ ‡æ˜¯ä¸ºå¤„ç†å®æ—¶æ•°æ®æä¾›ä¸€ä¸ªç»Ÿä¸€ã€é«˜ååã€ä½å»¶è¿Ÿçš„å¹³å°ã€‚å…¶æŒä¹…åŒ–å±‚æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæŒ‰ç…§åˆ†å¸ƒå¼äº‹åŠ¡æ—¥å¿—æ¶æ„çš„å¤§è§„æ¨¡å‘å¸ƒ / è®¢é˜…æ¶ˆæ¯é˜Ÿåˆ—ã€‚ ç¼–ç æ¥å£JMS ç¼–ç æ¥å£ï¼š ConnectionFactoryï¼šåˆ›å»ºè¿æ¥åˆ°æ¶ˆæ¯ä¸­é—´ä»¶çš„è¿æ¥å·¥å‚ï¼› Connectionï¼šé€šä¿¡é“¾è·¯ï¼› Destinationï¼šæ¶ˆæ¯å‘å¸ƒå’Œæ¥æ”¶çš„åœ°ç‚¹ï¼ŒåŒ…æ‹¬é˜Ÿåˆ—å’Œä¸»é¢˜ï¼› Sessionï¼šä¼šè¯ï¼Œè¡¨ç¤ºä¸€ä¸ªå•çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ï¼› MessageConsumerï¼šä¼šè¯åˆ›å»ºï¼Œç”¨äºæ¥æ”¶æ¶ˆæ¯ï¼› MessageProducerï¼šä¼šè¯åˆ›å»ºï¼Œç”¨äºå‘é€æ¶ˆæ¯ï¼› Messageï¼šæ¶ˆæ¯å¯¹è±¡ï¼ŒåŒ…æ‹¬æ¶ˆæ¯å¤´ï¼Œæ¶ˆæ¯å±æ€§ï¼Œæ¶ˆæ¯ä½“ã€‚ ä¸€ä¸ª Connection å¯ä»¥åˆ›å»ºå¤šä¸ªä¼šè¯ï¼Œå³ä¸€ä¸ªè¿æ¥å¯ä»¥ä¾›å¤šä¸ªçº¿ç¨‹ä½¿ç”¨ã€‚ Spring æ”¯æŒ spring-jms æä¾›äº†å¯¹ JMS çš„æ”¯æŒï¼›spring-rabbit æä¾›äº†å¯¹ AMQP çš„æ”¯æŒã€‚ éœ€è¦ ConnectionFactory çš„å®ç°æ¥è¿æ¥æ¶ˆæ¯ä»£ç†ï¼› æä¾› JmsTemplateã€RabbitTemplate æ¥å‘é€æ¶ˆæ¯ï¼› @JmsListenerï¼ˆJMSï¼‰ã€@RabbitListenerï¼ˆAMQPï¼‰æ³¨è§£åœ¨æ–¹æ³•ä¸Šç›‘å¬æ¶ˆæ¯ä»£ç†å‘å¸ƒçš„æ¶ˆæ¯ï¼› @EnableJmsã€@EnableRabbit å¼€å¯æ”¯æŒã€‚ Spring Boot è‡ªåŠ¨é…ç½® JmsAutoConfigurationã€RabbitAutoConfiguration RabbitMQæ ¸å¿ƒæ¦‚å¿µMessage æ¶ˆæ¯ï¼šæ¶ˆæ¯æ˜¯ä¸å…·åçš„ï¼Œå®ƒç”±æ¶ˆæ¯å¤´å’Œæ¶ˆæ¯ä½“ç»„æˆã€‚æ¶ˆæ¯ä½“æ˜¯ä¸é€æ˜çš„ï¼Œè€Œæ¶ˆæ¯å¤´åˆ™ç”±ä¸€ç³»åˆ—çš„å¯é€‰å±æ€§ç»„æˆï¼Œè¿™äº›å±æ€§åŒ…æ‹¬ routing-keyï¼ˆè·¯ç”±é”®ï¼‰ã€priorityï¼ˆç›¸å¯¹äºå…¶ä»–æ¶ˆæ¯çš„ä¼˜å…ˆæƒï¼‰ã€delivery-modeï¼ˆæŒ‡å‡ºè¯¥æ¶ˆæ¯å¯èƒ½éœ€è¦æŒä¹…æ€§å­˜å‚¨ï¼‰ç­‰ã€‚ Publisher æ¶ˆæ¯çš„ç”Ÿäº§è€…ï¼šæ˜¯ä¸€ä¸ªå‘äº¤æ¢å™¨å‘å¸ƒæ¶ˆæ¯çš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºã€‚ Exchange äº¤æ¢å™¨ï¼šç”¨æ¥æ¥æ”¶ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯å¹¶å°†è¿™äº›æ¶ˆæ¯è·¯ç”±ç»™æœåŠ¡å™¨ä¸­çš„é˜Ÿåˆ—ã€‚Exchange æœ‰ 4 ç§ç±»å‹ï¼šdirectï¼ˆé»˜è®¤ï¼šrouting key = binding keyï¼‰ã€fanoutï¼ˆå¹¿æ’­ï¼‰ã€ topic,ã€å’Œ headersï¼ˆåŒ¹é…æ¶ˆæ¯çš„ Header è€Œä¸æ˜¯è·¯ç”±é”®ï¼‰ï¼Œä¸åŒç±»å‹çš„ Exchange è½¬å‘æ¶ˆæ¯çš„ç­–ç•¥æœ‰æ‰€åŒºåˆ«ã€‚ topic äº¤æ¢å™¨é€šè¿‡æ¨¡å¼åŒ¹é…åˆ†é…æ¶ˆæ¯çš„è·¯ç”±é”®å±æ€§ï¼Œå°†è·¯ç”±é”®å’ŒæŸä¸ªæ¨¡å¼è¿›è¡ŒåŒ¹é…ï¼Œæ­¤æ—¶é˜Ÿåˆ—éœ€è¦ç»‘å®šåˆ°ä¸€ä¸ªæ¨¡å¼ä¸Šã€‚å®ƒå°†è·¯ç”±é”®å’Œç»‘å®šé”®çš„å­—ç¬¦ä¸²åˆ‡åˆ†æˆå•è¯ï¼Œè¿™äº›å•è¯ä¹‹é—´ç”¨ç‚¹éš”å¼€ã€‚å®ƒåŒæ ·ä¹Ÿä¼šè¯†åˆ«ä¸¤ä¸ªé€šé…ç¬¦ï¼š # åŒ¹é… 0 ä¸ªæˆ–å¤šä¸ªå•è¯ï¼›*åŒ¹é…ä¸€ä¸ªå•è¯ã€‚ Queue æ¶ˆæ¯é˜Ÿåˆ—ï¼šç”¨æ¥ä¿å­˜æ¶ˆæ¯ç›´åˆ°å‘é€ç»™æ¶ˆè´¹è€…ã€‚å®ƒæ˜¯æ¶ˆæ¯çš„å®¹å™¨ï¼Œä¹Ÿæ˜¯æ¶ˆæ¯çš„ç»ˆç‚¹ã€‚ä¸€ä¸ªæ¶ˆæ¯å¯æŠ•å…¥ä¸€ä¸ªæˆ–å¤šä¸ªé˜Ÿåˆ—ã€‚æ¶ˆæ¯ä¸€ç›´åœ¨é˜Ÿåˆ—é‡Œé¢ï¼Œç­‰å¾…æ¶ˆè´¹è€…è¿æ¥åˆ°è¿™ä¸ªé˜Ÿåˆ—å°†å…¶å–èµ°ã€‚ Binding ç»‘å®šï¼šç”¨äºæ¶ˆæ¯é˜Ÿåˆ—å’Œäº¤æ¢å™¨ä¹‹é—´çš„å…³è”ã€‚ä¸€ä¸ªç»‘å®šå°±æ˜¯åŸºäºè·¯ç”±é”®å°†äº¤æ¢å™¨å’Œæ¶ˆæ¯é˜Ÿåˆ—è¿æ¥èµ·æ¥çš„è·¯ç”±è§„åˆ™ï¼Œæ‰€ä»¥å¯ä»¥å°†äº¤æ¢å™¨ç†è§£æˆä¸€ä¸ªç”±ç»‘å®šæ„æˆçš„è·¯ç”±è¡¨ã€‚ Exchange å’Œ Queue çš„ç»‘å®šå¯ä»¥æ˜¯å¤šå¯¹å¤šçš„å…³ç³»ã€‚ Connection ç½‘ç»œè¿æ¥ï¼šæ¯”å¦‚ä¸€ä¸ªTCPè¿æ¥ã€‚ Channel ä¿¡é“ï¼šå¤šè·¯å¤ç”¨è¿æ¥ä¸­çš„ä¸€æ¡ç‹¬ç«‹çš„åŒå‘æ•°æ®æµé€šé“ã€‚ä¿¡é“æ˜¯å»ºç«‹åœ¨çœŸå®çš„ TCP è¿æ¥å†…çš„è™šæ‹Ÿè¿æ¥ï¼ŒAMQP å‘½ä»¤éƒ½æ˜¯é€šè¿‡ä¿¡é“å‘å‡ºå»çš„ï¼Œä¸ç®¡æ˜¯å‘å¸ƒæ¶ˆæ¯ã€è®¢é˜…é˜Ÿåˆ—è¿˜æ˜¯æ¥æ”¶æ¶ˆæ¯ï¼Œè¿™äº›åŠ¨ä½œéƒ½æ˜¯é€šè¿‡ä¿¡é“å®Œæˆã€‚å› ä¸ºå¯¹äºæ“ä½œç³»ç»Ÿæ¥è¯´å»ºç«‹å’Œé”€æ¯ TCP éƒ½æ˜¯éå¸¸æ˜‚è´µçš„å¼€é”€ï¼Œæ‰€ä»¥å¼•å…¥äº†ä¿¡é“çš„æ¦‚å¿µï¼Œä»¥å¤ç”¨ä¸€æ¡ TCP è¿æ¥ã€‚ Consumeræ¶ˆæ¯çš„æ¶ˆè´¹è€…ï¼šè¡¨ç¤ºä¸€ä¸ªä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­å–å¾—æ¶ˆæ¯çš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºã€‚ Virtual Host è™šæ‹Ÿä¸»æœºï¼Œè¡¨ç¤ºä¸€æ‰¹äº¤æ¢å™¨ã€æ¶ˆæ¯é˜Ÿåˆ—å’Œç›¸å…³å¯¹è±¡ã€‚è™šæ‹Ÿä¸»æœºæ˜¯å…±äº«ç›¸åŒçš„èº«ä»½è®¤è¯å’ŒåŠ å¯†ç¯å¢ƒçš„ç‹¬ç«‹æœåŠ¡å™¨åŸŸã€‚æ¯ä¸ª vhost æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ª mini ç‰ˆçš„ RabbitMQ æœåŠ¡å™¨ï¼Œæ‹¥æœ‰è‡ªå·±çš„é˜Ÿåˆ—ã€äº¤æ¢å™¨ã€ç»‘å®šå’Œæƒé™æœºåˆ¶ã€‚vhost æ˜¯ AMQP æ¦‚å¿µçš„åŸºç¡€ï¼Œå¿…é¡»åœ¨è¿æ¥æ—¶æŒ‡å®šï¼ŒRabbitMQ é»˜è®¤çš„ vhost æ˜¯ / ã€‚ Broker è¡¨ç¤ºæ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡å™¨å®ä½“ã€‚ RabbitMQ æ•´åˆå¯¼å…¥æ¨¡å—ä¾èµ–çš„ starterï¼š 12345678&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-amqp&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;&lt;/dependency&gt; Spring Boot é…ç½®ï¼š 123456## é…ç½® rabbitMq æœåŠ¡å™¨rabbitmq: host: 127.0.0.1 port: 5672 username: root password: root é…ç½®ä¸€ä¸ªç›´è¿å‹çš„äº¤æ¢æœºï¼š 123456789101112131415161718192021@Configurationpublic class DirectRabbitConfig &#123; // åˆå§‹åŒ–é˜Ÿåˆ—åï¼šTestDirectQueue @Bean public Queue TestDirectQueue() &#123; return new Queue(\"TestDirectQueue\",true); // true æŒä¹…åŒ– &#125; // åˆå§‹åŒ– Direct äº¤æ¢æœºï¼šTestDirectExchange @Bean DirectExchange TestDirectExchange() &#123; return new DirectExchange(\"TestDirectExchange\"); &#125; // å®šä¹‰é˜Ÿåˆ—å’Œäº¤æ¢æœºç»‘å®š, å¹¶è®¾ç½®ç”¨äºåŒ¹é…é”®ï¼šTestDirectRouting @Bean Binding bindingDirect() &#123; return BindingBuilder.bind(TestDirectQueue()).to(TestDirectExchange()).with(\"TestDirectRouting\"); &#125;&#125; å†™ä¸ªç®€å•çš„æ¥å£è¿›è¡Œæ¶ˆæ¯æ¨é€ï¼ˆæ ¹æ®éœ€æ±‚ä¹Ÿå¯ä»¥æ”¹ä¸ºå®šæ—¶ä»»åŠ¡ç­‰ç­‰ï¼Œå…·ä½“çœ‹éœ€æ±‚ï¼‰ï¼š 1234567891011121314151617181920@RestControllerpublic class SendMessageController &#123; @Autowired RabbitTemplate rabbitTemplate; // ä½¿ç”¨ RabbitTemplateï¼šæä¾›äº†æ¥æ”¶ / å‘é€ç­‰æ–¹æ³• @GetMapping(\"/sendDirectMessage\") public String sendDirectMessage() &#123; String messageId = String.valueOf(UUID.randomUUID()); String messageData = \"test message, hello!\"; String createTime = LocalDateTime.now().format(DateTimeFormatter.ofPattern(\"yyyy-MM-dd HH:mm:ss\")); Map&lt;String,Object&gt; map = new HashMap&lt;&gt;(); map.put(\"messageId\",messageId); map.put(\"messageData\",messageData); map.put(\"createTime\",createTime); // å°†æ¶ˆæ¯æºå¸¦ç»‘å®šé”®å€¼ TestDirectRouting å‘é€åˆ°äº¤æ¢æœº TestDirectExchange rabbitTemplate.convertAndSend(\"TestDirectExchange\", \"TestDirectRouting\", map); return \"ok\"; &#125;&#125; consumer åˆ›å»ºä¸€ä¸ªæ¶ˆè´¹è€…é¡¹ç›®ï¼Œæ¶ˆè´¹è€…è¿›è¡Œæ¶ˆæ¯ç›‘å¬ï¼Œéœ€è¦æ‰‹åŠ¨åˆ›å»ºæ¶ˆæ¯æ¥æ”¶çš„ç›‘å¬ç±»ã€‚ 123456789@Component@RabbitListener(queues = \"TestDirectQueue\") // ç›‘å¬çš„é˜Ÿåˆ—åç§° TestDirectQueuepublic class DirectReceiver &#123; @RabbitHandler public void process(Map testMessage) &#123; System.out.println(\"DirectReceiver æ¶ˆè´¹è€…æ”¶åˆ°æ¶ˆæ¯: \" + testMessage.toString()); &#125;&#125; å›è°ƒå‡½æ•°12345678910111213141516171819202122232425262728293031323334@Configurationpublic class RabbitConfig &#123; @Bean public RabbitTemplate createRabbitTemplate(ConnectionFactory connectionFactory)&#123; RabbitTemplate rabbitTemplate = new RabbitTemplate(); rabbitTemplate.setConnectionFactory(connectionFactory); // è®¾ç½®å¼€å¯ Mandatory æ‰èƒ½è§¦å‘å›è°ƒå‡½æ•°ï¼Œæ— è®ºæ¶ˆæ¯æ¨é€ç»“æœæ€ä¹ˆæ ·éƒ½å¼ºåˆ¶è°ƒç”¨å›è°ƒå‡½æ•° rabbitTemplate.setMandatory(true); // äº¤æ¢æœºç›¸å…³ä¿¡æ¯ rabbitTemplate.setConfirmCallback(new RabbitTemplate.ConfirmCallback() &#123; @Override public void confirm(CorrelationData correlationData, boolean ack, String cause) &#123; System.out.println(\"ConfirmCallback: \"+\"ç›¸å…³æ•°æ®ï¼š\"+correlationData); System.out.println(\"ConfirmCallback: \"+\"ç¡®è®¤æƒ…å†µï¼š\"+ack); System.out.println(\"ConfirmCallback: \"+\"åŸå› ï¼š\"+cause); &#125; &#125;); // é˜Ÿåˆ—ç›¸å…³ä¿¡æ¯ rabbitTemplate.setReturnCallback(new RabbitTemplate.ReturnCallback() &#123; @Override public void returnedMessage(Message message, int replyCode, String replyText, String exchange, String routingKey) &#123; System.out.println(\"ReturnCallback: \"+\"æ¶ˆæ¯ï¼š\"+message); System.out.println(\"ReturnCallback: \"+\"å›åº”ç ï¼š\"+replyCode); System.out.println(\"ReturnCallback: \"+\"å›åº”ä¿¡æ¯ï¼š\"+replyText); System.out.println(\"ReturnCallback: \"+\"äº¤æ¢æœºï¼š\"+exchange); System.out.println(\"ReturnCallback: \"+\"è·¯ç”±é”®ï¼š\"+routingKey); &#125; &#125;); return rabbitTemplate; &#125;&#125;","categories":[{"name":"Java","slug":"Java","permalink":"http://yoursite.com/categories/Java/"}],"tags":[{"name":"MQ","slug":"MQ","permalink":"http://yoursite.com/tags/MQ/"},{"name":"Springboot","slug":"Springboot","permalink":"http://yoursite.com/tags/Springboot/"}]},{"title":"Spring Boot ç¼“å­˜","slug":"Spring Boot/Spring Boot ç¼“å­˜","date":"2020-03-31T01:59:45.000Z","updated":"2020-04-19T06:43:27.077Z","comments":true,"path":"2020/03/31/Spring Boot/Spring Boot ç¼“å­˜/","link":"","permalink":"http://yoursite.com/2020/03/31/Spring%20Boot/Spring%20Boot%20%E7%BC%93%E5%AD%98/","excerpt":"JSR107ã€Spring ç¼“å­˜æŠ½è±¡ã€‚","text":"JSR107ã€Spring ç¼“å­˜æŠ½è±¡ã€‚ JRS107 Java Caching å®šä¹‰äº† 5 ä¸ªæ ¸å¿ƒæ¥å£ï¼Œåˆ†åˆ«æ˜¯ CachingProvider, CacheManager, Cache, Entry å’Œ Expiryã€‚ â€¢ CachingProviderï¼šå®šä¹‰äº†åˆ›å»ºã€é…ç½®ã€è·å–ã€ç®¡ç†å’Œæ§åˆ¶å¤šä¸ª CacheManagerã€‚ä¸€ä¸ªåº”ç”¨å¯ä»¥åœ¨è¿è¡ŒæœŸè®¿é—®å¤šä¸ª CachingProviderï¼› â€¢ CacheManagerï¼šå®šä¹‰äº†åˆ›å»ºã€é…ç½®ã€è·å–ã€ç®¡ç†å’Œæ§åˆ¶å¤šä¸ªå”¯ä¸€å‘½åçš„ Cacheï¼Œè¿™äº› Cacheå­˜åœ¨äº CacheManager çš„ä¸Šä¸‹æ–‡ä¸­ã€‚ä¸€ä¸ª CacheManager ä»…è¢«ä¸€ä¸ª CachingProvider æ‰€æ‹¥æœ‰ï¼› â€¢ Cacheï¼šæ˜¯ä¸€ä¸ªç±»ä¼¼ Map çš„æ•°æ®ç»“æ„å¹¶ä¸´æ—¶å­˜å‚¨ä»¥ Key ä¸ºç´¢å¼•çš„å€¼ã€‚ä¸€ä¸ª Cache ä»…è¢«ä¸€ä¸ª CacheManager æ‰€æ‹¥æœ‰ï¼› â€¢ Entryï¼šæ˜¯ä¸€ä¸ªå­˜å‚¨åœ¨ Cache ä¸­çš„ key-value å¯¹ï¼› â€¢ Expiryï¼šæ¯ä¸€ä¸ªå­˜å‚¨åœ¨ Cache ä¸­çš„æ¡ç›®æœ‰ä¸€ä¸ªå®šä¹‰çš„æœ‰æ•ˆæœŸã€‚ä¸€æ—¦è¶…è¿‡è¿™ä¸ªæ—¶é—´ï¼Œæ¡ç›®ä¸ºè¿‡æœŸçš„çŠ¶æ€ã€‚ä¸€æ—¦è¿‡æœŸï¼Œæ¡ç›®å°†ä¸å¯è®¿é—®ã€æ›´æ–°å’Œåˆ é™¤ã€‚ç¼“å­˜æœ‰æ•ˆæœŸå¯ä»¥é€šè¿‡ExpiryPolicyè®¾ç½®ã€‚ Spring ç¼“å­˜æŠ½è±¡Spring 3.1 ä»¥ä¸Šç‰ˆæœ¬å®šä¹‰äº† org.springframework.cache.Cache å’Œ org.springframework.cache.CacheManager æ¥å£æ¥ç»Ÿä¸€ä¸åŒçš„ç¼“å­˜æŠ€æœ¯ï¼›å¹¶æ”¯æŒä½¿ç”¨ JCacheï¼ˆJSR-107ï¼‰æ³¨è§£ç®€åŒ–æˆ‘ä»¬å¼€å‘ã€‚ Cache æ¥å£ä¸ºç¼“å­˜çš„ç»„ä»¶è§„èŒƒå®šä¹‰ï¼ŒåŒ…å«ç¼“å­˜çš„å„ç§æ“ä½œé›†åˆï¼›Cache æ¥å£ä¸‹ Spring æä¾›äº†å„ç§ xxxCache çš„å®ç°ï¼›å¦‚ RedisCacheã€EhCacheCache ã€ConcurrentMapCacheç­‰ã€‚ æ¯æ¬¡è°ƒç”¨éœ€è¦ç¼“å­˜åŠŸèƒ½çš„æ–¹æ³•æ—¶ï¼ŒSpring ä¼šæ£€æŸ¥æ£€æŸ¥æŒ‡å®šå‚æ•°çš„æŒ‡å®šçš„ç›®æ ‡æ–¹æ³•æ˜¯å¦å·²ç»è¢«è°ƒç”¨è¿‡ï¼šå¦‚æœæœ‰å°±ç›´æ¥ä»ç¼“å­˜ä¸­è·å–æ–¹æ³•è°ƒç”¨åçš„ç»“æœï¼Œå¦‚æœæ²¡æœ‰å°±è°ƒç”¨æ–¹æ³•å¹¶ç¼“å­˜ç»“æœåè¿”å›ç»™ç”¨æˆ·ã€‚ä¸‹æ¬¡è°ƒç”¨ç›´æ¥ä»ç¼“å­˜ä¸­è·å–ã€‚ ç¡®å®šæ–¹æ³•éœ€è¦è¢«ç¼“å­˜ä»¥åŠä»–ä»¬çš„ç¼“å­˜ç­–ç•¥ï¼›ä»ç¼“å­˜ä¸­è¯»å–ä¹‹å‰ç¼“å­˜å­˜å‚¨çš„æ•°æ®ã€‚ æ³¨è§£åŸºæœ¬æµç¨‹æ·»åŠ ç¼“å­˜æ¨¡å—çš„ staterï¼š 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-cache&lt;/artifactId&gt;&lt;/dependency&gt; å¼•å…¥ Redis çš„ starterï¼Œå®¹å™¨ä¸­é»˜è®¤ä¿å­˜çš„æ˜¯ RedisCacheManagerã€‚RedisCacheManager è´Ÿè´£åˆ›å»ºRedisCacheï¼ŒRedisCache è´Ÿè´£æ“ä½œ Redis ç¼“å­˜æ•°æ®ã€‚é»˜è®¤ä¿å­˜æ•°æ® Key / Value éƒ½æ˜¯ Objectï¼Œé»˜è®¤ä½¿ç”¨çš„æ˜¯ JDK åºåˆ—åŒ–å™¨ã€‚ åœ¨ Spring Boot ä¸»ç±»ä¸­æ·»åŠ  EnableCaching æ³¨è§£å¼€å¯ç¼“å­˜åŠŸèƒ½ï¼š 1234567@SpringBootApplication@EnableCachingpublic class Application &#123; public static void main(String[] args) &#123; SpringApplication.run(Application.class, args); &#125;&#125; åœ¨ç±»ä¸Šæ·»åŠ CacheConfigè¿›è¡Œç¼“å­˜é…ç½®ï¼›åœ¨æ–¹æ³•ä¸Šæ·»åŠ @Cacheableï¼Œæ ‡æ³¨æ­¤æ–¹æ³•è¿”å›å€¼éœ€è¦è¢«ç¼“å­˜ã€‚ 12345@CacheConfig(cacheNames = \"users\")public interface UserRepository extends JpaRepository&lt;User, Long&gt; &#123; @Cacheable User findByName(String name);&#125; æ³¨è§£è¯¦è§£@CacheConfigï¼šä¸»è¦ç”¨äºé…ç½®è¯¥ç±»ä¸­ä¼šç”¨åˆ°çš„ä¸€äº›å…±ç”¨çš„ç¼“å­˜é…ç½®ã€‚åœ¨è¿™é‡Œ@CacheConfig(cacheNames = &quot;users&quot;)ï¼šé…ç½®äº†è¯¥æ•°æ®è®¿é—®å¯¹è±¡ä¸­è¿”å›çš„å†…å®¹å°†å­˜å‚¨äºåä¸º users çš„ç¼“å­˜å¯¹è±¡ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸ä½¿ç”¨è¯¥æ³¨è§£ï¼Œç›´æ¥é€šè¿‡@Cacheableè‡ªå·±é…ç½®ç¼“å­˜é›†çš„åå­—æ¥å®šä¹‰ã€‚ @Cacheableï¼šé…ç½®äº† findByName å‡½æ•°çš„è¿”å›å€¼å°†è¢«åŠ å…¥ç¼“å­˜ã€‚åŒæ—¶åœ¨æŸ¥è¯¢æ—¶ï¼Œä¼šå…ˆä»ç¼“å­˜ä¸­è·å–ï¼Œè‹¥ä¸å­˜åœ¨æ‰å†å‘èµ·å¯¹æ•°æ®åº“çš„è®¿é—®ã€‚è¯¥æ³¨è§£ä¸»è¦æœ‰ä¸‹é¢å‡ ä¸ªå‚æ•°ï¼š valueã€cacheNamesï¼šä¸¤ä¸ªç­‰åŒçš„å‚æ•°ï¼ˆcacheNamesä¸º Spring 4 æ–°å¢ï¼Œä½œä¸ºvalueçš„åˆ«åï¼‰ï¼Œç”¨äºæŒ‡å®šç¼“å­˜å­˜å‚¨çš„é›†åˆåã€‚ç”±äº Spring 4 ä¸­æ–°å¢äº†@CacheConfigï¼Œå› æ­¤åœ¨ Spring 3 ä¸­åŸæœ¬å¿…é¡»æœ‰çš„valueå±æ€§ï¼Œä¹Ÿæˆä¸ºéå¿…éœ€é¡¹äº†ï¼› keyï¼šç¼“å­˜å¯¹è±¡å­˜å‚¨åœ¨ Map é›†åˆä¸­çš„ key å€¼ï¼Œéå¿…éœ€ï¼Œç¼ºçœæŒ‰ç…§å‡½æ•°çš„æ‰€æœ‰å‚æ•°ç»„åˆä½œä¸º key å€¼ï¼Œè‹¥è‡ªå·±é…ç½®éœ€ä½¿ç”¨ SpEL è¡¨è¾¾å¼ï¼Œæ¯”å¦‚ï¼š@Cacheable(key = &quot;#p0&quot;)ï¼šä½¿ç”¨å‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºç¼“å­˜çš„ key å€¼ï¼Œæ›´å¤šå…³äº SpEL è¡¨è¾¾å¼çš„è¯¦ç»†å†…å®¹å¯å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼› conditionï¼šç¼“å­˜å¯¹è±¡çš„æ¡ä»¶ï¼Œéå¿…éœ€ï¼Œä¹Ÿéœ€ä½¿ç”¨ SpEL è¡¨è¾¾å¼ï¼Œåªæœ‰æ»¡è¶³è¡¨è¾¾å¼æ¡ä»¶çš„å†…å®¹æ‰ä¼šè¢«ç¼“å­˜ï¼Œæ¯”å¦‚ï¼š@Cacheable(key = &quot;#p0&quot;, condition = &quot;#p0.length() &lt; 3&quot;)ï¼Œè¡¨ç¤ºåªæœ‰å½“ç¬¬ä¸€ä¸ªå‚æ•°çš„é•¿åº¦å°äº3çš„æ—¶å€™æ‰ä¼šè¢«ç¼“å­˜ï¼› unlessï¼šå¦å¤–ä¸€ä¸ªç¼“å­˜æ¡ä»¶å‚æ•°ï¼Œéå¿…éœ€ï¼Œéœ€ä½¿ç”¨ SpEL è¡¨è¾¾å¼ã€‚å®ƒä¸åŒäºconditionå‚æ•°çš„åœ°æ–¹åœ¨äºå®ƒçš„åˆ¤æ–­æ—¶æœºï¼Œè¯¥æ¡ä»¶æ˜¯åœ¨å‡½æ•°è¢«è°ƒç”¨ä¹‹åæ‰åšåˆ¤æ–­çš„ï¼Œæ‰€ä»¥å®ƒå¯ä»¥é€šè¿‡å¯¹ result è¿›è¡Œåˆ¤æ–­ï¼› keyGeneratorï¼šç”¨äºæŒ‡å®š key ç”Ÿæˆå™¨ï¼Œéå¿…éœ€ã€‚è‹¥éœ€è¦æŒ‡å®šä¸€ä¸ªè‡ªå®šä¹‰çš„ key ç”Ÿæˆå™¨ï¼Œéœ€è¦å¼€å‘è€…å®ç°org.springframework.cache.interceptor.KeyGeneratoræ¥å£ï¼Œå¹¶ä½¿ç”¨è¯¥å‚æ•°æ¥æŒ‡å®šã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼šè¯¥å‚æ•°ä¸keyæ˜¯äº’æ–¥çš„ï¼› cacheManagerï¼šç”¨äºæŒ‡å®šä½¿ç”¨å“ªä¸ªç¼“å­˜ç®¡ç†å™¨ï¼Œéå¿…éœ€ã€‚åªæœ‰å½“æœ‰å¤šä¸ªæ—¶æ‰éœ€è¦ä½¿ç”¨ï¼› cacheResolverï¼šç”¨äºæŒ‡å®šä½¿ç”¨é‚£ä¸ªç¼“å­˜è§£æå™¨ï¼Œéå¿…éœ€ã€‚éœ€é€šè¿‡org.springframework.cache.interceptor.CacheResolveræ¥å£æ¥å®ç°è‡ªå·±çš„ç¼“å­˜è§£æå™¨ï¼Œå¹¶ç”¨è¯¥å‚æ•°æŒ‡å®šã€‚ @CachePutï¼šé…ç½®äºå‡½æ•°ä¸Šï¼Œèƒ½å¤Ÿæ ¹æ®å‚æ•°å®šä¹‰æ¡ä»¶æ¥è¿›è¡Œç¼“å­˜ï¼Œå®ƒä¸@Cacheableä¸åŒçš„æ˜¯ï¼Œå®ƒæ¯æ¬¡éƒ½ä¼šçœŸå®è°ƒç”¨å‡½æ•°ï¼Œæ‰€ä»¥ä¸»è¦ç”¨äºæ•°æ®æ–°å¢å’Œä¿®æ”¹æ“ä½œä¸Šã€‚å®ƒçš„å‚æ•°ä¸@Cacheableç±»ä¼¼ï¼Œå…·ä½“åŠŸèƒ½å¯å‚è€ƒä¸Šé¢å¯¹@Cacheableå‚æ•°çš„è§£æã€‚ @CacheEvictï¼šé…ç½®äºå‡½æ•°ä¸Šï¼Œé€šå¸¸ç”¨åœ¨åˆ é™¤æ–¹æ³•ä¸Šï¼Œç”¨æ¥ä»ç¼“å­˜ä¸­ç§»é™¤ç›¸åº”æ•°æ®ã€‚é™¤äº†åŒ@Cacheableä¸€æ ·çš„å‚æ•°ä¹‹å¤–ï¼Œå®ƒè¿˜æœ‰ä¸‹é¢ä¸¤ä¸ªå‚æ•°ï¼š allEntriesï¼šéå¿…éœ€ï¼Œé»˜è®¤ä¸º falseã€‚å½“ä¸º true æ—¶ï¼Œä¼šç§»é™¤æ‰€æœ‰æ•°æ®ï¼› beforeInvocationï¼šéå¿…éœ€ï¼Œé»˜è®¤ä¸º falseï¼Œä¼šåœ¨è°ƒç”¨æ–¹æ³•ä¹‹åç§»é™¤æ•°æ®ã€‚å½“ä¸º true æ—¶ï¼Œä¼šåœ¨è°ƒç”¨æ–¹æ³•ä¹‹å‰ç§»é™¤æ•°æ®ã€‚ TemplateSpring Boot æä¾›äº†å¸®åŠ©æ“ä½œ Redis çš„ Helper ç±» RedisTemplateï¼šRedisTemplateçš„ K:V å‡ä¸º Objectï¼›StringRedisTemplate ç»§æ‰¿è‡ª RedisTemplateï¼Œæ˜¯ä¸“ä¸º String:String ç±»å‹çš„ K:V æä¾›æœåŠ¡ã€‚ åœ¨ RedisAutoConfiguration ä¸­ Spring Boot è‡ªåŠ¨æ³¨å†Œäº† RedisTemplate å’Œ StringRedisTemplateã€‚ æ•°æ®æ“ä½œ Redis ä¸­å¸¸è§çš„äº”å¤§ç±»æ•°æ®ç±»å‹ï¼šStringï¼ŒListï¼ŒSetï¼ŒHash å’Œ ZSetã€‚ RedisTemplate å°è£…äº†å¯¹äº”å¤§ç±»æ•°æ®è¿›è¡Œæ“ä½œçš„æ–¹æ³•ï¼Œæ¯ä¸€ä¸ªæ–¹æ³•éƒ½ä¼šè¿”å›ä¸€ä¸ª Operations å¯¹è±¡ã€‚ 123456789RedisTemplate.opsForValue(); // StringRedisTemplate.opsForList();RedisTemplate.opsForSet();RedisTemplate.opsForHash();RedisTemplate.opsForZSet(); Redis å®ç°ç¼“å­˜å…¥é—¨åŸºç¡€ String æœ€åŸºç¡€çš„æ•°æ®ç±»å‹ï¼›List å…ƒç´ ä¸å…·æœ‰å”¯ä¸€æ€§ï¼›æœ‰åºï¼›æ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼›æ—¢å¯ä»¥æ˜¯æ ˆï¼Œä¹Ÿå¯ä»¥æ˜¯é˜Ÿåˆ—ï¼›Set å…ƒç´ å…·æœ‰å”¯ä¸€æ€§ï¼›æ— åºï¼›Hash å­˜å‚¨çš„æ˜¯key-valueç»“æ„ï¼Œkeyå¿…é¡»æ˜¯stringï¼›ç±»ä¼¼äº MySQL ä¸­çš„ä¸€æ¡è®°å½•ã€‚ Redis å‘½ä»¤æ¥å£ Redis æä¾›äº†è®¸å¤šå‘½ä»¤ä¾›æˆ‘ä»¬ä½¿ç”¨ï¼ŒåŒæ ·åœ¨ Spring Boot ä¸­ä¹Ÿå°è£…äº†å¯¹åº”ç±»å‹çš„å‘½ä»¤æ¥å£ä¾›å¼€å‘è€…ä½¿ç”¨ã€‚ 123456789101112131415161718192021/** * Interface for the commands supported by Redis. * * @author Costin Leau * @author Christoph Strobl */public interface RedisCommands extends RedisKeyCommands, RedisStringCommands, RedisListCommands, RedisSetCommands, RedisZSetCommands, RedisHashCommands, RedisTxCommands, RedisPubSubCommands, RedisConnectionCommands, RedisServerCommands, RedisScriptingCommands, RedisGeoCommands, HyperLogLogCommands &#123; /** * 'Native' or 'raw' execution of the given command along-side the given arguments. The command is executed as is, * with as little 'interpretation' as possible - it is up to the caller to take care of any processing of arguments or * the result. * * @param command Command to execute * @param args Possible command arguments (may be null) * @return execution result. */ Object execute(String command, byte[]... args);&#125; åœ¨ Spring Boot é…ç½®æ–‡ä»¶ä¸­æ·»åŠ  Redis é…ç½®ï¼š 1234567891011121314151617## é»˜è®¤å¯†ç ä¸ºç©ºredis: host: 127.0.0.1 # RedisæœåŠ¡å™¨è¿æ¥ç«¯å£ port: 6379 jedis: pool: # è¿æ¥æ± æœ€å¤§è¿æ¥æ•°ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰ max-active: 100 # è¿æ¥æ± ä¸­çš„æœ€å°ç©ºé—²è¿æ¥ max-idle: 10 # è¿æ¥æ± æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰ max-wait: 100000 # è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ timeout: 5000 # é»˜è®¤æ˜¯ç´¢å¼•ä¸º 0 çš„æ•°æ®åº“ database: 0 ä»£ç ç¤ºä¾‹1234567891011121314151617181920@RunWith(SpringRunner.class)@SpringBootTestpublic class SpringBootCacheApplicationTests &#123; @Autowired EmployeeMapper employeeMapper; @Autowired StringRedisTemplate stringRedisTemplate; @Autowired RedisTemplate redisTemplate; // å‘ Redis ä¸­ä¿å­˜ä¸€ä¸ªå¯¹è±¡å¹¶å–å‡ºæ‰“å° @Test public void test() &#123; Employee employee = employeeMapper.getEmpById(1); redisTemplate.opsForValue().set(\"emp01\",employee); Object emp01 = redisTemplate.opsForValue().get(\"emp01\"); System.out.println(emp01); &#125;&#125; æ³¨æ„ï¼ŒRedis ä¸­å¯¹è±¡çš„ä¿å­˜æ˜¯éœ€è¦è¿›è¡Œåºåˆ—åŒ–çš„ï¼Œé»˜è®¤ä½¿ç”¨ JdkSerializationRedisSerializer åºåˆ—åŒ–å™¨ï¼Œæ‰€ä»¥åœ¨ Redis ä¸­æŸ¥çœ‹ä¿å­˜çš„å¯¹è±¡æ˜¯åºåˆ—åŒ–åçš„äºŒè¿›åˆ¶ç¼–ç ï¼Œæ­£å¸¸ä½¿ç”¨æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼ŒæŸ¥è¯¢å‡ºæ¥çš„æ—¶å€™ä¼šè‡ªåŠ¨ååºåˆ—åŒ–ã€‚ å¦‚æœä¹ æƒ¯äºä½¿ç”¨ Stringï¼Œé‚£ä¹ˆå¯ä»¥å°†å…¶ JSON åŒ–ï¼Œä¸¤ç§æ–¹å¼ï¼šä½¿ç”¨ç¬¬ä¸‰æ–¹ JSON æˆ–è€…å‘å®¹å™¨ä¸­æ·»åŠ è‡ªå®šä¹‰ RedisTemplate æ”¹å˜å…¶é»˜è®¤åºåˆ—åŒ–å™¨ã€‚ æ·»åŠ è‡ªå®šä¹‰ RedisTemplateï¼š 123456789101112@Configurationpublic class MyRedisConfig &#123; @Bean public RedisTemplate&lt;Object,Employee&gt; empRedisTemplate(RedisConnectionFactory connectionFactory)&#123; RedisTemplate&lt;Object,Employee&gt; template = new RedisTemplate&lt;Object, Employee&gt;(); template.setConnectionFactory(connectionFactory); Jackson2JsonRedisSerializer&lt;Employee&gt; serializer = new Jackson2JsonRedisSerializer&lt;Employee&gt;(Employee.class); template.setDefaultSerializer(serializer); return template; &#125;&#125; Lettuce Jedis åœ¨å®ç°ä¸Šæ˜¯ç›´æ¥è¿æ¥ Redis æœåŠ¡å™¨ï¼Œåœ¨å¤šä¸ªçº¿ç¨‹é—´å…±äº«ä¸€ä¸ª Jedis å®ä¾‹æ—¶æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œå¦‚æœæƒ³è¦åœ¨å¤šçº¿ç¨‹åœºæ™¯ä¸‹ä½¿ç”¨ Jedis ï¼Œéœ€è¦ä½¿ç”¨è¿æ¥æ± ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½ä½¿ç”¨è‡ªå·±çš„ Jedis å®ä¾‹ï¼Œå½“è¿æ¥æ•°é‡å¢å¤šæ—¶ï¼Œä¼šæ¶ˆè€—è¾ƒå¤šçš„ç‰©ç†èµ„æºã€‚ ä¸ Jedis ç›¸æ¯”ï¼Œ Lettuce åˆ™å®Œå…¨å…‹æœäº†å…¶çº¿ç¨‹ä¸å®‰å…¨çš„ç¼ºç‚¹ï¼š Lettuce æ˜¯ä¸€ä¸ªå¯ä¼¸ç¼©çš„çº¿ç¨‹å®‰å…¨çš„ Redis å®¢æˆ·ç«¯ï¼Œæ”¯æŒåŒæ­¥ã€å¼‚æ­¥å’Œå“åº”å¼æ¨¡å¼ã€‚å¤šä¸ªçº¿ç¨‹å¯ä»¥å…±äº«ä¸€ä¸ªè¿æ¥å®ä¾‹ï¼Œè€Œ ä¸å¿…æ‹…å¿ƒå¤šçº¿ç¨‹å¹¶å‘é—®é¢˜ã€‚å®ƒåŸºäºä¼˜ç§€ Netty NIO æ¡†æ¶æ„å»ºï¼Œæ”¯æŒ Redis çš„æ›´å¤šé«˜çº§åŠŸèƒ½ã€‚ 12345678910&lt;!-- redis è®¿é—®å¯åŠ¨å™¨ --&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;&lt;/dependency&gt;&lt;!-- redis å®¢æˆ·ç«¯ Lettuce æ•°æ®åº“è¿æ¥æ± ä¾èµ– --&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.commons&lt;/groupId&gt; &lt;artifactId&gt;commons-pool2&lt;/artifactId&gt;&lt;/dependency&gt; 123456789101112131415161718# Redisæ•°æ®åº“ç´¢å¼•ï¼ˆé»˜è®¤ä¸º0ï¼‰spring.redis.database=0# RedisæœåŠ¡å™¨åœ°å€ ï¼ˆé»˜è®¤localhostï¼‰spring.redis.host=localhost# RedisæœåŠ¡å™¨è¿æ¥ç«¯å£ ï¼ˆé»˜è®¤6379ï¼‰spring.redis.port=6379# RedisæœåŠ¡å™¨è¿æ¥å¯†ç ï¼ˆé»˜è®¤ä¸ºç©ºï¼‰spring.redis.password=123456# è¿æ¥è¶…æ—¶æ—¶é—´spring.redis.timeout=10000ms# æœ€å¤§è¿æ¥æ•°ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰ é»˜è®¤ 8spring.redis.lettuce.pool.max-active=8# æœ€å°ç©ºé—²è¿æ¥ é»˜è®¤ 0spring.redis.lettuce.pool.min-idle=0# æœ€å¤§ç©ºé—²è¿æ¥ é»˜è®¤ 8spring.redis.lettuce.pool.max-idle=8# æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰ é»˜è®¤ -1msspring.redis.lettuce.pool.max-wait=-1ms ç¼“å­˜åŸç† è¦ä½¿ç”¨ Spring Boot çš„ç¼“å­˜åŠŸèƒ½ï¼Œè¿˜éœ€è¦æä¾›ä¸€ä¸ªç¼“å­˜çš„å…·ä½“å®ç°ã€‚ Spring Boot ä¸€å®šçš„é¡ºåºå»ä¾¦æµ‹ç¼“å­˜å®ç°ã€‚ Spring æä¾›äº†ä¸€ä¸ªç»Ÿä¸€è®¿é—®ç¼“å­˜çš„æ¥å£ï¼šCacheManager ctrl + alt + b å¯æŸ¥çœ‹è¿™ä¸ªæ¥å£çš„å®ç° åœ¨ RedisCacheManager ä¸­æŸ¥çœ‹ Redis ç¼“å­˜çš„é»˜è®¤é…ç½®ç±»ï¼šRedisCacheConfigurationï¼š ä»æºç äº†è§£åˆ° Sping Boot çš„ Reids ç¼“å­˜å¯¹ Key å’Œ Value é»˜è®¤çš„åºåˆ—åŒ–å™¨åˆ†åˆ«æ˜¯ String ç±»å‹å’Œ JDK åºåˆ—å™¨ã€‚ åœ¨ RedisCacheManager ä¸­å¯ä»¥çœ‹åˆ°å¦‚ä½•å®ä¾‹åŒ–è¿™ä¸ªç±»ï¼š å®ä¾‹åŒ–è¿™ä¸ªç±»å¿…é¡»ä¼ å…¥ä¸€ä¸ª connectionFactoryï¼Œç”¨ redis ç¼“å­˜æ‰€ä»¥ä¼ å…¥ä¸€ä¸ª redisConnectionFactoryã€‚ 1234567891011121314@Configurationpublic class CacheConfig &#123; @Autowired private RedisConnectionFactory redisConnectionFactory; /** * SpringCacheManager ç¼“å­˜ç®¡ç†å™¨ï¼šä½¿ç”¨çš„ç¼“å­˜äº§å“æ˜¯Redis * @return */ @Bean(name = \"springCacheManager\") public RedisCacheManager springCacheManager()&#123; RedisCacheManager cacheManager = RedisCacheManager.create(redisConnectionFactory); return cacheManager; &#125;&#125; Redis é…ç½®123456789101112131415161718192021222324252627282930313233@Configurationpublic class RedisConfig &#123; @Autowired private RedisConnectionFactory redisConnectionFactory; @Bean public StringRedisSerializer stringRedisSerializer() &#123; StringRedisSerializer stringRedisSerializer = new StringRedisSerializer(); return stringRedisSerializer; &#125; @Bean public StringRedisTemplate stringRedisTemplate() &#123; StringRedisTemplate stringRedisTemplate =new StringRedisTemplate(); stringRedisTemplate.setConnectionFactory(redisConnectionFactory); // å¼€å¯äº‹åŠ¡æ”¯æŒ stringRedisTemplate.setEnableTransactionSupport(true); return stringRedisTemplate; &#125; @Bean public RedisTemplate redisTemplate()&#123; RedisTemplate&lt;Object,Object&gt; redisTemplate= new RedisTemplate&lt;&gt;(); // åºåˆ—åŒ–å™¨ redisTemplate.setConnectionFactory(redisConnectionFactory); redisTemplate.setKeySerializer(stringRedisSerializer()); //redisTemplate.setHashKeySerializer(stringRedisSerializer()); // å¼€å¯äº‹åŠ¡æ”¯æŒ redisTemplate.setEnableTransactionSupport(true); return redisTemplate; &#125;&#125;","categories":[{"name":"Java","slug":"Java","permalink":"http://yoursite.com/categories/Java/"}],"tags":[{"name":"Springboot","slug":"Springboot","permalink":"http://yoursite.com/tags/Springboot/"},{"name":"Cache","slug":"Cache","permalink":"http://yoursite.com/tags/Cache/"}]},{"title":"MyBatis æ’ä»¶ä¹‹æ‹¦æˆªå™¨","slug":"Software/Mybatis/Mybatis æ’ä»¶ä¹‹æ‹¦æˆªå™¨","date":"2020-03-29T08:18:40.000Z","updated":"2020-04-19T06:41:44.234Z","comments":true,"path":"2020/03/29/Software/Mybatis/Mybatis æ’ä»¶ä¹‹æ‹¦æˆªå™¨/","link":"","permalink":"http://yoursite.com/2020/03/29/Software/Mybatis/Mybatis%20%E6%8F%92%E4%BB%B6%E4%B9%8B%E6%8B%A6%E6%88%AA%E5%99%A8/","excerpt":"MyBatis æ‹¦æˆªå™¨çš„è¯¦ç»†ç”¨æ³•ä»‹ç»ã€‚","text":"MyBatis æ‹¦æˆªå™¨çš„è¯¦ç»†ç”¨æ³•ä»‹ç»ã€‚ åœ¨å¾ˆå¤šä¸šåŠ¡åœºæ™¯ä¸‹æˆ‘ä»¬éœ€è¦å»æ‹¦æˆª SQLï¼Œè¾¾åˆ°ä¸å…¥ä¾µåŸæœ‰ä»£ç ä¸šåŠ¡å¤„ç†ä¸€äº›ä¸œè¥¿ï¼Œæ¯”å¦‚ï¼šåˆ†é¡µæ“ä½œï¼Œæ•°æ®æƒé™è¿‡æ»¤æ“ä½œï¼Œ SQL æ‰§è¡Œæ—¶é—´æ€§èƒ½ç›‘æ§ç­‰ç­‰ã€‚åœ¨æŸäº›åº”ç”¨åœºæ™¯ä¸‹å°±éœ€è¦ä½¿ç”¨åˆ° MyBatis çš„æ‹¦æˆªå™¨ã€‚ Mybatis æ ¸å¿ƒå¯¹è±¡Configuration åˆå§‹åŒ–åŸºç¡€é…ç½®ï¼šæ¯”å¦‚ MyBatis çš„åˆ«åç­‰ï¼Œä¸€äº›é‡è¦çš„ç±»å‹å¯¹è±¡ï¼Œå¦‚ï¼šæ’ä»¶ï¼Œæ˜ å°„å™¨ï¼ŒObjectFactory å’Œ typeHandler å¯¹è±¡ç­‰ï¼ŒMyBatis æ‰€æœ‰çš„é…ç½®ä¿¡æ¯éƒ½ä¿å­˜åœ¨ Configuration å¯¹è±¡ä¹‹ä¸­ï¼› SqlSessionFactory SqlSession å·¥å‚ï¼šSqlSession ä½œä¸º MyBatiså·¥ä½œçš„ä¸»è¦é¡¶å±‚ APIï¼Œè¡¨ç¤ºä¸æ•°æ®åº“äº¤äº’çš„ä¼šè¯ï¼Œå®Œæˆå¿…è¦æ•°æ®åº“å¢åˆ æ”¹æŸ¥åŠŸèƒ½ï¼› Executor MyBatis æ‰§è¡Œå™¨ï¼šæ˜¯ MyBatis è°ƒåº¦çš„æ ¸å¿ƒï¼Œè´Ÿè´£ SQL è¯­å¥çš„ç”Ÿæˆå’ŒæŸ¥è¯¢ç¼“å­˜çš„ç»´æŠ¤ï¼› ParameterHandlerï¼šè´Ÿè´£å¯¹ç”¨æˆ·ä¼ é€’çš„å‚æ•°è½¬æ¢æˆ JDBC Statement æ‰€éœ€è¦çš„å‚æ•°ï¼› ResultSetHandlerï¼š è´Ÿè´£å°† JDBC è¿”å›çš„ ResultSet ç»“æœé›†å¯¹è±¡è½¬æ¢æˆ List ç±»å‹çš„é›†åˆï¼› TypeHandlerï¼šè´Ÿè´£ Java æ•°æ®ç±»å‹å’Œ JDBC æ•°æ®ç±»å‹ä¹‹é—´çš„æ˜ å°„å’Œè½¬æ¢ï¼› MappedStatementï¼šç»´æŠ¤äº†ä¸€æ¡ &lt;select | update | delete | insert&gt; èŠ‚ç‚¹çš„å°è£…ï¼› SqlSourceï¼šè´Ÿè´£æ ¹æ®ç”¨æˆ·ä¼ é€’çš„ parameterObjectï¼ŒåŠ¨æ€åœ°ç”Ÿæˆ SQL è¯­å¥ï¼Œå°†ä¿¡æ¯å°è£…åˆ° BoundSql å¯¹è±¡ä¸­ï¼Œå¹¶è¿”å›ï¼› BoundSqlï¼šè¡¨ç¤ºåŠ¨æ€ç”Ÿæˆçš„ SQL è¯­å¥ä»¥åŠç›¸åº”çš„å‚æ•°ä¿¡æ¯ã€‚ æ‹¦æˆªå™¨åŸç†å®ç°Mybatis æ”¯æŒå¯¹ Executorã€StatementHandlerã€PameterHandler å’Œ ResultSetHandler æ¥å£è¿›è¡Œæ‹¦æˆªï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥å¯¹è¿™ä¸ªå››ç§ç±»å‹çš„å¯¹è±¡è¿›è¡Œä»£ç†ã€‚ æ³¨è§£@Interceptsåœ¨å®ç° Interceptor æ¥å£çš„ç±»å£°æ˜ï¼Œä½¿è¯¥ç±»æ³¨å†Œæˆä¸ºæ‹¦æˆªå™¨ã€‚ @Signature(type = Executor.class,method = &quot;&quot;, args = {) typeï¼šè¡¨ç¤ºæ‹¦æˆªçš„ç±»ï¼Œè¿™é‡Œæ˜¯ Executor çš„å®ç°ç±»ï¼› methodï¼šè¡¨ç¤ºæ‹¦æˆªçš„æ–¹æ³•ï¼Œè¿™é‡Œæ˜¯æ‹¦æˆª Executor çš„ query æ–¹æ³•ï¼› argsï¼šè¡¨ç¤ºæ–¹æ³•å‚æ•°ã€‚ 123456789@Slf4j@Component@Intercepts(&#123;@Signature(type = Executor.class, method = \"update\", args = &#123;MappedStatement.class, Object.class&#125;), @Signature(type = Executor.class, method = \"query\", args = &#123;MappedStatement.class, Object.class, RowBounds.class, ResultHandler.class&#125;)&#125;)public class SqlInterceptor implements Interceptor &#123; private Properties properties; // ...åé¢ç»™å‡ºè¯¦ç»†æ–¹æ³•&#125; intercept æ–¹æ³• è¦æƒ³æ‹¦æˆªç›®æ ‡å¯¹è±¡çš„ç›®æ ‡æ–¹æ³•çš„æ‰§è¡Œï¼Œå¯ä»¥é€šè¿‡ invocation æ¥è·å–æ‹¦æˆªçš„ç›®æ ‡æ–¹æ³•åŠå‚æ•°ï¼Œä»¥åŠæ‰§è¡Œç›®æ ‡æ–¹æ³•ï¼ŒåŒ…å«ä»£ç†çš„å‡ ä¸ªé‡è¦å…ƒç´  methodã€targetã€argsã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124// é€šè¿‡ invocation æ‹¦æˆªç›®æ ‡å¯¹è±¡çš„ç›®æ ‡æ–¹æ³•æ‰§è¡Œä¸­éœ€è¦è¢«æ‰“å°è¾“å‡ºçš„ä¿¡æ¯@Overridepublic Object intercept(Invocation invocation) throws Throwable &#123; // MappedStatement ç»´æŠ¤äº†ä¸€æ¡ mapper.xml æ–‡ä»¶é‡Œé¢ select ã€updateã€deleteã€insert èŠ‚ç‚¹çš„å°è£… MappedStatement mappedStatement = (MappedStatement) invocation.getArgs()[0]; Object parameter = null; if (invocation.getArgs().length &gt; 1) &#123; parameter = invocation.getArgs()[1]; &#125; // å–å¾— SQL æ ‡è¯†ç¬¦ String sqlId = mappedStatement.getId(); // å–å¾—åŠ¨æ€ç”Ÿæˆçš„ SQL è¯­å¥ä»¥åŠç›¸åº”çš„å‚æ•°ä¿¡æ¯å¯¹è±¡ BoundSql boundSql = mappedStatement.getBoundSql(parameter); // å–å¾— Mybatis çš„é…ç½®ä¿¡æ¯ Configuration configuration = mappedStatement.getConfiguration(); Object returnValue = null; long start = System.currentTimeMillis(); // ç»§ç»­æ‰§è¡ŒåŸç›®æ ‡æ–¹æ³• returnValue = invocation.proceed(); // è·å–å®ä½“ç±» Class&lt;?&gt; parameterType = getParameterType(mappedStatement); // åˆ¤æ–­æ˜¯å¦åŒ…å« SQL è¯­å¥æ‰“å°æ³¨è§£ if (!hasSqlPrintAnnotation(parameterType)) &#123; return returnValue; &#125; long end = System.currentTimeMillis(); long time = (end - start); // ç­›é€‰å‡ºæ‰§è¡Œæ—¶é—´è¾ƒé•¿çš„ SQL è¯­å¥ä»¥ä¾¿ä¼˜åŒ– if (time &gt; 1) &#123; // è‡ªå®šä¹‰è¾“å‡ºçš„ SQL è¯­å¥ String sql = getSql(configuration, boundSql, sqlId, time); log.info(sql); &#125; // è¿”å›æ‰§è¡Œåçš„ç»“æœ return returnValue;&#125;// è·å–å®ä½“å¯¹è±¡ç±»private Class&lt;?&gt; getParameterType(MappedStatement statement) &#123; if (statement.getParameterMap() == null || statement.getParameterMap().getType() == null) &#123; return null; &#125; return statement.getParameterMap().getType();&#125;// åˆ¤æ–­å®ä½“ç±»ä¸Šæ˜¯å¦åŒ…å«è‡ªå®šä¹‰çš„ SQl æ‰“å°çš„æ³¨è§£ @SqlPrintprivate static boolean hasSqlPrintAnnotation(Class&lt;?&gt; classType) &#123; return classType == null ? Boolean.FALSE : classType.isAnnotationPresent(SqlPrint.class);&#125;private static String getSql(Configuration configuration, BoundSql boundSql, String sqlId, long time) &#123; String sql = showSql(configuration, boundSql); StringBuilder str = new StringBuilder(100); str.append(sqlId); str.append(\" : \"); // å…·ä½“æ‰§è¡Œçš„ SQL è¯­å¥ str.append(sql); str.append(\" &gt;&gt;&gt;&gt;&gt;&gt; \"); // SQL æ‰§è¡Œçš„æ—¶é—´ str.append(\"SQLæ‰§è¡Œè€—æ—¶: \"); str.append(time); str.append(\"ms\"); return str.toString();&#125;// ç»„è£…éœ€è¦æ‰“å°çš„ SQLprivate static String showSql(Configuration configuration, BoundSql boundSql) &#123; // å–å¾—å‚æ•°çš„å¯¹è±¡ï¼Œå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªå¤šä¸ªå‚æ•°çš„ map ç»“æ„ Object parameterObject = boundSql.getParameterObject(); // æŸ¥è¯¢ SQL ä¸­çš„å‚æ•° List&lt;ParameterMapping&gt; parameterMappings = boundSql.getParameterMappings(); // å°† SQL ä¸­ä¸€ä¸ªæˆ–å¤šä¸ªå›è½¦æ¢è¡Œç¬¦å·æ›¿æ¢æˆä¸€ä¸ªç©ºæ ¼ String sql = boundSql.getSql().replaceAll(\"[\\\\s]+\", \" \"); if (!parameterMappings.isEmpty() &amp;&amp; parameterObject != null) &#123; // Mybatis åœ¨å¯åŠ¨æ—¶å°±ä¼šé€šè¿‡ TypeHandlerRegistry è¿›è¡Œæ³¨å†Œï¼Œå³å»ºç«‹ JdbcType, JavaType, TypeHandler ä¸‰è€…ä¹‹é—´çš„å…³ç³»ã€‚ // å› æ­¤ï¼Œè¿™æ„å‘³ç€åœ¨ Mybatis å¯åŠ¨æ—¶æˆ‘ä»¬ä¹Ÿéœ€è¦é€šè¿‡ TypeHandlerRegistry å°†æˆ‘ä»¬çš„æ‰€æœ‰çš„æšä¸¾ç±»å‹ï¼ˆJavaTypeï¼‰ä¸è‡ªå®šä¹‰çš„æšä¸¾ // TypeHandlerï¼ˆEnumTypeHandlerï¼‰å»ºç«‹è”ç³» TypeHandlerRegistry typeHandlerRegistry = configuration.getTypeHandlerRegistry(); // è‡ªå®šä¹‰ TypeHandler æ—¶ä¼šèµ°è¿™ä¸ªé€»è¾‘ï¼Œå»ºç«‹ JavaType å’Œ JdbcType ä¹‹é—´çš„è”ç³» if (typeHandlerRegistry.hasTypeHandler(parameterObject.getClass())) &#123; // æ›¿æ¢ SQL ä¸­çš„å ä½ç¬¦ â€œ?â€ ä¸ºå…·ä½“çš„å‚æ•°ï¼ŒreplaceFirst ä½œä¸ºæ˜¯æ›¿æ¢åŒ¹é…åˆ°çš„ç¬¬ä¸€ä¸ªå ä½ç¬¦ â€œ?â€ sql = sql.replaceFirst(\"\\\\?\", getFormatParameterValue(parameterObject)); &#125; // æ²¡æœ‰è‡ªå®šä¹‰çš„ TypeHandlerï¼Œèµ°é€šç”¨é€»è¾‘ else &#123; // æ‹¿åˆ° targetï¼ˆæ‹¦æˆªå¯¹è±¡ï¼‰çš„å…ƒæ•°æ® MetaObject metaObject = configuration.newMetaObject(parameterObject); // å‚æ•°æ˜¯æŒ‰é¡ºåºå­˜å‚¨çš„ï¼Œä¸‹é¢é€»è¾‘æŒ‰é¡ºåºæ¥æ›¿æ¢ for (ParameterMapping parameterMapping : parameterMappings) &#123; // è·å–å‚æ•°çš„åç§° String propertyName = parameterMapping.getProperty(); // å¦‚æœå…ƒæ•°æ®å¯¹è±¡ä¸­å­˜åœ¨è¯¥å‚æ•°ï¼Œåˆ™æ›¿æ¢ç›¸åº”çš„å ä½ç¬¦ â€œ?â€ if (metaObject.hasGetter(propertyName)) &#123; Object obj = metaObject.getValue(propertyName); sql = sql.replaceFirst(\"\\\\?\", getFormatParameterValue(obj)); &#125; // å¦‚æœæœ‰é¢å¤–çš„å‚æ•°ï¼Œèµ°ä¸‹é¢çš„é€»è¾‘ else if (boundSql.hasAdditionalParameter(propertyName)) &#123; Object obj = boundSql.getAdditionalParameter(propertyName); sql = sql.replaceFirst(\"\\\\?\", getFormatParameterValue(obj)); &#125; &#125; &#125; &#125; // è¿”å›ç»„è£…å¥½çš„ SQL return sql;&#125;// æŒ‰ç±»å‹æ ¼å¼åŒ– SQL é‡Œçš„å‚æ•°private static String getFormatParameterValue(Object obj) &#123; String value = null; if (obj instanceof String) &#123; value = \"'\" + obj.toString() + \"'\"; &#125; else if (obj instanceof Date) &#123; DateFormat formatter = DateFormat.getDateTimeInstance(DateFormat.DEFAULT, DateFormat.DEFAULT, Locale.CHINA); value = \"'\" + formatter.format(new Date()) + \"'\"; &#125; else &#123; if (obj != null) &#123; value = obj.toString(); &#125; else &#123; value = \"\"; &#125; &#125;&#125; plugin æ–¹æ³• åŒ…è£…ç›®æ ‡å¯¹è±¡ï¼ŒåŒ…è£…çš„æ„æ€å°±æ˜¯ä¸ºç›®æ ‡å¯¹è±¡åˆ›å»ºä¸€ä¸ªä»£ç†ã€‚ 1234567891011@Overridepublic Object plugin(Object target) &#123; // åˆ¤æ–­ç›®æ ‡å¯¹è±¡ç±»å‹æ˜¯å¦ä¸ºæ‰€éœ€ç±»å‹ if (target instanceof Executor) &#123; // ä¸º target åˆ›å»ºä¸€ä¸ªåŠ¨æ€ä»£ç†ï¼Œä»¥æ­¤æ¥å®ç°æ–¹æ³•æ‹¦æˆªå’Œå¢å¼ºåŠŸèƒ½ï¼šå›è°ƒ intercept æ–¹æ³• return Plugin.wrap(target, this); &#125; else &#123; // æ— éœ€æ‹¦æˆªåˆ™ç›´æ¥è¿”å›ç›®æ ‡å¯¹è±¡æœ¬èº« return target; &#125;&#125;","categories":[{"name":"ORM","slug":"ORM","permalink":"http://yoursite.com/categories/ORM/"}],"tags":[{"name":"MyBatis","slug":"MyBatis","permalink":"http://yoursite.com/tags/MyBatis/"}]},{"title":"synchronized & Lock","slug":"Java/HighConcurrency/synchronized & Lock","date":"2020-03-28T11:31:54.000Z","updated":"2020-04-19T06:28:54.098Z","comments":true,"path":"2020/03/28/Java/HighConcurrency/synchronized & Lock/","link":"","permalink":"http://yoursite.com/2020/03/28/Java/HighConcurrency/synchronized%20&%20Lock/","excerpt":"synchronized å’Œ Lock å®ç°åŒæ­¥äº’æ–¥è®¿é—®ã€‚","text":"synchronized å’Œ Lock å®ç°åŒæ­¥äº’æ–¥è®¿é—®ã€‚ å¦‚æœå¯¹ä¸´ç•Œèµ„æºåŠ ä¸Šäº’æ–¥é”ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹åœ¨è®¿é—®è¯¥ä¸´ç•Œèµ„æºæ—¶ï¼Œå…¶ä»–çº¿ç¨‹ä¾¿åªèƒ½ç­‰å¾…ã€‚ åœ¨ Java ä¸­ï¼Œæ¯ä¸€ä¸ªå¯¹è±¡éƒ½æ‹¥æœ‰ä¸€ä¸ªé”æ ‡è®°ï¼ˆmonitorï¼‰ï¼Œä¹Ÿç§°ä¸ºç›‘è§†å™¨ï¼Œå¤šçº¿ç¨‹åŒæ—¶è®¿é—®æŸä¸ªå¯¹è±¡æ—¶ï¼Œçº¿ç¨‹åªæœ‰è·å–äº†è¯¥å¯¹è±¡çš„é”æ‰èƒ½è®¿é—®ã€‚ synchronized åœ¨ Java ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ synchronized å…³é”®å­—æ¥æ ‡è®°ä¸€ä¸ªæ–¹æ³•æˆ–è€…ä»£ç å—ï¼Œå½“æŸä¸ªçº¿ç¨‹è°ƒç”¨è¯¥å¯¹è±¡çš„ synchronized æ–¹æ³•æˆ–è€…è®¿é—® synchronized ä»£ç å—æ—¶ï¼Œè¿™ä¸ªçº¿ç¨‹ä¾¿è·å¾—äº†è¯¥å¯¹è±¡çš„é”ï¼Œå…¶ä»–çº¿ç¨‹æš‚æ—¶æ— æ³•è®¿é—®è¿™ä¸ªæ–¹æ³•ï¼Œåªæœ‰ç­‰å¾…è¿™ä¸ªæ–¹æ³•æ‰§è¡Œå®Œæ¯•æˆ–è€…ä»£ç å—æ‰§è¡Œå®Œæ¯•ï¼Œè¿™ä¸ªçº¿ç¨‹æ‰ä¼šé‡Šæ”¾è¯¥å¯¹è±¡çš„é”ï¼Œå…¶ä»–çº¿ç¨‹æ‰èƒ½æ‰§è¡Œè¿™ä¸ªæ–¹æ³•æˆ–è€…ä»£ç å—ã€‚ synchronized æ–¹æ³•ä¸¤ä¸ªçº¿ç¨‹åˆ†åˆ«è°ƒç”¨ insertData() å¯¹è±¡æ’å…¥æ•°æ®ã€‚ï¼ˆéåŒæ­¥ï¼‰ 1234567891011121314151617181920212223242526272829public class Test &#123; public static void main(String[] args) &#123; final InsertData insertData = new InsertData(); // åŒ¿åå†…éƒ¨ç±» new Thread() &#123; public void run() &#123; insertData.insert(Thread.currentThread()); &#125;; &#125;.start(); new Thread() &#123; public void run() &#123; insertData.insert(Thread.currentThread()); &#125;; &#125;.start(); &#125; &#125;class InsertData &#123; private ArrayList&lt;Integer&gt; arrayList = new ArrayList&lt;Integer&gt;(); public void insert(Thread thread)&#123; for(int i=0;i&lt;5;i++)&#123; System.out.println(thread.getName()+\"åœ¨æ’å…¥æ•°æ®\"+i); arrayList.add(i); &#125; &#125;&#125; è¾“å‡ºç»“æœè¡¨æ˜ä¸¤ä¸ªçº¿ç¨‹åœ¨åŒæ—¶æ‰§è¡Œinsertæ–¹æ³•ã€‚è€Œå¦‚æœåœ¨insertæ–¹æ³•å‰é¢åŠ ä¸Šå…³é”®å­— synchronizedã€‚ 12345678910class InsertData &#123; private ArrayList&lt;Integer&gt; arrayList = new ArrayList&lt;Integer&gt;(); // åŒæ­¥æ–¹æ³• public synchronized void insert(Thread thread)&#123; for(int i=0;i&lt;5;i++)&#123; System.out.println(thread.getName()+\"åœ¨æ’å…¥æ•°æ®\"+i); arrayList.add(i); &#125; &#125;&#125; è¾“å‡ºç»“æœè¡¨æ˜ä¸¤çº¿ç¨‹é¡ºåºæ‰§è¡Œã€‚ synchronized ä»£ç å—123456789101112131415class InsertData &#123; private ArrayList&lt;Integer&gt; arrayList = new ArrayList&lt;Integer&gt;(); // private Object object = new Object(); public void insert(Thread thread)&#123; // åŒæ­¥ä»£ç å— // this ä»£è¡¨è·å–å½“å‰å¯¹è±¡çš„é”ï¼Œä¹Ÿå¯ä»¥æ˜¯ç±»ä¸­çš„ä¸€ä¸ªå±æ€§ï¼Œä»£è¡¨è·å–è¯¥å±æ€§çš„é”ã€‚ // synchronized (object) &#123; synchronized (this) &#123; for(int i=0;i&lt;100;i++)&#123; System.out.println(thread.getName()+\"åœ¨æ’å…¥æ•°æ®\"+i); arrayList.add(i); &#125; &#125; &#125;&#125; ç±»é” VS. å¯¹è±¡é” å¦å¤–ï¼Œæ¯ä¸ªç±»ä¹Ÿä¼šæœ‰ä¸€ä¸ªé”ï¼Œå®ƒå¯ä»¥ç”¨æ¥æ§åˆ¶å¯¹ static æ•°æ®æˆå‘˜çš„å¹¶å‘è®¿é—®ã€‚å¹¶ä¸”å¦‚æœä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œä¸€ä¸ªå¯¹è±¡çš„é static synchronized æ–¹æ³•ï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹éœ€è¦æ‰§è¡Œè¿™ä¸ªå¯¹è±¡æ‰€å±ç±»çš„ static synchronized æ–¹æ³•ï¼Œæ­¤æ—¶ä¸ä¼šå‘ç”Ÿäº’æ–¥ç°è±¡ï¼Œå› ä¸ºè®¿é—® static synchronized æ–¹æ³•å ç”¨çš„æ˜¯ç±»é”ï¼Œè€Œè®¿é—®é static synchronized æ–¹æ³•å ç”¨çš„æ˜¯å¯¹è±¡é”ï¼Œæ‰€ä»¥ä¸å­˜åœ¨äº’æ–¥ç°è±¡ã€‚ Lock æ¥å£ Lock ä¸æ˜¯ Java è¯­è¨€å†…ç½®çš„ï¼Œsynchronized æ˜¯ Java è¯­è¨€çš„å…³é”®å­—ï¼Œå› æ­¤æ˜¯å†…ç½®ç‰¹æ€§ã€‚Lock æ˜¯ä¸€ä¸ªç±»ï¼Œé€šè¿‡è¿™ä¸ªç±»å¯ä»¥å®ç°åŒæ­¥è®¿é—®ï¼› Lock å’Œ synchronized æœ‰ä¸€ç‚¹éå¸¸å¤§çš„ä¸åŒï¼Œé‡‡ç”¨ synchronized ä¸éœ€è¦ç”¨æˆ·å»æ‰‹åŠ¨é‡Šæ”¾é”ï¼Œå½“ synchronized æ–¹æ³•æˆ–è€… synchronized ä»£ç å—æ‰§è¡Œå®Œä¹‹åï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è®©çº¿ç¨‹é‡Šæ”¾å¯¹é”çš„å ç”¨ï¼›è€Œ Lock åˆ™å¿…é¡»è¦ç”¨æˆ·å»æ‰‹åŠ¨é‡Šæ”¾é”ï¼Œå¦‚æœæ²¡æœ‰ä¸»åŠ¨é‡Šæ”¾é”ï¼Œå°±æœ‰å¯èƒ½å¯¼è‡´å‡ºç°æ­»é”ç°è±¡ã€‚ 12345678public interface Lock &#123; void lock(); void lockInterruptibly() throws InterruptedException; boolean tryLock(); boolean tryLock(long time, TimeUnit unit) throws InterruptedException; void unlock(); Condition newCondition();&#125; é‡‡ç”¨ Lockï¼Œå¿…é¡»ä¸»åŠ¨å»é‡Šæ”¾é”ï¼Œå¹¶ä¸”åœ¨å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œä¸ä¼šè‡ªåŠ¨é‡Šæ”¾é”ã€‚å› æ­¤ä¸€èˆ¬æ¥è¯´ï¼Œä½¿ç”¨ Lock å¿…é¡»åœ¨ try catch å—ä¸­è¿›è¡Œï¼Œå¹¶ä¸”å°†é‡Šæ”¾é”çš„æ“ä½œæ”¾åœ¨ finally å—ä¸­è¿›è¡Œï¼Œä»¥ä¿è¯é”ä¸€å®šè¢«è¢«é‡Šæ”¾ï¼Œé˜²æ­¢æ­»é”çš„å‘ç”Ÿã€‚ 123456789Lock lock = ...;lock.lock();try&#123; // å¤„ç†ä»»åŠ¡&#125;catch(Exception ex)&#123; &#125;finally&#123; lock.unlock(); // é‡Šæ”¾é”&#125; tryLock æ–¹æ³•æ˜¯æœ‰è¿”å›å€¼çš„ï¼Œå®ƒè¡¨ç¤ºç”¨æ¥å°è¯•è·å–é”ï¼Œå¦‚æœè·å–æˆåŠŸï¼Œåˆ™è¿”å› trueï¼Œå¦‚æœè·å–å¤±è´¥ï¼ˆå³é”å·²è¢«å…¶ä»–çº¿ç¨‹è·å–ï¼‰ï¼Œåˆ™è¿”å› falseï¼Œä¹Ÿå°±è¯´è¿™ä¸ªæ–¹æ³•æ— è®ºå¦‚ä½•éƒ½ä¼šç«‹å³è¿”å›ã€‚åœ¨æ‹¿ä¸åˆ°é”æ—¶ä¸ä¼šä¸€ç›´åœ¨é‚£ç­‰å¾…ã€‚ tryLock(long time, TimeUnit unit) å’Œ tryLock æ–¹æ³•æ˜¯ç±»ä¼¼çš„ï¼Œåªä¸è¿‡åŒºåˆ«åœ¨äºè¿™ä¸ªæ–¹æ³•åœ¨æ‹¿ä¸åˆ°é”æ—¶ä¼šç­‰å¾…ä¸€å®šçš„æ—¶é—´ï¼Œåœ¨æ—¶é—´æœŸé™ä¹‹å†…å¦‚æœè¿˜æ‹¿ä¸åˆ°é”ï¼Œå°±è¿”å› falseã€‚å¦‚æœå¦‚æœä¸€å¼€å§‹æ‹¿åˆ°é”æˆ–è€…åœ¨ç­‰å¾…æœŸé—´å†…æ‹¿åˆ°äº†é”ï¼Œåˆ™è¿”å› trueã€‚ 123456789101112Lock lock = ...;if(lock.tryLock()) &#123; try&#123; // å¤„ç†ä»»åŠ¡ &#125;catch(Exception ex)&#123; &#125;finally&#123; lock.unlock(); // é‡Šæ”¾é” &#125; &#125; else &#123; // å¦‚æœä¸èƒ½è·å–é”ï¼Œåˆ™ç›´æ¥åšå…¶ä»–äº‹æƒ…&#125; lockInterruptibly æ–¹æ³•æ¯”è¾ƒç‰¹æ®Šï¼Œå½“é€šè¿‡è¿™ä¸ªæ–¹æ³•å»è·å–é”æ—¶ï¼Œå¦‚æœçº¿ç¨‹æ­£åœ¨ç­‰å¾…è·å–é”ï¼Œåˆ™è¿™ä¸ªçº¿ç¨‹èƒ½å¤Ÿå“åº”ä¸­æ–­ï¼Œå³ä¸­æ–­çº¿ç¨‹çš„ç­‰å¾…çŠ¶æ€ã€‚ä¹Ÿå°±ä½¿è¯´ï¼Œå½“ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶é€šè¿‡ lock.lockInterruptibly() æƒ³è·å–æŸä¸ªé”æ—¶ï¼Œå‡è‹¥æ­¤æ—¶çº¿ç¨‹ A è·å–åˆ°äº†é”ï¼Œè€Œçº¿ç¨‹Båªæœ‰ç»§ç»­ç­‰å¾…ï¼Œé‚£ä¹ˆå¯¹çº¿ç¨‹ B è°ƒç”¨ threadB.interrupt() èƒ½å¤Ÿä¸­æ–­çº¿ç¨‹ Bçš„ç­‰å¾…è¿‡ç¨‹ã€‚ 123456789public void method() throws InterruptedException &#123; lock.lockInterruptibly(); try &#123; // ... &#125; finally &#123; lock.unlock(); &#125; &#125; ReentrantLock å¯é‡å…¥é”çš„ä¸€ç§ï¼Œåé¢è¯¦ç»†ä»‹ç»ï¼Œå…ˆæ¥çœ‹ä¸€ä¸‹å¸¸ç”¨ç”¨æ³•ã€‚ 123456789101112131415161718192021222324252627282930313233// é”™è¯¯æ¡ˆä¾‹public class Test &#123; public static void main(String[] args) &#123; final Test test = new Test(); new Thread()&#123; public void run() &#123; test.insert(Thread.currentThread()); &#125;; &#125;.start(); new Thread()&#123; public void run() &#123; test.insert(Thread.currentThread()); &#125;; &#125;.start(); &#125; public void insert(Thread thread) &#123; // æ³¨æ„ï¼ï¼ï¼è¿™æ˜¯ä¸€ä¸ªå±€éƒ¨å˜é‡ Lock lock = new ReentrantLock(); // å®ä¾‹åŒ–ä¸€ä¸ª ReentrantLock ç±»å‹å¯¹è±¡ // æ¯ä¸ªçº¿ç¨‹æ‰§è¡Œåˆ° lock.lock() å¤„è·å–çš„æ˜¯ä¸åŒçš„é”ï¼Œæ­¤é”æ— æ•ˆ lock.lock(); try &#123; System.out.println(thread.getName()+\"å¾—åˆ°äº†é”\"); &#125; catch (Exception e) &#123; &#125;finally &#123; System.out.println(thread.getName()+\"é‡Šæ”¾äº†é”\"); lock.unlock(); &#125; &#125;&#125; å°† lock å£°æ˜ä¸ºç±»çš„å±æ€§ï¼Œå³å…¨å±€å˜é‡ã€‚ 12345public class Test &#123; private Lock lock = new ReentrantLock(); // å…¨å±€å˜é‡ //...&#125; lockInterruptibly() å“åº”ä¸­æ–­çš„ä½¿ç”¨æ–¹æ³• 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152public class Test &#123; // å…¨å±€å˜é‡ private Lock lock = new ReentrantLock(); public static void main(String[] args) &#123; Test test = new Test(); MyThread thread1 = new MyThread(test); MyThread thread2 = new MyThread(test); thread1.start(); thread2.start(); try &#123; Thread.sleep(2000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; thread2.interrupt(); &#125; public void insert(Thread thread) throws InterruptedException&#123; lock.lockInterruptibly(); // çº¿ç¨‹ 1 è·å¾—é” çº¿ç¨‹ 2 å¤„äºç­‰å¾…ï¼Œå¹¶ä¸”å°†è¢«æ‰“æ–­ç­‰å¾… try &#123; System.out.println(thread.getName()+\"å¾—åˆ°äº†é”\"); long startTime = System.currentTimeMillis(); for( ; ;) &#123; if(System.currentTimeMillis() - startTime &gt;= 10000) break; // æ’å…¥æ•°æ® &#125; &#125; finally &#123; System.out.println(Thread.currentThread().getName()+\"æ‰§è¡Œfinally\"); lock.unlock(); System.out.println(thread.getName()+\"é‡Šæ”¾äº†é”\"); &#125; &#125;&#125;class MyThread extends Thread &#123; private Test test = null; public MyThread(Test test) &#123; this.test = test; &#125; @Override public void run() &#123; try &#123; test.insert(Thread.currentThread()); &#125; catch (InterruptedException e) &#123; System.out.println(Thread.currentThread().getName()+\"è¢«ä¸­æ–­\"); &#125; &#125;&#125; ReadWriteLock æ¥å£ å°†æ–‡ä»¶çš„è¯»å†™æ“ä½œåˆ†å¼€ï¼Œåˆ†æˆ 2 ä¸ªé”æ¥åˆ†é…ç»™çº¿ç¨‹ï¼Œä»è€Œä½¿å¾—å¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è¿›è¡Œè¯»æ“ä½œã€‚ 1234567public interface ReadWriteLock &#123; // è¯»é” Lock readLock(); // å†™é” Lock writeLock();&#125; ReentrantReadWriteLock å®ç°äº† ReadWriteLock æ¥å£ã€‚ 12345678910111213141516171819202122232425262728293031323334public class Test &#123; private ReentrantReadWriteLock rwl = new ReentrantReadWriteLock(); public static void main(String[] args) &#123; final Test test = new Test(); new Thread()&#123; public void run() &#123; test.get(Thread.currentThread()); &#125;; &#125;.start(); new Thread()&#123; public void run() &#123; test.get(Thread.currentThread()); &#125;; &#125;.start(); &#125; public void get(Thread thread) &#123; rwl.readLock().lock(); try &#123; long start = System.currentTimeMillis(); while(System.currentTimeMillis() - start &lt;= 1) &#123; System.out.println(thread.getName()+\"æ­£åœ¨è¿›è¡Œè¯»æ“ä½œ\"); &#125; System.out.println(thread.getName()+\"è¯»æ“ä½œå®Œæ¯•\"); &#125; finally &#123; rwl.readLock().unlock(); &#125; &#125;&#125; ä¸¤çº¿ç¨‹åŒæ—¶è¿›è¡Œè¯»æ“ä½œã€‚ é”çš„ç§ç±» ä»‹ç»ä¸é”ç›¸å…³çš„å‡ ä¸ªæ¦‚å¿µã€‚ å¯é‡å…¥é” å¦‚æœè¯´é”å…·å¤‡å¯é‡å…¥æ€§ï¼Œé‚£è¿™ä¸ªé”ä¸ºå¯é‡å…¥é”å³åŸºäºçº¿ç¨‹çš„åˆ†é…ï¼Œè€Œä¸æ˜¯åŸºäºæ–¹æ³•è°ƒç”¨çš„åˆ†é…ã€‚åƒ synchronized å’Œ ReentrantLock éƒ½æ˜¯å¯é‡å…¥é”ã€‚ å½“ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œåˆ°æŸä¸ª synchronized æ–¹æ³•æ—¶ï¼Œæ¯”å¦‚è¯´ methodAï¼Œè€Œåœ¨ methodA ä¸­ä¼šè°ƒç”¨å¦å¤–ä¸€ä¸ª synchronized æ–¹æ³• methodBï¼Œæ­¤æ—¶çº¿ç¨‹ä¸å¿…é‡æ–°å»ç”³è¯·é”ï¼Œè€Œæ˜¯å¯ä»¥ç›´æ¥æ‰§è¡Œæ–¹æ³• methodBã€‚å› ä¸ºå¯é‡å…¥é”çš„åˆ†é…æ˜¯åŸºäºçº¿ç¨‹çš„ï¼ŒåŒä¸€çº¿ç¨‹ä¸å¿…é‡æ–°ç”³è¯·é”ã€‚ å¯ä¸­æ–­é” åœ¨ Java ä¸­ï¼Œsynchronized å°±ä¸æ˜¯å¯ä¸­æ–­é”ï¼Œè€Œ Lock æ˜¯å¯ä¸­æ–­é”ã€‚ å…¬å¹³é” å…¬å¹³é”å³å°½é‡ä»¥è¯·æ±‚é”çš„é¡ºåºæ¥è·å–é”ã€‚æ¯”å¦‚åŒæ˜¯æœ‰å¤šä¸ªçº¿ç¨‹åœ¨ç­‰å¾…ä¸€ä¸ªé”ï¼Œå½“è¿™ä¸ªé”è¢«é‡Šæ”¾æ—¶ï¼Œç­‰å¾…æ—¶é—´æœ€ä¹…çš„çº¿ç¨‹ï¼ˆæœ€å…ˆè¯·æ±‚çš„çº¿ç¨‹ï¼‰ä¼šè·å¾—è¯¥æ‰€ï¼Œè¿™ç§å°±æ˜¯å…¬å¹³é”ã€‚ éå…¬å¹³é”å³æ— æ³•ä¿è¯é”çš„è·å–æ˜¯æŒ‰ç…§è¯·æ±‚é”çš„é¡ºåºè¿›è¡Œçš„ã€‚è¿™æ ·å°±å¯èƒ½å¯¼è‡´æŸä¸ªæˆ–è€…ä¸€äº›çº¿ç¨‹æ°¸è¿œè·å–ä¸åˆ°é”ã€‚ åœ¨ Java ä¸­ï¼Œsynchronized å°±æ˜¯éå…¬å¹³é”ï¼Œå®ƒæ— æ³•ä¿è¯ç­‰å¾…çš„çº¿ç¨‹è·å–é”çš„é¡ºåºã€‚è€Œå¯¹äº ReentrantLock å’Œ ReentrantReadWriteLockï¼Œå®ƒé»˜è®¤æƒ…å†µä¸‹æ˜¯éå…¬å¹³é”ï¼Œä½†æ˜¯å¯ä»¥è®¾ç½®ä¸ºå…¬å¹³é”ã€‚ è¯»å†™é” è¯»å†™é”å°†å¯¹ä¸€ä¸ªèµ„æºï¼ˆæ¯”å¦‚æ–‡ä»¶ï¼‰çš„è®¿é—®åˆ†æˆäº† 2 ä¸ªé”ï¼Œä¸€ä¸ªè¯»é”å’Œä¸€ä¸ªå†™é”ã€‚æ­£å› ä¸ºæœ‰äº†è¯»å†™é”ï¼Œæ‰ä½¿å¾—å¤šä¸ªçº¿ç¨‹ä¹‹é—´çš„è¯»æ“ä½œä¸ä¼šå‘ç”Ÿå†²çªã€‚","categories":[{"name":"Java","slug":"Java","permalink":"http://yoursite.com/categories/Java/"}],"tags":[{"name":"High Concurrency","slug":"High-Concurrency","permalink":"http://yoursite.com/tags/High-Concurrency/"}]},{"title":"Thread","slug":"Java/HighConcurrency/Thread","date":"2020-03-28T08:24:10.000Z","updated":"2020-04-19T06:30:05.388Z","comments":true,"path":"2020/03/28/Java/HighConcurrency/Thread/","link":"","permalink":"http://yoursite.com/2020/03/28/Java/HighConcurrency/Thread/","excerpt":"ä»‹ç»çº¿ç¨‹ç›¸å…³çŸ¥è¯†ä»¥åŠ Java ä¸­ Thread ç±»æ–¹æ³•çš„å…·ä½“ä½¿ç”¨ã€‚","text":"ä»‹ç»çº¿ç¨‹ç›¸å…³çŸ¥è¯†ä»¥åŠ Java ä¸­ Thread ç±»æ–¹æ³•çš„å…·ä½“ä½¿ç”¨ã€‚ çº¿ç¨‹çš„çŠ¶æ€NEW (æ–°å»º)ï¼šä¸€ä¸ªå°šæœªå¯åŠ¨çš„çº¿ç¨‹å¤„äºè¿™ä¸€çŠ¶æ€ã€‚ RUNNABLE (å¯è¿è¡Œ) ï¼šä¸€ä¸ªæ­£åœ¨ Java è™šæ‹Ÿæœºä¸­æ‰§è¡Œçš„çº¿ç¨‹å¤„äºè¿™ä¸€çŠ¶æ€ã€‚ å¤„äº runnable çŠ¶æ€ä¸‹çš„çº¿ç¨‹æ­£åœ¨ Java è™šæ‹Ÿæœºä¸­æ‰§è¡Œï¼Œä½†å®ƒå¯èƒ½æ­£åœ¨ç­‰å¾…æ¥è‡ªäºæ“ä½œç³»ç»Ÿçš„å…¶å®ƒèµ„æºï¼Œæ¯”å¦‚å¤„ç†å™¨ã€‚å½“è¿›è¡Œé˜»å¡å¼çš„ IO æ“ä½œæ—¶ï¼Œæˆ–è®¸åº•å±‚çš„æ“ä½œç³»ç»Ÿçº¿ç¨‹ç¡®å®å¤„åœ¨é˜»å¡çŠ¶æ€ï¼Œä½†æˆ‘ä»¬å…³å¿ƒçš„æ˜¯ JVM çš„çº¿ç¨‹çŠ¶æ€ã€‚JVM æŠŠé‚£äº›éƒ½è§†ä½œèµ„æºï¼ŒCPU ä¹Ÿå¥½ï¼Œç¡¬ç›˜ï¼Œç½‘å¡ä¹Ÿç½¢ï¼Œæœ‰ä¸œè¥¿åœ¨ä¸ºçº¿ç¨‹æœåŠ¡ï¼Œå®ƒå°±è®¤ä¸ºçº¿ç¨‹åœ¨â€œæ‰§è¡Œâ€ã€‚å¦‚æœ JVM ä¸­çš„çº¿ç¨‹çŠ¶æ€å‘ç”Ÿæ”¹å˜äº†ï¼Œé€šå¸¸æ˜¯è‡ªèº«æœºåˆ¶å¼•å‘çš„ã€‚ BLOCKED (é˜»å¡) ï¼šä¸€ä¸ªæ­£åœ¨é˜»å¡ç­‰å¾…ä¸€ä¸ªç›‘è§†å™¨é”çš„çº¿ç¨‹å¤„äºè¿™ä¸€çŠ¶æ€ã€‚ synchronize æœºåˆ¶æœ‰å¯èƒ½è®©çº¿ç¨‹è¿›å…¥ BLOCKED çŠ¶æ€ã€‚å½“å› ä¸ºè·å–ä¸åˆ°é”è€Œæ— æ³•è¿›å…¥åŒæ­¥å—æ—¶ï¼Œçº¿ç¨‹å¤„äº BLOCKED çŠ¶æ€ã€‚å¦‚æœæœ‰çº¿ç¨‹é•¿æ—¶é—´å¤„äº BLOCKED çŠ¶æ€ï¼Œè¦è€ƒè™‘æ˜¯å¦å‘ç”Ÿäº†æ­»é”ï¼ˆdeadlockï¼‰çš„çŠ¶å†µã€‚BLOCKED çŠ¶æ€å¯ä»¥è§†ä½œä¸ºä¸€ç§ç‰¹æ®Šçš„ waitingï¼Œæ˜¯ä¼ ç»Ÿ waiting çŠ¶æ€çš„ä¸€ä¸ªç»†åˆ†ã€‚ WAITING (ç­‰å¾…) ï¼šä¸€ä¸ªæ­£åœ¨æ— é™æœŸç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œä¸€ä¸ªç‰¹åˆ«çš„åŠ¨ä½œçš„çº¿ç¨‹å¤„äºè¿™ä¸€çŠ¶æ€ã€‚ wait / notifyï¼Œjoin æ–¹æ³•è¿›å…¥ WATING çŠ¶æ€ã€‚å…¶ä¸­ wait / notify å¯ç”¨äºåä½œå…³ç³»ï¼šå½“æ¡ä»¶ä¸æ»¡è¶³æ—¶è°ƒç”¨ wait é‡Šæ”¾é”ï¼Œè®©è¡¥å……æ¡ä»¶çš„çº¿ç¨‹è¿è¡Œï¼Œä½†æ¡ä»¶æ»¡è¶³åç”±æ­¤è¡¥å……çº¿ç¨‹å”¤é†’ï¼Œå”¤é†’ååŸæœ‰çº¿ç¨‹å¤„äºé˜»å¡é˜Ÿåˆ—ç­‰å¾…å–é”ã€‚wait(0)ï¼šæ— é™ç­‰å¾…ã€‚ TIMED_WAITING (è®¡æ—¶ç­‰å¾…) ï¼šä¸€ä¸ªæ­£åœ¨é™æ—¶ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œä¸€ä¸ªåŠ¨ä½œçš„çº¿ç¨‹å¤„äºè¿™ä¸€çŠ¶æ€ã€‚ åŒä¿é™©ï¼šå³ä½¿æ¡ä»¶æ°¸è¿œå¾—ä¸åˆ°æ»¡è¶³ï¼Œçº¿ç¨‹ä¹Ÿä¼šåœ¨è§„å®šæ—¶é—´åè‡ªæˆ‘å”¤é†’ã€‚è°ƒç”¨ sleep æ–¹æ³•è¿›å…¥ TIMED_WAITING çŠ¶æ€ï¼Œæ­¤çŠ¶æ€ä¸é‡Šæ”¾é”ï¼ˆä¸é”æ— å…³ï¼‰ï¼Œåªèƒ½ç­‰å…¶è‡ªæˆ‘å”¤é†’ã€‚sleep(0)ï¼šå‡ ä¹ä¸ç­‰å¾…ã€‚ TERMINATED (ç»ˆæ­¢) ï¼šä¸€ä¸ªå·²ç»é€€å‡ºçš„çº¿ç¨‹å¤„äºè¿™ä¸€çŠ¶æ€ã€‚ å¸¸ç”¨æ–¹æ³•start æ–¹æ³• start() ç”¨æ¥å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ï¼Œå½“è°ƒç”¨ start æ–¹æ³•åï¼Œç³»ç»Ÿæ‰ä¼šå¼€å¯ä¸€ä¸ªæ–°çš„çº¿ç¨‹æ¥æ‰§è¡Œç”¨æˆ·å®šä¹‰çš„å­ä»»åŠ¡ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¼šä¸ºç›¸åº”çš„çº¿ç¨‹åˆ†é…éœ€è¦çš„èµ„æºã€‚ run æ–¹æ³• run() æ–¹æ³•æ˜¯ä¸éœ€è¦ç”¨æˆ·æ¥è°ƒç”¨çš„ï¼Œå½“é€šè¿‡ start æ–¹æ³•å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ä¹‹åï¼Œå½“çº¿ç¨‹è·å¾—äº† CPU æ‰§è¡Œæ—¶é—´ï¼Œä¾¿è¿›å…¥ run æ–¹æ³•ä½“å»æ‰§è¡Œå…·ä½“çš„ä»»åŠ¡ã€‚æ³¨æ„ï¼Œç»§æ‰¿ Thread ç±»å¿…é¡»é‡å†™ run æ–¹æ³•ï¼Œåœ¨ run æ–¹æ³•ä¸­å®šä¹‰å…·ä½“è¦æ‰§è¡Œçš„ä»»åŠ¡ã€‚ sleep æ–¹æ³• sleep æ–¹æ³•ç›¸å½“äºè®©çº¿ç¨‹ç¡çœ ï¼Œäº¤å‡º CPUï¼Œè®© CPU å»æ‰§è¡Œå…¶ä»–çš„ä»»åŠ¡ã€‚æ³¨æ„ sleep æ–¹æ³•ä¸é”æ— å…³ã€‚ 123456789101112131415161718192021222324252627282930313233public class Test &#123; private int i = 10; private Object object = new Object(); public static void main(String[] args) throws IOException &#123; Test test = new Test(); MyThread thread1 = test.new MyThread(); MyThread thread2 = test.new MyThread(); thread1.start(); thread2.start(); // ç­‰å¾…ä¸Šä¸€ä¸ªçº¿ç¨‹è¿è¡Œå®ŒåŒæ­¥ä»£ç å—æ‰å¯è¿è¡Œ &#125; class MyThread extends Thread&#123; @Override public void run() &#123; synchronized (object) &#123; i++; System.out.println(\"i:\"+i); try &#123; System.out.println(\"çº¿ç¨‹\"+Thread.currentThread().getName()+\"è¿›å…¥ç¡çœ çŠ¶æ€\"); Thread.currentThread().sleep(10000); &#125; catch (InterruptedException e) &#123; // TODO: handle exception &#125; System.out.println(\"çº¿ç¨‹\"+Thread.currentThread().getName()+\"ç¡çœ ç»“æŸ\"); i++; System.out.println(\"i:\"+i); &#125; &#125; &#125;&#125; yield æ–¹æ³• è°ƒç”¨ yield æ–¹æ³•ä¼šè®©å½“å‰çº¿ç¨‹äº¤å‡º CPU æƒé™ï¼Œè®© CPU å»æ‰§è¡Œå…¶ä»–çš„çº¿ç¨‹ã€‚å®ƒè·Ÿ sleep æ–¹æ³•ç±»ä¼¼ï¼ŒåŒæ ·ä¸ä¼šé‡Šæ”¾é”ã€‚ä½†æ˜¯ yield ä¸èƒ½æ§åˆ¶å…·ä½“çš„äº¤å‡º CPU çš„æ—¶é—´ï¼Œå¦å¤–ï¼Œyield æ–¹æ³•åªèƒ½è®©æ‹¥æœ‰ç›¸åŒä¼˜å…ˆçº§çš„çº¿ç¨‹æœ‰è·å– CPU æ‰§è¡Œæ—¶é—´çš„æœºä¼šã€‚ æ³¨æ„ï¼Œè°ƒç”¨ yield æ–¹æ³•å¹¶ä¸ä¼šè®©çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œè€Œæ˜¯è®©çº¿ç¨‹é‡å›å°±ç»ªçŠ¶æ€ï¼Œå®ƒåªéœ€è¦ç­‰å¾…é‡æ–°è·å– CPU æ‰§è¡Œæ—¶é—´ï¼Œè¿™ä¸€ç‚¹æ˜¯å’Œ sleep æ–¹æ³•ä¸ä¸€æ ·çš„ã€‚ join æ–¹æ³• å‡å¦‚åœ¨ main çº¿ç¨‹ä¸­ï¼Œè°ƒç”¨ thread.join æ–¹æ³•ï¼Œåˆ™ main æ–¹æ³•ä¼šç­‰å¾… thread çº¿ç¨‹æ‰§è¡Œå®Œæ¯•æˆ–è€…ç­‰å¾…ä¸€å®šçš„æ—¶é—´ã€‚å¦‚æœè°ƒç”¨çš„æ˜¯æ— å‚ join æ–¹æ³•ï¼Œåˆ™ç­‰å¾… thread æ‰§è¡Œå®Œæ¯•ï¼Œå¦‚æœè°ƒç”¨çš„æ˜¯æŒ‡å®šäº†æ—¶é—´å‚æ•°çš„ join æ–¹æ³•ï¼Œåˆ™ç­‰å¾…ä¸€å®šçš„æ—¶é—´ã€‚ 123456789101112131415161718192021222324252627282930public class Test &#123; public static void main(String[] args) throws IOException &#123; System.out.println(\"è¿›å…¥çº¿ç¨‹\"+Thread.currentThread().getName()); Test test = new Test(); MyThread thread1 = test.new MyThread(); thread1.start(); try &#123; System.out.println(\"çº¿ç¨‹\"+Thread.currentThread().getName()+\"ç­‰å¾…\"); thread1.join(); System.out.println(\"çº¿ç¨‹\"+Thread.currentThread().getName()+\"ç»§ç»­æ‰§è¡Œ\"); &#125; catch (InterruptedException e) &#123; // TODO Auto-generated catch block e.printStackTrace(); &#125; &#125; class MyThread extends Thread&#123; @Override public void run() &#123; System.out.println(\"è¿›å…¥çº¿ç¨‹\"+Thread.currentThread().getName()); try &#123; Thread.currentThread().sleep(5000); &#125; catch (InterruptedException e) &#123; // TODO: handle exception &#125; System.out.println(\"çº¿ç¨‹\"+Thread.currentThread().getName()+\"æ‰§è¡Œå®Œæ¯•\"); &#125; &#125;&#125; interrupt æ–¹æ³• å•ç‹¬è°ƒç”¨ interrupt æ–¹æ³•å¯ä»¥ä½¿å¾—å¤„äºé˜»å¡çŠ¶æ€çš„çº¿ç¨‹æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œä¹Ÿå°±è¯´ï¼Œå®ƒå¯ä»¥ç”¨æ¥ä¸­æ–­ä¸€ä¸ªæ­£å¤„äºé˜»å¡çŠ¶æ€çš„çº¿ç¨‹ï¼›å¦å¤–ï¼Œé€šè¿‡å¯ä»¥é€šè¿‡ interrupt æ–¹æ³•å’Œ isInterrupted æ–¹æ³•æ¥åœæ­¢æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ã€‚ 12345678910111213141516171819202122232425262728public class Test &#123; public static void main(String[] args) throws IOException &#123; Test test = new Test(); MyThread thread = test.new MyThread(); thread.start(); try &#123; Thread.currentThread().sleep(2000); // æ­¤çº¿ç¨‹ç¡çœ  2s &#125; catch (InterruptedException e) &#123; &#125; thread.interrupt(); // é˜»å¡çŠ¶æ€ä¸­è¢«æ‰“æ–­ï¼ŒæŠ›å‡ºå¼‚å¸¸ InterruptedException &#125; class MyThread extends Thread&#123; @Override public void run() &#123; try &#123; System.out.println(\"è¿›å…¥ç¡çœ çŠ¶æ€\"); Thread.currentThread().sleep(10000); System.out.println(\"ç¡çœ å®Œæ¯•\"); &#125; catch (InterruptedException e) &#123; System.out.println(\"å¾—åˆ°ä¸­æ–­å¼‚å¸¸\"); &#125; System.out.println(\"runæ–¹æ³•æ‰§è¡Œå®Œæ¯•\"); &#125; &#125;&#125; ä¸Šé¢çš„ä¾‹å­è¡¨æ˜äº† interrupt æ–¹æ³•å¯ä»¥ä¸­æ–­å¤„äºé˜»å¡çŠ¶æ€çš„çº¿ç¨‹ï¼Œé‚£ä¹ˆèƒ½ä¸èƒ½ä¸­æ–­å¤„äºéé˜»å¡çŠ¶æ€çš„çº¿ç¨‹å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ä¸èƒ½ã€‚ä½†æ˜¯å¦‚æœé…åˆ isInterrupted æ–¹æ³•èƒ½å¤Ÿä¸­æ–­æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ï¼Œå› ä¸ºè°ƒç”¨ interrupt æ–¹æ³•ç›¸å½“äºå°†ä¸­æ–­æ ‡å¿—ä½ç½®ä¸º trueï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡è°ƒç”¨ isInterrupted æ–¹æ³•åˆ¤æ–­ä¸­æ–­æ ‡å¿—æ˜¯å¦è¢«ç½®ä½æ¥ä¸­æ–­çº¿ç¨‹çš„æ‰§è¡Œã€‚ 1234567891011121314151617181920212223242526public class Test &#123; public static void main(String[] args) throws IOException &#123; Test test = new Test(); MyThread thread = test.new MyThread(); thread.start(); try &#123; Thread.currentThread().sleep(2000); &#125; catch (InterruptedException e) &#123; &#125; thread.interrupt(); &#125; class MyThread extends Thread&#123; @Override public void run() &#123; int i = 0; // ä¸æ¨èè¿™ä¹ˆç”¨ï¼Œå¯è‡ªå®šä¹‰ä¸€ä¸ªæ ‡è¯†ç¬¦ç”¨äºé€€å‡ºå¾ªç¯ while(!isInterrupted() &amp;&amp; i&lt;Integer.MAX_VALUE)&#123; System.out.println(i+\" whileå¾ªç¯\"); i++; &#125; &#125; &#125;&#125; çº¿ç¨‹å±æ€§getId()ï¼šè·å–çº¿ç¨‹ IDï¼›getName()ã€setName()ï¼šè®¾ç½®ã€è·å–çº¿ç¨‹åç§°ï¼›getPriority()ã€setPriority()ï¼šè®¾ç½®ã€è·å–ä¼˜å…ˆçº§ï¼›setDaemon()ã€isDaemon()ï¼šè®¾ç½®ã€åˆ¤æ–­å®ˆæŠ¤è¿›ç¨‹ï¼›Thread ç±»æœ‰ä¸€ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„é™æ€æ–¹æ³• currentThread() ç”¨æ¥è·å–å½“å‰çº¿ç¨‹ã€‚ å®ˆæŠ¤çº¿ç¨‹å’Œç”¨æˆ·çº¿ç¨‹çš„åŒºåˆ«åœ¨äºï¼šå®ˆæŠ¤çº¿ç¨‹ä¾èµ–äºåˆ›å»ºå®ƒçš„çº¿ç¨‹ï¼Œè€Œç”¨æˆ·çº¿ç¨‹åˆ™ä¸ä¾èµ–ã€‚ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼šå¦‚æœåœ¨ main çº¿ç¨‹ä¸­åˆ›å»ºäº†ä¸€ä¸ªå®ˆæŠ¤çº¿ç¨‹ï¼Œå½“ main æ–¹æ³•è¿è¡Œå®Œæ¯•ä¹‹åï¼Œå®ˆæŠ¤çº¿ç¨‹ä¹Ÿä¼šéšç€æ¶ˆäº¡ã€‚è€Œç”¨æˆ·çº¿ç¨‹åˆ™ä¸ä¼šï¼Œç”¨æˆ·çº¿ç¨‹ä¼šä¸€ç›´è¿è¡Œç›´åˆ°å…¶è¿è¡Œå®Œæ¯•ã€‚åœ¨ JVM ä¸­ï¼Œåƒåƒåœ¾æ”¶é›†å™¨çº¿ç¨‹å°±æ˜¯å®ˆæŠ¤çº¿ç¨‹ã€‚","categories":[{"name":"Java","slug":"Java","permalink":"http://yoursite.com/categories/Java/"}],"tags":[{"name":"High Concurrency","slug":"High-Concurrency","permalink":"http://yoursite.com/tags/High-Concurrency/"}]},{"title":"çº¿ç¨‹ä¸è¿›ç¨‹","slug":"Java/HighConcurrency/çº¿ç¨‹ä¸è¿›ç¨‹","date":"2020-03-28T06:25:21.000Z","updated":"2020-03-28T08:22:27.976Z","comments":true,"path":"2020/03/28/Java/HighConcurrency/çº¿ç¨‹ä¸è¿›ç¨‹/","link":"","permalink":"http://yoursite.com/2020/03/28/Java/HighConcurrency/%E7%BA%BF%E7%A8%8B%E4%B8%8E%E8%BF%9B%E7%A8%8B/","excerpt":"Java ä¸­çš„åº”ç”¨ç¨‹åºå’Œè¿›ç¨‹ç›¸å…³çš„æ¦‚å¿µçŸ¥è¯†ã€é˜è¿°å¦‚ä½•åˆ›å»ºçº¿ç¨‹ä»¥åŠå¦‚ä½•åˆ›å»ºè¿›ç¨‹ã€‚","text":"Java ä¸­çš„åº”ç”¨ç¨‹åºå’Œè¿›ç¨‹ç›¸å…³çš„æ¦‚å¿µçŸ¥è¯†ã€é˜è¿°å¦‚ä½•åˆ›å»ºçº¿ç¨‹ä»¥åŠå¦‚ä½•åˆ›å»ºè¿›ç¨‹ã€‚ åœ¨ Java ä¸­ï¼Œä¸€ä¸ªåº”ç”¨ç¨‹åºå¯¹åº”ç€ä¸€ä¸ª JVM å®ä¾‹ã€‚Javaé‡‡ç”¨çš„æ˜¯å•çº¿ç¨‹ç¼–ç¨‹æ¨¡å‹ï¼Œå³åœ¨ç¨‹åºä¸­å¦‚æœæ²¡æœ‰ä¸»åŠ¨åˆ›å»ºçº¿ç¨‹çš„è¯ï¼Œåªä¼šåˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œé€šå¸¸ç§°ä¸ºä¸»çº¿ç¨‹ã€‚ä½†æ˜¯è¦æ³¨æ„ï¼Œè™½ç„¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œä¸ä»£è¡¨ JVM ä¸­åªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼ŒJVM å®ä¾‹åœ¨åˆ›å»ºçš„æ—¶å€™ï¼ŒåŒæ—¶ä¼šåˆ›å»ºå¾ˆå¤šå…¶ä»–çš„çº¿ç¨‹ï¼ˆæ¯”å¦‚åƒåœ¾æ”¶é›†å™¨çº¿ç¨‹ï¼‰ã€‚ ç”±äº Java é‡‡ç”¨çš„æ˜¯å•çº¿ç¨‹ç¼–ç¨‹æ¨¡å‹ï¼Œå› æ­¤åœ¨è¿›è¡Œ UI ç¼–ç¨‹æ—¶è¦æ³¨æ„å°†è€—æ—¶çš„æ“ä½œæ”¾åœ¨å­çº¿ç¨‹ä¸­è¿›è¡Œï¼Œä»¥é¿å…é˜»å¡ä¸»çº¿ç¨‹ï¼ˆåœ¨UIç¼–ç¨‹æ—¶ï¼Œä¸»çº¿ç¨‹å³UIçº¿ç¨‹ï¼Œç”¨æ¥å¤„ç†ç”¨æˆ·çš„äº¤äº’äº‹ä»¶ï¼‰ã€‚ çº¿ç¨‹çš„åˆ›å»º 1ï¼‰ç»§æ‰¿ Thread ç±»ï¼› 2ï¼‰å®ç° Runnable æ¥å£ã€‚ ç»§æ‰¿ Thread ç±»12345678910111213class MyThread extends Thread&#123; private static int num = 0; public MyThread()&#123; num++; &#125; @Override public void run() &#123; System.out.println(\"ä¸»åŠ¨åˆ›å»ºçš„ç¬¬\"+num+\"ä¸ªçº¿ç¨‹\"); &#125;&#125; åˆ›å»ºå¥½äº†è‡ªå·±çš„çº¿ç¨‹ç±»ä¹‹åï¼Œå°±å¯ä»¥åˆ›å»ºçº¿ç¨‹å¯¹è±¡äº†ï¼Œç„¶åé€šè¿‡start()æ–¹æ³•å»å¯åŠ¨çº¿ç¨‹ã€‚ 123456public class Test &#123; public static void main(String[] args) &#123; MyThread thread = new MyThread(); // åˆ›å»ºä¸€ä¸ªå­çº¿ç¨‹å¯¹è±¡ thread.start(); // è¿è¡Œå­çº¿ç¨‹çš„ run() æ–¹æ³• &#125;&#125; æ³¨æ„ï¼Œä¸æ˜¯è°ƒç”¨run()æ–¹æ³•å¯åŠ¨çº¿ç¨‹ï¼Œrun()æ–¹æ³•ä¸­åªæ˜¯å®šä¹‰éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¦‚æœè°ƒç”¨run()æ–¹æ³•ï¼Œå³ç›¸å½“äºåœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œrun()æ–¹æ³•ï¼Œè·Ÿæ™®é€šçš„æ–¹æ³•è°ƒç”¨æ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼Œæ­¤æ—¶å¹¶ä¸ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹æ¥æ‰§è¡Œå®šä¹‰çš„ä»»åŠ¡ã€‚ 123456789101112131415161718192021222324// é”™è¯¯æ¡ˆä¾‹public class Test &#123; public static void main(String[] args) &#123; System.out.println(\"ä¸»çº¿ç¨‹ID:\"+Thread.currentThread().getId()); // è·å–ä¸»çº¿ç¨‹çš„ ID MyThread thread01 = new MyThread(\"Thread01\"); thread01.start(); // æ­£ç¡®è°ƒç”¨ï¼Œå¼€å¯å­çº¿ç¨‹è¿è¡Œ run() æ–¹æ³• MyThread thread02 = new MyThread(\"Thread02\"); thread02.run(); // é”™è¯¯è°ƒç”¨ï¼Œè¿è¡Œä¸»ç¨‹åºçš„ run() æ–¹æ³• &#125;&#125; class MyThread extends Thread&#123; private String name; public MyThread(String name)&#123; this.name = name; &#125; @Override public void run() &#123; System.out.println(\"name:\"+name+\" å­çº¿ç¨‹ID:\"+Thread.currentThread().getId()); &#125;&#125; å®ç° Runnable æ¥å£Runnable çš„ä¸­æ–‡æ„æ€æ˜¯â€ä»»åŠ¡â€œï¼Œé¡¾åæ€ä¹‰ï¼Œé€šè¿‡å®ç° Runnable æ¥å£ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå­ä»»åŠ¡ï¼Œç„¶åå°†å­ä»»åŠ¡äº¤ç”± Thread å»æ‰§è¡Œã€‚æ³¨æ„ï¼Œè¿™ç§æ–¹å¼å¿…é¡»å°† Runnable ä½œä¸º Thread ç±»çš„å‚æ•°ï¼Œç„¶åé€šè¿‡ Thread çš„start()æ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹æ¥æ‰§è¡Œè¯¥å­ä»»åŠ¡ã€‚å¦‚æœè°ƒç”¨ Runnable çš„run()æ–¹æ³•çš„è¯ï¼Œæ˜¯ä¸ä¼šåˆ›å»ºæ–°çº¿ç¨‹çš„ï¼Œè¿™æ ¹æ™®é€šçš„æ–¹æ³•è°ƒç”¨æ²¡æœ‰ä»»ä½•åŒºåˆ«ã€‚ 123456789101112131415161718192021public class Test &#123; public static void main(String[] args) &#123; System.out.println(\"ä¸»çº¿ç¨‹IDï¼š\"+Thread.currentThread().getId()); MyRunnable runnable = new MyRunnable(); Thread thread = new Thread(runnable); // å°†ä»»åŠ¡ Runnable äº¤ç”± Thread å¤„ç† thread.start(); &#125;&#125; class MyRunnable implements Runnable&#123; public MyRunnable() &#123; &#125; @Override public void run() &#123; System.out.println(\"å­çº¿ç¨‹IDï¼š\"+Thread.currentThread().getId()); &#125;&#125; Thread VS. Runnable äº‹å®ä¸Šï¼ŒæŸ¥çœ‹ Thread ç±»çš„å®ç°æºä»£ç ä¼šå‘ç° Thread ç±»æ˜¯å®ç°äº† Runnable æ¥å£çš„ã€‚ åœ¨ Java ä¸­ï¼Œè¿™ä¸¤ç§æ–¹å¼éƒ½å¯ä»¥ç”¨æ¥åˆ›å»ºçº¿ç¨‹å»æ‰§è¡Œå­ä»»åŠ¡ï¼Œå…·ä½“é€‰æ‹©å“ªä¸€ç§æ–¹å¼è¦çœ‹è‡ªå·±çš„éœ€æ±‚ã€‚ç›´æ¥ç»§æ‰¿ Thread ç±»çš„è¯ï¼Œå¯èƒ½æ¯”å®ç° Runnable æ¥å£çœ‹èµ·æ¥æ›´åŠ ç®€æ´ï¼Œä½†æ˜¯ç”±äº Java åªå…è®¸å•ç»§æ‰¿ï¼Œæ‰€ä»¥å¦‚æœè‡ªå®šä¹‰ç±»éœ€è¦ç»§æ‰¿å…¶ä»–ç±»ï¼Œåˆ™åªèƒ½é€‰æ‹©å®ç° Runnable æ¥å£ã€‚ è¿›ç¨‹çš„åˆ›å»º 1ï¼‰é€šè¿‡ Runtime.exec() æ–¹æ³•æ¥ï¼› 2ï¼‰é€šè¿‡ ProcessBuilder çš„ start() æ–¹æ³•ã€‚ é¦–å…ˆè¦è®²çš„æ˜¯ Process ç±»ï¼ŒProcess ç±»æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œåœ¨å®ƒé‡Œé¢ä¸»è¦æœ‰å‡ ä¸ªæŠ½è±¡çš„æ–¹æ³•ã€‚ 12345678910// java.lang.Processpublic abstract class Process &#123; abstract public OutputStream getOutputStream(); // è·å–è¿›ç¨‹çš„è¾“å‡ºæµ abstract public InputStream getInputStream(); // è·å–è¿›ç¨‹çš„è¾“å…¥æµ abstract public InputStream getErrorStream(); // è·å–è¿›ç¨‹çš„é”™è¯¯æµ abstract public int waitFor() throws InterruptedException; // è®©è¿›ç¨‹ç­‰å¾… abstract public int exitValue(); // è·å–è¿›ç¨‹çš„é€€å‡ºæ ‡å¿— abstract public void destroy(); // æ‘§æ¯è¿›ç¨‹&#125; ProcessBuilderProcessBuilder æ˜¯ä¸€ä¸ª final ç±»ï¼Œå®ƒæœ‰ä¸¤ä¸ªæ„é€ å™¨ã€‚ 123456789101112131415161718192021public final class ProcessBuilder &#123; private List&lt;String&gt; command; private File directory; private Map&lt;String,String&gt; environment; private boolean redirectErrorStream; // ä¼ é€’åˆ›å»ºè¿›ç¨‹éœ€è¦çš„å‘½ä»¤å‚æ•° public ProcessBuilder(List&lt;String&gt; command) &#123; if (command == null) throw new NullPointerException(); this.command = command; &#125; // ä¸å®šé•¿å­—ç¬¦ä¸²çš„å½¢å¼ public ProcessBuilder(String... command) &#123; this.command = new ArrayList&lt;String&gt;(command.length); for (String arg : command) this.command.add(arg); &#125; // ....&#125; é€šè¿‡ ProcessBuilder æ¥å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹æ‰“å¼€ cmdï¼Œå¹¶è·å– ip åœ°å€ä¿¡æ¯ã€‚ 123456789101112public class Test &#123; public static void main(String[] args) throws IOException &#123; ProcessBuilder pb = new ProcessBuilder(\"cmd\",\"/c\",\"ipconfig/all\"); // ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ª List Process process = pb.start(); Scanner scanner = new Scanner(process.getInputStream()); while(scanner.hasNextLine())&#123; System.out.println(scanner.nextLine()); &#125; scanner.close(); &#125;&#125; Runtime.exec()ç”±äºä»»ä½•è¿›ç¨‹åªä¼šè¿è¡Œäºä¸€ä¸ªè™šæ‹Ÿæœºå®ä¾‹å½“ä¸­ï¼Œæ‰€ä»¥åœ¨Runtimeä¸­é‡‡ç”¨äº†å•ä¾‹æ¨¡å¼ï¼Œå³åªä¼šäº§ç”Ÿä¸€ä¸ªè™šæ‹Ÿæœºå®ä¾‹. 12345678910111213141516171819public class Runtime &#123; private static Runtime currentRuntime = new Runtime(); public static Runtime getRuntime() &#123; return currentRuntime; &#125; private Runtime() &#123;&#125; // ... public Process exec(String[] cmdarray, String[] envp, File dir) // æ‰€æœ‰å®ç°çš„æœ€ç»ˆå®ç° throws IOException &#123; return new ProcessBuilder(cmdarray) // è°ƒç”¨ ProcessBuilder è¿›è¡Œå®ç° .environment(envp) .directory(dir) .start(); &#125;&#125; é€šè¿‡ Runtime.exec() æ¥å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹æ‰“å¼€ cmdï¼Œå¹¶è·å– ip åœ°å€ä¿¡æ¯ã€‚ 123456789101112public class Test &#123; public static void main(String[] args) throws IOException &#123; String cmd = \"cmd \"+\"/c \"+\"ipconfig/all\"; // ä¸æ”¯æŒä¸å®šé•¿å‚æ•°ï¼Œå¿…é¡»è¿›è¡Œæ‹¼æ¥ Process process = Runtime.getRuntime().exec(cmd); Scanner scanner = new Scanner(process.getInputStream()); while(scanner.hasNextLine())&#123; System.out.println(scanner.nextLine()); &#125; scanner.close(); &#125;&#125;","categories":[{"name":"Java","slug":"Java","permalink":"http://yoursite.com/categories/Java/"}],"tags":[{"name":"High Concurrency","slug":"High-Concurrency","permalink":"http://yoursite.com/tags/High-Concurrency/"}]},{"title":"è¡Œä¸ºå‹æ¨¡å¼","slug":"Java/DesignPatterns/è¡Œä¸ºå‹æ¨¡å¼","date":"2020-03-24T08:30:21.000Z","updated":"2020-04-19T06:27:11.986Z","comments":true,"path":"2020/03/24/Java/DesignPatterns/è¡Œä¸ºå‹æ¨¡å¼/","link":"","permalink":"http://yoursite.com/2020/03/24/Java/DesignPatterns/%E8%A1%8C%E4%B8%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F/","excerpt":"è®¾è®¡æ¨¡å¼ä¹‹è¡Œä¸ºå‹æ¨¡å¼ã€‚","text":"è®¾è®¡æ¨¡å¼ä¹‹è¡Œä¸ºå‹æ¨¡å¼ã€‚ æ¨¡æ¿æ–¹æ³•æ¨¡å¼ å®šä¹‰ä¸€ä¸ªæ“ä½œä¸­çš„ç®—æ³•çš„éª¨æ¶ï¼Œè€Œå°†ä¸€äº›æ­¥éª¤å»¶è¿Ÿåˆ°å­ç±»ä¸­ï¼Œä½¿å¾—å­ç±»å¯ä»¥ä¸æ”¹å˜ä¸€ä¸ªç®—æ³•çš„ç»“æ„ï¼Œå°±å¯ä»¥é‡å®šä¹‰è¯¥ç®—æ³•çš„æŸäº›ç‰¹å®šæ­¥éª¤ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748public class Client &#123; public static void main(String[] args) &#123; // åˆ¶ä½œçº¢è±†è±†æµ† System.out.println(\"---åˆ¶ä½œçº¢è±†è±†æµ†---\"); SoyaMilk redBeanSoyaMilk = new RedBeanSoyaMilk(); redBeanSoyaMilk.make(); System.out.println(\"---åˆ¶ä½œèŠ±ç”Ÿè±†æµ†---\"); SoyaMilk peanutSoyaMilk = new PeanutSoyaMilk(); peanutSoyaMilk.make(); &#125;&#125;// æŠ½è±¡ç±»ï¼Œè¡¨ç¤ºè±†æµ†public abstract class SoyaMilk &#123; // final ç±»å‹çš„æ¨¡æ¿æ–¹æ³•ï¼šé˜²æ­¢å­ç±»è¦†ç›– final void make() &#123; select(); addCondiments(); soak(); beat(); &#125; // é€‰ææ–™ void select() &#123; System.out.println(\"ç¬¬ä¸€æ­¥ï¼šé€‰æ‹©å¥½çš„æ–°é²œé»„è±†\"); &#125; // æ·»åŠ ä¸åŒçš„é…æ–™ï¼šæŠ½è±¡æ–¹æ³•ç”±å­ç±»å…·ä½“å®ç° abstract void addCondiments(); // æµ¸æ³¡ void soak() &#123; System.out.println(\"ç¬¬ä¸‰æ­¥ï¼šé»„è±†å’Œé…æ–™å¼€å§‹æµ¸æ³¡ï¼ˆ3å°æ—¶ï¼‰\"); &#125; void beat() &#123; System.out.println(\"ç¬¬å››æ­¥ï¼šé»„è±†å’Œé…æ–™æ”¾åˆ°è±†æµ†æœºå»æ‰“ç¢\"); &#125;&#125;public class PeanutSoyaMilk extends SoyaMilk &#123; @Override void addCondiments() &#123; System.out.println(\" åŠ å…¥ä¸Šå¥½çš„èŠ±ç”Ÿ \"); &#125;&#125;public class RedBeanSoyaMilk extends SoyaMilk &#123; @Override void addCondiments() &#123; System.out.println(\" åŠ å…¥ä¸Šå¥½çš„çº¢è±† \"); &#125;&#125; é’©å­æ–¹æ³•1234567891011121314151617181920212223242526272829/æŠ½è±¡ç±»ï¼Œè¡¨ç¤ºè±†æµ† public abstract class SoyaMilk &#123; final void make() &#123; select(); // é’©å­ if(customerWantCondiments()) &#123; addCondiments(); &#125; soak(); beat(); &#125; // é€‰ææ–™ void select() &#123; System.out.println(\"ç¬¬ä¸€æ­¥ï¼šé€‰æ‹©å¥½çš„æ–°é²œé»„è±†\"); &#125; // é’©å­ï¼šæ·»åŠ ä¸åŒçš„é…æ–™ï¼šæŠ½è±¡æ–¹æ³•ç”±å­ç±»å…·ä½“å®ç° abstract void addCondiments(); // æµ¸æ³¡ void soak() &#123; System.out.println(\"ç¬¬ä¸‰æ­¥ï¼šé»„è±†å’Œé…æ–™å¼€å§‹æµ¸æ³¡ï¼ˆ3å°æ—¶ï¼‰\"); &#125; void beat() &#123; System.out.println(\"ç¬¬å››æ­¥ï¼šé»„è±†å’Œé…æ–™æ”¾åˆ°è±†æµ†æœºå»æ‰“ç¢\"); &#125; // é’©å­æ–¹æ³•ï¼šå†³å®šæ˜¯å¦éœ€è¦æ·»åŠ é…æ–™ boolean customerWantCondiments() &#123; return true; &#125; &#125; Spring å‘½ä»¤æ¨¡å¼ å‘½ä»¤æ¨¡å¼ï¼ˆCommand Patternï¼‰ï¼šåœ¨è½¯ä»¶è®¾è®¡ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦å‘æŸäº›å¯¹è±¡å‘é€è¯·æ±‚ï¼Œä½†æ˜¯å¹¶ä¸çŸ¥é“è¯·æ±‚çš„æ¥æ”¶è€…æ˜¯è°ï¼Œä¹Ÿä¸çŸ¥é“è¢«è¯·æ±‚çš„æ“ä½œæ˜¯å“ªä¸ªï¼Œåªéœ€åœ¨ç¨‹åºè¿è¡Œæ—¶æŒ‡å®šå…·ä½“çš„è¯·æ±‚æ¥æ”¶è€…å³å¯ï¼Œæ­¤æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤æ¨¡å¼æ¥è¿›è¡Œè®¾è®¡ã€‚ å‘½åæ¨¡å¼ä½¿å¾—è¯·æ±‚å‘é€è€…ä¸è¯·æ±‚æ¥æ”¶è€…æ¶ˆé™¤å½¼æ­¤ä¹‹é—´çš„è€¦åˆï¼Œè®©å¯¹è±¡ä¹‹é—´çš„è°ƒç”¨å…³ç³»æ›´åŠ çµæ´»ï¼Œå®ç°è§£è€¦ã€‚è¯·æ±‚å‘èµ·è€…å’Œè¯·æ±‚æ‰§è¡Œè€…ä¹‹é—´çš„è§£è€¦æ˜¯é€šè¿‡å‘½ä»¤å¯¹è±¡å®ç°çš„ï¼Œå‘½ä»¤å¯¹è±¡èµ·åˆ°äº†çº½å¸¦æ¡¥æ¢çš„ä½œç”¨ã€‚ åœ¨å‘½åæ¨¡å¼ä¸­ï¼Œä¼šå°†ä¸€ä¸ªè¯·æ±‚å°è£…ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œä»¥ä¾¿ä½¿ç”¨ä¸åŒå‚æ•°æ¥è¡¨ç¤ºä¸åŒçš„è¯·æ±‚(å³å‘½å)ï¼ŒåŒæ—¶å‘½ä»¤æ¨¡å¼ä¹Ÿæ”¯æŒå¯æ’¤é”€çš„æ“ä½œã€‚ ç©ºå‘½ä»¤ä¹Ÿæ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œå®ƒä¸ºæˆ‘ä»¬çœå»äº†åˆ¤ç©ºçš„æ“ä½œã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128public class Client &#123; public static void main(String[] args) &#123; // ä½¿ç”¨å‘½ä»¤è®¾è®¡æ¨¡å¼ï¼Œå®Œæˆé€šè¿‡é¥æ§å™¨å¯¹ç”µç¯è¿›è¡Œæ“ä½œ // åˆ›å»ºç”µç¯çš„å¯¹è±¡ï¼šæ¥å—è€… LightReceiver lightReceiver = new LightReceiver(); // åˆ›å»ºç”µç¯ç›¸å…³çš„å¼€å…³å‘½ä»¤ LightOnCommand lightOnCommand = new LightOnCommand(lightReceiver); LightOffCommand lightOffCommand = new LightOffCommand(lightReceiver); // éœ€è¦ä¸€ä¸ªé¥æ§å™¨ï¼šè°ƒç”¨è€… RemoteController remoteController = new RemoteController(); // ç»™æˆ‘ä»¬çš„é¥æ§å™¨è®¾ç½®å‘½ä»¤, æ¯”å¦‚ no = 0 æ˜¯ç”µç¯çš„å¼€å’Œå…³çš„æ“ä½œ remoteController.setCommand(0, lightOnCommand, lightOffCommand); System.out.println(\"---æŒ‰ä¸‹ç¯çš„å¼€æŒ‰é’®---\"); remoteController.onButtonWasPushed(0); System.out.println(\"---æŒ‰ä¸‹ç¯çš„å…³æŒ‰é’®---\"); remoteController.offButtonWasPushed(0); System.out.println(\"---æŒ‰ä¸‹æ’¤é”€æŒ‰é’®---\"); remoteController.undoButtonWasPushed(); &#125;&#125;// åˆ›å»ºå‘½ä»¤æ¥å£public interface Command &#123; // æ‰§è¡ŒåŠ¨ä½œ(æ“ä½œ) public void execute(); // æ’¤é”€åŠ¨ä½œ(æ“ä½œ) public void undo();&#125;// æ¥æ”¶è€…public class LightReceiver &#123; public void on() &#123; System.out.println(\" ç”µç¯æ‰“å¼€äº†... \"); &#125; public void off() &#123; System.out.println(\" ç”µç¯å…³é—­äº†... \"); &#125;&#125;// ç”µç¯æ“ä½œå‘½ä»¤å…·ä½“å®ç°public class LightOffCommand implements Command &#123; // èšåˆ LightReceiverï¼šæ¥æ”¶è€… LightReceiver light; // æ„é€ å™¨ public LightOffCommand(LightReceiver light) &#123; super(); this.light = light; &#125; @Override public void execute() &#123; // è°ƒç”¨æ¥æ”¶è€…çš„æ–¹æ³• light.off(); &#125; @Override public void undo() &#123; // è°ƒç”¨æ¥æ”¶è€…çš„æ–¹æ³• light.on(); &#125;&#125;public class LightOnCommand implements Command &#123; // èšåˆ LightReceiver LightReceiver light; // æ„é€ å™¨ public LightOnCommand(LightReceiver light) &#123; super(); this.light = light; &#125; @Override public void execute() &#123; // è°ƒç”¨æ¥æ”¶è€…çš„æ–¹æ³• light.on(); &#125; @Override public void undo() &#123; // è°ƒç”¨æ¥æ”¶è€…çš„æ–¹æ³• light.off(); &#125;&#125;// ç©ºå‘½ä»¤æ¨¡å¼public class NoCommand implements Command &#123; @Override public void execute() &#123; &#125; @Override public void undo() &#123; &#125;&#125;public class RemoteController &#123; // å¼€æŒ‰é’®çš„å‘½ä»¤æ•°ç»„ Command[] onCommands; Command[] offCommands; // æ‰§è¡Œæ’¤é”€çš„å‘½ä»¤ Command undoCommand; // æ„é€ å™¨ï¼Œå®Œæˆå¯¹æŒ‰é’®åˆå§‹åŒ– public RemoteController() &#123; onCommands = new Command[5]; offCommands = new Command[5]; for (int i = 0; i &lt; 5; i++) &#123; onCommands[i] = new NoCommand(); offCommands[i] = new NoCommand(); &#125; &#125; // ç»™æˆ‘ä»¬çš„æŒ‰é’®è®¾ç½®ä½ éœ€è¦çš„å‘½ä»¤ public void setCommand(int no, Command onCommand, Command offCommand) &#123; onCommands[no] = onCommand; offCommands[no] = offCommand; &#125; // æŒ‰ä¸‹å¼€æŒ‰é’® public void onButtonWasPushed(int no) &#123; // no 0 // æ‰¾åˆ°ä½ æŒ‰ä¸‹çš„å¼€çš„æŒ‰é’®ï¼Œ å¹¶è°ƒç”¨å¯¹åº”æ–¹æ³• onCommands[no].execute(); // è®°å½•è¿™æ¬¡çš„æ“ä½œï¼Œç”¨äºæ’¤é”€ undoCommand = onCommands[no]; &#125; // æŒ‰ä¸‹å¼€æŒ‰é’® public void offButtonWasPushed(int no) &#123; // no 0 // æ‰¾åˆ°ä½ æŒ‰ä¸‹çš„å…³çš„æŒ‰é’®ï¼Œ å¹¶è°ƒç”¨å¯¹åº”æ–¹æ³• offCommands[no].execute(); // è®°å½•è¿™æ¬¡çš„æ“ä½œï¼Œç”¨äºæ’¤é”€ undoCommand = offCommands[no]; &#125; // æŒ‰ä¸‹æ’¤é”€æŒ‰é’® public void undoButtonWasPushed() &#123; undoCommand.undo(); &#125;&#125; è®¿é—®è€…æ¨¡å¼ è®¿é—®è€…æ¨¡å¼ï¼ˆVisitor Patternï¼‰ï¼Œå°è£…ä¸€äº›ä½œç”¨äºæŸç§æ•°æ®ç»“æ„çš„å„å…ƒç´ çš„æ“ä½œï¼Œå®ƒå¯ä»¥åœ¨ä¸æ”¹å˜æ•°æ®ç»“æ„çš„å‰æä¸‹å®šä¹‰ä½œç”¨äºè¿™äº›å…ƒç´ çš„æ–°çš„æ“ä½œã€‚ ä¸»è¦å°†æ•°æ®ç»“æ„ä¸æ•°æ®æ“ä½œåˆ†ç¦»ï¼Œè§£å†³æ•°æ®ç»“æ„å’Œæ“ä½œè€¦åˆæ€§é—®é¢˜ï¼Œå…¶åŸºæœ¬åŸç†æ˜¯åœ¨è¢«è®¿é—®çš„ç±»é‡Œé¢åŠ ä¸€ä¸ªå¯¹å¤–æä¾›æ¥å¾…è®¿é—®è€…çš„æ¥å£ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495public class Client &#123; public static void main(String[] args) &#123; // åˆ›å»º ObjectStructureï¼šæšä¸¾å…ƒç´ ï¼Œç”¨æ¥å…è®¸è®¿é—®è€…è®¿é—®å…ƒç´  ObjectStructure objectStructure = new ObjectStructure(); // åŒåˆ†æ´¾ï¼š1.åˆ†æ´¾è®¿é—®è€… objectStructure.attach(new Man()); objectStructure.attach(new Woman()); // æˆåŠŸ 2.æ ¹æ®è®¿é—®è€…åˆ†å‘ä»»åŠ¡ Success success = new Success(); objectStructure.display(success); System.out.println(\"=======\"); Fail fail = new Fail(); objectStructure.display(fail); System.out.println(\"===å¾…å®šæµ‹è¯„===\"); Wait wait = new Wait(); objectStructure.display(wait); &#125;&#125;// æ•°æ®ç»“æ„ï¼Œç®¡ç† Man Womanpublic class ObjectStructure &#123; // ç»´æŠ¤äº†ä¸€ä¸ªé›†åˆ private List&lt;Person&gt; persons = new LinkedList&lt;&gt;(); // å¢åŠ  Element public void attach(Person p) &#123; persons.add(p); &#125; // ç§»é™¤ Element public void detach(Person p) &#123; persons.remove(p); &#125; // æ˜¾ç¤ºæµ‹è¯„æƒ…å†µ public void display(Action action) &#123; for(Person p: persons) &#123; p.accept(action); &#125; &#125;&#125;// Elementpublic abstract class Person &#123; public abstract void accept(Action action);&#125;public class Man extends Person &#123; @Override public void accept(Action action) &#123; action.getManResult(this); &#125;&#125;public class Woman extends Person&#123; @Override public void accept(Action action) &#123; action.getWomanResult(this); &#125;&#125;// Visitorï¼šä¸º Element æä¾›å…·ä½“æ“ä½œpublic abstract class Action &#123; // ç”·æ€§è¯„ä»· public abstract void getManResult(Man man); // å¥³æ€§è¯„ä»· public abstract void getWomanResult(Woman woman);&#125;public class Success extends Action &#123; @Override public void getManResult(Man man) &#123; System.out.println(\" ç”·äººç»™å¥½è¯„ !\"); &#125; @Override public void getWomanResult(Woman woman) &#123; System.out.println(\" å¥³äººç»™å¥½è¯„ !\"); &#125;&#125;public class Fail extends Action &#123; @Override public void getManResult(Man man) &#123; System.out.println(\" ç”·äººç»™å·®è¯„ !\"); &#125; @Override public void getWomanResult(Woman woman) &#123; System.out.println(\" å¥³äººç»™å·®è¯„ !\"); &#125;&#125;public class Wait extends Action &#123; @Override public void getManResult(Man man) &#123; System.out.println(\" ç”·äººç»™çš„è¯„ä»·æ˜¯è¯¥æ­Œæ‰‹å¾…å®š \"); &#125; @Override public void getWomanResult(Woman woman) &#123; System.out.println(\" å¥³äººç»™çš„è¯„ä»·æ˜¯è¯¥æ­Œæ‰‹å¾…å®š \"); &#125;&#125; è¿­ä»£å™¨æ¨¡å¼ è¿­ä»£å™¨æ¨¡å¼ï¼Œæä¾›ä¸€ç§éå†é›†åˆå…ƒç´ çš„ç»Ÿä¸€æ¥å£ï¼Œç”¨ä¸€è‡´çš„æ–¹æ³•éå†é›†åˆå…ƒç´ ï¼Œä¸éœ€è¦çŸ¥é“é›†åˆå¯¹è±¡çš„åº•å±‚è¡¨ç¤ºï¼Œå³ï¼šä¸æš´éœ²å…¶å†…éƒ¨çš„ç»“æ„ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163public class Client &#123; public static void main(String[] args) &#123; // åˆ›å»ºå­¦é™¢ List&lt;College&gt; collegeList = new ArrayList&lt;College&gt;(); ComputerCollege computerCollege = new ComputerCollege(); InfoCollege infoCollege = new InfoCollege(); collegeList.add(computerCollege); collegeList.add(infoCollege); OutPutImpl outPutImpl = new OutPutImpl(collegeList); outPutImpl.printCollege(); &#125;&#125;// æ¥å£public interface College &#123; public String getName(); // æ·»åŠ ç³» public void addDepartment(String name, String desc); // è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ public Iterator createIterator();&#125;// ç³»public class Department &#123; private String name; private String desc; public Department(String name, String desc) &#123; super(); this.name = name; this.desc = desc; &#125; // Getter / Setter&#125;public class ComputerCollege implements College &#123; Department[] departments; int numOfDepartment = 0 ; // ä¿å­˜å½“å‰æ•°ç»„çš„å¯¹è±¡ä¸ªæ•° public ComputerCollege() &#123; departments = new Department[5]; addDepartment(\"Java ä¸“ä¸š\", \" Java ä¸“ä¸š \"); addDepartment(\"PHP ä¸“ä¸š\", \" PHP ä¸“ä¸š \"); addDepartment(\"å¤§æ•°æ®ä¸“ä¸š\", \" å¤§æ•°æ®ä¸“ä¸š \"); &#125; @Override public String getName() &#123; return \"è®¡ç®—æœºå­¦é™¢\"; &#125; @Override public void addDepartment(String name, String desc) &#123; Department department = new Department(name, desc); departments[numOfDepartment] = department; numOfDepartment += 1; &#125; @Override public Iterator createIterator() &#123; // å®ç°äº†æ•°æ®å…±äº« return new ComputerCollegeIterator(departments); &#125;&#125;public class ComputerCollegeIterator implements Iterator &#123; Department[] departments; int position = 0; // éå†çš„ä½ç½® public ComputerCollegeIterator(Department[] departments) &#123; this.departments = departments; &#125; //åˆ¤æ–­æ˜¯å¦è¿˜æœ‰ä¸‹ä¸€ä¸ªå…ƒç´  @Override public boolean hasNext() &#123; if(position &gt;= departments.length || departments[position] == null) &#123; return false; &#125;else &#123; return true; &#125; &#125; @Override public Object next() &#123; Department department = departments[position]; position += 1; return department; &#125; // åˆ é™¤çš„æ–¹æ³•ï¼Œé»˜è®¤ç©ºå®ç° public void remove() &#123; &#125;&#125;public class InfoCollege implements College &#123; List&lt;Department&gt; departmentList; public InfoCollege() &#123; departmentList = new ArrayList&lt;Department&gt;(); addDepartment(\"ä¿¡æ¯å®‰å…¨ä¸“ä¸š\", \" ä¿¡æ¯å®‰å…¨ä¸“ä¸š \"); addDepartment(\"ç½‘ç»œå®‰å…¨ä¸“ä¸š\", \" ç½‘ç»œå®‰å…¨ä¸“ä¸š \"); addDepartment(\"æœåŠ¡å™¨å®‰å…¨ä¸“ä¸š\", \" æœåŠ¡å™¨å®‰å…¨ä¸“ä¸š \"); &#125; @Override public String getName() &#123; // TODO Auto-generated method stub return \"ä¿¡æ¯å·¥ç¨‹å­¦é™¢\"; &#125; @Override public void addDepartment(String name, String desc) &#123; // TODO Auto-generated method stub Department department = new Department(name, desc); departmentList.add(department); &#125; @Override public Iterator createIterator() &#123; return new InfoColleageIterator(departmentList); &#125;&#125;public class InfoColleageIterator implements Iterator &#123; List&lt;Department&gt; departmentList; // ä¿¡æ¯å·¥ç¨‹å­¦é™¢æ˜¯ä»¥ List æ–¹å¼å­˜æ”¾ç³» int index = -1; // ç´¢å¼• public InfoColleageIterator(List&lt;Department&gt; departmentList) &#123; this.departmentList = departmentList; &#125; // åˆ¤æ–­ list ä¸­è¿˜æœ‰æ²¡æœ‰ä¸‹ä¸€ä¸ªå…ƒç´  @Override public boolean hasNext() &#123; if(index &gt;= departmentList.size() - 1) &#123; return false; &#125; else &#123; index += 1; return true; &#125; &#125; @Override public Object next() &#123; return departmentList.get(index); &#125; // é»˜è®¤ public void remove() &#123; &#125;&#125;public class OutPutImpl &#123; // å­¦é™¢é›†åˆ List&lt;College&gt; collegeList; public OutPutImpl(List&lt;College&gt; collegeList) &#123; this.collegeList = collegeList; &#125; // éå†æ‰€æœ‰å­¦é™¢,ç„¶åè°ƒç”¨ printDepartment è¾“å‡ºå„ä¸ªå­¦é™¢çš„ç³» public void printCollege() &#123; // ä» collegeList å–å‡ºæ‰€æœ‰å­¦é™¢, Java ä¸­çš„ List å·²ç»å®ç° Iterator Iterator&lt;College&gt; iterator = collegeList.iterator(); while(iterator.hasNext()) &#123; // å–å‡ºä¸€ä¸ªå­¦é™¢ College college = iterator.next(); System.out.println(\"=== \"+college.getName() +\"====\" ); printDepartment(college.createIterator()); // å¾—åˆ°å¯¹åº”è¿­ä»£å™¨ &#125; &#125; // è¾“å‡ºå­¦é™¢ï¼Œè¾“å‡ºç³» public void printDepartment(Iterator iterator) &#123; while(iterator.hasNext()) &#123; Department d = (Department)iterator.next(); System.out.println(d.getName()); &#125; &#125;&#125; JDK-ArrayList æä¾›äº†ä¸€ç§è®¾è®¡æ€æƒ³ï¼Œå°±æ˜¯ä¸€ä¸ªç±»åº”è¯¥åªæœ‰ä¸€ä¸ªå¼•èµ·å˜åŒ–çš„åŸå› ï¼ˆå«åšå•ä¸€è´£ä»»åŸåˆ™ï¼‰ã€‚åœ¨èšåˆç±»ä¸­ï¼Œæˆ‘ä»¬æŠŠè¿­ä»£å™¨åˆ†å¼€ï¼Œå°±æ˜¯è¦æŠŠç®¡ç†å¯¹è±¡é›†åˆå’Œéå†å¯¹è±¡é›†åˆçš„è´£ä»»åˆ†å¼€ï¼Œè¿™æ ·ä¸€æ¥é›†åˆæ”¹å˜çš„è¯ï¼Œåªå½±å“åˆ°èšåˆå¯¹è±¡ã€‚è€Œå¦‚æœéå†æ–¹å¼æ”¹å˜çš„è¯ï¼Œåªå½±å“åˆ°äº†è¿­ä»£å™¨ã€‚ è§‚å¯Ÿè€…æ¨¡å¼ è§‚å¯Ÿè€…æ¨¡å¼ï¼šå¯¹è±¡ä¹‹é—´å¤šå¯¹ä¸€ä¾èµ–çš„ä¸€ç§è®¾è®¡æ–¹æ¡ˆï¼Œè¢«ä¾èµ–çš„å¯¹è±¡ä¸º Subjectï¼Œä¾èµ–çš„å¯¹è±¡ä¸º Observerï¼ŒSubjecté€šçŸ¥ Observer å˜åŒ–ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127public class Client &#123; public static void main(String[] args) &#123; // åˆ›å»ºä¸€ä¸ª WeatherData WeatherData weatherData = new WeatherData(); // åˆ›å»ºè§‚å¯Ÿè€… CurrentConditions currentConditions = new CurrentConditions(); BaiduSite baiduSite = new BaiduSite(); // æ³¨å†Œåˆ° weatherData weatherData.registerObserver(currentConditions); weatherData.registerObserver(baiduSite); // æµ‹è¯• System.out.println(\"é€šçŸ¥å„ä¸ªæ³¨å†Œçš„è§‚å¯Ÿè€…, çœ‹çœ‹ä¿¡æ¯\"); weatherData.setData(10f, 100f, 30.3f); weatherData.removeObserver(currentConditions); // æµ‹è¯• System.out.println(); System.out.println(\"é€šçŸ¥å„ä¸ªæ³¨å†Œçš„è§‚å¯Ÿè€…, çœ‹çœ‹ä¿¡æ¯\"); weatherData.setData(10f, 100f, 30.3f); &#125;&#125;// è§‚å¯Ÿè€…æ¥å£public interface Observer &#123; public void update(float temperature, float pressure, float humidity);&#125;public class BaiduSite implements Observer &#123; // æ¸©åº¦ï¼Œæ°”å‹ï¼Œæ¹¿åº¦ private float temperature; private float pressure; private float humidity; // æ›´æ–°å¤©æ°”æƒ…å†µï¼šWeatherData è°ƒç”¨ï¼ˆæ¨é€æ¨¡å¼ï¼‰ public void update(float temperature, float pressure, float humidity) &#123; this.temperature = temperature; this.pressure = pressure; this.humidity = humidity; display(); &#125; // æ˜¾ç¤º public void display() &#123; System.out.println(\"===ç™¾åº¦ç½‘ç«™===\"); System.out.println(\"***ç™¾åº¦ç½‘ç«™ æ°”æ¸© : \" + temperature + \"***\"); System.out.println(\"***ç™¾åº¦ç½‘ç«™ æ°”å‹: \" + pressure + \"***\"); System.out.println(\"***ç™¾åº¦ç½‘ç«™ æ¹¿åº¦: \" + humidity + \"***\"); &#125;&#125;public class CurrentConditions implements Observer &#123; private float temperature; private float pressure; private float humidity; public void update(float temperature, float pressure, float humidity) &#123; this.temperature = temperature; this.pressure = pressure; this.humidity = humidity; display(); &#125; public void display() &#123; System.out.println(\"***Today Temperature: \" + temperature + \"***\"); System.out.println(\"***Today Pressure: \" + pressure + \"***\"); System.out.println(\"***Today Humidity: \" + humidity + \"***\"); &#125;&#125;// æ¥å£, è®© WeatherData æ¥å®ç°public interface Subject &#123; public void registerObserver(Observer o); public void removeObserver(Observer o); public void notifyObservers();&#125;/*** æ ¸å¿ƒç±»* 1. åŒ…å«æœ€æ–°çš„å¤©æ°”æƒ…å†µä¿¡æ¯* 2. å«æœ‰è§‚å¯Ÿè€…é›†åˆï¼Œä½¿ç”¨ ArrayList ç®¡ç†* 3. å½“æ•°æ®æœ‰æ›´æ–°æ—¶ï¼Œå°±ä¸»åŠ¨çš„è°ƒç”¨ ArrayList, é€šçŸ¥æ‰€æœ‰çš„ï¼ˆæ¥å…¥æ–¹ï¼šè§‚å¯Ÿè€…ï¼‰å°±çœ‹åˆ°æœ€æ–°çš„ä¿¡æ¯*/public class WeatherData implements Subject &#123; private float temperatrue; private float pressure; private float humidity; // è§‚å¯Ÿè€…é›†åˆ private ArrayList&lt;Observer&gt; observers; // åŠ å…¥æ–°çš„ç¬¬ä¸‰æ–¹ public WeatherData() &#123; observers = new ArrayList&lt;Observer&gt;(); &#125; public float getTemperature() &#123; return temperatrue; &#125; public float getPressure() &#123; return pressure; &#125; public float getHumidity() &#123; return humidity; &#125; public void dataChange() &#123; // è°ƒç”¨æ¥å…¥æ–¹çš„ update notifyObservers(); &#125; // å½“æ•°æ®æœ‰æ›´æ–°æ—¶ï¼Œå°±è°ƒç”¨ setData public void setData(float temperature, float pressure, float humidity) &#123; this.temperatrue = temperature; this.pressure = pressure; this.humidity = humidity; // è°ƒç”¨ dataChangeï¼Œ å°†æœ€æ–°çš„ä¿¡æ¯æ¨é€ç»™æ¥å…¥æ–¹ currentConditions dataChange(); &#125; // æ³¨å†Œä¸€ä¸ªè§‚å¯Ÿè€… @Override public void registerObserver(Observer o) &#123; observers.add(o); &#125; // ç§»é™¤ä¸€ä¸ªè§‚å¯Ÿè€… @Override public void removeObserver(Observer o) &#123; if(observers.contains(o)) &#123; observers.remove(o); &#125; &#125; // éå†æ‰€æœ‰çš„è§‚å¯Ÿè€…ï¼Œå¹¶é€šçŸ¥ @Override public void notifyObservers() &#123; for(int i = 0; i &lt; observers.size(); i++) &#123; observers.get(i).update(this.temperatrue, this.pressure, this.humidity); &#125; &#125;&#125; è§‚å¯Ÿè€…æ¨¡å¼è®¾è®¡åï¼Œä¼šä»¥é›†åˆçš„æ–¹å¼æ¥ç®¡ç†ç”¨æˆ·(Observer)ï¼ŒåŒ…æ‹¬æ³¨å†Œï¼Œç§»é™¤å’Œé€šçŸ¥ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å¢åŠ è§‚å¯Ÿè€…ï¼ˆè¿™é‡Œå¯ä»¥ç†è§£æˆä¸€ä¸ªæ–°çš„å…¬å‘Šæ¿ï¼‰å°±ä¸éœ€è¦å»ä¿®æ”¹æ ¸å¿ƒç±» WeatherData ä¸ä¼šä¿®æ”¹ä»£ç ï¼Œéµå®ˆäº† OCP åŸåˆ™ã€‚ ä¸­ä»‹æ¨¡å¼ ä¸­ä»‹è€…æ¨¡å¼ï¼ˆMediator Patternï¼‰ï¼Œç”¨ä¸€ä¸ªä¸­ä»‹å¯¹è±¡æ¥å°è£…ä¸€ç³»åˆ—çš„å¯¹è±¡äº¤äº’ã€‚ä¸­ä»‹è€…ä½¿å„ä¸ªå¯¹è±¡ä¸éœ€è¦æ˜¾å¼åœ°ç›¸äº’å¼•ç”¨ï¼Œä»è€Œä½¿å…¶è€¦åˆæ¾æ•£ï¼Œè€Œä¸”å¯ä»¥ç‹¬ç«‹åœ°æ”¹å˜å®ƒä»¬ä¹‹é—´çš„äº¤äº’ã€‚ æ¯”å¦‚ MVC æ¨¡å¼ï¼ŒCï¼ˆController æ§åˆ¶å™¨ï¼‰æ˜¯ Mï¼ˆModel æ¨¡å‹ï¼‰å’Œ Vï¼ˆView è§†å›¾ï¼‰çš„ä¸­ä»‹è€…ï¼Œåœ¨å‰åç«¯äº¤äº’æ—¶èµ·åˆ°äº†ä¸­é—´äººçš„ä½œç”¨ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155public class ClientTest &#123; public static void main(String[] args) &#123; // åˆ›å»ºä¸€ä¸ªä¸­ä»‹è€…å¯¹è±¡ Mediator mediator = new ConcreteMediator(); // åˆ›å»º Alarm å¹¶ä¸”åŠ å…¥åˆ° ConcreteMediator å¯¹è±¡çš„ HashMap Alarm alarm = new Alarm(mediator, \"alarm\"); // åˆ›å»ºäº† CoffeeMachine å¯¹è±¡ï¼Œå¹¶ ä¸”åŠ å…¥åˆ° ConcreteMediator å¯¹è±¡çš„ HashMap CoffeeMachine coffeeMachine = new CoffeeMachine(mediator, \"coffeeMachine\"); // åˆ›å»º Curtains , å¹¶ä¸”åŠ å…¥åˆ° ConcreteMediator å¯¹è±¡çš„ HashMap Curtains curtains = new Curtains(mediator, \"curtains\"); TV tV = new TV(mediator, \"TV\"); // è®©é—¹é’Ÿå‘å‡ºæ¶ˆæ¯ alarm.SendAlarm(0); coffeeMachine.FinishCoffee(); alarm.SendAlarm(1); &#125;&#125;// åŒäº‹æŠ½è±¡ç±»public abstract class Colleague &#123; // æ‰€æœ‰çš„åŒäº‹éƒ½çŸ¥é“ä¸­ä»‹ private Mediator mediator; public String name; public Colleague(Mediator mediator, String name) &#123; this.mediator = mediator; this.name = name; &#125; public Mediator GetMediator() &#123; return this.mediator; &#125; public abstract void SendMessage(int stateChange);&#125;// å…·ä½“çš„åŒäº‹ç±»public class Alarm extends Colleague &#123; // æ„é€ å™¨ public Alarm(Mediator mediator, String name) &#123; super(mediator, name); // åœ¨åˆ›å»º Alarm åŒäº‹å¯¹è±¡æ—¶ï¼Œå°†è‡ªå·±æ³¨å†Œåˆ° ConcreteMediator å¯¹è±¡ä¸­[é›†åˆ] mediator.Register(name, this); &#125; public void SendAlarm(int stateChange) &#123; SendMessage(stateChange); &#125; @Override public void SendMessage(int stateChange) &#123; // è°ƒç”¨çš„ä¸­ä»‹è€…å¯¹è±¡çš„ getMessage this.GetMediator().GetMessage(stateChange, this.name); &#125;&#125;public class CoffeeMachine extends Colleague &#123; public CoffeeMachine(Mediator mediator, String name) &#123; super(mediator, name); mediator.Register(name, this); &#125; @Override public void SendMessage(int stateChange) &#123; this.GetMediator().GetMessage(stateChange, this.name); &#125; public void StartCoffee() &#123; System.out.println(\"It's time to startcoffee!\"); &#125; public void FinishCoffee() &#123; System.out.println(\"After 5 minutes!\"); System.out.println(\"Coffee is ok!\"); SendMessage(0); &#125;&#125;public class TV extends Colleague &#123; public TV(Mediator mediator, String name) &#123; super(mediator, name); mediator.Register(name, this); &#125; @Override public void SendMessage(int stateChange) &#123; this.GetMediator().GetMessage(stateChange, this.name); &#125; public void StartTv() &#123; System.out.println(\"It's time to StartTv!\"); &#125; public void StopTv() &#123; System.out.println(\"StopTv!\"); &#125;&#125;public class Curtains extends Colleague &#123; public Curtains(Mediator mediator, String name) &#123; super(mediator, name); mediator.Register(name, this); &#125; @Override public void SendMessage(int stateChange) &#123; this.GetMediator().GetMessage(stateChange, this.name); &#125; public void UpCurtains() &#123; System.out.println(\"I am holding Up Curtains!\"); &#125;&#125;public abstract class Mediator &#123; // å°†ç»™ä¸­ä»‹è€…å¯¹è±¡åŠ å…¥åˆ°é›†åˆä¸­ public abstract void Register(String colleagueName, Colleague colleague); // æ¥æ”¶æ¶ˆæ¯ï¼šç”±å…·ä½“çš„åŒäº‹å¯¹è±¡å‘å‡º public abstract void GetMessage(int stateChange, String colleagueName); public abstract void SendMessage();&#125;// å…·ä½“çš„ä¸­ä»‹è€…ç±»public class ConcreteMediator extends Mediator &#123; // é›†åˆï¼šæ”¾å…¥æ‰€æœ‰çš„åŒäº‹å¯¹è±¡ private HashMap&lt;String, Colleague&gt; colleagueMap; private HashMap&lt;String, String&gt; interMap; public ConcreteMediator() &#123; colleagueMap = new HashMap&lt;String, Colleague&gt;(); interMap = new HashMap&lt;String, String&gt;(); &#125; @Override public void Register(String colleagueName, Colleague colleague) &#123; colleagueMap.put(colleagueName, colleague); if (colleague instanceof Alarm) &#123; // é™å®šäº†æ¯ç§ç±»å‹æœºå™¨çš„æ•°é‡åªèƒ½æœ‰ä¸€ä¸ªï¼šæœ€æ–°æ³¨å†Œçš„æœºå™¨ interMap.put(\"Alarm\", colleagueName); &#125; else if (colleague instanceof CoffeeMachine) &#123; interMap.put(\"CoffeeMachine\", colleagueName); &#125; else if (colleague instanceof TV) &#123; interMap.put(\"TV\", colleagueName); &#125; else if (colleague instanceof Curtains) &#123; interMap.put(\"Curtains\", colleagueName); &#125; &#125; // å…·ä½“ä¸­ä»‹è€…çš„æ ¸å¿ƒæ–¹æ³• // 1. æ ¹æ®å¾—åˆ°æ¶ˆæ¯ï¼Œå®Œæˆå¯¹åº”ä»»åŠ¡ // 2. ä¸­ä»‹è€…åœ¨è¿™ä¸ªæ–¹æ³•ï¼Œåè°ƒå„ä¸ªå…·ä½“çš„åŒäº‹å¯¹è±¡ï¼Œå®Œæˆä»»åŠ¡ @Override public void GetMessage(int stateChange, String colleagueName) &#123; //å¤„ç†é—¹é’Ÿå‘å‡ºçš„æ¶ˆæ¯ if (colleagueMap.get(colleagueName) instanceof Alarm) &#123; if (stateChange == 0) &#123; ((CoffeeMachine) (colleagueMap.get(interMap.get(\"CoffeeMachine\")))).StartCoffee(); ((TV) (colleagueMap.get(interMap.get(\"TV\")))).StartTv(); &#125; else if (stateChange == 1) &#123; ((TV) (colleagueMap.get(interMap.get(\"TV\")))).StopTv(); &#125; &#125; else if (colleagueMap.get(colleagueName) instanceof CoffeeMachine) &#123; ((Curtains) (colleagueMap.get(interMap.get(\"Curtains\")))).UpCurtains(); &#125; else if (colleagueMap.get(colleagueName) instanceof TV) &#123; // å¦‚æœ TV å‘ç°æ¶ˆæ¯ &#125; else if (colleagueMap.get(colleagueName) instanceof Curtains) &#123; // å¦‚æœ Curtain å‘ç°æ¶ˆæ¯&#125; @Override public void SendMessage() &#123; &#125; &#125;&#125; å¤‡å¿˜å½•æ¨¡å¼ å¤‡å¿˜å½•æ¨¡å¼ï¼ˆMemento Patternï¼‰åœ¨ä¸ç ´åå°è£…æ€§çš„å‰æä¸‹ï¼Œæ•è·ä¸€ä¸ªå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ï¼Œå¹¶åœ¨è¯¥å¯¹è±¡ä¹‹å¤–ä¿å­˜è¿™ä¸ªçŠ¶æ€ï¼Œè¿™æ ·ä»¥åå°±å¯å°†è¯¥å¯¹è±¡æ¢å¤åˆ°åŸå…ˆä¿å­˜çš„çŠ¶æ€ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768public class Client &#123; public static void main(String[] args) &#123; // åˆ›å»ºæ¸¸æˆè§’è‰² GameRole gameRole = new GameRole(); gameRole.setVit(100); gameRole.setDef(100); System.out.println(\"å’Œ Boss å¤§æˆ˜å‰çš„çŠ¶æ€\"); gameRole.display(); // æŠŠå½“å‰çŠ¶æ€ä¿å­˜ caretakerï¼šçœ‹å®ˆè€… Caretaker caretaker = new Caretaker(); caretaker.setMemento(gameRole.createMemento()); System.out.println(\"å’Œ Boss å¤§æˆ˜å\"); gameRole.setDef(30); gameRole.setVit(30); gameRole.display(); System.out.println(\"å¤§æˆ˜åï¼Œä½¿ç”¨å¤‡å¿˜å½•å¯¹è±¡æ¢å¤åˆ°æˆ˜æ–—å‰\"); gameRole.recoverGameRoleFromMemento(caretaker.getMemento()); System.out.println(\"æ¢å¤åçš„çŠ¶æ€\"); gameRole.display(); &#125;&#125;// å®ˆæŠ¤è€…å¯¹è±¡, ä¿å­˜æ¸¸æˆè§’è‰²çš„çŠ¶æ€public class Caretaker &#123; // å¦‚æœåªä¿å­˜ä¸€æ¬¡çŠ¶æ€ private Memento memento; // å¯¹ GameRole ä¿å­˜å¤šæ¬¡çŠ¶æ€ // private ArrayList&lt;Memento&gt; mementos; // å¯¹å¤šä¸ªæ¸¸æˆè§’è‰²ä¿å­˜å¤šä¸ªçŠ¶æ€ // private HashMap&lt;String, ArrayList&lt;Memento&gt;&gt; rolesMementos; public Memento getMemento() &#123; return memento; &#125; public void setMemento(Memento memento) &#123; this.memento = memento; &#125;&#125;public class Memento &#123; private int vit; private int def; public Memento(int vit, int def) &#123; super(); this.vit = vit; this.def = def; &#125; // Getter / Setter&#125;public class GameRole &#123; private int vit; private int def; // åˆ›å»º Mementoï¼šå³æ ¹æ®å½“å‰çš„çŠ¶æ€å¾—åˆ° Memento public Memento createMemento() &#123; return new Memento(vit, def); &#125; // å¤‡å¿˜å½•å¯¹è±¡æ¢å¤ GameRole çš„çŠ¶æ€ public void recoverGameRoleFromMemento(Memento memento) &#123; this.vit = memento.getVit(); this.def = memento.getDef(); &#125; // æ˜¾ç¤ºå½“å‰æ¸¸æˆè§’è‰²çš„çŠ¶æ€ public void display() &#123; System.out.println(\"æ¸¸æˆè§’è‰²å½“å‰çš„æ”»å‡»åŠ›ï¼š\" + this.vit + \" é˜²å¾¡åŠ›: \" + this.def); &#125; // Getter / Setter&#125; è§£é‡Šå™¨æ¨¡å¼ ç»™å®šä¸€ä¸ªè¯­è¨€ï¼ˆè¡¨è¾¾å¼ï¼‰ï¼Œå®šä¹‰å®ƒçš„æ–‡æ³•çš„ä¸€ç§è¡¨ç¤ºï¼Œå¹¶å®šä¹‰ä¸€ä¸ªè§£é‡Šå™¨ï¼Œä½¿ç”¨è¯¥è§£é‡Šå™¨æ¥è§£é‡Šè¯­è¨€ä¸­çš„å¥å­ï¼ˆè¡¨è¾¾å¼ï¼‰ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129public class ClientTest &#123; public static void main(String[] args) throws IOException &#123; String expStr = getExpStr(); // a+b HashMap&lt;String, Integer&gt; var = getValue(expStr); // var &#123;a=10, b=20&#125; Calculator calculator = new Calculator(expStr); System.out.println(\"è¿ç®—ç»“æœï¼š\" + expStr + \"=\" + calculator.run(var)); &#125; // è·å¾—è¡¨è¾¾å¼ public static String getExpStr() throws IOException &#123; System.out.print(\"è¯·è¾“å…¥è¡¨è¾¾å¼ï¼š\"); return (new BufferedReader(new InputStreamReader(System.in))).readLine(); &#125; // è·å¾—å€¼æ˜ å°„ public static HashMap&lt;String, Integer&gt; getValue(String expStr) throws IOException &#123; HashMap&lt;String, Integer&gt; map = new HashMap&lt;&gt;(); for (char ch : expStr.toCharArray()) &#123; if (ch != '+' &amp;&amp; ch != '-') &#123; if (!map.containsKey(String.valueOf(ch))) &#123; System.out.print(\"è¯·è¾“å…¥\" + String.valueOf(ch) + \"çš„å€¼ï¼š\"); String in = (new BufferedReader(new InputStreamReader(System.in))).readLine(); map.put(String.valueOf(ch), Integer.valueOf(in)); &#125; &#125; &#125; return map; &#125;&#125;public class Calculator &#123; // å®šä¹‰è¡¨è¾¾å¼ private Expression expression; // æ„é€ å‡½æ•°ä¼ å‚ï¼Œå¹¶è§£æ public Calculator(String expStr) &#123; // expStr = a+b // å®‰æ’è¿ç®—å…ˆåé¡ºåº Stack&lt;Expression&gt; stack = new Stack&lt;&gt;(); // è¡¨è¾¾å¼æ‹†åˆ†æˆå­—ç¬¦æ•°ç»„ char[] charArray = expStr.toCharArray();// [a, +, b] Expression left = null; Expression right = null; // éå†æˆ‘ä»¬çš„å­—ç¬¦æ•°ç»„ï¼Œ å³éå† [a, +, b] // é’ˆå¯¹ä¸åŒçš„æƒ…å†µï¼Œåšå¤„ç† for (int i = 0; i &lt; charArray.length; i++) &#123; switch (charArray[i]) &#123; case '+': left = stack.pop(); // ä» stack å–å‡º left =&gt; \"a\" right = new VarExpression(String.valueOf(charArray[++i])); // å–å‡ºå³è¡¨è¾¾å¼ \"b\" stack.push(new AddExpression(left, right)); // ç„¶åæ ¹æ®å¾—åˆ° left å’Œ right æ„å»º AddExpresson åŠ å…¥ stack break; case '-': left = stack.pop(); right = new VarExpression(String.valueOf(charArray[++i])); stack.push(new SubExpression(left, right)); break; default: // å¦‚æœæ˜¯ä¸€ä¸ª Var å°±åˆ›å»ºè¦ç»™ VarExpression å¯¹è±¡ï¼Œå¹¶ push åˆ° stack stack.push(new VarExpression(String.valueOf(charArray[i]))); break; &#125; &#125; // å½“éå†å®Œæ•´ä¸ª charArray æ•°ç»„åï¼Œstack å°±å¾—åˆ°æœ€å Expression this.expression = stack.pop(); &#125; public int run(HashMap&lt;String, Integer&gt; var) &#123; // æœ€åå°†è¡¨è¾¾å¼ a+b å’Œ var = &#123;a=10,b=20&#125; // ç„¶åä¼ é€’ç»™ expression çš„ interpreter è¿›è¡Œè§£é‡Šæ‰§è¡Œ return this.expression.interpreter(var); &#125;&#125;// æŠ½è±¡ç±»è¡¨è¾¾å¼ï¼Œé€šè¿‡ HashMap é”®å€¼å¯¹, å¯ä»¥è·å–åˆ°å˜é‡çš„å€¼public abstract class Expression &#123; // a + b - c // è§£é‡Šå…¬å¼å’Œæ•°å€¼, key å°±æ˜¯å…¬å¼ï¼Œå‚æ•°[a,b,c], value å°±æ˜¯å°±æ˜¯å…·ä½“å€¼ // HashMap &#123;a=10, b=20&#125; public abstract int interpreter(HashMap&lt;String, Integer&gt; var);&#125;// å˜é‡çš„è§£é‡Šå™¨public class VarExpression extends Expression &#123; private String key; // key=a,key=b,key=c public VarExpression(String key) &#123; this.key = key; &#125; // &#123;a=10, b=20&#125; // interpreter æ ¹æ®å˜é‡åç§°ï¼Œè¿”å›å¯¹åº”å€¼ @Override public int interpreter(HashMap&lt;String, Integer&gt; var) &#123; return var.get(this.key); &#125;&#125;// æŠ½è±¡è¿ç®—ç¬¦å·è§£æå™¨ è¿™é‡Œï¼Œæ¯ä¸ªè¿ç®—ç¬¦å·ï¼Œéƒ½åªå’Œè‡ªå·±å·¦å³ä¸¤ä¸ªæ•°å­—æœ‰å…³ç³»ï¼Œ// ä½†å·¦å³ä¸¤ä¸ªæ•°å­—æœ‰å¯èƒ½ä¹Ÿæ˜¯ä¸€ä¸ªè§£æçš„ç»“æœï¼Œæ— è®ºä½•ç§ç±»å‹ï¼Œéƒ½æ˜¯ Expression ç±»çš„å®ç°ç±»public class SymbolExpression extends Expression &#123; protected Expression left; protected Expression right; public SymbolExpression(Expression left, Expression right) &#123; this.left = left; this.right = right; &#125; // å› ä¸º SymbolExpression æ˜¯è®©å…¶å­ç±»æ¥å®ç°ï¼Œå› æ­¤ interpreter æ˜¯ä¸€ä¸ªé»˜è®¤å®ç° @Override public int interpreter(HashMap&lt;String, Integer&gt; var) &#123; return 0; &#125;&#125;public class SubExpression extends SymbolExpression &#123; public SubExpression(Expression left, Expression right) &#123; super(left, right); &#125; // æ±‚å‡º left å’Œ right è¡¨è¾¾å¼ç›¸å‡åçš„ç»“æœ public int interpreter(HashMap&lt;String, Integer&gt; var) &#123; return super.left.interpreter(var) - super.right.interpreter(var); &#125;&#125;public class AddExpression extends SymbolExpression &#123; public AddExpression(Expression left, Expression right) &#123; super(left, right); &#125; // &#123;a=10,b=20&#125; public int interpreter(HashMap&lt;String, Integer&gt; var) &#123; //super.left.interpreter(var) ï¼š è¿”å› left è¡¨è¾¾å¼å¯¹åº”çš„å€¼ a = 10 //super.right.interpreter(var): è¿”å› right è¡¨è¾¾å¼å¯¹åº”å€¼ b = 20 return super.left.interpreter(var) + super.right.interpreter(var); &#125;&#125; çŠ¶æ€æ¨¡å¼ ä¸»è¦ç”¨æ¥è§£å†³å¯¹è±¡åœ¨å¤šç§çŠ¶æ€è½¬æ¢æ—¶ï¼Œéœ€è¦å¯¹å¤–è¾“å‡ºä¸åŒçš„è¡Œä¸ºçš„é—®é¢˜ã€‚çŠ¶æ€å’Œè¡Œä¸ºæ˜¯ç›¸å¯¹åº”çš„ï¼ŒçŠ¶æ€ä¹‹é—´å¯ä»¥ç›¸äº’è½¬æ¢ã€‚å½“ä¸€ä¸ªå¯¹è±¡çš„å†…åœ¨çŠ¶æ€æ”¹å˜æ—¶ï¼Œå…è®¸æ”¹å˜å…¶è¡Œä¸ºï¼Œè¿™ä¸ªå¯¹è±¡çœ‹èµ·æ¥åƒæ˜¯æ”¹å˜äº†å…¶ç±»ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181public class ClientTest &#123; public static void main(String[] args) &#123; // åˆ›å»ºæ´»åŠ¨å¯¹è±¡ï¼Œå¥–å“æœ‰ 1 ä¸ªå¥–å“ RaffleActivity activity = new RaffleActivity(1); // æˆ‘ä»¬è¿ç»­æŠ½ 300 æ¬¡å¥– for (int i = 0; i &lt; 30; i++) &#123; System.out.println(\"---ç¬¬\" + (i + 1) + \"æ¬¡æŠ½å¥–---\"); // å‚åŠ æŠ½å¥–ï¼Œç¬¬ä¸€æ­¥ç‚¹å‡»æ‰£é™¤ç§¯åˆ† activity.debuctMoney(); // ç¬¬äºŒæ­¥æŠ½å¥– activity.raffle(); &#125; &#125;&#125;// æŠ½å¥–æ´»åŠ¨// ä¼ å…¥ä¸åŒçš„çŠ¶æ€è¿›è¡Œè°ƒç”¨public class RaffleActivity &#123; // state è¡¨ç¤ºæ´»åŠ¨å½“å‰çš„çŠ¶æ€ï¼Œæ˜¯å˜åŒ– State state = null; // å¥–å“æ•°é‡ int count = 0; // å››ä¸ªå±æ€§ï¼Œè¡¨ç¤ºæ´»åŠ¨çš„å››ç§çŠ¶æ€ State noRafflleState = new NoRaffleState(this); State canRaffleState = new CanRaffleState(this); State dispenseState = new DispenseState(this); State dispensOutState = new DispenseOutState(this); //æ„é€ å™¨ // 1.åˆå§‹åŒ–å½“å‰çš„çŠ¶æ€ä¸º noRafflleStateï¼ˆå³ä¸èƒ½æŠ½å¥–çš„çŠ¶æ€ï¼‰ // 2.åˆå§‹åŒ–å¥–å“çš„æ•°é‡ public RaffleActivity(int count) &#123; this.state = getNoRafflleState(); this.count = count; &#125; // æ‰£åˆ†, è°ƒç”¨å½“å‰çŠ¶æ€çš„ deductMoney public void debuctMoney()&#123; state.deductMoney(); &#125; // æŠ½å¥– public void raffle()&#123; // å¦‚æœå½“å‰çš„çŠ¶æ€æ˜¯æŠ½å¥–æˆåŠŸ if(state.raffle())&#123; // é¢†å–å¥–å“ state.dispensePrize(); &#125; &#125; // Getter / Setter // æ¯é¢†å–ä¸€æ¬¡å¥–å“ï¼Œå¥–å“æ•°é‡å‡ä¸€ public int getCount() &#123; int curCount = count; count--; return curCount; &#125;&#125;// æŠ½å¥–äººçŠ¶æ€æŠ½è±¡ç±»public abstract class State &#123; // æ‰£é™¤ç§¯åˆ† - 50 public abstract void deductMoney(); // æ˜¯å¦æŠ½ä¸­å¥–å“ public abstract boolean raffle(); // å‘æ”¾å¥–å“ public abstract void dispensePrize();&#125;// å¯ä»¥æŠ½å¥–çš„çŠ¶æ€ï¼šé‡å†™å„æ­¥éª¤public class CanRaffleState extends State &#123; RaffleActivity activity; public CanRaffleState(RaffleActivity activity) &#123; this.activity = activity; &#125; // å·²ç»æ‰£é™¤äº†ç§¯åˆ†ï¼Œä¸èƒ½å†æ‰£ @Override public void deductMoney() &#123; System.out.println(\"å·²ç»æ‰£å–è¿‡äº†ç§¯åˆ†\"); &#125; // å¯ä»¥æŠ½å¥–, æŠ½å®Œå¥–åï¼Œæ ¹æ®å®é™…æƒ…å†µï¼Œæ”¹æˆæ–°çš„çŠ¶æ€ @Override public boolean raffle() &#123; System.out.println(\"æ­£åœ¨æŠ½å¥–ï¼Œè¯·ç¨ç­‰ï¼\"); Random r = new Random(); int num = r.nextInt(10); // 10% ä¸­å¥–æœºä¼š if(num == 0)&#123; // æ”¹å˜æ´»åŠ¨çŠ¶æ€ä¸ºå‘æ”¾å¥–å“ context activity.setState(activity.getDispenseState()); return true; &#125;else&#123; System.out.println(\"å¾ˆé—æ†¾æ²¡æœ‰æŠ½ä¸­å¥–å“ï¼\"); // æ”¹å˜çŠ¶æ€ä¸ºä¸èƒ½æŠ½å¥– activity.setState(activity.getNoRafflleState()); return false; &#125; &#125; // ä¸èƒ½å‘æ”¾å¥–å“ @Override public void dispensePrize() &#123; System.out.println(\"æ²¡ä¸­å¥–ï¼Œä¸èƒ½å‘æ”¾å¥–å“\"); &#125;&#125;// å¥–å“å‘é€å®Œæ¯•çŠ¶æ€public class DispenseOutState extends State &#123; // åˆå§‹åŒ–æ—¶ä¼ å…¥æ´»åŠ¨å¼•ç”¨ RaffleActivity activity; public DispenseOutState(RaffleActivity activity) &#123; this.activity = activity; &#125; @Override public void deductMoney() &#123; System.out.println(\"å¥–å“å‘é€å®Œäº†ï¼Œè¯·ä¸‹æ¬¡å†å‚åŠ \"); &#125; @Override public boolean raffle() &#123; System.out.println(\"å¥–å“å‘é€å®Œäº†ï¼Œè¯·ä¸‹æ¬¡å†å‚åŠ \"); return false; &#125; @Override public void dispensePrize() &#123; System.out.println(\"å¥–å“å‘é€å®Œäº†ï¼Œè¯·ä¸‹æ¬¡å†å‚åŠ \"); &#125;&#125;// å‘é€å¥–å“çŠ¶æ€public class DispenseState extends State &#123; // åˆå§‹åŒ–æ—¶ä¼ å…¥æ´»åŠ¨å¼•ç”¨ï¼Œå‘æ”¾å¥–å“åæ”¹å˜å…¶çŠ¶æ€ RaffleActivity activity; public DispenseState(RaffleActivity activity) &#123; this.activity = activity; &#125; @Override public void deductMoney() &#123; System.out.println(\"ä¸èƒ½æ‰£é™¤ç§¯åˆ†\"); &#125; @Override public boolean raffle() &#123; System.out.println(\"ä¸èƒ½æŠ½å¥–\"); return false; &#125; // å‘æ”¾å¥–å“ @Override public void dispensePrize() &#123; if(activity.getCount() &gt; 0)&#123; System.out.println(\"æ­å–œä¸­å¥–äº†\"); // æ”¹å˜çŠ¶æ€ä¸ºä¸èƒ½æŠ½å¥– activity.setState(activity.getNoRafflleState()); &#125;else&#123; System.out.println(\"å¾ˆé—æ†¾ï¼Œå¥–å“å‘é€å®Œäº†\"); // æ”¹å˜çŠ¶æ€ä¸ºå¥–å“å‘é€å®Œæ¯•, åé¢æˆ‘ä»¬å°±ä¸å¯ä»¥æŠ½å¥– activity.setState(activity.getDispensOutState()); // System.out.println(\"æŠ½å¥–æ´»åŠ¨ç»“æŸ\"); // System.exit(0); &#125; &#125;&#125;// ä¸èƒ½æŠ½å¥–çš„çŠ¶æ€public class NoRaffleState extends State &#123; // åˆå§‹åŒ–æ—¶ä¼ å…¥æ´»åŠ¨å¼•ç”¨ï¼Œæ‰£é™¤ç§¯åˆ†åæ”¹å˜å…¶çŠ¶æ€ RaffleActivity activity; public NoRaffleState(RaffleActivity activity) &#123; this.activity = activity; &#125; // å½“å‰çŠ¶æ€å¯ä»¥æ‰£ç§¯åˆ†ï¼Œæ‰£é™¤åï¼Œå°†çŠ¶æ€è®¾ç½®æˆå¯ä»¥æŠ½å¥–çŠ¶æ€ @Override public void deductMoney() &#123; System.out.println(\"æ‰£é™¤ 50 ç§¯åˆ†æˆåŠŸï¼Œæ‚¨å¯ä»¥æŠ½å¥–äº†\"); activity.setState(activity.getCanRaffleState()); &#125; // å½“å‰çŠ¶æ€ä¸èƒ½æŠ½å¥– @Override public boolean raffle() &#123; System.out.println(\"æ‰£äº†ç§¯åˆ†æ‰èƒ½æŠ½å¥–å–”ï¼\"); return false; &#125; // å½“å‰çŠ¶æ€ä¸èƒ½å‘å¥–å“ @Override public void dispensePrize() &#123; System.out.println(\"ä¸èƒ½å‘æ”¾å¥–å“\"); &#125;&#125; ç­–ç•¥æ¨¡å¼ åˆ†åˆ«å°è£…è¡Œä¸ºæ¥å£ï¼Œå®ç°ç®—æ³•æ—ï¼Œè¶…ç±»é‡Œæ”¾è¡Œä¸ºæ¥å£å¯¹è±¡ï¼Œåœ¨å­ç±»é‡Œå…·ä½“è®¾å®šè¡Œä¸ºå¯¹è±¡ã€‚åŸåˆ™å°±æ˜¯ï¼šåˆ†ç¦»å˜åŒ–éƒ¨åˆ†ï¼Œå°è£…æ¥å£ï¼ŒåŸºäºæ¥å£ç¼–ç¨‹å„ç§åŠŸèƒ½ã€‚æ­¤æ¨¡å¼è®©è¡Œä¸ºçš„å˜åŒ–ç‹¬ç«‹äºç®—æ³•çš„ä½¿ç”¨è€…ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108public class Client &#123; public static void main(String[] args) &#123; WildDuck wildDuck = new WildDuck(); wildDuck.fly(); ToyDuck toyDuck = new ToyDuck(); toyDuck.fly(); PekingDuck pekingDuck = new PekingDuck(); pekingDuck.fly(); // åŠ¨æ€æ”¹å˜æŸä¸ªå¯¹è±¡çš„è¡Œä¸º, åŒ—äº¬é¸­æ”¹ä¸ºä¸èƒ½é£ï¼šæ”¹å˜ç­–ç•¥ pekingDuck.setFlyBehavior(new NoFlyBehavior()); System.out.println(\"åŒ—äº¬é¸­çš„å®é™…é£ç¿”èƒ½åŠ›\"); pekingDuck.fly(); &#125;&#125;// å®šä¹‰é¸­çš„è¡Œä¸ºæ¨¡å¼public abstract class Duck &#123; // å±æ€§, ç­–ç•¥æ¥å£ FlyBehavior flyBehavior; // å…¶å®ƒå±æ€§ &lt;-&gt; ç­–ç•¥æ¥å£ QuackBehavior quackBehavior; public Duck() &#123; &#125; public abstract void display(); // æ˜¾ç¤ºé¸­å­ä¿¡æ¯ public void quack() &#123; System.out.println(\"é¸­å­å˜å˜å«~~\"); &#125; public void swim() &#123; System.out.println(\"é¸­å­ä¼šæ¸¸æ³³~~\"); &#125; public void fly() &#123; // è‹¥æ”¹å˜ç­–ç•¥ if(flyBehavior != null) &#123; flyBehavior.fly(); &#125; &#125; public void setFlyBehavior(FlyBehavior flyBehavior) &#123; this.flyBehavior = flyBehavior; &#125; public void setQuackBehavior(QuackBehavior quackBehavior) &#123; this.quackBehavior = quackBehavior; &#125;&#125;public class PekingDuck extends Duck &#123; // å‡å¦‚åŒ—äº¬é¸­å¯ä»¥é£ç¿”ï¼Œä½†æ˜¯é£ç¿”æŠ€æœ¯ä¸€èˆ¬ public PekingDuck() &#123; flyBehavior = new BadFlyBehavior(); &#125; @Override public void display() &#123; System.out.println(\"~~åŒ—äº¬é¸­~~~\"); &#125;&#125;public class ToyDuck extends Duck&#123; public ToyDuck() &#123; flyBehavior = new NoFlyBehavior(); &#125; @Override public void display() &#123; System.out.println(\"ç©å…·é¸­\"); &#125; // éœ€è¦é‡å†™çˆ¶ç±»çš„æ‰€æœ‰æ–¹æ³• public void quack() &#123; System.out.println(\"ç©å…·é¸­ä¸èƒ½å«~~\"); &#125; public void swim() &#123; System.out.println(\"ç©å…·é¸­ä¸ä¼šæ¸¸æ³³~~\"); &#125;&#125;public class WildDuck extends Duck &#123; // æ„é€ å™¨ï¼Œä¼ å…¥ FlyBehavor çš„å¯¹è±¡ public WildDuck() &#123; flyBehavior = new GoodFlyBehavior(); &#125; @Override public void display() &#123; System.out.println(\" è¿™æ˜¯é‡é¸­ \"); &#125;&#125;// æœªå®ç°ç­–ç•¥public interface QuackBehavior &#123; void quack();//å­ç±»å®ç°&#125;public interface FlyBehavior &#123; void fly(); // å­ç±»å…·ä½“å®ç°&#125;public class GoodFlyBehavior implements FlyBehavior &#123; @Override public void fly() &#123; System.out.println(\"é£ç¿”æŠ€æœ¯é«˜è¶…~~\"); &#125;&#125;public class NoFlyBehavior implements FlyBehavior&#123; @Override public void fly() &#123; System.out.println(\"ä¸ä¼šé£ç¿”...\"); &#125;&#125;public class BadFlyBehavior implements FlyBehavior &#123; @Override public void fly() &#123; System.out.println(\" é£ç¿”æŠ€æœ¯ä¸€èˆ¬ \"); &#125;&#125; ç­–ç•¥æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šå¤šç”¨ç»„åˆ/èšåˆ å°‘ç”¨ç»§æ‰¿ï¼›ç”¨è¡Œä¸ºç±»ç»„åˆï¼Œè€Œä¸æ˜¯è¡Œä¸ºçš„ç»§æ‰¿ï¼Œæ›´æœ‰å¼¹æ€§ã€‚ è´£ä»»é“¾æ¨¡å¼ èŒè´£é“¾æ¨¡å¼ï¼ˆChain of Responsibility Patternï¼‰, åˆå« è´£ä»»é“¾æ¨¡å¼ï¼Œä¸ºè¯·æ±‚åˆ›å»ºäº†ä¸€ä¸ªæ¥æ”¶è€…å¯¹è±¡çš„é“¾ã€‚è¿™ç§æ¨¡å¼å¯¹è¯·æ±‚çš„å‘é€è€…å’Œæ¥æ”¶è€…è¿›è¡Œè§£è€¦ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112public class Client &#123; public static void main(String[] args) &#123; // åˆ›å»ºä¸€ä¸ªè¯·æ±‚ PurchaseRequest purchaseRequest = new PurchaseRequest(1, 31000, 1); // åˆ›å»ºç›¸å…³çš„å®¡æ‰¹äºº DepartmentApprover departmentApprover = new DepartmentApprover(\"å¼ ä¸»ä»»\"); CollegeApprover collegeApprover = new CollegeApprover(\"æé™¢é•¿\"); ViceSchoolMasterApprover viceSchoolMasterApprover = new ViceSchoolMasterApprover(\"ç‹å‰¯æ ¡\"); SchoolMasterApprover schoolMasterApprover = new SchoolMasterApprover(\"ä½Ÿæ ¡é•¿\"); // éœ€è¦å°†å„ä¸ªå®¡æ‰¹çº§åˆ«çš„ä¸‹ä¸€ä¸ªè®¾ç½®å¥½ (å¤„ç†äººæ„æˆç¯å½¢) // å„å¤„ç†è€…å¤„ç†çš„èŒƒå›´ï¼ˆä»»åŠ¡ç±»å‹ï¼‰ä¸åŒ departmentApprover.setApprover(collegeApprover); collegeApprover.setApprover(viceSchoolMasterApprover); viceSchoolMasterApprover.setApprover(schoolMasterApprover); schoolMasterApprover.setApprover(departmentApprover); // åˆ†å‘ä»»åŠ¡ departmentApprover.processRequest(purchaseRequest); viceSchoolMasterApprover.processRequest(purchaseRequest); &#125;&#125;public abstract class Approver &#123; Approver approver; // ä¸‹ä¸€ä¸ªå¤„ç†è€… String name; // åå­— public Approver(String name) &#123; this.name = name; &#125; // ä¸‹ä¸€ä¸ªå¤„ç†è€… public void setApprover(Approver approver) &#123; this.approver = approver; &#125; // å¤„ç†å®¡æ‰¹è¯·æ±‚çš„æ–¹æ³•ï¼Œå¾—åˆ°ä¸€ä¸ªè¯·æ±‚, å¤„ç†æ˜¯å­ç±»å®Œæˆï¼Œå› æ­¤è¯¥æ–¹æ³•åšæˆæŠ½è±¡ public abstract void processRequest(PurchaseRequest purchaseRequest);&#125;public class CollegeApprover extends Approver &#123; public CollegeApprover(String name) &#123; super(name); &#125; @Override public void processRequest(PurchaseRequest purchaseRequest) &#123; if(purchaseRequest.getPrice() &lt; 5000 &amp;&amp; purchaseRequest.getPrice() &lt;= 10000) &#123; System.out.println(\" è¯·æ±‚ç¼–å· id= \" + purchaseRequest.getId() + \" è¢« \" + this.name + \" å¤„ç†\"); &#125;else &#123; approver.processRequest(purchaseRequest); &#125; &#125;&#125;public class DepartmentApprover extends Approver &#123; public DepartmentApprover(String name) &#123; super(name); &#125; @Override public void processRequest(PurchaseRequest purchaseRequest) &#123; if(purchaseRequest.getPrice() &lt;= 5000) &#123; System.out.println(\" è¯·æ±‚ç¼–å· id= \" + purchaseRequest.getId() + \" è¢« \" + this.name + \" å¤„ç†\"); &#125;else &#123; approver.processRequest(purchaseRequest); &#125; &#125;&#125;public class SchoolMasterApprover extends Approver &#123; public SchoolMasterApprover(String name) &#123; super(name); &#125; @Override public void processRequest(PurchaseRequest purchaseRequest) &#123; if(purchaseRequest.getPrice() &gt; 30000) &#123; System.out.println(\" è¯·æ±‚ç¼–å· id= \" + purchaseRequest.getId() + \" è¢« \" + this.name + \" å¤„ç†\"); &#125;else &#123; approver.processRequest(purchaseRequest); &#125; &#125;&#125;public class ViceSchoolMasterApprover extends Approver &#123; public ViceSchoolMasterApprover(String name) &#123; super(name); &#125; @Override public void processRequest(PurchaseRequest purchaseRequest) &#123; // TODO Auto-generated method stub if(purchaseRequest.getPrice() &lt; 10000 &amp;&amp; purchaseRequest.getPrice() &lt;= 30000) &#123; System.out.println(\" è¯·æ±‚ç¼–å· id= \" + purchaseRequest.getId() + \" è¢« \" + this.name + \" å¤„ç†\"); &#125;else &#123; approver.processRequest(purchaseRequest); &#125; &#125;&#125;// è¯·æ±‚ç±»public class PurchaseRequest &#123; private int type = 0; // è¯·æ±‚ç±»å‹ private float price = 0.0f; // è¯·æ±‚é‡‘é¢ private int id = 0; // æ„é€ å™¨ public PurchaseRequest(int type, float price, int id) &#123; this.type = type; this.price = price; this.id = id; &#125; public int getType() &#123; return type; &#125; public float getPrice() &#123; return price; &#125; public int getId() &#123; return id; &#125;&#125;","categories":[{"name":"Java","slug":"Java","permalink":"http://yoursite.com/categories/Java/"}],"tags":[{"name":"Design Patterns","slug":"Design-Patterns","permalink":"http://yoursite.com/tags/Design-Patterns/"}]},{"title":"ç»“æ„å‹æ¨¡å¼","slug":"Java/DesignPatterns/ç»“æ„å‹æ¨¡å¼","date":"2020-03-21T08:52:20.000Z","updated":"2020-04-19T06:26:56.690Z","comments":true,"path":"2020/03/21/Java/DesignPatterns/ç»“æ„å‹æ¨¡å¼/","link":"","permalink":"http://yoursite.com/2020/03/21/Java/DesignPatterns/%E7%BB%93%E6%9E%84%E5%9E%8B%E6%A8%A1%E5%BC%8F/","excerpt":"è®¾è®¡æ¨¡å¼ä¹‹ç»“æ„å‹æ¨¡å¼ã€‚","text":"è®¾è®¡æ¨¡å¼ä¹‹ç»“æ„å‹æ¨¡å¼ã€‚ é€‚é…å™¨æ¨¡å¼ é€‚é…å™¨æ¨¡å¼ï¼ˆAdapter Patternï¼‰å°†æŸä¸ªç±»çš„æ¥å£è½¬æ¢æˆå®¢æˆ·ç«¯æœŸæœ›çš„å¦ä¸€ä¸ªæ¥å£è¡¨ç¤ºï¼Œä¸»çš„ç›®çš„æ˜¯å…¼å®¹æ€§ï¼Œè®©åŸæœ¬å› æ¥å£ä¸åŒ¹é…ä¸èƒ½ä¸€èµ·å·¥ä½œçš„ä¸¤ä¸ªç±»å¯ä»¥ååŒå·¥ä½œï¼Œå…¶åˆ«åä¸ºåŒ…è£…å™¨ï¼ˆWrapperï¼‰ã€‚ ç§ç±»ï¼šç±» / å¯¹è±¡ / æ¥å£é€‚é…å™¨æ¨¡å¼ã€‚ ç±»é€‚é…å™¨ 123456789101112131415161718192021222324252627282930313233343536373839404142public class Client &#123; public static void main(String[] args) &#123; System.out.println(\" === ç±»é€‚é…å™¨æ¨¡å¼ ===\"); Phone phone = new Phone(); phone.charging(new VoltageAdapter()); &#125;&#125;// é€‚é…æ¥å£public interface IVoltage5V &#123; public int output5V();&#125;public class Phone &#123; // å……ç”µ public void charging(IVoltage5V iVoltage5V) &#123; if(iVoltage5V.output5V() == 5) &#123; System.out.println(\"ç”µå‹ä¸º 5V, å¯ä»¥å……ç”µ\"); &#125; else if (iVoltage5V.output5V() &gt; 5) &#123; System.out.println(\"ç”µå‹å¤§äº 5V, ä¸èƒ½å……ç”µ\"); &#125; &#125;&#125;// è¢«é€‚é…çš„ç±»public class Voltage220V &#123; // è¾“å‡º 220V çš„ç”µå‹ public int output220V() &#123; int src = 220; System.out.println(\"ç”µå‹=\" + src + \"ä¼\"); return src; &#125;&#125;// é€‚é…å™¨ï¼ŒJava å•ç»§æ‰¿æœºåˆ¶ï¼Œæ‰€ä»¥ç›®æ ‡ç±»å¿…é¡»æ˜¯ä¸€ä¸ªæ¥å£public class VoltageAdapter extends Voltage220V implements IVoltage5V &#123; @Override public int output5V() &#123; // è·å–åˆ° 220V ç”µå‹ int srcV = output220V(); int dstV = srcV / 44 ; // è½¬æˆ 5v return dstV; &#125;&#125; å¯¹è±¡é€‚é…å™¨ åŸºæœ¬æ€è·¯å’Œç±»çš„é€‚é…å™¨æ¨¡å¼ç›¸åŒï¼Œåªæ˜¯å°† Adapter ç±»ä½œä¿®æ”¹ï¼Œä¸æ˜¯ç»§æ‰¿ resource ç±»ï¼Œè€Œæ˜¯æŒæœ‰å…¶çš„å®ä¾‹ï¼Œä»¥è§£å†³å…¼å®¹æ€§çš„é—®é¢˜ã€‚ å³æ ¹æ®åˆæˆå¤ç”¨åŸåˆ™ï¼Œåœ¨ç³»ç»Ÿä¸­å°½é‡ä½¿ç”¨å…³è”å…³ç³»ï¼ˆèšåˆï¼‰æ¥æ›¿ä»£ç»§æ‰¿å…³ç³»ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748public class Client &#123; public static void main(String[] args) &#123; System.out.println(\" === å¯¹è±¡é€‚é…å™¨æ¨¡å¼ ===\"); Phone phone = new Phone(); phone.charging(new VoltageAdapter(new Voltage220V())); &#125;&#125;public interface Voltage5V &#123; public int output5V();&#125;public class Phone &#123; public void charging(IVoltage5V iVoltage5V) &#123; if(iVoltage5V.output5V() == 5) &#123; System.out.println(\"ç”µå‹ä¸º 5V, å¯ä»¥å……ç”µ\"); &#125; else if (iVoltage5V.output5V() &gt; 5) &#123; System.out.println(\"ç”µå‹å¤§äº 5V, ä¸èƒ½å……ç”µ\"); &#125; &#125;&#125;public class Voltage220V &#123; public int output220V() &#123; int src = 220; System.out.println(\"ç”µå‹=\" + src + \"ä¼\"); return src; &#125;&#125;public class VoltageAdapter implements IVoltage5V &#123; private Voltage220V voltage220V; // å…³è”å…³ç³»-èšåˆ // é€šè¿‡æ„é€ å™¨ï¼Œä¼ å…¥ä¸€ä¸ª Voltage220V å®ä¾‹ public VoltageAdapter(Voltage220V voltage220v) &#123; this.voltage220V = voltage220v; &#125; @Override public int output5V() &#123; int dst = 0; if(null != voltage220V) &#123; int src = voltage220V.output220V(); // è·å– 220V ç”µå‹ System.out.println(\"ä½¿ç”¨å¯¹è±¡é€‚é…å™¨ï¼Œè¿›è¡Œé€‚é…\"); dst = src / 44; System.out.println(\"é€‚é…å®Œæˆï¼Œè¾“å‡ºçš„ç”µå‹ä¸º=\" + dst); &#125; return dst; &#125;&#125; å¯¹è±¡é€‚é…å™¨å’Œç±»é€‚é…å™¨å…¶å®ç®—æ˜¯åŒä¸€ç§æ€æƒ³ï¼Œåªä¸è¿‡å®ç°æ–¹å¼ä¸åŒã€‚æ ¹æ®åˆæˆå¤ç”¨åŸåˆ™ï¼Œä½¿ç”¨ç»„åˆæ›¿ä»£ç»§æ‰¿ï¼Œ æ‰€ä»¥å®ƒè§£å†³äº†ç±»é€‚é…å™¨å¿…é¡»ç»§æ‰¿ resource çš„å±€é™æ€§é—®é¢˜ï¼Œä¹Ÿä¸å†è¦æ±‚ destination å¿…é¡»æ˜¯æ¥å£ã€‚ æ¥å£é€‚é…å™¨ æ ¸å¿ƒæ€è·¯ï¼šå½“ä¸éœ€è¦å…¨éƒ¨å®ç°æ¥å£æä¾›çš„æ–¹æ³•æ—¶ï¼Œå¯å…ˆè®¾è®¡ä¸€ä¸ªæŠ½è±¡ç±»å®ç°æ¥å£ï¼Œå¹¶ä¸ºè¯¥æ¥å£ä¸­æ¯ä¸ªæ–¹æ³•æä¾›ä¸€ä¸ªé»˜è®¤å®ç°ï¼ˆç©ºæ–¹æ³•ï¼‰ï¼Œé‚£ä¹ˆè¯¥æŠ½è±¡ç±»çš„å­ç±»å¯æœ‰é€‰æ‹©åœ°è¦†ç›–çˆ¶ç±»çš„æŸäº›æ–¹æ³•æ¥å®ç°éœ€æ±‚ã€‚è¯¥æ¨¡å¼é€‚ç”¨äºä¸€ä¸ªæ¥å£ä¸æƒ³ä½¿ç”¨å…¶æ‰€æœ‰çš„æ–¹æ³•çš„æƒ…å†µã€‚ 123456789101112131415161718192021222324252627282930public interface Interface &#123; public void m1(); public void m2(); public void m3(); public void m4();&#125;// åœ¨ AbsAdapter æˆ‘ä»¬å°† Interface çš„æ–¹æ³•è¿›è¡Œé»˜è®¤å®ç°public abstract class AbsAdapter implements Interface &#123; public void m1() &#123; &#125; public void m2() &#123; &#125; public void m3() &#123; &#125; public void m4() &#123; &#125;&#125;public class Client &#123; public static void main(String[] args) &#123; AbsAdapter absAdapter = new AbsAdapter() &#123; // åªéœ€è¦†ç›–éœ€è¦ä½¿ç”¨æ¥å£æ–¹æ³• @Override public void m1() &#123; System.out.println(\"ä½¿ç”¨äº† m1 çš„æ–¹æ³•\"); &#125; &#125;; absAdapter.m1(); &#125;&#125; Spring MVC SpringMvc ä¸­çš„ HandlerAdapter, å°±ä½¿ç”¨äº†é€‚é…å™¨æ¨¡å¼ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899public class DispatchServlet &#123; public static List&lt;HandlerAdapter&gt; handlerAdapters = new ArrayList&lt;HandlerAdapter&gt;(); public DispatchServlet() &#123; // åˆå§‹åŒ–å„ç§é€‚é…å™¨ handlerAdapters.add(new AnnotationHandlerAdapter()); handlerAdapters.add(new HttpHandlerAdapter()); handlerAdapters.add(new SimpleHandlerAdapter()); &#125; public void doDispatch() &#123; // æ­¤å¤„æ¨¡æ‹Ÿ SpringMVC ä» request å– handler çš„å¯¹è±¡ HttpController controller = new HttpController(); // å¾—åˆ°å¯¹åº”é€‚é…å™¨ HandlerAdapter adapter = getHandler(controller); // é€šè¿‡é€‚é…å™¨æ‰§è¡Œå¯¹åº”çš„ controller çš„å¯¹åº”æ–¹æ³• adapter.handle(controller); &#125; public HandlerAdapter getHandler(Controller controller) &#123; // éå†ï¼šæ ¹æ®å¾—åˆ°çš„ controller å³ handler, è¿”å›å¯¹åº”é€‚é…å™¨ for (HandlerAdapter adapter : this.handlerAdapters) &#123; // åˆ¤è¯»æ­¤é€‚é…å™¨æ˜¯å¦æ”¯æŒæ­¤ç±»å‹çš„ controller if (adapter.supports(controller)) &#123; return adapter; &#125; &#125; return null; &#125; public static void main(String[] args) &#123; new DispatchServlet().doDispatch(); &#125;&#125;public interface Controller &#123;&#125;// å¤šç§ Controller ç±» class HttpController implements Controller &#123; public void doHttpHandler() &#123; System.out.println(\"http...\"); &#125;&#125;class SimpleController implements Controller &#123; public void doSimplerHandler() &#123; System.out.println(\"simple...\"); &#125;&#125;class AnnotationController implements Controller &#123; public void doAnnotationHandler() &#123; System.out.println(\"annotation...\"); &#125;&#125;public interface HandlerAdapter &#123; public boolean supports(Object handler); public void handle(Object handler);&#125;// å¤šç§ Adapter ç±»class SimpleHandlerAdapter implements HandlerAdapter &#123; public void handle(Object handler) &#123; ((SimpleController) handler).doSimplerHandler(); &#125; public boolean supports(Object handler) &#123; return (handler instanceof SimpleController); &#125;&#125;class HttpHandlerAdapter implements HandlerAdapter &#123; public void handle(Object handler) &#123; ((HttpController) handler).doHttpHandler(); &#125; public boolean supports(Object handler) &#123; return (handler instanceof HttpController); &#125;&#125;class AnnotationHandlerAdapter implements HandlerAdapter &#123; public void handle(Object handler) &#123; ((AnnotationController) handler).doAnnotationHandler(); &#125; public boolean supports(Object handler) &#123; return (handler instanceof AnnotationController); &#125;&#125; æ¡¥æ¥æ¨¡å¼ å°†å®ç°ä¸æŠ½è±¡æ”¾åœ¨ä¸¤ä¸ªä¸åŒçš„ç±»å±‚æ¬¡ä¸­ï¼Œä½¿ä¸¤ä¸ªå±‚æ¬¡å¯ä»¥ç‹¬ç«‹æ”¹å˜ï¼› Bridge æ¨¡å¼åŸºäºç±»çš„æœ€å°è®¾è®¡åŸåˆ™ï¼Œé€šè¿‡ä½¿ç”¨å°è£…ã€èšåˆåŠç»§æ‰¿ç­‰è¡Œä¸ºè®©ä¸åŒçš„ç±»æ‰¿æ‹…ä¸åŒçš„èŒè´£ã€‚å®ƒçš„ä¸»è¦ç‰¹ç‚¹æ˜¯æŠŠæŠ½è±¡ï¼ˆAbstractionï¼‰ä¸è¡Œä¸ºå®ç°ï¼ˆImplementationï¼‰åˆ†ç¦»å¼€æ¥ï¼Œä»è€Œå¯ä»¥ä¿æŒå„éƒ¨åˆ†çš„ç‹¬ç«‹æ€§ä»¥åŠåº”å¯¹ä»–ä»¬çš„åŠŸèƒ½æ‰©å±•ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116public class Client &#123; public static void main(String[] args) &#123; Phone phone1 = new FoldedPhone(new XiaoMi()); phone1.open(); phone1.call(); phone1.close(); System.out.println(\"=======\"); Phone phone2 = new FoldedPhone(new Vivo()); phone2.open(); phone2.call(); phone2.close(); System.out.println(\"=======\"); UpRightPhone phone3 = new UpRightPhone(new XiaoMi()); phone3.open(); phone3.call(); phone3.close(); System.out.println(\"=======\"); UpRightPhone phone4 = new UpRightPhone(new Vivo()); phone4.open(); phone4.call(); phone4.close(); &#125;&#125;// æ‰‹æœºè¿™ä¸€è§’è‰²çš„æŠ½è±¡public abstract class Phone &#123; // ç»„åˆå“ç‰Œ private Brand brand; // æ„é€ å™¨ public Phone(Brand brand) &#123; super(); this.brand = brand; &#125; protected void open() &#123; this.brand.open(); &#125; protected void close() &#123; brand.close(); &#125; protected void call() &#123; brand.call(); &#125;&#125;public class FoldedPhone extends Phone &#123; public FoldedPhone(Brand brand) &#123; super(brand); &#125; public void open() &#123; super.open(); System.out.println(\" æŠ˜å æ ·å¼æ‰‹æœº \"); &#125; public void close() &#123; super.close(); System.out.println(\" æŠ˜å æ ·å¼æ‰‹æœº \"); &#125; public void call() &#123; super.call(); System.out.println(\" æŠ˜å æ ·å¼æ‰‹æœº \"); &#125;&#125;public class UpRightPhone extends Phone &#123; // æ„é€ å™¨ public UpRightPhone(Brand brand) &#123; super(brand); &#125; public void open() &#123; super.open(); System.out.println(\" ç›´ç«‹æ ·å¼æ‰‹æœº \"); &#125; public void close() &#123; super.close(); System.out.println(\" ç›´ç«‹æ ·å¼æ‰‹æœº \"); &#125; public void call() &#123; super.call(); System.out.println(\" ç›´ç«‹æ ·å¼æ‰‹æœº \"); &#125;&#125;// æ‰‹æœºçš„è¡Œä¸ºpublic interface Brand &#123; void open(); void close(); void call();&#125;public class Vivo implements Brand &#123; @Overrid public void open() &#123; System.out.println(\" Vivo æ‰‹æœºå¼€æœº \"); &#125; @Override public void close() &#123; System.out.println(\" Vivo æ‰‹æœºå…³æœº \"); &#125; @Override public void call() &#123; System.out.println(\" Vivo æ‰‹æœºæ‰“ç”µè¯ \"); &#125;&#125;public class XiaoMi implements Brand &#123; @Override public void open() &#123; System.out.println(\" å°ç±³æ‰‹æœºå¼€æœº \"); &#125; @Override public void close() &#123; System.out.println(\" å°ç±³æ‰‹æœºå…³æœº \"); &#125; @Override public void call() &#123; System.out.println(\" å°ç±³æ‰‹æœºæ‰“ç”µè¯ \"); &#125;&#125; JDBC è¿™é‡Œæ²¡æœ‰è¿›è¡ŒæŠ½è±¡ã€‚ è£…é¥°è€…æ¨¡å¼ åŠ¨æ€çš„å°†æ–°åŠŸèƒ½é™„åŠ åˆ°å¯¹è±¡ä¸Šã€‚åœ¨å¯¹è±¡åŠŸèƒ½æ‰©å±•æ–¹é¢ï¼Œå®ƒæ¯”ç»§æ‰¿æ›´æœ‰å¼¹æ€§ï¼Œè£…é¥°è€…æ¨¡å¼ä¹Ÿä½“ç°äº†å¼€é—­åŸåˆ™ OCPã€‚ è£…é¥°è€…å¯ä»¥åŒ…å«è¢«è£…é¥°è€…ï¼šä¸€å±‚ä¸€å±‚å°±åƒåŒ…å¿«é€’ä¸€æ ·ï¼Œæ¯”ä¸€æ ·çš„ç‰©å“åŒ…è£…çš„æ–¹å¼ä¸åŒã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100public abstract class Drink &#123; public String des; // é¥®å“çš„æè¿° private float price = 0.0f; // Getter / Setter // è§„å®šå­ç±»éƒ½è¦æœ‰è®¡ç®—ä»·æ ¼çš„æ–¹æ³• public abstract float cost();&#125;public class Coffee extends Drink &#123; @Override public float cost() &#123; return super.getPrice(); &#125;&#125;public class DeCaf extends Coffee &#123; public DeCaf() &#123; setDes(\" DeCaf \"); setPrice(1.0f); &#125;&#125;public class LongBlack extends Coffee &#123; public LongBlack() &#123; setDes(\" longblack \"); setPrice(5.0f); &#125;&#125;public class ShortBlack extends Coffee&#123; public ShortBlack() &#123; setDes(\" shortblack \"); setPrice(4.0f); &#125;&#125;public class Decorator extends Drink &#123; private Drink obj; public Decorator(Drink obj) &#123; // ç»„åˆ this.obj = obj; &#125; @Override public float cost() &#123; // getPrice è‡ªå·±ä»·æ ¼ return super.getPrice() + obj.cost(); // é€’å½’åˆ—å‡ºæ‰€æœ‰ä»·æ ¼ &#125; @Override public String getDes() &#123; // obj.getDes() è¾“å‡ºè¢«è£…é¥°è€…çš„ä¿¡æ¯ return des + \" \" + getPrice() + \" &amp;&amp; \" + obj.getDes(); &#125;&#125;// å…·ä½“çš„ Decoratorï¼Œ è¿™é‡Œå°±æ˜¯è°ƒå‘³å“public class Chocolate extends Decorator &#123; public Chocolate(Drink obj) &#123; super(obj); setDes(\" å·§å…‹åŠ› \"); setPrice(3.0f); // è°ƒå‘³å“çš„ä»·æ ¼ &#125;&#125;public class Milk extends Decorator &#123; public Milk(Drink obj) &#123; super(obj); setDes(\" ç‰›å¥¶ \"); setPrice(2.0f); &#125;&#125;public class CoffeeBar &#123; public static void main(String[] args) &#123; // è£…é¥°è€…æ¨¡å¼ä¸‹çš„è®¢å•ï¼š2 ä»½å·§å…‹åŠ› + 1 ä»½ç‰›å¥¶çš„ LongBlack // ç‚¹ä¸€ä»½ LongBlack Drink order = new LongBlack(); System.out.println(\"è´¹ç”¨ = \" + order.cost()); System.out.println(\"æè¿° = \" + order.getDes()); // order åŠ å…¥ä¸€ä»½ç‰›å¥¶ order = new Milk(order); System.out.println(\"order åŠ å…¥ä¸€ä»½ç‰›å¥¶ è´¹ç”¨ = \" + order.cost()); System.out.println(\"order åŠ å…¥ä¸€ä»½ç‰›å¥¶ æè¿° = \" + order.getDes()); // order åŠ å…¥ä¸€ä»½å·§å…‹åŠ› order = new Chocolate(order); System.out.println(\"order åŠ å…¥ä¸€ä»½ç‰›å¥¶ åŠ å…¥ä¸€ä»½å·§å…‹åŠ› è´¹ç”¨ = \" + order.cost()); System.out.println(\"order åŠ å…¥ä¸€ä»½ç‰›å¥¶ åŠ å…¥ä¸€ä»½å·§å…‹åŠ› æè¿° = \" + order.getDes()); // order åŠ å…¥ä¸€ä»½å·§å…‹åŠ› order = new Chocolate(order); System.out.println(\"order åŠ å…¥ä¸€ä»½ç‰›å¥¶ åŠ å…¥ 2 ä»½å·§å…‹åŠ› è´¹ç”¨ = \" + order.cost()); System.out.println(\"order åŠ å…¥ä¸€ä»½ç‰›å¥¶ åŠ å…¥ 2 ä»½å·§å…‹åŠ› æè¿° = \" + order.getDes()); System.out.println(\"=======\"); Drink order2 = new DeCaf(); System.out.println(\"order2 æ— å› å’–å•¡ è´¹ç”¨ = \" + order2.cost()); System.out.println(\"order2 æ— å› å’–å•¡ æè¿° = \" + order2.getDes()); order2 = new Milk(order2); System.out.println(\"order2 æ— å› å’–å•¡ åŠ å…¥ä¸€ä»½ç‰›å¥¶ è´¹ç”¨ = \" + order2.cost()); System.out.println(\"order2 æ— å› å’–å•¡ åŠ å…¥ä¸€ä»½ç‰›å¥¶ æè¿° = \" + order2.getDes()); &#125;&#125; JDK-FilterInputStream è£…é¥°è€… FilterInputSteam çš„éƒ¨åˆ†ä»£ç ã€‚ ç»„åˆæ¨¡å¼ ç»„åˆæ¨¡å¼ï¼ˆComposite Patternï¼‰ï¼Œåˆå«éƒ¨åˆ†æ•´ä½“æ¨¡å¼ï¼Œå®ƒåˆ›å»ºäº†å¯¹è±¡ç»„çš„æ ‘å½¢ç»“æ„ï¼Œå°†å¯¹è±¡ç»„åˆæˆæ ‘çŠ¶ç»“æ„ä»¥è¡¨ç¤ºï¼ˆæ•´ä½“-éƒ¨åˆ†ï¼‰å±‚æ¬¡å…³ç³»ã€‚ ç»„åˆæ¨¡å¼ä½¿å¾—ç”¨æˆ·å¯¹å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡çš„è®¿é—®å…·æœ‰ä¸€è‡´æ€§ï¼Œå³ï¼šç»„åˆèƒ½è®©å®¢æˆ·ä»¥ä¸€è‡´çš„æ–¹å¼å¤„ç†ä¸ªåˆ«å¯¹è±¡ä»¥åŠç»„åˆå¯¹è±¡ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136public class Client &#123; public static void main(String[] args) &#123; // ç»„åˆå…³ç³»ï¼šç³» &lt; å­¦é™¢ &lt; å¤§å­¦ OrganizationComponent university = new University(\"æ¸…åå¤§å­¦\", \" ä¸­å›½é¡¶çº§å¤§å­¦ \"); OrganizationComponent computerCollege = new College(\"è®¡ç®—æœºå­¦é™¢\", \" è®¡ç®—æœºå­¦é™¢ \"); OrganizationComponent infoEngineercollege = new College(\"ä¿¡æ¯å·¥ç¨‹å­¦é™¢\", \" ä¿¡æ¯å·¥ç¨‹å­¦é™¢ \"); // å°†ç³»åŠ å…¥åˆ°å­¦é™¢ computerCollege.add(new Department(\"è½¯ä»¶å·¥ç¨‹\", \" è½¯ä»¶å·¥ç¨‹ä¸é”™ \")); computerCollege.add(new Department(\"ç½‘ç»œå·¥ç¨‹\", \" ç½‘ç»œå·¥ç¨‹ä¸é”™ \")); computerCollege.add(new Department(\"è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯\", \" è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯æ˜¯è€ç‰Œçš„ä¸“ä¸š \")); infoEngineercollege.add(new Department(\"é€šä¿¡å·¥ç¨‹\", \" é€šä¿¡å·¥ç¨‹ä¸å¥½å­¦ \")); infoEngineercollege.add(new Department(\"ä¿¡æ¯å·¥ç¨‹\", \" ä¿¡æ¯å·¥ç¨‹å¥½å­¦ \")); // å°†å­¦é™¢åŠ å…¥åˆ°å­¦æ ¡ university.add(computerCollege); university.add(infoEngineercollege); //university.print(); infoEngineercollege.print(); &#125;&#125;public abstract class OrganizationComponent &#123; private String name; // åå­— private String des; // è¯´æ˜ protected void add(OrganizationComponent organizationComponent) &#123; // é»˜è®¤å®ç° throw new UnsupportedOperationException(); &#125; protected void remove(OrganizationComponent organizationComponent) &#123; // é»˜è®¤å®ç° throw new UnsupportedOperationException(); &#125; // æ„é€ å™¨ public OrganizationComponent(String name, String des) &#123; super(); this.name = name; this.des = des; &#125; // Getter / Setter // å­ç±»éƒ½éœ€è¦å®ç°çš„æŠ½è±¡æ–¹æ³• protected abstract void print();&#125;// University ä¸ºéå¶å­èŠ‚ç‚¹, å¯ä»¥ç®¡ç† Collegepublic class University extends OrganizationComponent &#123; List&lt;OrganizationComponent&gt; organizationComponents = new ArrayList&lt;OrganizationComponent&gt;(); // æ„é€ å™¨ public University(String name, String des) &#123; super(name, des); &#125; // é‡å†™ add @Override protected void add(OrganizationComponent organizationComponent) &#123; organizationComponents.add(organizationComponent); &#125; // é‡å†™ remove @Override protected void remove(OrganizationComponent organizationComponent) &#123; organizationComponents.remove(organizationComponent); &#125; @Override public String getName() &#123; return super.getName(); &#125; @Override public String getDes() &#123; return super.getDes(); &#125; @Override protected void print() &#123; System.out.println(\"---\" + getName() + \"---\"); //éå† organizationComponents for (OrganizationComponent organizationComponent : organizationComponents) &#123; organizationComponent.print(); &#125; &#125;&#125;public class College extends OrganizationComponent &#123; // ç”¨äºå­˜æ”¾ Department çš„ List List&lt;OrganizationComponent&gt; organizationComponents = new ArrayList&lt;OrganizationComponent&gt;(); // æ„é€ å™¨ public College(String name, String des) &#123; super(name, des); &#125; // æ ¹æ®éœ€æ±‚é‡å†™æ–¹æ³•ï¼Œä¸åŒå±‚æ¬¡çš„å®ç°å¯èƒ½ä¸åŒ @Override protected void add(OrganizationComponent organizationComponent) &#123; organizationComponents.add(organizationComponent); &#125; @Override protected void remove(OrganizationComponent organizationComponent) &#123; organizationComponents.remove(organizationComponent); &#125; @Override public String getName() &#123; return super.getName(); &#125; @Override public String getDes() &#123; return super.getDes(); &#125; // è¾“å‡ºå­¦é™¢ @Override protected void print() &#123; // TODO Auto-generated method stub System.out.println(\"---\" + getName() + \"---\"); //éå† organizationComponents for (OrganizationComponent organizationComponent : organizationComponents) &#123; organizationComponent.print(); &#125; &#125;&#125;// å¶å­èŠ‚ç‚¹public class Department extends OrganizationComponent &#123; // æ—  List public Department(String name, String des) &#123; super(name, des); &#125; // æ— éœ€é‡å†™ add remove æ–¹æ³• @Override public String getName() &#123; return super.getName(); &#125; @Override public String getDes() &#123; return super.getDes(); &#125; @Override protected void print() &#123; System.out.println(getName()); &#125;&#125; JDK-HashMap å¤–è§‚æ¨¡å¼ å¤–è§‚æ¨¡å¼é€šè¿‡å®šä¹‰ä¸€ä¸ªä¸€è‡´çš„æ¥å£ï¼Œç”¨ä»¥å±è”½å†…éƒ¨å­ç³»ç»Ÿçš„ç»†èŠ‚ï¼Œä½¿å¾—è°ƒç”¨ç«¯åªéœ€è·Ÿè¿™ä¸ªæ¥å£å‘ç”Ÿè°ƒç”¨ï¼Œè€Œæ— éœ€å…³å¿ƒè¿™ä¸ªå­ç³»ç»Ÿçš„å†…éƒ¨ç»†èŠ‚ã€‚ äº«å…ƒæ¨¡å¼ è¿ç”¨å…±äº«æŠ€æœ¯æœ‰æ•ˆåœ°æ”¯æŒå¤§é‡ç»†ç²’åº¦çš„å¯¹è±¡ï¼› å¸¸ç”¨äºç³»ç»Ÿåº•å±‚å¼€å‘ï¼Œè§£å†³ç³»ç»Ÿçš„æ€§èƒ½é—®é¢˜ã€‚åƒæ•°æ®åº“è¿æ¥æ± ï¼Œé‡Œé¢éƒ½æ˜¯åˆ›å»ºå¥½çš„è¿æ¥å¯¹è±¡ï¼Œåœ¨è¿™äº›è¿æ¥å¯¹è±¡ä¸­æœ‰æˆ‘ä»¬éœ€è¦çš„åˆ™ç›´æ¥æ‹¿æ¥ç”¨ï¼Œé¿å…é‡æ–°åˆ›å»ºï¼Œå¦‚æœæ²¡æœ‰æˆ‘ä»¬éœ€è¦çš„ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªï¼›äº«å…ƒæ¨¡å¼èƒ½å¤Ÿè§£å†³é‡å¤å¯¹è±¡çš„å†…å­˜æµªè´¹çš„é—®é¢˜ï¼Œå½“ç³»ç»Ÿä¸­æœ‰å¤§é‡ç›¸ä¼¼å¯¹è±¡ï¼Œåˆ›å»ºç¼“å†²æ± ï¼Œä¸éœ€æ€»æ˜¯åˆ›å»ºæ–°å¯¹è±¡ï¼Œå¯ä»¥ä»ç¼“å†²æ± é‡Œæ‹¿ã€‚è¿™æ ·å¯ä»¥é™ä½ç³»ç»Ÿå†…å­˜ï¼ŒåŒæ—¶æé«˜æ•ˆç‡ï¼›äº«å…ƒæ¨¡å¼ç»å…¸çš„åº”ç”¨åœºæ™¯å°±æ˜¯æ± æŠ€æœ¯äº†ï¼ŒString å¸¸é‡æ± ã€æ•°æ®åº“è¿æ¥æ± ã€ç¼“å†²æ± ç­‰ç­‰éƒ½æ˜¯äº«å…ƒæ¨¡å¼çš„åº”ç”¨ï¼Œäº«å…ƒæ¨¡å¼æ˜¯æ± æŠ€æœ¯çš„é‡è¦å®ç°æ–¹å¼ã€‚ äº«å…ƒæ¨¡å¼æå‡ºäº†ä¸¤ä¸ªè¦æ±‚ï¼šç»†ç²’åº¦å’Œå…±äº«å¯¹è±¡ã€‚è¿™é‡Œå°±æ¶‰åŠåˆ°å†…éƒ¨çŠ¶æ€å’Œå¤–éƒ¨çŠ¶æ€äº†ï¼Œå³å°†å¯¹è±¡çš„ä¿¡æ¯åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼šå†…éƒ¨çŠ¶æ€å’Œå¤–éƒ¨çŠ¶æ€ï¼š(1) å†…éƒ¨çŠ¶æ€æŒ‡å¯¹è±¡å…±äº«å‡ºæ¥çš„ä¿¡æ¯ï¼Œå­˜å‚¨åœ¨äº«å…ƒå¯¹è±¡å†…éƒ¨ä¸”ä¸ä¼šéšç¯å¢ƒçš„æ”¹å˜è€Œæ”¹å˜ï¼›(2) å¤–éƒ¨çŠ¶æ€æŒ‡å¯¹è±¡å¾—ä»¥ä¾èµ–çš„ä¸€ä¸ªæ ‡è®°ï¼Œæ˜¯éšç¯å¢ƒæ”¹å˜è€Œæ”¹å˜çš„ã€ä¸å¯å…±äº«çš„çŠ¶æ€ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364public class Client &#123; public static void main(String[] args) &#123; // åˆ›å»ºä¸€ä¸ªå·¥å‚ç±» WebSiteFactory factory = new WebSiteFactory(); // å®¢æˆ·è¦ä¸€ä¸ªä»¥æ–°é—»å½¢å¼å‘å¸ƒçš„ç½‘ç«™ WebSite webSite1 = factory.getWebSiteCategory(\"æ–°é—»\"); webSite1.use(new User(\"tom\")); // å®¢æˆ·è¦ä¸€ä¸ªä»¥åšå®¢å½¢å¼å‘å¸ƒçš„ç½‘ç«™ WebSite webSite2 = factory.getWebSiteCategory(\"åšå®¢\"); webSite2.use(new User(\"jack\")); // å®¢æˆ·è¦ä¸€ä¸ªä»¥åšå®¢å½¢å¼å‘å¸ƒçš„ç½‘ç«™ WebSite webSite3 = factory.getWebSiteCategory(\"åšå®¢\"); webSite3.use(new User(\"smith\")); // å®¢æˆ·è¦ä¸€ä¸ªä»¥åšå®¢å½¢å¼å‘å¸ƒçš„ç½‘ç«™ WebSite webSite4 = factory.getWebSiteCategory(\"åšå®¢\"); webSite4.use(new User(\"king\")); System.out.println(\"ç½‘ç«™çš„åˆ†ç±»å…±=\" + factory.getWebSiteCount()); &#125;&#125;public abstract class WebSite &#123; public abstract void use(User user); // æŠ½è±¡æ–¹æ³•&#125;// å…·ä½“ç½‘ç«™public class ConcreteWebSite extends WebSite &#123; // å…±äº«çš„éƒ¨åˆ†ï¼Œå†…éƒ¨çŠ¶æ€ private String type = \"\"; // ç½‘ç«™å‘å¸ƒçš„ç±»å‹ // æ„é€ å™¨ public ConcreteWebSite(String type) &#123; this.type = type; &#125; @Override public void use(User user) &#123; System.out.println(\"ç½‘ç«™çš„å‘å¸ƒå½¢å¼ä¸º:\" + type + \" ä½¿ç”¨è€…æ˜¯\" + user.getName()); &#125;&#125; // ä½¿ç”¨è€…public class User &#123; private String name; public User(String name) &#123; super(); this.name = name; &#125; // Getter / Setter&#125;// ç½‘ç«™å·¥å‚ç±»ï¼Œæ ¹æ®éœ€è¦è¿”å›ä¸€ä¸ªç›¸åº”çš„ç½‘ç«™public class WebSiteFactory &#123; // é›†åˆï¼šç›¸å½“äºä¸€ä¸ªæ±  private HashMap&lt;String, ConcreteWebSite&gt; pool = new HashMap&lt;&gt;(); // æ ¹æ®ç½‘ç«™çš„ç±»å‹ï¼Œè¿”å›ä¸€ä¸ªç½‘ç«™, å¦‚æœæ²¡æœ‰å°±åˆ›å»ºä¸€ä¸ªç½‘ç«™ï¼Œå¹¶æ”¾å…¥åˆ°æ± ä¸­,å¹¶è¿”å› public WebSite getWebSiteCategory(String type) &#123; if(!pool.containsKey(type)) &#123; // æ— æ­¤ç±»å‹åˆ™åˆ›å»ºä¸€ä¸ªç½‘ç«™ï¼Œå¹¶æ”¾å…¥åˆ°æ± ä¸­ pool.put(type, new ConcreteWebSite(type)); &#125; return (WebSite)pool.get(type); &#125; // è·å–ç½‘ç«™åˆ†ç±»çš„æ€»æ•° public int getWebSiteCount() &#123; return pool.size(); &#125;&#125; JDK-Integer [127,-128]ï¼šæ­¤èŒƒå›´å†…ç›´æ¥ä»æ± è¿”å› ã€‚ äº«å…ƒæ¨¡å¼æé«˜äº†ç³»ç»Ÿçš„å¤æ‚åº¦ã€‚éœ€è¦åˆ†ç¦»å‡ºå†…éƒ¨çŠ¶æ€å’Œå¤–éƒ¨çŠ¶æ€ï¼Œè€Œå¤–éƒ¨çŠ¶æ€å…·æœ‰å›ºåŒ–ç‰¹æ€§ï¼Œä¸åº”è¯¥éšç€å†…éƒ¨çŠ¶æ€çš„æ”¹å˜è€Œæ”¹å˜ï¼Œè¿™æ˜¯æˆ‘ä»¬ä½¿ç”¨äº«å…ƒæ¨¡å¼éœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼› ä½¿ç”¨äº«å…ƒæ¨¡å¼æ—¶ï¼Œæ³¨æ„åˆ’åˆ†å†…éƒ¨çŠ¶æ€å’Œå¤–éƒ¨çŠ¶æ€ï¼Œå¹¶ä¸”éœ€è¦æœ‰ä¸€ä¸ªå·¥å‚ç±»åŠ ä»¥æ§åˆ¶ã€‚ ä»£ç†æ¨¡å¼ ä»£ç†æ¨¡å¼ï¼šä¸ºä¸€ä¸ªå¯¹è±¡æä¾›ä¸€ä¸ªæ›¿èº«ï¼Œä»¥æ§åˆ¶å¯¹è¿™ä¸ªå¯¹è±¡çš„è®¿é—®ã€‚å³é€šè¿‡ä»£ç†å¯¹è±¡è®¿é—®ç›®æ ‡å¯¹è±¡ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯å¯ä»¥åœ¨ç›®æ ‡å¯¹è±¡å®ç°çš„åŸºç¡€ä¸Šï¼Œå¢å¼ºé¢å¤–çš„åŠŸèƒ½æ“ä½œï¼Œå³æ‰©å±•ç›®æ ‡å¯¹è±¡çš„åŠŸèƒ½ï¼›è¢«ä»£ç†çš„å¯¹è±¡å¯ä»¥æ˜¯è¿œç¨‹å¯¹è±¡ã€åˆ›å»ºå¼€é”€å¤§çš„å¯¹è±¡æˆ–éœ€è¦å®‰å…¨æ§åˆ¶çš„å¯¹è±¡ï¼›ä»£ç†æ¨¡å¼æœ‰ä¸åŒçš„å½¢å¼, ä¸»è¦æœ‰ä¸‰ç§ï¼š(1) é™æ€ä»£ç† (2) åŠ¨æ€ä»£ç† ï¼ˆJDK ä»£ç†ã€æ¥å£ä»£ç†ï¼‰(3) Cglib ä»£ç† ï¼ˆå¯ä»¥åœ¨å†…å­˜åŠ¨æ€çš„åˆ›å»ºå¯¹è±¡ï¼Œè€Œä¸éœ€è¦å®ç°æ¥å£ï¼Œ ä»–æ˜¯å±äºåŠ¨æ€ä»£ç†çš„èŒƒç•´ï¼‰ é™æ€ä»£ç† é™æ€ä»£ç†åœ¨ä½¿ç”¨æ—¶ï¼Œéœ€è¦å®šä¹‰æ¥å£æˆ–è€…çˆ¶ç±»,è¢«ä»£ç†å¯¹è±¡ï¼ˆå³ç›®æ ‡å¯¹è±¡ï¼‰ä¸ä»£ç†å¯¹è±¡ä¸€èµ·å®ç°ç›¸åŒçš„æ¥å£æˆ–è€…æ˜¯ç»§æ‰¿ç›¸åŒçˆ¶ç±»ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738public class Client &#123; public static void main(String[] args) &#123; // åˆ›å»ºç›®æ ‡å¯¹è±¡ï¼šè¢«ä»£ç†å¯¹è±¡ TeacherDaoImpl teacherDaoImpl = new TeacherDaoImpl(); // åˆ›å»ºä»£ç†å¯¹è±¡, åŒæ—¶å°†è¢«ä»£ç†å¯¹è±¡ä¼ é€’ç»™ä»£ç†å¯¹è±¡ TeacherDaoProxy teacherDaoProxy = new TeacherDaoProxy(teacherDaoImpl); // é€šè¿‡ä»£ç†å¯¹è±¡ï¼Œè°ƒç”¨åˆ°è¢«ä»£ç†å¯¹è±¡çš„æ–¹æ³• // å³ï¼šæ‰§è¡Œçš„æ˜¯ä»£ç†å¯¹è±¡çš„æ–¹æ³•ï¼Œä»£ç†å¯¹è±¡å†å»è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„æ–¹æ³• teacherDaoProxy.teach(); &#125;&#125;// æ¥å£public interface TeacherDao &#123; void teach(); // æˆè¯¾çš„æ–¹æ³•&#125;public class TeacherDaoImpl implements TeacherDao &#123; @Override public void teach() &#123; System.out.println(\" è€å¸ˆæˆè¯¾ä¸­ ã€‚ã€‚ã€‚ã€‚ã€‚\"); &#125;&#125;// ä»£ç†å¯¹è±¡ï¼šé™æ€ä»£ç†public class TeacherDaoProxy implements TeacherDao&#123; private TeacherDao target; // ç›®æ ‡å¯¹è±¡ï¼Œé€šè¿‡æ¥å£æ¥èšåˆ // æ„é€ å™¨ public TeacherDaoProxy(TeacherDao target) &#123; this.target = target; &#125; @Override public void teach() &#123; System.out.println(\"å¼€å§‹ä»£ç† å®ŒæˆæŸäº›æ“ä½œ...\"); // ç›®æ ‡æ–¹æ³•å‰æ“ä½œ target.teach(); // ç›®æ ‡æ–¹æ³• System.out.println(\"æäº¤...\"); // ç›®æ ‡æ–¹æ³•åæ“ä½œ &#125;&#125; åŠ¨æ€ä»£ç† ä»£ç†å¯¹è±¡ä¸éœ€è¦å®ç°æ¥å£ï¼Œä½†æ˜¯ç›®æ ‡å¯¹è±¡è¦å®ç°æ¥å£ï¼Œå¦åˆ™ä¸èƒ½ç”¨åŠ¨æ€ä»£ç†ã€‚ä»£ç†å¯¹è±¡çš„ç”Ÿæˆï¼Œæ˜¯åˆ©ç”¨ JDK çš„ APIï¼ŒåŠ¨æ€çš„åœ¨å†…å­˜ä¸­æ„å»ºä»£ç†å¯¹è±¡ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455public class Client &#123; public static void main(String[] args) &#123; // TODO Auto-generated method stub // åˆ›å»ºç›®æ ‡å¯¹è±¡ TeacherDao target = new TeacherDaoImpl(); // ç»™ç›®æ ‡å¯¹è±¡ï¼Œåˆ›å»ºä»£ç†å¯¹è±¡, å¯ä»¥è½¬æˆ TeacherDao TeacherDao proxyInstance = (TeacherDao)new ProxyFactory(target).getProxyInstance(); // proxyInstance = class com.sun.proxy.$Proxy0 å†…å­˜ä¸­åŠ¨æ€ç”Ÿæˆäº†ä»£ç†å¯¹è±¡ System.out.println(\"proxyInstance=\" + proxyInstance.getClass()); // é€šè¿‡ä»£ç†å¯¹è±¡ï¼Œè°ƒç”¨ç›®æ ‡å¯¹è±¡çš„æ–¹æ³• proxyInstance.teach(); proxyInstance.sayHello(\" tom \"); &#125;&#125;// æ¥å£public interface teacherDao &#123; void teach(); // æˆè¯¾æ–¹æ³• void sayHello(String name);&#125;public class ProxyFactory &#123; // ç»´æŠ¤ä¸€ä¸ªç›®æ ‡å¯¹è±¡ , Object private Object target; // æ„é€ å™¨ï¼šå¯¹ target è¿›è¡Œåˆå§‹åŒ– public ProxyFactory(Object target) &#123; this.target = target; &#125; // ç»™ç›®æ ‡å¯¹è±¡ ç”Ÿæˆä¸€ä¸ªä»£ç†å¯¹è±¡ public Object getProxyInstance() &#123; // ClassLoader loader ï¼š æŒ‡å®šå½“å‰ç›®æ ‡å¯¹è±¡ä½¿ç”¨çš„ç±»åŠ è½½å™¨, è·å–åŠ è½½å™¨çš„æ–¹æ³•å›ºå®š // Class&lt;?&gt;[] interfaces: ç›®æ ‡å¯¹è±¡å®ç°çš„æ¥å£ç±»å‹ï¼Œä½¿ç”¨æ³›å‹æ–¹æ³•ç¡®è®¤ç±»å‹ // InvocationHandler h : äº‹æƒ…å¤„ç†ï¼Œæ‰§è¡Œç›®æ ‡å¯¹è±¡çš„æ–¹æ³•æ—¶ï¼Œä¼šè§¦å‘äº‹æƒ…å¤„ç†å™¨æ–¹æ³•, ä¼šæŠŠå½“å‰æ‰§è¡Œ return Proxy.newProxyInstance(target.getClass().getClassLoader(), target.getClass().getInterfaces(), new InvocationHandler() &#123; @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123; System.out.println(\"JDK ä»£ç†å¼€å§‹\"); //åå°„æœºåˆ¶è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„æ–¹æ³• Object returnVal = method.invoke(target, args); System.out.println(\"JDK ä»£ç†æäº¤\"); return returnVal; &#125; &#125;); &#125;&#125;public class TeacherDaoImpl implements TeacherDao &#123; @Override public void teach() &#123; System.out.println(\" è€å¸ˆæˆè¯¾ä¸­... \"); &#125; @Override public void sayHello(String name) &#123; System.out.println(\"hello \" + name); &#125;&#125; Cglib ä»£ç†æ¨¡å¼ é™æ€ä»£ç†å’Œ JDK ä»£ç†æ¨¡å¼éƒ½è¦æ±‚ç›®æ ‡å¯¹è±¡æ˜¯å®ç°ä¸€ä¸ªæ¥å£,ä½†æ˜¯æœ‰æ—¶å€™ç›®æ ‡å¯¹è±¡åªæ˜¯ä¸€ä¸ªå•ç‹¬çš„å¯¹è±¡ï¼Œå¹¶æ²¡æœ‰å®ç°ä»»ä½•çš„æ¥å£ï¼Œè¿™ä¸ªæ—¶å€™å¯ä½¿ç”¨ç›®æ ‡å¯¹è±¡å­ç±»æ¥å®ç°ä»£ç†ï¼Œè¿™ç§æ¨¡å¼å°±æ˜¯ Cglib ä»£ç†ã€‚ Cglib ä»£ç†ä¹Ÿå«ä½œå­ç±»ä»£ç†ï¼Œå®ƒæ˜¯åœ¨å†…å­˜ä¸­æ„å»ºä¸€ä¸ªå­ç±»å¯¹è±¡ä»è€Œå®ç°å¯¹ç›®æ ‡å¯¹è±¡åŠŸèƒ½æ‰©å±•ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546public class Client &#123; public static void main(String[] args) &#123; // åˆ›å»ºç›®æ ‡å¯¹è±¡ TeacherDao target = new TeacherDao(); // è·å–åˆ°ä»£ç†å¯¹è±¡ï¼Œå¹¶ä¸”å°†ç›®æ ‡å¯¹è±¡ä¼ é€’ç»™ä»£ç†å¯¹è±¡ TeacherDao proxyInstance = (TeacherDao)new ProxyFactory(target).getProxyInstance(); // æ‰§è¡Œä»£ç†å¯¹è±¡çš„æ–¹æ³•ï¼Œè§¦å‘ intercept æ–¹æ³•ï¼Œä»è€Œå®ç°å¯¹ç›®æ ‡å¯¹è±¡çš„è°ƒç”¨ String res = proxyInstance.teach(); System.out.println(\"res=\" + res); &#125;&#125;public class ProxyFactory implements MethodInterceptor &#123; // ç»´æŠ¤ä¸€ä¸ªç›®æ ‡å¯¹è±¡ private Object target; // æ„é€ å™¨ï¼Œä¼ å…¥ä¸€ä¸ªè¢«ä»£ç†çš„å¯¹è±¡ public ProxyFactory(Object target) &#123; this.target = target; &#125; // è¿”å›ä¸€ä¸ªä»£ç†å¯¹è±¡: æ˜¯ target å¯¹è±¡çš„ä»£ç†å¯¹è±¡ public Object getProxyInstance() &#123; // åˆ›å»ºä¸€ä¸ªå·¥å…·ç±» Enhancer enhancer = new Enhancer(); // è®¾ç½®çˆ¶ç±» enhancer.setSuperclass(target.getClass()); // è®¾ç½®å›è°ƒå‡½æ•° enhancer.setCallback(this); // åˆ›å»ºå­ç±»å¯¹è±¡ï¼Œå³ä»£ç†å¯¹è±¡ return enhancer.create(); &#125; // é‡å†™ intercept æ–¹æ³•ï¼Œä¼šè°ƒç”¨ç›®æ ‡å¯¹è±¡çš„æ–¹æ³• @Override public Object intercept(Object arg0, Method method, Object[] args, MethodProxy arg3) throws Throwable &#123; System.out.println(\"Cglib ä»£ç†æ¨¡å¼å¼€å§‹\"); Object returnVal = method.invoke(target, args); System.out.println(\"Cglib ä»£ç†æ¨¡å¼æäº¤\"); return returnVal; &#125;&#125;public class TeacherDao &#123; public String teach() &#123; System.out.println(\" è€å¸ˆæˆè¯¾ä¸­ï¼Œcglib ä»£ç†ä¸éœ€è¦å®ç°æ¥å£ \"); return \"hello\"; &#125;&#125; å¸¸ç”¨å˜ä½“ (1) é˜²ç«å¢™ä»£ç†å†…ç½‘é€šè¿‡ä»£ç†ç©¿é€é˜²ç«å¢™ï¼Œå®ç°å¯¹å…¬ç½‘çš„è®¿é—®; (2) ç¼“å­˜ä»£ç†æ¯”å¦‚ï¼šå½“è¯·æ±‚å›¾ç‰‡æ–‡ä»¶ç­‰èµ„æºæ—¶ï¼Œå…ˆåˆ°ç¼“å­˜ä»£ç†å–ï¼Œå¦‚æœå–åˆ°èµ„æºåˆ™ okï¼Œå¦‚æœå–ä¸åˆ°èµ„æºï¼Œå†åˆ°å…¬ç½‘æˆ–è€…æ•°æ®åº“å–ï¼Œç„¶åç¼“å­˜ï¼› (3) è¿œç¨‹ä»£ç†è¿œç¨‹å¯¹è±¡çš„æœ¬åœ°ä»£è¡¨ï¼Œé€šè¿‡å®ƒå¯ä»¥æŠŠè¿œç¨‹å¯¹è±¡å½“æœ¬åœ°å¯¹è±¡æ¥è°ƒç”¨ã€‚è¿œç¨‹ä»£ç†é€šè¿‡ç½‘ç»œå’ŒçœŸæ­£çš„è¿œç¨‹å¯¹è±¡æ²Ÿé€šä¿¡æ¯ï¼› (4) åŒæ­¥ä»£ç†ï¼šä¸»è¦ä½¿ç”¨åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ï¼Œå®Œæˆå¤šçº¿ç¨‹é—´åŒæ­¥å·¥ä½œã€‚","categories":[{"name":"Java","slug":"Java","permalink":"http://yoursite.com/categories/Java/"}],"tags":[{"name":"Design Patterns","slug":"Design-Patterns","permalink":"http://yoursite.com/tags/Design-Patterns/"}]},{"title":"åˆ›å»ºå‹æ¨¡å¼","slug":"Java/DesignPatterns/åˆ›å»ºå‹æ¨¡å¼","date":"2020-03-21T07:56:29.000Z","updated":"2020-04-19T06:26:50.859Z","comments":true,"path":"2020/03/21/Java/DesignPatterns/åˆ›å»ºå‹æ¨¡å¼/","link":"","permalink":"http://yoursite.com/2020/03/21/Java/DesignPatterns/%E5%88%9B%E5%BB%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F/","excerpt":"è®¾è®¡æ¨¡å¼ä¹‹åˆ›å»ºå‹æ¨¡å¼ã€‚","text":"è®¾è®¡æ¨¡å¼ä¹‹åˆ›å»ºå‹æ¨¡å¼ã€‚ å•ä¾‹æ¨¡å¼é¥¿æ±‰å¼é™æ€å˜é‡123456789101112//é¥¿æ±‰å¼ï¼šé™æ€å˜é‡class Singleton &#123; // æ„é€ å™¨ç§æœ‰åŒ–, å¤–éƒ¨ä¸èƒ½ new private Singleton() &#123; &#125; // æœ¬ç±»å†…éƒ¨åˆ›å»ºå¯¹è±¡å®ä¾‹ private final static Singleton instance = new Singleton(); // æä¾›ä¸€ä¸ªå…¬æœ‰çš„é™æ€æ–¹æ³•ï¼Œè¿”å›å®ä¾‹å¯¹è±¡ public static Singleton getInstance() &#123; return instance; &#125;&#125; é™æ€ä»£ç å—1234567891011121314// é¥¿æ±‰å¼ï¼šé™æ€ä»£ç å—class Singleton &#123; private Singleton() &#123; &#125; // æœ¬ç±»å†…éƒ¨åˆ›å»ºå¯¹è±¡å®ä¾‹ private static Singleton instance; static &#123; // åœ¨é™æ€ä»£ç å—ä¸­ï¼Œåˆ›å»ºå•ä¾‹å¯¹è±¡ instance = new Singleton(); &#125; // æä¾›ä¸€ä¸ªå…¬æœ‰çš„é™æ€æ–¹æ³•ï¼Œè¿”å›å®ä¾‹å¯¹è±¡ public static Singleton getInstance() &#123; return instance; &#125;&#125; æ‡’æ±‰å¼åŒæ­¥æ–¹æ³•12345678910111213// æ‡’æ±‰å¼ï¼šçº¿ç¨‹å®‰å…¨ï¼ŒåŒæ­¥æ–¹æ³•class Singleton &#123; private static Singleton instance; private Singleton() &#123;&#125; // æä¾›ä¸€ä¸ªé™æ€çš„å…¬æœ‰æ–¹æ³•ï¼ŒåŠ å…¥åŒæ­¥å¤„ç†çš„ä»£ç ï¼Œè§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜ // æ¯ä¸€ä¸ªçº¿ç¨‹è·å–å®ä¾‹æ—¶éƒ½è¦è¿›åˆ°åŒæ­¥æ–¹æ³•ä¸­è¿›è¡Œåˆ¤è¯»ï¼Œå¤§å¤§é™ä½äº†æ•ˆç‡ public static synchronized Singleton getInstance() &#123; if(instance == null) &#123; instance = new Singleton(); &#125; return instance; &#125;&#125; åŒé‡æ£€æŸ¥12345678910111213141516// æ‡’æ±‰å¼ï¼šåŒé‡æ£€æŸ¥class Singleton &#123; private static Singleton instance; private Singleton() &#123;&#125; public static Singleton getInstance() &#123; if(instance == null) &#123; // ä¸€æ¬¡åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯è¿›å…¥æ­¤åŒæ­¥ä»£ç å—ä¸­ synchronized (Singleton.class) &#123; if(instance == null) &#123; instance = new Singleton(); &#125; &#125; &#125; return instance; &#125;&#125; é™æ€å†…éƒ¨ç±» é™æ€å†…éƒ¨ç±»æ–¹å¼åœ¨ Singleton ç±»è¢«è£…è½½æ—¶å¹¶ä¸ä¼šç«‹å³å®ä¾‹åŒ–ï¼Œè€Œæ˜¯åœ¨éœ€è¦å®ä¾‹åŒ–æ—¶ï¼Œè°ƒç”¨ getInstance æ–¹æ³•ï¼Œæ‰ä¼šè£…è½½ SingletonInstance ç±»ï¼Œä»è€Œå®Œæˆ Singleton çš„å®ä¾‹åŒ–ã€‚ ç±»çš„é™æ€å±æ€§åªä¼šåœ¨ç¬¬ä¸€æ¬¡åŠ è½½ç±»çš„æ—¶å€™åˆå§‹åŒ–ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œï¼ŒJVM å¸®åŠ©æˆ‘ä»¬ä¿è¯äº†çº¿ç¨‹çš„å®‰å…¨æ€§ï¼Œåœ¨ç±»è¿›è¡Œåˆå§‹åŒ–æ—¶ï¼Œåˆ«çš„çº¿ç¨‹æ˜¯æ— æ³•è¿›å…¥çš„ã€‚ 1234567891011121314// æ‡’æ±‰å¼ï¼šé™æ€å†…éƒ¨ç±»class Singleton &#123; private static volatile Singleton instance; // æ„é€ å™¨ç§æœ‰åŒ– private Singleton() &#123;&#125; // å†™ä¸€ä¸ªé™æ€å†…éƒ¨ç±»ï¼Œè¯¥ç±»ä¸­æœ‰ä¸€ä¸ªé™æ€å±æ€§ Singleton private static class SingletonInstance &#123; private static final Singleton INSTANCE = new Singleton(); &#125; // æä¾›ä¸€ä¸ªé™æ€çš„å…¬æœ‰æ–¹æ³•ï¼Œç›´æ¥è¿”å› SingletonInstance.INSTANCE public static synchronized Singleton getInstance() &#123; return SingletonInstance.INSTANCE; &#125;&#125; æšä¸¾12345678// æ‡’æ±‰å¼ï¼šæšä¸¾enum Singleton &#123; INSTANCE; //å±æ€§ public void sayOK() &#123; System.out.println(\"ok~\"); &#125;&#125;// ä¸ä»…èƒ½é¿å…å¤šçº¿ç¨‹åŒæ­¥é—®é¢˜ï¼Œè€Œä¸”è¿˜èƒ½é˜²æ­¢ååºåˆ—åŒ–é‡æ–°åˆ›å»ºæ–°çš„å¯¹è±¡ æ€»ç»“å•ä¾‹æ¨¡å¼ä¿è¯äº†ç³»ç»Ÿå†…å­˜ä¸­è¯¥ç±»åªå­˜åœ¨ä¸€ä¸ªå¯¹è±¡ï¼ŒèŠ‚çœäº†ç³»ç»Ÿèµ„æºï¼Œå¯¹äºä¸€äº›éœ€è¦é¢‘ç¹åˆ›å»ºé”€æ¯çš„å¯¹è±¡ï¼Œä½¿ç”¨å•ä¾‹æ¨¡å¼å¯ä»¥æé«˜ç³»ç»Ÿæ€§èƒ½ï¼› å½“æƒ³å®ä¾‹åŒ–ä¸€ä¸ªå•ä¾‹ç±»çš„æ—¶å€™ï¼Œå¿…é¡»è¦è®°ä½ä½¿ç”¨ç›¸åº”çš„è·å–å¯¹è±¡çš„æ–¹æ³•ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ newï¼› å•ä¾‹æ¨¡å¼ä½¿ç”¨çš„åœºæ™¯ï¼šéœ€è¦é¢‘ç¹çš„è¿›è¡Œåˆ›å»ºå’Œé”€æ¯çš„å¯¹è±¡ã€åˆ›å»ºå¯¹è±¡æ—¶è€—æ—¶è¿‡å¤šæˆ–è€—è´¹èµ„æºè¿‡å¤šï¼ˆå³ï¼šé‡é‡çº§å¯¹è±¡ï¼‰ï¼Œä½†åˆç»å¸¸ç”¨åˆ°çš„å¯¹è±¡ã€å·¥å…·ç±»å¯¹è±¡ã€é¢‘ç¹è®¿é—®æ•°æ®åº“æˆ–æ–‡ä»¶çš„å¯¹è±¡ï¼ˆæ¯”å¦‚æ•°æ®æºã€session å·¥å‚ç­‰ï¼‰ã€‚ å·¥å‚æ¨¡å¼ç®€å•å·¥å‚ ç®€å•å·¥å‚æ¨¡å¼æ˜¯å±äºåˆ›å»ºå‹æ¨¡å¼ï¼Œæ˜¯å·¥å‚æ¨¡å¼çš„ä¸€ç§ã€‚ç®€å•å·¥å‚æ¨¡å¼æ˜¯ç”±ä¸€ä¸ªå·¥å‚å¯¹è±¡å†³å®šåˆ›å»ºå‡ºå“ªä¸€ç§äº§å“ç±»çš„å®ä¾‹ã€‚ç®€å•å·¥å‚æ¨¡å¼æ˜¯å·¥å‚æ¨¡å¼å®¶æ—ä¸­æœ€ç®€å•å®ç”¨çš„æ¨¡å¼ã€‚ ç®€å•å·¥å‚æ¨¡å¼ï¼šå®šä¹‰äº†ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„ç±»ï¼Œç”±è¿™ä¸ªç±»æ¥å°è£…å®ä¾‹åŒ–å¯¹è±¡çš„è¡Œä¸º(ä»£ç )ã€‚ åœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œå½“æˆ‘ä»¬ä¼šç”¨åˆ°å¤§é‡çš„åˆ›å»ºæŸç§ã€æŸç±»æˆ–è€…æŸæ‰¹å¯¹è±¡æ—¶ï¼Œå°±ä¼šä½¿ç”¨åˆ°å·¥å‚æ¨¡å¼ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738// æ­¤ç±»ä¸ºä½¿ç”¨è€…ï¼Œå½“æä¾›æ–¹è¿›è¡Œæ‰©å±•æ—¶éœ€è¦è¿›è¡Œæ¯”è¾ƒå¤§çš„ä»£ç ä¿®æ”¹ï¼Œè¿å OCP åŸåˆ™public OrderPizza() &#123; Pizza pizza = null; String orderType; // è®¢è´­æŠ«è¨çš„ç±»å‹ do &#123; orderType = getType(); if (orderType.equals(\"greek\")) &#123; pizza = new GreekPizza(); pizza.setName(\" å¸Œè…ŠæŠ«è¨ \"); &#125; else if (orderType.equals(\"cheese\")) &#123; pizza = new CheesePizza(); pizza.setName(\" å¥¶é…ªæŠ«è¨ \"); &#125; else if (orderType.equals(\"pepper\")) &#123; pizza = new PepperPizza(); pizza.setName(\"èƒ¡æ¤’æŠ«è¨\"); &#125; else &#123; break; &#125; // è¾“å‡º pizza åˆ¶ä½œè¿‡ç¨‹ pizza.prepare(); pizza.bake(); pizza.cut(); pizza.box(); &#125; while (true);&#125;// å†™ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥è·å–å®¢æˆ·å¸Œæœ›è®¢è´­çš„æŠ«è¨ç§ç±»private String getType() &#123; try &#123; BufferedReader strin = new BufferedReader(new InputStreamReader(System.in)); System.out.println(\"input pizza ç§ç±»:\"); String str = strin.readLine(); return str; &#125; catch (IOException e) &#123; e.printStackTrace(); return \"\"; &#125;&#125; å¦‚æœæˆ‘ä»¬å¢åŠ ä¸€ä¸ª Pizza ç±»ï¼Œåªè¦æ˜¯è®¢è´­ Pizza çš„ä»£ç éƒ½éœ€è¦ä¿®æ”¹ã€‚å½“ç„¶ä¿®æ”¹ä»£ç æ˜¯å¯ä»¥æ¥å—ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬åœ¨å…¶å®ƒçš„åœ°æ–¹ä¹Ÿæœ‰åˆ›å»º Pizza çš„ä»£ç ï¼Œå°±æ„å‘³ç€ï¼Œä¹Ÿéœ€è¦ä¿®æ”¹ï¼Œè€Œåˆ›å»º Pizza çš„ä»£ç ï¼Œå¾€å¾€æœ‰å¤šå¤„ã€‚ ç®€å•å·¥å‚æ¨¡å¼çš„è®¾è®¡æ–¹æ¡ˆï¼šå®šä¹‰ä¸€ä¸ªå¯ä»¥å®ä¾‹åŒ– Pizaa å¯¹è±¡çš„ç±»ï¼Œå°è£…åˆ›å»ºå¯¹è±¡çš„ä»£ç ã€‚å½“æ‰€æœ‰çš„å¯¹è±¡çš„å®ä¾‹åŒ–éƒ½ç”±ä¸€ä¸ªå·¥å‚è¿›è¡Œè´Ÿè´£æ—¶ï¼Œæ–°å¢ä¸€ä¸ª Pizza ç±»åªç”¨ä¿®æ”¹å·¥å‚ç±»å³å¯ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647// ç®€å•å·¥å‚ç±»public class SimpleFactory &#123; // æ·»åŠ  orderType è¿”å›å¯¹åº”çš„ Pizza å¯¹è±¡ public Pizza createPizza(String orderType) &#123; // æ ¹æ®éœ€æ±‚è¿˜å¯ä»¥æ˜¯é™æ€æ–¹æ³• Pizza pizza = null; System.out.println(\"ç®€å•å·¥å‚æ¨¡å¼\"); if (orderType.equals(\"greek\")) &#123; pizza = new GreekPizza(); pizza.setName(\" å¸Œè…ŠæŠ«è¨ \"); &#125; else if (orderType.equals(\"cheese\")) &#123; pizza = new CheesePizza(); pizza.setName(\" å¥¶é…ªæŠ«è¨ \"); &#125; else if (orderType.equals(\"pepper\")) &#123; pizza = new PepperPizza(); pizza.setName(\"èƒ¡æ¤’æŠ«è¨\"); &#125; return pizza; &#125;&#125;// ä½¿ç”¨è€…public OrderPizza() &#123; // å®šä¹‰ä¸€ä¸ªç®€å•å·¥å‚å¯¹è±¡ SimpleFactory simpleFactory; Pizza pizza = null; // æ„é€ å™¨ public OrderPizza(SimpleFactory simpleFactory) &#123; setFactory(simpleFactory); &#125; public void setFactory(SimpleFactory simpleFactory) &#123; String orderType = \"\"; // ç”¨æˆ·è¾“å…¥çš„ this.simpleFactory = simpleFactory; // è®¾ç½®ç®€å•å·¥å‚å¯¹è±¡ do &#123; orderType = getType(); pizza = this.simpleFactory.createPizza(orderType); // è¾“å‡º pizza if(pizza != null) &#123; pizza.prepare(); pizza.bake(); pizza.cut(); pizza.box(); &#125; else &#123; System.out.println(\" è®¢è´­æŠ«è¨å¤±è´¥ \"); break; &#125; &#125;while(true); &#125;&#125; å·¥å‚æ–¹æ³• å·¥å‚æ–¹æ³•æ¨¡å¼ï¼šå®šä¹‰äº†ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„æŠ½è±¡æ–¹æ³•ï¼Œç”±å­ç±»å†³å®šè¦å®ä¾‹åŒ–çš„å¯¹è±¡ã€‚å·¥å‚æ–¹æ³•æ¨¡å¼å°†å¯¹è±¡çš„å®ä¾‹åŒ–æ¨è¿Ÿåˆ°å­ç±»ã€‚ ç®€å•å·¥å‚æ¨¡å¼éœ€è¦ä¸€ä¸ªå·¥å‚è¿›è¡Œæ“ä½œï¼Œå½“æ›´å¤šçš„ä¸åŒçš„éœ€æ±‚æ—¶ï¼Œå¯ä»¥é€šè¿‡åˆ›å»ºå¤šä¸ªç®€å•å·¥å‚ç±»è¿›è¡Œå®ç°ï¼›å·¥å‚æ–¹æ³•æ¨¡å¼ç›´æ¥æŠŠä¼šå˜åŒ–çš„æ–¹æ³•æŠ½è±¡åˆ°å­å·¥å‚ä¸­å»å®ç°ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243public abstract class OrderPizza &#123; // å®šä¹‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼ŒcreatePizza , è®©å„ä¸ªå·¥å‚å­ç±»è‡ªå·±å®ç° abstract Pizza createPizza(String orderType); // æ„é€ å™¨ public OrderPizza() &#123; Pizza pizza = null; String orderType; // è®¢è´­æŠ«è¨çš„ç±»å‹ do &#123; orderType = getType(); pizza = createPizza(orderType); // æŠ½è±¡æ–¹æ³•ï¼Œç”±å·¥å‚å­ç±»å®Œæˆ // è¾“å‡º pizza åˆ¶ä½œè¿‡ç¨‹ pizza.prepare(); pizza.bake(); pizza.cut(); pizza.box(); &#125; while (true); &#125;&#125;// å­å·¥å‚public class BJOrderPizza extends OrderPizza &#123; @Override Pizza createPizza(String orderType) &#123; Pizza pizza = null; if(orderType.equals(\"cheese\")) &#123; pizza = new BJCheesePizza(); &#125; else if (orderType.equals(\"pepper\")) &#123; pizza = new BJPepperPizza(); &#125; return pizza; &#125;&#125;public class LDOrderPizza extends OrderPizza &#123; Pizza createPizza(String orderType) &#123; Pizza pizza = null; if(orderType.equals(\"cheese\")) &#123; pizza = new LDCheesePizza(); &#125; else if (orderType.equals(\"pepper\")) &#123; pizza = new LDPepperPizza(); &#125; return pizza; &#125;&#125; æŠ½è±¡å·¥å‚ æŠ½è±¡å·¥å‚æ¨¡å¼ï¼šå®šä¹‰äº†ä¸€ä¸ª interface ç”¨äºåˆ›å»ºç›¸å…³æˆ–æœ‰ä¾èµ–å…³ç³»çš„å¯¹è±¡ç°‡ï¼Œè€Œæ— éœ€æŒ‡æ˜å…·ä½“çš„ç±»ã€‚ æŠ½è±¡å·¥å‚æ¨¡å¼å¯ä»¥å°†ç®€å•å·¥å‚æ¨¡å¼å’Œå·¥å‚æ–¹æ³•æ¨¡å¼è¿›è¡Œæ•´åˆã€‚ä»è®¾è®¡å±‚é¢çœ‹ï¼ŒæŠ½è±¡å·¥å‚æ¨¡å¼å°±æ˜¯å¯¹ç®€å•å·¥å‚æ¨¡å¼çš„æ”¹è¿›ã€‚ï¼ˆæˆ–è€…ç§°ä¸ºè¿›ä¸€æ­¥çš„æŠ½è±¡ï¼‰å°†å·¥å‚æŠ½è±¡æˆä¸¤å±‚ï¼ŒAbsFactoryï¼ˆæŠ½è±¡å·¥å‚ï¼‰å’Œå…·ä½“å®ç°çš„å·¥å‚å­ç±»ã€‚ç¨‹åºå‘˜å¯ä»¥æ ¹æ®åˆ›å»ºå¯¹è±¡ç±»å‹ä½¿ç”¨å¯¹åº”çš„å·¥å‚å­ç±»ã€‚è¿™æ ·å°†å•ä¸ªçš„ç®€å•å·¥å‚ç±»å˜æˆäº†å·¥å‚ç°‡ï¼Œæ›´åˆ©äºä»£ç çš„ç»´æŠ¤å’Œæ‰©å±•ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657// ä¸€ä¸ªæŠ½è±¡å·¥å‚æ¨¡å¼çš„æŠ½è±¡å±‚ï¼šæ¥å£public interface AbsFactory &#123; // è®©ä¸‹é¢çš„å·¥å‚å­ç±»æ¥å…·ä½“å®ç° public Pizza createPizza(String orderType);&#125;public class BJFactory implements AbsFactory &#123; @Override public Pizza createPizza(String orderType) &#123; System.out.println(\"æŠ½è±¡å·¥å‚æ¨¡å¼\"); Pizza pizza = null; if(orderType.equals(\"cheese\")) &#123; pizza = new BJCheesePizza(); &#125; else if (orderType.equals(\"pepper\"))&#123; pizza = new BJPepperPizza(); &#125; return pizza; &#125;&#125;public class LDFactory implements AbsFactory &#123; @Override public Pizza createPizza(String orderType) &#123; System.out.println(\"æŠ½è±¡å·¥å‚æ¨¡å¼\"); Pizza pizza = null; if (orderType.equals(\"cheese\")) &#123; pizza = new LDCheesePizza(); &#125; else if (orderType.equals(\"pepper\")) &#123; pizza = new LDPepperPizza(); &#125; return pizza; &#125;&#125;public class OrderPizza &#123; AbsFactory factory; public OrderPizza(AbsFactory factory) &#123; setFactory(factory); &#125; private void setFactory(AbsFactory factory) &#123; Pizza pizza = null; String orderType = \"\"; this.factory = factory; do &#123; orderType = getType(); // factory å¯èƒ½æ˜¯åŒ—äº¬çš„å·¥å‚å­ç±»ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¼¦æ•¦çš„å·¥å‚å­ç±» pizza = factory.createPizza(orderType); if (pizza != null) &#123; pizza.prepare(); pizza.bake(); pizza.cut(); pizza.box(); &#125; else &#123; System.out.println(\"è®¢è´­å¤±è´¥\"); break; &#125; &#125; while (true); &#125;&#125; æ€»ç»“å·¥å‚æ¨¡å¼çš„æ„ä¹‰ï¼šå°†å®ä¾‹åŒ–å¯¹è±¡çš„ä»£ç æå–å‡ºæ¥ï¼Œæ”¾åˆ°ä¸€ä¸ªç±»ä¸­ç»Ÿä¸€ç®¡ç†å’Œç»´æŠ¤ï¼Œè¾¾åˆ°å’Œä¸»é¡¹ç›®çš„ä¾èµ–å…³ç³»çš„è§£è€¦ã€‚ä»è€Œæé«˜é¡¹ç›®çš„æ‰©å±•å’Œç»´æŠ¤æ€§ã€‚ è®¾è®¡æ¨¡å¼çš„ä¾èµ–æŠ½è±¡åŸåˆ™ï¼š åˆ›å»ºå¯¹è±¡å®ä¾‹æ—¶ï¼Œä¸è¦ç›´æ¥ new ç±», è€Œæ˜¯æŠŠè¿™ä¸ª new ç±»çš„åŠ¨ä½œæ”¾åœ¨ä¸€ä¸ªå·¥å‚çš„æ–¹æ³•ä¸­ï¼Œå¹¶è¿”å›ï¼›ä¸è¦è®©ç±»ç»§æ‰¿å…·ä½“ç±»ï¼Œè€Œæ˜¯ç»§æ‰¿æŠ½è±¡ç±»æˆ–è€…æ˜¯å®ç° interfaceï¼›ä¸è¦è¦†ç›–åŸºç±»ä¸­å·²ç»å®ç°çš„æ–¹æ³•ã€‚ åŸå‹æ¨¡å¼ åŸå‹æ¨¡å¼ï¼ˆPrototype æ¨¡å¼ï¼‰æ˜¯æŒ‡ï¼šç”¨åŸå‹å®ä¾‹æŒ‡å®šåˆ›å»ºå¯¹è±¡çš„ç§ç±»ï¼Œå¹¶ä¸”é€šè¿‡æ‹·è´è¿™äº›åŸå‹ï¼Œåˆ›å»ºæ–°çš„å¯¹è±¡ï¼› åŸå‹æ¨¡å¼æ˜¯ä¸€ç§åˆ›å»ºå‹è®¾è®¡æ¨¡å¼ï¼Œå…è®¸ä¸€ä¸ªå¯¹è±¡å†åˆ›å»ºå¦å¤–ä¸€ä¸ªå¯å®šåˆ¶çš„å¯¹è±¡ï¼Œæ— éœ€çŸ¥é“å¦‚ä½•åˆ›å»ºçš„ç»†èŠ‚ï¼› å·¥ä½œåŸç†ï¼šé€šè¿‡å°†ä¸€ä¸ªåŸå‹å¯¹è±¡ä¼ ç»™é‚£ä¸ªè¦å‘åŠ¨åˆ›å»ºçš„å¯¹è±¡ï¼Œè¿™ä¸ªè¦å‘åŠ¨åˆ›å»ºçš„å¯¹è±¡é€šè¿‡è¯·æ±‚åŸå‹å¯¹è±¡æ‹·è´å®ƒä»¬è‡ªå·±æ¥å®æ–½åˆ›å»ºï¼Œå³ Object.clone() 12345678910111213141516171819202122232425262728293031323334353637383940414243444546public class Sheep implements Cloneable &#123; private String name; private int age; private String color; private String address = \"è’™å¤ç¾Š\"; public Sheep friend; // å…‹éš†æ˜¯ä¼šå¦‚ä½•å¤„ç†å¼•ç”¨å¯¹è±¡å¯¹è±¡, é»˜è®¤æ˜¯æµ…æ‹·è´ public Sheep(String name, int age, String color) &#123; super(); this.name = name; this.age = age; this.color = color; &#125; // Getter / Setter @Override public String toString() &#123; return \"Sheep [name=\" + name + \", age=\" + age + \", color=\" + color + \", address=\" + address + \"]\"; &#125; // å…‹éš†è¯¥å®ä¾‹ï¼Œä½¿ç”¨é»˜è®¤çš„ clone æ–¹æ³•æ¥å®Œæˆ @Override protected Object clone() &#123; Sheep sheep = null; try &#123; sheep = (Sheep)super.clone(); &#125; catch (Exception e) &#123; System.out.println(e.getMessage()); &#125; return sheep; &#125;&#125;public class Client &#123; public static void main(String[] args) &#123; System.out.println(\"åŸå‹æ¨¡å¼å®Œæˆå¯¹è±¡çš„åˆ›å»º\"); Sheep sheep = new Sheep(\"tom\", 1, \"ç™½è‰²\"); sheep.friend = new Sheep(\"jack\", 2, \"é»‘è‰²\"); Sheep sheep2 = (Sheep)sheep.clone(); //å…‹éš† Sheep sheep3 = (Sheep)sheep.clone(); //å…‹éš† Sheep sheep4 = (Sheep)sheep.clone(); //å…‹éš† Sheep sheep5 = (Sheep)sheep.clone(); //å…‹éš† System.out.println(\"sheep2 =\" + sheep2 + \"sheep2.friend=\" + sheep2.friend.hashCode()); System.out.println(\"sheep3 =\" + sheep3 + \"sheep3.friend=\" + sheep3.friend.hashCode()); System.out.println(\"sheep4 =\" + sheep4 + \"sheep4.friend=\" + sheep4.friend.hashCode()); System.out.println(\"sheep5 =\" + sheep5 + \"sheep5.friend=\" + sheep5.friend.hashCode()); &#125;&#125; æµ…æ‹·è´ å¯¹äºæ•°æ®ç±»å‹æ˜¯åŸºæœ¬æ•°æ®ç±»å‹çš„æˆå‘˜å˜é‡ï¼Œæµ…æ‹·è´ä¼šç›´æ¥è¿›è¡Œå€¼ä¼ é€’ï¼Œä¹Ÿå°±æ˜¯å°†è¯¥å±æ€§å€¼å¤åˆ¶ä¸€ä»½ç»™æ–°çš„å¯¹è±¡ï¼› å¯¹äºæ•°æ®ç±»å‹æ˜¯å¼•ç”¨æ•°æ®ç±»å‹çš„æˆå‘˜å˜é‡ï¼Œæ¯”å¦‚è¯´æˆå‘˜å˜é‡æ˜¯æŸä¸ªæ•°ç»„ã€æŸä¸ªç±»çš„å¯¹è±¡ç­‰ï¼Œé‚£ä¹ˆæµ…æ‹·è´ä¼šè¿›è¡Œå¼•ç”¨ä¼ é€’ï¼Œä¹Ÿå°±æ˜¯åªæ˜¯å°†è¯¥æˆå‘˜å˜é‡çš„å¼•ç”¨å€¼ï¼ˆå†…å­˜åœ°å€ï¼‰å¤åˆ¶ä¸€ä»½ç»™æ–°çš„å¯¹è±¡ã€‚å› ä¸ºå®é™…ä¸Šä¸¤ä¸ªå¯¹è±¡çš„è¯¥æˆå‘˜å˜é‡éƒ½æŒ‡å‘åŒä¸€ä¸ªå®ä¾‹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåœ¨ä¸€ä¸ªå¯¹è±¡ä¸­ä¿®æ”¹è¯¥æˆå‘˜å˜é‡ä¼šå½±å“åˆ°å¦ä¸€ä¸ªå¯¹è±¡çš„è¯¥æˆå‘˜å˜é‡å€¼ã€‚ 1Object.clone(); // é»˜è®¤ä¸ºæµ…æ‹·è´ æ·±æ‹·è´ å¤åˆ¶å¯¹è±¡çš„æ‰€æœ‰åŸºæœ¬æ•°æ®ç±»å‹çš„æˆå‘˜å˜é‡å€¼ï¼› ä¸ºæ‰€æœ‰å¼•ç”¨æ•°æ®ç±»å‹çš„æˆå‘˜å˜é‡ç”³è¯·å­˜å‚¨ç©ºé—´ï¼Œå¹¶å¤åˆ¶æ¯ä¸ªå¼•ç”¨æ•°æ®ç±»å‹æˆå‘˜å˜é‡æ‰€å¼•ç”¨çš„å¯¹è±¡ï¼Œç›´åˆ°è¯¥å¯¹è±¡å¯è¾¾çš„æ‰€æœ‰å¯¹è±¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹è±¡è¿›è¡Œæ·±æ‹·è´è¦å¯¹æ•´ä¸ªå¯¹è±¡ï¼ˆåŒ…æ‹¬å¯¹è±¡çš„å¼•ç”¨ç±»å‹ï¼‰è¿›è¡Œæ‹·è´ã€‚ é‡å†™ clone æ–¹æ³•123456789101112131415161718192021222324252627282930313233public class DeepCloneableTarget implements Serializable, Cloneable &#123; private static final long serialVersionUID = 1L; private String cloneName; private String cloneClass; // æ„é€ å™¨ public DeepCloneableTarget(String cloneName, String cloneClass) &#123; this.cloneName = cloneName; this.cloneClass = cloneClass; &#125; // å› ä¸ºè¯¥ç±»çš„å±æ€§ï¼Œéƒ½æ˜¯ String , å› æ­¤æˆ‘ä»¬è¿™é‡Œä½¿ç”¨é»˜è®¤çš„ clone å®Œæˆå³å¯ @Override protected Object clone() throws CloneNotSupportedException &#123; return super.clone(); &#125;&#125;public class DeepProtoType implements Serializable, Cloneable&#123; public String name; // String å±æ€§ public DeepCloneableTarget deepCloneableTarget; // å¼•ç”¨ç±»å‹ public DeepProtoType() &#123; super(); &#125; // æ·±æ‹·è´ï¼šä½¿ç”¨ clone æ–¹æ³• @Override protected Object clone() throws CloneNotSupportedException &#123; Object deep = null; // è¿™é‡Œå®Œæˆå¯¹åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆå±æ€§ï¼‰å’Œ String çš„å…‹éš† deep = super.clone(); // å¯¹å¼•ç”¨ç±»å‹çš„å±æ€§ï¼Œè¿›è¡Œå•ç‹¬å¤„ç† DeepProtoType deepProtoType = (DeepProtoType)deep; deepProtoType.deepCloneableTarget = (DeepCloneableTarget)deepCloneableTarget.clone(); return deepProtoType; &#125;&#125; å¯¹è±¡åºåˆ—åŒ–å®ç°12345678910111213141516171819202122232425262728293031public Object deepClone() &#123; // åˆ›å»ºæµå¯¹è±¡ ByteArrayOutputStream bos = null; ObjectOutputStream oos = null; ByteArrayInputStream bis = null; ObjectInputStream ois = null; try &#123; // åºåˆ—åŒ– bos = new ByteArrayOutputStream(); oos = new ObjectOutputStream(bos); oos.writeObject(this); // å½“å‰è¿™ä¸ªå¯¹è±¡ä»¥å¯¹è±¡æµçš„æ–¹å¼è¾“å‡º // ååºåˆ—åŒ– bis = new ByteArrayInputStream(bos.toByteArray()); ois = new ObjectInputStream(bis); DeepProtoType copyObj = (DeepProtoType)ois.readObject(); return copyObj; &#125; catch (Exception e) &#123; e.printStackTrace(); return null; &#125; finally &#123; // å…³é—­æµ try &#123; bos.close(); oos.close(); bis.close(); ois.close(); &#125; catch (Exception e) &#123; System.out.println(e.getMessage()); &#125; &#125;&#125; æ€»ç»“åˆ›å»ºæ–°çš„å¯¹è±¡æ¯”è¾ƒå¤æ‚æ—¶ï¼Œå¯ä»¥åˆ©ç”¨åŸå‹æ¨¡å¼ç®€åŒ–å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ï¼ŒåŒæ—¶ä¹Ÿèƒ½å¤Ÿæé«˜æ•ˆç‡ï¼›ä¸ç”¨é‡æ–°åˆå§‹åŒ–å¯¹è±¡ï¼Œè€Œæ˜¯åŠ¨æ€åœ°è·å¾—å¯¹è±¡è¿è¡Œæ—¶çš„çŠ¶æ€ï¼›å¦‚æœåŸå§‹å¯¹è±¡å‘ç”Ÿå˜åŒ–ï¼ˆå¢åŠ æˆ–è€…å‡å°‘å±æ€§ï¼‰ï¼Œå…¶å®ƒå…‹éš†å¯¹è±¡çš„ä¹Ÿä¼šå‘ç”Ÿç›¸åº”çš„å˜åŒ–ï¼Œæ— éœ€ä¿®æ”¹ä»£ç ï¼› åœ¨å®ç°æ·±å…‹éš†çš„æ—¶å€™å¯èƒ½éœ€è¦æ¯”è¾ƒå¤æ‚çš„ä»£ç ï¼›ç¼ºç‚¹ï¼šéœ€è¦ä¸ºæ¯ä¸€ä¸ªç±»é…å¤‡ä¸€ä¸ªå…‹éš†æ–¹æ³•ï¼Œè¿™å¯¹å…¨æ–°çš„ç±»æ¥è¯´ä¸æ˜¯å¾ˆéš¾ï¼Œä½†å¯¹å·²æœ‰çš„ç±»è¿›è¡Œæ”¹é€ æ—¶ï¼Œéœ€è¦ä¿®æ”¹å…¶æºä»£ç ï¼Œè¿èƒŒäº† ocp åŸåˆ™ã€‚ å»ºé€ è€…æ¨¡å¼ å»ºé€ è€…æ¨¡å¼ï¼ˆBuilder Patternï¼‰åˆå«ç”Ÿæˆå™¨æ¨¡å¼ï¼Œæ˜¯ä¸€ç§å¯¹è±¡æ„å»ºæ¨¡å¼ã€‚å®ƒå¯ä»¥å°†å¤æ‚å¯¹è±¡çš„å»ºé€ è¿‡ç¨‹æŠ½è±¡å‡ºæ¥ï¼ˆæŠ½è±¡ç±»åˆ«ï¼‰ï¼Œä½¿è¿™ä¸ªæŠ½è±¡è¿‡ç¨‹çš„ä¸åŒå®ç°æ–¹æ³•å¯ä»¥æ„é€ å‡ºä¸åŒè¡¨ç°ï¼ˆå±æ€§ï¼‰çš„å¯¹è±¡ã€‚ å»ºé€ è€…æ¨¡å¼æ˜¯ä¸€æ­¥ä¸€æ­¥åˆ›å»ºä¸€ä¸ªå¤æ‚çš„å¯¹è±¡ï¼Œå®ƒå…è®¸ç”¨æˆ·åªé€šè¿‡æŒ‡å®šå¤æ‚å¯¹è±¡çš„ç±»å‹å’Œå†…å®¹å°±å¯ä»¥æ„å»ºå®ƒä»¬ï¼Œç”¨æˆ·ä¸éœ€è¦çŸ¥é“å†…éƒ¨çš„å…·ä½“æ„å»ºç»†èŠ‚ã€‚ è§’è‰²ï¼šProductï¼ˆäº§å“è§’è‰²ï¼‰ï¼š ä¸€ä¸ªå…·ä½“çš„äº§å“å¯¹è±¡ï¼›Builderï¼ˆæŠ½è±¡å»ºé€ è€…ï¼‰ï¼š åˆ›å»ºä¸€ä¸ª Product å¯¹è±¡çš„å„ä¸ªéƒ¨ä»¶æŒ‡å®šçš„ æ¥å£/æŠ½è±¡ç±»ï¼›ConcreteBuilderï¼ˆå…·ä½“å»ºé€ è€…ï¼‰ï¼š å®ç°æ¥å£ï¼Œæ„å»ºå’Œè£…é…å„ä¸ªéƒ¨ä»¶ï¼›Directorï¼ˆæŒ‡æŒ¥è€…ï¼‰ï¼š æ„å»ºä¸€ä¸ªä½¿ç”¨ Builder æ¥å£çš„å¯¹è±¡ã€‚å®ƒä¸»è¦æ˜¯ç”¨äºåˆ›å»ºä¸€ä¸ªå¤æ‚çš„å¯¹è±¡ã€‚å®ƒä¸»è¦æœ‰ä¸¤ä¸ªä½œç”¨ï¼šï¼ˆ1ï¼‰éš”ç¦»äº†å®¢æˆ·ä¸å¯¹è±¡çš„ç”Ÿäº§è¿‡ç¨‹ï¼ˆ2ï¼‰è´Ÿè´£æ§åˆ¶äº§å“å¯¹è±¡çš„ç”Ÿäº§è¿‡ç¨‹ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182public class Client &#123; public static void main(String[] args) &#123; // ç›–æ™®é€šæˆ¿å­ CommonHouse commonHouse = new CommonHouse(); // å‡†å¤‡åˆ›å»ºæˆ¿å­çš„æŒ‡æŒ¥è€… HouseDirector houseDirector = new HouseDirector(commonHouse); // å®Œæˆç›–æˆ¿å­ï¼Œè¿”å›äº§å“ï¼ˆæ™®é€šæˆ¿å­ï¼‰ House house = houseDirector.constructHouse(); System.out.println(\"--------------------------\"); //ç›–é«˜æ¥¼ HighBuilding highBuilding = new HighBuilding(); //é‡ç½®å»ºé€ è€… houseDirector.setHouseBuilder(highBuilding); //å®Œæˆç›–æˆ¿å­ï¼Œè¿”å›äº§å“ï¼ˆé«˜æ¥¼ï¼‰ houseDirector.constructHouse(); &#125;&#125;public class CommonHouse extends HouseBuilder &#123; @Override public void buildBasic() &#123; System.out.println(\" æ™®é€šæˆ¿å­æ‰“åœ°åŸº 5 ç±³ \"); &#125; @Override public void buildWalls() &#123; System.out.println(\" æ™®é€šæˆ¿å­ç Œå¢™ 10cm \"); &#125; @Override public void roofed() &#123; System.out.println(\" æ™®é€šæˆ¿å­å±‹é¡¶ \"); &#125;&#125;public class HighBuilding extends HouseBuilder &#123; @Override public void buildBasic() &#123; System.out.println(\" é«˜æ¥¼çš„æ‰“åœ°åŸº 100 ç±³ \"); &#125; @Override public void buildWalls() &#123; System.out.println(\" é«˜æ¥¼çš„ç Œå¢™ 20cm \"); &#125; @Override public void roofed() &#123; System.out.println(\" é«˜æ¥¼çš„é€æ˜å±‹é¡¶ \"); &#125;&#125;public class House &#123; private String baise; private String wall; private String roofed; // Getter / Setter&#125;// æŠ½è±¡çš„å»ºé€ è€…public abstract class HouseBuilder &#123; protected House house = new House(); // å°†å»ºé€ çš„æµç¨‹å†™å¥½, æŠ½è±¡çš„æ–¹æ³• public abstract void buildBasic(); public abstract void buildWalls(); public abstract void roofed(); // å»ºé€ æˆ¿å­å¥½ï¼Œ å°†äº§å“è¿”å› public House buildHouse() &#123; return house; &#125;&#125;public class HouseDirector &#123; HouseBuilder houseBuilder = null; // æ„é€ å™¨ä¼ å…¥ houseBuilder public HouseDirector(HouseBuilder houseBuilder) &#123; this.houseBuilder = houseBuilder; &#125; // å¦‚ä½•å¤„ç†å»ºé€ æˆ¿å­çš„æµç¨‹ï¼Œäº¤ç»™æŒ‡æŒ¥è€… public House constructHouse() &#123; houseBuilder.buildBasic(); houseBuilder.buildWalls(); houseBuilder.roofed(); return houseBuilder.buildHouse(); &#125;&#125; Factory VS. BuilderæŠ½è±¡å·¥å‚æ¨¡å¼å®ç°å¯¹äº§å“å®¶æ—çš„åˆ›å»ºï¼Œä¸€ä¸ªäº§å“å®¶æ—æ˜¯è¿™æ ·çš„ä¸€ç³»åˆ—äº§å“ï¼šå…·æœ‰ä¸åŒåˆ†ç±»ç»´åº¦çš„äº§å“ç»„åˆï¼Œé‡‡ç”¨æŠ½è±¡å·¥å‚æ¨¡å¼ä¸éœ€è¦å…³å¿ƒæ„å»ºè¿‡ç¨‹ï¼Œåªå…³å¿ƒä»€ä¹ˆäº§å“ç”±ä»€ä¹ˆå·¥å‚ç”Ÿäº§å³å¯ã€‚ å»ºé€ è€…æ¨¡å¼åˆ™æ˜¯è¦æ±‚æŒ‰ç…§æŒ‡å®šçš„è“å›¾å»ºé€ äº§å“ï¼Œå¯ä»¥æ›´åŠ ç²¾ç»†åœ°æ§åˆ¶äº§å“çš„åˆ›å»ºè¿‡ç¨‹ ã€‚å°†å¤æ‚äº§å“çš„åˆ›å»ºæ­¥éª¤åˆ†è§£åœ¨ä¸åŒçš„æ–¹æ³•ä¸­ï¼Œä½¿å¾—åˆ›å»ºè¿‡ç¨‹æ›´åŠ æ¸…æ™°ï¼Œä¹Ÿæ›´æ–¹ä¾¿ä½¿ç”¨ç¨‹åºæ¥æ§åˆ¶åˆ›å»ºè¿‡ç¨‹å®ƒçš„ä¸»è¦ç›®çš„æ˜¯é€šè¿‡ç»„è£…é›¶é…ä»¶è€Œäº§ç”Ÿä¸€ä¸ªæ–°å“ï¼›å»ºé€ è€…æ¨¡å¼æ‰€åˆ›å»ºçš„äº§å“ä¸€èˆ¬å…·æœ‰è¾ƒå¤šçš„å…±åŒç‚¹ï¼Œå…¶ç»„æˆéƒ¨åˆ†ç›¸ä¼¼ï¼Œå¦‚æœäº§å“ä¹‹é—´çš„å·®å¼‚æ€§å¾ˆå¤§ï¼Œåˆ™ä¸é€‚åˆä½¿ç”¨å»ºé€ è€…æ¨¡å¼ï¼Œå› æ­¤å…¶ä½¿ç”¨èŒƒå›´å—åˆ°ä¸€å®šçš„é™åˆ¶ã€‚","categories":[{"name":"Java","slug":"Java","permalink":"http://yoursite.com/categories/Java/"}],"tags":[{"name":"Design Patterns","slug":"Design-Patterns","permalink":"http://yoursite.com/tags/Design-Patterns/"}]},{"title":"è®¾è®¡æ¨¡å¼","slug":"Java/DesignPatterns/è®¾è®¡æ¨¡å¼","date":"2020-03-20T02:21:09.000Z","updated":"2020-03-21T07:58:21.606Z","comments":true,"path":"2020/03/20/Java/DesignPatterns/è®¾è®¡æ¨¡å¼/","link":"","permalink":"http://yoursite.com/2020/03/20/Java/DesignPatterns/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/","excerpt":"Java è®¾è®¡æ¨¡å¼ã€‚","text":"Java è®¾è®¡æ¨¡å¼ã€‚ ä¸ƒå¤§åŸåˆ™ æ ¸å¿ƒæ€æƒ³ï¼š æ‰¾å‡ºåº”ç”¨ä¸­å¯èƒ½éœ€è¦å˜åŒ–ä¹‹å¤„ï¼ŒæŠŠå®ƒä»¬ç‹¬ç«‹å‡ºæ¥ï¼Œä¸è¦å’Œé‚£äº›ä¸éœ€è¦å˜åŒ–çš„ä»£ç æ··åœ¨ä¸€èµ·ï¼›é’ˆå¯¹æ¥å£ç¼–ç¨‹ï¼Œè€Œä¸æ˜¯é’ˆå¯¹å®ç°ç¼–ç¨‹ï¼›ä¸ºäº†äº¤äº’å¯¹è±¡ä¹‹é—´çš„æ¾è€¦åˆè®¾è®¡è€ŒåŠªåŠ›ã€‚ å•ä¸€èŒè´£åŸåˆ™æ¥å£éš”ç¦»åŸåˆ™ä¾èµ–å€’è½¬ï¼ˆå€’ç½®ï¼‰åŸåˆ™é‡Œæ°æ›¿æ¢åŸåˆ™å¼€é—­åŸåˆ™è¿ªç±³ç‰¹æ³•åˆ™åˆæˆå¤ç”¨åŸåˆ™ å•ä¸€èŒè´£ æ­¤åŸåˆ™æ˜¯å¯¹äºç±»æ¥è¯´çš„ï¼Œå³ä¸€ä¸ªç±»åº”è¯¥åªè´Ÿè´£ä¸€é¡¹èŒè´£ã€‚ 123456789101112131415class RoadVehicle &#123; public void run(String vehicle) &#123; System.out.println(vehicle + \"å…¬è·¯è¿è¡Œ\"); &#125;&#125;class AirVehicle &#123; public void run(String vehicle) &#123; System.out.println(vehicle + \"å¤©ç©ºè¿è¡Œ\"); &#125;&#125;class WaterVehicle &#123; public void run(String vehicle) &#123; System.out.println(vehicle + \"æ°´ä¸­è¿è¡Œ\"); &#125;&#125; åœ¨æ–¹æ³•çº§åˆ«ä¸Šéµå®ˆå•ä¸€èŒè´£ 12345678910class Vehicle &#123; public void runRoad(String vehicle) &#123; System.out.println(vehicle + \" åœ¨å…¬è·¯ä¸Šè¿è¡Œ...\"); &#125; public void runAir(String vehicle) &#123; System.out.println(vehicle + \" åœ¨å¤©ç©ºä¸Šè¿è¡Œ...\"); &#125; public void runWater(String vehicle) &#123; System.out.println(vehicle + \" åœ¨æ°´ä¸­è¡Œ...\"); &#125; é™ä½ç±»çš„å¤æ‚åº¦ï¼Œä¸€ä¸ªç±»åªè´Ÿè´£ä¸€é¡¹èŒè´£ï¼›æé«˜ç±»çš„å¯è¯»æ€§ï¼Œå¯ç»´æŠ¤æ€§ï¼›é™ä½å˜æ›´å¼•èµ·çš„é£é™©ï¼›é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åº”å½“éµå®ˆå•ä¸€èŒè´£åŸåˆ™ï¼Œåªæœ‰é€»è¾‘è¶³å¤Ÿç®€å•ï¼Œæ‰å¯ä»¥åœ¨ä»£ç çº§è¿åå•ä¸€èŒè´£åŸåˆ™ï¼›åªæœ‰ç±»ä¸­æ–¹æ³•æ•°é‡è¶³å¤Ÿå°‘ï¼Œå¯ä»¥åœ¨æ–¹æ³•çº§åˆ«ä¿æŒå•ä¸€èŒè´£åŸåˆ™ã€‚ æ¥å£éš”ç¦» å³ä¸€ä¸ªç±»å¯¹å¦ä¸€ä¸ªç±»çš„ä¾èµ–åº”è¯¥å»ºç«‹åœ¨æœ€å°çš„æ¥å£ä¸Šã€‚ ä¸ç¬¦åˆæ¥å£éš”ç¦»åŸåˆ™çš„è®¾è®¡ï¼š 123456789101112131415161718192021222324252627282930313233// æ¥å£æœ‰ 5 ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œåˆ™æ¯ä¸ªå®ç°äº†æ­¤æ¥å£çš„ç±»éƒ½éœ€è¦å®ç°è¿™ 5 ä¸ªæŠ½è±¡æ–¹æ³•interface Interface1 &#123; void operation1(); void operation2(); void operation3(); void operation4(); void operation5();&#125;// Class Bã€D çœç•¥class A &#123; //A ç±»é€šè¿‡æ¥å£ Interface1 ä¾èµ–(ä½¿ç”¨) B ç±»ï¼Œä½†æ˜¯åªä¼šç”¨åˆ° 1,2,3 æ–¹æ³• public void depend1(Interface1 i) &#123; i.operation1(); &#125; public void depend2(Interface1 i) &#123; i.operation2(); &#125; public void depend3(Interface1 i) &#123; i.operation3(); &#125;&#125;class C &#123; //C ç±»é€šè¿‡æ¥å£ Interface1 ä¾èµ–(ä½¿ç”¨) D ç±»ï¼Œä½†æ˜¯åªä¼šç”¨åˆ° 1,4,5 æ–¹æ³• public void depend1(Interface1 i) &#123; i.operation1(); &#125; public void depend4(Interface1 i) &#123; i.operation4(); &#125; public void depend5(Interface1 i) &#123; i.operation5(); &#125;&#125; ç±» A é€šè¿‡æ¥å£ Interface1 ä¾èµ–ç±» Bï¼Œç±» C é€šè¿‡æ¥å£ Interface1 ä¾èµ–ç±» Dï¼Œå¦‚æœæ¥å£ Interface1 å¯¹äºç±» A å’Œç±» Cæ¥è¯´ä¸æ˜¯æœ€å°æ¥å£ï¼Œé‚£ä¹ˆç±» B å’Œç±» D å¿…é¡»å»å®ç°ä»–ä»¬ä¸éœ€è¦çš„æ–¹æ³•ï¼› å°†æ¥å£ Interface1 æ‹†åˆ†ä¸ºç‹¬ç«‹çš„å‡ ä¸ªæ¥å£ï¼Œç±» A å’Œç±» C åˆ†åˆ«ä¸ä»–ä»¬éœ€è¦çš„æ¥å£å»ºç«‹ä¾èµ–å…³ç³»ã€‚ä¹Ÿå°±æ˜¯é‡‡ç”¨æ¥å£éš”ç¦»åŸåˆ™ æ¥å£ Interface1 ä¸­å‡ºç°çš„æ–¹æ³•ï¼Œæ ¹æ®å®é™…æƒ…å†µæ‹†åˆ†ä¸ºä¸‰ä¸ªã€‚ ç¬¦åˆæ¥å£éš”ç¦»åŸåˆ™çš„è®¾è®¡ï¼š 1234567891011121314151617181920212223interface Interface1 &#123; void operation1();&#125;interface Interface2 &#123; void operation2(); void operation3();&#125;interface Interface3 &#123; void operation4(); void operation5();&#125;// æµ‹è¯•public static void main(String[] args) &#123; A a = new A(); a.depend1(new B()); // A ç±»é€šè¿‡æ¥å£å»ä¾èµ– B ç±» a.depend2(new B()); a.depend3(new B()); C c = new C(); c.depend1(new D()); // C ç±»é€šè¿‡æ¥å£å»ä¾èµ–(ä½¿ç”¨) D ç±» c.depend4(new D()); c.depend5(new D());&#125; ä¾èµ–å€’è½¬ ä¾èµ–å€’è½¬åŸåˆ™æ˜¯åŸºäºè¿™æ ·çš„è®¾è®¡ç†å¿µï¼šç›¸å¯¹äºç»†èŠ‚çš„å¤šå˜æ€§ï¼ŒæŠ½è±¡çš„ä¸œè¥¿è¦ç¨³å®šçš„å¤šã€‚ä»¥æŠ½è±¡ä¸ºåŸºç¡€æ­å»ºçš„æ¶æ„æ¯”ä»¥ç»†èŠ‚ä¸ºåŸºç¡€çš„æ¶æ„è¦ç¨³å®šçš„å¤šã€‚åœ¨ java ä¸­ï¼ŒæŠ½è±¡æŒ‡çš„æ˜¯æ¥å£æˆ–æŠ½è±¡ç±»ï¼Œç»†èŠ‚å°±æ˜¯å…·ä½“çš„å®ç°ç±»ï¼Œä½¿ç”¨æ¥å£æˆ–æŠ½è±¡ç±»çš„ç›®çš„æ˜¯åˆ¶å®šå¥½è§„èŒƒï¼Œè€Œä¸æ¶‰åŠä»»ä½•å…·ä½“çš„æ“ä½œï¼ŒæŠŠå±•ç°ç»†èŠ‚çš„ä»»åŠ¡äº¤ç»™ä»–ä»¬çš„å®ç°ç±»å»å®Œæˆï¼š é«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–ä½å±‚æ¨¡å—ï¼ŒäºŒè€…éƒ½åº”è¯¥ä¾èµ–å…¶æŠ½è±¡ï¼›æŠ½è±¡ä¸åº”è¯¥ä¾èµ–ç»†èŠ‚ï¼Œç»†èŠ‚åº”è¯¥ä¾èµ–æŠ½è±¡ï¼›ä¾èµ–å€’è½¬ï¼ˆå€’ç½®ï¼‰çš„ä¸­å¿ƒæ€æƒ³æ˜¯é¢å‘æ¥å£ç¼–ç¨‹ï¼› 123456789101112131415161718192021222324252627282930public class DependecyInversion &#123; public static void main(String[] args) &#123; // å®¢æˆ·ç«¯æ— éœ€æ”¹å˜ Person person = new Person(); person.receive(new Email()); person.receive(new WeiXin()); &#125;&#125;class Person &#123; // è¿™é‡Œæˆ‘ä»¬æ˜¯å¯¹æ¥å£çš„ä¾èµ–ï¼Œä¸éœ€è¦è€ƒè™‘æ¥å£çš„å…·ä½“å®ç° public void receive(IReceiver receiver) &#123; System.out.println(receiver.getInfo()); &#125;&#125;// å®šä¹‰æ¥å£interface IReceiver &#123; public String getInfo();&#125;// å®ç°ç±»è¿›è¡Œæ˜¯å®ç°class Email implements IReceiver &#123; public String getInfo() &#123; return \"ç”µå­é‚®ä»¶ä¿¡æ¯: hello,world\"; &#125;&#125;// å®ç°ç±»è¿›è¡Œå®ç°class WeiXin implements IReceiver &#123; public String getInfo() &#123; return \"å¾®ä¿¡ä¿¡æ¯: hello,ok\"; &#125;&#125; ä¾èµ–ä¼ é€’ æ¥å£ä¼ é€’ï¼›æ„é€ æ–¹æ³•ä¼ é€’ï¼›Setter æ–¹æ³•ä¼ é€’ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556// æ–¹å¼ä¸€ï¼šé€šè¿‡æ¥å£ä¼ é€’å®ç°ä¾èµ–interface IOpenAndClose &#123; public void open(ITV tv); // æŠ½è±¡æ–¹æ³•ï¼Œæ¥æ”¶æ¥å£å®ç°ä»¥æ¥ä¼ é€’&#125;interface ITV &#123; public void play();&#125;class OpenAndClose implements IOpenAndClose&#123; public void open(ITV tv)&#123; tv.play(); &#125;&#125;class ChangHong implements ITV &#123; @Override public void play() &#123; System.out.println(\"é•¿è™¹ç”µè§†æœºï¼Œæ‰“å¼€\"); &#125;&#125;// æ–¹å¼äºŒï¼šé€šè¿‡æ„é€ æ–¹æ³•ä¾èµ–interface IOpenAndClose &#123; public void open();&#125;interface ITV &#123; public void play();&#125;class OpenAndClose implements IOpenAndClose&#123; private ITV tv; // æˆå‘˜ public OpenAndClose(ITV tv)&#123; // æ„é€ å™¨ this.tv = tv; &#125; public void open()&#123; this.tv.play(); &#125;&#125;// æ–¹å¼ä¸‰ï¼šé€šè¿‡ Setter æ–¹æ³•ä¼ é€’interface IOpenAndClose &#123; public void open(); public void setTv(ITV tv); // Setter æ–¹æ³•&#125;interface ITV &#123; public void play();&#125;class OpenAndClose implements IOpenAndClose &#123; private ITV tv; public void setTv(ITV tv) &#123; this.tv = tv; &#125; public void open() &#123; this.tv.play(); &#125;&#125; é‡Œæ°æ›¿æ¢ ç»§æ‰¿åœ¨ç»™ç¨‹åºè®¾è®¡å¸¦æ¥ä¾¿åˆ©çš„åŒæ—¶ï¼Œä¹Ÿå¸¦æ¥äº†å¼Šç«¯ã€‚æ¯”å¦‚ä½¿ç”¨ç»§æ‰¿ä¼šç»™ç¨‹åºå¸¦æ¥ä¾µå…¥æ€§ï¼Œç¨‹åºçš„å¯ç§»æ¤æ€§é™ä½ï¼Œå¢åŠ å¯¹è±¡é—´çš„è€¦åˆæ€§ï¼Œå¦‚æœä¸€ä¸ªç±»è¢«å…¶ä»–çš„ç±»æ‰€ç»§æ‰¿ï¼Œåˆ™å½“è¿™ä¸ªç±»éœ€è¦ä¿®æ”¹æ—¶ï¼Œå¿…é¡»è€ƒè™‘åˆ°æ‰€æœ‰çš„å­ç±»ï¼Œå¹¶ä¸”çˆ¶ç±»ä¿®æ”¹åï¼Œæ‰€æœ‰æ¶‰åŠåˆ°å­ç±»çš„åŠŸèƒ½éƒ½æœ‰å¯èƒ½äº§ç”Ÿæ•…éšœã€‚ ç”¨äºè§£å†³å¦‚ä½•æ­£ç¡®ä½¿ç”¨ç»§æ‰¿ï¼Ÿ ğŸ‘‰ é‡Œæ°æ›¿æ¢åŸåˆ™ æ‰€æœ‰å¼•ç”¨åŸºç±»çš„åœ°æ–¹å¿…é¡»èƒ½é€æ˜åœ°ä½¿ç”¨å…¶å­ç±»çš„å¯¹è±¡ï¼›åœ¨å­ç±»ä¸­å°½é‡ä¸è¦é‡å†™çˆ¶ç±»çš„æ–¹æ³•ï¼›ç»§æ‰¿å®é™…ä¸Šè®©ä¸¤ä¸ªç±»è€¦åˆæ€§å¢å¼ºäº†ï¼Œåœ¨é€‚å½“çš„æƒ…å†µä¸‹å¯ä»¥é€šè¿‡èšåˆã€ç»„åˆã€ä¾èµ–æ¥è§£å†³é—®é¢˜ã€‚ 1234567891011121314151617181920212223242526272829public class Liskov &#123; public static void main(String[] args) &#123; A a = new A(); System.out.println(\"11-3=\" + a.func1(11, 3)); System.out.println(\"1-8=\" + a.func1(1, 8)); System.out.println(\"-----------------------\"); B b = new B(); System.out.println(\"11-3=\" + b.func1(11, 3)); // è¿™é‡Œæœ¬æ„æ˜¯æ±‚å‡º 11-3 System.out.println(\"1-8=\" + b.func1(1, 8)); // 1-8 System.out.println(\"11+3+9=\" + b.func2(11, 3)); &#125;&#125;class A &#123; // è¿”å›ä¸¤ä¸ªæ•°çš„å·® public int func1(int num1, int num2) &#123; return num1 - num2; &#125;&#125;// B ç±»ç»§æ‰¿äº† A å¹¶ä¸”å¢åŠ äº†ä¸€ä¸ªæ–°åŠŸèƒ½ï¼šå®Œæˆä¸¤ä¸ªæ•°ç›¸åŠ ï¼Œç„¶åå’Œ 9 æ±‚å’Œclass B extends A &#123; // è¿™é‡Œé‡å†™äº† A ç±»çš„æ–¹æ³•, é€ æˆåŸæœ‰æ–¹æ³•é”™è¯¯ public int func1(int a, int b) &#123; return a + b; &#125; public int func2(int a, int b) &#123; return func1(a, b) + 9; &#125;&#125; æ”¹è¿›æ–¹æ¡ˆï¼šåŸæ¥çš„çˆ¶ç±»å’Œå­ç±»éƒ½ç»§æ‰¿ä¸€ä¸ªæ›´é€šä¿—çš„åŸºç±»ï¼ŒåŸæœ‰çš„ç»§æ‰¿å…³ç³»å»æ‰ï¼Œé‡‡ç”¨ä¾èµ–ã€èšåˆã€ç»„åˆç­‰å…³ç³»ä»£æ›¿ã€‚ 123456789101112131415class B extends Base &#123; // å¦‚æœ B éœ€è¦ä½¿ç”¨ A ç±»çš„æ–¹æ³•ï¼Œä½¿ç”¨ç»„åˆå…³ç³» private A a = new A(); // æ­¤æ–¹æ³•ä¸å†æ˜¯é‡å†™æ–¹æ³• public int func1(int a, int b) &#123; return a + b; &#125; public int func2(int a, int b) &#123; return func1(a, b) + 9; &#125; // ä½¿ç”¨ A ç±»çš„æ–¹æ³• public int func3(int a, int b) &#123; return this.a.func1(a, b); &#125;&#125; å¼€é—­åŸåˆ™ ç±»ï¼Œæ¨¡å—å’Œå‡½æ•°åº”è¯¥å¯¹æ‰©å±•å¼€æ”¾ï¼ˆå¯¹æä¾›æ–¹ï¼‰ï¼Œå¯¹ä¿®æ”¹å…³é—­ï¼ˆå¯¹ä½¿ç”¨æ–¹ï¼‰ã€‚ç”¨æŠ½è±¡æ„å»ºæ¡†æ¶ï¼Œç”¨å®ç°æ‰©å±•ç»†èŠ‚ï¼›å½“è½¯ä»¶éœ€è¦å˜åŒ–æ—¶ï¼Œå°½é‡é€šè¿‡æ‰©å±•è½¯ä»¶å®ä½“çš„è¡Œä¸ºæ¥å®ç°å˜åŒ–ï¼Œè€Œä¸æ˜¯é€šè¿‡ä¿®æ”¹å·²æœ‰çš„ä»£ç æ¥å®ç°å˜åŒ–ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546public class Ocp &#123; public static void main(String[] args) &#123; GraphicEditor graphicEditor = new GraphicEditor(); graphicEditor.drawShape(new Rectangle()); graphicEditor.drawShape(new Circle()); &#125;&#125;// æ­¤å†™æ³•å½“å‘ç”Ÿæ‰©å±•æ—¶ï¼Œæ¯”å¦‚æ·»åŠ å¯ä»¥ç»˜åˆ¶çš„å›¾å½¢ç±»å‹ï¼Œéœ€è¦ä¿®æ”¹ä½¿ç”¨æ–¹// è¿™æ˜¯ä¸€ä¸ªç”¨äºç»˜å›¾çš„ç±»ï¼Œæ­¤ç±»ä¸ºä½¿ç”¨æ–¹class GraphicEditor &#123; // æ¥æ”¶ Shape å¯¹è±¡ï¼Œç„¶åæ ¹æ® typeï¼Œæ¥ç»˜åˆ¶ä¸åŒçš„å›¾å½¢ public void drawShape(Shape s) &#123; if (s.m_type == 1) drawRectangle(s); else if (s.m_type == 2) drawCircle(s); else if (s.m_type == 3) drawTriangle(s); &#125; // ç»˜åˆ¶çŸ©å½¢ public void drawRectangle(Shape r) &#123; System.out.println(\" ç»˜åˆ¶çŸ©å½¢ \"); &#125; // ç»˜åˆ¶åœ†å½¢ public void drawCircle(Shape r) &#123; System.out.println(\" ç»˜åˆ¶åœ†å½¢ \"); &#125; // ç»˜åˆ¶ä¸‰è§’å½¢ public void drawTriangle(Shape r) &#123; System.out.println(\" ç»˜åˆ¶ä¸‰è§’å½¢ \"); &#125;&#125;// Shape ç±»ï¼ŒåŸºç±»class Shape &#123; int m_type;&#125;class Rectangle extends Shape &#123; Rectangle() &#123; super.m_type = 1; &#125;&#125;class Circle extends Shape &#123; Circle() &#123; super.m_type = 2; &#125;&#125; è¿åäº†è®¾è®¡æ¨¡å¼çš„ OCP åŸåˆ™ï¼Œå³å¯¹æ‰©å±•å¼€æ”¾(æä¾›æ–¹)ï¼Œå¯¹ä¿®æ”¹å…³é—­(ä½¿ç”¨æ–¹)ã€‚å³å½“æˆ‘ä»¬ç»™ç±»å¢åŠ æ–°åŠŸèƒ½çš„æ—¶å€™ï¼Œå°½é‡ä¸ä¿®æ”¹ä»£ç ï¼Œæˆ–è€…å°½å¯èƒ½å°‘ä¿®æ”¹ä»£ç ã€‚ å°±å•ä¸€èŒè´£è€Œè¨€ï¼Œä½¿ç”¨æ–¹ç±»çš„èŒè´£å°±åªæœ‰ä½¿ç”¨è€Œå·²ï¼Œè‡³äºå¦‚ä½•å»è¿›è¡Œå®ç°è¿™äº›ç»†èŠ‚ä¸åº”è¯¥åœ¨æ­¤ç±»ä¸­å‡ºç°ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960public class Ocp &#123; public static void main(String[] args) &#123; GraphicEditor graphicEditor = new GraphicEditor(); graphicEditor.drawShape(new Rectangle()); graphicEditor.drawShape(new Circle()); graphicEditor.drawShape(new Triangle()); graphicEditor.drawShape(new OtherGraphic()); &#125;&#125;class GraphicEditor &#123; // ä»…ä»…æ˜¯ä½¿ç”¨ draw() æ–¹æ³• public void drawShape(Shape s) &#123; s.draw(); &#125;&#125;abstract class Shape &#123; int m_type; public abstract void draw(); //æŠ½è±¡æ–¹æ³•&#125;class Rectangle extends Shape &#123; Rectangle() &#123; super.m_type = 1; &#125; @Override public void draw() &#123; System.out.println(\" ç»˜åˆ¶çŸ©å½¢ \"); &#125;&#125;class Circle extends Shape &#123; Circle() &#123; super.m_type = 2; &#125; @Override public void draw() &#123; System.out.println(\" ç»˜åˆ¶åœ†å½¢ \"); &#125;&#125;//æ–°å¢ç”»ä¸‰è§’å½¢class Triangle extends Shape &#123; Triangle() &#123; super.m_type = 3; &#125; @Override public void draw() &#123; System.out.println(\" ç»˜åˆ¶ä¸‰è§’å½¢ \"); &#125;&#125;//æ–°å¢ä¸€ä¸ªå›¾å½¢class OtherGraphic extends Shape &#123; OtherGraphic() &#123; super.m_type = 4; &#125; @Override public void draw() &#123; System.out.println(\" ç»˜åˆ¶å…¶å®ƒå›¾å½¢ \"); &#125;&#125; è¿ªç±³ç‰¹æ³•åˆ™ ä¸€ä¸ªå¯¹è±¡åº”è¯¥å¯¹å…¶ä»–å¯¹è±¡ä¿æŒæœ€å°‘çš„äº†è§£ï¼›ç±»ä¸ç±»å…³ç³»è¶Šå¯†åˆ‡ï¼Œè€¦åˆåº¦è¶Šå¤§ã€‚ è¿ªç±³ç‰¹æ³•åˆ™(Demeter Principle)åˆå«æœ€å°‘çŸ¥é“åŸåˆ™ï¼Œå³ä¸€ä¸ªç±»å¯¹è‡ªå·±ä¾èµ–çš„ç±»çŸ¥é“çš„è¶Šå°‘è¶Šå¥½ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºè¢«ä¾èµ–çš„ç±»ä¸ç®¡å¤šä¹ˆå¤æ‚ï¼Œéƒ½å°½é‡å°†é€»è¾‘å°è£…åœ¨ç±»çš„å†…éƒ¨ã€‚å¯¹å¤–é™¤äº†æä¾›çš„ public æ–¹æ³•ï¼Œä¸å¯¹å¤–æ³„éœ²ä»»ä½•ä¿¡æ¯ã€‚ è¿ªç±³ç‰¹æ³•åˆ™è¿˜æœ‰ä¸ªæ›´ç®€å•çš„å®šä¹‰ï¼šåªä¸ç›´æ¥çš„æœ‹å‹é€šä¿¡ã€‚ç›´æ¥çš„æœ‹å‹ï¼šæ¯ä¸ªå¯¹è±¡éƒ½ä¼šä¸å…¶ä»–å¯¹è±¡æœ‰è€¦åˆå…³ç³»ï¼Œåªè¦ä¸¤ä¸ªå¯¹è±¡ä¹‹é—´æœ‰è€¦åˆå…³ç³»ï¼Œæˆ‘ä»¬å°±è¯´è¿™ä¸¤ä¸ªå¯¹è±¡ä¹‹é—´æ˜¯æœ‹å‹å…³ç³»ã€‚è€¦åˆçš„æ–¹å¼å¾ˆå¤šï¼Œä¾èµ–ï¼Œå…³è”ï¼Œç»„åˆï¼Œèšåˆç­‰ã€‚å…¶ä¸­ï¼Œæˆ‘ä»¬ç§°å‡ºç°æˆå‘˜å˜é‡ï¼Œæ–¹æ³•å‚æ•°ï¼Œæ–¹æ³•è¿”å›å€¼ä¸­çš„ç±»ä¸ºç›´æ¥çš„æœ‹å‹ï¼Œè€Œå‡ºç°åœ¨å±€éƒ¨å˜é‡ä¸­çš„ç±»ä¸æ˜¯ç›´æ¥çš„æœ‹å‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé™Œç”Ÿçš„ç±»æœ€å¥½ä¸è¦ä»¥å±€éƒ¨å˜é‡çš„å½¢å¼å‡ºç°åœ¨ç±»çš„å†…éƒ¨ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970public class Demeter &#123; public static void main(String[] args) &#123; // åˆ›å»ºäº†ä¸€ä¸ª SchoolManager å¯¹è±¡ SchoolManager schoolManager = new SchoolManager(); // è¾“å‡ºå­¦é™¢çš„å‘˜å·¥ id å’Œå­¦æ ¡æ€»éƒ¨çš„å‘˜å·¥ä¿¡æ¯ schoolManager.printAllEmployee(new CollegeManager()); &#125;&#125;// å­¦æ ¡æ€»éƒ¨å‘˜å·¥ç±»class Employee &#123; private String id; public void setId(String id) &#123; this.id = id; &#125; public String getId() &#123; return id; &#125;&#125;// å­¦é™¢çš„å‘˜å·¥ç±»class CollegeEmployee &#123; private String id; public void setId(String id) &#123; this.id = id; &#125; public String getId() &#123; return id; &#125;&#125;// ç®¡ç†å­¦é™¢å‘˜å·¥çš„ç®¡ç†ç±»class CollegeManager &#123; // è¿”å›å­¦é™¢çš„æ‰€æœ‰å‘˜å·¥ public List&lt;CollegeEmployee&gt; getAllEmployee() &#123; List&lt;CollegeEmployee&gt; list = new ArrayList&lt;CollegeEmployee&gt;(); for (int i = 0; i &lt; 10; i++) &#123; //è¿™é‡Œæˆ‘ä»¬å¢åŠ äº† 10 ä¸ªå‘˜å·¥åˆ° list CollegeEmployee emp = new CollegeEmployee(); emp.setId(\"å­¦é™¢å‘˜å·¥ id= \" + i); list.add(emp); &#125; return list; &#125;&#125;// å­¦æ ¡ç®¡ç†ç±»// åˆ†æ SchoolManager ç±»çš„ç›´æ¥æœ‹å‹ç±»æœ‰å“ªäº› Employeeã€CollegeManagerclass SchoolManager &#123; // è¿”å›å­¦æ ¡æ€»éƒ¨çš„å‘˜å·¥ public List&lt;Employee&gt; getAllEmployee() &#123; List&lt;Employee&gt; list = new ArrayList&lt;Employee&gt;(); for (int i = 0; i &lt; 5; i++) &#123; // è¿™é‡Œæˆ‘ä»¬å¢åŠ äº† 5 ä¸ªå‘˜å·¥åˆ° list Employee emp = new Employee(); emp.setId(\"å­¦æ ¡æ€»éƒ¨å‘˜å·¥ id= \" + i); list.add(emp); &#125; return list; &#125; // è¯¥æ–¹æ³•å®Œæˆè¾“å‡ºå­¦æ ¡æ€»éƒ¨å’Œå­¦é™¢å‘˜å·¥ä¿¡æ¯(id) void printAllEmployee(CollegeManager sub) &#123; // è·å–åˆ°å­¦é™¢å‘˜å·¥ CollegeEmployee ä¸æ˜¯ç›´æ¥æœ‹å‹è€Œæ˜¯ä¸€ä¸ªé™Œç”Ÿç±»ï¼Œè¿™æ ·è¿èƒŒäº†è¿ªç±³ç‰¹æ³•åˆ™ List&lt;CollegeEmployee&gt; list1 = sub.getAllEmployee(); System.out.println(\"------------å­¦é™¢å‘˜å·¥------------\"); for (CollegeEmployee e : list1) &#123; System.out.println(e.getId()); &#125; // è·å–åˆ°å­¦æ ¡æ€»éƒ¨å‘˜å·¥ List&lt;Employee&gt; list2 = this.getAllEmployee(); System.out.println(\"------------å­¦æ ¡æ€»éƒ¨å‘˜å·¥------------\"); for (Employee e : list2) &#123; System.out.println(e.getId()); &#125; &#125;&#125; ç®€å•æ¥è®²ï¼ŒSchoolManager åªå…³å¿ƒè‡ªå·±çš„é›‡å‘˜ Employï¼Œå¯¹äº CollegeManager çš„é›‡å‘˜ CollegeEmployeeï¼Œä¸å®ƒæ²¡æœ‰ä»€ä¹ˆç›´æ¥çš„å…³ç³»ï¼ˆé™Œç”Ÿç±»ï¼‰ã€‚è‹¥éœ€è¦ CollegeEmployee çš„ç›¸å…³ä¿¡æ¯ï¼ŒCollegeManager åªéœ€é€šè¿‡å®ƒçš„ä¸‹çº§éƒ¨é—¨ CollegeManager è·å–ã€‚ 12345678910111213141516171819class CollegeManager &#123; public List&lt;CollegeEmployee&gt; getAllEmployee() &#123; List&lt;CollegeEmployee&gt; list = new ArrayList&lt;CollegeEmployee&gt;(); for (int i = 0; i &lt; 10; i++) &#123; CollegeEmployee emp = new CollegeEmployee(); emp.setId(\"å­¦é™¢å‘˜å·¥ id= \" + i); list.add(emp); &#125; return list; &#125; // å­¦é™¢çš„é›‡å‘˜ç”±å­¦é™¢è´Ÿè´£ public void printEmployee() &#123; List&lt;CollegeEmployee&gt; list1 = getAllEmployee(); System.out.println(\"------------å­¦é™¢å‘˜å·¥------------\"); for (CollegeEmployee e : list1) &#123; System.out.println(e.getId()); &#125; &#125;&#125; åˆæˆå¤ç”¨ åŸåˆ™æ˜¯å°½é‡ä½¿ç”¨åˆæˆ/èšåˆçš„æ–¹å¼ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç»§æ‰¿ã€‚ UML ç±»å›¾ ä¾èµ–ï¼ˆDependencyï¼‰ï¼šå…ƒç´  A çš„å˜åŒ–ä¼šå½±å“å…ƒç´  Bï¼Œä½†åä¹‹ä¸æˆç«‹ï¼Œé‚£ä¹ˆ B å’Œ A çš„å…³ç³»æ˜¯ä¾èµ–å…³ç³»ï¼ŒB ä¾èµ– Aï¼›ç±»å±å…³ç³»å’Œå®ç°å…³ç³»åœ¨è¯­ä¹‰ä¸Šè®²ä¹Ÿæ˜¯ä¾èµ–å…³ç³»ï¼Œä½†ç”±äºå…¶æœ‰æ›´ç‰¹æ®Šçš„ç”¨é€”ï¼Œæ‰€ä»¥è¢«å•ç‹¬æè¿°ã€‚UML ä¸­ç”¨å¸¦ç®­å¤´çš„è™šçº¿è¡¨ç¤º Dependency å…³ç³»ï¼Œç®­å¤´æŒ‡å‘è¢«ä¾èµ–å…ƒç´ ã€‚ æ³›åŒ–ï¼ˆGeneralizationï¼‰ï¼šé€šå¸¸æ‰€è¯´çš„ç»§æ‰¿ï¼ˆB is kind of Aï¼‰å…³ç³»ï¼ŒUML ä¸­ç”¨å¸¦ç©ºå¿ƒç®­å¤´çš„å®çº¿çº¿è¡¨ç¤º Generalization å…³ç³»ï¼Œç®­å¤´æŒ‡å‘ Aã€‚ å®ç°ï¼ˆRealizeï¼‰ï¼šå…ƒç´  A å®šä¹‰ä¸€ä¸ªçº¦å®šï¼Œå…ƒç´  B å®ç°è¿™ä¸ªçº¦å®šï¼Œåˆ™ B å’Œ A çš„å…³ç³»æ˜¯ Realizeï¼ŒB realize Aã€‚è¿™ä¸ªå…³ç³»æœ€å¸¸ç”¨äºæ¥å£ã€‚UML ä¸­ç”¨ç©ºå¿ƒç®­å¤´å’Œè™šçº¿è¡¨ç¤º Realize å…³ç³»ï¼Œç®­å¤´æŒ‡å‘å®šä¹‰çº¦å®šçš„å…ƒç´ ã€‚ å…³è”ï¼ˆAssociationï¼‰ï¼šå…ƒç´ é—´çš„ç»“æ„åŒ–å…³ç³»ï¼Œæ˜¯ä¸€ç§å¼±å…³ç³»ï¼Œè¢«å…³è”çš„å…ƒç´ é—´é€šå¸¸å¯ä»¥è¢«ç‹¬ç«‹çš„è€ƒè™‘ã€‚UML ä¸­ç”¨å¸¦ç®­å¤´å®çº¿è¡¨ç¤º Association å…³ç³»ï¼Œç®­å¤´æŒ‡å‘è¢«ä¾èµ–å…ƒç´ ã€‚ èšåˆï¼ˆAggregationï¼‰ï¼šå…³è”å…³ç³»çš„ä¸€ç§ç‰¹ä¾‹ï¼Œè¡¨ç¤ºéƒ¨åˆ†å’Œæ•´ä½“ï¼ˆAll has a Partï¼‰çš„å…³ç³»ã€‚UML ä¸­ç”¨å¸¦ç©ºå¿ƒè±å½¢å¤´çš„å®çº¿è¡¨ç¤º Aggregation å…³ç³»ï¼Œè±å½¢å¤´æŒ‡å‘æ•´ä½“ã€‚ ç»„åˆï¼ˆCompositionï¼‰ï¼šç»„åˆæ˜¯èšåˆå…³ç³»çš„å˜ç§ï¼Œè¡¨ç¤ºå…ƒç´ é—´æ›´å¼ºçš„ç»„åˆå…³ç³»ã€‚å¦‚æœæ˜¯ç»„åˆå…³ç³»ï¼Œå¦‚æœæ•´ä½“è¢«ç ´ååˆ™ä¸ªä½“ä¸€å®šä¼šè¢«ç ´åï¼Œè€Œèšåˆçš„ä¸ªä½“åˆ™å¯èƒ½æ˜¯è¢«å¤šä¸ªæ•´ä½“æ‰€å…±äº«çš„ï¼Œä¸ä¸€å®šä¼šéšç€æŸä¸ªæ•´ä½“çš„ç ´åè€Œè¢«ç ´åã€‚UML ä¸­ç”¨å¸¦å®å¿ƒè±å½¢å¤´çš„å®çº¿è¡¨ç¤º Composition å…³ç³»ï¼Œè±å½¢å¤´æŒ‡å‘æ•´ä½“ã€‚","categories":[{"name":"Java","slug":"Java","permalink":"http://yoursite.com/categories/Java/"}],"tags":[{"name":"Design Patterns","slug":"Design-Patterns","permalink":"http://yoursite.com/tags/Design-Patterns/"}]},{"title":"Python çˆ¬è™«","slug":"Python/Python çˆ¬è™«","date":"2020-03-16T07:09:15.000Z","updated":"2020-04-08T06:21:07.891Z","comments":true,"path":"2020/03/16/Python/Python çˆ¬è™«/","link":"","permalink":"http://yoursite.com/2020/03/16/Python/Python%20%E7%88%AC%E8%99%AB/","excerpt":"Python çˆ¬è™«ç›¸å…³çš„çŸ¥è¯†ã€‚","text":"Python çˆ¬è™«ç›¸å…³çš„çŸ¥è¯†ã€‚ Urllib åº“12345import urllib2 request = urllib2.Request(\"http://www.baidu.com\")response = urllib2.urlopen(request)print response.read() Post &amp; Get123456789import urllibimport urllib2 values = &#123;\"username\":\"1016903103@qq.com\",\"password\":\"XXXX\"&#125;data = urllib.urlencode(values) url = \"https://passport.csdn.net/account/login?from=http://my.csdn.net/my/mycsdn\"request = urllib2.Request(url,data)response = urllib2.urlopen(request)print response.read() 123456789101112import urllibimport urllib2 values=&#123;&#125;values['username'] = \"1016903103@qq.com\"values['password']=\"XXXX\"data = urllib.urlencode(values) url = \"http://passport.csdn.net/account/login\"geturl = url + \"?\"+datarequest = urllib2.Request(geturl)response = urllib2.urlopen(request)print response.read() æ„å»ºæ¶ˆæ¯å¤´1234567891011import urllib import urllib2 url = 'http://www.server.com/login'user_agent = 'Mozilla/4.0 (compatible; MSIE 5.5; Windows NT)' values = &#123;'username' : 'cqc', 'password' : 'XXXX' &#125; headers = &#123; 'User-Agent' : user_agent &#125; data = urllib.urlencode(values) request = urllib2.Request(url, data, headers) response = urllib2.urlopen(request) page = response.read() Proxy è®¾ç½®12345678910import urllib2enable_proxy = Trueproxy_handler = urllib2.ProxyHandler(&#123;\"http\" : 'http://some-proxy.com:8080'&#125;)null_proxy_handler = urllib2.ProxyHandler(&#123;&#125;)if enable_proxy: opener = urllib2.build_opener(proxy_handler)else: opener = urllib2.build_opener(null_proxy_handler)urllib2.install_opener(opener) çˆ¬å– TED æ–‡ç« 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647# -*- coding: utf-8 -*import codecsimport bs4from bs4 import BeautifulSoupimport requestsimport re# ç”¨æˆ·è¾“å…¥ç½‘å€ï¼Œä¾‹å­ï¼šhttps://www.ted.com/talks/Xxx_Xxx_X...input_url = raw_input('Please Enter Article URL: ')url = input_url + '/transcript'# è·å–æ–‡ç« æ ‡é¢˜url_str = url.split('/')title_ = url_str[4]title_str = title_.split('_')title = ''author = ''num = 0for str in title_str: num = num + 1 if(num &gt; 2): if(num == 3): str = str.capitalize() title = title + str + ' ' else: author = author + str.capitalize()print \"Title:\" + titleprint \"Author:\" + author# è·å–æ–‡ç« html = requests.get(url).content soup = BeautifulSoup(html, 'html.parser', from_encoding='utf-8')divs = soup.find_all('div', class_=\"Grid__cell flx-s:1 p-r:4\")article = title + '\\n'rude_t = re.compile(r'\\t')rude_n = re.compile(r'\\n')for div in divs: for string in div.stripped_strings: string = rude_t.sub('', string) string = rude_n.sub(' ', string) article = article + string article = article + '\\n'article = article + '\\n'file = codecs.open(\"TED.txt\",\"a\",\"utf-8\")file.write(article)file.close()print \"Finish!\"","categories":[{"name":"Python","slug":"Python","permalink":"http://yoursite.com/categories/Python/"}],"tags":[{"name":"Crawler","slug":"Crawler","permalink":"http://yoursite.com/tags/Crawler/"}]},{"title":"Python åŸºç¡€","slug":"Python/Python åŸºç¡€","date":"2020-03-16T06:00:32.000Z","updated":"2020-03-16T07:08:28.827Z","comments":true,"path":"2020/03/16/Python/Python åŸºç¡€/","link":"","permalink":"http://yoursite.com/2020/03/16/Python/Python%20%E5%9F%BA%E7%A1%80/","excerpt":"Python å…¥é—¨ã€‚","text":"Python å…¥é—¨ã€‚ Python åŸºç¡€è¾“å…¥å’Œè¾“å‡º12name = raw_input('please enter your name: ') # è¾“å…¥ä¸ºå­—ç¬¦ä¸²å½¢å¼ int()print 'hello,', name å­—ç¬¦ä¸²è½¬ä¹‰å­—ç¬¦\\å¯ä»¥è½¬ä¹‰å¾ˆå¤šå­—ç¬¦ï¼Œæ¯”å¦‚\\nè¡¨ç¤ºæ¢è¡Œï¼Œ\\tè¡¨ç¤ºåˆ¶è¡¨ç¬¦ï¼Œå­—ç¬¦\\æœ¬èº«ä¹Ÿè¦è½¬ä¹‰ï¼Œæ‰€ä»¥\\\\è¡¨ç¤ºçš„å­—ç¬¦å°±æ˜¯\\ï¼Œå¦‚æœå­—ç¬¦ä¸²é‡Œé¢æœ‰å¾ˆå¤šå­—ç¬¦éƒ½éœ€è¦è½¬ä¹‰ï¼Œå°±éœ€è¦åŠ å¾ˆå¤š\\ï¼Œä¸ºäº†ç®€åŒ–ï¼ŒPythonè¿˜å…è®¸ç”¨r&#39;&#39;è¡¨ç¤º&#39;&#39;å†…éƒ¨çš„å­—ç¬¦ä¸²é»˜è®¤ä¸è½¬ä¹‰ã€‚ å¦‚æœå­—ç¬¦ä¸²å†…éƒ¨æœ‰å¾ˆå¤šæ¢è¡Œï¼Œç”¨\\nå†™åœ¨ä¸€è¡Œé‡Œä¸å¥½é˜…è¯»ï¼Œä¸ºäº†ç®€åŒ–ï¼ŒPythonå…è®¸ç”¨&#39;&#39;&#39;...&#39;&#39;&#39;çš„æ ¼å¼è¡¨ç¤ºå¤šè¡Œå†…å®¹ã€‚ 12345678print '''line1... line2... line3'''## è¾“å‡ºç»“æœ# line1# line2# line3 å ä½ç¬¦ å ä½ç¬¦ %d æ•´æ•° %f æµ®ç‚¹æ•° %s å­—ç¬¦ä¸² %x åå…­è¿›åˆ¶æ•´æ•° 12'Hi, %s, you have $%d.' % ('Michael', 1000000)# 'Hi, Michael, you have $1000000.' å¸ƒå°”å€¼å¸ƒå°”å€¼å’Œå¸ƒå°”ä»£æ•°çš„è¡¨ç¤ºå®Œå…¨ä¸€è‡´ï¼Œä¸€ä¸ªå¸ƒå°”å€¼åªæœ‰Trueã€Falseä¸¤ç§å€¼ï¼Œè¦ä¹ˆæ˜¯Trueï¼Œè¦ä¹ˆæ˜¯Falseï¼Œåœ¨Pythonä¸­ï¼Œå¯ä»¥ç›´æ¥ç”¨Trueã€Falseè¡¨ç¤ºå¸ƒå°”å€¼ï¼ˆè¯·æ³¨æ„å¤§å°å†™ï¼‰ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¸ƒå°”è¿ç®—è®¡ç®—å‡ºæ¥ã€‚ å¸ƒå°”å€¼å¯ä»¥ç”¨andã€orå’Œnotè¿ç®—ã€‚ ç©ºå€¼ç©ºå€¼æ˜¯Pythoné‡Œä¸€ä¸ªç‰¹æ®Šçš„å€¼ï¼Œç”¨Noneè¡¨ç¤ºã€‚Noneä¸èƒ½ç†è§£ä¸º0ï¼Œå› ä¸º0æ˜¯æœ‰æ„ä¹‰çš„ï¼Œè€ŒNoneæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç©ºå€¼ã€‚ å˜é‡å˜é‡åœ¨ç¨‹åºä¸­å°±æ˜¯ç”¨ä¸€ä¸ªå˜é‡åè¡¨ç¤ºäº†ï¼Œå˜é‡åå¿…é¡»æ˜¯å¤§å°å†™è‹±æ–‡ã€æ•°å­—å’Œ_çš„ç»„åˆï¼Œä¸”ä¸èƒ½ç”¨æ•°å­—å¼€å¤´ã€‚ 1234567891011a = 'ABC' # åœ¨å†…å­˜ä¸­åˆ›å»ºäº†ä¸€ä¸ª ABC çš„å­—ç¬¦ä¸²ï¼›åœ¨å†…å­˜ä¸­åˆ›å»ºäº†ä¸€ä¸ªåä¸º a çš„å˜é‡ï¼Œå¹¶æŠŠå®ƒæŒ‡å‘ ABC å­—ç¬¦ä¸²b = aa = 'XYZ'print b # ABC å­—ç¬¦ä¸²&gt;&gt;&gt; a = 'abc'&gt;&gt;&gt; b = a.replace('a', 'A')&gt;&gt;&gt; b'Abc'&gt;&gt;&gt; a'abc' list å’Œ tuplePython å†…ç½®çš„ä¸€ç§æ•°æ®ç±»å‹æ˜¯åˆ—è¡¨ï¼šlistã€‚list æ˜¯ä¸€ç§æœ‰åºçš„é›†åˆï¼Œå¯ä»¥éšæ—¶æ·»åŠ å’Œåˆ é™¤å…¶ä¸­çš„å…ƒç´ ã€‚ 123456789101112131415161718192021222324252627282930&gt;&gt;&gt; classmates = ['Michael', 'Bob', 'Tracy']&gt;&gt;&gt; classmates['Michael', 'Bob', 'Tracy']&gt;&gt;&gt; len(classmates)3&gt;&gt;&gt; classmates[-1]'Tracy'&gt;&gt;&gt; classmates.append('Adam')&gt;&gt;&gt; classmates['Michael', 'Bob', 'Tracy', 'Adam']&gt;&gt;&gt; classmates.insert(1, 'Jack')&gt;&gt;&gt; classmates['Michael', 'Jack', 'Bob', 'Tracy', 'Adam']&gt;&gt;&gt; classmates.pop()'Adam'&gt;&gt;&gt; classmates['Michael', 'Jack', 'Bob', 'Tracy']&gt;&gt;&gt; classmates.pop(1)'Jack'&gt;&gt;&gt; classmates['Michael', 'Bob', 'Tracy']&gt;&gt;&gt; p = ['asp', 'php']&gt;&gt;&gt; s = ['python', 'java', p, 'scheme'] tuple å¦ä¸€ç§æœ‰åºåˆ—è¡¨å«å…ƒç»„ï¼štupleã€‚tuple å’Œ list éå¸¸ç±»ä¼¼ï¼Œä½†æ˜¯ tuple ä¸€æ—¦åˆå§‹åŒ–å°±ä¸èƒ½ä¿®æ”¹ã€‚ 1&gt;&gt;&gt; classmates = ('Michael', 'Bob', 'Tracy') é”™è¯¯ç”¨æ³• 12345&gt;&gt;&gt; t = ('a', 'b', ['A', 'B'])&gt;&gt;&gt; t[2][0] = 'X'&gt;&gt;&gt; t[2][1] = 'Y'&gt;&gt;&gt; t('a', 'b', ['X', 'Y']) # list æ˜¯å¯ä»¥å˜çš„ æ¡ä»¶åˆ¤æ–­å’Œå¾ªç¯12345678if &lt;æ¡ä»¶åˆ¤æ–­1&gt;: &lt;æ‰§è¡Œ1&gt;elif &lt;æ¡ä»¶åˆ¤æ–­2&gt;: &lt;æ‰§è¡Œ2&gt;elif &lt;æ¡ä»¶åˆ¤æ–­3&gt;: &lt;æ‰§è¡Œ3&gt;else: &lt;æ‰§è¡Œ4&gt; 1234sum = 0for x in range(101): sum = sum + xprint sum 123456sum = 0n = 99while n &gt; 0: sum = sum + n n = n - 2print sum dict å’Œ setPython å†…ç½®äº†å­—å…¸ï¼šdict çš„æ”¯æŒï¼Œdict å…¨ç§° dictionaryï¼Œåœ¨å…¶ä»–è¯­è¨€ä¸­ä¹Ÿç§°ä¸º mapï¼Œä½¿ç”¨é”®-å€¼ï¼ˆkey-valueï¼‰å­˜å‚¨ï¼Œå…·æœ‰æå¿«çš„æŸ¥æ‰¾é€Ÿåº¦ã€‚ dict å¯ä»¥ç”¨åœ¨éœ€è¦é«˜é€ŸæŸ¥æ‰¾çš„å¾ˆå¤šåœ°æ–¹ï¼Œåœ¨ Python ä»£ç ä¸­å‡ ä¹æ— å¤„ä¸åœ¨ï¼Œæ­£ç¡®ä½¿ç”¨ dict éå¸¸é‡è¦ï¼Œéœ€è¦ç‰¢è®°çš„ç¬¬ä¸€æ¡å°±æ˜¯ dict çš„ key å¿…é¡»æ˜¯ä¸å¯å˜å¯¹è±¡ã€‚ 123456789101112&gt;&gt;&gt; d['Adam'] = 67&gt;&gt;&gt; d['Adam']67&gt;&gt;&gt; 'Thomas' in dFalse&gt;&gt;&gt; d.get('Thomas')&gt;&gt;&gt; d.get('Thomas', -1)-1# pop('key') set å’Œ dict ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ä¸€ç»„ key çš„é›†åˆï¼Œä½†ä¸å­˜å‚¨ valueã€‚ç”±äº key ä¸èƒ½é‡å¤ï¼Œæ‰€ä»¥ï¼Œåœ¨ set ä¸­ï¼Œæ²¡æœ‰é‡å¤çš„ keyã€‚ 1234567891011121314&gt;&gt;&gt; s = set([1, 1, 2, 2, 3, 3])&gt;&gt;&gt; sset([1, 2, 3])&gt;&gt;&gt; s.add(4)&gt;&gt;&gt; sset([1, 2, 3, 4])&gt;&gt;&gt; s.add(4)&gt;&gt;&gt; sset([1, 2, 3, 4])&gt;&gt;&gt; s.remove(4)&gt;&gt;&gt; sset([1, 2, 3]) å‡½æ•°å†…ç½®å¸¸ç”¨å‡½æ•°åœ¨äº¤äº’å¼å‘½ä»¤è¡Œé€šè¿‡help(abs)æŸ¥çœ‹abså‡½æ•°çš„å¸®åŠ©ä¿¡æ¯ã€‚ 12345678910111213&gt;&gt;&gt; abs(100)100&gt;&gt;&gt; abs(-20)20&gt;&gt;&gt; abs(12.34)12.34&gt;&gt;&gt; cmp(1, 2)-1&gt;&gt;&gt; cmp(2, 1)1&gt;&gt;&gt; cmp(3, 3)0 æ•°æ®ç±»å‹è½¬æ¢ 1234567891011121314&gt;&gt;&gt; int('123')123&gt;&gt;&gt; int(12.34)12&gt;&gt;&gt; float('12.34')12.34&gt;&gt;&gt; str(1.23)'1.23'&gt;&gt;&gt; unicode(100)u'100'&gt;&gt;&gt; bool(1)True&gt;&gt;&gt; bool('')False å®šä¹‰å‡½æ•°å¦‚æœæ²¡æœ‰returnè¯­å¥ï¼Œå‡½æ•°æ‰§è¡Œå®Œæ¯•åä¹Ÿä¼šè¿”å›ç»“æœï¼Œåªæ˜¯ç»“æœä¸ºNoneã€‚ 1234567def my_abs(x): if not isinstance(x, (int, float)): raise TypeError('bad operand type') if x &gt;= 0: return x else: return -x 12def nop(): pass # ä½œä¸ºå ä½ç¬¦ï¼Œæ¯”å¦‚ç°åœ¨è¿˜æ²¡æƒ³å¥½æ€ä¹ˆå†™å‡½æ•°çš„ä»£ç ï¼Œå°±å¯ä»¥å…ˆæ”¾ä¸€ä¸ª passï¼Œè®©ä»£ç èƒ½è¿è¡Œèµ·æ¥ 1234567891011import mathdef move(x, y, step, angle=0): nx = x + step * math.cos(angle) ny = y - step * math.sin(angle) return nx, ny&gt;&gt;&gt; r = move(100, 100, 60, math.pi / 6)&gt;&gt;&gt; print r(151.96152422706632, 70.0) # è¿”å›å€¼æ˜¯ä¸€ä¸ªtupleï¼Œtuple å¯ä»¥çœç•¥æ‹¬å·ï¼Œè€Œå¤šä¸ªå˜é‡å¯ä»¥åŒæ—¶æ¥æ”¶ä¸€ä¸ª tupleï¼ŒæŒ‰ä½ç½®èµ‹ç»™å¯¹åº”çš„å€¼ å‡½æ•°çš„å‚æ•°12345678910# å¤§å¤šæ•°å­¦ç”Ÿæ³¨å†Œæ—¶ä¸éœ€è¦æä¾›å¹´é¾„å’ŒåŸå¸‚ï¼Œåªæä¾›å¿…é¡»çš„ä¸¤ä¸ªå‚æ•°def enroll(name, gender, age=6, city='Beijing'): print 'name:', name print 'gender:', gender print 'age:', age print 'city:', city # åªæœ‰ä¸é»˜è®¤å‚æ•°ä¸ç¬¦çš„å­¦ç”Ÿæ‰éœ€è¦æä¾›é¢å¤–çš„ä¿¡æ¯enroll('Bob', 'M', 7)enroll('Adam', 'M', city='Tianjin') *argsæ˜¯å¯å˜å‚æ•°ï¼Œargs æ¥æ”¶çš„æ˜¯ä¸€ä¸ª tupleï¼› **kwæ˜¯å…³é”®å­—å‚æ•°ï¼Œkw æ¥æ”¶çš„æ˜¯ä¸€ä¸ª dictã€‚","categories":[{"name":"Python","slug":"Python","permalink":"http://yoursite.com/categories/Python/"}],"tags":[{"name":"Base","slug":"Base","permalink":"http://yoursite.com/tags/Base/"}]},{"title":"å¼€å‘å¸¸ç”¨å·¥å…·ç±»","slug":"Software/å¼€å‘å¸¸ç”¨å·¥å…·ç±»","date":"2020-03-12T07:31:13.000Z","updated":"2020-03-12T09:54:29.922Z","comments":true,"path":"2020/03/12/Software/å¼€å‘å¸¸ç”¨å·¥å…·ç±»/","link":"","permalink":"http://yoursite.com/2020/03/12/Software/%E5%BC%80%E5%8F%91%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E7%B1%BB/","excerpt":"è®°å½•ä¸€ä¸‹å¼€å‘ä¸­ç”¨åˆ°çš„å„ç§å°å·¥å…·ç±»ã€‚","text":"è®°å½•ä¸€ä¸‹å¼€å‘ä¸­ç”¨åˆ°çš„å„ç§å°å·¥å…·ç±»ã€‚ åŠ å¯†ç±»Md512345678910111213141516171819202122232425262728293031323334353637383940414243import java.security.MessageDigest;import org.apache.commons.lang3.StringUtils;public class Md5Util &#123; private Md5Util() &#123; throw new IllegalStateException(\"Utility class\"); &#125; /** * md5 åŠ å¯†é€šç”¨å·¥å…·ç±» * * @param encode éœ€åŠ å¯†çš„å­—ç¬¦ä¸² * @return md5 åŠ å¯†åçš„å­—ç¬¦ä¸²ï¼ˆ32ä½å­—ç¬¦ä¸²ï¼‰ */ public static String md5(String encode) &#123; // æ£€éªŒå‚æ•°æ˜¯å¦æ˜¯ null æˆ–è€… \"\" æˆ–è€… \" \" ç­‰ if (StringUtils.isBlank(encode)) &#123; return \"\"; &#125; char[] hexDigits = &#123;'0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f'&#125;; try &#123; // è®¾ç½®å­—ç¬¦é›† byte[] strTemp = encode.getBytes(StandardCharsets.UTF_8); // ç”Ÿæˆä¸€ä¸ª md5 åŠ å¯†è®¡ç®—æ‘˜è¦ MessageDigest mdTemp = MessageDigest.getInstance(\"MD5\"); // è®¡ç®— md5 å‡½æ•° mdTemp.update(strTemp); // digest() æœ€åç¡®å®šè¿”å› md5 hash å€¼ï¼Œè¿”å›å€¼ä¸º 8 ä½å­—ç¬¦ä¸²ã€‚å› ä¸º md5 hash å€¼æ˜¯ 16 ä½çš„ hex å€¼ï¼Œå®é™…ä¸Šå°±æ˜¯ 8 ä½çš„å­—ç¬¦ byte[] md = mdTemp.digest(); int j = md.length; char[] str = new char[j * 2]; int k = 0; for (byte byte0 : md) &#123; // ä¸å¸¦ç¬¦å·å³ç§»å››ä½(ä¸ç®¡ byte0 çš„ç±»å‹ ä½ç§»å¤„è¡¥ 0)ï¼Œ&amp; åå…­è¿›åˆ¶çš„ f å³ é«˜å››ä½æ¸…ç©º å–ä½å››ä½çš„å€¼ï¼Œ&gt;&gt;&gt; ä¼˜å…ˆçº§é«˜äº &amp; str[k++] = hexDigits[byte0 &gt;&gt;&gt; 4 &amp; 0xf]; str[k++] = hexDigits[byte0 &amp; 0xf]; &#125; return new String(str); &#125; catch (Exception e) &#123; return \"\"; &#125; &#125;&#125;","categories":[{"name":"Software","slug":"Software","permalink":"http://yoursite.com/categories/Software/"}],"tags":[{"name":"Tool","slug":"Tool","permalink":"http://yoursite.com/tags/Tool/"}]},{"title":"ç”¨æˆ·ç®¡ç†ç³»ç»Ÿ","slug":"Welab/ç”¨æˆ·ç®¡ç†ç³»ç»Ÿ","date":"2020-03-07T08:44:21.000Z","updated":"2020-04-19T06:45:04.725Z","comments":true,"path":"2020/03/07/Welab/ç”¨æˆ·ç®¡ç†ç³»ç»Ÿ/","link":"","permalink":"http://yoursite.com/2020/03/07/Welab/%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/","excerpt":"åŸºäº Spring Boot çš„ç”¨æˆ·ç®¡ç†ç³»ç»Ÿã€‚","text":"åŸºäº Spring Boot çš„ç”¨æˆ·ç®¡ç†ç³»ç»Ÿã€‚ å‡†å¤‡å·¥ä½œåŠŸèƒ½æ¨¡å—åˆ†æï¼š æ•°æ®åº“è¡¨åˆ†æï¼š æ•°æ®åº“å»ºè¡¨è¯­å¥ï¼š 1234567891011CREATE TABLE `user_manage_demo` ( `user_id` bigint(11) unsigned NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®idï¼Œç”¨æˆ·id', `username` varchar(50) NOT NULL COMMENT 'ç”¨æˆ·å', `password` varchar(100) NOT NULL COMMENT 'ç”¨æˆ·å¯†ç ', `type` char(1) unsigned NOT NULL COMMENT 'ç”¨æˆ·ç±»å‹ï¼ˆ1ï¼šç®¡ç†å‘˜ï¼›0ï¼šæ™®é€šç”¨æˆ·ï¼‰', `gmt_create` datetime NOT NULL COMMENT 'è®°å½•åˆ›å»ºæ—¶é—´', `gmt_modified` datetime NOT NULL COMMENT 'è®°å½•ä¿®æ”¹æ—¶é—´', `is_delete` tinyint(1) unsigned NOT NULL DEFAULT '0' COMMENT 'è®°å½•æ˜¯å¦é€»è¾‘åˆ é™¤ï¼ˆ0ï¼šæœªåˆ é™¤ï¼›1ï¼šå·²åˆ é™¤ï¼‰', PRIMARY KEY (`user_id`), UNIQUE KEY `uk_name_type` (`username`,`type`) USING BTREE COMMENT 'ç”¨æˆ·åç§°ã€ç±»å‹å”¯ä¸€ç´¢å¼•') ENGINE=InnoDB AUTO_INCREMENT=6 DEFAULT CHARSET=utf8mb4 COMMENT='ç”¨æˆ·ç®¡ç†è¡¨'; åœ¨æ•°æ®åº“è¡¨ä¸­åˆå§‹åŒ–ä¸€æ¡ç®¡ç†å‘˜æ•°æ®ï¼š 1234INSERT INTO `springboot_user`.`user` (`user_id`, `username`, `password`, `type`, `gmt_create`, `gmt_modified`, `is_delete`) VALUES (1, 'admin', '123456', \"1\", '2019-05-19 20:26:22', '2019-05-19 20:26:27', 0); æ¥å£çš„è®¾è®¡ ä¸ºäº†é¡¹ç›®ä»£ç æ›´åŠ ç®€æ´ï¼Œæ­¤é¡¹ç›®æ·»åŠ äº† Lombok æ”¯æŒä¾èµ–å¹¶ä¸” IDEA æ·»åŠ äº†ç›¸åº”çš„ Lombok æ’ä»¶ï¼Œé€šè¿‡åœ¨ç±»æ³¨é‡Š@Dataä¸ºç›¸åº”çš„ç±»æ·»åŠ Getter/Setterï¼ŒtoString()ï¼Œequals() ç­‰æ–¹æ³•ã€‚ 123456&lt;!-- æ·»åŠ  Lombok çš„æ”¯æŒ --&gt;&lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;scope&gt;provided&lt;/scope&gt;&lt;/dependency&gt; å°†å‰ç«¯ä¼ è¾“è¿‡æ¥çš„çš„æ•°æ®å°è£…åœ¨å¯¹åº”çš„ DTO ç±»ä¸­ï¼Œç”¨äºå±•ç¤ºå±‚ä¸æœåŠ¡å±‚ä¹‹é—´çš„æ•°æ®ä¼ è¾“å¯¹è±¡ã€‚ï¼ˆView ğŸ‘‰ Action ğŸ‘‰ Srviceï¼‰ DTOï¼šData Transfer Objectï¼ˆæ•°æ®ä¼ è¾“å¯¹è±¡ï¼‰DTO æ˜¯ä¸€ç»„éœ€è¦è·¨è¿›ç¨‹æˆ–ç½‘ç»œè¾¹ç•Œä¼ è¾“çš„èšåˆæ•°æ®çš„ç®€å•å®¹å™¨ã€‚å®ƒä¸åº”è¯¥åŒ…å«ä¸šåŠ¡é€»è¾‘ï¼Œå¹¶å°†å…¶è¡Œä¸ºé™åˆ¶ä¸ºè¯¸å¦‚å†…éƒ¨ä¸€è‡´æ€§æ£€æŸ¥å’ŒåŸºæœ¬éªŒè¯ä¹‹ç±»çš„æ´»åŠ¨ã€‚ å°†è¿”å›å‰ç«¯çš„æ•°æ®å°è£…åœ¨å¯¹åº”çš„ VO ç±»ä¸­ã€‚ VOï¼šView Objectï¼ˆè§†å›¾å¯¹è±¡ï¼‰VO çš„ä½œç”¨æ˜¯æŠŠæŸä¸ªæŒ‡å®šé¡µé¢ï¼ˆæˆ–ç»„ä»¶ï¼‰çš„æ‰€æœ‰æ•°æ®å°è£…èµ·æ¥ã€‚ DTO ç±»çš„ç¼–å†™åœ¨ DTO ç±»ä¸­æ·»åŠ  JSR303 æ ¡éªŒã€‚ JSR303 æ˜¯ä¸€é¡¹æ ‡å‡†ï¼ŒJSR-349 æ˜¯å…¶çš„å‡çº§ç‰ˆæœ¬ï¼Œæ·»åŠ äº†ä¸€äº›æ–°ç‰¹æ€§ï¼Œä»–ä»¬è§„å®šä¸€äº›æ ¡éªŒè§„èŒƒå³æ ¡éªŒæ³¨è§£ï¼Œå¦‚ @Nullï¼Œ@NotNullï¼Œ@Patternï¼Œåœ¨ javax.validation.constraints åŒ…ä¸‹ï¼Œåªæä¾›è§„èŒƒä¸æä¾›å®ç°ã€‚ Hibernat Validation æ˜¯å¯¹è¿™ä¸ªè§„èŒƒçš„å®è·µï¼ˆä¸è¦å°† Hibernate å’Œæ•°æ®åº“ ORM æ¡†æ¶è”ç³»åœ¨ä¸€èµ·ï¼‰ï¼Œä»–æä¾›äº†ç›¸åº”çš„å®ç°ï¼Œå¹¶å¢åŠ äº†ä¸€äº›å…¶ä»–æ ¡éªŒæ³¨è§£ï¼Œå¦‚@Emailï¼Œ@Lengthï¼Œ@Rangeç­‰ç­‰ï¼Œåœ¨ org.hibernate.validator.constraints åŒ…ä¸‹ã€‚ Spring ä¸ºäº†ç»™å¼€å‘è€…æä¾›ä¾¿æ·ï¼Œå¯¹ Hibernate Validation è¿›è¡Œäº†äºŒæ¬¡å°è£…ï¼Œæ˜¾ç¤ºæ ¡éªŒ Validated Bean æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ Spring validation æˆ–è€… Hibernate validationï¼Œè€Œ Spring Validation å¦ä¸€ä¸ªç‰¹æ€§ï¼Œä¾¿æ˜¯å…¶åœ¨ Spring MVC æ¨¡å—ä¸­æ·»åŠ äº†è‡ªåŠ¨æ ¡éªŒï¼Œå¹¶å°†æ ¡éªŒä¿¡æ¯å°è£…è¿›äº†ç‰¹å®šçš„ç±»ä¸­ã€‚è¿™æ— ç–‘ä¾¿æ·äº†æˆ‘ä»¬çš„ web å¼€å‘ã€‚ 12345678910111213141516171819202122232425/*** DTO ç±»ç¤ºä¾‹* @NotBlank ç”¨äº Stringï¼ˆä¼šå»æ‰ç©ºæ ¼ï¼‰* @NotNull ç”¨äº Integer* @Data è‡ªåŠ¨ç”Ÿæˆ Getter/Setterï¼ŒtoString()ï¼Œequals() ç­‰æ–¹æ³•*/@Datapublic class LoginDTO implements Serializable &#123; private static final long serialVersionUID = 1L; /** ç”¨æˆ·å */ @NotBlank(message = \"ç”¨æˆ·åä¸èƒ½ä¸ºç©º\") private String username; /** ç”¨æˆ·å¯†ç  */ @NotBlank(message = \"ç”¨æˆ·å¯†ç ä¸èƒ½ä¸ºç©º\") private String password; /** éªŒè¯ç  */ @NotBlank(message = \"éªŒè¯ç ä¸èƒ½ä¸ºç©º\") private String checkCode; /** ç±»å‹ */ @NotNull(message = \"ç”¨æˆ·ç±»å‹ä¸èƒ½ä¸ºç©º\") private String type;&#125; VO ç±»çš„ç¼–å†™ 12345678910111213141516171819/*** VO ç±»ç¤ºä¾‹* ç®¡ç†å‘˜ç”¨æˆ·åˆ—è¡¨é¡µé¢çš„ç”¨æˆ·ä¿¡æ¯è¿”å›å¯¹è±¡*/@Datapublic class ViewVO implements Serializable &#123; private static final long serialVersionUID = 1L; /** ç”¨æˆ·æ ‡è¯† */ private Integer userId; /** ç”¨æˆ·å */ private String username; /** ç”¨æˆ·ç±»å‹ */ private String type; /** ç”¨æˆ·åˆ›å»ºæ—¶é—´ */ private Date gtmCreate;&#125; é™æ€å¸¸é‡ç±»å°†é¡¹ç›®ä¸­ä¸€äº›å›ºå®šçš„å­—é¢é‡å®šä¹‰ä¸ºä¸å¯å˜çš„é™æ€å¸¸é‡public static finalã€‚ UrlConstant123456789101112131415161718192021222324/*** URL é™æ€å¸¸é‡ç±»*/public final class UrlConstant &#123; /** æ·»åŠ ç§æœ‰çš„æ„é€ å‡½æ•°ï¼Œé˜²æ­¢é™æ€å¸¸é‡ç±»æ„é€ å…¶å®ƒçš„å®ä¾‹ï¼Œç„¶åæ”¹å˜é™æ€å¸¸é‡çš„å€¼ */ private UrlConstant() &#123; throw new IllegalStateException(\"Utility class\"); &#125; /** è·³è½¬é¦–é¡µ URL */ public static final String INDEX = \"/index\"; /** è·³è½¬æ³¨å†Œ URL */ public static final String REGISTER = \"/register\"; /** è·³è½¬ç™»å½• URL */ public static final String LOGIN = \"/login\"; /** è·³è½¬æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨ URL */ public static final String VIEW = \"/view\"; /** è·³è½¬æ–°å¢ç”¨æˆ· URL */ public static final String USER = \"/user\"; /** è·³è½¬ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ URL */ public static final String MODIFY = \"/modify\";&#125; UserTypeConstant12345678910111213141516171819202122232425262728293031/*** ç”¨æˆ·ç±»å‹é™æ€å¸¸é‡ç±»*/public final class UserTypeConstant &#123; /** æ·»åŠ ç§æœ‰çš„æ„é€ å‡½æ•°ï¼Œé˜²æ­¢é™æ€å¸¸é‡ç±»æ„é€ å…¶å®ƒçš„å®ä¾‹ï¼Œç„¶åæ”¹å˜é™æ€å¸¸é‡çš„å€¼ */ private UserTypeConstant() &#123; throw new IllegalStateException(\"Utility class\"); &#125; /** ç®¡ç†å‘˜ç”¨æˆ· */ public static final String ADMIN = 1; /** æ™®é€šç”¨æˆ· */ public static final String ORDINARY = 0; /** * ç”¨æˆ·ç±»å‹ä»£ç è½¬æè¿° * * @param type ç”¨æˆ·ç±»å‹ * @return ç”¨æˆ·ç±»å‹ä¸­æ–‡æè¿° */ public static String typeToDesc(Sting type) &#123; if (UserTypeConstant.ADMIN.equals(type)) &#123; return \"ç®¡ç†å‘˜\"; &#125; else if (UserTypeConstant.ORDINARY.equals(type)) &#123; return \"æ™®é€šç”¨æˆ·\"; &#125; else &#123; return \"æœªçŸ¥èº«ä»½ï¼Œè¯·è”ç³»ç³»ç»Ÿç®¡ç†å‘˜\"; &#125; &#125; ImageCodeConstant123456789101112131415161718192021222324252627public final class ImageCodeConstant &#123; /** æ·»åŠ ç§æœ‰çš„æ„é€ å‡½æ•°ï¼Œé˜²æ­¢é™æ€å¸¸é‡ç±»æ„é€ å…¶å®ƒçš„å®ä¾‹ï¼Œç„¶åæ”¹å˜é™æ€å¸¸é‡çš„å€¼ */ private ImageCodeConstant() &#123; throw new IllegalStateException(\"Utility class\"); &#125; /** éªŒè¯ç ç”Ÿæˆçš„æ—¶é—´ */ public static final String CODE_TIME = \"codeTime\"; /** éªŒè¯ç è¿‡æœŸæ—¶é—´ï¼Œå•ä½ï¼šåˆ†é’Ÿ */ public static final int CAPTCHA_EXPIRY_TIME = 5; /** ç§’/æ¯«ç§’æ¢ç®— */ public static final int MILLISECOND_CONVERSION = 1000; /** åˆ†é’Ÿ/ç§’æ¢ç®— */ public static final int MINUTE_CONVERSION = 60; /** ç”ŸæˆéªŒè¯ç çš„å˜é‡åç§° */ public static final String SIMPLE_CAPTCHA = \"simpleCaptcha\"; /** ç”ŸæˆéªŒè¯ç çš„å˜é‡å€¼ */ public static final String CAPTCHA_VALUE = \"captchaValue\"; /** ç”Ÿæˆçš„éªŒè¯ç å›¾å½¢çš„å˜é‡å */ public static final String IMAGE = \"image\"; /** ç”Ÿæˆçš„å›¾å½¢éªŒè¯ç æ–‡ä»¶æ ¼å¼åŒ–çš„åç§° */ public static final String JPEG = \"JPEG\"; /** å›¾ç‰‡å­—ç¬¦æ¶‰åŠçš„ç½—é©¬å­—ä½“å */ public static final String TIMES_NEW_ROMAN = \"Times New Roman\";&#125; RespoonseConstant12345678910111213141516171819202122public final class ResponseConstant &#123; /** æ·»åŠ ç§æœ‰çš„æ„é€ å‡½æ•°ï¼Œé˜²æ­¢é™æ€å¸¸é‡ç±»æ„é€ å…¶å®ƒçš„å®ä¾‹ï¼Œç„¶åæ”¹å˜é™æ€å¸¸é‡çš„å€¼ */ private ResponseConstant() &#123; throw new IllegalStateException(\"Utility class\"); &#125; /** å¤„ç†æˆåŠŸæ—¶è¿”å›çš„ Code */ public static final String SUCCESS = \"200\"; /** ä¸šåŠ¡å¤„ç†å¤±è´¥æ—¶è¿”å›çš„ Code */ public static final String FAIL = \"-1\"; /** è¿”å›ä¿¡æ¯çš„ Key å¸¸é‡å€¼ */ public static final String RESPONSE_VO = \"responseVO\"; /** è¿”å›çŠ¶æ€ç å¸¸é‡å€¼ */ public static final String CODE = \"code\"; /** è¿”å›çŠ¶æ€ä¿¡æ¯å¸¸é‡å€¼ */ public static final String MESSAGE = \"message\"&#125; UserConstant1234567891011121314public final class UserConstant &#123; /** æ·»åŠ ç§æœ‰çš„æ„é€ å‡½æ•°ï¼Œé˜²æ­¢é™æ€å¸¸é‡ç±»æ„é€ å…¶å®ƒçš„å®ä¾‹ï¼Œç„¶åæ”¹å˜é™æ€å¸¸é‡çš„å€¼ */ private UserConstant() &#123; throw new IllegalStateException(\"Utility class\"); &#125; /** Session ä¸­çš„ç”¨æˆ·åå¸¸é‡çš„å­—æ®µåç§°ï¼Œå¤šå¤„ä½¿ç”¨ç»Ÿä¸€åœ¨è¿™é‡Œå®šä¹‰ï¼Œé¿å… SonarLint é­”æ³•å€¼çš„å‘Šè­¦ */ public static final String USERNAME = \"username\"; /** Session ä¸­çš„ç”¨æˆ·ç±»å‹å¸¸é‡çš„å­—æ®µåç§°ï¼Œå¤šå¤„ä½¿ç”¨ç»Ÿä¸€åœ¨è¿™é‡Œå®šä¹‰ï¼Œé¿å… SonarLint é­”æ³•å€¼çš„å‘Šè­¦ */ public static final String TYPE = \"type\"; /** Session ä¸­çš„ç”¨æˆ·ç±»å‹åç§°å¸¸é‡çš„å­—æ®µåç§°ï¼Œå¤šå¤„ä½¿ç”¨ç»Ÿä¸€åœ¨è¿™é‡Œå®šä¹‰ï¼Œé¿å… SonarLint é­”æ³•å€¼çš„å‘Šè­¦ */ public static final String TYPE_NAME = \"typeName\";&#125; å·¥å…·ç±»MD5 å¯†ç åŠ å¯†1234567891011121314151617181920212223242526272829303132333435363738394041public class Md5Util &#123; private Md5Util() &#123; throw new IllegalStateException(\"Utility class\"); &#125; /** * md5 åŠ å¯†é€šç”¨å·¥å…·ç±» * * @param encode éœ€åŠ å¯†çš„å­—ç¬¦ä¸² * @return md5 åŠ å¯†åçš„å­—ç¬¦ä¸²ï¼ˆ32ä½å­—ç¬¦ä¸²ï¼‰ */ public static String md5(String encode) &#123; // æ£€éªŒå‚æ•°æ˜¯å¦æ˜¯ null æˆ–è€… \"\" æˆ–è€… \" \" ç­‰ if (StringUtils.isBlank(encode)) &#123; return \"\"; &#125; char[] hexDigits = &#123;'0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f'&#125;; try &#123; // è®¾ç½®å­—ç¬¦é›† byte[] strTemp = encode.getBytes(StandardCharsets.UTF_8); // ç”Ÿæˆä¸€ä¸ª md5 åŠ å¯†è®¡ç®—æ‘˜è¦ MessageDigest mdTemp = MessageDigest.getInstance(\"MD5\"); // è®¡ç®— md5 å‡½æ•° mdTemp.update(strTemp); // digest() æœ€åç¡®å®šè¿”å› md5 hash å€¼ï¼Œè¿”å›å€¼ä¸º 8 ä½å­—ç¬¦ä¸²ã€‚å› ä¸º md5 hash å€¼æ˜¯ 16 ä½çš„ hex å€¼ï¼Œå®é™…ä¸Šå°±æ˜¯ 8 ä½çš„å­—ç¬¦ byte[] md = mdTemp.digest(); int j = md.length; char[] str = new char[j * 2]; int k = 0; for (byte byte0 : md) &#123; // ä¸å¸¦ç¬¦å·å³ç§»å››ä½(ä¸ç®¡ byte0 çš„ç±»å‹ ä½ç§»å¤„è¡¥ 0)ï¼Œ&amp; åå…­è¿›åˆ¶çš„ f å³ é«˜å››ä½æ¸…ç©º å–ä½å››ä½çš„å€¼ï¼Œ&gt;&gt;&gt; ä¼˜å…ˆçº§é«˜äº &amp; str[k++] = hexDigits[byte0 &gt;&gt;&gt; 4 &amp; 0xf]; str[k++] = hexDigits[byte0 &amp; 0xf]; &#125; return new String(str); &#125; catch (Exception e) &#123; return \"\"; &#125; &#125;&#125; éªŒè¯ç ç”Ÿæˆ123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293public class ImageCodeUtil &#123; private ImageCodeUtil() &#123; throw new IllegalStateException(\"Utility class\"); &#125; /** ç”ŸæˆéªŒè¯ç å›¾ç‰‡çš„é»˜è®¤å®½åº¦ */ private static final int IMAGE_WIDTH = 60; /** ç”ŸæˆéªŒè¯ç å›¾ç‰‡çš„é»˜è®¤é«˜åº¦ */ private static final int IMAGE_HEIGHT = 20; /** éšæœºå¹²æ‰°çº¿çš„æ¡æ•°ï¼Œå¤ªç¨€ç–æˆ–è€…å¤ªå¯†ç»‡éƒ½è¾¾ä¸åˆ°å¹²æ‰°çš„æ•ˆæœ */ private static final int RAND_COLOR = 168; /** é¢œè‰²æ•°å€¼çš„ä¸Šé™ï¼Œä¸‰åŸè‰²çš„èŒƒå›´éƒ½æ˜¯ [0, 255] èŒƒå›´ */ private static final int COLOR_MAX = 255; /** å¯æ ¹æ®éœ€è¦æ¥ä¿®æ”¹ï¼Œç”Ÿæˆçº¯æ•°å­—æˆ–è€…çº¯å­—æ¯ï¼Œæˆ–è€…é»˜è®¤è¿™ç§æ··åˆçš„ */ private static char[] mapTable = &#123;'0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'&#125;; /** * ç”Ÿæˆå›¾å½¢éªŒè¯ç  * * @param width ç”Ÿæˆçš„å›¾å½¢éªŒè¯ç çš„å®½åº¦ * @param height ç”Ÿæˆçš„å›¾å½¢éªŒè¯ç çš„é«˜åº¦ * @param verifySize éœ€è¦ç”Ÿæˆçš„éªŒè¯ç ä½æ•° * @return éªŒè¯ç çš„å›¾ç‰‡å¯¹è±¡åŠéªŒè¯ç çš„å€¼ */ public static Map&lt;String, Object&gt; getImageCode(int width, int height, int verifySize) throws NoSuchAlgorithmException &#123; Map&lt;String, Object&gt; returnMap = new HashMap&lt;&gt;(6); // ç¡®ä¿éªŒè¯ç çš„å®½åº¦å’Œé«˜åº¦ä¸èƒ½å°äºæˆ–ç­‰äºé›¶ width = width &lt;= 0 ? IMAGE_WIDTH : width; height = height &lt;= 0 ? IMAGE_HEIGHT : height; // BufferedImage æ˜¯ Image çš„ä¸€ä¸ªå­ç±»ï¼ŒImage å’Œ BufferedImage // ä¸»è¦ä½œç”¨å°±æ˜¯å°†ä¸€å‰¯å›¾ç‰‡åŠ è½½åˆ°å†…å­˜ä¸­ï¼ŒBufferedImage ç”Ÿæˆçš„å›¾ç‰‡åœ¨å†…å­˜é‡Œæœ‰ä¸€ä¸ªå›¾åƒç¼“å†²åŒº // åˆ©ç”¨è¿™ä¸ªç¼“å†²åŒºæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿çš„æ“ä½œè¿™ä¸ªå›¾ç‰‡ï¼Œé€šå¸¸ç”¨æ¥åšå›¾ç‰‡ä¿®æ”¹æ“ä½œå¦‚å¤§å°å˜æ¢ã€å›¾ç‰‡å˜ç°ã€è®¾ç½®å›¾ç‰‡é€æ˜æˆ–ä¸é€æ˜ç­‰ BufferedImage image = new BufferedImage(width, height, BufferedImage.TYPE_INT_RGB); // è·å–å›¾å½¢ä¸Šä¸‹æ–‡ Graphics g = image.getGraphics(); // ç”Ÿæˆéšæœºç±» Random random = SecureRandom.getInstanceStrong(); // è®¾å®šèƒŒæ™¯è‰² g.setColor(getRandColor(200, 250)); // ç”»é•¿æ–¹å½¢ g.fillRect(0, 0, width, height); // è®¾å®šå­—ä½“ g.setFont(new Font(ImageCodeConstant.TIMES_NEW_ROMAN, Font.PLAIN, 18)); // å†æ¬¡è®¾ç½®èƒŒæ™¯è‰²ï¼Œå®æµ‹è·Ÿå‰ä¸€æ¬¡è®¾ç½®èƒŒæ™¯è‰²æœ‰å åŠ çš„æ•ˆæœï¼Œä¼šè®©èƒŒæ™¯é¢œè‰²çœ‹èµ·æ¥æ›´å¤æ‚ g.setColor(getRandColor(160, 200)); // éšæœºäº§ç”Ÿ 168 æ¡å¹²æ‰°çº¿ï¼Œä½¿å›¾è±¡ä¸­çš„è®¤è¯ç ä¸æ˜“è¢«å…¶å®ƒç¨‹åºæ¢æµ‹åˆ° for (int i = 0; i &lt; RAND_COLOR; i++) &#123; // nextInt(n) ä¼šè¿”å› [0, n) ä¹‹é—´çš„éšæœºæ•° int x = random.nextInt(width); int y = random.nextInt(height); int xl = random.nextInt(12); int yl = random.nextInt(12); // x: çº¿æ®µèµ·ç‚¹çš„æ¨ªåæ ‡ï¼›y: çº¿æ®µèµ·ç‚¹çš„çºµåæ ‡ï¼›x + xl: çº¿æ®µç»ˆç‚¹çš„æ¨ªåæ ‡ï¼›y + yl: çº¿æ®µç»ˆç‚¹çš„çºµåæ ‡ g.drawLine(x, y, x + xl, y + yl); &#125; // å®šä¹‰éªŒè¯ç çš„å€¼ StringBuilder captchaValue = new StringBuilder(); // 4ä»£è¡¨éªŒè¯ç ä½æ•°ï¼Œå¦‚æœè¦ç”Ÿæˆæ›´å¤šä½çš„è®¤è¯ç ï¼Œåˆ™åŠ å¤§æ•°å€¼ for (int i = 0; i &lt; verifySize; ++i) &#123; captchaValue.append(mapTable[random.nextInt(mapTable.length)]); // å°†è®¤è¯ç æ˜¾ç¤ºåˆ°å›¾è±¡ä¸­ g.setColor(new Color(20 + random.nextInt(110), 20 + random.nextInt(110), 20 + random.nextInt(110))); // ç›´æ¥ç”Ÿæˆ String str = captchaValue.substring(i, i + 1); // ä½¿ç”¨æ­¤å›¾å½¢ä¸Šä¸‹æ–‡çš„å½“å‰å­—ä½“å’Œé¢œè‰²ç»˜åˆ¶ç”±æŒ‡å®š string ç»™å®šçš„æ–‡æœ¬ g.drawString(str, 13 * i + 6, 16); &#125; // é‡Šæ”¾å›¾å½¢ä¸Šä¸‹æ–‡èµ„æº g.dispose(); // ç»„è£…å›¾åƒç»“æœåŠéªŒè¯ç å€¼å¹¶è¿”å› returnMap.put(ImageCodeConstant.IMAGE, image); returnMap.put(ImageCodeConstant.CAPTCHA_VALUE, captchaValue.toString()); return returnMap; &#125; /** ç»™å®šèŒƒå›´è·å¾—éšæœºé¢œè‰² */ private static Color getRandColor(int fc, int bc) throws NoSuchAlgorithmException &#123; // åˆ›å»ºä¸€ä¸ªéšæœºæ•°ç”Ÿæˆå¯¹è±¡çš„å®ä¾‹ Random random = SecureRandom.getInstanceStrong(); // é¢œè‰²å€¼ä¸èƒ½è¶…è¿‡æœ€å¤§èŒƒå›´ fc = fc &gt; COLOR_MAX ? COLOR_MAX : fc; bc = bc &gt; COLOR_MAX ? COLOR_MAX : bc; // nextInt(n) ä¼šè¿”å› [0, n) ä¹‹é—´çš„éšæœºæ•° int r = fc + random.nextInt(bc - fc); int g = fc + random.nextInt(bc - fc); int b = fc + random.nextInt(bc - fc); // æŒ‰éšæœºç”Ÿæˆçš„ rã€gã€b å€¼è®¾ç½®é¢œè‰²å¹¶è¿”å› return new Color(r, g, b); &#125;&#125; å®ä½“ç±»å®ä½“ç±»çš„å±æ€§ä¸æ•°æ®åº“çš„å­—æ®µç›¸å¯¹åº”ã€‚ 12345678910111213141516171819202122@Datapublic class UserMybatis &#123; private static final long serialVersionUID = 1L; /** ç”¨æˆ· id */ private Integer userId; /** ç”¨æˆ·å */ private String username; /** ç”¨æˆ·å¯†ç  */ private String password; /** ç”¨æˆ·ç±»å‹ */ private String type; /** è®°å½•åˆ›å»ºæ—¶é—´ */ @DateTimeFormat(pattern = \"yyyy-MM-dd HH:mm:ss\") private Date gmtCreate; /** è®°å½•ä¿®æ”¹æ—¶é—´ */ @DateTimeFormat(pattern = \"yyyy-MM-dd HH:mm:ss\") private Date gmtModified; /** è®°å½•æ˜¯å¦åˆ é™¤ */ private Boolean isDelete;&#125; æ•°æ®æºé…ç½®æ•°æ®æºï¼š 12345678# æ•°æ®æºé…ç½®# serverTimezone=Asia/Shanghai è¿™ç§å†™æ³•ä¹Ÿå¯ä»¥# SSL è¿æ¥å¿…é¡»æ˜¾ç¤ºçš„è¿›è¡Œé…ç½®æ˜¯å¦ä½¿ç”¨ï¼Œå¦åˆ™ä¼šæŠ¥è­¦å‘Š# ä½¿ç”¨ MySQL80 æœåŠ¡ mysql-connector-java:8.0.19 ç‰ˆæœ¬çš„è¿æ¥ Jar åŒ… DriverClassï¼šcom.mysql.cj.jdbc.Driverspring.datasource.url=jdbc:mysql://localhost:3306/springboot_user?serverTimezone=GMT%2B8&amp;useUnicode=true&amp;characterEncoding=utf8&amp;useSSL=falsespring.datasource.username=rootspring.datasource.password=123456spring.datasource.driverClassName=com.mysql.cj.jdbc.Driver æµ‹è¯•æ•°æ®æºæ˜¯å¦é…ç½®æˆåŠŸï¼š 12345678910111213@RunWith(SpringRunner.class)@SpringBootTestclass JavaSpringWingoApplicationTests &#123; // æµ‹è¯• DataSource æ˜¯å¦è¢«æˆåŠŸæ³¨å…¥ @Autowired DataSource dataSource; @Test void testDataSource() &#123; System.out.println(dataSource.getClass()); // è¾“å‡ºç»“æœ class com.zaxxer.hikari.HikariDataSource Spring Boot 2 çš„é»˜è®¤è¿æ¥æ±  Hikari &#125;&#125; Druid è¿æ¥æ± 1234567891011121314&lt;!-- æ”¯æŒé˜¿é‡Œ Druid è¿æ¥æ±  --&gt;&lt;!-- æ–¹å¼ä¸€ï¼šä½¿ç”¨ Spring Boot æä¾›çš„å¯åŠ¨å™¨ --&gt;&lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;druid-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;1.1.10&lt;/version&gt;&lt;/dependency&gt;&lt;!-- æ–¹å¼äºŒï¼šæ­¤æ–¹å¼éœ€è¦è‡ªè¡Œç¼–å†™ Druid é…ç½®ç±»å¼•å…¥é…ç½® --&gt;&lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;druid&lt;/artifactId&gt; &lt;!-- &lt;version&gt;1.1.16&lt;/version&gt; æ­¤ç‰ˆæœ¬æ‰¾ä¸åˆ°ä¾èµ– --&gt; &lt;version&gt;1.1.10&lt;/version&gt;&lt;/dependency&gt; Druid é…ç½®123456789101112131415161718192021222324252627282930313233343536373839404142## Druidè¿æ¥æ± é…ç½®spring.datasource.type=com.alibaba.druid.pool.DruidDataSource## Druid è¿æ¥æ± é…ç½®spring.datasource.type=com.alibaba.druid.pool.DruidDataSource# åˆå§‹åŒ–å¤§å°ã€æœ€å°ã€æœ€å¤§spring.datasource.initialSize=1spring.datasource.minIdle=3spring.datasource.maxActive=20# è·å–è¿æ¥ç­‰å¾…è¶…æ—¶æ—¶é—´spring.datasource.maxWait=60000# é…ç½®é—´éš”å¤šä¹…æ‰è¿›è¡Œä¸€æ¬¡æ£€æµ‹ï¼Œæ£€æµ‹éœ€è¦å…³é—­çš„ç©ºé—²è¿æ¥ï¼Œå•ä½æ˜¯æ¯«ç§’spring.datasource.timeBetweenEvictionRunsMillis=30000# æŒ‡å®šè·å–è¿æ¥æ—¶è¿æ¥æ ¡éªŒçš„sqlæŸ¥è¯¢è¯­å¥spring.datasource.validationQuery=select 'x'# è·å–è¿æ¥åï¼Œç¡®å®æ˜¯å¦è¦è¿›è¡Œè¿æ¥ç©ºé—²æ—¶é—´çš„æ£€æŸ¥spring.datasource.testWhileIdle=true# è·å–è¿æ¥æ£€æµ‹spring.datasource.testOnBorrow=false# å½’è¿˜è¿æ¥æ£€æµ‹spring.datasource.testOnReturn=false# æŒ‡å®šè¿æ¥æ ¡éªŒæŸ¥è¯¢çš„è¶…æ—¶æ—¶é—´spring.datasource.validationQueryTimeout=600000# é…ç½®ä¸€ä¸ªè¿æ¥åœ¨æ± æ€»æœ€å°ç”Ÿå­˜çš„æ—¶é—´spring.datasource.minEvictableIdleTimeMillis=300000# æ‰“å¼€ PSCacheï¼Œå¹¶ä¸”æŒ‡å®šæ¯ä¸ªè¿æ¥ä¸Š Cache çš„å¤§å°spring.datasource.poolPreparedStatements=truespring.datasource.maxPoolPreparedStatementPerConnectionSize=20# é…ç½®ç›‘æ§ç»Ÿè®¡æ‹¦æˆªçš„ filterï¼Œå»æ‰åç›‘æ§ç•Œé¢ sql æ— æ³•ç»Ÿè®¡ï¼Œwall ç”¨äºé˜²ç«å¢™ï¼Œstat ç”¨äºç›‘æ§ç»Ÿè®¡spring.datasource.filters=stat,wall,slf4j# é€šè¿‡ connectProperties å±æ€§æ¥æ‰“å¼€ mergeSql åŠŸèƒ½ï¼Œæ…¢ sql è®°å½•ç­‰spring.datasource.connectionProperties=druid.stat.mergeSql=true;druid.stat.logSlowSql=true;druid.stat.slowSqlMillis=5000## druidè¿æ¥æ± ç›‘æ§ è®¿é—® URLï¼šlocahost:8080/druid # éœ€è¦è´¦å·å¯†ç æ‰èƒ½è®¿é—®æ§åˆ¶å°ï¼Œé»˜è®¤ä¸ºrootspring.datasource.druid.stat-view-servlet.login-username=adminspring.datasource.druid.stat-view-servlet.login-password=123# è®¿é—®è·¯å¾„ä¸º/druidæ—¶ï¼Œè·³è½¬åˆ°StatViewServletspring.datasource.druid.stat-view-servlet.url-pattern=/druid/*# æ˜¯å¦èƒ½å¤Ÿé‡ç½®æ•°æ®spring.datasource.druid.stat-view-servlet.reset-enable=false# æ’é™¤ä¸€äº›é™æ€èµ„æºï¼Œä»¥æé«˜æ•ˆç‡spring.datasource.druid.web-stat-filter.exclusions=*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/* å†æ¬¡æµ‹è¯•æ§åˆ¶å°è¾“å‡ºçš„ DataSource çš„ç±»å‹ä¸º com.alibaba.druid.pool.DruidDataSourceã€‚ æ•´åˆ Mybatis123456&lt;!-- æ”¯æŒ MyBatis --&gt;&lt;dependency&gt; &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt; &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;1.3.1&lt;/version&gt;&lt;/dependency&gt; é…ç½® Mapper123456## MyBatis é…ç½®# é…ç½®åˆ«å parameterType ç›´æ¥ä½¿ç”¨ç±»åmybatis.typeAliasesPackage=com.wingo.user.entitymybatis.mapperLocations=classpath:mapping/*.xml# æ‰“å° MyBatis æ‰§è¡Œçš„ SQL æ‰“å°å‡ºæ¥mybatis.configuration.log-impl=org.apache.ibatis.logging.stdout.StdOutImpl Mybatis ç¼–å†™æ•°æ®åº“æ“ä½œçš„æ–¹æ³•å¯¹åº”çš„ XxxMapper.java æ¥å£ç±»ï¼Œä»¥åŠå¯¹åº”çš„ XxxMapper.xml é…ç½®ç±»ï¼Œé…ç½®ç±»ç”¨äºç¼–å†™å…·ä½“çš„ SQL è¯­å¥ä»¥ä¾¿ Mybatis è¿›è¡ŒåŠ¨æ€å®ç°ã€‚ Mapper æ¥å£ç±»1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768// ä¹Ÿå¯é€šè¿‡åœ¨ Spring Boot è¿è¡Œç±»ä¸Šæ·»åŠ  @MapperScan() æ³¨è§£æ‰«æ@Mapper // æ‰«ææ­¤ç±»ä¸º Mybatis çš„ mapper ç±»public interface UserMybatisMapper &#123; /** * ç”¨æˆ·æ³¨å†Œ / æ·»åŠ ç”¨æˆ·ï¼šåœ¨æ•°æ®åº“ä¸­æ·»åŠ ç”¨æˆ·ä¿¡æ¯ * * @param userMybatis ç”¨æˆ· * @return */ int insert(UserMybatis userMybatis); /** * ç”¨æˆ·ç™»å½•ï¼šé€šè¿‡ç”¨æˆ·åã€ç”¨æˆ·å¯†ç å’Œç”¨æˆ·ç±»å‹æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ * * @param username ç”¨æˆ·å * @param password ç”¨æˆ·å¯†ç  * @param type ç”¨æˆ·ç±»å‹ * @return */ UserMybatis findUserMybatisByUsernameAndPasswordAndType(String username, String password, String type); /** * ç®¡ç†å‘˜ç”¨æˆ·ç®¡ç†é¡µé¢ï¼šé€šè¿‡ç”¨æˆ·ç±»å‹å’Œç”¨æˆ·çŠ¶æ€æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ * * @param type ç”¨æˆ·ç±»å‹ * @param isDelete ç”¨æˆ·çŠ¶æ€ * @return */ List&lt;UserMybatis&gt; findAllByTypeAndStatus(String type, Integer isDelete); /** * ç”¨æˆ·ä¿®æ”¹å¯†ç ï¼šé€šè¿‡ç”¨æˆ·åå’Œç”¨æˆ·ç±»ä¿®æ”¹ç”¨æˆ·å¯†ç  * * @param password ç”¨æˆ·å¯†ç  * @param username ç”¨æˆ·å * @param type ç”¨æˆ·ç±»å‹ * @param gmtModified ç”¨æˆ·ä¿®æ”¹æ—¶é—´ * @return */ int updatePasswordByUsernameAndType(String password, String username, String type, Date gmtModified); /** * æ›´æ–°ç”¨æˆ·ä¿¡æ¯ * * @param userMybatis ç”¨æˆ· * @return */ int update(UserMybatis userMybatis); /** *ç®¡ç†å‘˜åˆ é™¤ç”¨æˆ·ï¼šé€šè¿‡ç”¨æˆ·æ ‡è¯†æ›´æ–°ç”¨æˆ·çŠ¶æ€ * * @param userId ç”¨æˆ·æ ‡è¯† * @param gmtModified ç”¨æˆ·ä¿®æ”¹æ—¶é—´ * @return */ int updateStatusByUserId(Integer userId, Date gmtModified); /** * é€šè¿‡ç”¨æˆ·åå’Œç”¨æˆ·ç±»å‹æŸ¥æ‰¾ç”¨æˆ· * * @param username ç”¨æˆ·å * @param type ç”¨æˆ·ç±»å‹ * @return */ UserMybatis findUserMybatisByUsernameAndType(String username, String type);&#125; Mapper é…ç½®å®ç°123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;!DOCTYPE mapper PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"&gt;&lt;mapper namespace=\"com.wingo.user.mapper.UserMybatisMapper\"&gt; &lt;!-- ç¼–å†™å­—æ®µä¸å±æ€§çš„æ˜ å°„å…³ç³» --&gt; &lt;resultMap id=\"BaseResultMap\" type=\"com.wingo.user.entity.UserMybatis\"&gt; &lt;result column=\"user_id\" jdbcType=\"INTEGER\" property=\"userId\" /&gt; &lt;result column=\"username\" jdbcType=\"VARCHAR\" property=\"username\" /&gt; &lt;result column=\"password\" jdbcType=\"VARCHAR\" property=\"password\" /&gt; &lt;result column=\"type\" jdbcType=\"CHAR\" property=\"type\" /&gt; &lt;result column=\"gmt_create\" jdbcType=\"TIMESTAMP\" property=\"gmtCreate\" /&gt; &lt;result column=\"gmt_modified\" jdbcType=\"TIMESTAMP\" property=\"gmtModified\" /&gt; &lt;result column=\"is_delete\" jdbcType=\"BIT\" property=\"isDelete\" /&gt; &lt;/resultMap&gt; &lt;insert id=\"insert\" parameterType=\"UserMybatis\" keyProperty=\"userId\" useGeneratedKeys=\"true\"&gt; INSERT INTO user (user_id, username, password,type, gmt_create, gmt_modified, is_delete) VALUES (#&#123;userId&#125;, #&#123;username&#125;, #&#123;password&#125;, #&#123;type&#125;, #&#123;gmtCreate&#125;, #&#123;gmtModified&#125;, #&#123;isDelete&#125;) &lt;/insert&gt; &lt;select id=\"findUserMybatisByUsernameAndPasswordAndType\" resultMap=\"BaseResultMap\"&gt; SELECT user_id, username, password, type, gmt_create, gmt_modified, is_delete FROM user WHERE username = #&#123;username&#125; AND password = #&#123;password&#125; AND type = #&#123;type&#125; &lt;/select&gt; &lt;select id=\"findAllByTypeAndStatus\" resultMap=\"BaseResultMap\"&gt; SELECT user_id, username, password, type, gmt_create, gmt_modified, is_delete FROM user WHERE type = #&#123;type&#125; AND is_delete = #&#123;isDelete&#125; &lt;/select&gt; &lt;select id=\"findUserMybatisByUsernameAndType\" resultMap=\"BaseResultMap\"&gt; SELECT user_id, username, password, type, gmt_create, gmt_modified, is_delete FROM user WHERE username = #&#123;username&#125; AND type = #&#123;type&#125; &lt;/select&gt; &lt;update id=\"update\" parameterType=\"UserMybatis\"&gt; UPDATE user &lt;set&gt; &lt;if test=\"username != null\"&gt; username = #&#123;username&#125;, &lt;/if&gt; &lt;if test=\"password != null\"&gt; password = #&#123;password&#125;, &lt;/if&gt; &lt;if test=\"type != null\"&gt; type = #&#123;type&#125;, &lt;/if&gt; &lt;if test=\"gmtCreate != null\"&gt; gmt_create = #&#123;gmtCreate&#125;, &lt;/if&gt; &lt;if test=\"gmtModified != null\"&gt; gmt_modified = #&#123;gmtModified&#125;, &lt;/if&gt; &lt;if test=\"isDelete != null\"&gt; is_delete = #&#123;isDelete&#125; &lt;/if&gt; &lt;/set&gt; WHERE user_id = #&#123;userId&#125; &lt;/update&gt; &lt;update id=\"updatePasswordByUsernameAndType\"&gt; UPDATE user SET password = #&#123;password&#125;, gmt_modified = #&#123;gmtModified&#125; where username =#&#123;username&#125; and type = #&#123;type&#125; &lt;/update&gt; &lt;update id=\"updateStatusByUserId\"&gt; UPDATE user SET is_delete = true, gmt_modified = #&#123;gmtModified&#125; WHERE user_id = #&#123;userId&#125; &lt;/update&gt;&lt;/mapper&gt; ç¼–å†™æµ‹è¯•æ–¹æ³•12345678910111213141516171819202122232425262728293031323334353637383940414243444546@RunWith(SpringRunner.class)@SpringBootTestpublic class JavaSpringWingoApplicationTests &#123; @Autowired UserMybatisMapper userMybatisMapper; @Test @Rollback public void testInsert() &#123; Date date = new Date(); UserMybatis userMybatis = new UserMybatis(); userMybatis.setUsername(\"å¼ ä¸‰\"); userMybatis.setPassword(\"123456\"); userMybatis.setType(\"0\"); userMybatis.setGmtCreate(date); userMybatis.setGmtModified(date); userMybatis.setIsDelete(false); userMybatisMapper.insert(userMybatis); &#125; /** * UserMybatis userMybatis = userMybatisMapper. * findUserMybatisByUsernameAndPasswordAndType(\"å¼ ä¸‰\",\"123456\",\"0\"); * * List&lt;UserMybatis&gt; list = new ArrayList&lt;&gt;(); * list = userMybatisMapper.findAllByTypeAndStatus(\"0\",0); * Iterator&lt;UserMybatis&gt; iterable = list.iterator(); * while (iterable.hasNext())&#123; * UserMybatis userMybatis = iterable.next(); * System.out.println(userMybatis); * &#125; * * UserMybatis userMybatis = userMybatisMapper.findUserMybatisByUsernameAndType(\"å¼ ä¸‰\",\"0\"); * * UserMybatis userMybatis = new UserMybatis(); * userMybatis.setUserId(6); * userMybatis.setUsername(\"æå››\"); * int result = userMybatisMapper.update(userMybatis); * * Date date = new Date(); * userMybatisMapper.updatePasswordByUsernameAndType(\"654321\",\"æå››\",\"0\",date); * * Date date = new Date(); * userMybatisMapper.updateStatusByUserId(6,date); */&#125; ä¸šåŠ¡é€»è¾‘å±‚Mybatis ç‰ˆæœ¬ç¼–å†™é¡¹ç›®åœºæ™¯åŠŸèƒ½çš„ä¸šåŠ¡é€»è¾‘ï¼šæ¥æ”¶å‰ç«¯ä¼ æ¥çš„ä¿¡æ¯æ‰€å°ä½çš„ DTOï¼Œç„¶åè°ƒç”¨ DAO è¿›è¡Œä¸šåŠ¡é€»è¾‘çš„ç¼–å†™ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173@Service(\"userServiceMybatisImpl\")public class UserServiceMybatisImpl implements UserService &#123; private final UserMybatisMapper userMybatisMapper; public UserServiceMybatisImpl(UserMybatisMapper userMybatisMapper) &#123; this.userMybatisMapper = userMybatisMapper; &#125; /** * æ£€æŸ¥æ­¤ç”¨æˆ·æ˜¯å¦å·²ç»å­˜åœ¨ * * @param username ç”¨æˆ·å * @return */ private boolean checkUserDuplicate(String username)&#123; // å®šä¹‰é»˜è®¤è¿”å› false boolean isDuplicate = false; UserMybatis userMybatis = userMybatisMapper.findUserMybatisByUsernameAndType(username, UserTypeConstant.ORDINARY); // è‹¥æ­¤ç”¨æˆ·å­˜åœ¨ï¼Œåˆ™è¿”å› true if(userMybatis!=null)&#123; isDuplicate = true; &#125; return isDuplicate; &#125; private UserMybatis buildUserMybatis(String username, String password)&#123; Date data = new Date(); // åˆ›å»ºç”¨æˆ·å®ä½“å¯¹è±¡å¹¶è¿›è¡Œèµ‹å€¼ UserMybatis userMybatis = new UserMybatis(); userMybatis.setUsername(username); userMybatis.setPassword(Md5Util.md5(password)); userMybatis.setType(UserTypeConstant.ORDINARY); userMybatis.setGmtCreate(data); userMybatis.setGmtModified(data); userMybatis.setIsDelete(false); return userMybatis; &#125; /** ç”¨æˆ·æ³¨å†Œ */ @Override @Transactional(rollbackFor = Exception.class) public ResponseVO register(RegisterDTO registerDTO) &#123; // å®šä¹‰è¿”å›å¯¹è±¡ ResponseVO responseVO = new ResponseVO(); // æ£€æŸ¥æ­¤ç”¨æˆ·æ˜¯å¦æ˜¯å¦å·²ç»å­˜åœ¨ if(checkUserDuplicate(registerDTO.getUsername()))&#123; // ç»„è£…é”™è¯¯è¿”å›å¯¹è±¡ responseVO.fail(\"ç”¨æˆ·åé‡å¤ï¼Œè¯·é‡æ–°æ³¨å†Œï¼\"); // è¿”å›é”™è¯¯ä»£ç åŠé”™è¯¯ä¿¡æ¯ return responseVO; &#125; // åˆ›å»ºç”¨æˆ·å®ä½“å¯¹è±¡å¹¶è¿›è¡Œèµ‹å€¼ UserMybatis userMybatis = buildUserMybatis(registerDTO.getUsername(), registerDTO.getPassword()); // ä¿å­˜æ•°æ®åˆ°æ•°æ®åº“ userMybatisMapper.insert(userMybatis); // ç»„è£…æˆåŠŸè¿”å›å¯¹è±¡ responseVO.success(\"æ­å–œæ‚¨ï¼Œæ³¨å†ŒæˆåŠŸï¼è¯·ç™»å½•\"); return responseVO; &#125; /** ç”¨æˆ·ç™»å½• */ @Override public ResponseVO login(LoginDTO loginDTO) &#123; ResponseVO responseVO = new ResponseVO(); UserMybatis userMybatis = userMybatisMapper.findUserMybatisByUsernameAndPasswordAndType (loginDTO.getUsername(), Md5Util.md5(loginDTO.getPassword()), loginDTO.getType()); if(userMybatis == null)&#123; responseVO.fail(\"ç™»å½•å¤±è´¥ï¼Œç”¨æˆ·ä¸å­˜åœ¨ã€å·²åˆ é™¤æˆ–è€…ç”¨æˆ·åã€å¯†ç æˆ–ç±»å‹é€‰æ‹©é”™è¯¯ï¼\"); return responseVO; &#125; responseVO.success(\"ç™»å½•æˆåŠŸï¼\"); // æ„å»ºè¿”å›çš„ç”¨æˆ·ä¿¡æ¯ UserVO userVO = new UserVO(); userVO.setUsername(loginDTO.getUsername()); userVO.setType(loginDTO.getType()); responseVO.setData(\"userVO\", userVO); return responseVO; &#125; /** ç®¡ç†å‘˜æ·»åŠ ç”¨æˆ· */ @Override @Transactional(rollbackFor = Exception.class) public ResponseVO add(AddDTO addDTO) &#123; // å®šä¹‰è¿”å›å¯¹è±¡ ResponseVO responseVO = new ResponseVO(); // æ£€æŸ¥æ­¤ç”¨æˆ·æ˜¯å¦æ˜¯å¦å·²ç»å­˜åœ¨ if(checkUserDuplicate(addDTO.getUsername()))&#123; // ç»„è£…é”™è¯¯è¿”å›å¯¹è±¡ responseVO.fail(\"ç”¨æˆ·åé‡å¤ï¼Œè¯·é‡æ–°æ·»åŠ ï¼\"); // è¿”å›é”™è¯¯ä»£ç åŠé”™è¯¯ä¿¡æ¯ return responseVO; &#125; // åˆ›å»ºç”¨æˆ·å®ä½“å¯¹è±¡å¹¶è¿›è¡Œèµ‹å€¼ UserMybatis userMybatis = buildUserMybatis(addDTO.getUsername(), addDTO.getPassword()); // ä¿å­˜æ•°æ®åˆ°æ•°æ®åº“ userMybatisMapper.insert(userMybatis); // ç»„è£…æˆåŠŸè¿”å›å¯¹è±¡ responseVO.success(\"æ·»åŠ æˆåŠŸï¼\"); return responseVO; &#125; /** ç®¡ç†å‘˜æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨ */ @Override public ResponseVO view() &#123; ResponseVO responseVO = new ResponseVO(); // å®šä¹‰è¿”å›çš„ç»“æœé›†å¯¹è±¡ï¼Œè¿™ç§å®šä¹‰æ–¹å¼æ˜¯å¯¹è±¡å½¢å¼çš„é›†åˆ List&lt;ViewVO&gt; userList = new ArrayList&lt;&gt;(); List&lt;UserMybatis&gt; userMybatisList = userMybatisMapper.findAllByTypeAndStatus(UserTypeConstant.ORDINARY, false); if(userMybatisList == null)&#123; responseVO.fail(\"è¯·æ±‚ç”¨æˆ·åˆ—è¡¨å¤±è´¥ï¼\"); return responseVO; &#125; for(UserMybatis userMybatis : userMybatisList)&#123; // åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡æ¥å­˜å‚¨æŸ¥è¯¢å‡ºçš„ä¸€æ¡æ¡è®°å½• ViewVO viewVO = new ViewVO(); // å¯¹å¯¹è±¡è¿›è¡Œèµ‹å€¼ viewVO.setUserId(userMybatis.getUserId()); viewVO.setUsername(userMybatis.getUsername()); viewVO.setType(userMybatis.getType()); viewVO.setGtmCreate(userMybatis.getGmtCreate()); // å°†å¯¹è±¡æ”¾å…¥é›†åˆä¸­ userList.add(viewVO); &#125; responseVO.success(\"è¯·æ±‚ç”¨æˆ·åˆ—è¡¨æˆåŠŸï¼\"); responseVO.setData(\"viewVO\", userList); return responseVO; &#125; /** ç”¨æˆ·ä¿®æ”¹å¯†ç  */ @Override @Transactional(rollbackFor = Exception.class) public ResponseVO modify(ModifyDTO modifyDTO) &#123; ResponseVO responseVO = new ResponseVO(); // åˆ¤æ–­æ˜¯å¦æœ‰æ–°å¯†ç ä¸”æ–°æ—§å¯†ç æ˜¯å¦ä¸€è‡´ if(modifyDTO.getNewPassword() != null &amp;&amp; modifyDTO.getConfirmNewPassword() != null &amp;&amp; !modifyDTO.getConfirmNewPassword().equals(modifyDTO.getNewPassword()))&#123; responseVO.fail(\"æ–°å¯†ç å’Œç¡®è®¤æ–°å¯†ç ä¸ä¸€è‡´ï¼Œè¯·æ£€æŸ¥ï¼\"); return responseVO; &#125; // åˆ¤æ–­ç”¨æˆ·çš„åŸå¯†ç æ˜¯å¦æ­£ç¡® UserMybatis userMybatis = userMybatisMapper.findUserMybatisByUsernameAndPasswordAndType( modifyDTO.getUsername(), Md5Util.md5(modifyDTO.getPassword()), modifyDTO.getType() ); if(userMybatis == null)&#123; responseVO.fail(\"ç”¨æˆ·åŸå¯†ç ä¸æ­£ç¡®ï¼Œè¯·æ£€æŸ¥ï¼\"); return responseVO; &#125; Date date = new Date(); // ç¡®è®¤æ»¡è¶³ä¿®æ”¹æ¡ä»¶åå¯¹ç”¨æˆ·ä¿¡æ¯è¿›è¡Œæ›´æ–° userMybatis.setPassword(Md5Util.md5(modifyDTO.getNewPassword())); userMybatis.setGmtModified(date); userMybatisMapper.update(userMybatis); responseVO.success(\"å¯†ç ä¿®æ”¹æˆåŠŸï¼\"); return responseVO; &#125; /** åˆ é™¤ç”¨æˆ· */ @Override @Transactional(rollbackFor = Exception.class) public ResponseVO delete(DeleteDTO deleteDTO) &#123; ResponseVO responseVO = new ResponseVO(); Date date = new Date(); int deleteResult = userMybatisMapper.updateStatusByUserId(deleteDTO.getUerId(),date); if(deleteResult != 1)&#123; responseVO.fail(\"åˆ é™¤å¤±è´¥ï¼Œæ²¡æœ‰æ›´æ–°åˆ°æˆ–è€…æ›´æ–°äº†å¤šæ¡è®°å½•ï¼\"); return responseVO; &#125; responseVO.success(\"ç”¨æˆ·åˆ é™¤æˆåŠŸï¼\"); return responseVO; &#125;&#125; æµ‹è¯•ç”¨ä¾‹1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071@RunWith(SpringRunner.class)@SpringBootTestpublic class JavaSpringWingoApplicationTests &#123; @Resource(name = \"userServiceMybatisImpl\") UserService userService; /** Md5Util è¾“å‡º */ @Test public void testMd5()&#123; System.out.println(Md5Util.md5(\"e10adc3949ba59abbe56e057f20f883e\")); &#125; /** æµ‹è¯•æ³¨å†Œæ¥å£ */ @Test @Rollback public void testRegister() &#123; // æ„é€ æ³¨å†Œçš„æµ‹è¯•æ•°æ® RegisterDTO registerDTO = new RegisterDTO(); registerDTO.setUsername(\"Jay\"); registerDTO.setPassword(\"123456\"); // å¤„ç†ä¸šåŠ¡ ResponseVO responseVO = userService.register(registerDTO); // æµ‹è¯•æ–­è¨€ assertEquals(ResponseConstant.SUCCESS, responseVO.get(\"code\")); &#125; /** æµ‹è¯•ç™»å½•æ¥å£ */ @Test public void testLogin()&#123; LoginDTO loginDTO = new LoginDTO(); loginDTO.setUsername(\"Tom\"); loginDTO.setPassword(\"123456\"); loginDTO.setType(0); ResponseVO responseVO = userService.login(loginDTO); assertEquals(ResponseConstant.SUCCESS, responseVO.get(\"code\")); &#125; /** æµ‹è¯•æ·»åŠ æ¥å£ */ @Test @Rollback public void testAdd()&#123; AddDTO addDTO = new AddDTO(); addDTO.setUsername(\"Tim\"); addDTO.setPassword(\"123456\"); ResponseVO responseVO = userService.add(addDTO); assertEquals(ResponseConstant.SUCCESS, responseVO.get(\"code\")); &#125; /** æµ‹è¯•ç”¨æˆ·åˆ—è¡¨æ¥å£ */ @Test public void testView()&#123; ResponseVO responseVO = userService.view(); System.out.println(responseVO); assertEquals(ResponseConstant.SUCCESS, responseVO.get(\"code\")); &#125; /** æµ‹è¯•ä¿®æ”¹å¯†ç æ¥å£*/ @Test @Rollback public void testModify()&#123; ModifyDTO modifyDTO = new ModifyDTO(); modifyDTO.setUsername(\"Jay\"); modifyDTO.setType(0); modifyDTO.setPassword(\"123456\"); modifyDTO.setNewPassword(\"654321\"); modifyDTO.setConfirmNewPassword(\"654321\"); ResponseVO responseVO = userService.modify(modifyDTO); assertEquals(ResponseConstant.SUCCESS, responseVO.get(\"code\")); &#125;&#125; æ§åˆ¶å±‚Swagger æ•´åˆç”¨äºæµè§ˆå™¨è¯·æ±‚æµ‹è¯•ã€‚ ä¹Ÿå¯é‡‡ç”¨ Spring Boot æä¾›çš„ swagger çš„ staterï¼Œåˆ©ç”¨å¯åŠ¨å™¨çš„æ–¹å¼æ·»åŠ ä¾èµ–ï¼Œå¯ä»¥ç›´åœ¨ Spring Boot çš„é…ç½®æ–‡ä»¶ä¸­é…ç½® swagger çš„é…ç½®ä¿¡æ¯ã€‚ 1234567891011&lt;!-- æ·»åŠ  Swagger çš„æ”¯æŒ --&gt;&lt;dependency&gt; &lt;groupId&gt;io.springfox&lt;/groupId&gt; &lt;artifactId&gt;springfox-swagger2&lt;/artifactId&gt; &lt;version&gt;2.9.2&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;io.springfox&lt;/groupId&gt; &lt;artifactId&gt;springfox-swagger-ui&lt;/artifactId&gt; &lt;version&gt;2.9.2&lt;/version&gt;&lt;/dependency&gt; é…ç½®ç±» 1234567891011121314151617@Configuration@EnableSwagger2public class SwaggerConfig &#123; @Bean public Docket createRestApi() &#123; return new Docket(DocumentationType.SWAGGER_2).apiInfo(apiInfo()) .select() .apis(RequestHandlerSelectors.basePackage(\"com.wingo.user.controller\")) .paths(PathSelectors.any()).build(); &#125; private ApiInfo apiInfo() &#123; return new ApiInfoBuilder().title(\"Swagger RESTful APIs\") .description(\"Swagger API æœåŠ¡\") .build(); &#125;&#125; ä»£ç ç¼–å†™ Model modelï¼šSpring MVC æä¾›äº†ä¸€ä¸ªModelç”¨äºæš´éœ²åç«¯ä¼ é€’ç»™é¡µé¢çš„ä¿¡æ¯ï¼Œé€šè¿‡addAttribute(K, V)æ–¹æ³•æ·»åŠ æ•°æ®ï¼Œå¹¶ä¸”åœ¨å‰ç«¯çš„æ¨¡æ¿å¼•æ“é¡µé¢é€šè¿‡${K}å–å¾—å¯¹åº”çš„Vï¼› HttpServletResponse httpServletResponseï¼šencodeRedirectURL(Url)æ–¹æ³•è¿›è¡Œé¡µé¢è·³è½¬ï¼Œè·³è½¬çš„åŒæ—¶æºå¸¦åŸŸä¸­çš„ä¿¡æ¯ï¼› HttpSession httpSessionï¼šsetAttribute(K, V)æ–¹æ³•åœ¨ Session åŸŸä¸­æ·»åŠ ä¿¡æ¯ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201@Controller@Slf4jpublic class UserController &#123; /** æ³¨å…¥ UserService */ @Resource(name = \"userServiceMybatisImpl\") private UserService userService; /** å¤„ç†ç”¨æˆ·æ³¨å†Œçš„è¯·æ±‚ */ @ApiOperation(\"ç”¨æˆ·æ³¨å†Œæ¥å£\") @PostMapping(value = \"/register\") public String register(Model model, @Valid @ModelAttribute(value = \"registerDTO\") RegisterDTO registerDTO, HttpServletResponse httpServletResponse) &#123; ResponseVO responseVO = userService.register(registerDTO); model.addAttribute(ResponseConstant.RESPONSE_VO, responseVO); if (ResponseConstant.SUCCESS.equals(responseVO.get(ResponseConstant.CODE))) &#123; // æ³¨å†ŒæˆåŠŸï¼Œé‡å®šå‘åˆ°å‰ç«¯ç™»å½•é¡µé¢ login.htmlï¼Œå¹¶ä¸”æºå¸¦æ•°æ®è¿‡å» return httpServletResponse.encodeRedirectURL(UrlConstant.LOGIN); &#125; // æ³¨å†Œå¤±è´¥ï¼Œè·³è½¬åˆ°æ³¨å†Œé¡µé¢ï¼Œå¹¶å°†å¤±è´¥çš„ä¿¡æ¯è¿”å› return httpServletResponse.encodeRedirectURL(UrlConstant.REGISTER); &#125; /** * ç”Ÿæˆå›¾å½¢éªŒè¯ç  * * @throws NoSuchAlgorithmException */ @ApiIgnore @GetMapping(value = \"/imageCode\") public String imageCode(HttpServletRequest request, HttpServletResponse response) throws IOException, NoSuchAlgorithmException &#123; OutputStream os = response.getOutputStream(); // ç”ŸæˆéªŒè¯ç  Map&lt;String, Object&gt; map = ImageCodeUtil.getImageCode(60, 20, 4); // æ”¾å…¥å®¢æˆ·ç«¯çš„ Session å¯¹è±¡ä¸­ request.getSession().setAttribute(ImageCodeConstant.SIMPLE_CAPTCHA, map.get(ImageCodeConstant.CAPTCHA_VALUE).toString().toLowerCase()); // è®¾ç½®éªŒè¯ç çš„ç”Ÿæˆæ—¶é—´ï¼Œå¹¶æ”¾å…¥å®¢æˆ·ç«¯ Session å¯¹è±¡ä¸­ request.getSession().setAttribute(ImageCodeConstant.CODE_TIME, System.currentTimeMillis()); // å°†ç”Ÿæˆçš„éªŒè¯ç å›¾ç‰‡å†™åˆ°å›¾ç‰‡è¾“å‡ºæµ try &#123; ImageIO.write((BufferedImage) map.get(ImageCodeConstant.IMAGE), ImageCodeConstant.JPEG, os); &#125; catch (IOException e) &#123; log.error(\"å›¾å½¢éªŒè¯ç ç”Ÿæˆå¼‚å¸¸\"); &#125; return null; &#125; /** å¤„ç†ç”¨æˆ·çš„ç™»å½•è¯·æ±‚ */ @ApiIgnore @PostMapping(value = \"/login\") public String login(Model model, @Valid @ModelAttribute(value = \"loginDTO\") LoginDTO loginDTO, HttpServletResponse httpServletResponse, HttpSession httpSession) &#123; ResponseVO responseVO = new ResponseVO(); // å–å¾—ç”¨æˆ·å¡«å†™çš„éªŒè¯ç  String checkCode = loginDTO.getCheckCode(); // ä» Session ä¸­å–å¾—å­˜å…¥çš„éªŒè¯ç ä¿¡æ¯ Object sessionImageCode = httpSession.getAttribute(ImageCodeConstant.SIMPLE_CAPTCHA); // è·å–éªŒè¯ç ä¿¡æ¯å¤±è´¥ if(sessionImageCode == null)&#123; responseVO.fail(\"è¯·å¡«å†™éªŒè¯ç \"); model.addAttribute(ResponseConstant.RESPONSE_VO, responseVO); return httpServletResponse.encodeRedirectURL(UrlConstant.LOGIN); &#125; String code = sessionImageCode.toString(); // æ£€æµ‹éªŒè¯ç  Date date = new Date(); Long codeTime = Long.valueOf(httpSession.getAttribute(ImageCodeConstant.CODE_TIME) + \"\"); // éªŒè¯ç æ˜¯å¦å¡«å†™æ­£ç¡® if (StringUtils.isBlank(checkCode) || StringUtils.isBlank(code) || !(checkCode.equalsIgnoreCase(code))) &#123; responseVO.fail(\"éªŒè¯ç ä¸ä¸€è‡´\"); model.addAttribute(ResponseConstant.RESPONSE_VO, responseVO); return httpServletResponse.encodeRedirectURL(UrlConstant.LOGIN); &#125; // éªŒè¯ç æ˜¯å¦è¿‡æœŸï¼ˆæœ‰æ•ˆæœŸä¸º 5 åˆ†é’Ÿï¼‰ else if ((date.getTime() - codeTime) / ImageCodeConstant.MILLISECOND_CONVERSION / ImageCodeConstant.MINUTE_CONVERSION &gt; ImageCodeConstant.CAPTCHA_EXPIRY_TIME) &#123; responseVO.fail(\"éªŒè¯ç å·²è¿‡æœŸ\"); model.addAttribute(ResponseConstant.RESPONSE_VO, responseVO); return httpServletResponse.encodeRedirectURL(UrlConstant.LOGIN); &#125; // å¤„ç†ç”¨æˆ·ç™»å½•ä¸šåŠ¡ responseVO = userService.login(loginDTO); // å°†ç»“æœæ”¾å…¥ model ä¸­ï¼Œåœ¨æ¨¡æ¿ä¸­å¯ä»¥å–åˆ° model ä¸­çš„å€¼ // è¿™é‡Œå°±æ˜¯äº¤äº’çš„ä¸€ä¸ªé‡è¦åœ°æ–¹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ¨¡æ¿ä¸­é€šè¿‡è¿™äº›å±æ€§å€¼è®¿é—®åˆ°æ•°æ® model.addAttribute(ResponseConstant.RESPONSE_VO, responseVO); // è®¾ç½®ç™»å½• sessionï¼Œæ¨¡ç‰ˆå¼•æ“ä½¿ç”¨ httpSession.setAttribute(UserConstant.USERNAME, loginDTO.getUsername()); httpSession.setAttribute(UserConstant.TYPE, loginDTO.getType()); // å°†ç±»å‹ç è½¬æ¢ä¸ºä¸­æ–‡è¯´æ˜ httpSession.setAttribute(UserConstant.TYPE_NAME, UserTypeConstant.typeToDesc(loginDTO.getType())); // ç»„è£…ç»“æœè¿”å› if (responseVO == null || !ResponseConstant.SUCCESS.equals(responseVO.get(ResponseConstant.CODE))) &#123; // ç™»å½•å¤±è´¥åˆ™è·³è½¬åˆ°å‰ç«¯ç™»å½•é¡µé¢ login.html return httpServletResponse.encodeRedirectURL(UrlConstant.LOGIN); &#125; // ç™»å½•æˆåŠŸé‡å®šå‘åˆ°å‰ç«¯é¦–é¡µ index.htmlï¼Œå¹¶ä¸”æºå¸¦æ•°æ®è¿‡å» return httpServletResponse.encodeRedirectURL(UrlConstant.INDEX); &#125; /** å¤„ç†æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨çš„è¯·æ±‚ */ @ApiIgnore @GetMapping(value = \"/users\") public String users(Model model, HttpServletResponse httpServletResponse) &#123; // å¤„ç†ç”¨æˆ·åˆ—è¡¨æŸ¥çœ‹ä¸šåŠ¡ ResponseVO responseVO = userService.view(); model.addAttribute(ResponseConstant.RESPONSE_VO, responseVO); // å¼€å§‹é‡å®šå‘å‰ç«¯ç”¨æˆ·åˆ—è¡¨ä¹Ÿ view.htmlï¼Œæºå¸¦æ•°æ®è¿‡å»äº†ã€‚ return httpServletResponse.encodeRedirectURL(UrlConstant.VIEW); &#125; /** å¤„ç†æ–°å¢ç”¨æˆ·çš„è¯·æ±‚ */ @ApiOperation(\"ç”¨æˆ·æ–°å¢æ¥å£\") @PostMapping(value = \"/user\") public String user(Model model, @Valid @ModelAttribute(value = \"addDTO\") AddDTO addDTO, HttpServletResponse httpServletResponse) &#123; // å¤„ç†æ–°å¢ç”¨æˆ·ä¸šåŠ¡ ResponseVO responseVO = userService.add(addDTO); // å°†å¤„ç†ç»“æœå†™å…¥åˆ°è¿”å›å¯¹è±¡ä¸­ model.addAttribute(ResponseConstant.RESPONSE_VO, responseVO); // ç”¨æˆ·æ·»åŠ å¤±è´¥ï¼Œé‡å®šå‘åˆ°å‰ç«¯é¡µé¢ user.html if (responseVO == null || !ResponseConstant.SUCCESS.equals(responseVO.get(ResponseConstant.CODE)))&#123; return httpServletResponse.encodeRedirectURL(UrlConstant.USER); &#125; // å¤„ç†æˆåŠŸ responseVO = userService.view(); model.addAttribute(ResponseConstant.RESPONSE_VO, responseVO); // å¼€å§‹é‡å®šå‘ï¼Œæºå¸¦æ•°æ®è¿‡å» return httpServletResponse.encodeRedirectURL(UrlConstant.VIEW); &#125; /** åˆ é™¤ç”¨æˆ· */ @ApiOperation(\"åˆ é™¤ç”¨æˆ·æ¥å£\") @GetMapping(value = \"/delete\") public String delete(Model model, @Valid @ModelAttribute(value = \"deleteDTO\") DeleteDTO deleteDTO, HttpServletResponse httpServletResponse) &#123; // å¤„ç†é€»è¾‘åˆ é™¤ç”¨æˆ·ä¸šåŠ¡ ResponseVO responseVO = userService.delete(deleteDTO); // åˆ é™¤å¤±è´¥è¿”å›é”™è¯¯ä¿¡æ¯ if(responseVO.get(ResponseConstant.CODE).equals(ResponseConstant.FAIL))&#123; model.addAttribute(ResponseConstant.RESPONSE_VO, responseVO); return httpServletResponse.encodeRedirectURL(UrlConstant.VIEW); &#125; // åˆ é™¤æˆåŠŸåå†æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨æ•°æ®ï¼Œè¿”å›åˆ é™¤åçš„æœ€æ–°ç”¨æˆ·åˆ—è¡¨æ•°æ® responseVO = userService.view(); if (responseVO != null) &#123; model.addAttribute(ResponseConstant.RESPONSE_VO, responseVO); &#125; // é€»è¾‘åˆ é™¤ç”¨æˆ·åï¼Œè·³è½¬åˆ°ç”¨æˆ·å‰ç«¯åˆ—è¡¨é¡µ view.jsp return httpServletResponse.encodeRedirectURL(UrlConstant.VIEW); &#125; /** å¤„ç†ç”¨æˆ·ä¿¡æ¯ä¿®æ”¹çš„è¯·æ±‚ */ @ApiIgnore @PostMapping(value = \"/modify\") public String toModify(Model model, @Valid @ModelAttribute(value = \"modifyDTO\") ModifyDTO modifyDTO, HttpServletResponse httpServletResponse, HttpSession httpSession) &#123; // ä» Session ä¸­å–å¾—ç”¨æˆ·åå­—åŠç±»å‹ String strUsername = httpSession.getAttribute(UserConstant.USERNAME).toString(); String strType = httpSession.getAttribute(UserConstant.TYPE).toString(); modifyDTO.setUsername(strUsername); modifyDTO.setType(strType); // å¤„ç†ç”¨æˆ·ä¿¡æ¯ä¿®æ”¹ä¸šåŠ¡ ResponseVO responseVO = userService.modify(modifyDTO); // å°†ç»“æœæ”¾å…¥ Model ä¸­ï¼Œåœ¨æ¨¡æ¿ä¸­å¯ä»¥å–åˆ° Model ä¸­çš„å€¼ model.addAttribute(ResponseConstant.RESPONSE_VO, responseVO); if (responseVO == null || !ResponseConstant.SUCCESS.equals(responseVO.get(ResponseConstant.CODE))) &#123; // ä¿®æ”¹å¤±è´¥æ—¶ï¼Œç»§ç»­é‡å®šå‘åˆ°å‰ç«¯ç”¨æˆ·ä¿¡æ¯ä¿®æ”¹é¡µé¢ modify.html return httpServletResponse.encodeRedirectURL(UrlConstant.MODIFY); &#125; // å¯†ç ä¿®æ”¹æˆåŠŸï¼Œä» Session ä¸­åˆ é™¤ user å±æ€§ï¼Œç”¨æˆ·é€€å‡ºç™»å½• httpSession.removeAttribute(UserConstant.USERNAME); httpSession.removeAttribute(UserConstant.TYPE); httpSession.removeAttribute(UserConstant.TYPE_NAME); // å¼€å§‹é‡å®šå‘å‰ç«¯ç™»å½•é¡µé¢ login.htmlï¼Œå¹¶ä¸”æºå¸¦æ•°æ®è¿‡å» return httpServletResponse.encodeRedirectURL(UrlConstant.LOGIN); &#125; /** æ³¨é”€ç™»å½• */ @ApiIgnore @GetMapping(value = \"/loginOut\") public String loginOut(HttpSession httpSession, HttpServletResponse httpServletResponse) &#123; // ä» Session ä¸­åˆ é™¤ user å±æ€§ï¼Œç”¨æˆ·é€€å‡ºç™»å½• httpSession.removeAttribute(UserConstant.USERNAME); httpSession.removeAttribute(UserConstant.TYPE); httpSession.removeAttribute(UserConstant.TYPE_NAME); // å¼€å§‹é‡å®šå‘åˆ°å‰ç«¯é¡µé¢ login.html return httpServletResponse.encodeRedirectURL(UrlConstant.LOGIN); &#125; /** å¤„ç† Get:/index è¯·æ±‚ */ @ApiIgnore @GetMapping(value=\"/index\") public String index(HttpServletResponse httpServletResponse)&#123; // é‡å®šå‘åˆ°å‰ç«¯é¡µé¢ index.html return httpServletResponse.encodeRedirectURL(UrlConstant.INDEX); &#125; // çœç•¥ä½™ä¸‹é¡µé¢è·³æ–¹æ³•&#125; Thymeleafå¼•å…¥ä¾èµ–ï¼š 12345&lt;!-- æ”¯æŒ Thymeleaf --&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;&lt;/dependency&gt; é…ç½® Thymeleafï¼š 1234567## Thymeleaf é…ç½®spring.thymeleaf.prefix=classpath:/templatesspring.thymeleaf.suffix=.htmlspring.thymeleaf.mode=HTMLspring.thymeleaf.servlet.content-type=text/htmlspring.thymeleaf.cache=falsespring.thymeleaf.enabled=true login.html1234567891011121314151617181920212223242526272829303132333435363738&lt;!DOCTYPE html&gt;&lt;html xmlns:th=\"http://www.thymeleaf.org\"&gt; &lt;head&gt; &lt;meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"&gt; &lt;title&gt;ç™»å½•&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;p th:if=\"$&#123;responseVO != null &amp;&amp; responseVO.get('message') != null&#125;\" th:text=\"$&#123;responseVO.get('message')&#125;\"&gt;&lt;/p&gt; &lt;form th:action=\"@&#123;/login&#125;\" th:object=\"$&#123;loginDTO&#125;\" method=\"post\"&gt; &lt;div style=\"height: 27px\"&gt; &lt;label for=\"username\"&gt;ç”¨æˆ·å: &lt;/label&gt; &lt;input type=\"text\" name=\"username\" id=\"username\" placeholder=\"ç”¨æˆ·å\" th:value=\"$&#123;registerDTO !=null &amp;&amp; registerDTO.username != null&#125; ? $&#123;registerDTO.username&#125; : ''\" /&gt; &lt;/div&gt; &lt;div style=\"height: 27px\"&gt; &lt;label for=\"password\"&gt;å¯†ç : &lt;/label&gt; &lt;input type=\"password\" name=\"password\" id=\"password\" placeholder=\"å¯†ç \"/&gt; &lt;/div&gt; &lt;div style=\"height: 27px\"&gt; &lt;label for=\"checkCode\" class=\"green\"&gt;éªŒè¯ç : &lt;/label&gt; &lt;input id=\"checkCode\" name=\"checkCode\" class=\"checkCode\" type=\"text\" placeholder=\"éªŒè¯ç \" /&gt; &lt;img style=\"cursor: pointer; margin-left: 3px;\" th:src=\"@&#123;/imageCode&#125;\" onclick=\"this.src=this.src + '?' + new Date().valueOf();\" id=\"validateImg\" alt=\"éªŒè¯ç \" class=\"codePic\" title=\"éªŒè¯ç ã€‚ç‚¹å‡»æ­¤å¤„æ›´æ–°éªŒè¯ç ã€‚\" /&gt; &lt;/div&gt; &lt;div style=\"height: 27px\"&gt; &lt;label for=\"type\"&gt;ç”¨æˆ·ç±»å‹: &lt;/label&gt; &lt;select id=\"type\" name=\"type\"&gt; &lt;option type=\"number\" value=\"0\" &gt;æ™®é€šç”¨æˆ·&lt;/option&gt; &lt;option type=\"number\" value=\"1\" &gt;ç®¡ç†å‘˜ç”¨æˆ·&lt;/option&gt; &lt;/select&gt; &lt;/div&gt; &lt;input type=\"submit\" value=\"ç™»å½•\"&gt; &lt;/form&gt; &lt;/body&gt;&lt;/html&gt; index.html1234567891011121314151617181920&lt;!DOCTYPE html&gt;&lt;html xmlns:th=\"http://www.thymeleaf.org\"&gt;&lt;head&gt;&lt;meta charset=\"UTF-8\"&gt;&lt;title&gt;ç™»å½•åçš„é¦–é¡µ&lt;/title&gt;&lt;/head&gt;&lt;body&gt; &lt;h4&gt; æ¬¢è¿æ‚¨ï¼š&lt;span style=\"color: red\" th:text=\"$&#123;session.username&#125;?$&#123;session.username&#125;:'ï¼ˆæ‚¨æœªç™»å½•ï¼‰'\"&gt;&lt;/span&gt;, ç”¨æˆ·èº«ä»½æ˜¯ï¼š&lt;span style=\"color: red\" th:text=\"$&#123;session.typeName&#125;?$&#123;session.typeName&#125;:'ï¼ˆæ‚¨æœªç™»å½•ï¼‰'\" &gt;&lt;/span&gt; &lt;/h4&gt; &lt;th:block th:if=\"$&#123;session.username != null&#125;\"&gt; &lt;a th:href=\"@&#123;/users&#125;\" th:if=\"$&#123;session.typeName eq 'ç®¡ç†å‘˜'&#125;\"&gt;æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨&lt;/a&gt; &lt;a th:href=\"@&#123;/user&#125;\" th:if=\"$&#123;session.typeName eq 'ç®¡ç†å‘˜'&#125; \"&gt;æ·»åŠ ç”¨æˆ·&lt;/a&gt; &lt;a th:href=\"@&#123;/modify&#125;\"&gt;ä¿®æ”¹å¯†ç &lt;/a&gt; &lt;a th:href=\"@&#123;/loginOut&#125;\"&gt;æ³¨é”€ç™»å½•&lt;/a&gt; &lt;/th:block&gt;&lt;/body&gt;&lt;/html&gt; modify.html123456789101112131415161718192021222324&lt;!DOCTYPE html&gt;&lt;html xmlns:th=\"http://www.thymeleaf.org\"&gt;&lt;head&gt;&lt;meta charset=\"UTF-8\"&gt;&lt;title&gt;ä¿®æ”¹å¯†ç &lt;/title&gt;&lt;/head&gt;&lt;body&gt; &lt;p th:if=\"$&#123;responseVO != null &amp;&amp; responseVO.get('message') != null&#125;\" th:text=\"$&#123;responseVO.get('message')&#125;\"&gt;&lt;/p&gt; &lt;th:block th:if=\"$&#123;session.username != null&#125;\"&gt; &lt;form th:action=\"@&#123;/modify&#125;\" th:object=\"$&#123;modifyDTO&#125;\" method=\"post\"&gt; &lt;label for=\"password\"&gt;åŸå¯†ç :&lt;/label&gt; &lt;input type=\"password\" name=\"password\" id=\"password\" /&gt; &lt;br /&gt; &lt;label for=\"newPassword\"&gt;æ–°å¯†ç :&lt;/label&gt; &lt;input type=\"password\" name=\"newPassword\" id=\"newPassword\" /&gt; &lt;br /&gt; &lt;label for=\"confirmNewPassword\"&gt;ç¡®è®¤æ–°å¯†ç :&lt;/label&gt; &lt;input type=\"password\" name=\"confirmNewPassword\" id=\"confirmNewPassword\" /&gt; &lt;br /&gt; &lt;input type=\"submit\" value=\"ç¡®è®¤ä¿®æ”¹\"&gt; &lt;/form&gt; &lt;/th:block&gt;&lt;/body&gt;&lt;/html&gt; register.html12345678910111213141516171819&lt;!DOCTYPE html&gt;&lt;html xmlns:th=\"http://www.thymeleaf.org\"&gt;&lt;head&gt;&lt;meta charset=\"UTF-8\"&gt;&lt;title&gt;ç”¨æˆ·æ³¨å†Œ&lt;/title&gt;&lt;/head&gt;&lt;body&gt; &lt;p th:if=\"$&#123;responseVO != null &amp;&amp; responseVO.get('message') != null&#125;\" th:text=\"$&#123;responseVO.get('message')&#125;\"&gt;&lt;/p&gt; &lt;form th:action=\"@&#123;/register&#125;\" th:object=\"$&#123;registerDTO&#125;\" method=\"post\"&gt; &lt;label for=\"username\"&gt;ç”¨æˆ·å:&lt;/label&gt; &lt;input type=\"text\" name=\"username\" id=\"username\" /&gt; &lt;br /&gt; &lt;label for=\"password\"&gt;å¯†ç :&lt;/label&gt; &lt;input type=\"password\" name=\"password\" id=\"password\" /&gt; &lt;br /&gt; &lt;input type=\"submit\" value=\"æ³¨å†Œ\"&gt; &lt;/form&gt;&lt;/body&gt;&lt;/html&gt; user.html123456789101112131415161718192021&lt;!DOCTYPE html&gt;&lt;html xmlns:th=\"http://www.thymeleaf.org\"&gt;&lt;head&gt;&lt;meta charset=\"UTF-8\"&gt;&lt;title&gt;æ·»åŠ ç”¨æˆ·&lt;/title&gt;&lt;/head&gt;&lt;body&gt; &lt;p th:if=\"$&#123;responseVO != null &amp;&amp; responseVO.get('message') != null&#125;\" th:text=\"$&#123;responseVO.get('message')&#125;\"&gt;&lt;/p&gt; &lt;th:block th:if=\"$&#123;session.username != null &amp;&amp; session.typeName == 'ç®¡ç†å‘˜'&#125;\"&gt; &lt;form th:action=\"@&#123;/user&#125;\" th:object=\"$&#123;addDTO&#125;\" method=\"post\"&gt; &lt;label for=\"username\"&gt;ç”¨æˆ·å:&lt;/label&gt; &lt;input type=\"text\" name=\"username\" id=\"username\" /&gt; &lt;br /&gt; &lt;label for=\"password\"&gt;å¯†ç :&lt;/label&gt; &lt;input type=\"password\" name=\"password\" id=\"password\" /&gt; &lt;br /&gt; &lt;input type=\"submit\" value=\"æ·»åŠ \"&gt; &lt;/form&gt; &lt;/th:block&gt;&lt;/body&gt;&lt;/html&gt; view.html123456789101112131415161718192021222324252627282930&lt;!DOCTYPE html&gt;&lt;html xmlns:th=\"http://www.thymeleaf.org\"&gt;&lt;head&gt;&lt;meta charset=\"UTF-8\"&gt;&lt;title&gt;æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨&lt;/title&gt;&lt;/head&gt;&lt;body&gt; &lt;table border=\"1\"&gt; &lt;tr&gt; &lt;td&gt;ID&lt;/td&gt; &lt;td&gt;åå­—&lt;/td&gt; &lt;td&gt;ç”¨æˆ·ç±»å‹&lt;/td&gt; &lt;td&gt;æ³¨å†Œæ—¶é—´&lt;/td&gt; &lt;td&gt;æ“ä½œç±»å‹&lt;/td&gt; &lt;/tr&gt; &lt;th:block th:if=\"$&#123;session.username != null &amp;&amp; session.typeName == 'ç®¡ç†å‘˜'&#125;\"&gt; &lt;!-- å¾ªç¯å±•ç¤ºæ™®é€šç”¨æˆ·æ¸…å• --&gt; &lt;th:block th:if=\"$&#123;responseVO.get('data').viewVO != null&#125;\"&gt; &lt;tr th:each=\"ViewVO : $&#123;responseVO.get('data').viewVO&#125;\"&gt; &lt;td th:text=\"$&#123;ViewVO.userId&#125;\"&gt;&lt;/td&gt; &lt;td th:text=\"$&#123;ViewVO.username&#125;\"&gt;&lt;/td&gt; &lt;td th:text=\"$&#123;ViewVO.type&#125;\"&gt;&lt;/td&gt; &lt;td th:text=\"$&#123;#dates.format(ViewVO.gmtCreate, 'yyyy-MM-dd')&#125;\"&gt;&lt;/td&gt; &lt;td&gt;&lt;a th:href=\"@&#123;/delete(uerId=$&#123;ViewVO.userId&#125;)&#125;\"&gt;åˆ é™¤&lt;/a&gt;&lt;/td&gt; &lt;/tr&gt; &lt;/th:block&gt; &lt;/th:block&gt; &lt;/table&gt;&lt;/body&gt;&lt;/html&gt; è¿‡æ»¤å™¨å¯¹æŸäº›ç‰¹å®šé¡µé¢çš„è®¿é—®éœ€è¦æœ‰ä¸€å®šçš„å‰ææ¡ä»¶ï¼šæ¯”å¦‚ç”¨æˆ·æ˜¯å¦ç™»å½•ï¼Œç”¨æˆ·æ˜¯å¦æ‹¥æœ‰è®¿é—®æ­¤é¡µé¢çš„æƒé™ç­‰ã€‚è¦å®ç°è¿™æ ·çš„åŠŸèƒ½å¯ä»¥ä½¿ç”¨ Filterã€‚ è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåºï¼š(1) é€šè¿‡å®ä¾‹åŒ– FilterRegistrationBean ç±»è‡ªå®šä¹‰ Filterï¼ŒsetOrder() æ–¹æ³•å¯ä»¥å®šä¹‰æ‰§è¡Œé¡ºåºã€‚ï¼ˆå°çš„ä¼˜å…ˆï¼‰(2) é€šè¿‡é™å®šç±»åé™å®š Filter çš„é¡ºåºã€‚ï¼ˆé»˜è®¤åˆå§‹åŒ–è¿‡æ»¤å™¨æ—¶è¿›è¡Œäº†ç±»åçš„æ’åºï¼‰ 123456789101112131415161718192021222324252627282930313233@Component@WebFilter(filterName = \"/Filter0Session\", urlPatterns = &#123;\"/index\", \"/add\", \"/modify\", \"/view\", \"/delete\", \"/loginOut\"&#125;)public class Filter0Session implements Filter &#123; private Filter0Session() &#123;&#125; /** è¿‡æ»¤å™¨åˆå§‹åŒ–æ–¹æ³•ï¼Œweb æœåŠ¡å™¨æ ¹æ®é…ç½®åˆ›å»º Filter å®ä¾‹ */ @Override public void init(FilterConfig fConfig) throws ServletException &#123; // Do nothing. &#125; @Override public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException &#123; HttpServletRequest httpServletRequest = (HttpServletRequest) request; HttpServletResponse httpServletResponse = (HttpServletResponse) response; HttpSession httpSession = httpServletRequest.getSession(false); if (httpSession != null &amp;&amp; httpSession.getAttribute(UserConstant.USERNAME) != null) &#123; // ç”¨æˆ·å·²ç™»å½•åˆ™æ”¾è¡Œ chain.doFilter(request, response); &#125; else &#123; // æ£€æµ‹åˆ°ç”¨æˆ·æœªç™»å½•åˆ™è·³è½¬é‡å®šå‘åˆ°ç™»é™†é¡µé¢ httpServletResponse.sendRedirect(\"/login\"); &#125; &#125; /** è¿‡æ»¤å™¨é”€æ¯æ–¹æ³•ï¼Œå¯ä»¥é‡Šæ”¾è¿‡æ»¤å™¨ä½¿ç”¨çš„èµ„æº */ @Override public void destroy() &#123; // Do nothing. &#125;&#125; 12345678910111213141516171819202122232425262728293031323334@Component@WebFilter(filterName = \"/Filter1Admin\", urlPatterns = &#123;\"/add\", \"/view\", \"/delete\"&#125;)public class Filter1Admin implements Filter &#123; private Filter1Admin() &#123;&#125; @Override public void init(FilterConfig fConfig) throws ServletException &#123; // Do nothing. &#125; @Override public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException &#123; HttpServletRequest httpServletRequest = (HttpServletRequest) request; HttpServletResponse httpServletResponse = (HttpServletResponse) response; HttpSession httpSession = httpServletRequest.getSession(false); // æ£€æµ‹ç”¨æˆ·æ˜¯å¦ç™»å½•ï¼Œå¹¶ä¸”ç”¨æˆ·ç±»å‹æ˜¯å¦ä¸ºç®¡ç†å‘˜ if (httpSession != null &amp;&amp; httpSession.getAttribute(UserConstant.USERNAME) != null &amp;&amp; httpSession.getAttribute(UserConstant.TYPE) != null &amp;&amp; UserTypeConstant.ADMIN.equals(httpSession.getAttribute(UserConstant.TYPE))) &#123; chain.doFilter(request, response); &#125; else &#123; httpServletResponse.sendRedirect( \"/login\"); &#125; &#125; @Override public void destroy() &#123; // Do nothing. &#125;&#125; ï¼ï¼ï¼@ServletComponentScan(value = â€œcom.wingo.user.filterâ€) å…¨å±€å¼‚å¸¸å¤„ç†å¯¹äºå‰ç«¯ä¼ è¾“çš„æ•°æ®ï¼Œåœ¨ DTO ç±»ä¸­æ·»åŠ  JSR303 æ ¡éªŒï¼Œåœ¨æµ‹è¯•çš„æ—¶å€™å‘ç°æ­¤æ ¡éªŒçš„æŠ›å‡ºå¼‚å¸¸æ—¶ï¼ŒSpring Boot ä¼šè‡ªåŠ¨è·³è½¬åˆ°é»˜è®¤çš„ error é¡µé¢ã€‚åŸå› åœ¨äºé¡¹ç›®ä¸­æœªå¯¹æ­¤æ ¡éªŒç´¢æŠ›å‡ºçš„å¼‚å¸¸è¿›è¡Œå¤„ç†ã€‚å…ˆçœ‹çœ‹æ ¡éªŒåæ‰€æŠ›å‡ºçš„å¼‚å¸¸ä¿¡æ¯ã€‚ Spring Boot é»˜è®¤çš„é”™è¯¯æç¤ºé¡µé¢ï¼š æ§åˆ¶å°æŠ›å‡ºçš„å¼‚å¸¸BindException: org.springframework.validation.BeanPropertyBindingResult: 3 errors å¯ä»¥åœ¨ controller ç±»ä¸­æ·»åŠ  try{ }catch{ } å¼‚å¸¸å¤„ç†å—æ•æ‰å¼‚å¸¸æŠ›å‡ºï¼Œå¹¶è¿›è¡Œå¤„ç†ï¼ˆå¦‚è¿”å› Jsonï¼‰ã€‚ä½†è¿™æ ·ä»£ç å¾ˆä¸ç¾è§‚ï¼Œæ¨èä½¿ç”¨çš„æ–¹å¼æ˜¯ç”¨æ³¨è§£ @ControllerAdvice + @ExceptionHandler å…¨å±€å¤„ç† Controller å±‚å¼‚å¸¸ã€‚ ç¼–å†™å…¨å±€å¤„ç†ç±» 12345678910111213141516171819202122232425262728@Slf4j@ControllerAdvice // å£°æ˜å…¨å±€çš„å¼‚å¸¸å¤„ç†ç±»@ResponseBodypublic class GlobalExceptionHandler &#123; // å®šä¹‰æ•æ‰çš„å¼‚å¸¸ @ExceptionHandler(BindException.class) @ResponseStatus(HttpStatus.BAD_REQUEST) public ResponseVO resolveMethodArgumentNotValidException(BindException exception) &#123; ResponseVO response = new ResponseVO(); // å®šä¹‰å­—æ®µåŠæ ¡éªŒå¼‚å¸¸ä¿¡æ¯çš„ key / value ç»“æ„ Map&lt;String, String&gt; fieldAndMessage = new HashMap&lt;&gt;(16); StringBuilder sb = new StringBuilder(); // ç»„è£…å­—æ®µåŠæ ¡éªŒå¼‚å¸¸ä¿¡æ¯ for (FieldError fieldError : exception.getBindingResult().getFieldErrors()) &#123; fieldAndMessage.put(fieldError.getField(), fieldError.getDefaultMessage()); sb.append(fieldError.getField()).append(\":\").append(fieldError.getDefaultMessage()).append(\";\"); &#125; String strField = sb.toString(); // ç»„è£…å¼‚å¸¸ä¿¡æ¯ï¼šä»è‡ªå®šä¹‰çš„å¼‚å¸¸ä¿¡æ¯æšä¸¾ç±»ä¸­å–å¾—ä¿¡æ¯ response.setCode(ResponseCodeTypeEnum.PARAMETER_ERROR.getCode()); response.setMessage(ResponseCodeTypeEnum.PARAMETER_ERROR.getMessage()); // æ–¹ä¾¿è°ƒè¯•ï¼šå°†å¼‚å¸¸ç»Ÿä¸€æ‰“å°å‡ºæ¥ log.warn(\"BindException.class å¼‚å¸¸ä¿¡æ¯: &#123;&#125;\", strField); // è¿”å› Json return response; &#125;&#125; è¿è¡Œç»“æœï¼šæ­¤æ—¶å·²ä¸æ˜¾ç¤ºé»˜è®¤çš„é”™è¯¯é¡µé¢ï¼Œè€Œæ˜¯æ˜¾ç¤ºç”±ç”¨æˆ·å®šä¹‰çš„ Json å­—ç¬¦ä¸²ã€‚ æ§åˆ¶å°è¾“å‡ºï¼šæ–¹ä¾¿å¼€å‘è°ƒè¯•ã€‚ è‡ªå®šä¹‰ SQL æ—¥å¿—æ‰“å°å½“å¼€å¯ Mybatis çš„é»˜è®¤æ—¥å¿—æ‰“å°ï¼Œæ§åˆ¶å°çš„ SQL é»˜è®¤æ‰“å°æ ·å¼ï¼š è‡ªå®šä¹‰æ‹¦æˆªå™¨ï¼š [Mybatis æ’ä»¶æ‹¦æˆªå™¨]([https://welab-wingo.cn/2020/03/29/Software/Mybatis/Mybatis%20%E6%8F%92%E4%BB%B6%E4%B9%8B%E6%8B%A6%E6%88%AA%E5%99%A8/](https://welab-wingo.cn/2020/03/29/Software/Mybatis/Mybatis æ’ä»¶ä¹‹æ‹¦æˆªå™¨/)) 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170@Slf4j@Component@Intercepts(&#123;@Signature(type = Executor.class, method = \"update\", args = &#123;MappedStatement.class, Object.class&#125;), @Signature(type = Executor.class, method = \"query\", args = &#123;MappedStatement.class, Object.class, RowBounds.class, ResultHandler.class&#125;)&#125;)public class SqlInterceptor implements Interceptor &#123; private Properties properties; @Override public Object intercept(Invocation invocation) throws Throwable &#123; // MappedStatement ç»´æŠ¤äº†ä¸€æ¡ mapper.xml æ–‡ä»¶é‡Œé¢ select ã€updateã€deleteã€insert èŠ‚ç‚¹çš„å°è£… MappedStatement mappedStatement = (MappedStatement) invocation.getArgs()[0]; Object parameter = null; if (invocation.getArgs().length &gt; 1) &#123; parameter = invocation.getArgs()[1]; &#125; // String sqlId = mappedStatement.getId(); // è·å–åŠ¨æ€ç”Ÿæˆçš„ SQL è¯­å¥ä»¥åŠç›¸åº”çš„å‚æ•°ä¿¡æ¯å¯¹è±¡ BoundSql boundSql = mappedStatement.getBoundSql(parameter); // MyBatis æ‰€æœ‰çš„é…ç½®ä¿¡æ¯éƒ½ç»´æŒåœ¨ Configuration å¯¹è±¡ä¹‹ä¸­ï¼ŒåŒ…æ‹¬ idã€Statement ç±»å‹ã€SQL ç±»å‹ã€mapper çš„ xml æ–‡ä»¶çš„ç»å¯¹åœ°å€ã€æ˜¯å¦ä½¿ç”¨ç¼“å­˜ç­‰é…ç½® Configuration configuration = mappedStatement.getConfiguration(); Object returnValue = null; long start = System.currentTimeMillis(); // ç»§ç»­æ‰§è¡ŒåŸç›®æ ‡æ–¹æ³• returnValue = invocation.proceed(); // è·å–å®ä½“ç±» Class&lt;?&gt; parameterType = getParameterType(mappedStatement); /** åˆ¤æ–­å®ä½“ç±»ä¸Šæ˜¯å¦åŒ…å« @SqlPrint æ³¨è§£ï¼Œä¸åŒ…å«çš„è¯ç›´æ¥è¿”å› */ if (!hasSqlPrintAnnotation(parameterType)) &#123; return returnValue; &#125; long end = System.currentTimeMillis(); long time = (end - start); /** å½“ SQL æ‰§è¡Œå¤§äº 1 æ¯«ç§’æ—¶æ‰“å° SQLï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥ç”¨äºæ…¢ SQL çš„æ‰“å°åŠç›‘æ§ */ if (time &gt; 1) &#123; String sql = getSql(configuration, boundSql, sqlId, time); log.info(sql); &#125; // è¿”å›æ‰§è¡Œåçš„ç»“æœ return returnValue; &#125; /** * ä½œç”¨ï¼šåŒ…è£…ç›®æ ‡å¯¹è±¡ï¼ŒåŒ…è£…çš„æ„æ€å°±æ˜¯ä¸ºç›®æ ‡å¯¹è±¡åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡ */ @Override public Object plugin(Object target) &#123; /** åˆ¤æ–­ä¸‹éœ€è¦æ‹¦æˆªçš„ç›®æ ‡å¯¹è±¡ç±»å‹ï¼Œéœ€è¦æ‹¦æˆªæ—¶æ‰æ‹¦æˆªï¼Œå¦åˆ™ç›´æ¥è¿”å›æœ¬èº«ï¼Œå‡å°‘è¢«ä»£ç†çš„æ¬¡æ•° */ if (target instanceof Executor) &#123; // å€ŸåŠ© Plugin çš„ wrap æ–¹æ³•æ¥ä½¿ç”¨å½“å‰çš„æ‹¦æˆªå™¨åŒ…è£…æˆ‘ä»¬çš„ç›®æ ‡å¯¹è±¡ï¼Œè¿”å›çš„å°±æ˜¯ä¸ºå½“å‰ target åˆ›å»ºçš„åŠ¨æ€ä»£ç† // ä½¿ç”¨ JDK çš„åŠ¨æ€ä»£ç†ï¼Œç»™ target å¯¹è±¡åˆ›å»ºä¸€ä¸ª delegate ä»£ç†å¯¹è±¡ï¼Œä»¥æ­¤æ¥å®ç°æ–¹æ³•æ‹¦æˆªå’Œå¢å¼ºåŠŸèƒ½ï¼Œå®ƒä¼šå›è°ƒ intercept() æ–¹æ³•ã€‚ return Plugin.wrap(target, this); &#125; else &#123; // æ— éœ€æ‹¦æˆªåˆ™ç›´æ¥è¿”å›ç›®æ ‡å¯¹è±¡æœ¬èº« return target; &#125; &#125; /** * å°†æ’ä»¶æ³¨å†Œæ—¶çš„ property å±æ€§è®¾ç½®è¿›æ¥ */ @Override public void setProperties(Properties properties) &#123; this.properties = properties; &#125; /** * ç»„è£…éœ€è¦æ‰“å°çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ SQL è¯­å¥ã€ç‰¹æ®Šæ ‡è®°ã€SQL æ‰§è¡Œæ—¶é—´ç­‰ * * @param configuration MyBatis æ‰€æœ‰çš„é…ç½®ä¿¡æ¯éƒ½ç»´æŒåœ¨ Configuration å¯¹è±¡ä¹‹ä¸­ * @param boundSql è¡¨ç¤ºåŠ¨æ€ç”Ÿæˆçš„ SQL è¯­å¥ä»¥åŠç›¸åº”çš„å‚æ•°ä¿¡æ¯å¯¹è±¡ * @param sqlId æ‹¦æˆªçš„æ‰§è¡Œ SQL çš„idï¼ˆå¯ä»¥ç†è§£ä¸ºæ–¹æ³•ï¼‰ * @param time SQL æ‰§è¡Œæ—¶é—´ * @return */ private static String getSql(Configuration configuration, BoundSql boundSql, String sqlId, long time) &#123; String sql = showSql(configuration, boundSql); StringBuilder str = new StringBuilder(100); // æ‹¦æˆªçš„æ‰§è¡Œ SQL çš„idï¼ˆå¯ä»¥ç†è§£ä¸ºæ–¹æ³•ï¼‰ï¼Œä¾‹å¦‚ï¼šcom.gorge4j.user.mapper.UserManageDemoMyBatisMapper.update str.append(sqlId); str.append(\" : \"); // å…·ä½“æ‰§è¡Œçš„ SQL è¯­å¥ str.append(sql); str.append(\" &gt;&gt;&gt;&gt;&gt;&gt; \"); // SQL æ‰§è¡Œçš„æ—¶é—´ str.append(\"SQLæ‰§è¡Œè€—æ—¶: \"); str.append(time); str.append(\"ms\"); return str.toString(); &#125; /** æŒ‰ç±»å‹æ ¼å¼åŒ– SQL é‡Œçš„å‚æ•° */ private static String getFormatParameterValue(Object obj) &#123; String value = null; if (obj instanceof String) &#123; value = \"'\" + obj.toString() + \"'\"; &#125; else if (obj instanceof Date) &#123; DateFormat formatter = DateFormat.getDateTimeInstance(DateFormat.DEFAULT, DateFormat.DEFAULT, Locale.CHINA); value = \"'\" + formatter.format(new Date()) + \"'\"; &#125; else &#123; if (obj != null) &#123; value = obj.toString(); &#125; else &#123; value = \"\"; &#125; &#125; return value; &#125; /** ç»„è£…éœ€è¦æ‰“å°çš„ SQL */ private static String showSql(Configuration configuration, BoundSql boundSql) &#123; // å–å¾—å‚æ•°çš„å¯¹è±¡ï¼Œå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªå¤šä¸ªå‚æ•°çš„ map ç»“æ„ // ç¤ºä¾‹ï¼šparameterObject:MapperMethod&#123;password=123456,name=xxxxxx,type=O,param3=O,param1=xxxxxx,param2=123456&#125; Object parameterObject = boundSql.getParameterObject(); // æŸ¥è¯¢ SQL ä¸­çš„å‚æ•° List&lt;ParameterMapping&gt; parameterMappings = boundSql.getParameterMappings(); // å°† SQL ä¸­ä¸€ä¸ªæˆ–å¤šä¸ªå›è½¦æ¢è¡Œç¬¦å·æ›¿æ¢æˆä¸€ä¸ªç©ºæ ¼ String sql = boundSql.getSql().replaceAll(\"[\\\\s]+\", \" \"); if (!parameterMappings.isEmpty() &amp;&amp; parameterObject != null) &#123; // Mybatis åœ¨å¯åŠ¨æ—¶å°±ä¼šé€šè¿‡ TypeHandlerRegistry è¿›è¡Œæ³¨å†Œï¼Œå³å»ºç«‹ JdbcType, JavaType, TypeHandler ä¸‰è€…ä¹‹é—´çš„å…³ç³»ã€‚ // å› æ­¤ï¼Œè¿™æ„å‘³ç€åœ¨ Mybatis å¯åŠ¨æ—¶æˆ‘ä»¬ä¹Ÿéœ€è¦é€šè¿‡ TypeHandlerRegistry å°†æˆ‘ä»¬çš„æ‰€æœ‰çš„æšä¸¾ç±»å‹ï¼ˆJavaTypeï¼‰ä¸è‡ªå®šä¹‰çš„æšä¸¾ // TypeHandlerï¼ˆEnumTypeHandlerï¼‰å»ºç«‹è”ç³» TypeHandlerRegistry typeHandlerRegistry = configuration.getTypeHandlerRegistry(); // è‡ªå®šä¹‰ TypeHandler æ—¶ä¼šèµ°è¿™ä¸ªé€»è¾‘ï¼Œå»ºç«‹ JavaType å’Œ JdbcType ä¹‹é—´çš„è”ç³» if (typeHandlerRegistry.hasTypeHandler(parameterObject.getClass())) &#123; // æ›¿æ¢ SQL ä¸­çš„å ä½ç¬¦ â€œ?â€ ä¸ºå…·ä½“çš„å‚æ•°ï¼ŒreplaceFirst ä½œä¸ºæ˜¯æ›¿æ¢åŒ¹é…åˆ°çš„ç¬¬ä¸€ä¸ªå ä½ç¬¦ â€œ?â€ sql = sql.replaceFirst(\"\\\\?\", getFormatParameterValue(parameterObject)); &#125; // æ²¡æœ‰è‡ªå®šä¹‰çš„ TypeHandlerï¼Œèµ°é€šç”¨é€»è¾‘ else &#123; // æ‹¿åˆ° targetï¼ˆæ‹¦æˆªå¯¹è±¡ï¼‰çš„å…ƒæ•°æ® MetaObject metaObject = configuration.newMetaObject(parameterObject); // å‚æ•°æ˜¯æŒ‰é¡ºåºå­˜å‚¨çš„ï¼Œä¸‹é¢é€»è¾‘æŒ‰é¡ºåºæ¥æ›¿æ¢ for (ParameterMapping parameterMapping : parameterMappings) &#123; // è·å–å‚æ•°çš„åç§° String propertyName = parameterMapping.getProperty(); // å¦‚æœå…ƒæ•°æ®å¯¹è±¡ä¸­å­˜åœ¨è¯¥å‚æ•°ï¼Œåˆ™æ›¿æ¢ç›¸åº”çš„å ä½ç¬¦ â€œ?â€ if (metaObject.hasGetter(propertyName)) &#123; Object obj = metaObject.getValue(propertyName); sql = sql.replaceFirst(\"\\\\?\", getFormatParameterValue(obj)); &#125; // å¦‚æœæœ‰é¢å¤–çš„å‚æ•°ï¼Œèµ°ä¸‹é¢çš„é€»è¾‘ else if (boundSql.hasAdditionalParameter(propertyName)) &#123; Object obj = boundSql.getAdditionalParameter(propertyName); sql = sql.replaceFirst(\"\\\\?\", getFormatParameterValue(obj)); &#125; &#125; &#125; &#125; // è¿”å›ç»„è£…å¥½çš„ SQL return sql; &#125; /** è·å–å®ä½“å¯¹è±¡ç±»ï¼šclass com.gorge4j.user.entity.UserManageDemoMyBatis */ private Class&lt;?&gt; getParameterType(MappedStatement statement) &#123; if (statement.getParameterMap() == null || statement.getParameterMap().getType() == null) &#123; return null; &#125; return statement.getParameterMap().getType(); &#125; /** åˆ¤æ–­å®ä½“ç±»ä¸Šæ˜¯å¦åŒ…å«è‡ªå®šä¹‰çš„ SQl æ‰“å°çš„æ³¨è§£ @SqlPrint */ private static boolean hasSqlPrintAnnotation(Class&lt;?&gt; classType) &#123; return classType == null ? Boolean.FALSE : classType.isAnnotationPresent(SqlPrint.class); &#125;&#125; æ³¨æ„ï¼šéœ€è¦åœ¨å®ä½“ç±»ä¸Šæ·»åŠ è‡ªå®šä¹‰æ³¨è§£ @SqlPrint è‡ªå®šä¹‰æ³¨è§£ç±»ï¼š 12345@Retention(RUNTIME)@Target(TYPE)public @interface SqlPrint &#123;&#125; è‡ªå®šä¹‰çš„ SQL æ—¥å¿—æ‰“å°æ ·å¼ï¼š è·¨åŸŸ è·¨åŸŸï¼Œæ˜¯æŒ‡æµè§ˆå™¨ä¸èƒ½æ‰§è¡Œå…¶ä»–ç½‘ç«™çš„è„šæœ¬ã€‚å®ƒæ˜¯ç”±æµè§ˆå™¨çš„åŒæºç­–ç•¥é€ æˆçš„ï¼Œæ˜¯æµè§ˆå™¨å¯¹ JavaScript å®æ–½çš„å®‰å…¨ç­–ç•¥ã€‚ 123456789101112131415161718192021222324@Configurationpublic class CorsConfig extends WebMvcConfigurationSupport &#123; @Override public void addCorsMappings(CorsRegistry registry) &#123; registry.addMapping(\"/**\") .allowedOrigins(\"*\") .allowCredentials(true) .allowedHeaders(\"*\") .allowedMethods(\"GET\", \"POST\", \"DELETE\", \"PUT\", \"OPTIONS\") .maxAge(3600); &#125; // é…ç½® Swagger çš„èµ„æºæ˜ å°„ @Override public void addResourceHandlers(ResourceHandlerRegistry registry) &#123; registry.addResourceHandler(\"swagger-ui.html\") .addResourceLocations(\"classpath:/META-INF/resources/\"); registry.addResourceHandler(\"/webjars/**\") .addResourceLocations(\"classpath:/META-INF/resources/webjars/\"); &#125;&#125; æ³¨æ„12345/** * @see EnableWebMvc ç”¨äº†æ­¤æ³¨è§£é»˜è®¤é…ç½®çš„ MVC å¤±æ•ˆï¼Œéœ€è¦ç”¨æˆ·é‡æ–°é…ç½® * @see WebMvcConfigurer */public class WebMvcConfigurationSupport ... è‡ªå®šä¹‰æ ¡éªŒ é™¤äº†ä½¿ç”¨é»˜è®¤æä¾›çš„ Validatorï¼Œç”¨æˆ·è¿˜å¯ä»¥æä¾›å…·æœ‰è‡ªå®šä¹‰æ ¡éªŒè§„åˆ™çš„ Validatorã€‚ æ³¨è§£ç±»123456789@Target(&#123;ElementType.FIELD&#125;)@Retention(RetentionPolicy.RUNTIME)@Constraint(validatedBy = UsernameValidator.class) // å¼•å…¥æ ¡éªŒè§„åˆ™ç±»è¿›è¡Œæ ¡éªŒpublic @interface Username &#123; // é”™è¯¯æç¤ºæ¶ˆæ¯ @Username(message = \"\") String message() default \"&#123;com.wingo.user.annotaion.Username.message&#125;\"; Class&lt;?&gt;[] groups() default &#123;&#125;; Class&lt;? extends Payload&gt;[] payload() default &#123;&#125;;&#125; 12345678@Target(&#123;ElementType.FIELD&#125;)@Retention(RetentionPolicy.RUNTIME)@Constraint(validatedBy = PasswordValidator.class)public @interface Password &#123; String message() default \"&#123;com.wingo.user.annotaion.Password.message&#125;\"; Class&lt;?&gt;[] groups() default &#123;&#125;; Class&lt;? extends Payload&gt;[] payload() default &#123;&#125;;&#125; æ ¡éªŒç±»123456789101112131415public class UsernameValidator implements ConstraintValidator&lt;Username, String&gt; &#123; @Override public void initialize(Username constraintAnnotation) &#123; // do nothing &#125; @Override public boolean isValid(String value, ConstraintValidatorContext context) &#123; if (StringUtils.isBlank(value)) &#123; return false; &#125; return Pattern.matches(RegexConstant.REGEX_USERNAME, value); &#125;&#125; 123456789101112131415public class PasswordValidator implements ConstraintValidator&lt;Password, String&gt; &#123; @Override public void initialize(Password constraintAnnotation) &#123; // do nothing &#125; @Override public boolean isValid(String value, ConstraintValidatorContext context) &#123; if (StringUtils.isBlank(value)) &#123; return false; &#125; // æ­£åˆ™åŒ¹é… return Pattern.matches(RegexConstant.REGEX_PASS, value); &#125;&#125; è¯·æ±‚å“åº”æ‰“å° åˆ‡é¢ï¼šæ–¹æ³•å‰æ‰“å°è¯·æ±‚ä¿¡æ¯å‚æ•°ï¼›æ–¹æ³•åæ‰“å°å“åº”ä¿¡æ¯ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041@Slf4j@Component@Aspectpublic class ReqAndRespLogAspect &#123; /** * è¯·æ±‚å‚æ•°çš„æ—¥å¿—æ‰“å° * * @param joinPoint åˆ‡ç‚¹ */ @Before(\"within(com.wingo.user.controller.*)\") public void before(JoinPoint joinPoint) &#123; // è·å–ä¼ å…¥ç›®æ ‡æ–¹æ³•çš„å‚æ•°å¯¹è±¡ Object[] args = joinPoint.getArgs(); // è·å–å°è£…äº†ç½²åä¿¡æ¯çš„å¯¹è±¡,åœ¨è¯¥å¯¹è±¡ä¸­å¯ä»¥è·å–åˆ°ç›®æ ‡æ–¹æ³•å,æ‰€å±ç±»çš„Classç­‰ä¿¡æ¯ MethodSignature methodSignature = (MethodSignature) joinPoint.getSignature(); // è·å–æ–¹æ³•å¯¹è±¡ Method method = methodSignature.getMethod(); // åˆ†å‰²ç»„è£…å‚æ•° String strArgs = StringUtils.join(args, \",\"); log.info(\"&#123;&#125;.&#123;&#125; - è¯·æ±‚å‚æ•°: &#123;&#125;\", method.getDeclaringClass().getName(), method.getName(), strArgs); &#125; /** * å“åº”ç»“æœçš„æ—¥å¿—æ‰“å° * * @param joinPoint åˆ‡ç‚¹ * @param res å“åº”ç»“æœå¯¹è±¡ */ @AfterReturning(value = \"within(com.wingo.user.controller.*)\", returning = \"res\") public void after(JoinPoint joinPoint, Object res) &#123; // è·å–å°è£…äº†ç½²åä¿¡æ¯çš„å¯¹è±¡,åœ¨è¯¥å¯¹è±¡ä¸­å¯ä»¥è·å–åˆ°ç›®æ ‡æ–¹æ³•å,æ‰€å±ç±»çš„ Class ç­‰ä¿¡æ¯ MethodSignature methodSignature = (MethodSignature) joinPoint.getSignature(); // è·å–æ–¹æ³•å¯¹è±¡ Method method = methodSignature.getMethod(); // å°†è¿”å›å¯¹è±¡è½¬æ¢æˆ Json å­—ç¬¦ä¸²ï¼Œé¡¹ç›®çš„è¿”å›å¦‚æœä¸æ˜¯ Json çš„æ•°æ®æ ¼å¼ï¼Œé‚£ä¹ˆè¿”å›å‚æ•°å°±åªæœ‰ URL // String strRes = JSONUtils.toJSONString(res); String strRes = res.toString(); log.info(\"&#123;&#125;.&#123;&#125; - è¿”å›ç»“æœ: &#123;&#125;\", method.getDeclaringClass().getName(), method.getName(), strRes); &#125;&#125;","categories":[{"name":"Welab","slug":"Welab","permalink":"http://yoursite.com/categories/Welab/"}],"tags":[{"name":"Project","slug":"Project","permalink":"http://yoursite.com/tags/Project/"}]},{"title":"CET6 å†™ä½œçœŸé¢˜","slug":"English/CET6 å†™ä½œçœŸé¢˜","date":"2020-03-06T14:08:13.000Z","updated":"2020-03-06T15:07:48.630Z","comments":true,"path":"2020/03/06/English/CET6 å†™ä½œçœŸé¢˜/","link":"","permalink":"http://yoursite.com/2020/03/06/English/CET6%20%E5%86%99%E4%BD%9C%E7%9C%9F%E9%A2%98/","excerpt":"CET6 å†™ä½œçœŸé¢˜ã€‚","text":"CET6 å†™ä½œçœŸé¢˜ã€‚ 2019/12(ä¸€) æ‹¥æœ‰ç¤¾ä¼šè´£ä»»æ„Ÿçš„é‡è¦æ€§ ä»¥ â€œç¤¾ä¼šé—®é¢˜â€ çš„æ™®éæ€§å¼•å‡ºç¤¾ä¼šè´£ä»»æ„Ÿçš„ç¼ºå¤±ï¼› åˆ†åˆ«ä»ä¼ä¸šå’Œä¸ªäººè§’åº¦é˜è¿°ç¤¾ä¼šè´£ä»»æ„Ÿçš„é‡è¦æ€§ï¼› æ€»ç»“è§‚ç‚¹ï¼Œå‘å‡ºå‘¼åã€‚ Problems such as the violation of privacy and environment pollution are becoming increasingly prevalent in modern society. To some extent, they can be ascribed to a distinct lack of a sense of social responsibility aomong enterprises and individuals, which is of crucial importance in building a better world. When seeking profits, socially responsible corporations never forget to make positive contributions to pur society. Take Alibaba, a leading tech company in China. The Ant Forest green initiative it launched in 2016 has so far inspired up to 500 million Alipay users to adopt low-carbon lifestyles and resulted in over 100 million trees planted in Chinaâ€™s most barren regions. At the individual level, a sense of social responsibility motivates us college students to acquire as much knowledge as possible and put it into practice. It also prevents us from engaging in unethical behaviors such as campus violence and academic misconduct that cause negative social impact. To sum up, a healthy society requires all its members to take on their respective responsibility. Everyone, therefore, should develop a sense of social responsibility, especially we college students who will be a pillar of society in the furure. ä½œæ–‡æ¨¡æ¿ï¼šå¯¹äºç¤¾ä¼š / ç¤¾åŒº / å®¶åº­çš„è´£ä»» Every one of us is a member of our society / acommunity/a certain family. This means that we all have a responsibility to make a contribution towards a better/healthier [ ], as we enjoy the benefits from this social role. There is no denying that a sense of responsibility has always been highly valued. It is primarily because it serves to maintain and even strengthen social / family ties / bonds, which help generate cohesion within our [ ]. It will in turn enable us to make a joint / united effort to [ ]. Furthermore, such a sense of responsibility forms an integral part of goodcharacter. It is a constant reminder for us of how essential it is to give, for example to dedicate ourselves to [ ]. so that we wonâ€™t end up being selfish. In general, having a sense of [ ] responsibility matters as much to the entire [ ] as to ourselves. It is thus necessary for us to develop this quality.","categories":[{"name":"English","slug":"English","permalink":"http://yoursite.com/categories/English/"}],"tags":[{"name":"CET6","slug":"CET6","permalink":"http://yoursite.com/tags/CET6/"}]},{"title":"Spring Boot æ•°æ®è®¿é—®","slug":"Spring Boot/Spring Boot æ•°æ®è®¿é—®","date":"2020-03-05T07:42:42.000Z","updated":"2020-04-21T03:30:24.177Z","comments":true,"path":"2020/03/05/Spring Boot/Spring Boot æ•°æ®è®¿é—®/","link":"","permalink":"http://yoursite.com/2020/03/05/Spring%20Boot/Spring%20Boot%20%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE/","excerpt":"Spring Boot æ•°æ®è®¿é—®çš„ç›¸å…³çŸ¥è¯†ã€‚","text":"Spring Boot æ•°æ®è®¿é—®çš„ç›¸å…³çŸ¥è¯†ã€‚ JDBC123456789&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt;&lt;/dependency&gt; 1234567spring: datasource: username: root password: 123456 url: jdbc:mysql://localhosthost:3306/jdbc driver-class-name: com.mysql.jdbc.Driver # Spring Boot 2.1.x é»˜è®¤ä½¿ç”¨äº† MySQL 8.0ï¼šcom.mysql.cj.jdbc.Driver Sping Boot é»˜è®¤ä½¿ç”¨ org.apache.tomcat.jdbc.pool.DataSource ä½œä¸ºæ•°æ®æºï¼Œç›¸å…³é…ç½®éƒ½åœ¨ DataSourceProperties é‡Œé¢ã€‚ é»˜è®¤å»ºè¡¨é…ç½®è§„åˆ™ 1schema-*.sql æŒ‡å®šå»ºè¡¨æ–‡ä»¶ sql æ–‡ä»¶çš„æ–‡ä»¶å 1234spring: datasource: schema: - classpath:user.sql Sping Boot è‡ªåŠ¨é…ç½®äº† JdbcTemplate æ“ä½œæ•°æ®åº“ JdbcTempaleåˆ›å»ºä¸€ä¸ª User è¡¨ï¼š 1234CREATE TABLE `User` ( `name` varchar(100) COLLATE utf8mb4_general_ci NOT NULL, `age` int NOT NULL) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci ç¼–å†™å®ä½“å¯¹è±¡ï¼š 12345678@Data // Getter / Setter@NoArgsConstructor // æ— å‚æ„é€ å™¨public class User &#123; private String name; private Integer age;&#125; æ•°æ®è®¿é—®å¯¹è±¡æ¥å£ï¼š 123456789101112131415161718public interface UserService &#123; // æ–°å¢ä¸€ä¸ªç”¨æˆ· int create(String name, Integer age); // æ ¹æ® name æŸ¥è¯¢ç”¨æˆ· List&lt;User&gt; getByName(String name); // æ ¹æ® name åˆ é™¤ç”¨æˆ· int deleteByName(String name); // è·å–ç”¨æˆ·æ€»é‡ int getAllUsers(); // åˆ é™¤æ‰€æœ‰ç”¨æˆ· int deleteAllUsers();&#125; æ•°æ®è®¿é—®æ“ä½œçš„å®ç°ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243@Servicepublic class UserServiceImpl implements UserService &#123; @Autowired private JdbcTemplate jdbcTemplate; UserServiceImpl(JdbcTemplate jdbcTemplate) &#123; this.jdbcTemplate = jdbcTemplate; &#125; @Override public int create(String name, Integer age) &#123; return jdbcTemplate.update(\"insert into USER(NAME, AGE) values(?, ?)\", name, age); &#125; @Override public List&lt;User&gt; getByName(String name) &#123; List&lt;User&gt; users = jdbcTemplate.query (\"select NAME, AGE from USER where NAME = ?\", (resultSet, i) -&gt; &#123; User user = new User(); user.setName(resultSet.getString(\"NAME\")); user.setAge(resultSet.getInt(\"AGE\")); return user; &#125;, name); return users; &#125; @Override public int deleteByName(String name) &#123; return jdbcTemplate.update(\"delete from USER where NAME = ?\", name); &#125; @Override public int getAllUsers() &#123; return jdbcTemplate.queryForObject(\"select count(1) from USER\", Integer.class); &#125; @Override public int deleteAllUsers() &#123; return jdbcTemplate.update(\"delete from USER\"); &#125;&#125; æ•´åˆ Druid æ•°æ®æº123456789101112131415161718&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt;&lt;/dependency&gt;&lt;!-- mysqlé©±åŠ¨ --&gt;&lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;!-- å¯åŠ¨å™¨ä¸­é»˜è®¤çš„ç‰ˆæœ¬è¾ƒé«˜ --&gt; &lt;version&gt;5.1.47&lt;/version&gt; &lt;scope&gt;runtime&lt;/scope&gt;&lt;/dependency&gt;&lt;!--æ•°æ®åº“è¿æ¥æ± --&gt;&lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;druid-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;1.1.20&lt;/version&gt;&lt;/dependency&gt; 123456789101112131415161718192021222324252627282930313233343536373839404142434445spring.datasource.username=rootspring.datasource.password=123456spring.datasource.url=jdbc:mysql://localhost:3306/i-auth?useSSL=false# å¯ä»¥ä¸é…ç½® Druid å¯ä»¥æ ¹æ® url è‡ªåŠ¨è¯†åˆ«æ•°æ®åº“é©±åŠ¨# spring.datasource.driver-class-name=com.mysql.jdbc.Driver# åˆå§‹åŒ–è¿æ¥æ•°spring.datasource.druid.initial-size=5# æœ€å°è¿æ¥æ•°spring.datasource.druid.min-idle=10# æœ€å¤§è¿æ¥æ•°spring.datasource.druid.max-active=10# è·å–è¿æ¥æœ€é•¿ç­‰å¾…æ—¶é—´ å•ä½æ¯«ç§’spring.datasource.druid.max-wait=10000# é…ç½®é—´éš”å¤šä¹…æ‰è¿›è¡Œä¸€æ¬¡æ£€æµ‹ï¼Œæ£€æµ‹éœ€è¦å…³é—­çš„ç©ºé—²è¿æ¥ï¼Œå•ä½æ˜¯æ¯«ç§’spring.datasource.druid.timeBetweenEvictionRunsMillis=30000# æŒ‡å®šè·å–è¿æ¥æ—¶è¿æ¥æ ¡éªŒçš„sqlæŸ¥è¯¢è¯­å¥spring.datasource.druid.validationQuery=select 'x'# è·å–è¿æ¥åï¼Œç¡®å®æ˜¯å¦è¦è¿›è¡Œè¿æ¥ç©ºé—²æ—¶é—´çš„æ£€æŸ¥spring.datasource.druid.testWhileIdle=true# è·å–è¿æ¥æ£€æµ‹spring.datasource.druid.testOnBorrow=false# å½’è¿˜è¿æ¥æ£€æµ‹spring.datasource.druid.testOnReturn=false# æŒ‡å®šè¿æ¥æ ¡éªŒæŸ¥è¯¢çš„è¶…æ—¶æ—¶é—´spring.datasource.druid.validationQueryTimeout=600000# é…ç½®ä¸€ä¸ªè¿æ¥åœ¨æ± æ€»æœ€å°ç”Ÿå­˜çš„æ—¶é—´spring.datasource.druid.minEvictableIdleTimeMillis=300000# æ‰“å¼€ PSCacheï¼Œå¹¶ä¸”æŒ‡å®šæ¯ä¸ªè¿æ¥ä¸Š Cache çš„å¤§å°spring.datasource.druid.poolPreparedStatements=truespring.datasource.druid.maxPoolPreparedStatementPerConnectionSize=20# é…ç½®ç›‘æ§ç»Ÿè®¡æ‹¦æˆªçš„filterï¼Œå»æ‰åç›‘æ§ç•Œé¢sqlæ— æ³•ç»Ÿè®¡ï¼Œ'wall'ç”¨äºé˜²ç«å¢™spring.datasource.druid.filters=stat,wall,slf4j# é€šè¿‡connectPropertieså±æ€§æ¥æ‰“å¼€mergeSqlåŠŸèƒ½ï¼Œæ…¢sqlè®°å½•ç­‰spring.datasource.druid.connectionProperties=druid.stat.mergeSql=true;druid.stat.logSlowSql=true;druid.stat.slowSqlMillis=5000## druidè¿æ¥æ± ç›‘æ§# éœ€è¦è´¦å·å¯†ç æ‰èƒ½è®¿é—®æ§åˆ¶å°ï¼Œé»˜è®¤ä¸ºrootspring.datasource.druid.stat-view-servlet.login-username=adminspring.datasource.druid.stat-view-servlet.login-password=123# è®¿é—®è·¯å¾„ä¸º/druidæ—¶ï¼Œè·³è½¬åˆ°StatViewServletspring.datasource.druid.stat-view-servlet.url-pattern=/druid/*# æ˜¯å¦èƒ½å¤Ÿé‡ç½®æ•°æ®spring.datasource.druid.stat-view-servlet.reset-enable=false# æ’é™¤ä¸€äº›é™æ€èµ„æºï¼Œä»¥æé«˜æ•ˆç‡spring.datasource.druid.web-stat-filter.exclusions=*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/* 1234567891011121314151617181920212223242526272829303132333435363738394041424344// å¯¼å…¥ Druid æ•°æ®æº@Configurationpublic class DruidConfig &#123; // ä¸€ä¸ªè‡ªå®šä¹‰çš„ DataSource ç»„ä»¶ @ConfigurationProperties(prefix = \"spring.datasource\") @Bean public DataSource druid()&#123; return new DruidDataSource(); &#125; // é…ç½® Druid çš„ç›‘æ§ // é…ç½®ä¸€ä¸ªç®¡ç†åå°çš„ Servlet @Bean public ServletRegistrationBean statViewServlet()&#123; ServletRegistrationBean bean = new ServletRegistrationBean(new StatViewServlet(), \"/druid/*\"); Map&lt;String,String&gt; initParams = new HashMap&lt;&gt;(); initParams.put(\"loginUsername\",\"admin\"); initParams.put(\"loginPassword\",\"123456\"); initParams.put(\"allow\",\"\"); // é»˜è®¤å°±æ˜¯å…è®¸æ‰€æœ‰è®¿é—® initParams.put(\"deny\",\"192.168.15.21\"); bean.setInitParameters(initParams); return bean; &#125; // é…ç½®ä¸€ä¸ª Web ç›‘æ§çš„ Filter @Bean public FilterRegistrationBean webStatFilter()&#123; FilterRegistrationBean bean = new FilterRegistrationBean(); bean.setFilter(new WebStatFilter()); Map&lt;String,String&gt; initParams = new HashMap&lt;&gt;(); initParams.put(\"exclusions\",\"*.js,*.css,/druid/*\"); bean.setInitParameters(initParams); bean.setUrlPatterns(Arrays.asList(\"/*\")); return bean; &#125;&#125; æ•´åˆ MyBatiså¯ç›´æ¥ä½¿ç”¨æ’ä»¶ï¼šMybatis-Plus 12345&lt;dependency&gt; &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt; &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;1.3.1&lt;/version&gt;&lt;/dependency&gt; æ³¨è§£ç‰ˆ 1234567891011121314151617// æŒ‡å®šè¿™æ˜¯ä¸€ä¸ªæ“ä½œæ•°æ®åº“çš„ Mapper@Mapperpublic interface DepartmentMapper &#123; @Select(\"select * from department where id=#&#123;id&#125;\") public Department getDeptById(Integer id); @Delete(\"delete from department where id=#&#123;id&#125;\") public int deleteDeptById(Integer id); @Options(useGeneratedKeys = true,keyProperty = \"id\") @Insert(\"insert into department(departmentName) values(#&#123;departmentName&#125;)\") public int insertDept(Department department); @Update(\"update department set departmentName=#&#123;departmentName&#125; where id=#&#123;id&#125;\") public int updateDept(Department department);&#125; 123456789// ä½¿ç”¨ MapperScan æ‰¹é‡æ‰«ææ‰€æœ‰çš„ Mapper æ¥å£ï¼Œæˆ–åœ¨ Mapper ç±»ä½¿ç”¨ Mapper@MapperScan(value = \"com.wingo.springboot.mapper\")@SpringBootApplicationpublic class SpringBootDataMybatisApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(SpringBootDataMybatisApplication.class, args); &#125;&#125; è‡ªå®šä¹‰ MyBatis é…ç½®è§„åˆ™ï¼šé©¼å³°å‘½åæ³•ã€‚ 1234567891011121314@Configuration public class MyBatisConfig &#123; @Bean public ConfigurationCustomizer configurationCustomizer()&#123; return new ConfigurationCustomizer()&#123; @Override public void customize(Configuration configuration) &#123; configuration.setMapUnderscoreToCamelCase(true); &#125; &#125;; &#125; &#125; é…ç½®æ–‡ä»¶ç‰ˆ 12345mybatis: # æŒ‡å®šå…¨å±€é…ç½®æ–‡ä»¶çš„ä½ç½® config-location: classpath:mybatis/mybatis-config.xml # æŒ‡å®š Sql æ˜ å°„æ–‡ä»¶çš„ä½ç½® mapper-locations: classpath:mybatis/mapper/*.xml æ•´åˆ SpringData JPA12345678910111213&lt;!-- JPA --&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;&lt;/dependency&gt;&lt;!-- mysqlé©±åŠ¨ --&gt;&lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;!-- å¯åŠ¨å™¨ä¸­é»˜è®¤çš„ç‰ˆæœ¬è¾ƒé«˜ --&gt; &lt;version&gt;5.1.47&lt;/version&gt; &lt;scope&gt;runtime&lt;/scope&gt;&lt;/dependency&gt; ç¼–å†™ä¸€ä¸ªå®ä½“ç±» Bean å’Œæ•°æ®è¡¨è¿›è¡Œæ˜ å°„ï¼Œå¹¶ä¸”é…ç½®å¥½æ˜ å°„å…³ç³»ï¼š 1234567891011121314// ä½¿ç”¨ JPA æ³¨è§£é…ç½®æ˜ å°„å…³ç³»@Entity // å‘Šè¯‰ JPA è¿™æ˜¯ä¸€ä¸ªå®ä½“ç±»ï¼ˆå’Œæ•°æ®è¡¨æ˜ å°„çš„ç±»ï¼‰@Table(name = \"tbl_user\") // @Table æ¥æŒ‡å®šå’Œå“ªä¸ªæ•°æ®è¡¨å¯¹åº”ï¼Œå¦‚æœçœç•¥é»˜è®¤è¡¨åå°±æ˜¯ userpublic class User &#123; @Id // è¿™æ˜¯ä¸€ä¸ªä¸»é”® @GeneratedValue(strategy = GenerationType.IDENTITY) // è‡ªå¢ä¸»é”® private Integer id; @Column(name = \"last_name\",length = 50) // è¿™æ˜¯å’Œæ•°æ®è¡¨å¯¹åº”çš„ä¸€ä¸ªåˆ— private String lastName; @Column // çœç•¥é»˜è®¤åˆ—åå°±æ˜¯å±æ€§å private String email;&#125; ç¼–å†™ä¸€ä¸ª Dao æ¥å£æ¥æ“ä½œå®ä½“ç±»å¯¹åº”çš„æ•°æ®è¡¨ï¼š 123// ç»§æ‰¿ JpaRepository æ¥å®Œæˆå¯¹æ•°æ®åº“çš„æ“ä½œï¼Œä¼ å‚ï¼šå®ä½“ç±»å‹ ä¸»é”®ç±»å‹public interface UserRepository extends JpaRepository&lt;User,Integer&gt; &#123;&#125; JpaProperties åŸºæœ¬é…ç½® 1234567spring: jpa: hibernate: # æ›´æ–°æˆ–è€…åˆ›å»ºæ•°æ®è¡¨ç»“æ„ ddl-auto: update # æ§åˆ¶å°æ˜¾ç¤ºSQL show-sql: true","categories":[{"name":"Java","slug":"Java","permalink":"http://yoursite.com/categories/Java/"}],"tags":[{"name":"Spring Boot","slug":"Spring-Boot","permalink":"http://yoursite.com/tags/Spring-Boot/"},{"name":"MyBatis","slug":"MyBatis","permalink":"http://yoursite.com/tags/MyBatis/"},{"name":"JPA","slug":"JPA","permalink":"http://yoursite.com/tags/JPA/"},{"name":"Druid","slug":"Druid","permalink":"http://yoursite.com/tags/Druid/"},{"name":"JDBC","slug":"JDBC","permalink":"http://yoursite.com/tags/JDBC/"}]},{"title":"Dockerçš„ä½¿ç”¨","slug":"Software/Docker çš„ä½¿ç”¨","date":"2020-03-04T09:40:46.000Z","updated":"2020-04-25T08:03:44.907Z","comments":true,"path":"2020/03/04/Software/Docker çš„ä½¿ç”¨/","link":"","permalink":"http://yoursite.com/2020/03/04/Software/Docker%20%E7%9A%84%E4%BD%BF%E7%94%A8/","excerpt":"Docker æ˜¯ä¸€ä¸ªå¼€æºçš„åº”ç”¨å®¹å™¨å¼•æ“ï¼Œæ˜¯ä¸€ä¸ªè½»é‡çº§å®¹å™¨æŠ€æœ¯ã€‚Docker æ”¯æŒå°†è½¯ä»¶ç¼–è¯‘æˆä¸€ä¸ªé•œåƒï¼Œç„¶ååœ¨é•œåƒä¸­å„ç§è½¯ä»¶åšå¥½é…ç½®ï¼Œå°†é•œåƒå‘å¸ƒå‡ºå»ï¼Œå…¶ä»–ä½¿ç”¨è€…å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªé•œåƒï¼Œè¿è¡Œä¸­çš„è¿™ä¸ªé•œåƒç§°ä¸ºå®¹å™¨ï¼Œå®¹å™¨å¯åŠ¨æ˜¯éå¸¸å¿«é€Ÿçš„ã€‚","text":"Docker æ˜¯ä¸€ä¸ªå¼€æºçš„åº”ç”¨å®¹å™¨å¼•æ“ï¼Œæ˜¯ä¸€ä¸ªè½»é‡çº§å®¹å™¨æŠ€æœ¯ã€‚Docker æ”¯æŒå°†è½¯ä»¶ç¼–è¯‘æˆä¸€ä¸ªé•œåƒï¼Œç„¶ååœ¨é•œåƒä¸­å„ç§è½¯ä»¶åšå¥½é…ç½®ï¼Œå°†é•œåƒå‘å¸ƒå‡ºå»ï¼Œå…¶ä»–ä½¿ç”¨è€…å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªé•œåƒï¼Œè¿è¡Œä¸­çš„è¿™ä¸ªé•œåƒç§°ä¸ºå®¹å™¨ï¼Œå®¹å™¨å¯åŠ¨æ˜¯éå¸¸å¿«é€Ÿçš„ã€‚ ç¯å¢ƒæ­å»ºCentOS 7 ä¸‹è½½ï¼šé˜¿é‡Œäº‘é•œåƒ VMware åˆ›å»ºè™šæ‹Ÿæœºè¿è¡Œ CentOS 7 å…‰ç›˜æ˜ åƒæ–‡ä»¶ã€‚ é€‰æ‹© &gt; SYSTEM &gt; INSTALLATION DESTINATIONï¼Œè¿›å…¥ç£ç›˜åˆ†åŒºç•Œé¢ï¼› é€‰æ‹© &gt; I will configure partitioning &gt; Done &gt; partitioning scheme &gt; Standard Partition &gt; + &gt;ï¼š æŒ‚è½½ç‚¹ï¼šswapï¼ŒæœŸæœ›å®¹é‡ï¼š4096ï¼›æŒ‚è½½ç‚¹ï¼š/ï¼ŒæœŸæœ›å®¹é‡ï¼šç•™ç©ºã€‚é€‰æ‹© &gt; SOFTWARE &gt; Minimal Installã€‚Begin Install &gt; è®¾ç½®å¯†ç  &gt; Reboot &gt; åˆå§‹åŒ–å®Œæˆã€‚ ç½‘ç»œé…ç½® CentOS 7.x é»˜è®¤å®‰è£…å¥½ä¹‹åæ˜¯æ²¡æœ‰è‡ªåŠ¨å¼€å¯ç½‘ç»œè¿æ¥çš„ï¼Œéœ€è¦è‡ªè¡Œé…ç½®ã€‚ ï¼ï¼ï¼æ³¨æ„ï¼ï¼ï¼VMWare ç½‘ç»œé€‰æ‹©æ¡¥æ¥æ¨¡å¼ã€‚ 1234cat /etc/sysconfig/network-scripts/ifcfg-ens33 # é»˜è®¤çš„ç½‘ç»œé…ç½®æ–‡ä»¶mv ifcfg-ens33 ifcfg-eth0 # ä¿®æ”¹ä¹ æƒ¯æ€§å‘½åip address # æŸ¥çœ‹ MACvi /etc/sysconfig/network-scripts/ifcfg-eth0 # ä¿®æ”¹é…ç½® æ³¨æ„ï¼šé»˜è®¤ç½‘å…³ä¸€è‡´ï¼›DHCP åŠ¨æ€åˆ†é…æ”¹ä¸º STATIC é™æ€æ¨¡å¼ï¼›é™æ€ IP åœ°å€å¡«å†™ä¸ä¸»æœºç›¸åŒçš„ç½‘æ®µå†…ï¼›MAC åœ°å€éšæœºåˆ†é…ï¼Œä¸å¯é‡å¤ï¼Œå¤åˆ¶ä¸»æœºçš„æ—¶å€™è®°å¾—ä¿®æ”¹ã€‚ä¸€ä¸‹æ˜¯éœ€è¦ä¿®æ”¹çš„é…ç½®ï¼š ä¿®æ”¹ä¸»æœºåï¼šhostnamectl set-hostname [new_hostname] --static Docker å®‰è£…1yum -y install docker æ ¸å¿ƒæ¦‚å¿µDocker ä¸»æœº Hostï¼šå®‰è£…äº† Docker ç¨‹åºçš„æœºå™¨ï¼ˆDocker ç›´æ¥å®‰è£…åœ¨æ“ä½œç³»ç»Ÿä¹‹ä¸Šï¼‰ï¼› Docker å®¢æˆ·ç«¯ Clientï¼šè¿æ¥ Docker ä¸»æœºè¿›è¡Œæ“ä½œï¼› Docker ä»“åº“ Registryï¼šç”¨æ¥ä¿å­˜å„ç§æ‰“åŒ…å¥½çš„è½¯ä»¶é•œåƒï¼› Docker é•œåƒ Imagesï¼šè½¯ä»¶æ‰“åŒ…å¥½çš„é•œåƒ,æ”¾åœ¨ Docker ä»“åº“ä¸­ï¼› Docker å®¹å™¨ Containerï¼šé•œåƒå¯åŠ¨åçš„å®ä¾‹ç§°ä¸ºä¸€ä¸ªå®¹å™¨ï¼›å®¹å™¨æ˜¯ç‹¬ç«‹è¿è¡Œçš„ä¸€ä¸ªæˆ–ä¸€ç»„åº”ç”¨ã€‚ Docker ä½¿ç”¨ è™šæ‹Ÿæœºè®°å¾—è®¾ç½®æ¡¥æ¥ç½‘ç»œå¹¶é€‰æ‹©å¯¹åº”çš„ç½‘å¡æ¥å…¥ç½‘çº¿ã€‚ 1234# è®¾ç½®å¥½ç½‘ç»œä»¥åä½¿ç”¨å‘½ä»¤é‡å¯è™šæ‹Ÿæœºçš„ç½‘ç»œservice network restart# æŸ¥çœ‹ Linux çš„ IP åœ°å€ip addr Linux ç¯å¢ƒä¸‹ Docker çš„å®‰è£…ï¼š 12345678910111213# æ£€æŸ¥å†…æ ¸ç‰ˆæœ¬ï¼ŒDocker è¦æ±‚å†…æ ¸ç‰ˆæœ¬å¿…é¡»æ˜¯ 3.10 åŠä»¥ä¸Šuname -sr# å®‰è£… Dockeryum install docker# è¾“å…¥ y ç¡®è®¤å®‰è£…# å¯åŠ¨ Dockersystemctl start docker# æŸ¥çœ‹ç‰ˆæœ¬docker -v# å¼€æœºå¯åŠ¨ Dockersystemctl enable docker# åœæ­¢ Dockersystemctl stop docker Docker å¸¸ç”¨å‘½ä»¤æ“ä½œ æ“ä½œ å‘½ä»¤ è¯´æ˜ æ£€ç´¢ docker search [name] æˆ‘ä»¬ç»å¸¸å» docker hub ä¸Šæ£€ç´¢é•œåƒçš„è¯¦ç»†ä¿¡æ¯ï¼Œå¦‚é•œåƒçš„ tag æ‹‰å– docker pull [name]:tag :tag æ˜¯å¯é€‰çš„ï¼Œtag è¡¨ç¤ºæ ‡ç­¾ï¼Œå¤šä¸ºè½¯ä»¶çš„ç‰ˆæœ¬ï¼Œé»˜è®¤æ˜¯ latest åˆ—è¡¨ docker images æŸ¥çœ‹æ‰€æœ‰æœ¬åœ°é•œåƒ åˆ é™¤ docker rm image-id åˆ é™¤æŒ‡å®šçš„æœ¬åœ°é•œåƒ 123456789101112131415161718192021222324252627# æœç´¢é•œåƒdocker search tomcat# æ‹‰å–é•œåƒdocker pull tomcat# æ ¹æ®é•œåƒå¯åŠ¨å®¹å™¨ï¼Œæ²¡æœ‰åšæ˜ å°„æ— æ³•æ­£å¸¸è®¿é—®docker run --name mytomcat -d tomcat:latest# æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨docker ps # åœæ­¢è¿è¡Œä¸­çš„å®¹å™¨docker stop cantainerId# æŸ¥çœ‹æ‰€æœ‰çš„å®¹å™¨ï¼Œè¿è¡Œä¸­å’Œå·²ç»é€€å‡ºçš„docker ps -a# å¯åŠ¨å®¹å™¨docker start cantainerId# åˆ é™¤ä¸€ä¸ªå®¹å™¨docker rm cantainerId# å¯åŠ¨ä¸€ä¸ªåšäº†ç«¯å£æ˜ å°„çš„ tomcatdocker run -d -p 8888:8080 tomcat# -dï¼šåå°è¿è¡Œ# -p: å°†ä¸»æœºçš„ç«¯å£æ˜ å°„åˆ°å®¹å™¨çš„ä¸€ä¸ªç«¯å£ ä¸»æœºç«¯å£:å®¹å™¨å†…éƒ¨çš„ç«¯å£# æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€service firewalld status# å…³é—­é˜²ç«å¢™service firewalld stop# æŸ¥çœ‹å®¹å™¨çš„æ—¥å¿—docker logs container-name/container-id# å…·ä½“é•œåƒçš„å¯åŠ¨æ“ä½œå¯ä»¥å‚è€ƒæ¯ä¸€ä¸ªé•œåƒçš„æ–‡æ¡£ å¸¸ç”¨é•œåƒå®‰è£…MySQL1234567891011# å®‰è£…å¹¶å¯åŠ¨ MySQL é•œåƒdocker pull mysqldocker run --name mysql01 -d mysqldocker ps -a# å‘ç°å®¹å™¨å¼‚å¸¸é€€å‡ºäº†ï¼ŒæŸ¥çœ‹é”™è¯¯æ—¥å¿—docker logs containerId# å‘ç°æ˜¯å› ä¸ºæ²¡æœ‰æŒ‡å®šè´¦å·å¯†ç # æ­£ç¡®å¯åŠ¨å¹¶æŒ‡å®šç«¯å£æ˜ å°„docker run -p 3306:3306 --name mysql01 -e MYSQL_ROOT_PASSWORD=123456 -d mysql# docker run --name mysql03 -v [è‡ªå®šä¹‰ MySQL é…ç½®æ–‡ä»¶çš„ç›®å½•]:/etc/mysql/conf.d -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag# docker run --name some-mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci RedisDocker Hub æŸ¥è¯¢ Redis æºã€‚ 123docker pull redisdocker images # æŸ¥çœ‹é•œåƒåç§°docker run -d -p 6379:6379 --name myredis [é•œåƒåç§°] # redis å®¢æˆ·ç«¯æµ‹è¯•è¿æ¥ RabbitMQ1docker run -d -p 5672:5672 -p 15672:15672 --hostname my_rabbitmq --name rabbitmq rabbitmq:management å¸¸è§é”™è¯¯1WARNING: IPv4 forwarding is disabled. Networking will not work. systemctl restart dockeré‡å¯ä¸€ä¸‹ Docker æœåŠ¡å³å¯ã€‚","categories":[{"name":"Software","slug":"Software","permalink":"http://yoursite.com/categories/Software/"}],"tags":[{"name":"Docker","slug":"Docker","permalink":"http://yoursite.com/tags/Docker/"},{"name":"MySQL","slug":"MySQL","permalink":"http://yoursite.com/tags/MySQL/"}]},{"title":"Spring Boot Web å¼€å‘","slug":"Spring Boot/Spring Boot Web å¼€å‘","date":"2020-03-03T06:08:47.000Z","updated":"2020-04-19T06:44:17.329Z","comments":true,"path":"2020/03/03/Spring Boot/Spring Boot Web å¼€å‘/","link":"","permalink":"http://yoursite.com/2020/03/03/Spring%20Boot/Spring%20Boot%20Web%20%E5%BC%80%E5%8F%91/","excerpt":"Spring Boot Web æ–¹é¢çš„å¼€å‘ä»‹ç»ã€‚","text":"Spring Boot Web æ–¹é¢çš„å¼€å‘ä»‹ç»ã€‚ è‡ªåŠ¨é…ç½®åŸç†ï¼š xxxAutoConfigurationï¼šå¸®æˆ‘ä»¬ç»™å®¹å™¨ä¸­è‡ªåŠ¨é…ç½®ç»„ä»¶ï¼› xxxPropertiesï¼šé…ç½®ç±»å°è£…é…ç½®æ–‡ä»¶çš„å†…å®¹ã€‚ é™æ€èµ„æºæ˜ å°„ä»¥ JAR åŒ…çš„æ–¹å¼•å…¥é™æ€èµ„æºï¼š 123456&lt;!-- å¼•å…¥ jquery-webjar åœ¨è®¿é—®çš„æ—¶å€™åªéœ€è¦å†™ webjars ä¸‹é¢èµ„æºçš„åç§°å³å¯ --&gt;&lt;dependency&gt; &lt;groupId&gt;org.webjars&lt;/groupId&gt; &lt;artifactId&gt;jquery&lt;/artifactId&gt; &lt;version&gt;3.3.1&lt;/version&gt;&lt;/dependency&gt; è®¿é—® jquery.jsï¼šlocalhost:8080/webjars/jquery/3.3.1/jquery.js è®¿é—®å½“å‰é¡¹ç›®çš„ä»»ä½•èµ„æºï¼Œéƒ½å»é™æ€èµ„æºæ–‡ä»¶å¤¹æ‰¾æ˜ å°„ã€‚ 12345&quot;classpath:&#x2F;META-INF&#x2F;resources&#x2F;&quot;, &quot;classpath:&#x2F;resources&#x2F;&quot;,&quot;classpath:&#x2F;static&#x2F;&quot;, &quot;classpath:&#x2F;public&#x2F;&quot; &quot;&#x2F;&quot;ï¼šå½“å‰é¡¹ç›®çš„æ ¹è·¯å¾„ Thymeleaf æ¨¡æ¿å¼•æ“123456789101112&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;!-- é»˜è®¤æ˜¯ 2.1.6 ç‰ˆæœ¬ --&gt; &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;&lt;/dependency&gt;&lt;!-- åˆ‡æ¢ Thymeleaf ç‰ˆæœ¬ --&gt;&lt;properties&gt; &lt;thymeleaf.version&gt;3.0.9.RELEASE&lt;/thymeleaf.version&gt; &lt;!-- å¸ƒå±€åŠŸèƒ½çš„æ”¯æŒç¨‹åº Thymeleaf3 ä¸»ç¨‹åº Layout2 ä»¥ä¸Šç‰ˆæœ¬ --&gt; &lt;!-- Thymeleaf2 layout1--&gt; &lt;thymeleaf-layout-dialect.version&gt;2.2.2&lt;/thymeleaf-layout-dialect.version&gt;&lt;/properties&gt; è‡ªåŠ¨é…ç½®Spriing Boot å¯¹äº Thymeleaf çš„è‡ªåŠ¨é…ç½® 12345678910# Enable template cachingspring thymeleaf cache=true# Template encodingspring thymeleaf encoding=UTF-8# Template mode to be applied to templates. See also StandardTemplateModeHandlersspring thymeleaf mode=HTML5# Prefix that gets prepended to view names when building a URLspring thymeleaf prefix=classpath: /templates/# Suffix that gets appended to view names when building a URLspring thymeleaf suffix=.html 12345678910111213@ConfigurationProperties(prefix = \"spring.thymeleaf\")public class ThymeleafProperties &#123; private static final Charset DEFAULT_ENCODING = Charset.forName(\"UTF-8\"); private static final MimeType DEFAULT_CONTENT_TYPE = MimeType.valueOf(\"text/html\"); public static final String DEFAULT_PREFIX = \"classpath:/templates/\"; public static final String DEFAULT_SUFFIX = \".html\"; // ...&#125; ä»è‡ªåŠ¨é…ç½®ç±»ä¸­å¯ä»¥çœ‹å‡ºåªè¦æˆ‘ä»¬æŠŠ HTML é¡µé¢æ”¾åœ¨classpath:/templates/ç›®å½•ä¸‹ Thymeleaf å°±èƒ½è‡ªåŠ¨æ¸²æŸ“ã€‚ Thymeleaf çš„ä½¿ç”¨123456789101112&lt;!DOCTYPE html&gt;&lt;!-- å¯¼å…¥ Thymeleaf çš„åç§°ç©ºé—´ --&gt;&lt;html lang=\"en\" xmlns:th=\"http://www.thymeleaf.org\"&gt;&lt;head&gt; &lt;meta charset=\"UTF-8\"&gt; &lt;title&gt;Title&lt;/title&gt;&lt;/head&gt;&lt;body&gt; &lt;!-- th:text è®¾ç½® div é‡Œé¢çš„æ–‡æœ¬å†…å®¹ --&gt; &lt;div th:text=\"$&#123;hello&#125;\"&gt;è¿™æ˜¯æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯&lt;/div&gt;&lt;/body&gt;&lt;/html&gt; å¸¸ç”¨æ ‡ç­¾ å¸¸ç”¨è¡¨è¾¾å¼ 123456789101112131415161718192021è¡Œå†…å†™æ³•ï¼š[[]] -&gt; th:text ä¼šè½¬ä¹‰ç‰¹æ®Šå­—ç¬¦[()] -&gt; th:utext ä¸ä¼šè½¬ä¹‰ç‰¹æ®Šå­—ç¬¦å†…ç½®å·¥å…·ç±»ï¼š#execInfo : information about the template being processed.#messages : methods for obtaining externalized messages inside variables expressions, in the same way as they would be obtained using #&#123;â€¦&#125; syntax.#uris : methods for escaping parts of URLs&#x2F;URIs#conversions : methods for executing the configured conversion service (if any).#dates : methods for java.util.Date objects: formatting, component extraction, etc.#calendars : analogous to #dates , but for java.util.Calendar objects.#numbers : methods for formatting numeric objects.#strings : methods for String objects: contains, startsWith, prepending&#x2F;appending, etc.#objects : methods for objects in general.#bools : methods for boolean evaluation.#arrays : methods for arrays.#lists : methods for lists.#sets : methods for sets.#maps : methods for maps.#aggregates : methods for creating aggregates on arrays or collections.#ids : methods for dealing with id attributes that might be repeated (for example, as a result of an iteration). Spring MVC è‡ªåŠ¨é…ç½®Sping Boot å¯¹ Spring MVC çš„é»˜è®¤é…ç½®ï¼šWebMvcAutoConfiguration 12345678910//ä½¿ç”¨ WebMvcConfigurerAdapter å¯ä»¥æ¥æ‰©å±• SpringMVC çš„åŠŸèƒ½@Configurationpublic class MyMvcConfig extends WebMvcConfigurerAdapter &#123; @Override public void addViewControllers(ViewControllerRegistry registry) &#123; // æµè§ˆå™¨å‘é€ /wingo è¯·æ±‚æ¥åˆ° success registry.addViewController(\"/wigno\").setViewName(\"success\"); &#125;&#125; ä¸èƒ½æ ‡æ³¨@EnableWebMvcï¼Œæ ‡æ³¨å Spring MVC çš„é»˜è®¤è‡ªåŠ¨è£…é…å°†ä¸ä¼šè¿›è¡Œï¼Œå³å¼€å‘è€…å…¨é¢æ¥ç®¡ Spring MVC Restful CRUDé»˜è®¤è®¿é—®é¦–é¡µï¼š 1234567891011121314151617// ä½¿ç”¨ WebMvcConfigurerAdapter å¯ä»¥æ¥æ‰©å±• Spring MVC çš„åŠŸèƒ½@Configurationpublic class MyMvcConfig extends WebMvcConfigurerAdapter &#123; // æ‰€æœ‰çš„ WebMvcConfigurerAdapter ç»„ä»¶éƒ½ä¼šä¸€èµ·èµ·ä½œç”¨ @Bean // å°†ç»„ä»¶æ³¨å†Œåœ¨å®¹å™¨ public WebMvcConfigurerAdapter webMvcConfigurerAdapter()&#123; WebMvcConfigurerAdapter adapter = new WebMvcConfigurerAdapter() &#123; @Override public void addViewControllers(ViewControllerRegistry registry) &#123; registry.addViewController(\"/\").setViewName(\"login\"); registry.addViewController(\"/index.html\").setViewName(\"login\"); &#125; &#125;; return adapter; &#125;&#125; å›½é™…åŒ–IDEA ä¼šè‡ªåŠ¨è¯†åˆ«å›½é™…åŒ–ç›®å½•ã€‚ IDEA è¿›è¡Œä¼˜åŒ–åçš„ä¾¿äºç¼–è¾‘çš„è§†å›¾ï¼šï¼ˆç‚¹å‡»å·¦ä¸‹è§’çš„ Resource Bundleï¼‰ Spring Boot ä¸­çš„æ¶ˆæ¯è‡ªåŠ¨é…ç½®ï¼š 12345678public class MessageSourceAutoConfiguration &#123; // ... // é»˜è®¤é…ç½®ä¸º spring.messages.basename=messages å³å›½é™…åŒ–èµ„æºé»˜è®¤æ”¾åœ¨ç±»è·¯å¾„ä¸‹çš„ messages.properties String basename = context.getEnvironment().getProperty(\"spring.messages.basename\", \"messages\"); //... &#125; 12# è‡ªå®šä¹‰å›½é™…åŒ–æ–‡ä»¶çš„ä½ç½®spring.message.basename=i18n.login é¡µé¢è·å–å›½é™…åŒ–çš„ä¿¡æ¯ï¼š 1234567891011121314151617181920212223242526272829303132333435363738&lt;!DOCTYPE html&gt;&lt;html lang=\"en\" xmlns:th=\"http://www.thymeleaf.org\"&gt; &lt;head&gt; &lt;meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"&gt; &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1, shrink-to-fit=no\"&gt; &lt;meta name=\"description\" content=\"\"&gt; &lt;meta name=\"author\" content=\"\"&gt; &lt;title&gt;Signin Template for Bootstrap&lt;/title&gt; &lt;!-- webjars å½¢å¼çš„é™æ€èµ„æºæ˜ å°„ --&gt; &lt;!-- Bootstrap core CSS --&gt; &lt;link href=\"asserts/css/bootstrap.min.css\" th:href=\"@&#123;/webjars/bootstrap/4.0.0/css/bootstrap.css&#125;\" rel=\"stylesheet\"&gt; &lt;!-- Custom styles for this template --&gt; &lt;link href=\"asserts/css/signin.css\" th:href=\"@&#123;/asserts/css/signin.css&#125;\" rel=\"stylesheet\"&gt; &lt;/head&gt; &lt;body class=\"text-center\"&gt; &lt;form class=\"form-signin\" action=\"dashboard.html\"&gt; &lt;img class=\"mb-4\" th:src=\"@&#123;/asserts/img/bootstrap-solid.svg&#125;\" src=\"asserts/img/bootstrap-solid.svg\" alt=\"\" width=\"72\" height=\"72\"&gt; &lt;!-- Thymeleaf ç”¨ #&#123;&#125; è¡¨è¾¾å¼å–å‡ºå›½é™…åŒ–ä¿¡æ¯ --&gt; &lt;h1 class=\"h3 mb-3 font-weight-normal\" th:text=\"#&#123;login.tip&#125;\"&gt;Please sign in&lt;/h1&gt; &lt;label class=\"sr-only\" th:text=\"#&#123;login.username&#125;\"&gt;Username&lt;/label&gt; &lt;input type=\"text\" class=\"form-control\" placeholder=\"Username\" th:placeholder=\"#&#123;login.username&#125;\" required=\"\" autofocus=\"\"&gt; &lt;label class=\"sr-only\" th:text=\"#&#123;login.password&#125;\"&gt;Password&lt;/label&gt; &lt;input type=\"password\" class=\"form-control\" placeholder=\"Password\" th:placeholder=\"#&#123;login.password&#125;\" required=\"\"&gt; &lt;div class=\"checkbox mb-3\"&gt; &lt;label&gt; &lt;input type=\"checkbox\" value=\"remember-me\"/&gt; [[#&#123;login.remember&#125;]] &lt;/label&gt; &lt;/div&gt; &lt;button class=\"btn btn-lg btn-primary btn-block\" type=\"submit\" th:text=\"#&#123;login.btn&#125;\"&gt;Sign in&lt;/button&gt; &lt;p class=\"mt-5 mb-3 text-muted\"&gt;Â© 2017-2018&lt;/p&gt; &lt;a class=\"btn btn-sm\"&gt;ä¸­æ–‡&lt;/a&gt; &lt;a class=\"btn btn-sm\"&gt;English&lt;/a&gt; &lt;/form&gt; &lt;/body&gt;&lt;/html&gt; æ ¹æ®æµè§ˆå™¨è¯·æ±‚ä¸­æ‰€æºå¸¦çš„å›½é™…åŒ– Locale ä¿¡æ¯è¿›è¡Œè¯­è¨€çš„è½¬æ¢ã€‚ 123456789101112131415@Bean@ConditionalOnMissingBean@ConditionalOnProperty( prefix = \"spring.mvc\", name = &#123;\"locale\"&#125;)public LocaleResolver localeResolver() &#123; if (this.mvcProperties.getLocaleResolver() == org.springframework.boot.autoconfigure.web.servlet.WebMvcProperties.LocaleResolver.FIXED) &#123; return new FixedLocaleResolver(this.mvcProperties.getLocale()); &#125; else &#123; AcceptHeaderLocaleResolver localeResolver = new AcceptHeaderLocaleResolver(); localeResolver.setDefaultLocale(this.mvcProperties.getLocale()); return localeResolver; &#125;&#125; å¯ä»¥åœ¨åˆ‡æ¢è¯­è¨€çš„çš„é“¾æ¥ä¸Šæºå¸¦åŒºåŸŸä¿¡æ¯ï¼Œè¿›è¡Œè¯­è¨€åˆ‡æ¢ã€‚ 12345678910111213141516171819202122public class MyLocaleResolver implements LocaleResolver &#123; @Override public Locale resolveLocale(HttpServletRequest request) &#123; String myLocale = request.getParameter(\"locale\"); Locale locale = Locale.getDefault(); if(!StringUtils.isEmpty(myLocale))&#123; String[] split = myLocate.split(\"_\"); //å›½å®¶ è¯­è¨€ locale = new Locale(split[0],split[1]); &#125; return locale; &#125; @Override public void setLocale(HttpServletRequest request, HttpServletResponse response, Locale locale) &#123;&#125; @Bean public LocaleResolver localeResolver()&#123; return new MyLocaleResolver(); &#125;&#125; ç”¨æˆ·ç™»å½•12# ç¦ç”¨ç¼“å­˜spring.thymeleaf.cache&#x3D;false ä¿®æ”¹äº†é¡µé¢å Ctrl + F9 è¿›è¡Œé‡æ–°ç¼–è¯‘ 123&lt;!-- ç™»å½•é”™è¯¯æ¶ˆæ¯æ˜¾ç¤º --&gt;&lt;!-- ä½¿ç”¨ Thymeleaf å†…ç½®å·¥å…·ç±» #Srting, å–ä¼ é€’å˜é‡çš„å€¼ $&#123;&#125; è¡¨è¾¾å¼--&gt;&lt;p style=\"color: red\" th:text=\"$&#123;msg&#125;\" th:if=\"$&#123;not #strings.isEmpty(msg)&#125;\"&gt;&lt;/p&gt; æ‹¦æˆªå™¨æ‹¦æˆªå™¨çš„ç¼–å†™ï¼š 12345678910111213141516171819public class LoginHandlerInterceptor implements HandlerInterceptor &#123; // ç›®æ ‡æ–¹æ³•æ‰§è¡Œä¹‹å‰ @Override public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception &#123; // ç”¨æˆ·ç™»å½•ååœ¨ Session ä¸­ä¿å­˜ç”¨æˆ·æ ‡å¿— Object user = request.getSession().getAttribute(\"loginUser\"); if(user == null)&#123; // æœªç™»é™†ï¼Œè¿”å›ç™»é™†é¡µé¢ request.setAttribute(\"msg\",\"æ²¡æœ‰æƒé™è¯·å…ˆç™»é™†\"); request.getRequestDispatcher(\"/index.html\").forward(request,response); return false; &#125;else&#123; // å·²ç™»é™†ï¼Œæ”¾è¡Œè¯·æ±‚ return true; &#125; &#125; // çœç•¥å…¶å®ƒä¸éœ€è¦ç¼–å†™çš„æŠ½è±¡æ–¹æ³•&#125; æ³¨å†Œæ‹¦æˆªå™¨ 123456789101112131415161718192021// æ‰€æœ‰çš„ WebMvcConfigurerAdapter ç»„ä»¶éƒ½ä¼šä¸€èµ·èµ·ä½œç”¨@Bean // å°†ç»„ä»¶æ³¨å†Œåœ¨å®¹å™¨public WebMvcConfigurerAdapter webMvcConfigurerAdapter()&#123; WebMvcConfigurerAdapter adapter = new WebMvcConfigurerAdapter() &#123; @Override public void addViewControllers(ViewControllerRegistry registry) &#123; registry.addViewController(\"/\").setViewName(\"login\"); registry.addViewController(\"/index.html\").setViewName(\"login\"); &#125; // æ³¨å†Œæ‹¦æˆªå™¨ @Override public void addInterceptors(InterceptorRegistry registry) &#123; // super.addInterceptors(registry); // é™æ€èµ„æº *.css , *.js SpringBoot å·²ç»åšå¥½äº†æ˜ å°„ // é™¤äº†è®¿é—®ç™»å½•é¡µé¢çš„ URL å…¶ä½™çš„ URL å…¨éƒ¨è¿›è¡Œæ‹¦æˆªè®¤è¯ registry.addInterceptor(new LoginHandlerInterceptor()).addPathPatterns(\"/**\") .excludePathPatterns(\"/index.html\",\"/\",\"/user/login\"); &#125; &#125;; return adapter;&#125; å‘˜å·¥åˆ—è¡¨ æ™®é€šCRUDï¼ˆURI æ¥åŒºåˆ†æ“ä½œï¼‰ RestfulCRUD æŸ¥è¯¢ getEmp empâ€”GET æ·»åŠ  addEmp?xxx empâ€”POST ä¿®æ”¹ updateEmp?id=xxx&amp;xxx=xx emp/{id}â€”PUT åˆ é™¤ deleteEmp?id=1 emp/{id}â€”DELETE æœ¬æ¬¡å®éªŒçš„è¯·æ±‚æ¶æ„ï¼š å®éªŒåŠŸèƒ½ è¯·æ±‚URI è¯·æ±‚æ–¹å¼ æŸ¥è¯¢æ‰€æœ‰å‘˜å·¥ emps GET æŸ¥è¯¢æŸä¸ªå‘˜å·¥ï¼ˆæ¥åˆ°ä¿®æ”¹é¡µé¢ï¼‰ emp/{id} GET æ¥åˆ°æ·»åŠ é¡µé¢ emp GET æ·»åŠ å‘˜å·¥ emp POST æ¥åˆ°ä¿®æ”¹é¡µé¢ï¼ˆæŸ¥å‡ºå‘˜å·¥è¿›è¡Œä¿¡æ¯å›æ˜¾ï¼‰ emp/{id} GET ä¿®æ”¹å‘˜å·¥ emp PUT åˆ é™¤å‘˜å·¥ emp/{id} DELETE å‘˜å·¥åˆ—è¡¨ï¼ŒThymeleaf å…¬å…±é¡µé¢å…ƒç´ æŠ½å–ã€‚ 123456789101112131415161718192021222324252627282930&lt;!-- common/footer.html æŠ½å–å…¬å…±ç‰‡æ®µ --&gt;&lt;footer th:fragment=\"copy\"&gt; &amp;copy; 2011 The Good Thymes Virtual Grocery&lt;/footer&gt;&lt;!-- å¼•å…¥å…¬å…±ç‰‡æ®µ --&gt;&lt;div th:insert=\"footer::copy\"&gt;&lt;/div&gt;&lt;div th:replace=\"footer::copy\"&gt;&lt;/div&gt;&lt;div th:include=\"footer::copy\"&gt;&lt;/div&gt;&lt;!-- ~&#123;templatename::selector&#125;ï¼šæ¨¡æ¿å::é€‰æ‹©å™¨~&#123;templatename::fragmentname&#125;:æ¨¡æ¿å::ç‰‡æ®µåinsert çš„å…¬å…±ç‰‡æ®µåœ¨ div æ ‡ç­¾ä¸­ï¼Œå¦‚æœä½¿ç”¨ th:insert ç­‰å±æ€§è¿›è¡Œå¼•å…¥ï¼Œå¯ä»¥ä¸ç”¨å†™ ~&#123;&#125;ï¼›ï¼›è¡Œå†…å†™æ³•å¯ä»¥åŠ ä¸Šï¼š[[~&#123;&#125;]] [(~&#123;&#125;)]--&gt;&lt;!-- æ•ˆæœ --&gt;&lt;div&gt; &lt;footer&gt; &amp;copy; 2011 The Good Thymes Virtual Grocery &lt;/footer&gt;&lt;/div&gt;&lt;footer&gt; &amp;copy; 2011 The Good Thymes Virtual Grocery&lt;/footer&gt;&lt;div&gt; &amp;copy; 2011 The Good Thymes Virtual Grocery&lt;/div&gt; å¼•å…¥ç‰‡æ®µæ—¶ä¼ é€’å‚æ•°ï¼š 12345678&lt;!--å¼•å…¥ä¾§è¾¹æ å¹¶ä¼ å…¥å‚æ•°ï¼›æ­¤å¤„ç”¨çš„ id é€‰æ‹©å™¨æ¥å¼•å…¥ç‰‡æ®µ --&gt;&lt;div th:replace=\"commons/bar::#sidebar(activeUri='emps')\"&gt;&lt;/div&gt;&lt;!-- åº”ç”¨åœºæ™¯ï¼šç‚¹å‡»ä¾§è¾¹æ çš„é€‰é¡¹ï¼Œè¢«ç‚¹å‡»çš„é€‰é¡¹æ ·å¼å‘ç”Ÿæ”¹å˜ï¼Œå˜ä¸ºé«˜äº® --&gt;&lt;!-- è§£å†³æ–¹å¼ï¼šé¡µé¢å¼•ç”¨æ—¶æ‰€ä¼ é€’çš„å‚æ•°è¿›è¡Œæ ·å¼çš„ä¿®æ”¹ï¼Œç”Ÿæˆçš„ä¾§è¾¹æ æ ·å¼æ ¹æ®ä¼ å…¥çš„å‚æ•°æ”¹å˜æ ·å¼ --&gt;&lt;a class=\"nav-link active\" th:class=\"$&#123;activeUri=='main.html'?'nav-link active':'nav-link'&#125;\" href=\"#\" th:href=\"@&#123;/main.html&#125;\"&gt; æ·»åŠ åŠä¿®æ”¹123456789101112131415161718192021222324252627282930313233343536373839404142434445&lt;!-- éœ€è¦åŒºåˆ†æ˜¯å‘˜å·¥ä¿®æ”¹è¿˜æ˜¯æ·»åŠ  --&gt;&lt;form th:action=\"@&#123;/emp&#125;\" method=\"post\"&gt;&lt;!-- å‘é€ put è¯·æ±‚ä¿®æ”¹å‘˜å·¥æ•°æ®--&gt; &lt;!-- Spring MVC ä¸­é…ç½® HiddenHttpMethodFilterï¼›ï¼ˆSpringBootè‡ªåŠ¨é…ç½®å¥½çš„ï¼‰ é¡µé¢åˆ›å»ºä¸€ä¸ªpostè¡¨å•ï¼› åˆ›å»ºä¸€ä¸ª input é¡¹ï¼Œname=\"_method\"ï¼›value å°±æ˜¯æˆ‘ä»¬æŒ‡å®šçš„è¯·æ±‚æ–¹å¼ã€‚ --&gt; &lt;!-- è‹¥ emp æºå¸¦ä¿¡æ¯ï¼Œåˆ™æ­¤è¡¨å•æäº¤çš„æ˜¯ put è¯·æ±‚ --&gt; &lt;input type=\"hidden\" name=\"_method\" value=\"put\" th:if=\"$&#123;emp!=null&#125;\"/&gt; &lt;!-- ä¿®æ”¹éœ€è¦æºå¸¦å‘˜å·¥ id ç”¨äºä¿å­˜ä¿®æ”¹ --&gt; &lt;input type=\"hidden\" name=\"id\" th:if=\"$&#123;emp!=null&#125;\" th:value=\"$&#123;emp.id&#125;\"&gt; &lt;div class=\"form-group\"&gt; &lt;label&gt;LastName&lt;/label&gt; &lt;input name=\"lastName\" type=\"text\" class=\"form-control\" placeholder=\"zhangsan\" th:value=\"$&#123;emp!=null&#125;?$&#123;emp.lastName&#125;\"&gt; &lt;/div&gt; &lt;div class=\"form-group\"&gt; &lt;label&gt;Email&lt;/label&gt; &lt;input name=\"email\" type=\"email\" class=\"form-control\" placeholder=\"zhangsan@atguigu.com\" th:value=\"$&#123;emp!=null&#125;?$&#123;emp.email&#125;\"&gt; &lt;/div&gt; &lt;div class=\"form-group\"&gt; &lt;label&gt;Gender&lt;/label&gt;&lt;br/&gt; &lt;div class=\"form-check form-check-inline\"&gt; &lt;input class=\"form-check-input\" type=\"radio\" name=\"gender\" value=\"1\" th:checked=\"$&#123;emp!=null&#125;?$&#123;emp.gender==1&#125;\"&gt; &lt;label class=\"form-check-label\"&gt;ç”·&lt;/label&gt; &lt;/div&gt; &lt;div class=\"form-check form-check-inline\"&gt; &lt;input class=\"form-check-input\" type=\"radio\" name=\"gender\" value=\"0\" th:checked=\"$&#123;emp!=null&#125;?$&#123;emp.gender==0&#125;\"&gt; &lt;label class=\"form-check-label\"&gt;å¥³&lt;/label&gt; &lt;/div&gt; &lt;/div&gt; &lt;div class=\"form-group\"&gt; &lt;label&gt;department&lt;/label&gt; &lt;!--æäº¤çš„æ˜¯éƒ¨é—¨çš„id--&gt; &lt;select class=\"form-control\" name=\"department.id\"&gt; &lt;option th:selected=\"$&#123;emp!=null&#125;?$&#123;dept.id == emp.department.id&#125;\" th:value=\"$&#123;dept.id&#125;\" th:each=\"dept:$&#123;depts&#125;\" th:text=\"$&#123;dept.departmentName&#125;\"&gt;1&lt;/option&gt; &lt;/select&gt; &lt;/div&gt; &lt;div class=\"form-group\"&gt; &lt;label&gt;Birth&lt;/label&gt; &lt;!-- #dates å·¥å…·ç±»è¿›è¡Œæ—¶é—´æ ¼å¼åŒ– --&gt; &lt;input name=\"birth\" type=\"text\" class=\"form-control\" placeholder=\"zhangsan\" th:value=\"$&#123;emp!=null&#125;?$&#123;#dates.format(emp.birth, 'yyyy-MM-dd HH:mm')&#125;\"&gt; &lt;/div&gt; &lt;button type=\"submit\" class=\"btn btn-primary\" th:text=\"$&#123;emp!=null&#125;?'ä¿®æ”¹':'æ·»åŠ '\"&gt;æ·»åŠ &lt;/button&gt;&lt;/form&gt; åˆ é™¤12345678910111213141516171819202122&lt;tr th:each=\"emp:$&#123;emps&#125;\"&gt; &lt;td th:text=\"$&#123;emp.id&#125;\"&gt;&lt;/td&gt; &lt;td&gt;[[$&#123;emp.lastName&#125;]]&lt;/td&gt; &lt;td th:text=\"$&#123;emp.email&#125;\"&gt;&lt;/td&gt; &lt;td th:text=\"$&#123;emp.gender&#125;==0?'å¥³':'ç”·'\"&gt;&lt;/td&gt; &lt;td th:text=\"$&#123;emp.department.departmentName&#125;\"&gt;&lt;/td&gt; &lt;td th:text=\"$&#123;#dates.format(emp.birth, 'yyyy-MM-dd HH:mm')&#125;\"&gt;&lt;/td&gt; &lt;td&gt; &lt;a class=\"btn btn-sm btn-primary\" th:href=\"@&#123;/emp/&#125;+$&#123;emp.id&#125;\"&gt;ç¼–è¾‘&lt;/a&gt; &lt;!-- th:attr æ ‡ç­¾è‡ªå®šä¹‰å±æ€§åŠå€¼ --&gt; &lt;button th:attr=\"del_uri=@&#123;/emp/&#125;+$&#123;emp.id&#125;\" class=\"btn btn-sm btn-danger deleteBtn\"&gt;åˆ é™¤&lt;/button&gt; &lt;/td&gt;&lt;/tr&gt;&lt;script&gt; $(\".deleteBtn\").click(function()&#123; // åˆ é™¤å½“å‰å‘˜å·¥ $(\"#deleteEmpForm\").attr(\"action\",$(this).attr(\"del_uri\")).submit(); return false; &#125;);&lt;/script&gt; é”™è¯¯å¤„ç†æœºåˆ¶Spring Boot é»˜è®¤çš„é”™è¯¯å¤„ç†æœºåˆ¶ã€‚ é»˜è®¤æ•ˆæœï¼šå¯¹äºæµè§ˆå™¨ï¼ŒSpring Boot è¿”å›ä¸€ä¸ªé»˜è®¤çš„é”™è¯¯é¡µé¢ï¼›å¯¹äºå…¶å®ƒå®¢æˆ·ç«¯ï¼Œé»˜è®¤å“åº”ä¸€ä¸ª Json æ•°æ®ã€‚ 1234567891011// å¸®æˆ‘ä»¬åœ¨é¡µé¢å…±äº«ä¿¡æ¯@Overridepublic Map&lt;String, Object&gt; getErrorAttributes(RequestAttributes requestAttributes, boolean includeStackTrace) &#123; Map&lt;String, Object&gt; errorAttributes = new LinkedHashMap&lt;String, Object&gt;(); errorAttributes.put(\"timestamp\", new Date()); addStatus(errorAttributes, requestAttributes); addErrorDetails(errorAttributes, requestAttributes, includeStackTrace); addPath(errorAttributes, requestAttributes); return errorAttributes;&#125; 1234567891011121314151617181920212223242526// å¤„ç†é»˜è®¤ /error è¯·æ±‚@Controller@RequestMapping(\"$&#123;server.error.path:$&#123;error.path:/error&#125;&#125;\") // é»˜è®¤ä¸ºé”™è¯¯é¡µé¢è·¯å¾„ /errorpublic class BasicErrorController extends AbstractErrorController &#123; @RequestMapping(produces = \"text/html\") // äº§ç”Ÿ HTML ç±»å‹çš„æ•°æ®ï¼›æµè§ˆå™¨å‘é€çš„è¯·æ±‚æ¥åˆ°è¿™ä¸ªæ–¹æ³•å¤„ç† public ModelAndView errorHtml(HttpServletRequest request, HttpServletResponse response) &#123; HttpStatus status = getStatus(request); Map&lt;String, Object&gt; model = Collections.unmodifiableMap(getErrorAttributes( request, isIncludeStackTrace(request, MediaType.TEXT_HTML))); response.setStatus(status.value()); // å»å“ªä¸ªé¡µé¢ä½œä¸ºé”™è¯¯é¡µé¢ï¼ŒåŒ…å«é¡µé¢åœ°å€å’Œé¡µé¢å†…å®¹ ModelAndView modelAndView = resolveErrorView(request, response, status, model); return (modelAndView == null ? new ModelAndView(\"error\", model) : modelAndView); &#125; @RequestMapping @ResponseBody // äº§ç”Ÿ Json æ•°æ®ï¼Œå…¶ä»–å®¢æˆ·ç«¯æ¥åˆ°è¿™ä¸ªæ–¹æ³•å¤„ç† public ResponseEntity&lt;Map&lt;String, Object&gt;&gt; error(HttpServletRequest request) &#123; Map&lt;String, Object&gt; body = getErrorAttributes(request, isIncludeStackTrace(request, MediaType.ALL)); HttpStatus status = getStatus(request); return new ResponseEntity&lt;Map&lt;String, Object&gt;&gt;(body, status); &#125; 1234567891011121314151617181920212223@Overridepublic ModelAndView resolveErrorView(HttpServletRequest request, HttpStatus status, Map&lt;String, Object&gt; model) &#123; ModelAndView modelAndView = resolve(String.valueOf(status), model); if (modelAndView == null &amp;&amp; SERIES_VIEWS.containsKey(status.series())) &#123; modelAndView = resolve(SERIES_VIEWS.get(status.series()), model); &#125; return modelAndView;&#125;private ModelAndView resolve(String viewName, Map&lt;String, Object&gt; model) &#123; // é»˜è®¤ Spring Boot å¯ä»¥å»æ‰¾åˆ°ä¸€ä¸ªé¡µé¢ error/404 String errorViewName = \"error/\" + viewName; // æ¨¡æ¿å¼•æ“å¯ä»¥è§£æè¿™ä¸ªé¡µé¢åœ°å€å°±ç”¨æ¨¡æ¿å¼•æ“è§£æ TemplateAvailabilityProvider provider = this.templateAvailabilityProviders .getProvider(errorViewName, this.applicationContext); if (provider != null) &#123; // æ¨¡æ¿å¼•æ“å¯ç”¨çš„æƒ…å†µä¸‹è¿”å›åˆ° errorViewName æŒ‡å®šçš„è§†å›¾åœ°å€ return new ModelAndView(errorViewName, model); &#125; //æ¨¡æ¿å¼•æ“ä¸å¯ç”¨ï¼Œå°±åœ¨é™æ€èµ„æºæ–‡ä»¶å¤¹ä¸‹æ‰¾ errorViewName å¯¹åº”çš„é¡µé¢ error/404.html return resolveResource(errorViewName, model);&#125; ä¸€ä½†ç³»ç»Ÿå‡ºç° 4xx æˆ–è€… 5xx ä¹‹ç±»çš„é”™è¯¯ï¼ŒErrorPageCustomizer å°±ä¼šç”Ÿæ•ˆï¼ˆå®šåˆ¶é”™è¯¯çš„å“åº”è§„åˆ™ï¼‰ï¼Œå°±ä¼šæ¥åˆ° /error è¯·æ±‚ï¼Œå°±ä¼šè¢«BasicErrorControllerå¤„ç†ã€‚ é”™è¯¯é¡µé¢çš„å®šåˆ¶æœ‰æ¨¡æ¿å¼•æ“çš„æƒ…å†µä¸‹ï¼šerror/çŠ¶æ€ç ï¼ˆå°†é”™è¯¯é¡µé¢å‘½åä¸º é”™è¯¯çŠ¶æ€ç  .html æ”¾åœ¨æ¨¡æ¿å¼•æ“æ–‡ä»¶å¤¹é‡Œé¢çš„ error æ–‡ä»¶å¤¹ä¸‹ï¼‰å‘ç”Ÿæ­¤çŠ¶æ€ç çš„é”™è¯¯å°±ä¼šæ¥åˆ°å¯¹åº”çš„é¡µé¢ã€‚ å¯ä»¥ä½¿ç”¨ 4xx å’Œ 5xx ä½œä¸ºé”™è¯¯é¡µé¢çš„æ–‡ä»¶åæ¥åŒ¹é…è¿™ç§ç±»å‹çš„æ‰€æœ‰é”™è¯¯ï¼Œç²¾ç¡®ä¼˜å…ˆã€‚ï¼ˆä¼˜å…ˆå¯»æ‰¾ç²¾ç¡®çš„ [çŠ¶æ€ç ].htmlï¼‰ 1234567é¡µé¢èƒ½è·å–çš„ä¿¡æ¯ï¼š timestampï¼šæ—¶é—´æˆ³ statusï¼šçŠ¶æ€ç  errorï¼šé”™è¯¯æç¤º exceptionï¼šå¼‚å¸¸å¯¹è±¡ messageï¼šå¼‚å¸¸æ¶ˆæ¯ errorsï¼šJSR303 æ•°æ®æ ¡éªŒçš„é”™è¯¯éƒ½åœ¨è¿™é‡Œ æ²¡æœ‰æ¨¡æ¿å¼•æ“ï¼ˆæ¨¡æ¿å¼•æ“æ‰¾ä¸åˆ°è¿™ä¸ªé”™è¯¯é¡µé¢ï¼‰ï¼Œé™æ€èµ„æºæ–‡ä»¶å¤¹ä¸‹æ‰¾ï¼Œä»¥ä¸Šéƒ½æ²¡æœ‰é”™è¯¯é¡µé¢ï¼Œå°±æ˜¯é»˜è®¤æ¥åˆ°SpringBooté»˜è®¤çš„é”™è¯¯æç¤ºé¡µé¢ã€‚ 12345678910111213141516// è‡ªå®šä¹‰å¼‚å¸¸å¤„ç† &amp; è¿”å›å®šåˆ¶ Json æ•°æ®@ControllerAdvicepublic class MyExceptionHandler &#123; @ResponseBody @ExceptionHandler(UserNotExistException.class) public Map&lt;String,Object&gt; handleException(Exception e)&#123; Map&lt;String,Object&gt; map = new HashMap&lt;&gt;(); // ä¼ å…¥æˆ‘ä»¬è‡ªå·±çš„é”™è¯¯çŠ¶æ€ç  4xx 5xxï¼Œå¦åˆ™å°±ä¸ä¼šè¿›å…¥å®šåˆ¶é”™è¯¯é¡µé¢çš„è§£ææµç¨‹ request.setAttribute(\"javax.servlet.error.status_code\",500); map.put(\"code\",\"user.notexist\"); map.put(\"message\",e.getMessage()); // ç”¨äºé”™è¯¯ä¿¡æ¯çš„è¯»å– request.setAttribute(\"userNotExist\",map); return \"forward:/error\"; &#125;&#125; 12345678910111213141516// ç»™å®¹å™¨ä¸­åŠ å…¥æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„ ErrorAttributes@Componentpublic class MyErrorAttributes extends DefaultErrorAttributes &#123; @Override public Map&lt;String, Object&gt; getErrorAttributes(RequestAttributes requestAttributes, boolean includeStackTrace) &#123; // è¿™ä¸ª map å°±æ˜¯é¡µé¢å’Œ Json èƒ½è·å–çš„æ‰€æœ‰å­—æ®µ Map&lt;String, Object&gt; map = super.getErrorAttributes(requestAttributes, includeStackTrace); map.put(\"company\", \"Welab\"); // å¼‚å¸¸å¤„ç†å™¨æºå¸¦çš„æ•°æ® Map&lt;String, Object&gt; map userNotExist = (Map&lt;String, Object&gt;)requestAttributes.getAttribute(\"userNotExist\",0); map.put(\"userNotExist\", userNotExist) return map; &#125;&#125; åµŒå…¥å¼ Servlet å®¹å™¨ç”±äº Spring Boot é»˜è®¤æ˜¯ä»¥ Jar åŒ…çš„æ–¹å¼å¯åŠ¨åµŒå…¥å¼çš„ Servlet å®¹å™¨æ¥å¯åŠ¨ Spring Boot çš„ web åº”ç”¨ï¼Œæ²¡æœ‰ web.xml æ–‡ä»¶ã€‚ Spring Boot ä¿®æ”¹å’Œ server æœ‰å…³çš„é…ç½®ï¼š 123456# æ–¹å¼ä¸€ï¼špropertiesserver.port=8081server.context-path=/crudserver.tomcat.uri-encoding=UTF-8# é€šç”¨çš„ Servlet å®¹å™¨è®¾ç½® server.xxx# Tomcat çš„è®¾ç½® server.tomcat.xxx 1234567891011// ç¼–å†™åµŒå…¥å¼çš„ Servlet å®¹å™¨çš„å®šåˆ¶å™¨æ¥ä¿®æ”¹ Servlet å®¹å™¨çš„é…ç½®@Bean //ä¸€å®šè¦å°†è¿™ä¸ªå®šåˆ¶å™¨åŠ å…¥åˆ°å®¹å™¨ä¸­public EmbeddedServletContainerCustomizer embeddedServletContainerCustomizer()&#123; return new EmbeddedServletContainerCustomizer() &#123; //å®šåˆ¶åµŒå…¥å¼çš„Servletå®¹å™¨ç›¸å…³çš„è§„åˆ™ @Override public void customize(ConfigurableEmbeddedServletContainer container) &#123; container.setPort(8083); &#125; &#125;;&#125; Servlet ä¸‰å¤§ç»„ä»¶çš„æ³¨å†Œ123456@Beanpublic ServletRegistrationBean myServlet()&#123; ServletRegistrationBean registrationBean = new ServletRegistrationBean( new MyServlet(),\"/myServlet\"); return registrationBean;&#125; 1234567@Beanpublic FilterRegistrationBean myFilter()&#123; FilterRegistrationBean registrationBean = new FilterRegistrationBean(); registrationBean.setFilter(new MyFilter()); registrationBean.setUrlPatterns(Arrays.asList(\"/hello\",\"/myServlet\")); return registrationBean;&#125; 123456@Beanpublic ServletListenerRegistrationBean myListener()&#123; ServletListenerRegistrationBean&lt;MyListener&gt; registrationBean = new ServletListenerRegistrationBean&lt;&gt;(new MyListener()); return registrationBean;&#125; æ›¿æ¢ Servlet å®¹å™¨ 12345&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;!-- å¼•å…¥ web æ¨¡å—é»˜è®¤å°±æ˜¯ä½¿ç”¨åµŒå…¥å¼çš„ Tomcat ä½œä¸º Servlet å®¹å™¨ --&gt;&lt;/dependency&gt; 123456789101112131415161718&lt;!-- å¼•å…¥webæ¨¡å— --&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;artifactId&gt;spring-boot-starter-tomcat&lt;/artifactId&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt;&lt;/dependency&gt;&lt;!--å¼•å…¥å…¶ä»–çš„Servletå®¹å™¨--&gt;&lt;dependency&gt; &lt;artifactId&gt;spring-boot-starter-jetty&lt;/artifactId&gt; &lt;!-- spring-boot-starter-undertow --&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&lt;/dependency&gt; å¤–ç½® Servlet å®¹å™¨ï¼ï¼ï¼åˆ›å»ºçš„å¿…é¡»æ˜¯ä¸€ä¸ª war é¡¹ç›®ï¼ˆåˆ©ç”¨ IDEA åˆ›å»ºå¥½ç›®å½•ç»“æ„ï¼‰ 123456&lt;!-- å°†åµŒå…¥å¼çš„ Tomcat æŒ‡å®šä¸º provided --&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-tomcat&lt;/artifactId&gt; &lt;scope&gt;provided&lt;/scope&gt;&lt;/dependency&gt; å¿…é¡»è¦ç¼–å†™ä¸€ä¸ª SpringBootServletInitializer çš„å­ç±»ï¼Œå¹¶è°ƒç”¨ configure() æ–¹æ³•ã€‚ 123456789public class ServletInitializer extends SpringBootServletInitializer &#123; @Override protected SpringApplicationBuilder configure(SpringApplicationBuilder application) &#123; // ä¼ å…¥ SpringBoot åº”ç”¨çš„ä¸»ç¨‹åº return application.sources(SpringBootMyApplication.class); &#125;&#125; REST æ¶æ„é£æ ¼","categories":[{"name":"Java","slug":"Java","permalink":"http://yoursite.com/categories/Java/"}],"tags":[{"name":"Spring Boot","slug":"Spring-Boot","permalink":"http://yoursite.com/tags/Spring-Boot/"},{"name":"Web","slug":"Web","permalink":"http://yoursite.com/tags/Web/"}]},{"title":"Spring Boot æ—¥å¿—","slug":"Spring Boot/Spring Boot æ—¥å¿—æ¡†æ¶","date":"2020-03-02T02:27:24.000Z","updated":"2020-04-19T06:43:49.668Z","comments":true,"path":"2020/03/02/Spring Boot/Spring Boot æ—¥å¿—æ¡†æ¶/","link":"","permalink":"http://yoursite.com/2020/03/02/Spring%20Boot/Spring%20Boot%20%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/","excerpt":"Spring Boot æ—¥å¿—æ¡†æ¶çš„ä½¿ç”¨ã€‚","text":"Spring Boot æ—¥å¿—æ¡†æ¶çš„ä½¿ç”¨ã€‚ æ—¥å¿—æ¡†æ¶å¸‚é¢ä¸Šå¸¸è§çš„æ—¥å¿—æ¡†æ¶ï¼š æ—¥å¿—é—¨é¢ ï¼ˆæ—¥å¿—çš„æŠ½è±¡å±‚ï¼‰ æ—¥å¿—å®ç° JCL: Jakarta Commons Logging;SLF4j: Simple Logging Facade for Java;Jboss-Logging Log4JJUL: java.util.logging;Log4J2 Logback Spring Boot é€‰ç”¨ SLF4J å’Œ Logback Qï¼šSpring Boot æ•´åˆäº†å¾ˆå¤šæ¡†æ¶ï¼Œè‹¥æ•´åˆçš„æ¡†æ¶é»˜è®¤ä½¿ç”¨çš„æ—¥å¿—æ¡†æ¶ä¸ Spring Boot é»˜è®¤ä½¿ç”¨çš„æ—¥å¿—æ¡†æ¶ä¸ä¸€æ ·æ—¶ï¼Œè¦æ€ä¹ˆåšï¼Ÿ Aï¼šæ’é™¤æ•´åˆæ¡†æ¶çš„é»˜è®¤æ—¥å¿—æ¡†æ¶ï¼Œç”¨ä¸­é—´åŒ…æ¥æ›¿ä»£åŸæœ‰çš„æ—¥å¿—æ¡†æ¶ã€‚ SLF4Jåœ¨å¼€å‘çš„ä¸­ï¼Œæ—¥å¿—è®°å½•æ–¹æ³•çš„è°ƒç”¨ä¸åº”è¯¥æ¥ç›´æ¥è°ƒç”¨æ—¥å¿—çš„å®ç°ç±»ï¼Œè€Œæ˜¯è°ƒç”¨æ—¥å¿—æŠ½è±¡å±‚é‡Œé¢çš„æ–¹æ³•ã€‚ 12345678910// ç»™ç³»ç»Ÿé‡Œé¢å¯¼å…¥ SLF4J çš„ JAR å’Œ Logback çš„å®ç° JARimport org.slf4j.Logger;import org.slf4j.LoggerFactory;public class HelloWorld &#123; public static void main(String[] args) &#123; Logger logger = LoggerFactory.getLogger(HelloWorld.class); logger.info(\"Hello World\"); &#125;&#125; SLF4J åšä¸ºä¸åŒçš„æ—¥å¿—å®ç°æ¡†æ¶çš„é—¨é¢çš„é…ç½®ç»“æ„ï¼š ç»Ÿä¸€æ—¥å¿—è®°å½•ï¼š å°†ç³»ç»Ÿä¸­å…¶ä»–æ—¥å¿—æ¡†æ¶å…ˆæ’é™¤å‡ºå»ï¼› ç”¨ä¸­é—´åŒ…æ¥æ›¿æ¢åŸæœ‰çš„æ—¥å¿—æ¡†æ¶ï¼› å¯¼å…¥ SLF4J çš„å…¶ä»–çš„å®ç°ã€‚ Spring Boot æ—¥å¿—å…³ç³»1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-logging&lt;/artifactId&gt;&lt;/dependency&gt; Spring Boot å†…é…ç½®çš„æ’é™¤ Spring çš„ Commons-Loggingï¼š 12345678910&lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-core&lt;/artifactId&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;commons-logging&lt;/groupId&gt; &lt;artifactId&gt;commons-logging&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt;&lt;/dependency&gt; æ—¥å¿—çš„ä½¿ç”¨æ—¥å¿—çš„çº§åˆ«ï¼š 12345678// ç”±ä½åˆ°é«˜ trace &lt; debug &lt; info &lt; warn &lt; error// å¯ä»¥è°ƒæ•´è¾“å‡ºçš„æ—¥å¿—çº§åˆ«ï¼›æ—¥å¿—å°±åªä¼šåœ¨è¿™ä¸ªçº§åˆ«ä»¥ä»¥åçš„é«˜çº§åˆ«ç”Ÿæ•ˆlogger.trace(\"è¿™æ˜¯traceæ—¥å¿—...\");logger.debug(\"è¿™æ˜¯debugæ—¥å¿—...\");// SpringBoot é»˜è®¤ç»™æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ info çº§åˆ«ï¼ˆroot çº§åˆ«ï¼‰logger.info(\"è¿™æ˜¯infoæ—¥å¿—...\");logger.warn(\"è¿™æ˜¯warnæ—¥å¿—...\");logger.error(\"è¿™æ˜¯erroræ—¥å¿—...\"); æ—¥å¿—è¾“å‡ºæ ¼å¼ï¼š 1234567æ—¥å¿—è¾“å‡ºæ ¼å¼ï¼š %dè¡¨ç¤ºæ—¥æœŸæ—¶é—´; %d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; %threadè¡¨ç¤ºçº¿ç¨‹å; %-5levelï¼šçº§åˆ«ä»å·¦æ˜¾ç¤º5ä¸ªå­—ç¬¦å®½åº¦; %logger&#123;50&#125; è¡¨ç¤ºloggeråå­—æœ€é•¿50ä¸ªå­—ç¬¦ï¼Œå¦åˆ™æŒ‰ç…§å¥ç‚¹åˆ†å‰²; %msgï¼šæ—¥å¿—æ¶ˆæ¯; %næ˜¯æ¢è¡Œç¬¦ã€‚ Spring Boot ä¿®æ”¹æ—¥å¿—çš„é»˜è®¤è®¾ç½® 1234567891011121314logging.level.com.wingo=trace # æŒ‡å®šæŸä¸ªåŒ…è·¯å¾„ä¸‹çš„æ—¥å¿—è¾“å‡ºç­‰çº§# logging.path=# ä¸æŒ‡å®šè·¯å¾„åœ¨å½“å‰é¡¹ç›®ä¸‹ç”Ÿæˆ springboot.log æ—¥å¿—# å¯ä»¥æŒ‡å®šå®Œæ•´çš„è·¯å¾„ï¼›# logging.file=G:/springboot.log# åœ¨å½“å‰ç£ç›˜çš„æ ¹è·¯å¾„ä¸‹åˆ›å»º spring æ–‡ä»¶å¤¹å’Œé‡Œé¢çš„ log æ–‡ä»¶å¤¹ï¼›ä½¿ç”¨ spring.log ä½œä¸ºé»˜è®¤æ–‡ä»¶# logging.path=/spring/log# åœ¨æ§åˆ¶å°è¾“å‡ºçš„æ—¥å¿—çš„æ ¼å¼logging.pattern.console=%d&#123;yyyy-MM-dd&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n# æŒ‡å®šæ–‡ä»¶ä¸­æ—¥å¿—è¾“å‡ºçš„æ ¼å¼logging.pattern.file=%d&#123;yyyy-MM-dd&#125; === [%thread] === %-5level === %logger&#123;50&#125; ==== %msg%n æŒ‡å®šé…ç½® ç»™ç±»è·¯å¾„ä¸‹æ”¾ä¸Šæ¯ä¸ªæ—¥å¿—æ¡†æ¶è‡ªå·±çš„é…ç½®æ–‡ä»¶å³å¯ï¼ŒSpringBoot å°±ä¸ä½¿ç”¨ä»–é»˜è®¤é…ç½®çš„äº†ã€‚ Logging System Customization Logback logback-spring.xml, logback-spring.groovy, logback.xml or logback.groovy Log4J2 log4j2-spring.xml or log4j2.xml JDK (Java Util Logging) logging.properties logback.xmlï¼šç›´æ¥å°±è¢«æ—¥å¿—æ¡†æ¶è¯†åˆ«äº†ï¼› logback-spring.xmlï¼šæ—¥å¿—æ¡†æ¶å°±ä¸ç›´æ¥åŠ è½½æ—¥å¿—çš„é…ç½®é¡¹ï¼Œç”± SpringBoot è§£ææ—¥å¿—é…ç½®ï¼Œå¯ä»¥ä½¿ç”¨ SpringBoot çš„é«˜çº§ Profile åŠŸèƒ½ã€‚ SpringBoot çš„é«˜çº§ Profile åŠŸèƒ½ï¼š 123&lt;springProfile name=\"staging\"&gt; &lt;!-- configuration to be enabled when the \"staging\" profile is active --&gt;&lt;/springProfile&gt; é…ç½®æ–‡ä»¶12345678910111213141516171819202122&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;configuration&gt; &lt;!-- å…ˆå®šä¹‰æ‰€æœ‰çš„ appender --&gt; &lt;appenders&gt; &lt;!-- è¾“å‡ºæ§åˆ¶å°çš„é…ç½® --&gt; &lt;console name=\"Console target=SYSTEM_OUT\"&gt; &lt;!-- è¾“å‡ºæ—¥å¿—çš„æ ¼å¼ --&gt; &lt;patternlayout pattern=\"[%p] &gt;&gt;&gt; %m%n\"/&gt; &lt;/console&gt; &lt;/appenders&gt; &lt;loggers&gt; &lt;!-- å®šä¹‰å„ç§åŒ…ä¸‹çš„æ—¥å¿—çš„è¾“å‡ºçº§åˆ« --&gt; &lt;root level=\"DEBUG\"&gt; &lt;!-- è¾“å‡ºåˆ°æ§åˆ¶å° --&gt; &lt;appender-ref ref=\"Console\"/&gt; &lt;/root&gt; &lt;logger name=\"org.springframework\" level=\"ERROR\"/&gt; &lt;logger name=\"com.baomidou\" level=\"ERROR\"/&gt; &lt;logger name=\"org.hibernate\" level=\"ERROR\"/&gt; &lt;logger name=\"com. alibaba druid\" level=\"ERROR\"/&gt; &lt;/loggers&gt;&lt;/configuration&gt; 123456789101112131415161718192021222324252627282930313233343536&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;configuration scan=\"true\" scanPeriod=\"60 seconds\" debug=\"false\"&gt; &lt;contextName&gt;logback&lt;/contextName&gt; &lt;property name=\"log.path\" value=\"C:\\Users\\wingo\\Documents\\Recent\\log\" /&gt; &lt;!--è¾“å‡ºåˆ°æ§åˆ¶å°--&gt; &lt;appender name=\"console\" class=\"ch.qos.logback.core.ConsoleAppender\"&gt; &lt;!-- &lt;filter class=\"ch.qos.logback.classic.filter.ThresholdFilter\"&gt; &lt;level&gt;ERROR&lt;/level&gt; &lt;/filter&gt;--&gt; &lt;encoder&gt; &lt;pattern&gt;[%p] &gt;&gt;&gt; %m%n&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;!--è¾“å‡ºåˆ°æ–‡ä»¶--&gt; &lt;appender name=\"file\" class=\"ch.qos.logback.core.rolling.RollingFileAppender\"&gt; &lt;rollingPolicy class=\"ch.qos.logback.core.rolling.TimeBasedRollingPolicy\"&gt; &lt;fileNamePattern&gt;$&#123;log.path&#125;/logback.%d&#123;yyyy-MM-dd&#125;.log&lt;/fileNamePattern&gt; &lt;/rollingPolicy&gt; &lt;encoder&gt; &lt;pattern&gt;%d&#123;HH:mm:ss.SSS&#125; %contextName [%thread] %-5level %logger&#123;36&#125; - %msg%n&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;root level=\"info\"&gt; &lt;appender-ref ref=\"console\" /&gt; &lt;appender-ref ref=\"file\" /&gt; &lt;/root&gt; &lt;!-- logbackä¸ºjavaä¸­çš„åŒ… --&gt; &lt;logger name=\"com.wingo.controller\"/&gt; &lt;!--logback.LogbackDemoï¼šç±»çš„å…¨è·¯å¾„ --&gt; &lt;logger name=\"com.wingo.controller.LearnController\" level=\"WARN\" additivity=\"false\"&gt; &lt;appender-ref ref=\"console\"/&gt; &lt;/logger&gt;&lt;/configuration&gt;","categories":[{"name":"Java","slug":"Java","permalink":"http://yoursite.com/categories/Java/"}],"tags":[{"name":"Spring Boot","slug":"Spring-Boot","permalink":"http://yoursite.com/tags/Spring-Boot/"},{"name":"Log","slug":"Log","permalink":"http://yoursite.com/tags/Log/"}]},{"title":"Spring Boot å…¥é—¨é…ç½®","slug":"Spring Boot/Spring Boot å…¥é—¨é…ç½®","date":"2020-02-29T02:48:07.000Z","updated":"2020-04-19T06:43:54.554Z","comments":true,"path":"2020/02/29/Spring Boot/Spring Boot å…¥é—¨é…ç½®/","link":"","permalink":"http://yoursite.com/2020/02/29/Spring%20Boot/Spring%20Boot%20%E5%85%A5%E9%97%A8%E9%85%8D%E7%BD%AE/","excerpt":"Spring Boot 2.x çš„ Hello World ä»¥åŠé…ç½®è¯¦è§£ã€‚","text":"Spring Boot 2.x çš„ Hello World ä»¥åŠé…ç½®è¯¦è§£ã€‚ èƒŒæ™¯ï¼šJ2EE ç¬¨é‡çš„å¼€å‘ã€ç¹å¤šçš„é…ç½®ã€åº•ä¸‹çš„å¼€å‘æ•ˆç‡å§ã€å¤æ‚çš„éƒ¨ç½²æµç¨‹ã€ç¬¬ä¸‰æ–¹æŠ€æœ¯é›†æˆéš¾åº¦å¤§ã€‚ è§£å†³ï¼šSpring å…¨å®¶æ¡¶ ğŸ‘‰ Spring Boot J2EE ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆ ğŸ‘‰ Spring Cloud åˆ†å¸ƒå¼æ•´ä½“è§£å†³æ–¹æ¡ˆ Spring Boot ç®€ä»‹ ç®€åŒ– Spring åº”ç”¨å¼€å‘çš„ä¸€ä¸ªæ¡†æ¶ï¼› æ•´åˆ Spring æŠ€æœ¯æ ˆçš„ä¸€ä¸ªå¤§é›†åˆï¼› J2EE ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆã€‚ å¾®æœåŠ¡ï¼šä¸€ç§æ¶æ„é£æ ¼ï¼Œå³ä¸€ä¸ªåº”ç”¨åº”è¯¥æ˜¯ä¸€ç»„å°å‹æœåŠ¡ï¼Œè¿™äº›å°æœåŠ¡ä¹‹é—´å¯ä»¥é€šè¿‡ HTTP çš„æ–¹å¼è¿›è¡Œé€šä¿¡ï¼Œæ¯ä¸€ä¸ªåŠŸèƒ½å…ƒç´ æœ€ç»ˆéƒ½æ˜¯ä¸€ä¸ªå¯ç‹¬ç«‹æ›¿æ¢å’Œç‹¬ç«‹å‡çº§çš„è½¯ä»¶å•å…ƒã€‚ Spring Boot HelloWorld åŠŸèƒ½ï¼šæµè§ˆå™¨å‘é€ hello è¯·æ±‚ï¼ŒæœåŠ¡å™¨æ¥å—è¯·æ±‚å¹¶å¤„ç†ï¼Œå“åº” Hello World å­—ç¬¦ä¸² é¡¹ç›®ç”Ÿæˆé¡¹ç›®ç”Ÿæˆåœ°å€ï¼šSpring Initiizr å¡«å†™é¡¹ç›®çš„åŸºæœ¬ä¿¡æ¯åç‚¹å‡» Generate ä¸‹è½½ç”Ÿæˆçš„é¡¹ç›®ã€‚ å°†é¡¹ç›®è§£å‹åˆ°ç›¸åº”ç›®å½•ï¼Œæ‰“å¼€ IDEA å¯¼å…¥é¡¹ç›®ã€‚ï¼ˆFile ğŸ‘‰ New ğŸ‘‰ Project from Existing Sourcesï¼‰ é€‰æ‹©ä»¥ Maven é¡¹ç›®çš„æ–¹å¼å¯¼å…¥ã€‚ è®¾ç½® JDK ï¼Œç‚¹å‡» Environment settings é…ç½® Mavenã€‚ é¡¹ç›®å¯¼å…¥æˆåŠŸåçš„é¡¹ç›®ç›®å½•ã€‚ resourcesæ–‡ä»¶å¤¹ä¸­ç›®å½•ç»“æ„ staticï¼šä¿å­˜æ‰€æœ‰çš„é™æ€èµ„æºï¼› js css images ç­‰ï¼› templatesï¼šä¿å­˜æ‰€æœ‰çš„æ¨¡æ¿é¡µé¢ï¼›ï¼ˆSpring Boot é»˜è®¤ jar åŒ…ä½¿ç”¨åµŒå…¥å¼çš„ Tomcatï¼Œé»˜è®¤ä¸æ”¯æŒ JSP é¡µé¢ï¼‰ï¼›å¯ä»¥ä½¿ç”¨æ¨¡æ¿å¼•æ“ï¼ˆfreemarkerã€thymeleafï¼‰ï¼› application.propertiesï¼šSpring Boot åº”ç”¨çš„é…ç½®æ–‡ä»¶ï¼›å¯ä»¥ä¿®æ”¹ä¸€äº›é»˜è®¤è®¾ç½®ï¼› ä»£ç ç¼–å†™åœ¨ pom.xml ä¸­åŠ å…¥ Spring Boot çš„ç›¸å…³ä¾èµ–ã€‚ 1234567&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;!-- åŠŸèƒ½åœºæ™¯æŠ½å–æˆ Starter æ¥å¯¼å…¥ç›¸å…³ä¾èµ– --&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt;&lt;/dependencies&gt; å¯åŠ¨ Spring Boot åº”ç”¨çš„ä¸»ç¨‹åº 1234567891011/** * @author wingo */@SpringBootApplicationpublic class JavaSpringbootWingoApplication &#123; public static void main(String[] args) &#123; run(JavaSpringbootWingoApplication.class, args); &#125;&#125; ç¼–å†™ç›¸å…³çš„ Controller 123456789@Controllerpublic class HelloController &#123; @ResponseBody @RequestMapping(\"/hello\") public String hello()&#123; return \"Hello World!\"; &#125;&#125; è¿è¡Œæµ‹è¯•æ§åˆ¶å°æ‰“å°ä¸­å¯çœ‹åˆ° Tomcat åœ¨å…¶é»˜è®¤ç«¯å£ 8080 è¢«å¼€å¯ã€‚ è®¿é—®ï¼šlocalhost:8080/hello è®¿é—®æˆåŠŸï¼Œæ­¤ Spring Boot é¡¹ç›®å¯æ­£å¸¸è¿è¡Œã€‚ ç®€åŒ–éƒ¨ç½²123456789&lt;!-- è¿™ä¸ªæ’ä»¶å¯ä»¥å°†åº”ç”¨æ‰“åŒ…æˆä¸€ä¸ªå¯æ‰§è¡Œçš„jaråŒ…ï¼Œåœ¨ cmd ç›´æ¥ç”¨ java -jar å‘½ä»¤æ‰§è¡Œ --&gt;&lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;/plugin&gt; &lt;/plugins&gt;&lt;/build&gt; Hello World æ¢ç©¶é¡¹ç›®ä¾èµ–spring-boot-starter-Xxxï¼šå¯åŠ¨å™¨ Spring Boot åœºæ™¯å¯åŠ¨å™¨ï¼Œç”¨äºè‡ªåŠ¨å¯¼å…¥äº†åœºæ™¯è¿è¡Œæ‰€ä¾èµ–çš„ç»„ä»¶ã€‚ 123456&lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;!-- Starter å¯åŠ¨å™¨çš„çˆ¶é¡¹ç›® --&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;1.5.9.RELEASE&lt;/version&gt;&lt;/parent&gt; ç‚¹å‡»è¿›å…¥ spring-boot-starter-parentï¼Œå®ƒçš„çˆ¶é¡¹ç›®æ˜¯ spring-boot-dependenciesã€‚ 1234567&lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;!-- å®šä¹‰äº†å„ç§ä¾èµ–çš„ç‰ˆæœ¬å· --&gt; &lt;artifactId&gt;spring-boot-dependencies&lt;/artifactId&gt; &lt;version&gt;2.2.5.RELEASE&lt;/version&gt; &lt;relativePath&gt;../../spring-boot-dependencies&lt;/relativePath&gt;&lt;/parent&gt; ä¸»ç¨‹åºç±»ï¼ˆå…¥å£ç±»ï¼‰Spring Boot ç”¨@SpringBootApplicationæ¥æ ‡æ³¨ä¸€ä¸ªä¸»ç¨‹åºç±»ï¼Œè¯´æ˜è¿™æ˜¯ä¸€ä¸ª Spring Boot åº”ç”¨ã€‚ 123456@SpringBootConfiguration // è¿™æ˜¯ä¸€ä¸ª Spring Boot é…ç½®ç±»@EnableAutoConfiguration // å¼€å¯è‡ªåŠ¨é…ç½®åŠŸèƒ½@ComponentScan(excludeFilters = &#123; @Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class), @Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) &#125;)public @interface SpringBootApplication &#123;&#125; Spring Boot åœ¨å¯åŠ¨çš„æ—¶å€™ä»ç±»è·¯å¾„ä¸‹çš„ META-INF/spring.factories ä¸­è·å– EnableAutoConfiguration æŒ‡å®šçš„å€¼ï¼Œå°†è¿™äº›å€¼ä½œä¸ºè‡ªåŠ¨é…ç½®ç±»å¯¼å…¥åˆ°å®¹å™¨ä¸­ï¼Œè‡ªåŠ¨é…ç½®ç±»å°±ç”Ÿæ•ˆï¼Œå¸®æˆ‘ä»¬è¿›è¡Œè‡ªåŠ¨é…ç½®å·¥ä½œã€‚ æŒ‰ä½ Ctrl ç‚¹å‡»ä¸€ä¸ªè‡ªåŠ¨è£…é…ç±»ï¼š å‘ç°æœ‰å¤§é‡çš„@Conditionalæ´¾ç”Ÿç±»ï¼Œå¿…é¡»æ˜¯åœ¨@ConditionalæŒ‡å®šçš„æ¡ä»¶æˆç«‹çš„æƒ…å†µä¸‹ï¼Œæ‰ç»™å®¹å™¨ä¸­æ·»åŠ ç»„ä»¶ï¼Œé…ç½®é‡Œé¢çš„æ‰€æœ‰å†…å®¹æ‰ç”Ÿæ•ˆã€‚ å¯ä»¥é€šè¿‡ debug=true å±æ€§è®©æ§åˆ¶å°æ‰“å°è‡ªåŠ¨é…ç½®æŠ¥å‘Šã€‚ Spring Boot é…ç½®æ–‡ä»¶ application.properties application.yml YAMLä»¥æ•°æ®ä¸ºä¸­å¿ƒã€‚ 123server: port: 8081 path: /hello åŸºæœ¬è¯­æ³•ï¼š k:(ç©ºæ ¼)v è¡¨ç¤ºä¸€å¯¹é”®å€¼å¯¹ï¼ˆå¤§å°å†™æ•æ„Ÿï¼‰ï¼› ä»¥ç©ºæ ¼çš„ç¼©è¿›æ¥æ§åˆ¶å±‚çº§å…³ç³»ï¼›åªè¦æ˜¯å·¦å¯¹é½çš„ä¸€åˆ—æ•°æ®ï¼Œéƒ½æ˜¯åŒä¸€ä¸ªå±‚çº§çš„ã€‚ å­—ç¬¦ä¸²å­—ç¬¦ä¸²é»˜è®¤ä¸ç”¨åŠ ä¸Šå•å¼•å·æˆ–è€…åŒå¼•å·ï¼š å•å¼•å·ï¼šä¼šè½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ï¼Œç‰¹æ®Šå­—ç¬¦æœ€ç»ˆåªæ˜¯ä¸€ä¸ªæ™®é€šçš„å­—ç¬¦ä¸²æ•°æ®ï¼› åŒå¼•å·ï¼šä¸ä¼šè½¬ä¹‰å­—ç¬¦ä¸²é‡Œé¢çš„ç‰¹æ®Šå­—ç¬¦ï¼Œç‰¹æ®Šå­—ç¬¦ä¼šä½œä¸ºæœ¬èº«æƒ³è¡¨ç¤ºçš„æ„æ€ã€‚ å¯¹è±¡ã€Mapï¼š 123456friends: lastName: Wen age: 23# è¡Œå†…å†™æ³•friends: &#123;lastName: Wen,age: 23&#125; æ•°ç»„ã€Listã€Setï¼š 123456pets: - cat - dog # è¡Œå†…å†™æ³•friends: [cat,dog] é…ç½®æ–‡ä»¶å€¼çš„æ³¨å…¥é…ç½®æ–‡ä»¶ï¼š 123456789101112person: lastName: hello age: 18 boss: false birth: 2017/12/12 maps: &#123;k1: v1,k2: 12&#125; lists: - lisi - zhaoliu dog: name: å°ç‹— age: 12 Java Bean å°†é…ç½®æ–‡ä»¶ä¸­é…ç½®çš„æ¯ä¸€ä¸ªå±æ€§çš„å€¼ï¼Œæ˜ å°„åˆ°è¿™ä¸ªç»„ä»¶ä¸­ã€‚ åªæœ‰è¿™ä¸ªç»„ä»¶æ˜¯å®¹å™¨ä¸­çš„ç»„ä»¶ï¼Œæ‰èƒ½ä½¿ç”¨å®¹å™¨æä¾›çš„@ConfigurationPropertiesåŠŸèƒ½ @ConfigurationPropertieså‘Šè¯‰ SpringBoot å°†æœ¬ç±»ä¸­çš„æ‰€æœ‰å±æ€§å’Œé…ç½®æ–‡ä»¶ä¸­ç›¸å…³çš„é…ç½®è¿›è¡Œç»‘å®šï¼› prefix = &quot;person&quot;é…ç½®æ–‡ä»¶ä¸­å“ªä¸ªä¸‹é¢çš„æ‰€æœ‰å±æ€§è¿›è¡Œä¸€ä¸€æ˜ å°„ã€‚ 123456789101112131415161718192021/** * å°†é…ç½®æ–‡ä»¶ä¸­é…ç½®çš„æ¯ä¸€ä¸ªå±æ€§çš„å€¼ï¼Œæ˜ å°„åˆ°è¿™ä¸ªç»„ä»¶ä¸­ * @ConfigurationPropertiesï¼šå‘Šè¯‰SpringBootå°†æœ¬ç±»ä¸­çš„æ‰€æœ‰å±æ€§å’Œé…ç½®æ–‡ä»¶ä¸­ç›¸å…³çš„é…ç½®è¿›è¡Œç»‘å®šï¼› * prefix = \"person\"ï¼šé…ç½®æ–‡ä»¶ä¸­å“ªä¸ªä¸‹é¢çš„æ‰€æœ‰å±æ€§è¿›è¡Œä¸€ä¸€æ˜ å°„ * * åªæœ‰è¿™ä¸ªç»„ä»¶æ˜¯å®¹å™¨ä¸­çš„ç»„ä»¶ï¼Œæ‰èƒ½ä½¿ç”¨å®¹å™¨æä¾›çš„@ConfigurationPropertiesåŠŸèƒ½ï¼› * */@Component@ConfigurationProperties(prefix = \"person\")public class Person &#123; private String lastName; private Integer age; private Boolean boss; private Date birth; private Map&lt;String,Object&gt; maps; private List&lt;Object&gt; lists; private Dog dog;&#125; å¯¼å…¥é…ç½®æ–‡ä»¶å¤„ç†å™¨ï¼Œè¿™æ ·ç¼–å†™é…ç½®æ—¶ä¼šæœ‰æç¤ºã€‚ 123456&lt;!-- å¯¼å…¥é…ç½®æ–‡ä»¶å¤„ç†å™¨ï¼Œé…ç½®æ–‡ä»¶è¿›è¡Œç»‘å®šå°±ä¼šæœ‰æç¤º --&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt;&lt;/dependency&gt; properties é…ç½®æ–‡ä»¶åœ¨ IDEA ä¸­é»˜è®¤ UTF-8 å¯èƒ½ä¼šä¹±ç ï¼Œå‹¾é€‰ Setting - File Encodings - Transparent native-to-ascii conversionã€‚ @Valueè·å–å€¼å’Œ@ConfigurationPropertiesè·å–å€¼æ¯”è¾ƒ @ConfigurationProperties @Value åŠŸèƒ½ æ‰¹é‡æ³¨å…¥é…ç½®æ–‡ä»¶ä¸­çš„å±æ€§ ä¸€ä¸ªä¸ªæŒ‡å®š æ¾æ•£ç»‘å®šï¼ˆæ¾æ•£è¯­æ³•ï¼‰ æ”¯æŒ ä¸æ”¯æŒ SpEL ä¸æ”¯æŒ æ”¯æŒ JSR303æ•°æ®æ ¡éªŒ æ”¯æŒ ä¸æ”¯æŒ å¤æ‚ç±»å‹å°è£… æ”¯æŒ ä¸æ”¯æŒ é…ç½®æ–‡ä»¶ yml è¿˜æ˜¯ properties å®ƒä»¬éƒ½èƒ½è·å–åˆ°å€¼ï¼š åªæ˜¯åœ¨æŸä¸ªä¸šåŠ¡é€»è¾‘ä¸­éœ€è¦è·å–ä¸€ä¸‹é…ç½®æ–‡ä»¶ä¸­çš„æŸé¡¹å€¼ï¼Œä½¿ç”¨@Valueï¼› ä¸“é—¨ç¼–å†™äº†ä¸€ä¸ª JavaBean æ¥å’Œé…ç½®æ–‡ä»¶è¿›è¡Œæ˜ å°„ï¼Œæˆ‘ä»¬å°±ç›´æ¥ä½¿ç”¨@ConfigurationPropertiesï¼› é…ç½®æ–‡ä»¶æ³¨å…¥æ ¡éªŒæ•°æ®ã€‚ 12345678//...@Validated // å¼€å¯æ ¡éªŒpublic class Person &#123; //... @Email // å¿…é¡»ä¸ºé‚®ä»¶æ ¼å¼ private String lastName; //...&#125; é…ç½®æ–‡ä»¶çš„åŠ è½½@PropertySourceï¼šåŠ è½½æŒ‡å®šçš„é…ç½®æ–‡ä»¶ã€‚ 1@PropertySource(value = &#123;\"classpath:person.properties\"&#125;) @ImportResourceï¼šè®© Spring çš„é…ç½®æ–‡ä»¶ç”Ÿæ•ˆï¼ŒåŠ è½½è¿›æ¥ã€‚Spring Boot é‡Œé¢æ²¡æœ‰ Spring çš„é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬è‡ªå·±ç¼–å†™çš„é…ç½®æ–‡ä»¶ï¼Œä¹Ÿä¸èƒ½è‡ªåŠ¨è¯†åˆ«ã€‚ 1@ImportResource(locations = &#123;\"classpath:beans.xml\"&#125;) Spring Boot æ¨èä½¿ç”¨å…¨æ³¨è§£çš„æ–¹å¼ã€‚ 12345678910@Configuration // æŒ‡æ˜å½“å‰ç±»æ˜¯ä¸€ä¸ª Spring é…ç½®ç±»public class MyAppConfig &#123; //å°†æ–¹æ³•çš„è¿”å›å€¼æ·»åŠ åˆ°å®¹å™¨ä¸­ï¼›å®¹å™¨ä¸­è¿™ä¸ªç»„ä»¶é»˜è®¤çš„idå°±æ˜¯æ–¹æ³•å @Bean public HelloService helloService()&#123; System.out.println(\"é…ç½®ç±» @Bean ç»™å®¹å™¨ä¸­æ·»åŠ ç»„ä»¶äº†...\"); return new HelloService(); &#125;&#125; é…ç½®æ–‡ä»¶å ä½ç¬¦éšæœºæ•°ï¼š 12$&#123;random.value&#125;ã€$&#123;random.int&#125;ã€$&#123;random.long&#125;$&#123;random.int(10)&#125;ã€$&#123;random.int[1024,65536]&#125; å ä½ç¬¦è·å–ä¹‹å‰é…ç½®è¿‡çš„å€¼ï¼Œå¯ç”¨:æŒ‡å®šé»˜è®¤å€¼ 123456789person.last-name=å¼ ä¸‰$&#123;random.uuid&#125;person.age=$&#123;random.int&#125;person.birth=2017/12/15person.boss=falseperson.maps.k1=v1person.maps.k2=14person.lists=a,b,cperson.dog.name=$&#123;person.hello:hello&#125;_dog // æŒ‡å®šé»˜è®¤å€¼person.dog.age=15 Profileå¤š Profile æ–‡ä»¶ï¼šæˆ‘ä»¬åœ¨ä¸»é…ç½®æ–‡ä»¶ç¼–å†™çš„æ—¶å€™ï¼Œæ–‡ä»¶åå¯ä»¥æ˜¯ application-{profile}.properties / ymlï¼Œé»˜è®¤ä½¿ç”¨ application.properties çš„é…ç½®ã€‚ Yaml æ”¯æŒå¤šæ–‡æ¡£å—çš„æ–¹å¼ï¼š 12345678910111213141516171819server: port: 8081spring: profiles: active: prod # æŒ‡å®šæ¿€æ´»å“ªä¸ªç¯å¢ƒ--- # æ–‡æ¡£å—åˆ†éš”ç¬¦server: port: 8083spring: profiles: dev # å±äº dev ç¯å¢ƒ---server: port: 8084spring: profiles: prod # å±äº prod ç¯å¢ƒ æ¿€æ´»æŒ‡å®šçš„ Profile åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šspring.profiles.active=dev å‘½ä»¤è¡Œè¿è¡Œjava -jar [é¡¹ç›® JAR åŒ…] --spring.profiles.active=dev; è™šæ‹Ÿæœºå‚æ•°-Dspring.profiles.active=dev é…ç½®æ–‡ä»¶åŠ è½½ä½ç½®springboot å¯åŠ¨ä¼šæ‰«æä»¥ä¸‹ä½ç½®çš„ application.properties æˆ–è€… application.yml æ–‡ä»¶ä½œä¸º Spring boot çš„é»˜è®¤é…ç½®æ–‡ä»¶ file:./config/ file:./ classpath:/config/ classpath:/ ä¼˜å…ˆçº§ç”±é«˜åˆ°åº•ï¼Œé«˜ä¼˜å…ˆçº§çš„é…ç½®ä¼šè¦†ç›–ä½ä¼˜å…ˆçº§çš„é…ç½®ï¼›SpringBoot ä¼šä»è¿™å››ä¸ªä½ç½®åŠ è½½å…¨éƒ¨é…ç½®æ–‡ä»¶å½¢æˆäº’è¡¥é…ç½®ã€‚ é¡¹ç›®æ‰“åŒ…å¥½åï¼Œè‹¥è¦æ”¹å˜é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°çš„å½¢å¼ java -jar [é¡¹ç›® JAR åŒ…] --spring.config.location=D:/application.properties æˆ–è€…ç›´æ¥ä½¿ç”¨ --é…ç½®é¡¹=å€¼çš„æ–¹å¼æ”¹å˜æŸä¸€é¡¹é…ç½® java -jar [é¡¹ç›® JAR åŒ…] --server.port=8087 --server.context-path=/abc ä¼˜å…ˆçº§ï¼šå¤–éƒ¨ &gt; å†…éƒ¨ã€å¸¦ profile &gt; ä¸å¸¦ profile å¯åŠ¨åŸç†è§£æ","categories":[{"name":"Java","slug":"Java","permalink":"http://yoursite.com/categories/Java/"}],"tags":[{"name":"Spring Boot","slug":"Spring-Boot","permalink":"http://yoursite.com/tags/Spring-Boot/"}]},{"title":"Netty å¸¸ç”¨é…ç½®","slug":"Netty/Netty å¸¸ç”¨é…ç½®","date":"2020-02-27T08:35:34.000Z","updated":"2020-02-27T13:28:37.178Z","comments":true,"path":"2020/02/27/Netty/Netty å¸¸ç”¨é…ç½®/","link":"","permalink":"http://yoursite.com/2020/02/27/Netty/Netty%20%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/","excerpt":"åœ¨ä½¿ç”¨ Netty çš„è¿‡ç¨‹ä¸­ä¼šå¯¹ serverBootStrap çš„ option å’Œ childOption è¿›è¡Œè‡ªå®šä¹‰çš„ä¸€äº›é…ç½®ï¼Œå…·ä½“å°±æ˜¯ä½¿ç”¨ChannelOption é‡Œé¢å£°æ˜çš„å¸¸é‡è¿›è¡Œé…ç½®ï¼Œåœ¨æ­¤ä»‹ç»ä¸€ä¸‹è¿™äº›å¸¸é‡ã€‚ Netty çš„å¸¸ç”¨é…ç½®ä»‹ç»","text":"åœ¨ä½¿ç”¨ Netty çš„è¿‡ç¨‹ä¸­ä¼šå¯¹ serverBootStrap çš„ option å’Œ childOption è¿›è¡Œè‡ªå®šä¹‰çš„ä¸€äº›é…ç½®ï¼Œå…·ä½“å°±æ˜¯ä½¿ç”¨ChannelOption é‡Œé¢å£°æ˜çš„å¸¸é‡è¿›è¡Œé…ç½®ï¼Œåœ¨æ­¤ä»‹ç»ä¸€ä¸‹è¿™äº›å¸¸é‡ã€‚ Netty çš„å¸¸ç”¨é…ç½®ä»‹ç» ChannelOption æœåŠ¡ç«¯ï¼š option() ç”¨äºè®¾ç½® ServerChannel çš„é€‰é¡¹ï¼Œè´Ÿè´£ç›‘å¬å’Œæ¥æ”¶è¿æ¥ï¼› childOption()ï¼šç”¨äºè®¾ç½® SocketChannelï¼Œè´Ÿè´£å¤„ç† I/O æ“ä½œã€‚ å®¢æˆ·ç«¯ï¼š æ²¡æœ‰ childOption()ã€‚ ChannelOption.SO_BACKLOG SO_BACKLOG å¯¹åº”çš„æ˜¯ TCP/IP åè®® listen() å‡½æ•°ä¸­çš„ backlog å‚æ•°ï¼Œå‡½æ•° listen(int socketfd, int backlog) ç”¨æ¥åˆå§‹åŒ–æœåŠ¡ç«¯å¯è¿æ¥é˜Ÿåˆ—ï¼ŒæœåŠ¡ç«¯å¤„ç†å®¢æˆ·ç«¯é“¾æ¥æ˜¯é¡ºåºå¤„ç†çš„ï¼Œæ‰€ä»¥åŒä¸€æ—¶é—´åªèƒ½å¤„ç†ä¸€ä¸ªé“¾æ¥ï¼Œå¤šå®¢æˆ·ç«¯è¯·æ±‚è¿‡æ¥æ—¶ï¼ŒæœåŠ¡ç«¯ä¼šå°†æœªå¤„ç†çš„è¯·æ±‚æ”¾å…¥è¯·æ±‚é˜Ÿåˆ—ï¼Œbacklogbå°±æ˜¯åˆ¶å®šäº†é˜Ÿåˆ—çš„å¤§å°ã€‚ ChannelOption.SO_REUSEADDR SO_REUSEADDR å¯¹åº”çš„æ˜¯ Socket é€‰é¡¹ä¸­ SO_REUSEADDRï¼Œè¿™ä¸ªå‚æ•°è¡¨ç¤ºå…è®¸é‡å¤ä½¿ç”¨æœ¬åœ°åœ°å€å’Œç«¯å£ï¼Œä¾‹å¦‚ï¼ŒæŸä¸ªæœåŠ¡å ç”¨äº† TCP çš„ 8080 ç«¯å£ï¼Œå…¶ä»–æœåŠ¡å†å¯¹è¿™ä¸ªç«¯å£è¿›è¡Œç›‘å¬å°±ä¼šæŠ¥é”™ï¼ŒSO_REUSEADDR è¿™ä¸ªå‚æ•°å°±æ˜¯ç”¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜çš„ï¼Œè¯¥å‚æ•°å…è®¸æœåŠ¡å…¬ç”¨ä¸€ä¸ªç«¯å£ï¼Œè¿™ä¸ªåœ¨æœåŠ¡å™¨ç¨‹åºä¸­æ¯”è¾ƒå¸¸ç”¨ï¼Œä¾‹å¦‚æŸä¸ªè¿›ç¨‹éæ­£å¸¸é€€å‡ºï¼Œå¯¹ä¸€ä¸ªç«¯å£çš„å ç”¨å¯èƒ½ä¸ä¼šç«‹å³é‡Šæ”¾ï¼Œè¿™æ—¶å€™å¦‚æœä¸è®¾ç½®è¿™ä¸ªå‚æ•°ï¼Œå…¶ä»–è¿›ç¨‹å°±ä¸èƒ½ç«‹å³ä½¿ç”¨è¿™ä¸ªç«¯å£ã€‚ ChannelOption.SO_KEEPALIVE SO_KEEPALIVE è¿™ä¸ªå‚æ•°å¯¹åº” Socket ä¸­çš„ SO_KEEPALIVEï¼Œå½“è®¾ç½®è¿™ä¸ªå‚æ•°ä¸º true åï¼ŒTCP è¿æ¥ä¼šæµ‹è¯•è¿™ä¸ªè¿æ¥çš„çŠ¶æ€ï¼Œå¦‚æœè¯¥è¿æ¥é•¿æ—¶é—´æ²¡æœ‰æ•°æ®äº¤æµï¼ŒTCP ä¼šè‡ªåŠ¨å‘é€ä¸€ä¸ªæ´»åŠ¨æ¢æµ‹æ•°æ®æŠ¥æ–‡ï¼Œæ¥æ£€æµ‹é“¾æ¥æ˜¯å¦å­˜æ´»ã€‚ ChannelOption.TCP_NODELAY TCP_NODELAY å¯¹åº”äº socket é€‰é¡¹ä¸­çš„ TCP_NODELAYï¼Œè¯¥å‚æ•°çš„ä½¿ç”¨å’Œ Nagle ç®—æ³•æœ‰å…³ï¼ŒNagle ç®—æ³•æ˜¯å°†å°çš„æ•°æ®åŒ…ç»„è£…ä¸ºæ›´å¤§çš„å¸§è¿›è¡Œå‘é€ï¼Œè€Œä¸ä¼šæ¥ä¸€ä¸ªæ•°æ®åŒ…å‘é€ä¸€æ¬¡ï¼Œç›®çš„æ˜¯ä¸ºäº†æé«˜æ¯æ¬¡å‘é€çš„æ•ˆç‡ï¼Œå› æ­¤åœ¨æ•°æ®åŒ…æ²¡æœ‰ç»„æˆè¶³å¤Ÿå¤§çš„å¸§æ—¶ï¼Œå°±ä¼šå»¶è¿Ÿè¯¥æ•°æ®åŒ…çš„å‘é€ï¼Œè™½ç„¶æé«˜äº†ç½‘ç»œè´Ÿè½½å´é€ æˆäº†å»¶æ—¶ï¼ŒTCP_NODELAY å‚æ•°è®¾ç½®ä¸º trueï¼Œå°±å¯ä»¥ç¦ç”¨ Nagle ç®—æ³•ï¼Œå³ä½¿ç”¨å°æ•°æ®åŒ…å³æ—¶ä¼ è¾“ã€‚ä¸ TCP_NODELAY å¯¹åº”çš„å°±æ˜¯ TCP_CORKï¼Œè¯¥é€‰é¡¹ä¼šç­‰åˆ°å‘é€çš„æ•°æ®é‡æœ€å¤§çš„æ—¶å€™ï¼Œä¸€æ¬¡æ€§å‘é€ï¼Œé€‚åˆè¿›è¡Œæ–‡ä»¶ä¼ è¾“ã€‚ ChannelOption.SO_SNDBUF å’Œ ChannelOption.SO_RCVBUF SO_SNDBUF å’Œ SO_RCVBUF å¯¹åº” Socket ä¸­çš„ SO_SNDBUF å’Œ SO_RCVBUF å‚æ•°ï¼Œå³è®¾ç½®å‘é€ç¼“å†²åŒºå’Œæ¥æ”¶ç¼“å†²åŒºçš„å¤§å°ï¼Œå‘é€ç¼“å†²åŒºç”¨äºä¿å­˜å‘é€æ•°æ®ï¼Œç›´åˆ°å‘é€æˆåŠŸï¼Œæ¥æ”¶ç¼“å†²åŒºç”¨äºä¿å­˜ç½‘ç»œåè®®ç«™å†…æ”¶åˆ°çš„æ•°æ®ï¼Œç›´åˆ°ç¨‹åºè¯»å–æˆåŠŸã€‚ CodecHttp æœåŠ¡HttpServerCodec å°†äºŒè¿›åˆ¶æŠ¥æ–‡è½¬ä¸º HTTP æ–‡æœ¬æŠ¥æ–‡ã€‚ HttpObjectAggregator(512*1024) åˆå¹¶åˆ†æ‰¹æ¬¡è¿‡æ¥çš„ HTTP æŠ¥æ–‡ï¼Œåˆå¹¶å Handler æ‹¿åˆ°çš„å°†æ˜¯ä¸€ä¸ªå®Œæ•´çš„ HTTP æŠ¥æ–‡ã€‚","categories":[{"name":"Java","slug":"Java","permalink":"http://yoursite.com/categories/Java/"}],"tags":[{"name":"Netty","slug":"Netty","permalink":"http://yoursite.com/tags/Netty/"}]},{"title":"Chatroom æœåŠ¡å™¨","slug":"Chatroom/Chatroom æœåŠ¡å™¨","date":"2020-02-27T06:59:19.000Z","updated":"2020-03-02T06:50:21.855Z","comments":true,"path":"2020/02/27/Chatroom/Chatroom æœåŠ¡å™¨/","link":"","permalink":"http://yoursite.com/2020/02/27/Chatroom/Chatroom%20%E6%9C%8D%E5%8A%A1%E5%99%A8/","excerpt":"Chatroom ä¸­ Tomcat æœåŠ¡å™¨ä»¥åŠ WebSocket æœåŠ¡å™¨çš„æ•´åˆã€‚","text":"Chatroom ä¸­ Tomcat æœåŠ¡å™¨ä»¥åŠ WebSocket æœåŠ¡å™¨çš„æ•´åˆã€‚ pom.xml 123456789101112131415161718192021222324&lt;!-- netty4 --&gt;&lt;dependency&gt; &lt;groupId&gt;io.netty&lt;/groupId&gt; &lt;artifactId&gt;netty-all&lt;/artifactId&gt; &lt;version&gt;4.1.2.Final&lt;/version&gt;&lt;/dependency&gt;&lt;build&gt; &lt;finalName&gt;WebSocket&lt;/finalName&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt; &lt;version&gt;3.6.2&lt;/version&gt; &lt;configuration&gt; &lt;source&gt;1.8&lt;/source&gt; &lt;target&gt;1.8&lt;/target&gt; &lt;optimize&gt;true&lt;/optimize&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;/plugins&gt;&lt;/build&gt; è‡ªå®šä¹‰ WebSocket æœåŠ¡å™¨æœåŠ¡å™¨ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081public class WebSocketServer implements Runnable &#123; private final Logger logger = LoggerFactory.getLogger(WebSocketServer.class); @Autowired private EventLoopGroup bossGroup; @Autowired private EventLoopGroup workerGroup; @Autowired private ServerBootstrap serverBootstrap; // port å’Œ childChannelHandler ç”¨ Xml çš„æ–¹å¼é…ç½®ï¼Œéœ€è¦ getter/setter æ–¹æ³• private int port; private ChannelHandler childChannelHandler; private ChannelFuture serverChannelFuture; public WebSocketServer() &#123; &#125; @Override public void run() &#123; build(); &#125; // å¯åŠ¨Netty WebsocketæœåŠ¡å™¨ public void build() &#123; try &#123; long begin = System.currentTimeMillis(); serverBootstrap.group(bossGroup, workerGroup) // boss è´Ÿè´£å®¢æˆ·ç«¯çš„ TCP è¿æ¥è¯·æ±‚ worker è´Ÿè´£ä¸å®¢æˆ·ç«¯ä¹‹å‰çš„è¯»å†™æ“ä½œ .channel(NioServerSocketChannel.class) // é…ç½®å®¢æˆ·ç«¯çš„ channel ç±»å‹ .option(ChannelOption.SO_BACKLOG, 1024) // è®¾ç½®è¯·æ±‚é˜Ÿåˆ—çš„é•¿åº¦ .option(ChannelOption.TCP_NODELAY, true) // é™ä½å»¶è¿Ÿ .childOption(ChannelOption.SO_KEEPALIVE, true) // ä¸¤å°æ—¶æ— æ´»åŠ¨æ£€æµ‹å¿ƒè·³ .childOption(ChannelOption.RCVBUF_ALLOCATOR, new FixedRecvByteBufAllocator(592048)) // é…ç½®å›ºå®šé•¿åº¦æ¥æ”¶ç¼“å­˜åŒºåˆ†é…å™¨ .childHandler(childChannelHandler); // ç»‘å®š I/O äº‹ä»¶çš„å¤„ç†ç±»ï¼ŒWebSocketChildChannelHandler ä¸­å®šä¹‰ long end = System.currentTimeMillis(); logger.info(\"Netty WebsocketæœåŠ¡å™¨å¯åŠ¨å®Œæˆï¼Œè€—æ—¶ \" + (end - begin) + \" msï¼Œå·²ç»‘å®šç«¯å£ \" + port + \" é˜»å¡å¼ç­‰å€™å®¢æˆ·ç«¯è¿æ¥\"); serverChannelFuture = serverBootstrap.bind(port).sync(); &#125; catch (Exception e) &#123; logger.info(e.getMessage()); bossGroup.shutdownGracefully(); workerGroup.shutdownGracefully(); e.printStackTrace(); &#125; &#125; // å…³é—­ WebSocket æœåŠ¡å™¨ public void close()&#123; serverChannelFuture.channel().close(); Future&lt;?&gt; bossGroupFuture = bossGroup.shutdownGracefully(); Future&lt;?&gt; workerGroupFuture = workerGroup.shutdownGracefully(); try &#123; bossGroupFuture.await(); workerGroupFuture.await(); &#125; catch (InterruptedException ignore) &#123; ignore.printStackTrace(); &#125; &#125; public ChannelHandler getChildChannelHandler() &#123; return childChannelHandler; &#125; public void setChildChannelHandler(ChannelHandler childChannelHandler) &#123; this.childChannelHandler = childChannelHandler; &#125; public int getPort() &#123; return port; &#125; public void setPort(int port) &#123; this.port = port; &#125;&#125; æ•°æ®å¤„ç†ç±» 1234567891011121314151617181920@Componentpublic class WebSocketChildChannelHandler extends ChannelInitializer&lt;SocketChannel&gt;&#123; @Resource(name = \"webSocketServerHandler\") private ChannelHandler webSocketServerHandler; @Resource(name = \"httpRequestHandler\") private ChannelHandler httpRequestHandler; // åˆå§‹åŒ–é€šé“ï¼Œè£…è½½ä¸Šæ‰€éœ€è¦çš„å¤„ç†å™¨ @Override protected void initChannel(SocketChannel ch) throws Exception &#123; ch.pipeline().addLast(\"http-codec\", new HttpServerCodec()); // HTTPç¼–ç è§£ç å™¨ ch.pipeline().addLast(\"aggregator\", new HttpObjectAggregator(65536)); // åˆå¹¶åˆ†æ‰¹æ¬¡è¿‡æ¥çš„ HTTP æŠ¥æ–‡ï¼Œåˆå¹¶å Handleræ‹¿åˆ°çš„å°†æ˜¯ä¸€ä¸ªå®Œæ•´çš„ HTTP æŠ¥æ–‡ ch.pipeline().addLast(\"http-chunked\", new ChunkedWriteHandler()); // æ–¹ä¾¿å¤§æ–‡ä»¶ä¼ è¾“ï¼Œä¸è¿‡å®è´¨ä¸Šéƒ½æ˜¯çŸ­çš„æ–‡æœ¬æ•°æ® ch.pipeline().addLast(\"http-handler\", httpRequestHandler); // ç»‘å®šè‡ªå®šä¹‰çš„ Http è¯·æ±‚å¤„ç†å™¨ ch.pipeline().addLast(\"websocket-handler\",webSocketServerHandler); // ç»‘å®šè‡ªå®šä¹‰çš„ WebSocket è¯·æ±‚å¤„ç†å™¨ &#125;&#125; è‡ªå®šä¹‰ Http è¯·æ±‚å¤„ç†ç±» 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859@Component@Sharablepublic class HttpRequestHandler extends SimpleChannelInboundHandler&lt;Object&gt; &#123; @Override protected void channelRead0(ChannelHandlerContext ctx, Object msg) throws Exception &#123; if (msg instanceof FullHttpRequest) &#123; // å¤„ç† Http è¯·æ±‚ handleHttpRequest(ctx, (FullHttpRequest) msg); &#125; else if (msg instanceof WebSocketFrame) &#123; // retain() å¢åŠ  ByteBuf çš„å¼•ç”¨è®¡æ•°ï¼ŒfireChannelRead é€šçŸ¥éœ€è¦ç»§ç»­è°ƒç”¨é“¾è¡¨åé¢çš„ channelRead ctx.fireChannelRead(((WebSocketFrame) msg).retain()); &#125; &#125; // å¤„ç† Http è¯·æ±‚ï¼Œä¸»è¦æ˜¯å®Œæˆ HTTP åè®®åˆ° Websocket åè®®çš„å‡çº§ private void handleHttpRequest(ChannelHandlerContext ctx, FullHttpRequest req) &#123; if (!req.decoderResult().isSuccess()) &#123; sendHttpResponse(ctx, req, new DefaultFullHttpResponse(HttpVersion.HTTP_1_1, HttpResponseStatus.BAD_REQUEST)); return; &#125; // æ„é€ æ¡æ‰‹å·¥å‚ WebSocketServerHandshakerFactory wsFactory = new WebSocketServerHandshakerFactory( \"ws:/\" + ctx.channel() + \"/websocket\", null, false); // åˆ›å»ºæ¡æ‰‹å¤„ç†ç±» WebSocketServerHandshaker handshaker = wsFactory.newHandshaker(req); // å°†æ­¤è¿æ¥ä¿å­˜åˆ°ä¸€ä¸ªå…¨å±€ Map ä¸­ï¼Œç”¨æˆ·é€€å‡ºç™»é™†æ—¶è¦ç§»é™¤æ­¤å¤„ç†ç±» Constant.webSocketHandshakerMap.put(ctx.channel().id().asLongText(), handshaker); if (handshaker == null) &#123; WebSocketServerHandshakerFactory.sendUnsupportedVersionResponse(ctx.channel()); &#125; else &#123; // æ„é€ æ¡æ‰‹å“åº”æ¶ˆæ¯è¿”å›ç»™å®¢æˆ·ç«¯ // å°† WebSocket ç›¸å…³çš„ç¼–ç å’Œè§£ç ç±»åŠ¨æ€æ·»åŠ åˆ° ChannelPipeline ä¸­ç”¨äº WebSocket æ¶ˆæ¯çš„ç¼–è§£ç  handshaker.handshake(ctx.channel(), req); &#125; &#125; private void sendHttpResponse(ChannelHandlerContext ctx, FullHttpRequest req, DefaultFullHttpResponse res) &#123; // è¿”å›åº”ç­”ç»™å®¢æˆ·ç«¯ if (res.status().code() != 200) &#123; ByteBuf buf = Unpooled.copiedBuffer(res.status().toString(), CharsetUtil.UTF_8); res.content().writeBytes(buf); buf.release(); &#125; // å¦‚æœæ˜¯éKeep-Aliveï¼Œå…³é—­è¿æ¥ boolean keepAlive = HttpUtil.isKeepAlive(req); ChannelFuture f = ctx.channel().writeAndFlush(res); if (!keepAlive) &#123; f.addListener(ChannelFutureListener.CLOSE); &#125; &#125; @Override public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception &#123; cause.printStackTrace(); ctx.close(); &#125;&#125; è‡ªå®šä¹‰ WebSocket è¯·æ±‚å¤„ç†ç±» 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394959697@Component@Sharablepublic class WebSocketServerHandler extends SimpleChannelInboundHandler&lt;WebSocketFrame&gt; &#123; private static final Logger LOGGER = LoggerFactory.getLogger(WebSocketServerHandler.class); @Autowired private ChatService chatService; // å¯¹ WebSocket çš„è¯·æ±‚æ¶ˆæ¯è¿›è¡Œå¤„ç† @Override protected void channelRead0(ChannelHandlerContext ctx, WebSocketFrame msg) throws Exception &#123; handlerWebSocketFrame(ctx, msg); &#125; private void handlerWebSocketFrame(ChannelHandlerContext ctx, WebSocketFrame frame) throws Exception &#123; // å…³é—­è¯·æ±‚ if (frame instanceof CloseWebSocketFrame) &#123; WebSocketServerHandshaker handshaker = Constant.webSocketHandshakerMap.get(ctx.channel().id().asLongText()); if (handshaker == null) &#123; sendErrorMessage(ctx, \"ä¸å­˜åœ¨çš„å®¢æˆ·ç«¯è¿æ¥ï¼\"); &#125; else &#123; handshaker.close(ctx.channel(), (CloseWebSocketFrame) frame.retain()); &#125; return; &#125; // pingè¯·æ±‚ if (frame instanceof PingWebSocketFrame) &#123; ctx.channel().write(new PongWebSocketFrame(frame.content().retain())); return; &#125; // åªæ”¯æŒæ–‡æœ¬æ ¼å¼ï¼Œä¸æ”¯æŒäºŒè¿›åˆ¶æ¶ˆæ¯ if (!(frame instanceof TextWebSocketFrame)) &#123; sendErrorMessage(ctx, \"ä»…æ”¯æŒæ–‡æœ¬(Text)æ ¼å¼ï¼Œä¸æ”¯æŒäºŒè¿›åˆ¶æ¶ˆæ¯\"); &#125; // å®¢æœç«¯å‘é€è¿‡æ¥çš„æ¶ˆæ¯ String request = ((TextWebSocketFrame)frame).text(); LOGGER.info(\"æœåŠ¡ç«¯æ”¶åˆ°æ–°ä¿¡æ¯ï¼š\" + request); JSONObject param = null; try &#123; param = JSONObject.parseObject(request); &#125; catch (Exception e) &#123; sendErrorMessage(ctx, \"JSONå­—ç¬¦ä¸²è½¬æ¢å‡ºé”™ï¼\"); e.printStackTrace(); &#125; if (param == null) &#123; sendErrorMessage(ctx, \"å‚æ•°ä¸ºç©ºï¼\"); return; &#125; String type = (String) param.get(\"type\"); switch (type) &#123; case \"REGISTER\": chatService.register(param, ctx); break; case \"SINGLE_SENDING\": chatService.singleSend(param, ctx); break; case \"GROUP_SENDING\": chatService.groupSend(param, ctx); break; case \"FILE_MSG_SINGLE_SENDING\": chatService.FileMsgSingleSend(param, ctx); break; case \"FILE_MSG_GROUP_SENDING\": chatService.FileMsgGroupSend(param, ctx); break; default: chatService.typeError(ctx); break; &#125; &#125; // å®¢æˆ·ç«¯æ–­å¼€è¿æ¥ @Override public void channelInactive(ChannelHandlerContext ctx) throws Exception &#123; chatService.remove(ctx); &#125; // å‡ºç°å¼‚å¸¸å…³é—­é€šé“ @Override public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception &#123; cause.printStackTrace(); ctx.close(); &#125; private void sendErrorMessage(ChannelHandlerContext ctx, String errorMsg) &#123; String responseJson = new ResponseJson() .error(errorMsg) .toString(); ctx.channel().writeAndFlush(new TextWebSocketFrame(responseJson)); &#125;&#125; æ•´åˆ WebSocket æœåŠ¡å™¨å…ˆæ¥çœ‹çœ‹é¡¹ç›®çš„æœåŠ¡å™¨æ„æˆã€‚ Tomcat æ˜¯ä¸€ä¸ªå…è´¹çš„å¼€æ”¾æºä»£ç çš„ Servlet å®¹å™¨ å›é¡¾ä¸€ä¸‹ Servlet çš„ç”Ÿå‘½å‘¨æœŸã€‚ è¦æŠŠ Netty WebSocket æœåŠ¡å™¨æ•´åˆåˆ° Tomcat æœåŠ¡å™¨ä¸­ï¼Œé‚£ä¹ˆå°±éœ€è¦åœ¨ Servlet åˆå§‹åŒ–ä¹‹å‰å‘Šè¯‰å…¶æ‰€éœ€è¦è¿›è¡Œçš„æ“ä½œã€‚å†™ä¸€ä¸ª@PostConstructæ³¨è§£æ–¹æ³•å¼€å¯ä¸€ä¸ªç‹¬ç«‹çº¿ç¨‹ç”¨äºå¯åŠ¨ Netty WebSocket æœåŠ¡å™¨ï¼›å¹¶ä¸”å†™ä¸€ä¸ª@PreDestoryæ³¨è§£æ–¹æ³•åœ¨ Servlet å®Œå…¨å…³é—­ä¹‹å‰å…³é—­ WebSocket æœåŠ¡å™¨ã€‚ 1234567891011121314151617181920212223242526@Component@Scope(\"singleton\")public class AppContext &#123; private final Logger logger = LoggerFactory.getLogger(AppContext.class); @Autowired private WebSocketServer webSocketServer; private Thread nettyThread; @PostConstruct public void init() &#123; nettyThread = new Thread(webSocketServer); logger.info(\"å¼€å¯ç‹¬ç«‹çº¿ç¨‹ï¼Œå¯åŠ¨ Netty WebSocket æœåŠ¡å™¨...\"); nettyThread.start(); &#125; @PreDestroy public void close() &#123; logger.info(\"æ­£åœ¨é‡Šæ”¾Netty Websocketç›¸å…³è¿æ¥...\"); webSocketServer.close(); logger.info(\"æ­£åœ¨å…³é—­Netty WebsocketæœåŠ¡å™¨çº¿ç¨‹...\"); nettyThread.stop(); logger.info(\"ç³»ç»ŸæˆåŠŸå…³é—­ï¼\"); &#125;&#125; åœ¨æ‰§è¡Œè¿™ä¸ªæ–¹æ³•ä¹‹å‰ï¼ŒTomcat å·²ç»åŠ è½½å®Œé…ç½®æ–‡ä»¶ï¼Œè¿™é‡Œçš„ WebSocket æœåŠ¡å™¨æ˜¯é€šè¿‡@AutoWiredè£…è½½è¿›æ¥çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ WebSocket éœ€è¦åœ¨ Spring å®¹å™¨ä¸­æ³¨å†Œæˆä¸ºä¸€ä¸ª Beanã€‚ ApplicationContext-netty.xml 1234567891011121314&lt;!-- æ‰«æå…³äº Netty Websocket çš„åŒ… --&gt;&lt;context:component-scan base-package=\"com.wingo.web.websocket\"/&gt;&lt;!-- æŠŠ Netty çš„ä¸€äº›ç±»æœåŠ¡å™¨æ³¨å†Œåˆ° Springï¼Œæ–¹ä¾¿å¤„ç†å’Œæ‰©å±• --&gt;&lt;!-- ç”¨äºå¤„ç†å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚ --&gt;&lt;bean id=\"bossGroup\" class=\"io.netty.channel.nio.NioEventLoopGroup\"/&gt;&lt;!-- ç”¨äºå¤„ç†å®¢æˆ·ç«¯ I/O æ“ä½œ --&gt;&lt;bean id=\"workerGroup\" class=\"io.netty.channel.nio.NioEventLoopGroup\"/&gt;&lt;!-- æœåŠ¡å™¨å¯åŠ¨å¼•å¯¼ç±» --&gt;&lt;bean id=\"serverBootstrap\" class=\"io.netty.bootstrap.ServerBootstrap\" scope=\"prototype\"/&gt;&lt;!-- è‡ªå®šä¹‰çš„Netty WebsocketæœåŠ¡å™¨ --&gt;&lt;bean id=\"webSocketServer\" class=\"com.wingo.web.websocket.WebSocketServer\"&gt; &lt;property name=\"port\" value=\"3333\"/&gt; &lt;property name=\"childChannelHandler\" ref=\"webSocketChildChannelHandler\" /&gt;&lt;/bean&gt;","categories":[{"name":"Project","slug":"Project","permalink":"http://yoursite.com/categories/Project/"}],"tags":[{"name":"Chatroom","slug":"Chatroom","permalink":"http://yoursite.com/tags/Chatroom/"},{"name":"Servlet","slug":"Servlet","permalink":"http://yoursite.com/tags/Servlet/"},{"name":"Netty Websocket","slug":"Netty-Websocket","permalink":"http://yoursite.com/tags/Netty-Websocket/"}]},{"title":"CET6 é˜…è¯»çœŸé¢˜","slug":"English/CET6 é˜…è¯»çœŸé¢˜","date":"2020-02-25T08:00:45.000Z","updated":"2020-03-06T14:10:47.317Z","comments":true,"path":"2020/02/25/English/CET6 é˜…è¯»çœŸé¢˜/","link":"","permalink":"http://yoursite.com/2020/02/25/English/CET6%20%E9%98%85%E8%AF%BB%E7%9C%9F%E9%A2%98/","excerpt":"CET6 é˜…è¯»çœŸé¢˜ã€‚","text":"CET6 é˜…è¯»çœŸé¢˜ã€‚ 201912 (ä¸€)When considering risk factors associated with serious chronic diseases we often think about health indicators such as cholesterol, blood pressure and body weight. But poor diet and physical inactivity also each increase the risk of heart disease and have a role to play in the development of some cancers. Perhaps worse, the detrimental effects of an unhealthy diet and insufficient exercise are not limited to your body. Recent research has also shown that indulging in a high-fat and high-sugar diet may have negative effects on your brain, causing learning and memory deficits. chronic disease æ…¢æ€§ç—… health indicator å¥åº·æŒ‡æ ‡ cholesterol èƒ†å›ºé†‡ physical inactivity ç¼ºä¹è¿åŠ¨ detrimental effect æœ‰å®³å½±å“ insufficient exercise ç¼ºä¹è¿åŠ¨ indulge in æ²‰æººäº memory deficit è®°å¿†è¡°é€€ Studies have found obesity is associated with impairments in cognitive functioning, as assessed by a range of learning and memory tests, such as the ability to remember a list of words presented some minutes or hours earlier. There is also a growing body of evidence that diet â€” induced cognitive impairments can emerge repidly â€” within weeks or even days. For example, one study found healthy adults assigned to a high-fat diet for five days showed impaired attention, memory, and mood compared with a low-fat diet control group. Another study also found eating a high-fat and high-sugar breakfast each day for as little as four days resulted in problems with learning and memorry similar to those observed in overweight and obese individuals. obesity è‚¥èƒ– impairment æŸå®³ cognitive functioning è®¤çŸ¥åŠŸèƒ½ a growing body ofâ€¦ è¶Šæ¥è¶Šå¤šçš„â€¦ assign to æŒ‡å®šåˆ° impaired attention æ³¨æ„åŠ›å—æŸ as little as å°‘è‡³ obses individuals è‚¥èƒ–ä¸ªä½“ Body weight was not hugely different between the groups eating a healthy diet and those on high and sugar diets. So this shows negative consequences of poor dietary intake can occur even when body weight has not changed conspicuously. Thus, body weight is not always the best indicator of health and a thin person still needs to eat well and exercise regularly. dietary ä¸é¥®é£Ÿæœ‰å…³çš„ conspicuously æ˜¾è‘—åœ° Increased Screen Time and Wellbeing Decline in YouthHave young people never had it so good? Or do they face more challenges than any previous generation? Our current era in the West is one of high wealth. This means minors enjoy material benefits and legal protections that would have been the envy of those living in the past. But There is an increasing suspicion that all is not well for our youth. And one of the most popular explanations, among some experts and the popular media, is that excessive â€œscreen timeâ€ is to blame. (This refers to all the attention young people devote to their phones, tablets and laptops. )However, this is a contentious theory and such claims have been treated skeptically by some scholars based on their reading of the relevant data. era æ—¶ä»£ minor æœªæˆå¹´äºº the envy of ä»¤äººå«‰å¦’ / ç¾¡æ…•çš„äºº / äº‹ç‰© excessive è¿‡åº¦çš„ tablet PC = laptop computer ç¬”è®°æœ¬ç”µè„‘ contentious theory æœ‰äº‰è®®çš„ç†è®º skeptically æ€€ç–‘åœ° Now a new study has provided another contribution to the debate, uncovering strong evidence that adolescent wellbeing in the United States really is experiencing a decline and arguing that the most likely cause is the electronic riches we have given them. The background to this is that from the 1960s into the early 2000s measures of average wellbeing went up in the US. This was especially true for younger people. It reflected the fact that these decades saw a climb in general standards of living and avoidance of mass societal traumas like full-scale war or economic deprivation. However, the â€œscreen timeâ€ hypothesis, advanced by researchers such as Jean Twenge, is that electronic devices and excessive time spent online may have reversed these trends in recent years causing problems for young peoples psychological health. debate äº‰è®º mass societal traumas å¤§è§„æ¨¡åœ°ç¤¾ä¼šåˆ›ä¼¤ economic deprivation ç»æµå‰¥å¤º hypothesis å‡è®¾ advanced by researchers è¢«ç ”ç©¶äººå‘˜æ¨è¿› To investigate, Twenge and her colleagues dived into the â€œMonitoring the Futureâ€ dataset based on annual surveys of American school students from grades 8, 10, and 12 that started in 1991. In total, 1.1 million young people answered various questions related to their wellbeing. Twengeâ€™s teams analysis of the answers confirmed the earlier, well-established wellbeing climb, with scores rising across the 1990s, and into the later 2000s. This was found across measures like self-esteem, life satisfaction, happiness and satisfaction with individual domains like job, neighborhood or friends. But around 2012 these measures started to decline. This continued through 2016, the most recent year for which data is available. well-established ä¸ºå¤§å®¶æ¥å—çš„ self-esteem è‡ªå°Š individual domainä¸ªåˆ«é¢†åŸŸ Twenge and her colleagues wanted to understand why this change in average wellbeing occurred. However, it is very hard to demonstrate causes using non-experimental data such as this. In fact, when Twenge previously used this data to suggest a screen time effect, some commentators were quick to raise this problem. They argued that her causal-sounding claims rested on correlational data, and that she had not adequately accounted for other potential causal factors. This time around, twenge and her team make a point of saying that they are not trying to establish causes as such, but that they are assessing the plausibility of potential causes. causal-sounding å› æœå…³ç³» account for sth è§£é‡Šâ€¦çš„åŸå›  plausibility è²Œä¼¼å¯ä¿¡ First, they explain that if a given variable is playing a role in affecting wellbeing, then we should expectany change in that variable to correlate with the observed changes in wellbeing. If not, it is not plausible that the variable is a causal factor. So the researchers looked at time spent in a number of activities that could plausibly be driving the wellbeing decline. Less sport, and fewer meetings with peers correlated with lower wellbeing, as did less time reading print media (newspapers) and, surprisingly, less time doing homework. (This last finding would appear to contradict another popular hypothesis that it is our burdening of students with assignment that is causing all the problems. ) In addition, more tv watching and more electronic communication both correlated with lower wellbeing. All these effects held true for measures of happiness, life satisfaction and self-esteem, with the effects stronger in the 8th and 10th-graders. held true forâ€¦ å¯¹â€¦ä¹Ÿä¸€æ ·æˆç«‹ Next, Twengeâ€™s team dug a little deeper into the data on screen time. They found that adolescents whospent a very small amount of time on digital devices â€” couple of hours a week â€” had the highest wellbeing. Their wellbeing was even higher than those who never used such devices. However, higher doses of screen time were clearly associated with lower happiness. Those spending 10-19 hours per week on their devices were 4 percent more likely to be unhappy than lower-frequency users. Those who used such devices 40 hours a week or more (one in ten teenagers) were twice as likely to be unhappy. The data was slightly complicated by the fact that there was a tendency for kids who were social in the real world to also use more online communication, but by bracketing out different cases it became clear that the real-world sociality component correlated with greater wellbeing, whereas greater time on screens or online only correlated with poorer wellbeing. doses of â€¦çš„å‰‚é‡ bracket out æ‘†è„± So far, so plausible. But the next question is, are the drops in average wellbeing happening at the sametime as trends toward increased electronic device usage? It looks like it â€” after all, 2012 was the tipping point when more than half of Americans began owning smartphones. Twenge and her colleagues also found that across the key years of 2013-16, wellbeing was indeed lowest in years where adolescents spent more time online, on social media, and reading news online, and when more youth in the United States had smartphones. And in a second analysis, they found that where technology went, dips in wellbeing followed. For instance, years with a larger increase in online usage were followed by years with lower wellbeing, rather than the other way around. This does not prove causality, but is consistent with it. Meanwhile, TV use did not show this tracking. TV might make you less happy, but this is not what seems to be driving the recent declines in young people s average happiness. rather than the other way around è€Œä¸æ˜¯ç›¸åçš„ causality å› æœå…³ç³» be consistent with ç¬¦åˆ A similar but reversed pattern was found for the activities associated with greater wellbeing. For example, years when people spent more time with friends were better years for wellbeing (and followed by better years). Sadly, the data also showed face-to-face socializing and sports activity had declined over the period covered by the survey. There is another explanation that Twenge and her colleagues wanted to address: the impact of the greatrecession of 2007-2009, which hit a great number of American families and might be affecting adolescents. The dataset they used did not include economic data, so instead the researchers looked at whether the 2013-16 wellbeing decline was tracking economic indicators. They found some evidence that some crude measures, like income inequality, correlated with changes in wellbeing. but economic measures with a more direct impact like family income and unemployment rates (which put families into difficulties), had no relationship with wellbeing. The researchers also note the recession hit some years before we see the beginning of the wellbeing drop, and before the steepest wellbeing decline, which occurred in 2013. the great recession å¤§è¡°é€€ crude ç²—ç³™çš„ cruel æ®‹é…·çš„ The researchers conclude that electronic communication was the only adolescent activity that increased atthe same time psychological wellbeing declined. I suspect that some experts in the field will be keen to address alternative explanations, such as unassessed variables playing a role in the wellbeing decline. but the new work does go further than previous research and suggests that screen time should still be considered a potential barrier to young peopleâ€™s flourishing. flourishing ç¹è£çš„ Passage OneThe dangerous thing about lying is people donâ€™t understand how the act changes us, says Dan Arielybehavioural psychologist at Duke University. Psychologists have documented children lying as early as the age of two. Some experts even consider lying a developmental milestone, like crawling and walking. because it requires sophisticated planning, attention and the ability to see a situation from someone elseâ€™s perspective to manipulate them. But, for most people, lying gets limited as we develop a sense of morality and the ability to self-regulate. behavioural psychologist è¡Œä¸ºå¿ƒç†å­¦å®¶ sophisticated planning å¤æ‚çš„è§„åˆ’ manipulate æ“ä½œ Harvard cognitive neuroscientist Joshua Greene says. for most of us, lying takes work. In studies, he gavesubjects a chance to deceive for monetary gain while examining their brains in a functional MRI machine, which maps blood flow to active parts of the brain. Some people told the truth instantly and instinctively. But others opted to lie, and they showed increased activity in their frontal parietal control network, which isinvolved in difficult or complex thinking. This suggests that they were deciding between truth and dishonesty and ultimately opting for the latter. For a follow-up analysis, he found that people whose neural reward centres were more active when they won money were also more likely to be among the group of liars â€” suggesting that lying may have to do with the inability to resist temptation. cognitive neuroscientist è®¤çŸ¥ç¥ç»å­¦å®¶ deceive for monetary gain éª—å–é‡‘é’±æ”¶ç›Š subject å—è¯•è€… instinctively æœ¬èƒ½åœ° ultimately æœ€å the inability to resist temptation æ— æ³•æŠ—æ‹’è¯±æƒ‘ External conditions also matter in terms of when and how often we lie. We are more likely to lie, researchshows, when we are able to rationalise it, when we are stressed and fatigued or see others being dishonest and we are less likely to lie when we have moral reminders or when we think others are watching. We as a society need to understand that, when we donâ€™t punish lying we increase the probability it will happen again, Ariely says. in terms of åœ¨â€¦æ–¹é¢ fatigued ç–²ä¹çš„ rationalise ä½¿åˆç†åŒ– In a 2016 study published in the journal Nature Neuroscience, Ariely and colleagues showed how dishonesty alters peoples brains, making it easier to tell lies in the future. When people uttered a falsehood, the scientists noticed a burst of activity in their amygdala. The amygdala is a crucial part of the brain that produces fear, anxiety and emotional responses including that sinking, guilty feeling you get when you lie. But when scientists had their subjects play a game â€” in which they won money by deceiving their partner, they noticed the negative signals from the amygdala began to decrease. not only that, but when people faced no consequences for dishonesty their falsehoods tended to get even more sensational. This means that if you give people multiple opportunities to lie for their own benefit, they start with little lies which get bigger over time. alter æ”¹å˜ alternate äº¤æ›¿çš„ utter a falsehood è¯´è° crucial å†³å®šæ€§çš„ sinking æ¶ˆæ²‰ sensational è½°åŠ¨çš„ Passage TwoHereâ€™s how the pacific northwest is preparing for â€œThe big oneâ€. Itâ€™s the mother of all disaster drills for what could be the worst disaster in American history. California has spent years preparing for â€œThe big oneâ€ â€” the inevitable earthquake that will undoubtedly unleash all kinds of havoc along the famous San Andreas fault. But what if the fault that runs along the pacific northwest delivers a gigantic earthquake of its own? If the people of the Cascadia region have anything to do with it, they wont be caught unawares. Itâ€™s the mother of disaster drills ç¾éš¾æ¼”ä¹ çš„æºå¤´ unleash all kinds of havocé‡Šæ”¾å„ç§ç ´å fault æ–­å±‚ The region is engaged in a multi-day earthquake-and-tsunami drill involving around 20,000 people. The Cascadia Rising drill gives area residents and emergency responders a chance to practice what to do in case of a 9.0-magnitude earthquake and tsunami along one of the nations dangerous â€” and underestimated â€” faults. be engaged in ä»äº‹ è¿›è¡Œ tsunami æµ·å•¸ emergency responders åº”æ€¥äººå‘˜ The Cascadia Earthquake Zone is big enough to compete with San Andreas ( itâ€™s been called the mostdangerous fault in America), but itâ€™s much lesser known than its California cousin. Nearly 700 miles long the earthquake zone is located by the North American Plate off the coast of Pacific British Columbia, Washington Oregon and Northern California. Cascadia is whatâ€™s known as a â€œmegathrustâ€ fault. Megathrusts are created in earthquake zones â€” land plate boundaries where two plates converge. In the areas where one plate is beneath another, stress builds up over time. During a megathrust event, all of that stress releases and some of the worlds most powerful earthquakes occur. Remember the 9. 1 earthquake and tsunami in the Indian Ocean off Sumatra in 2004? It was caused by a megathrust event as the India plate moved beneath the Burma micro-plate. The last time a major earthquake occurred along the Cascadia fault was in 1700, so officials worry thatanother event could occur any time. To prevent that event from becoming a catastrophe, first responders will join members of the public in rehearsals that involve communication, evacuation, search and rescue, and other scenarios. first responders æ€¥æ•‘äººå‘˜ rehearsal ç»ƒä¹  evacuation ç–æ•£ Thousands of casualties are expected if a 9.0 carthquake were to occur. First the earthquake would shakemetropolitan areas including Seattle and Portland. This could trigger a tsunami that would create havoc along the coast. Not all casualties can necessarily be prevented â€” but by coordinating across local, state, and even national borders, officials hope that the worst-case scenario can be averted. On the exercises website officials explain that the report they prepare during this rehearsal will inform disaster management for years to come. casualty ä¼¤äº¡äººå‘˜ trigger è§¦å‘ averted é¿å… For hundreds of thousands of cascadia residents, â€œThe big oneâ€ isnâ€™t a question of if, only when. and itâ€™snever too early to get ready for the inevitable. 12 (äºŒ)The persistent haze over many of our cities is a reminder of the polluted air that we breathe, Over 80% of the worldâ€™s urban population is breathing air that fails to meet World Health Organisation guidelines, and an estimated 4.5 million people died prematurely from outdoor air pollution in 2015. Globally, urban populations are expected to double in the next 40 years, and an extra 2 billion people will need new places to live, as well as services and ways to move around their cities. What is more important, the decisions that we make now about the design of our cities will determian the everyday lives and health of the coming gerations. So what would a smug-free, or at least low-pollution, city be like? Traffic has become synonymous with air pollution, and many countries intend to ban the sale of new petrol and diesel cars in the next two decades. But simply switching to electric can will not mean pollution-free cities. The level of emissions they cause will depend on how the electricity to run them is generated, while brakes, tyres and toads all create tiny airborne particles as they wear out. Across the developed world, car use is in decline as more people move to city centers, while young people especially are opting for other means of travel. Researchers are already asking if motor vehicle use has reached itspeak and will decline, but transport planners have yet to catch up with this trend, instead of laying new roads to tackle traffic jams. As users of Londonâ€™s orbital M25 motorway will know, new roads rapidly fill with more traffic. In the US, studies have shown that doubling the size of a road can simply double the traffic, taking us back to the starting poin. How Much Protein Do You Really Need?The marketing is tempting: Get stronger muscles and healthier bodies with minimal effort by adding protein powder to your morning shake or juice drink. Or grab a protein bar at lunch or for a quick snack. Today you can find protein supplements everywhere â€” online or at the pharmacy, grocery store or health food store. They come in powders, pills and bars. With more than $12 billion in sales this year, the industry is booming and according to the market research company, Grand View Research, is on track to sell billions more by 2025. But do we really need all this supplemental protein? It depends. There are pros, cons and some other things to consider. the marketing is tempting è¥é”€å¾ˆè¯±äºº protein powder è›‹ç™½ç²‰ pharmacy è¯æˆ¿ pros and cons åˆ©ä¸å¼Š For starters, protein is critical for every cell in our body. It helps build nails, hair, bones and muscles. Itcan also help you feel fuller longer than eating foods without protein. And, unlike nutrients that are found only in few foods, protein is present in all foods. The typical American diet is a lot higher in protein than a lot of us think, says registered dietitian Angela Pipitone. Itâ€™s in foods many of us expect, such as beef, chicken and other types of meat and dairy. But itâ€™s also in foods that may not come immediately to mind like vegetables, fruit, beans and grains. critical è‡³å…³é‡è¦çš„ dietitian è¥å…»å¸ˆ grain è°·ç‰© shake å¥¶æ˜” broccoli è¥¿å…°èŠ± The U.S. governmentâ€™s recommended daily allowance (RDA) for the average adult is 50 to 60 gram of protein a day. This may sound like a lot, but Pipitone says: â€œWe get bits of protein here and there and that really adds up throughout the day.â€ Take, for example, breakfast If you eat two eggs topped with a little bit of cheese and an orange on the side, you already have 22 grams of protein. Each egg gives you 7 grams, the cheese gives you about 6 grams and the orange â€” about 2 grams. Add a lunch of chicken, rice and broccoli, and you are already over the recommended 50 grams. â€You can get enough protein and meet the RDA before you even get to dinner,â€œ says Pipitone. So if itâ€™s so easy to get your protein in food, why add more in the form of powders, snack bars or a boost at your local juice bar? No need to, says Pipitone, because, in fact, most of us already get enough protein in our diet. â€œWhole foods are always the best option rather than adding supplements,â€ she says, noting the FDA does not regulate supplements as rigorously as foods or drugs. So there could be less protein, more sugar and some additives you wouldnâ€™ t expect, such as caffeine. regulate æ§åˆ¶ è°ƒæ§ æœ‰ç³»ç»Ÿç®¡ç†çš„ rigorously ä¸¥å‰åœ° æ®‹é…·åœ° If you are considering a supplement, read the list of ingredients, she says, although this is not always reliable. â€œIâ€™ve seen very expensive protein supplements that claim to be high quality but they might not really be beneficial for the average healthy adult,â€ she says. â€œIt could just be a waste of money.â€ ingredient ç»„æˆéƒ¨åˆ† é…æ–™ do warrant å¯ä»¥ å…è®¸ marathon é©¬æ‹‰æ¾ moderately é€‚åº¦åœ° æœ‰èŠ‚åˆ¶åœ° edge ä¼˜åŠ¿ But there are certain situations that do warrant extra protein. â€œAnytime youâ€™re repairing or building muscle.â€ Pipitone says, â€œsuch as if youâ€™re an extreme endurance athlete training for a marathon or youâ€™re a body builder. If you are moderately exercising for 150 minutes a week, as the Centers for Disease Control and Prevention recommends, or less than that, youâ€™ re probably not an extreme athlete. Extreme athletes expend lots of energy breaking down and repairing and building muscles. Protein can give them the edge they need to speed that process. Vegans can benefit from protein supplements since they do not eat animal-based protein sources like meat, dairy or eggs. And, for someone always on-the-go who may not have time for a meal, a protein snack bar can be a good option for occasional meal replacement. Also, individuals recovering from surgery or an injury can also benefit from extra protein. So, too, can older people. At around age 60, â€œmuscles really start to break down,â€ says Kathryn Starr, an aging researcher, â€œand because of that, the protein needs of an older adult actually Increase.â€ Vegans çº¯ç´ ä¸»ä¹‰è€… dairy å¥¶åˆ¶å“ In fact, along with her colleague Connie Bales. Starr recently conducted a small study that found that adding extra protein foods to the diet of obese older individuals who were trying to lose weight strengthened their muscles. Participants in the study were separated into two groups â€” one group was asked to eat 30 grams of protein per meal in the form of whole foods. That meant they were eating 90 grams of protein a day. The other group â€” the control group â€” was put on a typical low-calorie diet with about 50 to 60 grams of protein a day. after six months, researchers found the high protein group had significantly improved their muscle function â€” almost twice as much as the control group. â€œThey were able to walk faster, had improved balance, and were also able to get up out of a chair faster than the control group.â€ Starr says. All 67 participants were over 60 years of age, and both groups lost about the same amount of weight. Starr is now looking into whether high-protein diets also improve the quality of the muscle itself in seniors. Sheâ€™s using CT scans to measure muscle size and fat, and comparing seniors on a high-protein diet with those on regular diets. She says her findings should be available in a couple of months. In the meantime, 70-year-old Corliss Keith, who was in the high protein group in Starrâ€™s latest study, say the feels a big difference. â€œI feel excellent,â€ she says. â€œI feel like i have a different body. I have more energy stronger.â€ She says she is able to take Zumba exercise classes three times a week, work out on the treadmill and take long, brisk walks. Keith also lost more than 15 pounds. â€œIm a fashionable person, so now Iâ€™m back in my 3-inch heels,â€ she says work out on the treadmill åœ¨è·‘æ­¥æœºä¸Šè¿åŠ¨ heel é«˜è·Ÿé‹ As people age, Starr says muscle strength is key to helping them stay strong and continue living on their own in their own home. â€œI feel very much alive now,â€ says Keith. â€œI feel like I could stay by myself until Iâ€™m 100.â€ Bat can people overdo protein? Pipitone says you do have to be careful. Other researchers say too much protein can cause cramps, headaches, and fatigue. Dehydration risk is also a risk when you eat too much protein. Pipitone says if you increase protein, you also have to increase your fluid intake. I always tell people to make sure theyâ€˜re drinking enough fluids, which for the average person is 60 to 70 ounces a day, which translates into eight 8-ounce glasses of water or liquid per day. cramp è‚Œè‚‰æŠ½æ fatigue ç–²åŠ³ dehydration è„±æ°´ kidney è‚¾è„ There have been some indications that extra protein makes the kidneys work harder, which could be problematic for individuals with a history of kidney disease and for them the supplements may increase the risk of kidney stones, the says. Bottom line, if you think you need more protein in your diet, consider these questions: Are you anextreme athlete; are you recovering from injury or surgery; or are you 60 years or older? If so, adding high protein foods like eggs and meat products to your diet can be beneficial. And, if youâ€™re not sure, in is always a good idea to check with your primary care provider. Passage OneLast year, a child was born at a hospital in the uk with her heart outside her body. Few babies survive this rare condition,and those who do must endure numerous operations and are likely to have complex needs. When her mother was interviewed, three weeks after her daughterâ€™s birth, she was asked if she was prepared for what might be a daunting task caring for her. She answered without hesitation that, as far as she was concerned, this would be a â€œprivilegeâ€. daunt ä½¿æ°”é¦ privilege è£å¹¸ ç‰¹æ®Šå¾…é‡ ideologies æ„è¯†å½¢æ€ interpret è§£é‡Š interrupt æ‰“æ–­ Rarely has there been a better example of the power of attitude, one of our most powerful psychological tools. Our attitudes allow us to turn mistakes into opportunities, and loss into the chance for new beginnings. An attitude is a settled way of thinking, feeling and/or behaving towards particular objects, people, events or ideologies. We use our attitudes to filter, interpret and react to the world around us. You werenâ€™t born with attitudes; rather they are all learned, and this happens in a number of ways. The most powerful influences occur during early childhood and include both what happened to you directly and what those around you did and said in your presence. As you acquire a distinctive identity your attitudes are further refined by the behavior of those with whom you identify â€” your family, those of your gender and culture and the people you admire, even though you may not know them personally. Friendships and other important relationships become increasingly important, particularly during adolescense, About that same time and throughout adulthood, the information you receive, especially when ideas are repeated in association with goals and achievements you find attractive, also refines your attitudes. acquire a distinctive identity è·å¾—ç‹¬ç‰¹çš„èº«ä»½ refined å®Œå–„ Many people assume that our attitudes are internally consistent, that is, the way you think and feel about someone or something predicts your behavior towards them. However, may studies have found that feelings and thoughts donâ€™t necessarily predict behavior. In general, your attitudes will be internally consistent only when th behavior is easy, and when those around you hold similar beliefs. Thatâ€™s why, for example, many say they believe in the benefits of recycling or exercise, but donâ€™t behave in line with their views, because it takes awareness, effort and courage to go beyond merely stating that you believe something is a good idea. One of the most effective ways to change an attitude is to start behaving as if you already feel and think the way youâ€™d prefer to. Take some time to reflect on your attitudes, to think about what you believe and why. Is there anything you consider a burden rather than a privilege? It so, start behaving right now as if the latter is the case. Passage TwoIndustrial fishing for krill in the unspoilt waters around Antarctica is threatening the future of one of the worlds last great wildernesses, according to a new report. the unspoilt waters æœªå—æ±¡æŸ“çš„æ°´åŸŸ vessel å®¹å™¨ in the immediate vicinity of åœ¨â€¦é™„è¿‘ penguin ä¼é¹… The study by Greenpeace analysed the movements of krill fishing vessels in the region and found they were increasingly operating â€œin the immediate vicinity of penguin colonies and whale feeding grounds.â€ It also highlights incidents of fishing boats being involved in groundings, oil spills and accidents, which posed a serious threat to the Antarctic ecosystem. oil spills æ¼æ²¹ Antarctic å—æ sanctuary ä¿æŠ¤åŒº tract åœŸåœ° åœ°å¸¦ reserve ä¿æŠ¤åŒº ä¿ç•™ å­˜å‚¨ marine æµ·çš„ The report, published on Tuesday, comes amid growing concern about the impact of fishing and climate change on the Antarctic. a global campaign has been launched to create a network of ocean sanctuaries to protect the seas in the region and Greenpeace is calling for an immediate halt to fishing in areas being considered for sanctuary status. Frida Bengtsson from Greenpeaceâ€™s Protect the Antarctic campaign said: â€œIf the krill industry wants to show itâ€™s a responsible player, then it should be voluntarily getting out of any area which is being proposed as an ocean sanctuary, and should instead be backing the protection of these huge tracts of the Antarctic.â€ A global campaign has been launched to turn a huge tract of Antarctic seas into ocean sanctuaries, protecting wildlife and banning not just krill fishing, but all fishing. One was created in the ross sea in 2016, another reserve is being proposed in a vast area of the Weddell Sea, and a third sanctuary is under consideration in the area west of the Antarctic Peninsula â€” a key krill fishing area. The Commission for the Conservation of Antarctic Marine Living Resources (CCAMLR) manages the seas around Antarctica. It will decide on the Weddell Sea sanctuary proposal at a conference in Australia in October, although a decision on the peninsula sanctuary is not expected until later. peninsula åŠå²› thrive ç¹è£çš„ Keith Reid, a science manager at CCAMLR, said that the organisation sought â€œa balance between protection, conservation and sustainable fishing in the Southern Ocean.â€ He said although more fishing was taking placenearer penguin colonies it was often happening later in the season when these colonies were empty. The creation of a system of marine protected areas is a key part of ongoing scientific and policy discussions in CCAMLR, he added. â€œ Our long-term operation in the region depends on a healthy and thriving antarctic marine ecosystem, which is why we have always had an open dialogue with the environmental non-governmental organisations. We strongly intend to continue this dialogue, including talks with Greenpeace, to discuss improvements based on the latest scientific data. We are not the ones to decide on the establishment of marine protected areas, but we hope to contribute positively with our knowledge and experience.â€ 12ï¼ˆä¸‰ï¼‰The number of devices you can talk to is multiplying â€” first it was your phone, then your cat, and now you can tell your kitchen appliances what to do. But even without gadgets that understand our spoken commands, research suggests that, as bizarre is it sounds under certain circumstances, people regularly ascribe human traits to everyday objects. gadgets å°é…ä»¶ å°å·¥å…· bizarre å¥‡å¼‚çš„ ascribe æŠŠâ€¦å½’äº human traits äººçš„ç‰¹è´¨ under certain circumstances åœ¨æŸäº›æƒ…å†µä¸‹ Sometimes we see things as human because we are lonely. In one experiment, people who reported feeling isolated were more likely than others to attribute consciousness to various gadget. In turn, feeling close to objects can alleviate loneliness. When college students were reminded of a time they had been exclude in a social setting, they compensated by exaggerating their number of friends â€” unless they were first given tasks that caused them to interact with their phone as if it had human qualities. according to the researchers the participantsâ€™ phones apparently substituted for real friends. isolated å­¤ç«‹çš„ alleviate ç¼“å’Œ in a social setting åœ¨ç¤¾äº¤åœºåˆä¸­ interact with ä¸â€¦ç›¸äº’ä½œç”¨ At other times, we personify products in an effort to understand them. One study found that three in fourrespondents yelled at their computer. Further, the more their computer gave them problems, the more likely therespondents were to report that it had its own â€œbeliefs and desiresâ€. So how do people assign trails to an object? In part, we rely on looks. On humans wide faces are associated withdominance. Similarly, people rated cars, clocks and watches with wide faces as more dominant-looking thannarrow-faced ones, and preferred them â€” especially in competitive situations. An analysis of car sales in Germany found that cars with grilles that were upturned like smiles sold best. The purchasers saw this feature â€” as increasing acarâ€™s friendliness. dominance ä¼˜åŠ¿ æ”¯é…åœ°ä½ rate è®¤ä¸º grille æ ¼å­,æ ¼æ … Why More Farmers Are Making The Switch to Grass-Fed Meat and Dairy?Though he didnâ€™t come from a farming family, from a young age Tim Joseph was fascinated by the idea of living off the land. Reading magazines like The Stockman Grass Farmer and Graze, he got hooked on the idea of grass-fed agriculture. The idea that all energy and wealth comes from the sun really intrigued him. He thought the shorter the distance between the sun and the end product the higher the profit to the farmer. intrigued å¥½å¥‡çš„ è¢«è¿·ä½äº†çš„ Joseph wanted to put this theory to the test. In 2009, he and his wife Laura launched Maple hill Creamery, an organic, all grass-fed yogurt company in northern New York. he quickly learned what the market has demonstrated: Demand for grass-fed products currently exceeds supply. Grass-fed beef is enjoying a 25-30% annual growth rate. Sales of grass-fed yogurt and kefir, on the other hand, have in the last year increased by over 38%. This is in comparison with a drop of just under 1% in the total yogurt and kefir market, according to natural and organic market research company SPINS. Josephâ€™s top priority became getting is hands on enough grass-fed milk to keep customers satisfied, since his own 64-cow herd wasnâ€™t going to suffice. demonstrate æ˜¾ç¤º kefir å‘é…µä¹³é¥®å“ exceed è¶…è¿‡ top priority å½“åŠ¡ä¹‹æ€¥ suffice è¶³å¤Ÿ herd ç•œç¾¤ His first partnership was with Paul and Phyllis Amburgh, owners of the Dharma Lea farm in New York. The Amburghs, too, were true believers in grass-fed. In addition to supplying milk from their own 85-head herd, they began to help other farmers in the area convert from conventional to certified organic and grass-fed in order to enter the Maple Hill supply chain. Since 2010, the couple has helped 125 small dairy farms convert to grass-fed, with more than 80% of those farms coming on board during the last two years. All this conversion has helped Maple hill grow 40-50% every year since it began, with no end in sight. Joseph has learned that a farmer has to have a certain mindset to successfully convert. But convincing open-minded dairy people is actually not that hard, when you look at the economics. Grass fed milk can fetch up to 2.5 times the price of conventional milk. Another factor is the squeeze that conventional dairy farmers have felt as the price of grain they feed their cows has gone up tightening their profit margins. By replacing expensive grain feed with regenerative management practices, grass-fed farmers are insulated from jumps in the price of feed. These practices include grazing animals on grasses grown from the pasturelandâ€™s natural seed bank, and fertilized by the cowsâ€™ own fertilizer. with no end in sight çœ‹ä¸åˆ°å°½å¤´ mindset å¿ƒæ€ insulate éš”ç¦» graze æ”¾ç‰§ pastureland ç‰§è‰åœ° ç‰§åœº fertilizer è‚¥æ–™ Champions of this type of regenerative grazing also point to its animal welfare, climate and health benefits: Grass-fed animals live longer out of confinement. Grazing herds stimulate microbial activity in the soil, helping to capture water and separate carbon. And grass-fed dairy and meat have been shown to be higher in certain nutrients and healthy fats. confinement é™åˆ¶ è¢«ç›‘ç¦ microbial å¾®ç”Ÿç‰©çš„ In the grass-fed system, farmers are also not subject to the wildly fluctuating milk prices of the international commodity market. The unpredictability of global demand and the lag-time it takes to add more cows to a herd to meet demand can result in events like the recent cheese surplus. Going grass-fed is a safe refuge, a way for family-scale farms to stay viable. Usually a farmer will get to the point where financially, what theyâ€™re doing is not working. Thats when they call Maple Hill. If the farm is well managed and has enough land, and the desire to convert is sincere, a relationship can begin. Through regular regional educational meetings, a large annual meeting, individual farm visits and thousands of phone calls, the Amburghs pass on the principles of pasture management. Maple hill signs a contract pledging to buy the farmerâ€™s milk at a guaranteed base price plus quality premiums and incentives for higher protein, butter-fat and other solids. fluctuating æ³¢åŠ¨ unpredictability ä¸å¯é¢„æµ‹æ€§ lag-time æ»åæ—¶é—´ surplus è¿‡å‰© refuge åº‡æŠ¤æ‰€ pasture ç‰§åœº pass on ä¼ é€’ incentive æ¿€åŠ± pledge è®¸è¯º While Maple Hillâ€™s conversion program is unusually hands-on and comprehensive, itâ€™s just one of a growing number of businesses committed to slowly changing the way America farms. Joseph calls sharing his knowledge network through peer-to-peer learning a core piece of the companys culture. Last summer, Massachusetts grass-fed beef advocate John Smith launched Big Picture Beef, a network of small grass-fed beef farms in New England and New York that is projected to bring to market 2,500 head of cattle from 125 producers this year. Early indications are that Smith will have no shortage of farm members. Since he began to informal announce the network at farming conferences and on social media, heâ€™s received a steady stream of inquiries from interested farmers. unusually ä¸å¯»å¸¸åœ° éå¸¸ inquiry è°ƒæŸ¥ Smith says heâ€™ll provide services ranging from formal seminars to on-farm workshops on holistic management, to one-on-one hand-holding and an almost 24/7 phone hotline for farmers who are converting. In exchange, he guarantees an above- market price for each animal and a calf-to-customer electronic ear tag ID system like that used in the European Union. holostic æ•´ä½“çš„ seminar è®¨è®ºä¼š calf ç‰›çŠŠ Though advocates portray grass-fed products as a win-win situation for all, they do have downsides. Price, for one, is an issue. Joseph says his products are priced 10-20% above organic versions, but depending on the product chosen, compared to non-organic conventional yogurt, consumers could pay a premium of 30-50% or more for grass-fed. As for the meat, Smith says his grass-fed hamburger will be priced 20-25% over the conventional alternative. But a look at the prices on online grocer Fresh Direct suggests a grass-fed premium of anywhere from 35-60%. premium é¢å¤–è´¹ç”¨ And not every farmer has the option of going grass-fed. For both beef and dairy production, it requires, at least in the beginning, more pastureland. Grass-fed beef production tends to be more labor-intensive as well. But Smith counters that if you factor in the hidden cost of government corn subsidies, environment degradation, and decreased human health and animal welfare, grass-fed is the more cost-effective model. The sun provides the lowest cost of production and the cheapest meat he says. labor-intensive åŠ³åŠ¨å¯†é›†å‹çš„ subsidy æ´¥è´´ degradation ä¸‹é™ Another grass-fed booster spurring farmers to convert is EPIC, which makes meat-based protein bars. Founders Taylor Collins and his wife, Katie Forrest, used to be endurance athletes: now theyâ€™re advocates of grass-fed meat. Soon after launching EPICs most successful product â€” the Bison Bacon Cranberry Bar â€” Collins and Forrest found theyâ€˜d exhausted their sources for bison raised exclusively on pasture. When they started researching the supply chain, they learned that only 2-3% of all bison is actually grass-fed. The rest is feed lot confined and fed grain and corn. spur æ¿€åŠ± bison é‡ç‰› confined (ç©ºé—´)æœ‰é™çš„ But after General Mills bought EPIC in 2016, Collins and forrest suddenly had the resources they needed to expand their supply chain. So the company teamed up with Wisconsin-based rancher Northstar Bison. EPIC fronted the money for the purchase of $2. 5 million worth of young bison that will be raised according to its grass-fed protocols, with a guaranteed purchase price. The message to young people who might not otherwise be able to afford to break into the business is, â€˜ You can purchase this $3 million piece of land here, because Iâ€™m guaranteeing you today youâ€™ll have 1,000 bison on it. Weâ€™re bringing new blood into the old, conventional farming ecosystem, which is really cool to see,â€ Collins explains. protocol æ¡æ¬¾ Passage OneSchools are not just a microcosm of society; they mediate it too. The best seek to alleviate the external pressures on their pupils while equipping them better to understand and handle the world outside â€” at once sheltering them and broadening their horizons. this is ambitious in any circumstances, and in a divided and unequal society the two ideals can clash outrigh. microcosm ç¼©å½± pupil å­¦ç”Ÿ ç³å­” horizon çœ¼ç•Œ outright ç›´æ¥åœ° Trips that many adults would consider the adventure of a lifetime â€” treks in Borneo, a sports tour to Barbados â€” appear to have become almost routine at some state schools. Parents are being asked for thousands of pounds. Though schools cannot profit from these trips, the companies that arrange them do. Meanwhile, pupils arrive at school hungry because their families cant afford breakfast. The Child Poverty Action Group says nine out of 30 in every claasroom fall below the poverty line. The discrepancy is startlingly apparent. Introducing a fundraising requirement for students does not help, as better-off children can tap up richer aunts and neighbours. discrepancy å·®å¼‚ startlingly ä»¤äººéœ‡æƒŠçš„ fundraising ç­¹æ¬¾ Probing the rock pools of a local beach or practising French on a language exchange can fire childrens passions, boost their skills and open their eyes to lifes possibilities. Educational outings help bright but disadvantaged students to get better scores in A-level tests. In this globalised age, there is a good case for international travel, and some parents say they can manage the cost of a school trip abroad more easily than a family holiday. Even in the face of immense and mounting financial pressures, some schools have shown remarkable determination and ingenuity in ensuring that all their pupils are able to take up opportunities that may be truly life-changing. They should be applauded. Methods such as whole-school fundraising, with the proceeds pooled, can help to extend opportunities and fuel community spirit. probe æ¢ç´¢ remarkable å¼‚å¸¸çš„ ingenuity è¶³æ™ºå¤šè°‹ foster æ»‹å…» But ï¿¡3,000 trips cannot be justified when the average income for families with children is just over ï¿¡30,000. Such initiatives close doors for many pupils. Some parents pull their children out of school because of expensive field trips. Even parents who can see that a trip is little more than a party or celebration may well feel guilt that their child is left behind. initiative ä¸»åŠ¨ board and lodging é£Ÿå®¿ syllabus æ•™å­¦å¤§çº² exempt å…é™¤ glamorous è¿·äººçš„ exotic å¸å¼•äººçš„ The Department for Educationâ€™s guidance says schools can charge only for board and lodging if the trip is part of the syllabus, and that students receiving government aid are exempt from these costs. However, many schools seem to ignore the advice; and it does not cover the kind of glamorous, exotic trips which are becoming increasingly common. Schools cannot be expected to bring together communities single-handed. But the least we should expect is that they do not foster divisions and exclude those who are already disadvantaged. Passage TwoRising temperatures and overfishing in the pristine waters around the Antarctic could see king penguin populations pushed to the brink of extinction by the end of the century, according to a new study. The studys report states that as global warming transforms the environment in the worldâ€™s last great wilderness, 70 percent of king penguins could either disappear or be forced to find new breeding grounds. pristine åŸå§‹çŠ¶æ€çš„ brink (å±é™©çš„)è¾¹æ²¿ extinction ç­ç» Co-author Celine le bohea, from the university of Strasbourg in France, warned: If therere no actions aimed at halting or controlling global warming, and the pace of the current human-induced changes such as climate change and overfishing stays the same, the species may soon disappear. The findings come amid growing concern over the future of the Antarctic. Earlier this month a separate study found that a combination of climate change and industrial fishing is threatening the kril population in Antarctic waters, with a potentially disastrous impact on whales, seals and penguins. But todayâ€™s report is the starkest warning yet of the potentially devastating impact of climate change and human exploitation on the Antarcticâ€™s delicate ecosystems. stark ä¸¥é…·çš„ wiped out ç­ç» plight å›°å¢ƒ mammal å“ºä¹³åŠ¨ç‰© predic é¢„è¨€ scarce ç¼ºä¹çš„ a handful of å°‘é‡çš„ Le Bohec said: â€œUnless current greenhouse gas emissions drop, 70 percent of king penguins â€” 1.1 millionbreeding pairs â€” will be forced to relocate their breeding grounds, or face extinction by 2100.â€ King penguins arethe second-largest type of penguin and only breed on specific isolated islands in the Southern Ocean where there isno ice cover and easy access to the sea. As the ocean warms, a body of water called the Antarctic Polar Front â€” anupward movement of nutrient-rich sea that supports a huge abundance of marine life â€” is being pushed furthersouth. This means that king penguins, which feed on fish and krill in this body of water, have to travel further totheir feeding grounds, leaving their hungry chicks for longer. And as the distance between their breeding, groundsand their fool grows, entire colonies could be wiped out. Le bohec said: â€œThe plight of the king penguin should serve as a warning about the future of the entire marine environment in the Antarctic. Penguins, like other seabirds and marine mammals, occupy higher levels in the food chain and they are what we call bio-indicators of their ecosystems. Penguins are sensitive indicators of changes in marine ecosystems. As such, they are key species for understanding and predicting impacts of global change on Antarctic and sub-Antarctic marine ecosystems. The report found that although some king penguins may be able to relocate to new breeding grounds closer to their retreating food source, suitable new habitats would be scarce. Only a handful of islands in the Southern Ocean are suitable for sustaining large breeding colonies.","categories":[{"name":"English","slug":"English","permalink":"http://yoursite.com/categories/English/"}],"tags":[{"name":"CET6","slug":"CET6","permalink":"http://yoursite.com/tags/CET6/"}]},{"title":"Chatroom å„åŠŸèƒ½æ¨¡å—çš„å®ç°","slug":"Chatroom/Chatroom åŠŸèƒ½æ¨¡å—","date":"2020-02-24T02:20:02.000Z","updated":"2020-04-19T06:24:52.203Z","comments":true,"path":"2020/02/24/Chatroom/Chatroom åŠŸèƒ½æ¨¡å—/","link":"","permalink":"http://yoursite.com/2020/02/24/Chatroom/Chatroom%20%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/","excerpt":"Chatroom å„åŠŸèƒ½æ¨¡å—çš„åˆ†æä¸å®ç°ã€‚","text":"Chatroom å„åŠŸèƒ½æ¨¡å—çš„åˆ†æä¸å®ç°ã€‚ æ•°æ®åº“ç»“æ„ åŸºäº Spring æ³¨è§£å¼å¼€å‘ å‰åç«¯åˆ†ç¦»ï¼Œè¿”å› Json çš„è§†å›¾å¯¹è±¡ç±» 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374public class ResponseJson extends HashMap&lt;String, Object&gt; &#123; private static final long serialVersionUID = 1L; private static final Integer SUCCESS_STATUS = 200; private static final Integer ERROR_STATUS = -1; private static final String SUCCESS_MSG = \"ä¸€åˆ‡æ­£å¸¸\"; public ResponseJson() &#123; super(); &#125; public ResponseJson(int code) &#123; super(); setStatus(code); &#125; public ResponseJson(HttpStatus status) &#123; super(); setStatus(status.value()); setMsg(status.getReasonPhrase()); &#125; public ResponseJson success() &#123; put(\"msg\", SUCCESS_MSG); put(\"status\", SUCCESS_STATUS); return this; &#125; public ResponseJson success(String msg) &#123; put(\"msg\", msg); put(\"status\", SUCCESS_STATUS); return this; &#125; public ResponseJson error(String msg) &#123; put(\"msg\", msg); put(\"status\", ERROR_STATUS); return this; &#125; public ResponseJson setData(String key, Object obj) &#123; @SuppressWarnings(\"unchecked\") HashMap&lt;String, Object&gt; data = (HashMap&lt;String, Object&gt;) get(\"data\"); if (data == null) &#123; data = new HashMap&lt;String, Object&gt;(); put(\"data\", data); &#125; data.put(key, obj); return this; &#125; public ResponseJson setStatus(int status) &#123; put(\"status\", status); return this; &#125; public ResponseJson setMsg(String msg) &#123; put(\"msg\", msg); return this; &#125; public ResponseJson setValue(String key, Object val) &#123; put(key, val); return this; &#125; /** * è¿”å›JSONå­—ç¬¦ä¸² */ @Override public String toString() &#123; return JSONObject.toJSONString(this); &#125;&#125; ç”¨æ¥å­˜æ”¾ Netty WebSocket è¿æ¥ä¿¡æ¯çš„å¸¸é‡ç±» 123456789101112public class Constant &#123; // ä¸€ä¸ª userId å¯¹åº”ä¸€ä¸ª Session public static final String USER_TOKEN = \"userId\"; // ç”¨äºä¿å­˜ Http å‡çº§ WebSocket åçš„æ¡æ‰‹å®ä¾‹ public static Map&lt;String, WebSocketServerHandshaker&gt; webSocketHandshakerMap = new ConcurrentHashMap&lt;String, WebSocketServerHandshaker&gt;(); // ç”¨äºä¿å­˜å·²ç™»å½•çš„ç”¨æˆ·çš„é€šé“ä¿¡æ¯ public static Map&lt;String, ChannelHandlerContext&gt; onlineUserMap = new ConcurrentHashMap&lt;String, ChannelHandlerContext&gt;();&#125; ç”¨æˆ·ç™»å½• User ğŸ‘‰ å®ä½“ç±»ï¼Œä¸æ•°æ®åº“è¡¨ user å‘å¯¹åº” 123456789public class User &#123; private Long userId; private String username; private String password; private String avatarUrl; // çœç•¥äº† Getter Setter toString æ–¹æ³•&#125; UserDaoã€UserMapperğŸ‘‰ é€šè¿‡ç”¨æˆ·è¾“å…¥çš„ç”¨æˆ·ååˆ°æ•°æ®åº“ä¸­æ‰¾åˆ°æ­¤ç”¨æˆ·çš„ç”¨æˆ·ä¿¡æ¯ã€‚ 1User getByUsername(String username); 123456789&lt;select id=\"getByUsername\" resultType=\"com.wingo.model.po.User\" &gt; &lt;!-- å…·ä½“çš„sql --&gt; SELECT user_id, username, password FROM user WHERE username = #&#123;username&#125;&lt;/select&gt; SecurityServiceã€SecurityServiceImpl ğŸ‘‰ å®ç°ç™»å½•çš„ä¸šåŠ¡é€»è¾‘ 123456789101112public ResponseJson login(String username, String password, HttpSession session) &#123; User user = userDao.getByUsername(username); if (user == null) &#123; return new ResponseJson().error(\"ä¸å­˜åœ¨è¯¥ç”¨æˆ·å\"); &#125; if (!user.getPassword().equals(password)) &#123; return new ResponseJson().error(\"å¯†ç ä¸æ­£ç¡®\"); &#125; // å°†å·²ç™»å½•çš„ç”¨æˆ·çš„ userId ä¿å­˜åœ¨ Session ä¸­ session.setAttribute(Constant.USER_TOKEN, user.getUserId()); return new ResponseJson().success();&#125; SecurityController ğŸ‘‰ URLæ˜ å°„ä»¥åŠå‰åç«¯æ•°æ®äº¤äº’ 12345@RequestMapping(value = \"login\", method = RequestMethod.POST)@ResponseBodypublic ResponseJson login(HttpSession session, @RequestParam String username, @RequestParam String password) &#123; return securityService.login(username, password, session);&#125; ç”¨æˆ·ç‚¹å‡»ç™»å½•æŒ‰é’®åï¼Œå‘é€ Ajax è¯·æ±‚è¿›è¡Œç”¨æˆ·éªŒè¯ï¼ŒéªŒè¯é€šè¿‡åè·³è½¬åˆ° chatroom é¡µé¢ã€‚ 123456789101112131415161718192021&lt;script type=\"text/javascript\"&gt; function login() &#123; $.ajax(&#123; type : 'POST', url : 'login', dataType: 'json', data : &#123; username: $(\"#username\").val(), password: $(\"#password\").val() &#125;, async : false, success: function(data) &#123; if (data.status == 200) &#123; window.location.href=\"chatroom\"; &#125; else &#123; alert(data.msg); &#125; &#125; &#125;);&#125;&lt;/script&gt; åˆå§‹åŒ–ç”¨æˆ·ä¿¡æ¯ ç”¨æˆ·æ‹¦æˆªè®¤è¯UserAuthInteceptor ğŸ‘‰ æ£€æµ‹ç”¨æˆ·æ˜¯å¦ç™»å½•å¹¶è®¾ç½®èµ„æºè®¿é—®æƒé™ 12345678910111213141516171819202122232425262728public class UserAuthInteceptor implements HandlerInterceptor &#123; @Override public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception &#123; HttpSession session = request.getSession(); Object userToken = session.getAttribute(Constant.USER_TOKEN); if (userToken == null) &#123; response.sendRedirect(\"login\"); return false; &#125; return true; &#125; @Override public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception &#123; // å…è®¸æ‰€æœ‰èµ„æºéƒ½å¯ä»¥è®¿é—®èµ„æº response.setHeader(\"Access-Control-Allow-Origin\", \"*\"); // è¡¨ç¤ºæ˜¯å¦å¯ä»¥å°†å¯¹è¯·æ±‚çš„å“åº”æš´éœ²ç»™é¡µé¢ response.setHeader(\"Access-Control-Allow-Credentials\",\"true\"); &#125; @Override public void afterCompletion(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object o, Exception e) throws Exception &#123; &#125;&#125; é…ç½® Spring MVC å¯¹ chatoom é¡µé¢çš„è®¿é—®è¯·æ±‚è¿›è¡Œæ‹¦æˆªè®¤è¯ 1234567&lt;!-- ç”¨æˆ·è®¤è¯æ‹¦æˆªå™¨ --&gt;&lt;mvc:interceptors&gt; &lt;mvc:interceptor&gt; &lt;mvc:mapping path=\"/chatroom/**\" /&gt; &lt;bean class=\"com.wingo.web.interceptor.UserAuthInteceptor\" /&gt; &lt;/mvc:interceptor&gt;&lt;/mvc:interceptors&gt; PO &amp; VOåœ¨è¿”å›ç»™ç”¨æˆ·çš„ä¿¡æ¯ä¸­ï¼Œé™¤äº†ç”¨æˆ·çš„ä¸ªäººä¿¡æ¯ï¼Œè¿˜éœ€è¦ç”¨æˆ·çš„å¥½å‹åˆ—è¡¨ä¿¡æ¯ä»¥åŠç¾¤èŠåˆ—è¡¨ä¿¡æ¯ã€‚åˆ›å»ºä¸€ä¸ª VO ç±»ç”¨äºä¿å­˜å‰ç«¯æ‰€éœ€è¦çš„æ‰€æœ‰ä¿¡æ¯ã€‚ UserInfo ç±» 123456789101112public class UserInfo &#123; private Long userId; private String username; private String password; private String avatarUrl; private List&lt;User&gt; friendList; // å¥½å‹åˆ—è¡¨ä¿¡æ¯ private List&lt;Chatgroup&gt; groupList; // ç¾¤èŠä¿¡æ¯ // æ„é€ å™¨æ–¹æ³•ä¾¿äºå®ä¾‹åŒ– // ...&#125; Chatgroup ç±» 123456789// group ä¸º MySQL çš„å…³é”®å­—ï¼Œä¸å¯ä½¿ç”¨public class Chatgroup &#123; private Long groupId; private String groupName; private String groupAvatarUrl; // ...&#125; GroupInfo ç±» 12345678910public class GroupInfo &#123; private Long groupId; private String groupName; private String groupAvatarUrl; private List&lt;User&gt; members; // æ„é€ å™¨æ–¹æ³•ä¾¿äºå®ä¾‹åŒ– // ...&#125; ChatroomController ğŸ‘‰ é€šè¿‡ userId è·å–ç”¨æˆ·çš„ä¿¡æ¯ 1234567@RequestMapping(value = \"/get_userinfo\", method = RequestMethod.POST) @ResponseBodypublic ResponseJson getUserInfo(HttpSession session) &#123; Object userId = session.getAttribute(Constant.USER_TOKEN); System.out.println(\"Session ä¸­çš„ userId = \" + userId); return userService.getByUserId(String.valueOf(userId));&#125; UserServiceImpl 123456789101112131415161718192021222324252627282930313233343536373839@Servicepublic class UserServiceImpl implements UserService &#123; @Autowired private UserDao userDao; @Autowired private UserChatRelationDao userChatRelationDao; @Autowired private GroupDao groupDao; @Override public ResponseJson getByUserId(String userId) &#123; User user = userDao.getByUserId(userId); UserInfo userInfo = new UserInfo( user.getUserId(), user.getUsername(), user.getPassword(), user.getAvatarUrl() ); // friendList æ„é€  List&lt;String&gt; friendsId = userChatRelationDao.getUserFriendsIdByUserId(userId); List&lt;User&gt; friends = new ArrayList&lt;User&gt;(); for(String friendId : friendsId)&#123; User friend = userDao.getByUserId(friendId); friends.add(friend); &#125; // groupList æ„é€  List&lt;String&gt; groupsId = userChatRelationDao.getGroupsIdByUserId(userId); List&lt;Chatgroup&gt; groups = new ArrayList&lt;Chatgroup&gt;(); for(String groupId : groupsId)&#123; Chatgroup group = groupDao.getByGroupId(groupId); groups.add(group); &#125; userInfo.setGroupList(groups); userInfo.setFriendList(friends); return new ResponseJson().success() .setData(\"userInfo\", userInfo); &#125;&#125; é€šè¿‡ Swagger æ¨¡æ‹Ÿè¯·æ±‚å–å¾—è¿”å›çš„ Json æ•°æ®ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839&#123; \"msg\": \"ä¸€åˆ‡æ­£å¸¸\", \"data\": &#123; \"userInfo\": &#123; \"userId\": 1, \"username\": \"test1\", \"password\": null, \"avatarUrl\": \"static/img/avatar/Member001.jpg\", \"friendList\": [ &#123; \"userId\": 2, \"username\": \"test2\", \"password\": null, \"avatarUrl\": \"static/img/avatar/Member001.jpg\" &#125;, &#123; \"userId\": 4, \"username\": \"test3\", \"password\": null, \"avatarUrl\": \"static/img/avatar/Member001.jpg\" &#125;, &#123; \"userId\": 5, \"username\": \"test4\", \"password\": null, \"avatarUrl\": \"static/img/avatar/Member001.jpg\" &#125; ], \"groupList\": [ &#123; \"groupId\": 1000, \"groupName\": \"Group1\", \"groupAvatarUrl\": \"static/img/avatar/Group01.jpg\" &#125; ] &#125; &#125;, \"status\": 200&#125; ç”¨æˆ·ä¿¡æ¯åˆå§‹åŒ–å®Œæˆã€‚ é¡µé¢å¸ƒå±€ç²—ç•¥ç‰ˆ ç”¨æˆ·å•èŠå‰ç«¯é¡µé¢åœ¨å–å¾—åå°æ‰€è¿”å›çš„ Json ä¿¡æ¯ä¹‹åï¼Œæ ¹æ®ä¿¡æ¯åˆå§‹åŒ–ç”¨æˆ·çš„èŠå¤©é¡µé¢ã€‚ æ­¤ç¨‹åºä¸å°†èŠå¤©ä¿¡æ¯ä¿å­˜åˆ°æ•°æ®åº“ä¸­ï¼Œè€Œæ˜¯ä¿å­˜åœ¨å‰ç«¯çš„èŠå¤©é¡µé¢ç”¨ Javascript æ‰€è‡ªå®šä¹‰çš„ä¸€ä¸ªæ•°æ®ç»“æ„é‡Œï¼Œä¸€ä¸ªSentMessageMap(key, new Array())ã€‚ç”¨æˆ·è¿›è¡Œç”¨æˆ·ä¿¡æ¯çš„åˆå§‹åŒ–æ—¶è¦å°†æ­¤ç”¨æˆ·ä¿¡æ¯ä¸­çš„ groupId ä»¥åŠ userId ä½œä¸ºé”®åˆå§‹åŒ–è¿™ä¸ªèŠå¤©ä¿¡æ¯çš„ Mapï¼Œä»¥ä¾¿åé¢è¿›è¡ŒèŠå¤©ä¿¡æ¯çš„ä¿å­˜ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263function setUserInfo() &#123; $.ajax(&#123; type : 'POST', url : 'chatroom/get_userinfo', dataType: 'json', async : true, success: function(data) &#123; console.log(\"è·å–ç”¨æˆ·ä¿¡æ¯...\"); if (data.status == 200) &#123; // è‡ªå®šä¹‰çš„æ•°æ®ç»“æ„ï¼Œç”¨äºä¿å­˜èŠå¤©ä¿¡æ¯è¿›è¡Œå›æ˜¾ sentMessageMap = new SentMessageMap(); // è·å–ç”¨æˆ·ä¿¡æ¯ var userInfo = data.data.userInfo; userId = userInfo.userId; $(\"#username\").html(userInfo.username); $(\"#avatarUrl\").attr(\"src\", userInfo.avatarUrl); var groupListHTML = \"\"; // è·å–ç”¨æˆ·çš„ç¾¤ç»„ä¿¡æ¯ var groupList = userInfo.groupList; // åˆå§‹åŒ–ç¾¤èŠæ¡†åˆ—è¡¨ for (var i = 0; i &lt; groupList.length; i++) &#123; // æ·»åŠ  Key sentMessageMap.put(groupList[i].groupId, new Array()); groupListHTML += '&lt;li&gt;' + '&lt;div class=\"liLeft\"&gt;&lt;img src=\"' + groupList[i].groupAvatarUrl + '\"&gt;&lt;/div&gt;' + '&lt;div class=\"liRight\"&gt;' + '&lt;span class=\"hidden-groupId\"&gt;' + groupList[i].groupId + '&lt;/span&gt;' + '&lt;span class=\"intername\"&gt;' + groupList[i].groupName + '&lt;/span&gt;' + '&lt;span class=\"infor\"&gt;&lt;/span&gt;' + '&lt;/div&gt;' + '&lt;/li&gt;'; &#125; // æ·»åŠ ç¾¤èŠæ¡†åˆ—è¡¨ $('.conLeft ul').append(groupListHTML); var friendListHTML = \"\"; // è·å–ç”¨æˆ·å¥½å‹ä¿¡æ¯ var friendList = userInfo.friendList; // åˆå§‹åŒ–å¥½å‹æ¡†åˆ—è¡¨ for (var i = 0; i &lt; friendList.length; i++) &#123; // æ·»åŠ  Key sentMessageMap.put(friendList[i].userId, new Array()); friendListHTML += '&lt;li&gt;' + '&lt;div class=\"liLeft\"&gt;&lt;img src=\"' + friendList[i].avatarUrl + '\"&gt;&lt;/div&gt;' + '&lt;div class=\"liRight\"&gt;' + '&lt;span class=\"hidden-userId\"&gt;' + friendList[i].userId + '&lt;/span&gt;' + '&lt;span class=\"intername\"&gt;' + friendList[i].username + '&lt;/span&gt;' + '&lt;span class=\"infor\"&gt;&lt;/span&gt;' + '&lt;/div&gt;' + '&lt;/li&gt;'; &#125; // æ·»åŠ å¥½å‹åˆ—è¡¨ $('.conLeft ul').append(friendListHTML); // ç»‘å®šå¥½å‹æ¡†ç‚¹å‡»äº‹ä»¶ï¼šæ˜¾ç¤ºå³ä¾§æ¶ˆæ¯æ¡† $('.conLeft ul li').on('click', friendLiClickEvent); &#125; else &#123; alert(data.msg); &#125; &#125; &#125;);&#125; å•èŠæµç¨‹ ç›‘å¬ç»‘å®š1234567891011121314151617181920212223242526272829303132333435363738if(!window.WebSocket)&#123; window.WebSocket = window.MozWebSocket; &#125; if(window.WebSocket)&#123; socket = new WebSocket(\"ws://localhost:3333\"); socket.onmessage = function(event)&#123; var json = JSON.parse(event.data); if (json.status == 200) &#123; var type = json.data.type; console.log(\"æ”¶åˆ°ä¸€æ¡æ–°ä¿¡æ¯ï¼Œç±»å‹ä¸ºï¼š\" + type); switch(type) &#123; case \"REGISTER\": ws.registerReceive(); break; case \"SINGLE_SENDING\": ws.singleReceive(json.data); break; default: console.log(\"ä¸æ­£ç¡®çš„ç±»å‹ï¼\"); &#125; &#125; else &#123; alert(json.msg); console.log(json.msg); &#125; &#125;; // è¿æ¥æˆåŠŸ1ç§’åï¼Œå°†ç”¨æˆ·ä¿¡æ¯æ³¨å†Œåˆ°æœåŠ¡å™¨åœ¨çº¿ç”¨æˆ·è¡¨ socket.onopen = setTimeout(function(event)&#123; console.log(\"WebSocketå·²æˆåŠŸè¿æ¥ï¼\"); ws.register(); &#125;, 1000) socket.onclose = function(event)&#123; console.log(\"WebSocketå·²å…³é—­...\"); &#125;; &#125; else &#123; alert(\"æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒWebSocketï¼\"); &#125; WebSocket å¤„ç†1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162var ws = &#123; register: function() &#123; if (!window.WebSocket) &#123; return; &#125; if (socket.readyState == WebSocket.OPEN) &#123; var data = &#123; \"userId\" : userId, \"type\" : \"REGISTER\" &#125;; socket.send(JSON.stringify(data)); &#125; else &#123; alert(\"Websocketè¿æ¥æ²¡æœ‰å¼€å¯ï¼\"); &#125; &#125;, singleSend: function(fromUserId, toUserId, content) &#123; if (!window.WebSocket) &#123; return; &#125; if (socket.readyState == WebSocket.OPEN) &#123; var data = &#123; \"fromUserId\" : fromUserId, \"toUserId\" : toUserId, \"content\" : content, \"type\" : \"SINGLE_SENDING\" &#125;; // å°†ä¿¡æ¯å‘é€ç»™å®¢æˆ·ç«¯çš„ WebSocketServerhandler è¿›è¡Œå¤„ç† socket.send(JSON.stringify(data)); &#125; else &#123; alert(\"Websocketè¿æ¥æ²¡æœ‰å¼€å¯ï¼\"); &#125; &#125;, registerReceive: function() &#123; console.log(\"userIdä¸º \" + userId + \" çš„ç”¨æˆ·ç™»è®°åˆ°åœ¨çº¿ç”¨æˆ·è¡¨æˆåŠŸï¼\"); &#125;, singleReceive: function(data) &#123; // è·å–ã€æ„é€ å‚æ•° console.log(data); var fromUserId = data.fromUserId; var content = data.content; var fromAvatarUrl; var $receiveLi; // ä¸ºè®¾ç½®æ¶ˆæ¯æé†’ä»¥åŠè·å–å¤´åƒå–å¾—å…ƒç´  $('.conLeft').find('span.hidden-userId').each(function()&#123; if (this.innerHTML == fromUserId) &#123; fromAvatarUrl = $(this).parent(\".liRight\") .siblings(\".liLeft\").children('img').attr(\"src\"); $receiveLi = $(this).parent(\".liRight\").parent(\"li\"); &#125; &#125;) var answer=''; answer += '&lt;li&gt;' + '&lt;div class=\"answers\"&gt;'+ content +'&lt;/div&gt;' + '&lt;div class=\"answerHead\"&gt;&lt;img src=\"' + fromAvatarUrl + '\"/&gt;&lt;/div&gt;' + '&lt;/li&gt;'; // æ¶ˆæ¯æ¡†å¤„ç† æ”¾å…¥æš‚å­˜åŒºï¼Œè‹¥ç”¨æˆ·æ­£å¤„äºä¸æ–°å‘æ¶ˆæ¯ç”¨æˆ·çš„èŠå¤©çª—å£åˆ™å›æ˜¾ï¼ˆåˆ©ç”¨æš‚å­˜åŒºè®¡ç®—é«˜åº¦ï¼‰ processMsgBox.receiveSingleMsg(answer, fromUserId); // å¥½å‹åˆ—è¡¨å¤„ç† 1.è®¾ç½®çº¢è‰²æé†’æ ‡å¿— 2.è®¾ç½®éƒ¨åˆ†æ–°æ¶ˆæ¯æé†’ 3.ç½®é¡¶æ–°æ¶ˆæ¯ processFriendList.receiving(content, $receiveLi); &#125;,&#125; å‘é€æŒ‰é’®1234567891011121314151617181920212223242526272829303132333435$('.sendBtn').on('click',function()&#123; var fromUserId = userId; var toUserId = $('#toUserId').val(); var toGroupId = $('#toGroupId').val(); var news = $('#dope').val(); if (toUserId == '' &amp;&amp; toGroupId == '') &#123; alert(\"è¯·é€‰æ‹©å¯¹è¯æ–¹\"); return; &#125; if(news == '')&#123; alert('æ¶ˆæ¯ä¸èƒ½ä¸ºç©º'); return; &#125; else &#123; if (toUserId.length != 0) &#123; ws.singleSend(fromUserId, toUserId, news); &#125; else &#123; // ç¾¤å‘ &#125; $('#dope').val(''); var avatarUrl = $('#avatarUrl').attr(\"src\"); var msg = ''; msg += '&lt;li&gt;'+ '&lt;div class=\"news\"&gt;' + news + '&lt;/div&gt;' + '&lt;div class=\"nesHead\"&gt;&lt;img src=\"' + avatarUrl + '\"/&gt;&lt;/div&gt;' + '&lt;/li&gt;'; // æ¶ˆæ¯æ¡†å¤„ç†ï¼š processMsgBox.sendMsg(msg, toUserId, toGroupId); // å¥½å‹åˆ—è¡¨å¤„ç†ï¼š var $sendLi = $('.conLeft').find('li.bg'); processFriendList.sending(news, $sendLi); &#125;&#125;) æ¶ˆæ¯æ¡†å¤„ç†123456789101112131415161718192021222324252627282930sendMsg: function(msg, toUserId, toGroupId) &#123; // æŠŠå†…å®¹æ·»åŠ åˆ°æ¶ˆæ¯æ¡† $('.newsList').append(msg); // 2. æ‰‹åŠ¨è®¡ç®—ã€è°ƒæ•´å›æ˜¾æ¶ˆæ¯çš„å®½åº¦ var $newsDiv = $('.newsList li').last().children(\"div\").first(); var fixWidth = 300; // è‡ªå®šä¹‰çš„æ¶ˆæ¯æ¡†æœ¬èº«çš„æœ€é•¿å®½åº¦ var maxWidth = 493; // æ¶ˆæ¯æ¡†æ‰€åœ¨è¡Œ div çš„æ»¡å®½åº¦ï¼ˆä¸åŒ…å«å¤´åƒæ¡†çš„å®½åº¦éƒ¨åˆ†ï¼‰ var minMarginLeftWidth = 224; // æŒ‰ç†è¯´åº”è¯¥æ˜¯ maxwidth - fixWidthï¼Œè¿™é‡Œå‡ºç°äº†ç‚¹é—®é¢˜ var marginLeftWidth; // è¦è®¡ç®—æ¶ˆæ¯æ¡†çš„margin-leftå®½åº¦ if ($newsDiv.actual('width') &lt; fixWidth) &#123; marginLeftWidth = maxWidth - $newsDiv.actual('width'); $newsDiv.css(\"margin-left\", marginLeftWidth + \"px\"); &#125; else &#123; $newsDiv.css(\"width\", fixWidth + \"px\") .css(\"margin-left\", minMarginLeftWidth + \"px\"); &#125; // 3. æŠŠ è°ƒæ•´åçš„æ¶ˆæ¯htmlæ ‡ç­¾å­—ç¬¦ä¸² æ·»åŠ åˆ°å·²å‘é€ç”¨æˆ·æ¶ˆæ¯è¡¨ if (toUserId.length != 0) &#123; // å¾—åˆ°æ•°ç»„æ·»åŠ æ–°æ¶ˆæ¯ ä»¥ outerHTML çš„å½¢å¼ // last() å¾—åˆ°åŒ¹é…å…ƒç´ çš„æœ€åä¸€ä¸ª sentMessageMap.get(toUserId).push($('.newsList li').last().prop(\"outerHTML\")); &#125; else &#123; sentMessageMap.get(toGroupId).push($('.newsList li').last().prop(\"outerHTML\")); &#125; // 4. æ»šåŠ¨æ¡å¾€åº•éƒ¨ç§» $('.RightCont').scrollTop($('.RightCont')[0].scrollHeight );&#125; å¥½å‹åˆ—è¡¨å¤„ç†12345678910111213141516sending: function(content, $sendLi) &#123; // è®¾ç½®éƒ¨åˆ†æ–°æ¶ˆæ¯æé†’ if (content.length &gt; 8) &#123; content = content.substring(0, 8) + \"...\"; &#125; $('.conLeft').find('li.bg').children('.liRight').children('.infor').text(content); // å¦‚æœå­˜åœ¨æ–°æ¶ˆæ¯æé†’å¾½ç« ï¼Œåˆ™å»é™¤å¾½ç«  if ($sendLi.find('.layui-badge').length &gt; 0) &#123; $sendLi.find('.layui-badge').remove(); &#125; //$('.conLeft ul').prepend('&lt;li class=\"bg\"&gt;' + $sendLi.html() + '&lt;/li&gt;'); // å¥½å‹æ¡†æ–°æ¶ˆæ¯ç½®é¡¶ $('.conLeft ul').prepend($sendLi.prop(\"outerHTML\")); $sendLi.remove(); $('.conLeft ul li').first().on('click', friendLiClickEvent)&#125; æœåŠ¡å™¨å¤„ç†12345678910111213141516171819202122@Overridepublic void singleSend(JSONObject param, ChannelHandlerContext ctx) &#123; String fromUserId = String.valueOf(param.get(\"fromUserId\")); String toUserId = (String)param.get(\"toUserId\"); String content = (String)param.get(\"content\"); // å–å¾—æ¥æ”¶è€…çš„é€šé“ ChannelHandlerContext toUserCtx = Constant.onlineUserMap.get(toUserId); if (toUserCtx == null) &#123; String responseJson = new ResponseJson() .error(MessageFormat.format(\"userIdä¸º &#123;0&#125; çš„ç”¨æˆ·æ²¡æœ‰ç™»å½•ï¼\", toUserId)) .toString(); sendMessage(ctx, responseJson); &#125; else &#123; String responseJson = new ResponseJson().success() .setData(\"fromUserId\", fromUserId) .setData(\"content\", content) .setData(\"type\", ChatType.SINGLE_SENDING) .toString(); // å‘é€æ¶ˆæ¯ç»™æ¥æ”¶è€…çš„é€šé“ï¼Œæµè§ˆå™¨ socket ç›‘å¬å¤„ç† sendMessage(toUserCtx, responseJson); &#125;&#125; æµ‹è¯• é€šè¿‡æ§åˆ¶å°è°ƒè¯•å¯ä»¥å–å¾— sentMessageMap ä¸­ä¿å­˜äº†ä¸ userId=2 çš„ç”¨æˆ·çš„èŠå¤©ä¿¡æ¯æ•°ç»„ã€‚ é€šè¿‡æ§åˆ¶å°è°ƒè¯•å¯ä»¥å–å¾— sentMessageMap ä¸­ä¿å­˜äº†ä¸ userId=1 çš„ç”¨æˆ·çš„èŠå¤©ä¿¡æ¯æ•°ç»„ã€‚ ç¾¤ç»„èŠå¤©ç¾¤ç»„èŠå¤©çš„æµç¨‹ä¸ç”¨æˆ·å•èŠæµç¨‹åŸºæœ¬ç›¸ä¼¼ï¼Œåªæ˜¯åœ¨ç»™æ¥æ”¶è€…çš„é€šé“å‘é€æ¶ˆæ¯æ—¶éœ€è¦é€šè¿‡ç¾¤ç»„ä¿¡æ¯å–å¾—ç¾¤ç»„é‡Œçš„æˆå‘˜çš„ä¿¡æ¯ï¼Œå¹¶è·å–æˆå‘˜çš„æ‰€æœ‰é€šé“è¿›è¡Œæ¶ˆæ¯çš„éå‘é€ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738@Overridepublic void groupSend(JSONObject param, ChannelHandlerContext ctx) &#123; String fromUserId = String.valueOf(param.get(\"fromUserId\")); String toGroupId = (String)param.get(\"toGroupId\"); String content = (String)param.get(\"content\"); Chatgroup chatgroup = groupDao.getByGroupId(toGroupId); if (chatgroup == null) &#123; String responseJson = new ResponseJson().error(\"è¯¥ç¾¤idä¸å­˜åœ¨\").toString(); sendMessage(ctx, responseJson); &#125; else &#123; List&lt;String&gt; groupUsersId = userChatRelationDao.getUsersIdByGroupId(toGroupId); List&lt;User&gt; groupUser = new ArrayList&lt;User&gt;(); for(String groupUserId : groupUsersId)&#123; groupUser.add(userDao.getByUserId(groupUserId)); &#125; GroupInfo groupInfo = new GroupInfo( chatgroup.getGroupId(), chatgroup.getGroupName(), chatgroup.getGroupAvatarUrl(), groupUser ); String responseJson = new ResponseJson().success() .setData(\"fromUserId\", fromUserId) .setData(\"content\", content) .setData(\"toGroupId\", toGroupId) .setData(\"type\", ChatType.GROUP_SENDING) .toString(); groupInfo.getMembers() .forEach(member -&gt; &#123; ChannelHandlerContext toCtx = Constant.onlineUserMap.get(String.valueOf(member.getUserId())); if (toCtx != null &amp;&amp; !String.valueOf(member.getUserId()).equals(fromUserId)) &#123; sendMessage(toCtx, responseJson); &#125; &#125;); &#125;&#125; æ¥æ”¶æ¶ˆæ¯è€…åˆ™æ ¹æ® groupId æ¥æ˜¾ç¤ºæ¥æ”¶åˆ°çš„æ¶ˆæ¯ã€‚ 1234567891011121314151617181920212223242526272829303132groupReceive: function(data) &#123; // è·å–ã€æ„é€ å‚æ•° console.log(data); var fromUserId = data.fromUserId; var content = data.content; var toGroupId = data.toGroupId; var fromAvatarUrl; var $receiveLi; $('.conLeft').find('span.hidden-userId').each(function()&#123; if (this.innerHTML == fromUserId) &#123; fromAvatarUrl = $(this).parent(\".liRight\") .siblings(\".liLeft\").children('img').attr(\"src\"); /* $receiveLi = $(this).parent(\".liRight\").parent(\"li\"); */ &#125; &#125;) $('.conLeft').find('span.hidden-groupId').each(function()&#123; // ç¾¤ç»„èŠå¤©æ¡† if (this.innerHTML == toGroupId) &#123; $receiveLi = $(this).parent(\".liRight\").parent(\"li\"); &#125; &#125;) var answer=''; answer += '&lt;li&gt;' + '&lt;div class=\"answers\"&gt;'+ content +'&lt;/div&gt;' + '&lt;div class=\"answerHead\"&gt;&lt;img src=\"' + fromAvatarUrl + '\"/&gt;&lt;/div&gt;' + '&lt;/li&gt;'; // æ¶ˆæ¯æ¡†å¤„ç† processMsgBox.receiveGroupMsg(answer, toGroupId); // å¥½å‹åˆ—è¡¨å¤„ç† processFriendList.receiving(content, $receiveLi);&#125;, å‘é€è¡¨æƒ…è¡¨æƒ…çš„å‘é€çš„åº•å±‚åŸç†å’Œå‘é€æ–‡å­—æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯å‘é€è¡¨æƒ…çš„è¯ï¼Œå‘é€å†…å®¹æ˜¯ä¸€ä¸²é™æ€èµ„æºçš„ URIã€‚ è¡¨æƒ…æ¨¡å—ç»‘å®šçš„ç›‘å¬äº‹ä»¶ï¼š 1234567$('.ExP').on('mouseenter',function()&#123; $('.emjon').show();&#125;)$('.emjon').on('mouseleave',function()&#123; $('.emjon').hide();&#125;) å‘é€æ–‡ä»¶æ–‡ä»¶çš„ä¸Šä¼ ä½¿ç”¨çš„æ˜¯ commons-fileupload å·¥å…·ç±»ã€‚ 123456&lt;!-- æ–‡ä»¶ä¸Šä¼  --&gt;&lt;dependency&gt; &lt;groupId&gt;commons-fileupload&lt;/groupId&gt; &lt;artifactId&gt;commons-fileupload&lt;/artifactId&gt; &lt;version&gt;1.3.3&lt;/version&gt;&lt;/dependency&gt; æ–‡ä»¶ä¸Šä¼ çš„æ¨¡æ€æ¡†è¡¨æ ¼ï¼š 123456789101112&lt;div class=\"modal-body\"&gt; &lt;form class=\"form-horizontal\"&gt; &lt;div class=\"form-group\"&gt; &lt;label class=\"col-sm-3 control-label\"&gt;é€‰æ‹©æ–‡ä»¶&lt;/label&gt; &lt;div class=\"col-sm-9\"&gt; &lt;input type=\"file\" name=\"file\" class=\"col-sm-9 myfile\" /&gt; &lt;p class=\"help-block\"&gt;æ³¨æ„ï¼šæ–‡ä»¶å¤§å°ä¸è¶…è¿‡30Mï¼Œæœ‰æ•ˆæœŸä¸º7å¤©&lt;/p&gt; &lt;/div&gt; &lt;/div&gt; &lt;/form&gt;&lt;/div&gt; Bootstrap çš„æ–‡ä»¶ä¸Šä¼ æ§ä»¶ bootstrap-fileinput çš„ä½¿ç”¨ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778$(\".myfile\").fileinput(&#123; uploadUrl:\"chatroom/upload\", uploadAsync : true, // é»˜è®¤å¼‚æ­¥ä¸Šä¼  showUpload : true, // æ˜¯å¦æ˜¾ç¤ºä¸Šä¼ æŒ‰é’® showRemove : false, // æ˜¾ç¤ºç§»é™¤æŒ‰é’® showCaption : false, // æ˜¯å¦æ˜¾ç¤ºæ ‡é¢˜ showPreview : true, // æ˜¯å¦æ˜¾ç¤ºé¢„è§ˆï¼Œé»˜è®¤ä¸º true dropZoneTitle: \"è¯·é€šè¿‡æ‹–æ‹½å›¾ç‰‡æ–‡ä»¶æ”¾åˆ°è¿™é‡Œ\", dropZoneEnabled : false, // æ˜¯å¦æ˜¾ç¤ºæ‹–æ‹½åŒºåŸŸï¼Œé»˜è®¤ä¸å†™ä¸º trueï¼Œä½†æ˜¯ä¼šå ç”¨å¾ˆå¤§åŒºåŸŸ maxFileSize: 30720, // å•ä½ä¸º kbï¼Œå¦‚æœä¸º 0 è¡¨ç¤ºä¸é™åˆ¶æ–‡ä»¶å¤§å° maxFileCount : 1, // è¡¨ç¤ºå…è®¸åŒæ—¶ä¸Šä¼ çš„æœ€å¤§æ–‡ä»¶ä¸ªæ•° enctype : 'multipart/form-data', validateInitialCount : true, previewFileIcon : \"&lt;i class='glyphicon glyphicon-file'&gt;&lt;/i&gt;\", msgFilesTooMany : \"é€‰æ‹©ä¸Šä¼ çš„æ–‡ä»¶æ•°é‡(&#123;n&#125;) è¶…è¿‡å…è®¸çš„æœ€å¤§æ•°å€¼&#123;m&#125;ï¼\", language : 'zh'&#125;)// å¼‚æ­¥ä¸Šä¼ è¿”å›æ–‡ä»¶ä¸Šä¼ é”™è¯¯ç»“æœå¤„ç†$('.myfile').on('fileerror', function(event, data, msg) &#123; console.log(\"fileerror\"); console.log(data);&#125;);// å¼‚æ­¥ä¸Šä¼ è¿”å›ç»“æœå¤„ç†$(\".myfile\").on(\"fileuploaded\", function(event, data, previewId, index) &#123; // 1. ä¸Šä¼ æˆåŠŸ1.5ç§’åè‡ªåŠ¨å…³é—­ä¸Šä¼ æ¨¡æ€æ¡† console.log(\"fileuploaded\"); setTimeout(function() &#123; $('#upload-cancel').trigger('click'); $('.fileinput-remove').trigger('click'); &#125;, 1500); // 2. è·å–ã€è®¾ç½®å‚æ•° var returnData = data.response.data; var originalFilename = returnData.originalFilename; var fileSize = returnData.fileSize; var fileUrl = returnData.fileUrl; var content = \"[æ–‡ä»¶]\"; var fromUserId = userId; var avatarUrl = $('#avatarUrl').attr(\"src\"); var $sendLi = $('.conLeft').find('li.bg'); var toUserId = $('#toUserId').val(); var toGroupId = $('#toGroupId').val(); // æ‹¼æ¥å‘é€è€…å¯¹è¯æ¡†çš„æ¶ˆæ¯ var fileHtml = '&lt;li&gt;'+ '&lt;div class=\"send-file-shown\"&gt;' + '&lt;div class=\"media\"&gt;' + '&lt;a href=\"' + fileUrl + '\" class=\"media-left\"&gt;' + '&lt;i class=\"glyphicon glyphicon-file\" style=\"font-size:28pt;\"&gt;&lt;/i&gt;' + '&lt;/a&gt;' + '&lt;div class=\"media-body\"&gt; ' + '&lt;h5 class=\"media-heading\"&gt;' + originalFilename + '&lt;/h5&gt;' + '&lt;span&gt;'+ fileSize + '&lt;/span&gt;' + '&lt;/div&gt;' + '&lt;/div&gt;'+ '&lt;/div&gt;' + '&lt;div class=\"nesHead\"&gt;&lt;img src=\"' + avatarUrl + '\"/&gt;&lt;/div&gt;' + '&lt;/li&gt;'; // 3. å‘é€ä¿¡æ¯åˆ°æœåŠ¡å™¨ if (toUserId.length != 0) &#123; ws.fileMsgSingleSend(fromUserId, toUserId, originalFilename, fileUrl, fileSize); &#125; else &#123; ws.fileMsgGroupSend(fromUserId, toGroupId, originalFilename, fileUrl, fileSize); &#125; // 4. æ¶ˆæ¯æ¡†å¤„ç†ï¼š processMsgBox.sendFileMsg(fileHtml, toUserId, toGroupId); // 5. å¥½å‹åˆ—è¡¨å¤„ç† processFriendList.sending(content, $sendLi);&#125;);//ä¸Šä¼ å‰$('.myfile').on('filepreupload', function(event, data, previewId, index) &#123; console.log(\"filepreupload\");&#125;); æ–‡ä»¶ä¸Šä¼ çš„æ§åˆ¶å™¨ï¼š 123456@RequestMapping(value = \"/upload\", method = POST)@ResponseBody public ResponseJson upload( @RequestParam(value = \"file\", required = true) MultipartFile file, HttpServletRequest request) &#123; return fileUploadService.upload(file, request);&#125; æ–‡ä»¶ä¸Šä¼ çš„ä¸šåŠ¡é€»è¾‘å¤„ç†ï¼š 123456789101112131415161718192021222324252627282930313233343536373839public class FileUploadServiceImpl implements FileUploadService &#123; // é¡¹ç›®çš„æ‰“åŒ…ç›®å½•ï¼Œæœ¬é¡¹ç›®æ‰“åŒ…åœ¨æ ¹ç›®å½•ä¸‹ private final static String SERVER_URL_PREFIX = \"http://localhost:8080/\"; // ä¿å­˜ä¸Šä¼ æ–‡ä»¶çš„æ–‡ä»¶å¤¹åç§° private final static String FILE_STORE_PATH = \"UploadFile\"; @Override public ResponseJson upload(MultipartFile file, HttpServletRequest request) &#123; // é‡å‘½åæ–‡ä»¶ï¼Œé˜²æ­¢é‡å String filename = getRandomUUID(); String suffix = \"\"; String originalFilename = file.getOriginalFilename(); String fileSize = FileUtils.getFormatSize(file.getSize()); // æˆªå–æ–‡ä»¶çš„åç¼€å if (originalFilename.contains(\".\")) &#123; suffix = originalFilename.substring(originalFilename.lastIndexOf(\".\")); &#125; filename = filename + suffix; // getRealPath(â€œ/â€) è·å–å®é™…è·¯å¾„,â€œ/â€æŒ‡ä»£é¡¹ç›®æ ¹ç›®å½•,æ‰€ä»¥ä»£ç è¿”å›çš„æ˜¯é¡¹ç›®åœ¨å®¹å™¨ä¸­çš„å®é™…å‘å¸ƒè¿è¡Œçš„æ ¹è·¯å¾„ String prefix = request.getSession().getServletContext().getRealPath(\"/\") + FILE_STORE_PATH; System.out.println(\"å­˜å‚¨è·¯å¾„ä¸º:\" + prefix + \"\\\\\" + filename); Path filePath = Paths.get(prefix, filename); try &#123; Files.copy(file.getInputStream(), filePath); &#125; catch (IOException e) &#123; e.printStackTrace(); return new ResponseJson().error(\"æ–‡ä»¶ä¸Šä¼ å‘ç”Ÿé”™è¯¯ï¼\"); &#125; return new ResponseJson().success() .setData(\"originalFilename\", originalFilename) .setData(\"fileSize\", fileSize) .setData(\"fileUrl\", SERVER_URL_PREFIX + FILE_STORE_PATH + \"\\\\\" + filename); &#125; private String getRandomUUID() &#123; return UUID.randomUUID().toString().replace(\"-\", \"\"); &#125;&#125; WebSoclet å¤„ç†æ–‡ä»¶å‘é€æ–¹æ³•ï¼š 123456789101112131415161718192021222324public void FileMsgSingleSend(JSONObject param, ChannelHandlerContext ctx) &#123; String fromUserId = String.valueOf(param.get(\"fromUserId\")); String toUserId = (String)param.get(\"toUserId\"); String originalFilename = (String)param.get(\"originalFilename\"); String fileSize = (String)param.get(\"fileSize\"); String fileUrl = (String)param.get(\"fileUrl\"); ChannelHandlerContext toUserCtx = Constant.onlineUserMap.get(toUserId); if (toUserCtx == null) &#123; String responseJson = new ResponseJson() .error(MessageFormat.format(\"userIdä¸º &#123;0&#125; çš„ç”¨æˆ·æ²¡æœ‰ç™»å½•ï¼\", toUserId)) .toString(); sendMessage(ctx, responseJson); &#125; else &#123; String responseJson = new ResponseJson().success() .setData(\"fromUserId\", fromUserId) .setData(\"originalFilename\", originalFilename) .setData(\"fileSize\", fileSize) .setData(\"fileUrl\", fileUrl) .setData(\"type\", ChatType.FILE_MSG_SINGLE_SENDING) .toString(); sendMessage(toUserCtx, responseJson); &#125;&#125;// ç¾¤å‘æ–‡ä»¶åˆ™ä¸ç¾¤ç»„èŠå¤©ç±»ä¼¼ï¼Œå–ç¾¤ç»„ä¸­çš„ç”¨æˆ·çš„é€šé“éå†å‘é€æ–‡ä»¶ä¿¡æ¯ æ¥æ”¶è€…å¯¹è¯æ¡†æ¥æ”¶æ–‡ä»¶æ¶ˆæ¯çš„æ‹¼æ¥ï¼š 1234567891011121314151617181920212223242526272829303132333435363738fileMsgSingleRecieve: function(data) &#123; // è·å–ã€æ„é€ å‚æ•° console.log(data); var fromUserId = data.fromUserId; var originalFilename = data.originalFilename; var fileSize = data.fileSize; var fileUrl = data.fileUrl; var content = \"[æ–‡ä»¶]\"; var fromAvatarUrl; var $receiveLi; $('.conLeft').find('span.hidden-userId').each(function()&#123; if (this.innerHTML == fromUserId) &#123; fromAvatarUrl = $(this).parent(\".liRight\") .siblings(\".liLeft\").children('img').attr(\"src\"); $receiveLi = $(this).parent(\".liRight\").parent(\"li\"); &#125; &#125;) var fileHtml = '&lt;li&gt;'+ '&lt;div class=\"receive-file-shown\"&gt;' + '&lt;div class=\"media\"&gt;' + '&lt;div class=\"media-body\"&gt; ' + '&lt;h5 class=\"media-heading\"&gt;' + originalFilename + '&lt;/h5&gt;' + '&lt;span&gt;'+ fileSize + '&lt;/span&gt;' + '&lt;/div&gt;' + '&lt;a href=\"' + fileUrl + '\" class=\"media-right\"&gt;' + '&lt;i class=\"glyphicon glyphicon-file\" style=\"font-size:28pt;\"&gt;&lt;/i&gt;' + '&lt;/a&gt;' + '&lt;/div&gt;'+ '&lt;/div&gt;' + '&lt;div class=\"answerHead\"&gt;&lt;img src=\"' + fromAvatarUrl + '\"/&gt;&lt;/div&gt;' + '&lt;/li&gt;'; // æ¶ˆæ¯æ¡†å¤„ç† processMsgBox.receiveSingleMsg(fileHtml, fromUserId); // å¥½å‹åˆ—è¡¨å¤„ç† processFriendList.receiving(content, $receiveLi);&#125;,","categories":[{"name":"Project","slug":"Project","permalink":"http://yoursite.com/categories/Project/"}],"tags":[{"name":"Chatroom","slug":"Chatroom","permalink":"http://yoursite.com/tags/Chatroom/"}]},{"title":"Chatroom Mybatis","slug":"Chatroom/Chatroom Mybatis","date":"2020-02-22T03:26:36.000Z","updated":"2020-04-19T06:24:14.533Z","comments":true,"path":"2020/02/22/Chatroom/Chatroom Mybatis/","link":"","permalink":"http://yoursite.com/2020/02/22/Chatroom/Chatroom%20Mybatis/","excerpt":"Mybatis çš„åˆæ­¥æ•´åˆä¸æµ‹è¯•","text":"Mybatis çš„åˆæ­¥æ•´åˆä¸æµ‹è¯• é¡¹ç›®ç›®å½• Modelï¼š po/User.java ç”¨æˆ·å®ä½“ Dao UserDao.java ç”¨æˆ·æ•°æ®è®¿é—®å¯¹è±¡ Service UserService.java ç”¨æˆ·ä¸šåŠ¡é€»è¾‘ UserServiceImpl.java Xml UserMapper.xml æŒä¹…å±‚ / å¯¹è±¡å…³ç³»æ˜ å°„æ–‡ä»¶ ApplicationContext-dao.xml ApplicationContext-service.xml MybatisConfig.xml pom.xml Properties jdbc.properties æ•°æ®åº“é…ç½®æ–‡ä»¶ é¡¹ç›®æ­å»ºpom.xml æ·»åŠ  Mybatis ç›¸å…³ä¾èµ–åŒ… 12345678910111213141516171819202122232425&lt;!-- MySQL --&gt;&lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;5.1.6&lt;/version&gt;&lt;/dependency&gt;&lt;!-- c3p0 è¿æ¥æ±  --&gt;&lt;dependency&gt; &lt;groupId&gt;c3p0&lt;/groupId&gt; &lt;artifactId&gt;c3p0&lt;/artifactId&gt; &lt;version&gt;0.9.1.2&lt;/version&gt;&lt;/dependency&gt;&lt;!-- Mybatis --&gt;&lt;dependency&gt; &lt;groupId&gt;org.mybatis&lt;/groupId&gt; &lt;artifactId&gt;mybatis&lt;/artifactId&gt; &lt;version&gt;3.2.2&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.mybatis&lt;/groupId&gt; &lt;artifactId&gt;mybatis-spring&lt;/artifactId&gt; &lt;version&gt;1.3.0&lt;/version&gt;&lt;/dependency&gt; æ•°æ®åº“çš„å»ºç«‹ 123456CREATE TABLE `user` ( `user_id` int(11) NOT NULL AUTO_INCREMENT, `user_name` varchar(64) DEFAULT NULL, `password` varchar(64) DEFAULT NULL, PRIMARY KEY (`user_id`)) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8 ç”¨æˆ·å®ä½“ç±» 123456789101112131415161718192021222324252627282930313233343536373839public class User &#123; private Long userId; private String userName; private String password; public Long getUserId() &#123; return userId; &#125; public void setUserId(Long userId) &#123; this.userId = userId; &#125; public String getUserName() &#123; return userName; &#125; public void setUserName(String userName) &#123; this.userName = userName; &#125; public String getPassword() &#123; return password; &#125; public void setPassword(String password) &#123; this.password = password; &#125; @Override public String toString() &#123; return \"User&#123;\" + \"userId='\" + userId + '/'' + \", username='\" + userName + '/'' + \", password='\" + password + '/'' + '&#125;'; &#125;&#125; æ•°æ®è®¿é—®ç±» 1234567public interface UserDao &#123; // ä¿å­˜ç”¨æˆ·ä¿¡æ¯ void saveUser(User user); // é€šè¿‡ id å–å¾—ç”¨æˆ·ä¿¡æ¯ User queryById(long user);&#125; å¯¹è±¡ / æŒä¹…å±‚æ˜ å°„æ–‡ä»¶ 1234567891011121314151617181920212223&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;!DOCTYPE mapper PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"&gt;&lt;mapper namespace=\"wingo.dao.UserDao\"&gt; &lt;insert id=\"saveUser\" parameterType=\"wingo.model.po.User\" useGeneratedKeys=\"true\" keyProperty=\"userId\"&gt; INSERT INTO user (user_name,password) VALUES (#&#123;userName&#125;,#&#123;password&#125;) &lt;/insert&gt; &lt;select id=\"queryById\" parameterType=\"long\" resultType=\"wingo.model.po.User\" &gt; &lt;!-- å…·ä½“çš„sql --&gt; SELECT user_id,user_name,password FROM user WHERE user_id = #&#123;userId&#125; &lt;/select&gt;&lt;/mapper&gt; ä¸šåŠ¡é€»è¾‘ç±» 12345public interface UserService &#123; void saveUser(User user); User queryById(long userId);&#125; ä¸šåŠ¡é€»è¾‘ç±»çš„å®ç° 123456789101112131415public class UserServiceImpl implements UserService &#123; private Logger logger= LoggerFactory.getLogger(this.getClass()); @Autowired private UserDao userDao; public void saveUser(User user) &#123; userDao.saveUser(user); &#125; public User queryById(long userId) &#123; return userDao.queryById(userId); &#125;&#125; æ•°æ®åº“ä¿¡æ¯é…ç½® jdbc.properties 1234jdbc.driver=com.mysql.jdbc.Driverjdbc.url=jdbc:mysql://127.0.0.1:3306/nettychatroom?useUnicode=true&amp;characterEncoding=utf8jdbc.username=rootjdbc.password= 123456 Mybatis é…ç½® 1234567891011121314151617181920&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;&lt;!DOCTYPE configuration PUBLIC \"-//mybatis.org//DTD Config 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-config.dtd\"&gt;&lt;configuration&gt; &lt;!-- é…ç½®å…¨å±€å±æ€§ --&gt; &lt;settings&gt; &lt;!-- ä½¿ç”¨jdbcçš„getGeneratedKeysè·å–æ•°æ®åº“è‡ªå¢ä¸»é”®å€¼ --&gt; &lt;setting name=\"useGeneratedKeys\" value=\"true\" /&gt; &lt;!-- ä½¿ç”¨åˆ—åˆ«åæ›¿æ¢åˆ—å é»˜è®¤:true --&gt; &lt;setting name=\"useColumnLabel\" value=\"true\" /&gt; &lt;!-- å¼€å¯é©¼å³°å‘½åè½¬æ¢:Table&#123;create_time&#125; -&gt; Entity&#123;createTime&#125; --&gt; &lt;setting name=\"mapUnderscoreToCamelCase\" value=\"true\" /&gt; &lt;!-- å¼€å¯æ§åˆ¶å°æ‰“å° SQL è¯­å¥ --&gt; &lt;setting name=\"logImpl\" value=\"STDOUT_LOGGING\" /&gt; &lt;/settings&gt;&lt;/configuration&gt; æ•°æ®è®¿é—®å±‚ä¸Šä¸‹æ–‡é…ç½® ApplicationContext-dao.xml 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;beans xmlns=\"http://www.springframework.org/schema/beans\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:context=\"http://www.springframework.org/schema/context\" xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd\"&gt; &lt;!-- é…ç½®æ•´åˆmybatisè¿‡ç¨‹ --&gt; &lt;!-- 1.é…ç½®æ•°æ®åº“ç›¸å…³å‚æ•°propertiesçš„å±æ€§ï¼š$&#123;url&#125; --&gt; &lt;context:property-placeholder location=\"classpath:jdbc.properties\" /&gt; &lt;!-- 2.æ•°æ®åº“è¿æ¥æ±  --&gt; &lt;bean id=\"dataSource\" class=\"com.mchange.v2.c3p0.ComboPooledDataSource\"&gt; &lt;!-- é…ç½®è¿æ¥æ± å±æ€§ --&gt; &lt;property name=\"driverClass\" value=\"$&#123;jdbc.driver&#125;\" /&gt; &lt;property name=\"jdbcUrl\" value=\"$&#123;jdbc.url&#125;\" /&gt; &lt;property name=\"user\" value=\"$&#123;jdbc.username&#125;\" /&gt; &lt;property name=\"password\" value=\"$&#123;jdbc.password&#125;\" /&gt; &lt;!-- c3p0è¿æ¥æ± çš„ç§æœ‰å±æ€§ --&gt; &lt;property name=\"maxPoolSize\" value=\"30\" /&gt; &lt;property name=\"minPoolSize\" value=\"10\" /&gt; &lt;!-- å…³é—­è¿æ¥åä¸è‡ªåŠ¨commit --&gt; &lt;property name=\"autoCommitOnClose\" value=\"false\" /&gt; &lt;!-- è·å–è¿æ¥è¶…æ—¶æ—¶é—´ --&gt; &lt;property name=\"checkoutTimeout\" value=\"10000\" /&gt; &lt;!-- å½“è·å–è¿æ¥å¤±è´¥é‡è¯•æ¬¡æ•° --&gt; &lt;property name=\"acquireRetryAttempts\" value=\"2\" /&gt; &lt;/bean&gt; &lt;!-- 3.é…ç½®SqlSessionFactoryå¯¹è±¡ --&gt; &lt;bean id=\"sqlSessionFactory\" class=\"org.mybatis.spring.SqlSessionFactoryBean\"&gt; &lt;!-- æ³¨å…¥æ•°æ®åº“è¿æ¥æ±  --&gt; &lt;property name=\"dataSource\" ref=\"dataSource\" /&gt; &lt;!-- é…ç½®MyBatieså…¨å±€é…ç½®æ–‡ä»¶:mybatis-config.xml --&gt; &lt;property name=\"configLocation\" value=\"classpath:MybatisConfig.xml\" /&gt; &lt;!-- æ‰«æentityåŒ…ï¼Œä½¿ç”¨åˆ«å --&gt; &lt;property name=\"typeAliasesPackage\" value=\"wingo.dao\" /&gt; &lt;!-- æ‰«æsqlé…ç½®æ–‡ä»¶:mapperéœ€è¦çš„xmlæ–‡ä»¶ --&gt; &lt;property name=\"mapperLocations\" value=\"classpath:mapper/*.xml\" /&gt; &lt;/bean&gt; &lt;!-- 4.é…ç½®æ‰«æDaoæ¥å£åŒ…ï¼ŒåŠ¨æ€å®ç°Daoæ¥å£ï¼Œæ³¨å…¥åˆ°springå®¹å™¨ä¸­ --&gt; &lt;bean class=\"org.mybatis.spring.mapper.MapperScannerConfigurer\"&gt; &lt;!-- æ³¨å…¥sqlSessionFactory --&gt; &lt;property name=\"sqlSessionFactoryBeanName\" value=\"sqlSessionFactory\" /&gt; &lt;!-- ç»™å‡ºéœ€è¦æ‰«æDaoæ¥å£åŒ… --&gt; &lt;property name=\"basePackage\" value=\"wingo.dao\" /&gt; &lt;/bean&gt;&lt;/beans&gt; ä¸šåŠ¡é€»è¾‘å±‚ä¸Šä¸‹æ–‡é…ç½® 12345678910111213141516171819202122&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;beans xmlns=\"http://www.springframework.org/schema/beans\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:context=\"http://www.springframework.org/schema/context\" xmlns:tx=\"http://www.springframework.org/schema/tx\" xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd\"&gt; &lt;!-- æ‰«æserviceåŒ…ä¸‹æ‰€æœ‰ä½¿ç”¨æ³¨è§£çš„ç±»å‹ --&gt; &lt;context:component-scan base-package=\"wingo.service\"/&gt; &lt;!-- é…ç½®äº‹åŠ¡ç®¡ç†å™¨ --&gt; &lt;bean id=\"transactionManager\" class=\"org.springframework.jdbc.datasource.DataSourceTransactionManager\"&gt; &lt;!-- æ³¨å…¥æ•°æ®åº“è¿æ¥æ±  --&gt; &lt;property name=\"dataSource\" ref=\"dataSource\" /&gt; &lt;/bean&gt; &lt;!-- é…ç½®åŸºäºæ³¨è§£çš„å£°æ˜å¼äº‹åŠ¡ --&gt; &lt;tx:annotation-driven/&gt;&lt;/beans&gt; Junit 4 æµ‹è¯•Junit 4 æ•´åˆå¼•å…¥ä¾èµ– 1234567&lt;!-- Junit --&gt;&lt;dependency&gt; &lt;groupId&gt;junit&lt;/groupId&gt; &lt;artifactId&gt;junit&lt;/artifactId&gt; &lt;version&gt;4.12&lt;/version&gt; &lt;!--&lt;scope&gt;test&lt;/scope&gt;--&gt;&lt;/dependency&gt; æµ‹è¯•åŸºç±» 123456789@RunWith(SpringJUnit4ClassRunner.class) //ä½¿ç”¨junit4è¿›è¡Œæµ‹è¯•@ContextConfiguration(locations=&#123; \"classpath:spring/ApplicationContext-dao.xml\", \"classpath:spring/ApplicationContext-service.xml\"&#125;) //åŠ è½½é…ç½®æ–‡ä»¶public class BaseJunit4Test &#123;&#125; æµ‹è¯•ç±» 12345678910111213141516171819202122public class UserTest extends BaseJunit4Test&#123; @Autowired private UserService userService; @Test @Transactional //æ ‡æ˜æ­¤æ–¹æ³•éœ€ä½¿ç”¨äº‹åŠ¡ @Rollback(false) //æ ‡æ˜ä½¿ç”¨å®Œæ­¤æ–¹æ³•åäº‹åŠ¡ä¸å›æ»š,trueæ—¶ä¸ºå›æ»š public void test()&#123; System.out.println(\"æµ‹è¯•Springæ•´åˆJunit4è¿›è¡Œå•å…ƒæµ‹è¯•\"); // User user = new User(); // user.setUserName(\"test1\"); // user.setPassword(\"111\"); // userService.saveUser(user); User user = userService.queryById(1); System.out.println(user.toString()); &#125;&#125; æµ‹è¯•ç»“æœ","categories":[{"name":"Project","slug":"Project","permalink":"http://yoursite.com/categories/Project/"}],"tags":[{"name":"Chatroom","slug":"Chatroom","permalink":"http://yoursite.com/tags/Chatroom/"},{"name":"Mybatis","slug":"Mybatis","permalink":"http://yoursite.com/tags/Mybatis/"}]},{"title":"Chatroom SpringMVC","slug":"Chatroom/Chatroom SpringMVC","date":"2020-02-22T01:46:26.000Z","updated":"2020-04-19T06:25:11.120Z","comments":true,"path":"2020/02/22/Chatroom/Chatroom SpringMVC/","link":"","permalink":"http://yoursite.com/2020/02/22/Chatroom/Chatroom%20SpringMVC/","excerpt":"Chatroom çš„ SpringMVC çš„æ•´åˆä¸æµ‹è¯•ã€‚","text":"Chatroom çš„ SpringMVC çš„æ•´åˆä¸æµ‹è¯•ã€‚ é¡¹ç›®ç»“æ„ Viewï¼š longin.html ç”¨æˆ·ç™»å½•é¡µé¢ chatroom.html èŠå¤©å®¤é¡µé¢ Controller UserController.java LoginController.java Xml ApplicationContext-mvc.xml web.xml pom.xml é¡¹ç›®æ­å»ºpom.xml æ·»åŠ  Spring å…¨å®¶æ¡¶ä¾èµ–ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465&lt;properties&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;&lt;/properties&gt;&lt;dependencies&gt; &lt;!-- Spring --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-core&lt;/artifactId&gt; &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-context&lt;/artifactId&gt; &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-web&lt;/artifactId&gt; &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt; &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-orm&lt;/artifactId&gt; &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-tx&lt;/artifactId&gt; &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-test&lt;/artifactId&gt; &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-jdbc&lt;/artifactId&gt; &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-expression&lt;/artifactId&gt; &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-aop&lt;/artifactId&gt; &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-context-support&lt;/artifactId&gt; &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; web.xml ä¸­å°†è¯·æ±‚äº¤ç»™ SpringMVC å¤„ç† 12345678910111213141516&lt;!-- å‰ç«¯æ§åˆ¶å™¨ --&gt;&lt;servlet&gt; &lt;servlet-name&gt;SpringMVC&lt;/servlet-name&gt; &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet &lt;/servlet-class&gt; &lt;init-param&gt; &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt; &lt;param-value&gt;classpath:spring/ApplicationContext-mvc.xml&lt;/param-value&gt; &lt;/init-param&gt; &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;&lt;/servlet&gt;&lt;servlet-mapping&gt; &lt;servlet-name&gt;SpringMVC&lt;/servlet-name&gt; &lt;url-pattern&gt;/&lt;/url-pattern&gt;&lt;/servlet-mapping&gt; å¯¹ SpringMVC è¿›è¡Œé…ç½® 12345678910111213141516171819202122232425262728293031323334&lt;!-- MVC è´Ÿè´£æ‰«æ Controller --&gt;&lt;context:component-scan base-package=\"wingo.web.controller\"/&gt;&lt;!-- å¯åŠ¨ Spring MVC çš„æ³¨è§£åŠŸèƒ½ï¼Œå®Œæˆè¯·æ±‚å’Œæ³¨è§£POJOçš„æ˜ å°„,è§£å†³ @ResponseBody ä¹±ç é—®é¢˜ --&gt;&lt;!-- éœ€è¦åœ¨ annotation-driven ä¹‹å‰,å¦åˆ™ä¹±ç é—®é¢˜åŒæ ·æ— æ³•è§£å†³ --&gt;&lt;bean class=\"org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter\"&gt; &lt;property name=\"messageConverters\"&gt; &lt;list&gt; &lt;bean class=\"org.springframework.http.converter.StringHttpMessageConverter\"&gt; &lt;property name=\"supportedMediaTypes\"&gt; &lt;list&gt; &lt;value&gt;text/html;charset=UTF-8&lt;/value&gt; &lt;/list&gt; &lt;/property&gt; &lt;/bean&gt; &lt;/list&gt; &lt;/property&gt;&lt;/bean&gt;&lt;!-- å¼€å¯ MVC çš„æ³¨è§£å¼é…ç½® --&gt;&lt;mvc:annotation-driven/&gt;&lt;!-- è§†å›¾è§£é‡Šç±» --&gt;&lt;bean name=\"viewResolver\" class=\"org.springframework.web.servlet.view.InternalResourceViewResolver\"&gt; &lt;property name=\"prefix\" value=\"/WEB-INF/views/\" /&gt; &lt;property name=\"suffix\" value=\".html\" /&gt; &lt;property name=\"order\" value=\"0\" /&gt;&lt;/bean&gt;&lt;!-- è®¾ç½®ä¸æ‹¦æˆªé™æ€æ–‡ä»¶ --&gt;&lt;mvc:resources location=\"/WEB-INF/views/\" mapping=\"/WEB-INF/views/**\" /&gt;&lt;mvc:resources location=\"/static/\" mapping=\"/static/**/**\" /&gt;&lt;mvc:resources location=\"/UploadFile/\" mapping=\"/UploadFile/**\" /&gt; ç¼–å†™æ§åˆ¶å™¨æ–¹æ³• 12345678@Controllerpublic class UserController &#123; // è·³è½¬åˆ°ç™»é™†é¡µé¢ @RequestMapping(value = &#123;\"login\", \"/\"&#125;, method = RequestMethod.GET) public String toLogin() &#123; return \"login\"; &#125;&#125; 1234567public class ChatroomController &#123; // ç™»å½•æˆåŠŸåçš„è·³è½¬é¡µé¢ @RequestMapping(method = RequestMethod.GET) public String toChatroom() &#123; return \"chatroom\"; &#125;&#125; é¡¹ç›®æµ‹è¯•æ§åˆ¶å°è¾“å‡º @RequestMapping(value = {&quot;login&quot;, &quot;/&quot;}, method = RequestMethod.GET) æ•´åˆ SwaggerSwagger æ˜¯ä¸€æ¬¾ RESTFUL æ¥å£çš„æ–‡æ¡£åœ¨çº¿è‡ªåŠ¨ç”Ÿæˆ + åŠŸèƒ½æµ‹è¯•åŠŸèƒ½è½¯ä»¶ã€‚ @Api ï¼šä¿®é¥°æ•´ä¸ªç±»ï¼Œæè¿°Controllerçš„ä½œç”¨ï¼›@ApiOperation ï¼šæè¿°ä¸€ä¸ªç±»çš„ä¸€ä¸ªæ–¹æ³•ï¼Œæˆ–è€…è¯´ä¸€ä¸ªæ¥å£ï¼›@ApiParam ï¼šå•ä¸ªå‚æ•°æè¿°ï¼›ç”¨åœ¨æ–¹æ³•å‚æ•°ä¸Š@ApiModel ï¼šç”¨å¯¹è±¡æ¥æ¥æ”¶å‚æ•°ï¼›@ApiProperty ï¼šç”¨å¯¹è±¡æ¥æ”¶å‚æ•°æ—¶ï¼Œæè¿°å¯¹è±¡çš„ä¸€ä¸ªå­—æ®µï¼›@ApiResponse ï¼šHTTPå“åº”å…¶ä¸­1ä¸ªæè¿°ï¼›@ApiResponses ï¼šHTTPå“åº”æ•´ä½“æè¿°ï¼›@ApiIgnore ï¼šä½¿ç”¨è¯¥æ³¨è§£å¿½ç•¥è¿™ä¸ªAPIï¼›@ApiError ï¼šå‘ç”Ÿé”™è¯¯è¿”å›çš„ä¿¡æ¯ï¼›@ApiImplicitParam ï¼šä¸€ä¸ªè¯·æ±‚å‚æ•°ï¼šç”¨åœ¨æ–¹æ³•ä¸Š ã€‚@ApiImplicitParams ï¼šå¤šä¸ªè¯·æ±‚å‚æ•°ï¼šç”¨åœ¨æ–¹æ³•ä¸Šã€‚ å¼•å…¥ä¾èµ–åŒ… 123456789101112131415161718192021222324252627282930313233&lt;!-- Swagger å¯å¸®åŠ©å¼€å‘äººå‘˜è®¾è®¡ï¼Œæ„å»ºï¼Œè®°å½•å’Œä½¿ç”¨ RESTful Web æœåŠ¡ --&gt;&lt;dependency&gt; &lt;groupId&gt;io.springfox&lt;/groupId&gt; &lt;artifactId&gt;springfox-swagger-ui&lt;/artifactId&gt; &lt;version&gt;2.9.2&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;io.springfox&lt;/groupId&gt; &lt;artifactId&gt;springfox-swagger2&lt;/artifactId&gt; &lt;version&gt;2.9.2&lt;/version&gt;&lt;/dependency&gt;&lt;!-- Jackson åŒ…ï¼Œé…åˆ Spring @ResponseBody æ³¨è§£ï¼Œä»¥åŠ Json å·¥å…·åŒ… --&gt;&lt;dependency&gt; &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt; &lt;artifactId&gt;jackson-core&lt;/artifactId&gt; &lt;version&gt;2.9.0&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt; &lt;artifactId&gt;jackson-annotations&lt;/artifactId&gt; &lt;version&gt;2.9.0&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt; &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt; &lt;version&gt;2.9.0&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;fastjson&lt;/artifactId&gt; &lt;version&gt;1.2.6&lt;/version&gt;&lt;/dependency&gt; é…ç½® Swagger 1234567891011121314151617181920212223@EnableSwagger2 //ä½¿ Swagger2 ç”Ÿæ•ˆ@ComponentScan(basePackages = &#123;\"wingo.web.controller\"&#125;) //éœ€è¦æ‰«æçš„controlleråŒ…è·¯å¾„@Configurable //é…ç½®æ³¨è§£ï¼Œè‡ªåŠ¨åœ¨æœ¬ç±»ä¸Šä¸‹æ–‡åŠ è½½ä¸€äº›ç¯å¢ƒå˜é‡ä¿¡æ¯public class SwaggerConfig extends WebMvcConfigurationSupport &#123; //RestApiConfig @Bean public Docket buildDocket()&#123; return new Docket(DocumentationType.SWAGGER_2) .apiInfo(buildApiInf()) .select() .apis(RequestHandlerSelectors.basePackage(\"wingo.web.controller\"))//controllerè·¯å¾„ .paths(PathSelectors.any()) .build(); &#125; private ApiInfo buildApiInf()&#123; return new ApiInfoBuilder() .title(\"Wingo's Swagger\") .description(\"Web Restful æµ‹è¯•\") .build(); &#125;&#125; Spring åŠ è½½ SwaggerConfig 123456&lt;!-- åŠ è½½ SwaggerConfig --&gt;&lt;bean class=\"springfox.documentation.swagger2.configuration.Swagger2DocumentationConfiguration\" id=\"swagger2Config\"/&gt;&lt;!-- ä¸æ‹¦æˆªæ‰€éœ€é™æ€æ–‡ä»¶ --&gt;&lt;mvc:resources mapping=\"swagger-ui.html\" location=\"classpath:/META-INF/resources/\"/&gt;&lt;mvc:resources mapping=\"/webjars/**\" location=\"classpath:/META-INF/resources/webjars/\"/&gt; åœ¨éœ€è¦æ ‡æ³¨çš„æ§åˆ¶å™¨ç±»æ–¹æ³•ä¸Šæ·»åŠ æ³¨è§£ 123456789101112131415161718192021@Controller@RequestMapping(value=\"/swagger\")public class TestSwaggerController &#123; @ApiOperation(value = \"æµ‹è¯•ä¸“ç”¨\", notes = \"è¿”å›ä¸€ä¸ª JSON å­—ç¬¦ä¸²\") @RequestMapping(value=\"/test\",method= RequestMethod.GET) @ResponseBody public String test()&#123; ObjectMapper mapper = new ObjectMapper(); User user = new User(); user.setUserId((long) 1); user.setUserName(\"ä¸­æ–‡æµ‹è¯•\"); user.setPassword(\"111\"); String str = null; try &#123; str = mapper.writeValueAsString(user); &#125; catch (JsonProcessingException e) &#123; e.printStackTrace(); &#125; return str; &#125;&#125; è®¿é—®ï¼š[é¡¹ç›®æ ¹ç›®å½•]/swagger-ui.html ç‚¹å‡» Try it out è¿›è¡Œè¯·æ±‚çš„å‘é€ã€‚ æˆåŠŸè¯·æ±‚å¹¶çš„åˆ°å“åº”ã€‚","categories":[{"name":"Project","slug":"Project","permalink":"http://yoursite.com/categories/Project/"}],"tags":[{"name":"Chatroom","slug":"Chatroom","permalink":"http://yoursite.com/tags/Chatroom/"},{"name":"Spring MVC","slug":"Spring-MVC","permalink":"http://yoursite.com/tags/Spring-MVC/"}]},{"title":"Java åŸºç¡€çŸ¥è¯†å›é¡¾","slug":"Welab/Java åŸºç¡€çŸ¥è¯†å›é¡¾","date":"2020-02-19T13:17:04.000Z","updated":"2020-03-02T06:55:23.277Z","comments":true,"path":"2020/02/19/Welab/Java åŸºç¡€çŸ¥è¯†å›é¡¾/","link":"","permalink":"http://yoursite.com/2020/02/19/Welab/Java%20%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E5%9B%9E%E9%A1%BE/","excerpt":"","text":"å…¥é—¨åŸºç¡€Block123456789public class Block &#123; // å—ï¼ˆblockï¼‰å¼€å§‹ public static void main(String[] args) &#123; // å—ï¼ˆblockï¼‰æ˜¯æŒ‡æ‹¬åœ¨ä¸€å¯¹ &#123;&#125; é‡Œçš„éƒ¨åˆ†ï¼Œå…³é”®å­—ä¹‹é—´çš„å¤šä¸ªç©ºæ ¼â€œ â€œè§†ä½œä¸€ä¸ª System.out.println(\"Block Example!\"); // ä¸€æ¡å‘½ä»¤ä»¥åˆ†å·ç»“æŸ &#125; // å—ï¼ˆblockï¼‰ç»“æŸ &#125; æ³¨é‡Š1234567891011121314151617/** * @Title: Annotate.java * @Description: [Javaè¯­è¨€çš„åŸºæœ¬è¯­æ³• - æ³¨é‡Š] è¿™é‡Œæ˜¯ javadoc æ³¨é‡Šï¼Œç”Ÿæˆ API æ–‡æ¡£æ—¶ä½¿ç”¨ï¼Œæ³¨é‡Šåœ¨ç¼–è¯‘æ—¶ä¼šè¢«å¿½ç•¥ * * @author Wingo */public class Annotate &#123; /* * è¿™é‡Œæ˜¯å¤šè¡Œæ³¨é‡Š */ public static void main(String[] args) &#123; System.out.println(\"Annotate Example!\"); // è¿™é‡Œæ˜¯å•è¡Œæ³¨é‡Š &#125; &#125; æ ‡è¯†ç¬¦Java é‡Œçš„æ ‡è¯†ç¬¦åªèƒ½æ˜¯å¤§/å°å†™å­—æ¯ã€æ•°å­—ã€ç¾å…ƒç¬¦å·ã€ä¸‹åˆ’çº¿åŠä¸Šè¿°ç»„åˆï¼Œä¸”ä¸èƒ½ä»¥æ•°å­—å¼€å¤´ï¼Œä¸èƒ½ä¸º Java å…³é”®å­—ï¼Œæœ€å¤§é•¿åº¦ä¸º 65534 ä¸ªå­—ç¬¦ã€‚ å˜é‡ä¸å¸¸é‡Java ä¸­ç±»åä»¥å¤§å†™å­—æ¯å¼€å¤´ï¼Œå˜é‡å’Œæ–¹æ³•åä»¥å°å†™å­—æ¯å¼€å¤´ï¼Œä¸€èˆ¬é‡‡ç”¨é©¼å³°å‘½åçš„è§„åˆ™ã€‚è™½ç„¶ä¸æ˜¯å¼ºåˆ¶è¦æ±‚ï¼Œä½†æ˜¯å¼ºçƒˆå»ºè®®éµå®ˆè§„èŒƒã€‚ 12int number = 1; // è¿™é‡Œ number æ˜¯å˜é‡ï¼Œ1 æ˜¯å¸¸é‡ï¼Œæ­¤è¯­å¥å°†å¸¸é‡ 1 èµ‹å€¼ç»™å˜é‡ numberboolean tureOrFalse = ture // è¿™é‡Œ trueOrFalse æ˜¯å˜é‡ï¼Œture æ˜¯å¸¸é‡ æ•°æ®ç±»å‹Java é‡Œçš„æ•°æ®ç±»å‹åˆ†ä¸ºåŸºæœ¬æ•°æ®ç±»å‹ï¼ˆPrimitive Typeï¼‰å’Œå¯¹è±¡æ•°æ®ç±»å‹ï¼ˆObject Typeï¼‰ã€‚ åŸºæœ¬æ•°æ®ç±»å‹ åŸºæœ¬æ•°æ®ç±»å‹åˆ†ä¸ºï¼š é€»è¾‘å‹ï¼ˆLogicalï¼Œä¹Ÿç§°ä¸ºå¸ƒå°”å‹ï¼Œ1 ä¸ªå­—èŠ‚ï¼‰ï¼›ğŸ‘‰ true / false å­—ç¬¦å‹ï¼ˆTextualï¼‰ï¼› ğŸ‘‰ Java ä½¿ç”¨å­—ç¬¦å‹ï¼ˆcharï¼‰å­˜å‚¨å•ä¸ªå­—ç¬¦ï¼Œå 2ä¸ªå­—èŠ‚å†…å­˜ã€‚ä½¿ç”¨ Unicode å­—ç¬¦é›†å¤„ç†æ–‡å­—ï¼ŒUnicode ä½¿ç”¨ 2 ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼Œå‡ ä¹å¯ä»¥å¤„ç†æ‰€æœ‰å›½å®¶çš„è¯­è¨€æ–‡å­—ã€‚ æ³¨æ„ï¼šJava ä¸­ï¼Œå­—ç¬¦å‹å±äºåŸºæœ¬æ•°æ®ç±»å‹ï¼Œè€Œå­—ç¬¦ä¸²æ˜¯å¯¹è±¡æ•°æ®ç±»å‹ã€‚å› æ­¤ï¼Œåƒ char a = â€œAâ€; æ˜¯é”™è¯¯çš„ï¼Œå› ä¸º â€œAâ€ ä¸æ˜¯å­—ç¬¦ç±»å‹ï¼Œè€Œæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼ˆString ç±»å‹ï¼‰ï¼Œchar a = â€˜Aâ€™; æ‰æ˜¯æ­£ç¡®çš„èµ‹å€¼å½¢å¼ã€‚ æ•´å‹ï¼ˆIntegralï¼‰ï¼›ğŸ‘‰ long å‹ L / l ä¸èƒ½çœ byte short int long 1 å­—èŠ‚ 2 å­—èŠ‚ 4 å­—èŠ‚ 8 å­—èŠ‚ -128ï½127 å®æ•°ç±»å‹ï¼ˆFloatingï¼Œä¹Ÿç§°ä¸ºæµ®ç‚¹æ•°ï¼‰ã€‚ğŸ‘‰ float å‹ f ä¸èƒ½çœ float double 4 å­—èŠ‚ 8 å­—èŠ‚ è¿›åˆ¶çš„è¡¨ç¤º1234// ä¸åŒè¿›åˆ¶çš„è¡¨ç¤ºå½¢å¼int num1 = 12; // åè¿›åˆ¶ï¼ˆ0ã€1ã€2ã€3ã€4ã€5ã€6ã€7ã€8ã€9ï¼Œé€¢åè¿›ä¸€ä½ï¼‰int num2 = 012; // å…«è¿›åˆ¶ï¼ˆ0ã€1ã€2ã€3ã€4ã€5ã€6ã€7ï¼Œé€¢å…«è¿›ä¸€ä½ï¼‰int num3 = 0x12 // åå…­è¿›åˆ¶ï¼ˆ0ã€1ã€2ã€3ã€4ã€5ã€6ã€7ã€8ã€9ã€Aã€Bã€Cã€Dã€Eã€Fã€Gï¼Œé€¢åå…­è¿›ä¸€ä½ï¼‰ è¿›åˆ¶çš„è½¬æ¢ æ•°å€¼ æ“ä½œ num = 5; n = 2; str = â€œâ€; 5 Ã· 2 = 2â€¦..1 è¿›å…¥é€’å½’ num = 2; n = 2; str = â€œ?1â€; å±‚æ¬¡ä¸€ 2 Ã· 2 = 1â€¦â€¦0 è¿›å…¥é€’å½’ num = 1 ; n = 2; str = â€œ?0â€; å±‚æ¬¡äºŒ num &lt; n è§¦å‘é€’å½’ç»ˆæ­¢è¿”å› num å¯¹åº”å­—ç¬¦ str = â€œ1â€; å±‚æ¬¡ä¸‰ï¼Œå³ ? = 1; è¿”å›ç¬¬äºŒå±‚ str = â€œ10â€; è¿”å›ç¬¬ç¬¬ä¸€å±‚ str = â€œ101â€; return â€œ101â€; 12345678910111213141516171819202122232425// è¿›åˆ¶çš„è½¬æ¢ API: Integer.toBinaryString();public class ConvertTo &#123; // åˆå§‹åŒ–ç”¨äºæ‹¼æ¥çš„å­—ç¬¦ private static char[] a = &#123;'0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'A', 'B', 'C', 'D', 'E', 'F'&#125;; public static void main(String[] args) &#123; int number = 20; System.out.println(number + \" è½¬äºŒè¿›åˆ¶: \" + toNumber(number, 2)); System.out.println(number + \" è½¬å…«è¿›åˆ¶: \" + toNumber(number, 8)); System.out.println(number + \" è½¬åå…­è¿›åˆ¶: \" + toNumber(number, 16)); &#125; public static String toNumber(int number, int n) &#123; String str = \"\"; for (int i = 0; i &lt; n; i++) &#123; // å•† &lt; è¿›åˆ¶æ•°ç›´æ¥å–å•† if (number == i) &#123; // ç”¨å¯¹åº”çš„å­—ç¬¦è¿›è¡Œæ‹¼æ¥ str = a[i] + str; return str; &#125; &#125; str = a[number % n] + str; // å•† &gt;= è¿›åˆ¶æ•°çš„å–ä½™æ•° str = toNumber(number / n, n) + str; // ä¼ é€’å•†è¿›è¡Œé€’å½’çš„ return str; &#125;&#125; å¯¹è±¡æ•°æ®ç±»å‹String å¯¹è±¡ä¸åŸºæœ¬æ•°æ®ç±»å‹çš„æ•°æ®å¯ä»¥è¿›è¡Œ â€+â€ è¿ç®—ï¼Œå…¶ç»“æœå€¼ä¸ºä¸€ä¸ª String å‹çš„å¯¹è±¡ï¼Œå³â€å­—ç¬¦ä¸²+æ•´æ•°ï¼ˆå®æ•°ï¼‰=å­—ç¬¦ä¸²â€ã€‚ ç±»å‹çš„è½¬æ¢è‡ªåŠ¨ç±»å‹è½¬æ¢ä»ä½ä½ç±»å‹åˆ°é«˜ä½ç±»å‹è‡ªåŠ¨è½¬æ¢ã€‚ float å‹æ˜¯æ¯” long å‹æ›´å¤§çš„æ•°æ®ç±»å‹ï¼Œlong å‹æ•°æ®å ç”¨ 8 ä¸ªå­—èŠ‚çš„å†…å­˜ç©ºé—´ï¼Œfloat å‹æ•°æ®ä»…å ç”¨ 4 ä¸ªå­—èŠ‚çš„å†…å­˜ç©ºé—´ã€‚ä½†æ˜¯ï¼Œç”±äº long å‹æ— æ³•å±•ç¤ºå°æ•°ï¼ˆfloat å‹å˜é‡åˆ™å¯ä»¥ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å°† float å‹çœ‹ä½œæ˜¯æ¯” long å‹æ›´å¤§çš„æ•°æ®ç±»å‹ã€‚ å˜é‡ å˜é‡ ç»“æœ å˜é‡ å˜é‡ ç»“æœ byte byte int byte short int byte int int short int int int int int int long long long long long byte float float int float float long float float double float double double double double 12byte a = 7;byte b = -a; // -c è¿ç®—åçš„ç»“æœæ˜¯æ•´å‹ï¼Œå†èµ‹å€¼ç»™ byte ï¼ˆå­—èŠ‚å‹ï¼‰å˜é‡ï¼Œæ˜¾ç„¶æ˜¯é”™è¯¯çš„ å¼ºåˆ¶ç±»å‹è½¬æ¢(é«˜ä½ç±»å‹) ä½ä½ç±»å‹ ç¼–å†™ç¨‹åºæ˜¯è¦æ—¶åˆ»ç•™å¿ƒæ•°æ®ç±»å‹çš„è½¬æ¢ï¼Œæœºå™¨çš„æ‰§è¡Œè·Ÿäººçš„æ€ç»´ä¹ æƒ¯æŸäº›æ—¶å€™å­˜åœ¨å·®å¼‚ã€‚ è¿ç®—ç¬¦è¿ç®—ç¬¦ä¼˜å…ˆçº§ï¼ˆç”±é«˜åˆ°ä½ï¼‰ï¼š () ğŸ‘‰ å•ç›®è¿ç®—ç¬¦ï¼ˆ!ã€~ã€+ã€-ã€++ã€â€“ï¼‰ğŸ‘‰ ç®—æœ¯è¿ç®—ç¬¦ï¼ˆ+ã€-ã€*ã€/ã€%ï¼‰ğŸ‘‰ ä½ç§»è¿ç®—ç¬¦ï¼ˆ&lt;&gt;ã€&gt;&gt;&gt;ï¼‰ğŸ‘‰ å…³ç³»å…ƒç®—ç¬¦ï¼ˆ&gt;ã€=ã€&lt;=ã€==ã€!=ï¼‰ğŸ‘‰ é€»è¾‘å…ƒç®—ç¬¦ï¼ˆ&amp;&amp;ã€||ã€&amp;ã€|ã€^ï¼‰ğŸ‘‰ ä¸‰ç›®è¿ç®—ç¬¦ï¼ˆb?x:y;ï¼‰ğŸ‘‰ èµ‹å€¼è¿ç®—ç¬¦ï¼ˆ=ã€+=ã€-=ã€*=ã€/=ã€%=ã€&amp;=ã€|=ã€^=ã€&lt;&lt;=ã€&gt;&gt;=ã€&gt;&gt;&gt;=ï¼‰ã€‚ é€»è¾‘éè¿ç®—ç¬¦ ! æ˜¯è¡¨ç¤ºé€»è¾‘éçš„å•ç›®è¿ç®—ç¬¦ï¼Œå®ƒæŠŠçœŸï¼ˆtrueï¼‰å˜ä¸ºå‡ï¼ˆfalseï¼‰ï¼ŒæŠŠå‡ï¼ˆfalseï¼‰å˜ä¸ºçœŸï¼ˆtrueï¼‰ã€‚ ä½éè¿ç®—ç¬¦ ï½ æ˜¯è¡¨ç¤ºä½éçš„å•ç›®è¿ç®—ç¬¦ï¼Œå®ƒçš„è¿ç®—è§„åˆ™æ˜¯ï¼šé€¢ 1 å˜ 0ï¼Œé€¢ 0 å˜ 1ã€‚ ç¬¦å·è¿ç®—ç¬¦ +ã€- åˆ†åˆ«ç”¨äºè¡¨ç¤ºæ­£æ•°å’Œè´Ÿæ•°ã€‚ å¢å‡è¿ç®—ç¬¦ ++ã€â€“ æ˜¯ä½¿å˜é‡å€¼å¢ 1 æˆ–å‡ 1 çš„å•ç›®è¿ç®—ç¬¦ã€‚ ++a; å‰ç½®é€’å¢è¿ç®—ç¬¦ï¼Œå…ˆè¿ç®—åèµ‹å€¼ã€‚ a++; åç½®é€’å¢è¿ç®—ç¬¦ï¼Œå…ˆèµ‹å€¼åè¿ç®—ã€‚ å¿«é€Ÿé€»è¾‘ä¸ï¼ˆ&amp;&amp;ï¼‰ã€å¿«é€Ÿé€»è¾‘æˆ–ï¼ˆ||ï¼‰ç§°ä¸ºçŸ­è·¯è¿ç®—ç¬¦ A&amp;&amp;Bï¼šè‹¥ A ä¸º falseï¼Œåˆ™æ•´ä¸ªè¡¨è¾¾å¼å³ä¸ºå‡ï¼Œæ­¤æ—¶ B å°†ä¸ä¼šå‚ä¸è¿ç®—ï¼Œå› æ­¤å°†å‡ºç° false æ¦‚ç‡æœ€é«˜çš„è¡¨è¾¾å¼æ”¾åˆ°å‰é¢æ˜¯æ¨èçš„åšæ³•ï¼›A||Bï¼šè‹¥ A ä¸º trueï¼Œåˆ™æ•´ä¸ªè¡¨è¾¾å¼ä¸ºçœŸï¼Œæ­¤æ—¶ B å°†ä¸ä¼šå‚ä¸è¿ç®—ï¼Œå› æ­¤å°†å‡ºç° true æ¦‚ç‡æœ€é«˜çš„è¡¨è¾¾å¼æ”¾åˆ°å‰é¢æ˜¯æ¨èçš„åšæ³•ã€‚ &amp;ï¼šä½œä½ä¸è¿ç®— |ï¼šä½œä½æˆ–è¿ç®— ^ï¼šä½œä½å¼‚æˆ–è¿ç®— ä¸‰ç›®è¿ç®—ç¬¦æ ¼å¼ï¼šæ¡ä»¶å¼ ? å€¼1 : å€¼2; å¦‚æœæ¡ä»¶è¡¨è¾¾å¼ä¸ºçœŸï¼Œåˆ™è¡¨è¾¾å¼çš„å€¼å–å€¼ 1ï¼Œå¦åˆ™å–å€¼ 2ã€‚ a += 1; ğŸ‘‰ a = a + 1; a-=1; ğŸ‘‰ a = a-1; å¯¹è±¡è¿ç®—ç¬¦ instanceof ç»“æœå€¼ä¸º boolean å‹ï¼ŒA instanceof Bï¼šå¦‚æœ A æ˜¯ B çš„å¯¹è±¡ï¼Œåˆ™è¿”å› trueï¼Œå¦åˆ™ï¼Œè¿”å› falseã€‚ æµç¨‹æ§åˆ¶è¯­å¥æ¡ä»¶è¯­å¥ï¼ˆifã€switchï¼‰é’ˆå¯¹æŸç§æ¡ä»¶è¿›è¡ŒæŸç§å¤„ç† å¾ªç¯è¯­å¥ï¼ˆforã€whileã€do-whileï¼‰é‡å¤æ‰§è¡ŒæŸä¸€æ®µä»£ç  å¼‚å¸¸å¤„ç†è¯­å¥ï¼ˆtry-catch-finallyï¼‰å¤„ç†ç¨‹åºå‘ç”Ÿçš„å¼‚å¸¸ If è¯­å¥æ³¨æ„ï¼šå¤šåˆ†æ”¯ if è¯­å¥ï¼Œæ°¸è¿œåªæ‰§è¡Œå…¶ä¸­ä¸€æ¡æˆ–ä¸€æ¡ä¹Ÿä¸æ‰§è¡Œã€‚å»ºè®®æŠŠè§¦å‘æ¡ä»¶æ¦‚ç‡è¾ƒé«˜çš„æ¡ä»¶æ”¾åˆ°æ›´å‰é¢æ‰§è¡Œã€‚ Java ä¸­ else if è¯­å¥ä¸­é—´æ˜¯éš”å¼€çš„ï¼Œä½†æ˜¯åœ¨ JavaScript è„šæœ¬è¯­è¨€ä¸­ï¼Œ elseif æ˜¯è¿åœ¨ä¸€èµ·çš„ï¼Œè¿™ç‚¹éœ€è¦ç•™æ„ä¸€ä¸‹. 12345678910111213141516171819202122// å½¢å¼ä¸€ ifif() &#123; //&#125;// å½¢å¼äºŒ if_elseif() &#123; //&#125; else() &#123; //&#125;// å½¢å¼ä¸‰ if_else if_elseif() &#123; //&#125; if else() &#123; //&#125; if else() &#123; //&#125; else() &#123; //&#125; switch è¯­å¥switch è¯­å¥ä¹Ÿæ˜¯ä¸€ç§æ¡ä»¶è¯­å¥ï¼Œè¡¨è¾¾å¼çš„ç»“æœå¿…é¡»æ˜¯æ•´å‹æ•°å­—ï¼ˆbyte/Byteã€short/Shortã€int/Integerï¼‰ã€å­—ç¬¦ï¼ˆchar/Characterï¼Œæœ¬è´¨ä¸Šä¹Ÿæ˜¯æ•°å­—ï¼Œå­—æ¯æˆ–ä¸­æ–‡éƒ½æ˜¯å¯ä»¥çš„ï¼‰ã€æšä¸¾ï¼ˆEnumï¼‰ç­‰å½¢å¼ï¼ŒJDK1.7 ä¹‹åæ”¯æŒ String ç±»å‹ã€‚ break è¯­å¥åœ¨ switch è¯­å¥ä¸­ï¼Œç”¨äºç»ˆæ­¢ä¸€ç§æƒ…å½¢ï¼›åœ¨å¾ªç¯è¯­å¥ä¸­ï¼Œç”¨äºå¼ºåˆ¶é€€å‡ºå¾ªç¯ã€‚continue è¯­å¥ä¸ºè·³å‡ºæœ¬æ¬¡å¾ªç¯ï¼Œç»§ç»­æ‰§è¡Œä¸‹ä¸€æ¬¡å¾ªç¯ï¼Œæ³¨æ„ break ä¸ continue çš„å·®å¼‚ã€‚ 12345678910111213141516171819202122switch(expression) &#123; case value_one: // è‹¥ expresion == value_one ğŸ‘‰ do_oneã€do_twoã€...ã€do_default do_one; case vlaue_two: // è‹¥ expresion == value_two ğŸ‘‰ do_twoã€...ã€do_default do_two; // ... dafault: do_default; // è‹¥ expression æ²¡æœ‰åŒ¹é…çš„ value ğŸ‘‰ do_default&#125;// æ·»åŠ åŠ  break è¯­å¥å¼ºåˆ¶é€€å‡ºå¾ªç¯switch(expression) &#123; case value_one: // è‹¥ expresion == value_one ğŸ‘‰ do_one do_one; break; case vlaue_two: // è‹¥ expresion == value_two ğŸ‘‰ do_two do_two; break; // ... dafault: do_default; // è‹¥ expression æ²¡æœ‰åŒ¹é…çš„ value ğŸ‘‰ do_default&#125; for è¯­å¥for è¯­å¥æ˜¯ä¸€ç§å¾ªç¯è¯­å¥ï¼Œå®ƒåœ¨æŸç§æ¡ä»¶æ»¡è¶³æ—¶ï¼Œåå¤æ‰§è¡ŒæŸäº›è¯­å¥ã€‚for å¾ªç¯è¯­å¥å¯ä»¥åµŒå¥—ï¼ŒåµŒå¥—åå°±æ˜¯å¤šé‡å¾ªç¯è¯­å¥ã€‚ for è¯­å¥ä¸­ï¼Œè‹¥æ¡ä»¶è¡¨è¾¾å¼å§‹ç»ˆä¸ºçœŸï¼Œåˆ™ä¼šå‡ºç°æ­»å¾ªç¯çš„æƒ…å†µã€‚ç¼–ç¨‹æ—¶ï¼Œä¸€å®šè¦è€ƒè™‘å‘¨å…¨ï¼Œé˜²æ­¢ç¨‹åºé™·å…¥æ­»å¾ªç¯ä¸­ã€‚ 123456789public class ForBrief &#123; public static void main(String[] args) &#123; int a = 1; for (; a &lt;= 5;) &#123; // åªæœ‰åˆ¤æ–­æ¡ä»¶ System.out.print(a + \" \"); a++; &#125; &#125;&#125; 12345678910111213141516171819202122232425262728293031323334// å¤šä¸ªè¡¨è¾¾å¼for (int a = 1, b = 1; (a + b) &lt;= 10; a++, b++) &#123; System.out.print((a + b) + \" \");&#125;// break è¯­å¥for (int i = 1; true; i++) &#123; if (i == 6) &#123; break; // è‹¥ i ä¸º 6ï¼Œåˆ™é€€å‡º for å¾ªç¯ &#125; System.out.print(i + \" \");&#125;// continue è¯­å¥for (int i = 1; i &lt;= 10; i++) &#123; if (i &lt;= 5) continue; // è·³è¿‡æ­¤æ¬¡å¾ªç¯è¿›è¡Œä¸‹ä¸€æ¬¡å¾ªç¯ System.out.print(i + \" \");&#125;// å¤šé‡å¾ªç¯for (int a = 1; a &lt;= 2; a++) &#123; for (int b = 1; b &lt;= 3; b++) &#123; System.out.println(\"a=\" + a + \" b=\" + b); &#125;&#125;// æ ‡ç­¾çš„ä½¿ç”¨outer: for (int a = 1; a &lt;= 3; a++) &#123; for (int b = 1; b &lt;= 2; b++) &#123; if (a &lt;= 2) &#123; continue outer; &#125; System.out.println(a + \" \" + b); &#125; System.out.println(\"æ‚¨å¥½ \" + a);&#125; while è¯­å¥ç±»ä¼¼ for å¾ªç¯è¯­å¥ï¼Œwhile ä¹Ÿæ˜¯å¾ªç¯è¯­å¥ï¼Œä¹Ÿå¯ä»¥è¿›è¡ŒåµŒå¥—ã€‚ 123456789101112131415// ä¹ä¹ä¹˜æ³•è¡¨public class While &#123; public static void main(String[] args) &#123; int a = 1, b; while (a &lt;= 9) &#123; b = 1; while (b &lt;= a) &#123; System.out.print(b + \"*\" + a + \"=\" + a * b + \" \"); b++; &#125; a++; System.out.println(); &#125; &#125;&#125; do-while è¯­å¥do-while è¯­å¥åŒ while è¯­å¥ä½œç”¨ç±»ä¼¼ï¼Œä½†æ˜¯å®ƒé¦–å…ˆæ‰§è¡Œç„¶åå†åˆ¤æ–­æ¡ä»¶è¡¨è¾¾å¼ï¼Œä¸ while å¾ªç¯è¯­å¥çš„ä¸åŒä¹‹å¤„æ˜¯ do-while å¾ªç¯è¯­å¥è‡³å°‘è¢«æ‰§è¡Œä¸€æ¬¡ã€‚ 123456789public class DoWhile &#123; public static void main(String[] args) &#123; int a = 1; do &#123; System.out.print(a + \" \"); a++; &#125; while (a &lt;= 3); &#125;&#125; ç±»ä¸å¯¹è±¡","categories":[{"name":"Java","slug":"Java","permalink":"http://yoursite.com/categories/Java/"}],"tags":[{"name":"Base","slug":"Base","permalink":"http://yoursite.com/tags/Base/"}]},{"title":"Friends S01","slug":"English/Friends/Friends S01","date":"2020-02-19T03:46:03.000Z","updated":"2020-04-19T06:26:00.372Z","comments":true,"path":"2020/02/19/English/Friends/Friends S01/","link":"","permalink":"http://yoursite.com/2020/02/19/English/Friends/Friends%20S01/","excerpt":"","text":"Episode 01 ~ 05Episode 01 Come on, Youâ€™re going out with the guy! ğŸ‘‰ go out with &lt;ä¿š&gt; çº¦ä¼š So does he have a hump? A hump and a hairpiece? ğŸ‘‰ hump n. é©¼èƒŒ hairpiece / false hair / wig n. å‡å‘ Wait, does he eat chalk? ğŸ‘‰ chalk n. ç²‰ç¬” All of a sudden adv. çªç„¶ä¹‹é—´åœ° I just feel like someone reached down my throat, grabbed my small intestine, pulled it out of my mouth and tied it around my neck. ğŸ‘‰ intestine n. è‚  Stop cleansing my aura! ğŸ‘‰ aura: a distinctive atmosphere surrounding a given source n. æ°”æ°› çµæ°” å…‰ç¯ ğŸ‘‰ distinctive adj. æœ‰ç‰¹è‰²çš„ ä¸ä¼—ä¸åŒçš„ To hell with her, she left me! ğŸ‘‰ to hell with &lt;å£&gt; è®©â€¦è§é¬¼å»ï¼Œå»(å¥¹)è¯¥æ­»çš„ Why does everyone keep fixating on that? ğŸ‘‰ fixate on: to focus oneâ€™s gaze or attention on sth å…³æ³¨æŸäº‹ I realized that I was more turned on by this gravy boat than by Barry! ğŸ‘‰ turn on &lt;ä¿š&gt; if someone or something turns you on, that means they make you interested or excited sexually ğŸ‘‰ freak out &lt;ä¿š&gt; means you suddenly behave in a very strange and uncontrolled way | drift apart: lose person contact over time v. ç–è¿œ ğŸ‘‰ hit &lt;å£&gt; ä½¿â€¦æƒ³èµ· [It hit me all of a sudden that I had forgotten her birthday] gravy boat pipe organ ç®¡é£ç´ lizard What if I wanna be a purseâ€¦ Itâ€™s a metaphor. ğŸ‘‰ metaphor / analogy n. éšå–» ç±»æ¯” Well, I guess weâ€™ve established whoâ€™s staying here with Monica. ğŸ‘‰ establish v. ç¡®å®š å»ºç«‹ Okay, look, this is probably for the best, you know? ğŸ‘‰ be for the best æå…¶å£è¯­åŒ–çš„è¡¨è¾¾æ³•ï¼Œè¡¨ç¤ºæŸä»¶äº‹æƒ…å¯èƒ½å¹¶ä¸åƒçœ‹ä¸Šå»é‚£ä¹ˆç³Ÿï¼Œä¹Ÿé¢‡æœ‰ç‚¹è‰¯è¯è™½è‹¦ï¼Œå…¶åˆ©äºç—…çš„æ„æ€ Stop hitting on her! Itâ€™s her wedding day! ğŸ‘‰ hit on &lt;ä¿š&gt; to pay unsolicited ä¸»åŠ¨æä¾›çš„ and usually unwanted ä¸å¿…è¦çš„ sexual attention to someone ğŸ‘‰ = flirt v. è°ƒæƒ… with someone / to make a pass at someone / to come on to someone Buzz him in ğŸ‘‰ make a signal using the buzzer to let him in Ooh, this is a Dear Diary moment! ğŸ‘‰ a Dear Diary moment å€¼å¾—çºªå¿µçš„æ—¶åˆ» Ooh, I just pulled out four eyelashes. That canâ€™t be good. ğŸ‘‰ eyelashes n. ç«æ¯› Well, I was kinda supposed to be headed for Aruba on my honeymoon, so nothing! ğŸ‘‰ be headed for v. å‰å¾€ I think Iâ€™m just gonna hang out here tonight. ğŸ‘‰ hang out here å‘†åœ¨è¿™å„¿ï¼ˆèŠå®¶å¸¸ï¼‰ Iâ€™m supposed to attach a bracket-y thing to the side things, using a bunch of these little worm guys. I have no bracket-y thing, I see no whom guys whatsoever and I cannot feel my legs. ğŸ‘‰ squat v. è¹²å bracket n. æ”¯æ¶ ğŸ‘‰ bracket-y: means an L-shaped support projecting çªå‡ºçš„ from a wall (as to hold a shelf) ğŸ‘‰ whatsoever = whatever è¯­æ°”æ¯” whatever å¼º ğŸ‘‰ worm guys æŒ‡ä»£èºä¸é’‰ï¼Œå› ä¸ºèºä¸é’‰ä¸Šçš„çº¹è·¯ä¸ worm å¾ˆç›¸ä¼¼ worm worm guy bracket-y stereo sock You got screwed. ğŸ‘‰ got screwed &lt;ä¿š&gt; to cheat or deceive æ¬ºè¯ˆ someone I should have caught onâ€¦ ğŸ‘‰ catch on: Understand clearly / comprehend v. ç†è§£ He is such a mess ğŸ‘‰ mess &lt;ä¿š&gt; informal terms éæ­£å¼ç”¨è¯­ for a difficult situation I went for the watch ğŸ‘‰ went for v. æ”»å‡» å°½åŠ›æƒ³æ±‚å¾— I said the other day about you making love with your socks on ğŸ‘‰ the other day adv. å‰å‡ å¤© Machine cut me off again ğŸ‘‰ cut off = disconnect = terminate = shut off Thereâ€™s Rocky Road, and Cookie Dough, and Bing! Cherry Vanilla. You could get them with Jimmies, or nuts, or whipped cream! I honestly donâ€™t know if Iâ€™m hungry or horny. ğŸ‘‰ horny &lt;ä¿š&gt; feeling great sexual desire Ever since she walked out on me. ğŸ‘‰ walk out on = abandon = run out on é—å¼ƒ æŠ›å¼ƒ I know being spit on is probably not what you need right now. ğŸ‘‰ being spit on è¢«äººå”¾å¼ƒ Iâ€™m glad you smashed her watch. ğŸ‘‰ smash v. æ‰“ç¢ æ’å‡» n. æ’è½¦ æ‰£çƒ ååˆ†èµ°çº¢çš„æ­Œæ›² While youâ€™re on a roll, if you feel like you gotta make like a western omelet or somethingâ€¦ ğŸ‘‰ on a roll &lt;ä¿š&gt; undergoing or experiencing sustained, even increasing good fortune or success omelet I will not take this abuse. ğŸ‘‰ take abuse: recoil ç•ç¼© as to someone elseâ€™s language offense You look like you slept with a hanger in your mouth. ğŸ‘‰ hanger è¡£æ¶ I take credit for Paul. You know before me, there was no snap in his turtle for two years. ğŸ‘‰ take credit for &lt;ä¿š&gt; if A takes credit for B, that means B is indebted æ„Ÿæ¿€çš„ to A ğŸ‘‰ snap in his turtle &lt;ä¿š&gt; sexual performance ğŸ‘‰ unable to have an erection / turtle &lt;ä¿š&gt; a vulgar åº¸ä¿—çš„ expression to refer to maleâ€™s genitalia ç”Ÿæ®–å™¨ Of course it was a line! ğŸ‘‰ line &lt;ä¿š&gt; glib æ²¹è…”æ»‘è°ƒçš„ or insincere ä¸çœŸè¯šçš„ talk, usually intended to deceive or impress I assume weâ€™re looking for an answer more sophisticated than â€˜to get you into bedâ€™. ğŸ‘‰ sophisticated adj. æˆç†Ÿç¨³é‡çš„ Is it like I have some sort of beacon that only dogs and men with severe emotional problems can hear? ğŸ‘‰ beacon n. ç¯å¡” ä¿¡æ ‡(ç”µ)å° Iâ€™m trained for nothing! I was laughed out of twelve interviews today. And yet youâ€™re surprisingly upbeat. ğŸ‘‰ and yet adv. å¯æ˜¯ upbeat adj. = cheerful optimistic You canâ€™t live off your parents your whole life. ğŸ‘‰ live off v. é â€¦ç”Ÿæ´» I ended up living with this albino guy who was like cleaning windshields outside port authority, and then he killed himself, and then I found aromatherapy. ğŸ‘‰ port authority æ¸¯åŠ¡å±€ albino n. ç™½åŒ–ç—…è€… end up &lt;å£&gt; means finally be or do something You gonna crash on the couch? ğŸ‘‰ crash &lt;ä¿š&gt; to temporarily stay over or sleep at a place other than at oneâ€™s own usual abode ä½å¤„ I had aâ€¦major crush on you. ğŸ‘‰ If you are a crush on someone, you are in love with them but do not have a relationship with them. I always figured you just thought I was Monicaâ€™s geeky older brother. ğŸ‘‰ geeky &lt;ä¿š&gt; ä¹¦å‘†å­æ°”çš„ ä»¤äººè®¨åŒçš„ Try not to let my intense vulnerability become any kind of a factor here. ğŸ‘‰ vulnerability n. æ˜“å—è´£éš¾ å¼±ç‚¹ intense vulnerability n. å¼ºçƒˆçš„è„†å¼±æ„Ÿ Episode 02 I mean itâ€™s like the stand-up comedian you have to sit through before Pink Floyd comes out. ğŸ‘‰ sit through è€ç€æ€§å­çœ‹ / å¬å®Œ stand-up comedy å•å£ç›¸å£° stand-up comedian ~æ¼”å‘˜ Yeah, well, word of advice. ğŸ‘‰ word of advice å»ºè®®å¦‚ä¸‹ glacier mastodon thighmaster Martyâ€™s still totally paranoid. ğŸ‘‰ paranoid adj. ç±»ä¼¼å¦„æƒ³ç‹‚çš„ Are you through with that? ğŸ‘‰ to have finished using or doing something See, I wrote a note to myself, and then I realised I didnâ€™t need it, so I balled it up. ğŸ‘‰ ball it up æ‰æˆçº¸å›¢ Sheâ€™s already fluffed that pillow. ğŸ‘‰ fluff vi. æŠ–æ¾ pillow n. æ•å¤´ I just donâ€™t wanna give them any more ammunition than they already have. ğŸ‘‰ ammunition n. &lt;å–»&gt; â€œç‚®å¼¹â€ï¼ˆæŒ‡æŠ¨å‡»åˆ«äººçš„ææ–™ æ‰‹æ®µæˆ–ä¾æ®ç­‰ï¼‰ I mean, youâ€™re like all chaotic and twirly. ğŸ‘‰ chaotic adj. æ··ä¹±çš„ æ— ç§©åºçš„ twirl v. æ—‹è½¬ æ»å¼„ Thatâ€™s because as far as my parents are concernedâ€¦ ğŸ‘‰ as far asâ€¦be concerned å°±â€¦è€Œè¨€ couch cushion lasagna sonogram Oh, like I wasnâ€™t dreading tomorrow enough having to give it back to him. â€˜Hi Barry! Remember me? Iâ€™m the girl in the veil who stomped on your heart in front of your entire family!â€™ ğŸ‘‰ dreading v. ææƒ§ æ‹…å¿ƒ ğŸ‘‰ the girl in the veil ç©¿ç€å©šçº±çš„å¥³å­© stomp on your heart ä¼¤é€äº†ä½ çš„å¿ƒ Kinda puts that whole pillow thing in perspective. ğŸ‘‰ in perspective adv. æ­£ç¡®åœ° ğŸ‘‰ kinda åœ¨ç‰‡ä¸­å‡ºç°çš„æ¬¡æ•°éå¸¸é¢‘ç¹ï¼Œä¹Ÿæ˜¯å£è¯­ä¸­éå¸¸å®ç”¨çš„è¯è¯­ï¼Œæ„æ€æ˜¯æœ‰ä¸€ç‚¹å„¿ï¼Œç›¸å½“äº kind of Well now, how do you fit into this whole thing? ğŸ‘‰ fit into v. é€‚åº” åè°ƒ I mean presumably, the biggest part of your job is done. ğŸ‘‰ presumably adv. æ¨æµ‹èµ·æ¥ å¤§æ¦‚ from scratch ç™½æ‰‹èµ·å®¶ ä»é›¶å¼€å§‹ The big one had a thing for you, didnâ€™t she? ğŸ‘‰ have a thing for v. å¯¹â€¦ç‰¹åˆ«æ„Ÿå…´è¶£ We ran into her parents at the club, they were not playing very well. ğŸ‘‰ run into v. å¶é‡ altar chubby harmonica Whatâ€™s that supposed to mean? â€œWhat does that mean?â€ might be simple not understanding the sentence.but if there is focus on the word â€œthatâ€ eg. what does THAT mean? it is asking what the intention / meaning is while taking offence ç”Ÿæ°”. â€œwhat is that supposed to mean?â€ is for when someone reads into more of the message beyond the literal words, usually with offence. Look, there are people like Ross who need to shoot for the stars. ğŸ‘‰ â€œShoot for the starsâ€œ means to set high goals for yourself No news, no little anecdotes to share with the folks? ğŸ‘‰ anecdote n. è½¶äº‹ å…«å¦ the folks n. çˆ¶æ¯ Well, yâ€™know, these people are pros. They know what theyâ€™re doing, they take their time, they get the job done. ğŸ‘‰ pro = professional n. ä¸“å®¶ take oneâ€™s time ä»å®¹ä¸è¿« Well, you may wanna steer clear of the word â€˜dumpedâ€™. Chances are heâ€™s gonna be this broken shell of a man, yâ€™know, so you should try not to look too terrific, I know itâ€™ll be hard. ğŸ‘‰ steer clear of é¿å¼€ ç»•å¼€ ğŸ‘‰ shell n. å£³ terrific adj. å…‰å½©ç…§äºº Chances areâ€¦ (å¾ˆæœ‰)å¯èƒ½â€¦ ğŸ‘‰ â€œBroken shell of a manâ€œ means that his spirit was broken and he only looks like a man now. He is empty of what makes someone a man. Got me. ğŸ‘‰ It can be as you are playing a game, whether physical or a board game, and your opponent gets a score, going against something you did perhaps. It can also mean you do not know when a person asks you a question. Sorry Iâ€™m late, I got stuck at work. ğŸ‘‰ informal unable to escape from a bad or boring situation How could I forget? ğŸ‘‰ å’¬ç‰™åˆ‡é½¿ Things change, roll with the punches. I believe Juliaâ€™s on the table? ğŸ‘‰ roll with the punches ğŸ‘‰ to be able to deal with a series of difficult situations ğŸ‘‰ on the table adv. åœ¨æ¡Œé¢ä¸Š åœ¨è®¨è®ºçš„èŒƒå›´ tanned maid of honour = bridemaid Youâ€™ve got plugs! And youâ€™ve got lenses! ğŸ‘‰ got plugs æ¤å‘ lens n. éšå½¢çœ¼é•œ = contact lens Iâ€™m an orthodontist. ğŸ‘‰ orthodontist n. æ­£ç‰™åŒ»ç”Ÿ I donâ€™t remember you making any sperm. Yeah, and we all know what a challenge that is! ğŸ‘‰ sperm n. ç²¾æ¶² ç²¾å­ she gets a credit. ğŸ‘‰ get a credit v. å¾—åˆ°åŠŸåŠ³ Cause I think that borders on child abuse. ğŸ‘‰ border on ä¸â€¦â€¦æ¥å£¤ He knows no-oneâ€™s gonna say all those names, so theyâ€™ll wind up calling her Geller, then he gets his way! ğŸ‘‰ wind up doing = end up doing æœ€ç»ˆâ€¦ get his way ä»–å°±å¾—é€ éšå¿ƒæ‰€æ¬² How are we today? Any nausea? I was just wondering about the mother-to-be ğŸ‘‰ nausea n. æ¶å¿ƒ What are we supposed to be seeing here? Are you welling up? ğŸ‘‰ well up çƒ­æ³ªç›ˆçœ¶ yâ€™know, if everything works out, and you guys end up getting married and having kids - and everything - I just hope they have his old hairline and your old nose. ğŸ‘‰ works out ğŸ‘‰ be capable of being solved. / have a good or specified result. Okay, I know it was a cheap shot, but I feel so much better now. ğŸ‘‰ a cheap shot è´±æ‹› Episode 03 He walked me to the subway. ğŸ‘‰ walk sb to sw é€æŸäººå»å“ªé‡Œ Cushions the blow. ğŸ‘‰ &lt;ä¿š&gt; to do something that reduces harm å–„æ„çš„è°è¨€ So how does it feel knowing youâ€™re about to die? ğŸ‘‰ be about to do å°†è¦ Try taking a puff. ğŸ‘‰ åå£çƒŸ Itâ€™s the same as the distance from the tip of a guyâ€™s thumb to the tip of his index finger. ğŸ‘‰ index finger é£ŸæŒ‡ Iâ€™m going through my mail, and I open up their monthly, you know, STATEMENT. ğŸ‘‰ go through ä»”ç»†æ£€æŸ¥ monthly statement æ¯æœˆå£°æ˜ Weâ€™re with you. We got it. ğŸ‘‰ æˆ‘ä»¬æ‡‚ä½  I mean, I bring a guy home, and within five minutes theyâ€™re all over him. ğŸ‘‰ 1ï¼‰ä¸å–œæ¬¢ å…¨èº«æŒ‘æ¯›ç—… ğŸ‘‰ 2ï¼‰éå¸¸ç€è¿· Iâ€™m all over you. = I have a crush on you. æˆ‘å°ä½ éå¸¸åœ°è‘—è¿· ğŸ‘‰ Iâ€™m over you. æˆ‘è·Ÿä½ ä¹‹é–“å®Œäº† Thank you for calling attention to our error. ğŸ‘‰ æ„Ÿè°¢ä½ æå‡ºæˆ‘ä»¬çš„é”™è¯¯ We have credited your account with five hundred dollars. ğŸ‘‰ å¾€ä½ è´¦æˆ·é‡Œå­˜äº†500å…ƒ The way his smile was kinda crooked. ğŸ‘‰ ä»–ç¬‘èµ·æ¥æœ‰ç‚¹é‚ªé‚ªçš„ From the nursery rhyme. ğŸ‘‰ nursery rhyme å„¿æ­Œ ç«¥è°£ So I think Alan will become the yardstick against which all future boyfriends will be measured. ğŸ‘‰ yardstick å‡†ç»³ saltine tin foil hat pretzel coyote I opened it up and there it was, just floating in there, like this tiny little hitch-hiker! ğŸ‘‰ hitch-hiker æ­ä¾¿è½¦çš„æ—…è¡Œè€… Heâ€™ll get over it. ğŸ‘‰ get over ç†¬è¿‡ I have had it with you guys and your cancer and your emphysema and your heart disease. The bottom line is, smoking is cool, and you know it. ğŸ‘‰ hava hsd å—å¤Ÿäº† emphysema è‚ºæ°”è‚¿ the bottom line is æœ€é‡è¦çš„æ˜¯ I have one now and then ğŸ‘‰ å¶å°” Pop-Tart Iâ€™m getting a deja vu. ğŸ‘‰ deja vu ä¼¼æ›¾ç›¸è¯†çš„æ„Ÿè§‰ å¹»è§‰è®°å¿† Episode 04 If I were omnipotent for a day. ğŸ‘‰ omnipotent å…¨èƒ½çš„ æ— æ‰€ä¸èƒ½çš„ You just nodded off again. ğŸ‘‰ nod off æ‰“ç›¹ æ‰“çŒç¡ My grandmother has this new boyfriend, and theyâ€™re both kind of insecure in bed. Oh, and deaf. So theyâ€™re constantly, like, having to reassure each other that theyâ€™re having a good time. ğŸ‘‰ insecure å±€ä¿ƒä¸å®‰çš„ æ— æŠŠæ¡çš„ reassure ä½¿â€¦æ¢å¤ä¿¡å¿ƒ æ‰“æ¶ˆâ€¦çš„ç–‘è™‘ You got way too much free time. ğŸ‘‰ way too å¤ªè¿‡äºâ€¦ You are way too young to see that. Todayâ€™s the day Carol and I first .. consummated our physical relationship. Sex. ..You know what, Iâ€™d better pass on the game. ğŸ‘‰ consummate åœ†æˆ¿ å®Œå©š pass on ä¸å» You can totally, totally live on this. ğŸ‘‰ live on é â€¦ç”Ÿæ´» apron peache nectarine Twister puck I know. I know! Iâ€™m a duplex. ğŸ‘‰ duplex &lt;ç¾&gt; åŒå±‚æ¥¼å…¬å¯“ åŒèƒèƒ weâ€™re on the subject of news. ğŸ‘‰on the subject of è°ˆåˆ°â€¦æ—¶ æ¶‰åŠâ€¦æ—¶ ğŸ‘‰ While we are on the subject of money, may I ask when you will repay the loan? Tell me all the dirt! ğŸ‘‰ dirt å…«å¦ ä¸‘é—» Letâ€™s talk reality for a second. weâ€™d have kinda like a slumber party thing. We got some trashy magazines, we got cookie dough, we got Twister â€¦ ğŸ‘‰ slumber party å¥³å­©å­çš„ç¡è¡£æ´¾å¯¹ cookie dough æ›²å¥‡é¥¼ Could you please tell me what this is in reference to? ğŸ‘‰ in reference to å…³äº floopy &lt;ä¿š&gt; ğŸ‘‰ confused, in a state of inner turmoil. if soemone feels floopy, nothing is going right and they canâ€™t make sense of their life or the things that are happening to them. Look, I donâ€™t wanna make any trouble, okay, but Iâ€™m in a lot of pain here, alright? My face is dented. ğŸ‘‰ å‡¹é™· Was he wearing a stunning blue suit? ğŸ‘‰ stunning æå¥½çš„ stun stun æ‰“æ™• å‡»æ™• I remember the moonlight coming through the window and her face had the most incredible glow. ğŸ‘‰ glow è„¸çº¢ å‘çƒ« Could I get some painkillers over here? ğŸ‘‰ painkiller æ­¢ç—›è¯ I think thereâ€™s a man on the twelfth floor in a coma who didnâ€™t quite hear you â€¦ ğŸ‘‰ in a coma æ˜è¿· Finders keepers, losers weepers. ğŸ‘‰ weep å“­æ³£ No rough holding in my ER! ğŸ‘‰ rough holding ç²—æš´çš„è¡Œä¸º ER emergency room Episode 05 Thereâ€™s one little maneuver, and bam, a bra right out the sleeve. ğŸ‘‰ maneuver ç­–ç•¥ è°‹ç•¥ èŠ±æ‹› Ok, you know what blows my mind? Women can see breasts any time they want. You just look down and there they are. How you get any work done is beyond me. ğŸ‘‰ blow oneâ€™s mind ä½¿æŸäººæ„Ÿåˆ°å…´å¥‹ be beyond sb æŸä»¶äº‹ä½¿æŸäººéš¾ä»¥ç†è§£ Multiple orgasms! ğŸ‘‰ å¤šæ¬¡é«˜æ½® Oh, thanks, but I think sheâ€™d feel like weâ€™re ganging up on her. ğŸ‘‰ gang up on sb è”åˆåå¯¹ hunger strike ç»é£ŸæŠ—è®® sophisticated æˆç†Ÿçš„ audition è¯•é•œ Whatâ€™s the matter? Why so scrunchy? ğŸ‘‰ scrunch ç¼©ç´§ æ‰çš± scrunchy &lt;ä¿š&gt; æ„çœ‰è‹¦è„¸çš„ Did he give you that whole â€œYouâ€™re-not-up-to-thisâ€ thing again? ğŸ‘‰ be up to èƒœä»» Thatâ€™s because Iâ€™m wearing a dress that accents my boobs. ğŸ‘‰ accent å¼ºè°ƒ ç€é‡ Oh, big glamour night. ğŸ‘‰ glamour é­…åŠ› è¯±æƒ‘åŠ› The moonlight cast a glamour over the scene. Not after your cousin who could belch the alphabet. ğŸ‘‰ belch the alphabet æ‰“å—å—å‡ºå­—æ¯ æŒ‡æ— èŠçš„äºº lay kitchen tile ğŸ‘‰ é“ºå¨æˆ¿ç“·ç – Are you sure youâ€™ve thought this thing through? ğŸ‘‰ think through æƒ³æ¸…æ¥š fuzzy bear espresso moose squirrel You can mix and match, moose and squirrel. Whatever you want. ğŸ‘‰ mix and match æ··æ­ detergent Oh, like youâ€™ve never gotten a little rambunctious with Ross. ğŸ‘‰ rambunctious ç²—æš´çš„ å–§é—¹çš„ If we put our heads together, between the two of us, we can break them up. ğŸ‘‰ put our head together å…±åŒæƒ³åŠæ³• What a neat idea! ğŸ‘‰ neat &lt;ç¾å£&gt; ç¾å¦™çš„ å¾ˆæ£’çš„ Oh, he needed some time to grieve. ğŸ‘‰ grieve æ‚²ç—› å¿§ä¼¤ Episode 06~10Episodee 06 You can always spot someone whoâ€™s never seen one of his plays before. Notice, no fear, no sense of impending doomâ€¦ ğŸ‘‰ spot çœ‹è§ åœºæ‰€ impending å³å°†å‘ç”Ÿçš„ doom æ¯ç­ æ­»äº¡ The exclamation point in the title scares me. ğŸ‘‰ exclamation point æƒŠå¹å· God. I feel violated. ğŸ‘‰ violate å†’çŠ¯ å¹²æ‰° She makes the women that I dream about look like short, fat, bald men! ğŸ‘‰ å¯¹æ¯” Oh yeah, and what would my opening line be? ğŸ‘‰ opening line å¼€åœºç™½ Oh please, could she be more out of my league? ğŸ‘‰ A be out of B league B é…ä¸ä¸Š A Iâ€™m very very aware of my tongueâ€¦ ğŸ‘‰ be aware of oneâ€™s tongue è°¨æ…è¡Œäº‹ It was better than that thing I did with the trolls, at least you got to see my head. ğŸ‘‰ troll (åˆå”±ä¸­çš„)è½®å”± Oh, listen, the usher gave me this to give to you. ğŸ‘‰ usher å¼•åº§å‘˜ fish out æå‡º Well, You know, monogamy can be a, uh, tricky concept. I mean, anthropologically speaking. ğŸ‘‰ monogamy ä¸€å¤«ä¸€å¦»åˆ¶ tricky å¤æ‚çš„ anthropologically äººç±»å­¦ä¸Š ottoman robe Thank God you didnâ€™t try to fan out the magazines. I mean, sheâ€™ll scratch your eyes right out. ğŸ‘‰ fan out æ•£å¼€ right out / away é©¬ä¸Š Oh come on! When we were kids, yours was the only Raggedy Ann doll that wasnâ€™t raggedy! ğŸ‘‰ raggedy è¤´è¤›çš„ Alright, you madcap gal. ğŸ‘‰ madcap é²è½çš„ gal å¥³å­© right away ç«‹å³ I buy laundry detergent, but itâ€™s not the one with the easy-pour spout. ğŸ‘‰ spout å–·å£ Little beads of condensation are inching their way closer and closer to the surface of the wood. ğŸ‘‰ coaster æ¯å« bead æ°´ç  condensation å†·å‡ inch ç¼“æ…¢åœ°ç§»åŠ¨ Youâ€™ve finally been able to crack your way into show business. ğŸ‘‰ crack your way into é—¯å…¥ I need to borrow some moisturizer. ğŸ‘‰ moisturize å˜æ½®æ¹¿ å¢åŠ æ°´åˆ† moisturizer ä¿æ¹¿ä¹³æ¶² Ooh, do I sense a little bit of resentment? ğŸ‘‰ resentment æ€¨æ¨ ä¸æ»¡ The old Monica would remind you to scrub that pan with a plastic brush. But Iâ€™m not gonna do that. ğŸ‘‰ scrub æ´—æ“¦ Iâ€™ve done nothing but crappy plays for six years. ğŸ‘‰ crappy &lt;ä¿š&gt; è¹©è„šçš„ æ— ä»·å€¼çš„","categories":[{"name":"English","slug":"English","permalink":"http://yoursite.com/categories/English/"}],"tags":[{"name":"Friends","slug":"Friends","permalink":"http://yoursite.com/tags/Friends/"}]},{"title":"Java 8 æ–°ç‰¹æ€§","slug":"Welab/Java å¼€å‘å®æˆ˜ç»éªŒ/Java 8 æ–°ç‰¹æ€§","date":"2020-02-18T07:14:54.000Z","updated":"2020-03-31T06:57:49.634Z","comments":true,"path":"2020/02/18/Welab/Java å¼€å‘å®æˆ˜ç»éªŒ/Java 8 æ–°ç‰¹æ€§/","link":"","permalink":"http://yoursite.com/2020/02/18/Welab/Java%20%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98%E7%BB%8F%E9%AA%8C/Java%208%20%E6%96%B0%E7%89%B9%E6%80%A7/","excerpt":"","text":"LambdJava SE 8 çš„ä¸€ä¸ªå¤§äº®ç‚¹æ˜¯å¼•å…¥äº† Lambda è¡¨è¾¾å¼ï¼Œä½¿ç”¨å®ƒè®¾è®¡çš„ä»£ç ä¼šæ›´åŠ ç®€æ´ã€‚ å½“å¼€å‘è€…åœ¨ç¼–å†™ Lambda è¡¨è¾¾å¼æ—¶ï¼Œä¹Ÿä¼šéšä¹‹è¢«ç¼–è¯‘æˆä¸€ä¸ªå‡½æ•°å¼æ¥å£ï¼ŒLambda å…è®¸æŠŠå‡½æ•°ä½œä¸ºä¸€ä¸ªæ–¹æ³•çš„å‚æ•°ä¼ é€’è¿›æ–¹æ³•ä¸­ã€‚Lambda è¡¨è¾¾å¼æœ¬è´¨æ˜¯åŒ¿åå‡½æ•°ï¼ˆæˆ–è€…å«åŒ¿åæ–¹æ³•ï¼‰ï¼Œä¹Ÿå¯ç§°ä¹‹ä¸ºé—­åŒ…ï¼Œåƒæ–¹æ³•ä¸€æ ·ï¼Œ Lambda è¡¨è¾¾å¼å…·æœ‰å¸¦ç±»å‹çš„å‚æ•°ã€ä¸»ä½“å’Œè¿”å›ç±»å‹ã€‚å¯ä½¿ç”¨ Lambda è¯­æ³•æ¥ä»£æ›¿åŒ¿åçš„å†…éƒ¨ç±»ï¼Œä»£ç ä¸ä»…ç®€æ´è€Œä¸”è¿˜å¯è¯»ã€‚ å½“ç„¶ï¼Œä¸è¶³ä¹‹å¤„å¯èƒ½å°±æ˜¯å¯è¯»æ€§ç¨å·®åŠè°ƒè¯•ç¨éº»çƒ¦ä¸€äº›ã€‚ Lambda è¯­æ³•æ ¼å¼èƒ½å¤Ÿç”¨äº Lambda è¡¨è¾¾å¼çš„åªèƒ½æ˜¯ interfaceï¼Œä¸” interface ä¸­åªæœ‰ä¸€ä¸ªæ–¹æ³•ã€‚ Lambda è¡¨è¾¾å¼çš„æ ‡å‡†ç»“æ„ï¼š (parameters) -&gt; {statements;} 123456789101112&#x2F;&#x2F; æ ‡å‡†ç»“æ„çš„å„ç§å˜å½¢&#x2F;&#x2F; å½“æ–¹æ³•ä½“ä¸­åªæœ‰ä¸€æ¡è¯­å¥æ—¶ï¼Œreturn å’Œ &#123;&#125; éƒ½å¯çœç•¥(parameters) -&gt; expression&#x2F;&#x2F; å½“ä»…æœ‰ä¸€ä¸ªå‚æ•°æ—¶ï¼Œ() å¯çœç•¥parameters -&gt; expression&#x2F;&#x2F; å½“æ²¡æœ‰å‚æ•°æ—¶ï¼Œå¯ç›´æ¥ä½¿ç”¨ ()() -&gt; expression&#x2F;&#x2F; ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨å¯ä»¥ä»ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­æ¨æ–­å‡º Lambda è¡¨è¾¾å¼çš„å‚æ•°ç±»å‹ï¼Œæ‰€ä»¥å‚æ•°çš„ç±»å‹å£°æ˜ä¹Ÿå¯ä»¥çœæ‰ Lambda æ–¹æ³•å¼•ç”¨Lambda è¡¨è¾¾å¼ç®€æ´å†™æ³•ï¼šs -&gt; s.toLowerCase()å¯çœç•¥ä¸º String::toLowerCase æ–¹æ³•å¼•ç”¨åŒ…å«çš„æƒ…å†µ é™æ€æ–¹æ³•å¼•ç”¨Class::static_method æ„é€ æ–¹æ³•å¼•ç”¨Class::newæˆ–Class&lt;T&gt;::new ç±»æˆå‘˜æ–¹æ³•å¼•ç”¨Class::method å¯¹è±¡æ–¹æ³•å¼•ç”¨instance::method Supplier æ¥å£ï¼šä¸æ¥å—ä»»ä½•å‚æ•°ï¼Œè¿”å›ä¸€ä¸ªç»“æœï¼ˆåªæœ‰ä¸€ä¸ªget()æ–¹æ³•ï¼‰ã€‚ 123456public class SupplierTest &#123; public static void main(String n args)&#123; Supplier&lt;String&gt; supplier = () -&gt; \"hello world\"; System.out.println(supplier.get()); // æ§åˆ¶å°æ‰“å° hello world &#125;&#125; StreamJava 8 ä¸­çš„Streamæ˜¯å¯¹é›†åˆï¼ˆCollectionï¼‰å¯¹è±¡åŠŸèƒ½çš„å¢å¼ºï¼Œé€‚ç”¨äºå¯¹é›†åˆå¯¹è±¡è¿›è¡Œå„ç§ä¾¿åˆ©ã€é«˜æ•ˆçš„è¿‡æ»¤ã€æ˜ å°„ã€æ’åºåŠèšåˆç­‰æ“ä½œï¼Œå¯ä»¥ç‹¬ç«‹ä¹Ÿå¯ä»¥ç»„åˆæˆå¤æ‚çš„æ“ä½œã€‚ Streamè¿˜åŒæ—¶æ”¯æŒä¸²è¡Œå’Œå¹¶è¡Œä¸¤ç§æ“ä½œæ¨¡å¼ï¼Œå¹¶è¡Œæ¨¡å¼èƒ½å¤Ÿå……åˆ†åˆ©ç”¨ç›®å‰ä¸»æµçš„å¤šæ ¸å¤„ç†å™¨çš„ä¼˜åŠ¿ï¼Œä½¿ç”¨ Fork / Join å¹¶è¡Œæ–¹å¼æ¥æ‹†åˆ†å’ŒåŠ é€Ÿä»»åŠ¡çš„å¤„ç†è¿‡ç¨‹ã€‚Stream API æ— éœ€ç¼–å†™å¤šçº¿ç¨‹ä»£ç ï¼Œé€šè¿‡å¹¶å‘æ¨¡å¼å¾ˆå®¹æ˜“å°±æ”¯æŒä»»åŠ¡çš„å¹¶è¡Œå¤„ç†ã€‚ Stream API ä½¿ç”¨ä¸€ç§ç±»ä¼¼ SQL è¯­å¥ä»æ•°æ®åº“æŸ¥è¯¢æ•°æ®çš„ç›´è§‚æ–¹å¼æ¥æ“ä½œ Java é›†åˆæ•°æ®ï¼Œå¯ä»¥å†™å‡ºé«˜æ•ˆç‡ã€å¹²å‡€ã€ç®€æ´çš„ä»£ç ï¼Œæå¤§çš„æé«˜é›†åˆæ“ä½œçš„ç”Ÿäº§åŠ›ã€‚å¯ä»¥å°†è¦å¤„ç†çš„é›†åˆå…ƒç´ çœ‹ä½œä¸€ç§æµï¼Œæµåœ¨ç®¡é“ä¸­ä¼ è¾“ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ç®¡é“ä¼ è¾“çš„å„ä¸ªèŠ‚ç‚¹ä¸Šè¿›è¡Œç­›é€‰ã€æ’åºåŠèšåˆç­‰æ“ä½œã€‚æµåœ¨ç®¡é“ä¸­ç»è¿‡ä¸­é—´æ“ä½œï¼ˆintermediate operationï¼‰çš„å¤„ç†ï¼Œæœ€åç”±æœ€ç»ˆæ“ä½œï¼ˆterminal operationï¼‰å¾—åˆ°å‰é¢å¤„ç†çš„ç»“æœã€‚ Stream ç¤ºä¾‹12345678910111213141516171819202122232425262728293031public class StreamDemo &#123; public static void main(String[] args) &#123; List&lt;String&gt; peekList = Stream.of(\"one\", \"tow\", \"three\", \"four\", \"five\", \"six\", \"seven\") .filter(e -&gt; e.length() &gt; 3) // è¿‡æ»¤å‡ºå­—ç¬¦ä¸²é•¿åº¦å¤§äº 3 çš„å…ƒç´  .peek(e -&gt; System.out.println(\"Filtered value: \" + e)) .map(String::toUpperCase) // å°†å…ƒç´ è½¬ä¸ºå¤§å†™ .peek(e -&gt; System.out.println(\"Mapped value: \" + e)) .collect(Collectors.toList()); // å°†è¾“å‡º Stream è½¬æ¢ä¸º List System.out.println(\"é›†åˆæ‰“å°ï¼š\"); for (String string : peekList) &#123; System.out.println(string); &#125; &#125;&#125;// è¿è¡Œç»“æœFiltered value: threeMapped value: THREEFiltered value: fourMapped value: FOURFiltered value: fiveMapped value: FIVEFiltered value: sevenMapped value: SEVENé›†åˆæ‰“å°ï¼šTHREEFOURFIVESEVEN Stream åŸºç¡€ç‰¹æ€§ åŸºæœ¬æµç¨‹ï¼šæ•°æ®æºï¼ˆå­˜å‚¨ï¼‰ â†’ å…ƒç´ é˜Ÿåˆ—ï¼ˆStreamï¼‰ â†’ æ“ä½œï¼ˆfilterã€mapã€reduceã€findã€matchã€sorted ç­‰ï¼‰ Pipeliningï¼šä¸­é—´æ“ä½œéƒ½ä¼šè¿”å›æµå¯¹è±¡æœ¬èº«ã€‚è¿™æ ·å¤šä¸ªæ“ä½œå¯ä»¥ä¸²è”æˆä¸€ä¸ªç®¡é“ï¼Œ å¦‚åŒæµå¼é£æ ¼ï¼ˆfluent styleï¼‰ã€‚ è¿™æ ·åšå¯ä»¥å¯¹æ“ä½œè¿›è¡Œä¼˜åŒ–ï¼Œ æ¯”å¦‚å»¶è¿Ÿæ‰§è¡Œï¼ˆlazinessï¼‰å’ŒçŸ­è·¯ï¼ˆshort-circuitingï¼‰ï¼› å†…éƒ¨è¿­ä»£ï¼šä»¥å‰å¯¹é›†åˆéå†éƒ½æ˜¯é€šè¿‡ Iterator æˆ–è€… For-Each çš„æ–¹å¼, æ˜¾å¼çš„åœ¨é›†åˆå¤–éƒ¨è¿›è¡Œè¿­ä»£ï¼Œ è¿™å«åšå¤–éƒ¨è¿­ä»£ã€‚ Java Stream æä¾›äº†å†…éƒ¨è¿­ä»£çš„æ–¹å¼ï¼Œ é€šè¿‡è®¿é—®è€…æ¨¡å¼ï¼ˆVisitorï¼‰å®ç°ã€‚ Stream ä¸² / å¹¶è¡Œ","categories":[{"name":"Java","slug":"Java","permalink":"http://yoursite.com/categories/Java/"}],"tags":[{"name":"Base","slug":"Base","permalink":"http://yoursite.com/tags/Base/"}]},{"title":"WebSocket","slug":"Netty/WebSocket","date":"2020-02-17T04:12:30.000Z","updated":"2020-04-19T06:34:07.314Z","comments":true,"path":"2020/02/17/Netty/WebSocket/","link":"","permalink":"http://yoursite.com/2020/02/17/Netty/WebSocket/","excerpt":"WebSocket å…¥é—¨ä»‹ç»ä»¥åŠ Netty WebSocket åè®®å¼€å‘ã€‚","text":"WebSocket å…¥é—¨ä»‹ç»ä»¥åŠ Netty WebSocket åè®®å¼€å‘ã€‚ HTTP è¯·æ±‚ / å“åº”æ¨¡å¼ï¼šå®¢æˆ·ç«¯åŠ è½½ä¸€ä¸ªç½‘é¡µï¼Œç„¶åç›´åˆ°ç”¨æˆ·ç‚¹å‡»ä¸‹ä¸€é¡µä¹‹å‰ï¼Œä»€ä¹ˆéƒ½ä¸ä¼šå‘ç”Ÿã€‚ Ajaxï¼šç½‘ç»œå¼€å§‹å˜å¾—æ›´åŠ åŠ¨æ€äº†ï¼Œä½†æ‰€æœ‰çš„ HTTP é€šä¿¡ä»ç„¶ç”±å®¢æˆ·ç«¯æ§åˆ¶ï¼Œè¿™å°±éœ€è¦ç”¨æˆ·è¿›è¡Œäº’åŠ¨æˆ–å®šæœŸè½®è¯¢ï¼Œä»¥ä¾¿ä»æœåŠ¡å™¨åŠ è½½æ–°æ•°æ®ã€‚ é•¿æœŸä»¥æ¥å­˜åœ¨ç€å„ç§æŠ€æœ¯è®©æœåŠ¡å™¨å¾—çŸ¥æœ‰æ–°æ•°æ®å¯ç”¨æ—¶ï¼Œç«‹å³å°†æ•°æ®å‘é€åˆ°å®¢æˆ·ç«¯è¿™äº›æŠ€æœ¯ç§ç±»ç¹å¤šã€‚æœ€å¸¸ç”¨çš„ä¸€ç§é»‘å®¢æ‰‹æ®µæ˜¯å¯¹æœåŠ¡å™¨å‘èµ·é“¾æ¥åˆ›å»ºå‡è±¡ï¼Œè¢«ç§°ä¸ºé•¿è½®è¯¢ã€‚åˆ©ç”¨é•¿è½®è¯¢ï¼Œå®¢æˆ·ç«¯å¯ä»¥æ‰“å¼€æŒ‡å‘æœåŠ¡å™¨çš„ HTTP è¿æ¥ï¼Œè€ŒæœåŠ¡å™¨ä¼šä¸€ç›´ä¿æŒè¿æ¥æ‰“å¼€ï¼Œç›´åˆ°å‘é€å“åº”ã€‚æœåŠ¡å™¨åªè¦å®é™…æ‹¥æœ‰æ–°æ•°æ®ï¼Œå°±ä¼šå‘é€å“åº”ã€‚ é—®é¢˜ï¼šç”±äº HTTP åè®®çš„å¼€é”€ï¼Œå¯¼è‡´å®ƒä»¬ä¸é€‚ç”¨äºä½å»¶è¿Ÿåº”ç”¨ã€‚ WebSocketï¼šå°†ç½‘ç»œå¥—æ¥å­—å¼•å…¥åˆ°äº†å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ¥è§£å†³è¿™ä¸€é—®é¢˜ï¼Œæµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´å¯ä»¥é€šè¿‡å¥—æ¥å­—å»ºç«‹æŒä¹…çš„è¿æ¥ï¼ŒåŒæ–¹éšæ—¶éƒ½å¯ä»¥äº’å‘æ•°æ®ç»™å¯¹æ–¹ï¼Œè€Œä¸æ˜¯ä¹‹å‰ç”±å®¢æˆ·ç«¯æ§åˆ¶çš„ä¸€è¯·æ±‚ä¸€åº”ç­”æ¨¡å¼ã€‚ WebSocket å…¥é—¨åœ¨ WebSocket API ä¸­ï¼Œæµè§ˆå™¨å’ŒæœåŠ¡å™¨åªéœ€è¦åšä¸€ä¸ªæ¡æ‰‹çš„åŠ¨ä½œï¼Œç„¶åï¼Œæµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´å°±å½¢æˆäº†ä¸€æ¡å¿«é€Ÿé€šé“ï¼Œä¸¤è€…å°±å¯ä»¥ç›´æ¥äº’ç›¸ä¼ é€æ•°æ®äº†ã€‚WebSocket åŸºäº TCP åŒå‘å…¨åŒå·¥è¿›è¡Œæ¶ˆæ¯ä¼ é€’ï¼Œåœ¨åŒä¸€æ—¶åˆ»ï¼Œæ—¢å¯ä»¥å‘é€æ¶ˆæ¯ï¼Œä¹Ÿå¯ä»¥æ¥æ”¶æ¶ˆæ¯ï¼Œç›¸æ¯”äº HTTP çš„åŠåŒå·¥åè®®ï¼Œæ€§èƒ½å¾—åˆ°å¾ˆå¤§æå‡ã€‚ WebSocket è¿æ¥å»ºç«‹ WebSocket è¿æ¥æ—¶ï¼Œéœ€è¦é€šè¿‡å®¢æˆ·ç«¯æˆ–è€…æµè§ˆå™¨å‘å‡ºæ¡æ‰‹è¯·æ±‚ã€‚ æ¡æ‰‹è¯·æ±‚æ¶ˆæ¯å¦‚ä¸‹ï¼š ä¸ºäº†å»ºç«‹ä¸€ä¸ª WebSocket è¿æ¥ï¼Œå®¢æˆ·ç«¯æµè§ˆå™¨é¦–å…ˆè¦å‘æœåŠ¡å™¨å‘èµ·ä¸€ä¸ª HTTP è¯·æ±‚ï¼Œè¿™ä¸ªè¯·æ±‚å’Œé€šå¸¸çš„ HTTP è¯·æ±‚ä¸åŒï¼ŒåŒ…å«äº†ä¸€äº›é™„åŠ å¤´ä¿¡æ¯ï¼Œå…¶ä¸­é™„åŠ å¤´ä¿¡æ¯ Upgrade: WebSocketè¡¨æ˜è¿™æ˜¯ä¸€ä¸ªç”³è¯·åè®®å‡çº§çš„ HTTP è¯·æ±‚ã€‚æœåŠ¡å™¨ç«¯è§£æè¿™äº›é™„åŠ çš„å¤´ä¿¡æ¯ï¼Œç„¶åç”Ÿæˆåº”ç­”ä¿¡æ¯è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯çš„ WebSocket è¿æ¥å°±å»ºç«‹èµ·æ¥äº†ï¼ŒåŒæ–¹å¯ä»¥é€šè¿‡è¿™ä¸ªè¿æ¥é€šé“è‡ªç”±åœ°ä¼ é€’ä¿¡æ¯ï¼Œå¹¶ä¸”è¿™ä¸ªè¿æ¥ä¼šæŒç»­å­˜åœ¨ç›´åˆ°å®¢æˆ·ç«¯æˆ–è€…æœåŠ¡å™¨ç«¯çš„æŸä¸€æ–¹ä¸»åŠ¨å…³é—­è¿æ¥ã€‚ æ¡æ‰‹åº”ç­”æ¶ˆæ¯å¦‚ä¸‹ï¼š è¯·æ±‚æ¶ˆæ¯ä¸­çš„Sec-WebSocket-Keyæ˜¯éšæœºçš„,æœåŠ¡å™¨ç«¯ä¼šç”¨è¿™äº›æ•°æ®æ¥æ„é€ å‡ºä¸€ä¸ª SHA-1 çš„ä¿¡æ¯æ‘˜è¦ã€‚ä½¿ç”¨ SHA-1 åŠ å¯†,ç„¶åè¿›è¡Œ BASE-64 ç¼–ç ï¼Œå°†ç»“æœåšä¸ºSec- WebSocket- Acceptå¤´çš„å€¼ï¼Œè¿”å›ç»™å®¢æˆ·ç«¯ã€‚ WebSocket ç”Ÿå‘½å‘¨æœŸæ¡æ‰‹æˆåŠŸä¹‹å,æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯å°±å¯ä»¥é€šè¿‡ messages çš„æ–¹å¼è¿›è¡Œé€šä¿¡äº†ï¼Œä¸€ä¸ªæ¶ˆæ¯ç”±ä¸€ä¸ªæˆ–è€…å¤šä¸ªå¸§ç»„æˆï¼ŒWebSocketçš„æ¶ˆæ¯å¹¶ä¸ä¸€å®šå¯¹åº”ä¸€ä¸ªç‰¹å®šç½‘ç»œå±‚çš„å¸§ï¼Œå®ƒå¯ä»¥è¢«åˆ†å‰²æˆå¤šä¸ªå¸§æˆ–è€…è¢«åˆå¹¶ã€‚ WebSocket çš„æ¡æ‰‹å…³é—­æ¶ˆæ¯å¸¦æœ‰ä¸€ä¸ªçŠ¶æ€ç å’Œä¸€ä¸ªå¯é€‰çš„å…³é—­åŸå› ï¼Œå®ƒå¿…é¡»æŒ‰ç…§åè®®è¦æ±‚å‘é€ä¸€ä¸ª Close æ§åˆ¶å¸§ï¼Œå½“å¯¹ç«¯æ¥æ”¶åˆ°å…³é—­æ§åˆ¶å¸§æŒ‡ä»¤æ—¶ï¼Œéœ€è¦ä¸»åŠ¨å…³é—­ WebSocketè¿æ¥ã€‚ Netty WebSocket åè®®å¼€å‘Netty åŸºäº HTTP åè®®æ ˆå¼€å‘äº† WebSocket åè®®æ ˆ,åˆ©ç”¨ Netty çš„ WebSocket åè®®æ ˆå¯ä»¥éå¸¸æ–¹ä¾¿åœ°å¼€å‘å‡º WebSocket å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ã€‚ Netty æœåŠ¡ç«¯å®ä¾‹åŠŸèƒ½ä»‹ç» æ”¯æŒ WebSocket çš„æµè§ˆå™¨é€šè¿‡ WebSocket åè®®å‘é€è¯·æ±‚æ¶ˆæ¯ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯å¯¹è¯·æ±‚æ¶ˆæ¯è¿›è¡Œåˆ¤æ–­ï¼› å¦‚æœæ˜¯åˆæ³•çš„ WebSocket è¯·æ±‚,åˆ™è·å–è¯·æ±‚æ¶ˆæ¯ä½“ï¼ˆæ–‡æœ¬ï¼‰å¹¶åœ¨åé¢è¿½åŠ å­—ç¬¦ä¸²â€œæ¬¢è¿ä½¿ç”¨ Netty WebSocketæœåŠ¡,ç°åœ¨æ—¶åˆ»:[ç³»ç»Ÿæ—¶é—´]â€ï¼› å®¢æˆ·ç«¯ HTML é€šè¿‡å†…åµŒçš„ JS è„šæœ¬åˆ›å»º WebSocket è¿æ¥ï¼Œæ¡æ‰‹æˆåŠŸ / å¤±è´¥ï¼Œåœ¨æ–‡æœ¬æ¡†ä¸­æ‰“å°â€œæ‰“å¼€ Web SocketæœåŠ¡æ­£å¸¸,æµè§ˆå™¨æ”¯æŒ Web Socket!â€ / â€œæŠ±æ­‰ï¼Œæ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒ Web Socketåè®®!â€ã€‚ åŠŸèƒ½å¼€å‘12345678&lt;!-- pom.xml --&gt;&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;io.netty&lt;/groupId&gt; &lt;artifactId&gt;netty-all&lt;/artifactId&gt; &lt;version&gt;5.0.0.Alpha1&lt;/version&gt; &lt;/dependency&gt;&lt;/dependencies&gt; 12345678910111213141516171819202122232425262728293031323334353637383940414243444546// WebSocket æœåŠ¡ç«¯å¯åŠ¨ç±»public class WebSocketServer&#123; public void run(int port) throws Exception&#123; EventLoopGroup bossGroup = new NioEventLoopGroup (); EventLoopGroup workerGroup = new NioEventLoopGroup(); try &#123; ServerBootstrap b= new ServerBootstrap(); b.group(bossGroup, workerGroup) .channel(NioServerSocketChannel.class) .childHandler(new ChannelInitializer&lt;SocketChannel&gt;() &#123; @Override protected void initChannel(SocketChannel ch) throws Exception &#123; ChannelPipeline pipeline = ch.pipeline (); // å°†è¯·æ±‚å’Œåº”ç­”æ¶ˆæ¯ç¼–ç  / è§£ç ä¸º HTTP æ¶ˆæ¯ pipeline.addLast(\"http-codec\", new HttpServerCodec()); // å°† HTTP æ¶ˆæ¯çš„å¤šä¸ªéƒ¨åˆ†ç»„åˆæˆä¸€æ¡å®Œæ•´çš„ HTTP æ¶ˆæ¯ pipeline.addLast (\"aggregator\", new HttpObjectAggregator(65536)); // ä¸»è¦ç”¨äºæ”¯æŒæµè§ˆå™¨å’ŒæœåŠ¡ç«¯è¿›è¡Œ WebSocket é€šä¿¡ ch.pipeline().addLast(\"http-chunked\", new ChunkedWriteHandler()); // å¢åŠ  WebSocket æœåŠ¡ç«¯ handler pipeline.addLast(\"handler\", new WebSocketServerHandler()); &#125; &#125;); Channel ch = b.bind(port).sync().channel(); System.out.println(\"Web socket server started at port\" + port +'.'); System.out.println (\"Open our browser and navigate to http://localhost:\" + port + '/'); ch.closeFuture().sync(); &#125; finally &#123; bossGroup. shutdownGracefully(); workerGroup. shutdownGracefully(); &#125; &#125; public static void main(String[] args) throws Exception &#123; int port = 8080; if (args.length &gt;0) &#123; try&#123; port = Integer.parseInt(args[0]); &#125; catch(NumberFormatException e) &#123; e.printStackTrace(); &#125; &#125; new WebSocketServer().run(port); &#125;&#125; 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889// Websocket æœåŠ¡ç«¯å¤„ç†ç±»public class WebSocketServerHandler extends SimpleChannelInboundHandler&lt;Object&gt; &#123; private static final Logger logger = Logger.getLogger(WebSocketServerHandler.class.getName()); private WebSocketServerHandshaker handshaker; @Override protected void messageReceived(ChannelHandlerContext ctx, Object msg) throws Exception &#123; // ä¼ ç»Ÿçš„ HTTP æ¥å…¥ if (msg instanceof FullHttpRequest)&#123; // åˆ¤æ–­è¯·æ±‚æ¶ˆæ¯æœ‰ä¸­æ˜¯å¦åŒ…å« Upgrade: websocket handleHttpRequest(ctx,(FullHttpRequest)msg); &#125;// WebSocket æ¥å…¥ else if (msg instanceof WebSocketFrame)&#123; handleWebSocketFrame(ctx,(WebSocketFrame)msg); &#125; &#125; private void handleHttpRequest(ChannelHandlerContext ctx, FullHttpRequest req) throws Exception&#123; // å¦‚æœ HTTP è§£ç å¤±è´¥ï¼Œè¿”å› HTTP 400 å“åº”å¼‚å¸¸ if (!req.getDecoderResult().isSuccess() || (!\"websocket\".equals(req.headers().get(\"Upgrade\"))))&#123; sendHttpResponse(ctx, req,new DefaultFullHttpResponse(HttpVersion.HTTP_1_1, HttpResponseStatus.BAD_REQUEST)); return; &#125; // æ„é€ æ¡æ‰‹å·¥å‚ï¼Œæœ¬æœºæµ‹è¯• WebSocketServerHandshakerFactory wsFactory = new WebSocketServerHandshakerFactory(\"ws://localhost:8080/websocket\",null,false); // åˆ›å»ºæ¡æ‰‹å¤„ç†ç±» handshaker = wsFactory.newHandshaker(req); if (handshaker == null)&#123; WebSocketServerHandshakerFactory.sendUnsupportedWebSocketVersionResponse(ctx.channel()); &#125;else &#123; // æ„é€ æ¡æ‰‹å“åº”æ¶ˆæ¯è¿”å›ç»™å®¢æˆ·ç«¯ // å°† WebSocket ç›¸å…³çš„ç¼–ç å’Œè§£ç ç±»åŠ¨æ€æ·»åŠ åˆ° ChannelPipeline ä¸­ç”¨äº WebSocket æ¶ˆæ¯çš„ç¼–è§£ç  handshaker.handshake(ctx.channel(),req); &#125; &#125; // é“¾è·¯å»ºç«‹æˆåŠŸä¹‹ååˆ†åˆ«å¯¹æ§åˆ¶å¸§è¿›è¡Œåˆ¤æ–­ private void handleWebSocketFrame(ChannelHandlerContext ctx, WebSocketFrame frame) &#123; // åˆ¤æ–­æ˜¯å¦å…³é—­é“¾è·¯æŒ‡ä»¤ if (frame instanceof CloseWebSocketFrame)&#123; handshaker.close(ctx.channel(), (CloseWebSocketFrame) frame.retain()); return; &#125; // åˆ¤æ–­æ˜¯å¦æ˜¯ç»´æŒé“¾è·¯çš„ Ping æ¶ˆæ¯ if (frame instanceof PingWebSocketFrame)&#123; // æ„é€  pong æ¶ˆæ¯è¿”å› ctx.channel().write(new PongWebSocketFrame(frame.content()).retain()); return; &#125; // æœ¬ä¾‹ç¨‹ä»…æ”¯æŒæ–‡æœ¬ä¿¡æ¯ï¼Œæ•…å¯¹éæ–‡æœ¬æ¶ˆæ¯æŠ›å‡ºå¼‚å¸¸ if (!(frame instanceof TextWebSocketFrame))&#123; throw new UnsupportedOperationException(String.format(\"%s frame types not supported\",frame.getClass().getName())); &#125; // è¿”å›åº”ç­”æ¶ˆæ¯ String request = ((TextWebSocketFrame) frame).text(); if (logger.isLoggable(Level.FINE))&#123; logger.fine(String.format(\"%s received %s\",ctx.channel(),request)); &#125; // æ„é€ æ–°çš„ TextWebSocketFrame æ¶ˆæ¯è¿”å›ç»™å®¢æˆ·ç«¯ // ç”±äºæ¡æ‰‹åº”ç­”æ—¶åŠ¨æ€å¢åŠ äº† TextWebSocketframe çš„ç¼–ç ç±»,æ‰€ä»¥å¯ä»¥ç›´æ¥å‘é€ TextWebSocketFrameå¯¹è±¡ ctx.channel().write(new TextWebSocketFrame(request+\"æ¬¢è¿ä½¿ç”¨Netty WebSocketæœåŠ¡ï¼Œç°åœ¨æ—¶åˆ»:\" + new Date().toString())); &#125; private static void sendHttpResponse(ChannelHandlerContext ctx,FullHttpRequest req,FullHttpResponse res)&#123; // è¿”å›åº”ç­”ç»™å®¢æˆ·ç«¯ if (res.getStatus().code() != 200)&#123; ByteBuf buf = Unpooled.copiedBuffer(res.getStatus().toString(), CharsetUtil.UTF_8); res.content().writeBytes(buf); // æ˜ç¡®é‡Šæ”¾ByteBufçš„å¼•ç”¨è®¡æ•° buf.release(); setContentLength(res,res.content().readableBytes()); &#125; // å¦‚æœæ˜¯é Keep-Aliveï¼Œå…³é—­è¿æ¥ ChannelFuture f = ctx.channel().writeAndFlush(res); if (!isKeepAlive(req) || res.getStatus().code() != 200)&#123; f.addListener(ChannelFutureListener.CLOSE); &#125; &#125; @Override public void channelReadComplete(ChannelHandlerContext ctx) throws Exception &#123; ctx.flush(); &#125; @Override public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception &#123; cause.printStackTrace(); ctx.close(); &#125;&#125; 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091&lt;html&gt; &lt;head&gt; &lt;meta charset=\"utf-8\"&gt; &lt;title&gt;WebSoket Demo&lt;/title&gt; &lt;script type=\"text/JavaScript\"&gt; var WebSocket = WebSocket || window.WebSocket || window.MozWebSocket; if (!WebSocket) &#123; alert(\"WebSocket not supported by this browser!\"); &#125; else &#123; var ws = null; function Display() &#123; console.log(\"websocket æµ‹è¯•\"); &#125; var log = function (s) &#123; if (document.readyState !== \"complete\") &#123; log.buffer.push(s); &#125; else &#123; document.getElementById(\"contentId\").value += (s + \"/n\"); &#125; &#125; function CreateConnect () &#123; var msg = document.getElementById(\"wsUrlId\"); console.log(\"CreateConnect(), url: \" + msg.value); if (ws == null) &#123; var wsUrlValue = msg.value; try &#123; ws = new WebSocket(wsUrlValue); ws.onmessage = function (event) &#123; log(\"onmessage(), æ¥æ”¶åˆ°æœåŠ¡å™¨æ¶ˆæ¯: \" + event.data); &#125;; ws.onclose = function (event) &#123; log(\"onclose(), Socket å·²å…³é—­!\"); ws = null; &#125;; ws.onopen = function (event) &#123; log(\"onopen(), Socket è¿æ¥æˆåŠŸ!\"); &#125;; ws.onerror = function (event) &#123; &#125;; &#125; catch (e) &#123; ws = null; log(\"è¿æ¥å¼‚å¸¸, é‡ç½® websocket\"); &#125; &#125; &#125; function SendMsg() &#123; var msg = document.getElementById(\"messageId\"); console.log(\"SendMsg(), msg: \" + msg.value); if (ws != null) &#123; log(\"å‘é€ Socket æ¶ˆæ¯: \" + msg.value); ws.send(msg.value); &#125; else &#123; log(\"Socket è¿˜æœªåˆ›å»º!, msg: \" + msg.value); &#125; &#125; function CloseConnect () &#123; console.log(\"CloseConnect()\"); if (ws != null) &#123; ws.close(); &#125; &#125; &#125; &lt;/script&gt; &lt;/head&gt; &lt;body onload=\"Display()\" &gt; &lt;div id=\"valueLabel\"&gt;&lt;/div&gt; &lt;textarea rows=\"10\" cols=\"40\" id=\"contentId\"&gt;&lt;/textarea&gt; &lt;br/&gt; &lt;input name=\"wsUrl\" id=\"wsUrlId\" value=\"ws://localhost:8080/websocket\"/&gt; &lt;button id=\"createButton\" onClick=\"javascript:CreateConnect()\"&gt;Create&lt;/button&gt; &lt;button id=\"closeButton\" onClick=\"javascript:CloseConnect()\"&gt;Close&lt;/button&gt; &lt;br/&gt; &lt;input name=\"message\" id=\"messageId\" value=\"Hello, Server!\"/&gt; &lt;button id=\"sendButton\" onClick=\"javascript:SendMsg()\"&gt;Send&lt;/button&gt; &lt;/body&gt;&lt;/html&gt; æµ‹è¯•ç»“æœæ§åˆ¶å°æ‰“å° æµè§ˆå™¨è°ƒè¯•","categories":[{"name":"Java","slug":"Java","permalink":"http://yoursite.com/categories/Java/"}],"tags":[{"name":"Netty","slug":"Netty","permalink":"http://yoursite.com/tags/Netty/"},{"name":"WebSocket","slug":"WebSocket","permalink":"http://yoursite.com/tags/WebSocket/"}]},{"title":"2020 è¯»ä¹¦ç¬”è®°","slug":"Summary/ç¤¾ä¼šå¿ƒç†å­¦","date":"2020-02-16T14:22:10.000Z","updated":"2020-03-02T04:17:48.607Z","comments":true,"path":"2020/02/16/Summary/ç¤¾ä¼šå¿ƒç†å­¦/","link":"","permalink":"http://yoursite.com/2020/02/16/Summary/%E7%A4%BE%E4%BC%9A%E5%BF%83%E7%90%86%E5%AD%A6/","excerpt":"ä¹¦ç±æ‘˜è¦ä»¥åŠæ„Ÿæ‚Ÿã€‚","text":"ä¹¦ç±æ‘˜è¦ä»¥åŠæ„Ÿæ‚Ÿã€‚ äºŒæœˆæƒ…ç»ªæ²Ÿé€šï¼šæ”¹å˜çœ‹æ³•ä¸è‡ªæˆ‘è®¤çŸ¥ åº•å±‚é€»è¾‘ æ³•å¾‹ ğŸ‘‰ å°†ä¸è§„åˆ™çš„ç”Ÿæ´»çŠ¶æ€æ”¾å…¥åˆ°ä¸€ä¸ªè§„åˆ™çš„å®¹å™¨ä¸­ ğŸ‘‰ å¦‚ä½•å¤„ç†â€œæº¢å‡ºâ€çš„éƒ¨åˆ†ï¼Ÿ ç¾å­¦ ğŸ‘‰ å¼•èµ·å…±é¸£ ğŸ‘‰ å¦‚ä½•è®©è§‚è€…æ„Ÿå—åˆ°ä½œè€…æ‰€è¦ä¼ è¾¾çš„æƒ…ç»ªï¼Ÿ æ²Ÿé€š ğŸ‘‰ è¯´æœ ğŸ‘‰ æ²¡æœ‰äººå–œæ¬¢è¢«æ”¹å˜ â— äººçš„è§‚ç‚¹çœ‹æ³• = è¿‡å»çš„é€‰æ‹© + è¿‡å»çš„åå¥½ è®²é“ç† / å‘½ä»¤å¼è¯´æ•™ ğŸ‘‰ å¦å®šä¸€ä¸ªçš„è¿‡å» ğŸ‘‰ æœ¬èƒ½æŠ—æ‹’ ğŸ‘ å¼•èµ·å…±é¸£ ğŸ‘ ç»™äºˆé€‰æ‹©æƒ ğŸ‘‰ é€‰æ‹©æƒè¯­å¥ / éšæ—¶å¯ä»¥åæ‚” ğŸ‘ æˆ‘éœ€è¦ ä½ ä¸ºä»€ä¹ˆè¦ äººçš„æƒ…ç»ª ğŸ‘‰ å¾ˆå¤§ç¨‹åº¦å†³å®šé€‰æ‹© ğŸ‘‰ æ·±æŒ–æƒ…ç»ªï¼šè¿™ä»¶äº‹å¯¹ä½ æ¥è¯´æ„å‘³ç€ä»€ä¹ˆï¼Ÿ ğŸ‘‰ æ ¹æ®æƒ…ç»ªå¯»æ‰¾è§£å†³åŠæ³• ğŸ‘ æ„¤æ€’ ğŸ‘‰ å¼ºåŒ–ç°æœ‰æƒ³æ³• æƒŠè®¶ ğŸ‘‰ åŠ¨æ‘‡ç°æœ‰çœ‹æ³• æ‚²ä¼¤ ğŸ‘‰ æ‰¾åˆ°é‡è¦çœ‹æ³• é—®é¢˜çš„ç†è§£ æœŸå¾…ä¸ç°å®çš„è½å·® ğŸ‘‰ æ˜¯å¦åˆç† ä½ çœ¼ä¸­çš„é—®é¢˜æ˜¯åˆ«äººçš„è§£å†³æ–¹æ¡ˆ æ¢è§’åº¦æ€è€ƒé—®é¢˜ ğŸ‘‰ åˆ«å±€é™äºè‡ªèº« äº§å“ç»ç†å››ä¸ªç»´åº¦ï¼šäº§å“ã€ç”¨æˆ·ã€åœºæ™¯ã€æ•ˆç‡ã€‚ äº§å“åŠŸèƒ½ï¼Ÿ ğŸ‘‰ æœåŠ¡ç‰¹æ€§ ATM æœºçš„æ˜¾æ€§ç‰¹æ€§ï¼šå–é’± ATM æœºçš„éšå½¢ç‰¹æ€§ï¼šåˆ†æµçª—å£å‹åŠ›ã€å“ç‰Œæ•ˆåº”ã€æ— åˆ©æ¯çš„ç°é‡‘å¤–å­˜â€¦ï¼ˆè¿è¥åšå¤§é‡çš„å¸‚åœºè°ƒæŸ¥ï¼‰ äº§å“èƒ½å¦è¾¾æˆæˆ˜ç•¥è¿°æ±‚ä»¥åŠèƒ½å¦æŒç»­çš„æä¾›æœåŠ¡ ğŸ‘‰ èµ„æºçš„æœ‰é™æ€§ ğŸ‘‰ å–èˆ ç”¨æˆ· ğŸ‘‰ åˆ†å±‚ã€ç”¨æˆ·ç”»åƒ ğŸ‘‰ ä¸åŒç¾¤ä½“æœ‰ä¸åŒçš„æœåŠ¡éœ€æ±‚ã€ç”¨æˆ·ç‰¹æ€§å½±å“å†³å®šæ–¹å¼ åŒç¨‹è‰ºé¾™ VS ç¾å›¢é…’åº— åœºæ™¯ ğŸ‘‰ æ—¶é—´ã€ç©ºé—´ã€æƒ…ç»ª æƒ…ç»ªçš„åŠ›é‡ ğŸ‘‰ æ¬²æœ› ğŸ‘‰å¤§ç”©å– è‡ªæˆ‘ä¸è‡ªåˆ¶äºŒè€…ä¸å¯å…±å­˜ ğŸ‘‰ æ¢å¯»è‡ªæˆ‘ï¼Œé€‰æ‹©é€‚åˆè‡ªå·±çš„ä¸€é¢","categories":[{"name":"Life","slug":"Life","permalink":"http://yoursite.com/categories/Life/"}],"tags":[{"name":"Notes","slug":"Notes","permalink":"http://yoursite.com/tags/Notes/"}]},{"title":"Java åç«¯å¼€å‘ç¯å¢ƒæ­å»º","slug":"Welab/Java åç«¯å¼€å‘ç¯å¢ƒæ­å»º","date":"2020-02-15T09:48:23.000Z","updated":"2020-04-19T06:44:54.137Z","comments":true,"path":"2020/02/15/Welab/Java åç«¯å¼€å‘ç¯å¢ƒæ­å»º/","link":"","permalink":"http://yoursite.com/2020/02/15/Welab/Java%20%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/","excerpt":"è®°å½•å¼€å‘ç¯å¢ƒæ­å»ºè¿‡ç¨‹ä»¥åŠæ•´åˆèµ„æºä»¥ä¾¿å¿«é€Ÿæ­å»ºç¯å¢ƒã€‚","text":"è®°å½•å¼€å‘ç¯å¢ƒæ­å»ºè¿‡ç¨‹ä»¥åŠæ•´åˆèµ„æºä»¥ä¾¿å¿«é€Ÿæ­å»ºç¯å¢ƒã€‚ JDK å®‰è£… Oracle å®˜ç½‘ ä¸‹è½½ JDK å®‰è£…åŒ…ï¼Œéœ€è¦æ³¨å†Œè´¦å·åæ‰å¯ä¸‹è½½ã€‚ äº‘ç›˜èµ„æºä¸‹è½½ï¼šjdk-8u241-windows-x64.exe ä¿®æ”¹å®‰è£…ç›®å½•æ³¨æ„äº‹é¡¹ï¼š â€‹ å®‰è£…åœ¨éæ“ä½œç³»ç»Ÿæ‰€åœ¨ç›®å½•ä¸‹ï¼› â€‹ å®‰è£…çš„è·¯å¾„ä¸­ä¸è¦æœ‰ä¸­æ–‡åŠç©ºæ ¼ã€‚ ç›®å½•ä»‹ç»JDK ç›®å½•ï¼šJava Development Kit å³ Java å¼€å‘å·¥å…·ï¼ŒåŒ…å« JREã€‚ JRE ç›®å½•ï¼šJava Runtime Environment å³ Java è¿è¡Œæ—¶ç¯å¢ƒã€‚ JVMï¼šJava Virtual Machine å³ Java è™šæ‹Ÿæœº JVM æ˜¯æ•´ä¸ª Java å®ç°è·¨å¹³å°çš„æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œæ‰€æœ‰çš„ Java ç¨‹åºä¼šé¦–å…ˆè¢«ç¼–è¯‘ä¸º .class çš„ç±»æ–‡ä»¶ï¼Œè¿™ç§ç±»æ–‡ä»¶å¯ä»¥åœ¨è™šæ‹Ÿæœºä¸Šæ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´ .class æ–‡ä»¶å¹¶ä¸ç›´æ¥ä¸æœºå™¨çš„æ“ä½œç³»ç»Ÿç›¸å¯¹åº”ï¼Œè€Œæ˜¯ç»è¿‡è™šæ‹Ÿæœºé—´æ¥ä¸æ“ä½œç³»ç»Ÿäº¤äº’ï¼Œç”±è™šæ‹Ÿæœºå°†ç¨‹åºè§£é‡Šç»™æœ¬åœ°ç³»ç»Ÿæ‰§è¡Œã€‚ JRE = JVM + libã€‚å…‰æœ‰ JVM è¿˜ä¸èƒ½è®© .class æ–‡ä»¶æ‰§è¡Œï¼Œå› ä¸ºåœ¨è§£é‡Š .class æ–‡ä»¶çš„æ—¶å€™ JVM éœ€è¦è°ƒç”¨è§£é‡Šæ‰€éœ€è¦çš„ç±»åº“ libã€‚åœ¨ JDK çš„å®‰è£…ç›®å½•é‡Œä½ å¯ä»¥æ‰¾åˆ° JRE ç›®å½•ï¼Œé‡Œé¢æœ‰ä¸¤ä¸ªæ–‡ä»¶å¤¹ bin å’Œ libï¼Œåœ¨è¿™é‡Œå¯ä»¥è®¤ä¸º bin é‡Œçš„å°±æ˜¯ jvmï¼Œlib ä¸­åˆ™æ˜¯ JVM å·¥ä½œæ‰€éœ€è¦çš„ç±»åº“ï¼Œæ‰€ä»¥ JVM å’Œ lib å’Œèµ·æ¥å°±ç§°ä¸º JREã€‚ JDK ç›®å½• binï¼šå¼€å‘å·¥å…·ï¼ŒåŒ…å«äº†å¼€å‘ã€æ‰§è¡Œã€è°ƒè¯• Java ç¨‹åºæ‰€ä½¿ç”¨çš„å·¥å…·å’Œå®ç”¨ç¨‹åºï¼Œä»¥åŠå¼€å‘å·¥å…·æ‰€éœ€è¦çš„ç±»åº“å’Œæ”¯æŒæ–‡ä»¶ã€‚ includeï¼šå¤´æ–‡ä»¶ï¼Œå®ƒæ”¯æŒä½¿ç”¨ Java æœ¬åœ°æ¥å£å’Œ Java è™šæ‹Ÿæœºè°ƒè¯•æ¥å£çš„æœ¬åœ°ä»£ç ç¼–ç¨‹ã€‚ jreï¼šè¿è¡Œç¯å¢ƒï¼Œå®ç°äº† Java è¿è¡Œç¯å¢ƒã€‚æ˜¯è¿è¡Œ Java ç¨‹åºæ‰€å¿…é¡»çš„ç¯å¢ƒã€‚JRE åŒ…å«äº† Java è™šæ‹Ÿæœº JavaTM Virtual Machine(JVM)ã€Java æ ¸å¿ƒç±»åº“å’Œæ”¯æŒæ–‡ä»¶ã€‚å¦‚æœåªè¿è¡Œ Java ç¨‹åºï¼Œåˆ™åªéœ€è¦å®‰è£… JREã€‚å¦‚éœ€å¼€å‘ Java ç¨‹åºï¼Œåˆ™éœ€å®‰è£… JDKã€‚JDK ä¸­åŒ…å«äº† JREã€‚ libï¼šåŒ…æ‹¬äº† Java å¼€å‘ç¯å¢ƒçš„ Jar åŒ…ï¼Œæ˜¯ç»™ JDK ç”¨çš„ã€‚ä¾‹å¦‚ JDK ä¸‹æœ‰ä¸€äº›å·¥å…·ï¼Œå¯èƒ½è¦ç”¨è¯¥ç›®å½•ä¸­çš„æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼Œç¼–è¯‘å™¨ç­‰ã€‚ src.zipï¼šæ„æˆ Java æ ¸å¿ƒ API çš„æ‰€æœ‰ç±»çš„æºæ–‡ä»¶ï¼ŒåŒ…æ‹¬äº† java.ã€javax. å’ŒæŸäº› org.* åŒ…ä¸­ç±»çš„æºæ–‡ä»¶ï¼Œä¸åŒ…å« com.sun.* åŒ…ä¸­ç±»çš„æºæ–‡ä»¶ã€‚ éªŒè¯å®‰è£… é…ç½®ç¯å¢ƒå˜é‡æ–°å»ºï¼šJAVA_HOME = [JDK å®‰è£…ç›®å½•]ç¼–è¾‘æ·»åŠ ï¼šclasspath = %JAVA_HOME%/lib/dt.jar;%JAVA_HOME%/lib/tools.jar;.;ç¼–è¾‘æ·»åŠ ï¼šPath = %JAVA_HOME%/bin; Path ç¯å¢ƒå˜é‡çš„å€¼å°±æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„çš„åˆ—è¡¨ï¼Œæä¾›ç»™ç³»ç»Ÿå¯»æ‰¾å’Œæ‰§è¡Œåº”ç”¨ç¨‹åºçš„è·¯å¾„ã€‚å½“æ‰§è¡Œä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶æ—¶ï¼Œç³»ç»Ÿé¦–å…ˆåœ¨å½“å‰è·¯å¾„ä¸‹å¯»æ‰¾ï¼Œå¦‚æœªæ‰¾åˆ°ï¼Œåˆ™åˆ° Path ä¸­æŒ‡å®šçš„å„ä¸ªè·¯å¾„ä¸­å»å¯»æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°ä¸ºæ­¢ï¼Œå¦‚æœ Path è·¯å¾„ä¸­ä¹Ÿæ‰¾ä¸åˆ°ï¼Œåˆ™æŠ¥é”™ã€‚Java çš„ç¼–è¯‘å™¨ï¼ˆjavac.exeï¼‰å’Œè§£é‡Šå™¨ï¼ˆjava.exeï¼‰éƒ½åœ¨å…¶å®‰è£…è·¯å¾„ä¸‹çš„ bin ç›®å½•ä¸­ï¼Œä¸ºäº†åœ¨ä»»ä½•è·¯å¾„ä¸‹éƒ½å¯ä»¥ä½¿ç”¨å®ƒä»¬ç¼–è¯‘æ‰§è¡Œ Java ç¨‹åºï¼Œåº”è¯¥å°†å®ƒä»¬æ‰€åœ¨çš„ç›®å½•æ·»åŠ åˆ° Path å˜é‡ä¸­;classpath ç¯å¢ƒå˜é‡æŒ‡å®šäº† Java ç¨‹åºç¼–è¯‘æˆ–è¿è¡Œæ—¶æ‰€ç”¨åˆ°çš„ç±»çš„æœç´¢åˆ—è¡¨ã€‚Java è™šæ‹ŸæœºæŸ¥æ‰¾ç±»çš„è¿‡ç¨‹ä¸åŒäº Windows æŸ¥æ‰¾å¯æ‰§è¡Œå‘½ä»¤ï¼ˆ.exeã€.bat æˆ– .cmd ä»¥åŠ .dll åŠ¨æ€é“¾æ¥åº“ï¼‰çš„è¿‡ç¨‹ã€‚å®ƒä¸åœ¨å½“å‰è·¯å¾„ä¸‹å¯»æ‰¾ï¼Œåªåˆ° classpath æŒ‡å®šçš„è·¯å¾„åˆ—è¡¨ä¸­å»å¯»æ‰¾ï¼Œæ‰€ä»¥åœ¨è®¾å®šç¯å¢ƒå˜é‡æ—¶ä¸€å®šè¦æŠŠå½“å‰è·¯å¾„åŒ…å«è¿›æ¥ã€‚å˜é‡ä¸­çš„â€œ.â€ä»£è¡¨å½“å‰è·¯å¾„ï¼Œè¡¨ç¤º Java è™šæ‹Ÿæœºå…ˆåˆ°å½“å‰è·¯å¾„ä¸‹å»æŸ¥æ‰¾è¦ä½¿ç”¨çš„ç±»ï¼Œå½“å‰è·¯å¾„æŒ‡ Java è™šæ‹Ÿæœºè¿è¡Œæ—¶çš„å½“å‰å·¥ä½œç›®å½•;3ã€JAVA_HOME çš„å€¼å°±æ˜¯ JDK å®‰è£…è·¯å¾„çš„å€¼ã€‚å½“éœ€è¦ä½¿ç”¨ JDK è·¯å¾„æ—¶ï¼Œç›´æ¥ç”¨ %JAVA_HOME% çš„æ–¹å¼å¼•ç”¨ï¼Œæ–¹ä¾¿ç®€å•ã€‚å¦‚æœ JDK çš„å®‰è£…è·¯å¾„å‘ç”Ÿäº†å˜åŒ–æˆ–è€…å®‰è£…äº†æ–°ç‰ˆæœ¬çš„ JDKï¼Œåªéœ€ä¿®æ”¹ JAVA_HOME çš„å€¼å³å¯ï¼Œå…¶å®ƒå¼•ç”¨ JAVA_HOME çš„åœ°æ–¹ä¸éœ€è¦ä¿®æ”¹ã€‚ æµ‹è¯•è¿è¡Œ Java ç¨‹åºæ–°å»º HelloWorld.java æ–‡ä»¶ã€‚ 12345public class HelloWorld &#123; public static void main(String[] args) &#123; System.out.println(\"Hello World!\"); &#125;&#125; ç¼–è¯‘è§£é‡Šè¿è¡Œã€‚ javac HelloWorld.javaçš„æ„æ€æ˜¯ç¼–è¯‘ HelloWorld.java æ–‡ä»¶ï¼Œå¹¶ç”Ÿæˆ HelloWorld.class å­—èŠ‚ç æ–‡ä»¶ã€‚ java HelloWorld çš„æ„æ€æ˜¯è¿è¡Œå­—èŠ‚ç æ–‡ä»¶ HelloWorld.classï¼Œè¿è¡Œçš„æ—¶å€™å¹¶ä¸éœ€è¦è¾“å…¥ .class åç¼€ã€‚ è¿è¡ŒæˆåŠŸåè¾“å‡ºç»“æœï¼šHello World! MySQL å®‰è£…å®˜ç½‘ä¸‹è½½ï¼šMySQL Installer 8.0.19 äº‘ç›˜èµ„æºä¸‹è½½ï¼šmysql-installer-community-8.0.19.0.msi ä¸‹è½½ MSI ç‰ˆæœ¬ï¼Œç›´æ¥å®‰è£…ï¼ŒMSI ç‰ˆæœ¬å®‰è£…çš„å¥½å¤„æ˜¯ä¸ç”¨æ‰‹åŠ¨é…ç½®ç¯å¢ƒå˜é‡ï¼Œå’Œä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œæ•´ä¸ªå®‰è£…è¿‡ç¨‹åªéœ€è¦ç‚¹å‡»ä¸‹ä¸€æ­¥å³å¯ã€‚ å®‰è£…ç‰ˆæœ¬åˆ†åœ¨çº¿å®‰è£…ç‰ˆæœ¬å’Œç¦»çº¿å®‰è£…ç‰ˆæœ¬ï¼Œè¿™é‡Œé€‰æ‹©ç¦»çº¿å®‰è£…ç‰ˆæœ¬ï¼Œæ•´ä¸ªå®‰è£…è¿‡ç¨‹ä¼šæ¯”è¾ƒæµç•…ã€‚è€Œåœ¨çº¿å®‰è£…åœ¨ç½‘ç»œä¸ä½³çš„æƒ…å†µä¸‹å¯èƒ½ä¼šç‰¹åˆ«æ…¢ã€‚ è¿è¡Œå®‰è£…åŒ…ï¼Œé€‰æ‹© Full æ¨¡å¼å®‰è£… æµ‹è¯•æ¨¡å¼ä¸‹ï¼Œä¸ºäº†å…¼å®¹è€ç‰ˆæœ¬çš„å¼€å‘å·¥å…·ä»¥åŠ jar åŒ…ï¼Œé€‰æ‹©ä¼ ç»Ÿæˆæƒæ–¹æ³•ï¼ˆMySQL 5.xï¼‰ã€‚ å¼ºå¯†ç åŠ å¯†æ–¹æ³•ï¼ˆMySQL 8.0ï¼‰é‡‡ç”¨äº†æ–°çš„å¯†ç åŠ å¯†æ–¹å¼ï¼Œä¹Ÿå°±æ„å‘³ç€è€ç‰ˆæœ¬çš„æ•°æ®åº“è®¿é—®å®¢æˆ·ç«¯ç‰ˆæœ¬ä¹Ÿè¦æ›´æ–°åˆ°æ”¯æŒçš„ç‰ˆæœ¬ã€‚ æ£€æµ‹æ˜¯å¦èƒ½è¿æ¥ä¸Š MySQL æœåŠ¡å™¨ã€‚ å®‰è£…å®Œæˆã€‚services.mscæŸ¥çœ‹ MySQL æœåŠ¡æ˜¯å¦å·²ç»å¯åŠ¨ï¼Œå¹¶åˆ©ç”¨ SQLyog è®¿é—®æ•°æ®åº“ã€‚ Tomcat å®‰è£…å®˜ç½‘ä¸‹è½½ï¼šapache-tomcat-8.5.51.exe è¿è¡Œå®‰è£…åŒ…ã€‚ ä¸‹è½½å®Œæˆåï¼Œæ¥åˆ°å®‰è£…ç›®å½•ã€‚å¯ä»¥çœ‹åˆ° Tomcat æœåŠ¡å·²ç»å¯åŠ¨ã€‚ï¼ˆå¯ç”¨ startup / showdown.bat æ¥å¯åŠ¨ / å…³é—­æœåŠ¡ï¼‰ é€šè¿‡è„šæœ¬å¯åŠ¨æœåŠ¡åå‘ç°è¾“å‡ºçš„æ—¥å¿—ä¸­å­˜åœ¨ä¹±ç ã€‚åˆ°å®‰è£…ç›®å½•ä¸‹çš„ bin æ–‡ä»¶å¤¹ä¸­ç¼–è¾‘ logging.properties é…ç½®æ–‡ä»¶ã€‚ é‡å¯ Tomcat æœåŠ¡å™¨ï¼Œæ—¥å¿—è¾“å‡ºæ­£å¸¸ã€‚æˆåŠŸè®¿é—® localhost:8080ã€‚ IDEA å®‰è£…å®˜ç½‘ä¸‹è½½ï¼šIntelliJ IDEA äº‘ç›˜èµ„æºä¸‹è½½ï¼šIntelliJ-2019.1.4.exe IDEA çš„å®‰è£…å’Œé…ç½®ï¼šç‚¹å‡»è¿›å…¥ Maven çš„å®‰è£…å’Œé…ç½®ï¼šç‚¹å‡»è¿›å…¥ IDEA å¸¸ç”¨æ’ä»¶ä»‹ç»ï¼ˆUpdatingï¼‰PSï¼šé‡åˆ°ä½¿ç”¨åœºæ™¯åæŒç»­æ›´æ–°å„æ’ä»¶ç”¨æ³•ã€‚ Setting â†’ Plugins ä¸‹æœç´¢å¹¶ä¸‹è½½æ’ä»¶ GitToolBox æä¾› Git çš„ä¸€äº›æ“ä½œï¼Œå¯ä»¥è®¾ç½®æ—¶é—´é—´éš”æ¥æ¯”å¯¹æœ¬åœ°ä»£ç å’ŒæœåŠ¡å™¨ä¸Šä»£ç æœ‰å¤šå°‘ä¸åŒï¼Œè¿™æ ·å¯ä»¥åœ¨æäº¤ä»£ç å…ˆè¿›è¡Œä»£ç çš„æ›´æ–°ã€‚ Findbugs-IDEA æ­¤æ’ä»¶ä»…æ”¯æŒåˆ° 2018.1.8 ç‰ˆæœ¬çš„ IDEAã€‚ PMD æ˜¯ä¸€ä¸ªé™æ€ä»£ç æ£€æµ‹å·¥å…·ï¼Œè¾…åŠ©æˆ‘ä»¬æ£€æµ‹æ½œåœ¨bugçš„å·¥å…·ï¼Œå¤§å¤§å‡å°‘äº†äººå·¥å®¡æŸ¥æˆæœ¬ï¼Œæé«˜ç¼–ç æ•ˆç‡ã€‚ Alibaba Java Coding Guidelines å¿«æ·é”®Ctrl+Shift+Alt+Jï¼Œç¼–ç è§„çº¦æ‰«æã€‚ Lomboké¡¹ç›®ä¸­ç»å¸¸ä½¿ç”¨ beanï¼Œentity ç­‰ç±»ï¼Œç»å¤§éƒ¨åˆ†æ•°æ®ç±»ç±»ä¸­éƒ½éœ€è¦ getã€setã€toStringã€equals å’Œ hashCode æ–¹æ³•ï¼Œè™½ç„¶ eclipse å’Œ idea å¼€å‘ç¯å¢ƒä¸‹éƒ½æœ‰è‡ªåŠ¨ç”Ÿæˆçš„å¿«æ·æ–¹å¼ï¼Œä½†è‡ªåŠ¨ç”Ÿæˆè¿™äº›ä»£ç åï¼Œå¦‚æœ bean ä¸­çš„å±æ€§ä¸€æ—¦æœ‰ä¿®æ”¹ã€åˆ é™¤æˆ–å¢åŠ æ—¶ï¼Œéœ€è¦é‡æ–°ç”Ÿæˆæˆ–åˆ é™¤ get / set ç­‰æ–¹æ³•ï¼Œç»™ä»£ç ç»´æŠ¤å¢åŠ è´Ÿæ‹…ã€‚è€Œä½¿ç”¨äº† lombok åˆ™ä¸ä¸€æ ·ï¼Œä½¿ç”¨äº† lombok çš„æ³¨è§£ï¼ˆ@Setterï¼Œ@Getterï¼Œ@ToStringï¼Œ@@RequiredArgsConstructorï¼Œ@EqualsAndHashCodeï¼Œ@Dataï¼‰ä¹‹åï¼Œå°±ä¸éœ€è¦ç¼–å†™æˆ–ç”Ÿæˆ get / set ç­‰æ–¹æ³•ï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šå‡å°‘äº†ä»£ç é‡ï¼Œè€Œä¸”å‡å°‘äº†ä»£ç ç»´æŠ¤çš„è´Ÿæ‹…ã€‚æ•…å¼ºçƒˆå»ºè®®é¡¹ç›®ä¸­ä½¿ç”¨ lombokï¼Œå»æ‰ bean ä¸­ getã€setã€toStringã€equals å’Œ hashCode ç­‰æ–¹æ³•çš„ä»£ç ã€‚ pom.xml ä¸­æ·»åŠ  Lombok ä¾èµ– 12345&lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;version&gt;1.16.10&lt;/version&gt;&lt;/dependency&gt; ç¤ºä¾‹ä»£ç  1234567891011121314151617package com.lombok.demo; import lombok.EqualsAndHashCode;import lombok.Getter;import lombok.Setter;import lombok.ToString;@Setter@Getter@ToString@EqualsAndHashCodepublic class Student &#123; private String name; private int age; private String male;&#125; æµ‹è¯•ç±» 1234567891011121314151617181920212223242526272829package com.lombok.demo; import lombok.extern.java.Log; // çœç•¥äº† private static final ogger log = Logger.getLogger(LogExample.class.getName());@Logpublic class LombokTest &#123; public static void main(String[] args) &#123; Student student = new Student(); student.setAge(23); student.setMale(\"man\"); student.setName(\"wingo\"); System.out.println(student.toString()); Student student2 = new Student(); student2.setAge(23); student2.setMale(\"man\"); student2.setName(\"wingo\"); System.out.println(student.equals(student2)); student2.setAge(\"24\"); System.out.println(student.equals(student2)); log.info(\"lombok test\"); &#125;&#125; æµ‹è¯•ç»“æœ 1234Student(name&#x3D;wingo, age&#x3D;23, male&#x3D;man)truefalselombok test SonarLint ä»£ç åˆ†æå·¥å…·ï¼Œèƒ½å¤Ÿåœ¨ç¼–ç çš„é˜¶æ®µå®æ—¶æ£€æŸ¥ä»£ç ï¼Œå¹¶ä¸”åœ¨ä»£ç æäº¤å‰åšæ£€æŸ¥ç­‰ï¼ŒæŠŠå­˜åœ¨çš„é—®é¢˜æå‰æš´éœ²ï¼Œæé«˜ä»£ç è´¨é‡ã€‚ .ignore åœ¨é¡¹ç›®ä¸Šå³é”® â†’ New â†’ .ignore file â†’ .gitignore file(Git)ï¼Œå¿½ç•¥ä¸éœ€è¦æäº¤çš„æ–‡ä»¶ã€‚ Maven Helper æŸ¥çœ‹ Maven çš„å†²çªä¸ä¾èµ–ã€‚ Acejump å¿«é€Ÿå…‰æ ‡è·³è½¬æ–¹å¼ã€‚ RestfulToolkit æ¥å£æµ‹è¯•å·¥å…·ã€‚ CodeGlance åœ¨ä»£ç çš„å³ä¾§æ˜¾ç¤ºä»£ç å°åœ°å›¾ã€‚ MyBatis Log Plugin æ§åˆ¶å°æ‰“å° MyBatis è„šæœ¬æ—¥å¿—ã€‚ String Manipulation å¼ºå¤§çš„å­—ç¬¦ä¸²è½¬æ¢å·¥å…·ã€‚ GsonForma Json å®åŠ›ç±»å¿«é€Ÿç”Ÿæˆå·¥å…·ã€‚ JUnitGenerator V2.0 å¸®åŠ©ç”Ÿæˆå•å…ƒæµ‹è¯•å·¥å…·ã€‚ JRebel çƒ­éƒ¨ç½²æ’ä»¶ã€‚å®Œå…¨ä¸ç”¨é‡å¯æœåŠ¡å™¨ï¼Œå¼€å‘åç«¯å’Œå‰ç«¯ä¸€æ ·ã€‚åŒ…æ‹¬æ·»åŠ ç±»ï¼Œæ–¹æ³•ï¼Œæ³¨è§£ï¼Œä¿®æ”¹ xml å’Œ properies æ–‡ä»¶ã€‚ Translation GenerateAllSetter CodeMaker ä»£ç ç”Ÿæˆæ’ä»¶ã€‚æ”¯æŒå¢åŠ è‡ªå®šä¹‰ä»£ç æ¨¡æ¿ï¼ˆVelocityï¼‰ï¼›æ”¯æŒé€‰æ‹©å¤šä¸ªç±»ä½œä¸ºä»£ç æ¨¡æ¿çš„ä¸Šä¸‹æ–‡ã€‚ Grep Console å¯ä»¥è®¾ç½®ä¸åŒçº§åˆ«logçš„å­—ä½“é¢œè‰²å’ŒèƒŒæ™¯è‰²ã€‚ Key Promoter X å¿«æ·é”®æç¤ºå·¥å…·ã€‚å½“ä½ åœ¨ IDEA é‡Œé¢ä½¿ç”¨é¼ æ ‡çš„æ—¶å€™ï¼Œå¦‚æœè¿™ä¸ªé¼ æ ‡æ“ä½œæ˜¯èƒ½å¤Ÿç”¨å¿«æ·é”®æ›¿ä»£çš„ï¼Œé‚£ä¹ˆ Key Promoter X ä¼šå¼¹å‡ºä¸€ä¸ªæç¤ºæ¡†ï¼Œå‘ŠçŸ¥ä½ è¿™ä¸ªé¼ æ ‡æ“ä½œå¯ä»¥ç”¨ä»€ä¹ˆå¿«æ·é”®æ›¿ä»£ã€‚ Swipï¼ˆSpring Web Initializrï¼‰ IdeaVim åœ¨ Intellij ä¸­æ¨¡æ‹Ÿ Vim çš„æ“ä½œæ–¹å¼ã€‚ BashSupport IEDA ä¸­çš„ BashSupport æ’ä»¶æ”¯æŒåœ¨IDEAä¸­ç¼–å†™shellè„šæœ¬æ–‡ä»¶ï¼Œæœ‰å‹å¥½çš„ä»£ç æ ¼å¼ï¼Œæ”¯æŒè‡ªåŠ¨è¡¥å…¨ï¼Œæ£€æŸ¥é”™è¯¯ï¼Œå¹¶ä¸”é…ç½®å®Œä¹‹åï¼Œè¿˜å¯ä»¥åœ¨IEDAä¸­ç›´æ¥è¿è¡Œshellè„šæœ¬ EduTools ä½¿ç”¨ EduToolsï¼Œæ‚¨å¯ä»¥é€šè¿‡ä»£ç ç»ƒä¹ ä»»åŠ¡æ¥å­¦ä¹ å’Œæ•™å¯¼ Kotlin","categories":[{"name":"Welab","slug":"Welab","permalink":"http://yoursite.com/categories/Welab/"}],"tags":[{"name":"Env","slug":"Env","permalink":"http://yoursite.com/tags/Env/"}]},{"title":"Git å‘½ä»¤æ¸…å•","slug":"Software/Git å‘½ä»¤æ¸…å•","date":"2020-02-15T07:17:45.000Z","updated":"2020-04-19T06:41:15.261Z","comments":true,"path":"2020/02/15/Software/Git å‘½ä»¤æ¸…å•/","link":"","permalink":"http://yoursite.com/2020/02/15/Software/Git%20%E5%91%BD%E4%BB%A4%E6%B8%85%E5%8D%95/","excerpt":"Git å¯¹äºç¨‹åºå‘˜å¯ä»¥è¯´ä½¿ä¸€é¡¹å¿…å¤‡çš„æŠ€èƒ½ï¼Œæ•…åˆ—æ­¤æ¸…å•æ–¹ä¾¿æŸ¥è¯¢ã€‚","text":"Git å¯¹äºç¨‹åºå‘˜å¯ä»¥è¯´ä½¿ä¸€é¡¹å¿…å¤‡çš„æŠ€èƒ½ï¼Œæ•…åˆ—æ­¤æ¸…å•æ–¹ä¾¿æŸ¥è¯¢ã€‚ è½¬è½½è‡ªï¼šé˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿— â†’ å¸¸ç”¨ Git å‘½ä»¤æ¸…å• Git æ“ä½œæµç¨‹ Workspaceï¼šå·¥ä½œåŒºï¼› Index / Stageï¼šæš‚å­˜åŒºï¼› Repositoryï¼šæœ¬åœ°ä»“åº“ï¼› Remoteï¼šè¿œç¨‹ä»“åº“ã€‚ æ–°å»ºä»£ç åº“12345678# åœ¨å½“å‰ç›®å½•æ–°å»ºä¸€ä¸ª Git ä»£ç åº“git init# æ–°å»ºä¸€ä¸ªç›®å½•ï¼Œå°†å…¶åˆå§‹åŒ–ä¸º Git ä»£ç åº“git init [project-name]# ä¸‹è½½ä¸€ä¸ªé¡¹ç›®å’Œå®ƒçš„æ•´ä¸ªä»£ç å†å²git clone [url] é…ç½®Git çš„è®¾ç½®æ–‡ä»¶ä¸º.gitconfigï¼Œå®ƒå¯ä»¥åœ¨ç”¨æˆ·ä¸»ç›®å½•ä¸‹ï¼ˆå…¨å±€é…ç½®ï¼‰ï¼Œä¹Ÿå¯ä»¥åœ¨é¡¹ç›®ç›®å½•ä¸‹ï¼ˆé¡¹ç›®é…ç½®ï¼‰ã€‚ 123456789101112# æ˜¾ç¤ºå½“å‰çš„ Git é…ç½®git config --list# ç¼–è¾‘ Git é…ç½®æ–‡ä»¶git config -e [--global]# æŸ¥çœ‹ Git é…ç½®æ–‡ä»¶git config -l# è®¾ç½®æäº¤ä»£ç æ—¶çš„ç”¨æˆ·ä¿¡æ¯git config [--global] user.name \"[name]\"git config [--global] user.email \"[email address]\" æ–‡ä»¶æ“ä½œ123456789101112131415161718192021# æ·»åŠ æŒ‡å®šæ–‡ä»¶åˆ°æš‚å­˜åŒºgit add [file1] [file2] ...# æ·»åŠ æŒ‡å®šç›®å½•åˆ°æš‚å­˜åŒºï¼ŒåŒ…æ‹¬å­ç›®å½•git add [dir]# æ·»åŠ å½“å‰ç›®å½•çš„æ‰€æœ‰æ–‡ä»¶åˆ°æš‚å­˜åŒºgit add .# æ·»åŠ æ¯ä¸ªå˜åŒ–å‰ï¼Œéƒ½ä¼šè¦æ±‚ç¡®è®¤# å¯¹äºåŒä¸€ä¸ªæ–‡ä»¶çš„å¤šå¤„å˜åŒ–ï¼Œå¯ä»¥å®ç°åˆ†æ¬¡æäº¤git add -p# åˆ é™¤å·¥ä½œåŒºæ–‡ä»¶ï¼Œå¹¶ä¸”å°†è¿™æ¬¡åˆ é™¤æ”¾å…¥æš‚å­˜åŒºgit rm [file1] [file2] ...# åœæ­¢è¿½è¸ªæŒ‡å®šæ–‡ä»¶ï¼Œä½†è¯¥æ–‡ä»¶ä¼šä¿ç•™åœ¨å·¥ä½œåŒºgit rm --cached [file]# æ”¹åæ–‡ä»¶ï¼Œå¹¶ä¸”å°†è¿™ä¸ªæ”¹åæ”¾å…¥æš‚å­˜åŒºgit mv [file-original] [file-renamed] ä»£ç æäº¤123456789101112131415161718# æäº¤æš‚å­˜åŒºåˆ°ä»“åº“åŒºgit commit -m [message]# æäº¤æš‚å­˜åŒºçš„æŒ‡å®šæ–‡ä»¶åˆ°ä»“åº“åŒºgit commit [file1] [file2] ... -m [message]# æäº¤å·¥ä½œåŒºè‡ªä¸Šæ¬¡ commit ä¹‹åçš„å˜åŒ–ï¼Œç›´æ¥åˆ°ä»“åº“åŒºgit commit -a# æäº¤æ—¶æ˜¾ç¤ºæ‰€æœ‰ diff ä¿¡æ¯git commit -v# ä½¿ç”¨ä¸€æ¬¡æ–°çš„ commitï¼Œæ›¿ä»£ä¸Šä¸€æ¬¡æäº¤# å¦‚æœä»£ç æ²¡æœ‰ä»»ä½•æ–°å˜åŒ–ï¼Œåˆ™ç”¨æ¥æ”¹å†™ä¸Šä¸€æ¬¡ commit çš„æäº¤ä¿¡æ¯git commit --amend -m [message]# é‡åšä¸Šä¸€æ¬¡commitï¼Œå¹¶åŒ…æ‹¬æŒ‡å®šæ–‡ä»¶çš„æ–°å˜åŒ–git commit --amend [file1] [file2] ... åˆ†æ”¯åˆ†æ”¯ä»‹ç»åˆ†æ”¯æ˜¯ä¸ºäº†å°†ä¿®æ”¹è®°å½•çš„æ•´ä½“æµç¨‹åˆ†å‰ä¿å­˜ã€‚åˆ†å‰åçš„åˆ†æ”¯ä¸å—å…¶ä»–åˆ†æ”¯çš„å½±å“ï¼Œæ‰€ä»¥åœ¨åŒä¸€ä¸ªæ•°æ®åº“é‡Œå¯ä»¥åŒæ—¶è¿›è¡Œå¤šä¸ªä¿®æ”¹ã€‚ åˆ†å‰çš„åˆ†æ”¯æ˜¯å¯ä»¥åˆå¹¶çš„ã€‚ master åˆ†æ”¯ï¼šåœ¨æ•°æ®åº“è¿›è¡Œæœ€åˆçš„æäº¤å, Git ä¼šåˆ›å»ºä¸€ä¸ªåä¸º master çš„åˆ†æ”¯ã€‚å› æ­¤ä¹‹åçš„æäº¤ï¼Œåœ¨åˆ‡æ¢åˆ†æ”¯ä¹‹å‰éƒ½ä¼šæ·»åŠ åˆ° master åˆ†æ”¯é‡Œã€‚ åˆ†æ”¯çš„è¿ç”¨Merge åˆ†æ”¯ï¼šMerge åˆ†æ”¯æ˜¯ä¸ºäº†å¯ä»¥éšæ—¶å‘å¸ƒ release è€Œåˆ›å»ºçš„åˆ†æ”¯ï¼Œå®ƒè¿˜èƒ½ä½œä¸º Topic åˆ†æ”¯çš„æºåˆ†æ”¯ä½¿ç”¨ã€‚é€šå¸¸ï¼Œå¤§å®¶ä¼šå°† master åˆ†æ”¯å½“ä½œ Merge åˆ†æ”¯ä½¿ç”¨ã€‚ Topic åˆ†æ”¯ï¼šTopic åˆ†æ”¯æ˜¯ä¸ºäº†å¼€å‘æ–°åŠŸèƒ½æˆ–ä¿®å¤ Bug ç­‰ä»»åŠ¡è€Œå»ºç«‹çš„åˆ†æ”¯ã€‚è‹¥è¦åŒæ—¶è¿›è¡Œå¤šä¸ªçš„ä»»åŠ¡ï¼Œè¯·åˆ›å»ºå¤šä¸ªçš„ Topic åˆ†æ”¯ã€‚Topic åˆ†æ”¯æ˜¯ä»ç¨³å®šçš„ Merge åˆ†æ”¯åˆ›å»ºçš„ã€‚å®Œæˆä½œä¸šåï¼Œè¦æŠŠ Topic åˆ†æ”¯åˆå¹¶å› Merge åˆ†æ”¯ã€‚ åˆ†æ”¯æ“ä½œå®ä¾‹æ–°å»ºä»“åº“12345mkdir testcd testgit initgit add myfile.txtgit commit -m \"first commit\" æ–°å»ºåˆ†æ”¯12345# åˆ›å»ºåˆ†æ”¯git branch test01# æ˜¾ç¤ºåˆ†æ”¯åˆ—è¡¨# å¸¦*çš„å°±æ˜¯ç°åœ¨çš„åˆ†æ”¯git branch åˆ‡æ¢åˆ†æ”¯12345# åˆ‡æ¢åˆ†æ”¯git checkout test01Switched to branch 'issue1'git add myfile.txtgit commit -m \"æ·»åŠ addçš„è¯´æ˜\" åˆå¹¶åˆ†æ”¯123git checkout masterSwitched to branch 'master'git merge test01 master åˆ†æ”¯æŒ‡å‘çš„æäº¤ç§»åŠ¨åˆ°å’Œ test01 åŒæ ·çš„ä½ç½®ã€‚è¿™ä¸ªæ˜¯ fast-forwardï¼ˆå¿«è¿›ï¼‰åˆå¹¶ã€‚ å¸¸ç”¨å‘½ä»¤123456789101112131415161718192021222324252627282930313233343536373839404142434445# åˆ—å‡ºæ‰€æœ‰æœ¬åœ°åˆ†æ”¯git branch# åˆ—å‡ºæ‰€æœ‰è¿œç¨‹åˆ†æ”¯git branch -r# åˆ—å‡ºæ‰€æœ‰æœ¬åœ°åˆ†æ”¯å’Œè¿œç¨‹åˆ†æ”¯git branch -a# æ–°å»ºä¸€ä¸ªåˆ†æ”¯ï¼Œä½†ä¾ç„¶åœç•™åœ¨å½“å‰åˆ†æ”¯git branch [branch-name]# æ–°å»ºä¸€ä¸ªåˆ†æ”¯ï¼Œå¹¶åˆ‡æ¢åˆ°è¯¥åˆ†æ”¯git checkout -b [branch]# æ–°å»ºä¸€ä¸ªåˆ†æ”¯ï¼ŒæŒ‡å‘æŒ‡å®šcommitgit branch [branch] [commit]# æ–°å»ºä¸€ä¸ªåˆ†æ”¯ï¼Œä¸æŒ‡å®šçš„è¿œç¨‹åˆ†æ”¯å»ºç«‹è¿½è¸ªå…³ç³»git branch --track [branch] [remote-branch]# åˆ‡æ¢åˆ°æŒ‡å®šåˆ†æ”¯ï¼Œå¹¶æ›´æ–°å·¥ä½œåŒºgit checkout [branch-name]# åˆ‡æ¢åˆ°ä¸Šä¸€ä¸ªåˆ†æ”¯git checkout -# å»ºç«‹è¿½è¸ªå…³ç³»ï¼Œåœ¨ç°æœ‰åˆ†æ”¯ä¸æŒ‡å®šçš„è¿œç¨‹åˆ†æ”¯ä¹‹é—´git branch --set-upstream [branch] [remote-branch]# åˆå¹¶æŒ‡å®šåˆ†æ”¯åˆ°å½“å‰åˆ†æ”¯git merge [branch]# é€‰æ‹©ä¸€ä¸ªcommitï¼Œåˆå¹¶è¿›å½“å‰åˆ†æ”¯git cherry-pick [commit]# åˆ é™¤åˆ†æ”¯git branch -d [branch-name]# æäº¤è¿œç¨‹åˆ†æ”¯git push origin [branch-name]# åˆ é™¤è¿œç¨‹åˆ†æ”¯git push origin --delete [branch-name]git branch -dr [remote/branch] æ ‡ç­¾1234567891011121314151617181920212223242526# åˆ—å‡ºæ‰€æœ‰taggit tag# æ–°å»ºä¸€ä¸ªtagåœ¨å½“å‰commitgit tag [tag]# æ–°å»ºä¸€ä¸ªtagåœ¨æŒ‡å®šcommitgit tag [tag] [commit]# åˆ é™¤æœ¬åœ°taggit tag -d [tag]# åˆ é™¤è¿œç¨‹taggit push origin :refs/tags/[tagName]# æŸ¥çœ‹tagä¿¡æ¯git show [tag]# æäº¤æŒ‡å®štaggit push [remote] [tag]# æäº¤æ‰€æœ‰taggit push [remote] --tags# æ–°å»ºä¸€ä¸ªåˆ†æ”¯ï¼ŒæŒ‡å‘æŸä¸ªtaggit checkout -b [branch] [tag] æŸ¥çœ‹ä¿¡æ¯123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960# æ˜¾ç¤ºæœ‰å˜æ›´çš„æ–‡ä»¶git status# æ˜¾ç¤ºå½“å‰åˆ†æ”¯çš„ç‰ˆæœ¬å†å²git log# æ˜¾ç¤ºcommitå†å²ï¼Œä»¥åŠæ¯æ¬¡commitå‘ç”Ÿå˜æ›´çš„æ–‡ä»¶git log --stat# æœç´¢æäº¤å†å²ï¼Œæ ¹æ®å…³é”®è¯git log -S [keyword]# æ˜¾ç¤ºæŸä¸ªcommitä¹‹åçš„æ‰€æœ‰å˜åŠ¨ï¼Œæ¯ä¸ªcommitå æ®ä¸€è¡Œgit log [tag] HEAD --pretty=format:%s# æ˜¾ç¤ºæŸä¸ªcommitä¹‹åçš„æ‰€æœ‰å˜åŠ¨ï¼Œå…¶\"æäº¤è¯´æ˜\"å¿…é¡»ç¬¦åˆæœç´¢æ¡ä»¶git log [tag] HEAD --grep feature# æ˜¾ç¤ºæŸä¸ªæ–‡ä»¶çš„ç‰ˆæœ¬å†å²ï¼ŒåŒ…æ‹¬æ–‡ä»¶æ”¹ågit log --follow [file]git whatchanged [file]# æ˜¾ç¤ºæŒ‡å®šæ–‡ä»¶ç›¸å…³çš„æ¯ä¸€æ¬¡diffgit log -p [file]# æ˜¾ç¤ºè¿‡å»5æ¬¡æäº¤git log -5 --pretty --oneline# æ˜¾ç¤ºæ‰€æœ‰æäº¤è¿‡çš„ç”¨æˆ·ï¼ŒæŒ‰æäº¤æ¬¡æ•°æ’åºgit shortlog -sn# æ˜¾ç¤ºæŒ‡å®šæ–‡ä»¶æ˜¯ä»€ä¹ˆäººåœ¨ä»€ä¹ˆæ—¶é—´ä¿®æ”¹è¿‡git blame [file]# æ˜¾ç¤ºæš‚å­˜åŒºå’Œå·¥ä½œåŒºçš„å·®å¼‚git diff# æ˜¾ç¤ºæš‚å­˜åŒºå’Œä¸Šä¸€ä¸ªcommitçš„å·®å¼‚git diff --cached [file]# æ˜¾ç¤ºå·¥ä½œåŒºä¸å½“å‰åˆ†æ”¯æœ€æ–°commitä¹‹é—´çš„å·®å¼‚git diff HEAD# æ˜¾ç¤ºä¸¤æ¬¡æäº¤ä¹‹é—´çš„å·®å¼‚git diff [first-branch]...[second-branch]# æ˜¾ç¤ºä»Šå¤©ä½ å†™äº†å¤šå°‘è¡Œä»£ç git diff --shortstat \"@&#123;0 day ago&#125;\"# æ˜¾ç¤ºæŸæ¬¡æäº¤çš„å…ƒæ•°æ®å’Œå†…å®¹å˜åŒ–git show [commit]# æ˜¾ç¤ºæŸæ¬¡æäº¤å‘ç”Ÿå˜åŒ–çš„æ–‡ä»¶git show --name-only [commit]# æ˜¾ç¤ºæŸæ¬¡æäº¤æ—¶ï¼ŒæŸä¸ªæ–‡ä»¶çš„å†…å®¹git show [commit]:[filename]# æ˜¾ç¤ºå½“å‰åˆ†æ”¯çš„æœ€è¿‘å‡ æ¬¡æäº¤git reflog è¿œç¨‹åŒæ­¥1234567891011121314151617181920212223# ä¸‹è½½è¿œç¨‹ä»“åº“çš„æ‰€æœ‰å˜åŠ¨git fetch [remote]# æ˜¾ç¤ºæ‰€æœ‰è¿œç¨‹ä»“åº“git remote -v# æ˜¾ç¤ºæŸä¸ªè¿œç¨‹ä»“åº“çš„ä¿¡æ¯git remote show [remote]# å¢åŠ ä¸€ä¸ªæ–°çš„è¿œç¨‹ä»“åº“ï¼Œå¹¶å‘½ågit remote add [shortname] [url]# å–å›è¿œç¨‹ä»“åº“çš„å˜åŒ–ï¼Œå¹¶ä¸æœ¬åœ°åˆ†æ”¯åˆå¹¶git pull [remote] [branch]# ä¸Šä¼ æœ¬åœ°æŒ‡å®šåˆ†æ”¯åˆ°è¿œç¨‹ä»“åº“git push [remote] [branch]# å¼ºè¡Œæ¨é€å½“å‰åˆ†æ”¯åˆ°è¿œç¨‹ä»“åº“ï¼Œå³ä½¿æœ‰å†²çªgit push [remote] --force# æ¨é€æ‰€æœ‰åˆ†æ”¯åˆ°è¿œç¨‹ä»“åº“git push [remote] --all æ’¤é”€12345678910111213141516171819202122232425262728293031# æ¢å¤æš‚å­˜åŒºçš„æŒ‡å®šæ–‡ä»¶åˆ°å·¥ä½œåŒºgit checkout [file]# æ¢å¤æŸä¸ªcommitçš„æŒ‡å®šæ–‡ä»¶åˆ°æš‚å­˜åŒºå’Œå·¥ä½œåŒºgit checkout [commit] [file]# æ¢å¤æš‚å­˜åŒºçš„æ‰€æœ‰æ–‡ä»¶åˆ°å·¥ä½œåŒºgit checkout .# é‡ç½®æš‚å­˜åŒºçš„æŒ‡å®šæ–‡ä»¶ï¼Œä¸ä¸Šä¸€æ¬¡commitä¿æŒä¸€è‡´ï¼Œä½†å·¥ä½œåŒºä¸å˜git reset [file]# é‡ç½®æš‚å­˜åŒºä¸å·¥ä½œåŒºï¼Œä¸ä¸Šä¸€æ¬¡commitä¿æŒä¸€è‡´git reset --hard# é‡ç½®å½“å‰åˆ†æ”¯çš„æŒ‡é’ˆä¸ºæŒ‡å®šcommitï¼ŒåŒæ—¶é‡ç½®æš‚å­˜åŒºï¼Œä½†å·¥ä½œåŒºä¸å˜git reset [commit]# é‡ç½®å½“å‰åˆ†æ”¯çš„HEADä¸ºæŒ‡å®šcommitï¼ŒåŒæ—¶é‡ç½®æš‚å­˜åŒºå’Œå·¥ä½œåŒºï¼Œä¸æŒ‡å®šcommitä¸€è‡´git reset --hard [commit]# é‡ç½®å½“å‰HEADä¸ºæŒ‡å®šcommitï¼Œä½†ä¿æŒæš‚å­˜åŒºå’Œå·¥ä½œåŒºä¸å˜git reset --keep [commit]# æ–°å»ºä¸€ä¸ªcommitï¼Œç”¨æ¥æ’¤é”€æŒ‡å®šcommit# åè€…çš„æ‰€æœ‰å˜åŒ–éƒ½å°†è¢«å‰è€…æŠµæ¶ˆï¼Œå¹¶ä¸”åº”ç”¨åˆ°å½“å‰åˆ†æ”¯git revert [commit]# æš‚æ—¶å°†æœªæäº¤çš„å˜åŒ–ç§»é™¤ï¼Œç¨åå†ç§»å…¥git stashgit stash pop å®é™…é—®é¢˜è§£å†³123456789## åˆ†æ”¯å–å¾—æ›´æ–°åˆ° master æ–‡ä»¶git checkout mastergit pull mastergit checkout wingogit merge master## è¿œç¨‹ä¿®æ”¹åˆ†æ”¯æ–‡ä»¶åçš„æœ¬åœ°æ›´æ–°git reset --hard # å¼ºåˆ¶è¦†ç›–æœ¬åœ°ç‰ˆæœ¬git pull origin wingo # åŒæ­¥è¿œç¨‹çš„åˆ†æ”¯","categories":[{"name":"Software","slug":"Software","permalink":"http://yoursite.com/categories/Software/"}],"tags":[{"name":"Git","slug":"Git","permalink":"http://yoursite.com/tags/Git/"}]},{"title":"å„ç§ä¹±ç é—®é¢˜","slug":"Software/å„ç§ä¹±ç é—®é¢˜","date":"2020-02-01T11:38:54.000Z","updated":"2020-02-15T05:28:24.963Z","comments":true,"path":"2020/02/01/Software/å„ç§ä¹±ç é—®é¢˜/","link":"","permalink":"http://yoursite.com/2020/02/01/Software/%E5%90%84%E7%A7%8D%E4%B9%B1%E7%A0%81%E9%97%AE%E9%A2%98/","excerpt":"åœ¨é¡¹ç›®å¼€å‘ä¸­ï¼Œå› ä¸ºå„ç§è¯­è¨€çš„ç¼–ç ä¸åŒå¸¸å¸¸ä¼šé‡åˆ°å„ç§ä¹±ç çš„é—®é¢˜ï¼Œä»¤äººç³Ÿå¿ƒï¼Œæ•…å†™ä¸€ç¯‡åšå®¢ä¸“é—¨ç”¨äºè®°å½•åšä¸»åœ¨å¼€å‘è¿‡ç¨‹é‡åˆ°çš„å„ç§ä¹±ç é—®é¢˜ã€‚","text":"åœ¨é¡¹ç›®å¼€å‘ä¸­ï¼Œå› ä¸ºå„ç§è¯­è¨€çš„ç¼–ç ä¸åŒå¸¸å¸¸ä¼šé‡åˆ°å„ç§ä¹±ç çš„é—®é¢˜ï¼Œä»¤äººç³Ÿå¿ƒï¼Œæ•…å†™ä¸€ç¯‡åšå®¢ä¸“é—¨ç”¨äºè®°å½•åšä¸»åœ¨å¼€å‘è¿‡ç¨‹é‡åˆ°çš„å„ç§ä¹±ç é—®é¢˜ã€‚ Tomcat æ§åˆ¶å°ä¹±ç åˆ° Tomcat /conf /logging.properties ä¸­ä¿®æ”¹æ­¤é¡¹java.util.logging.ConsoleHandler.encodingä¸º GBKã€‚","categories":[{"name":"Software","slug":"Software","permalink":"http://yoursite.com/categories/Software/"}],"tags":[{"name":"MessyCode","slug":"MessyCode","permalink":"http://yoursite.com/tags/MessyCode/"}]},{"title":"Chatroom ç®€ä»‹","slug":"Chatroom/Chatroom ç®€ä»‹","date":"2020-01-31T04:16:27.000Z","updated":"2020-04-19T06:25:00.977Z","comments":true,"path":"2020/01/31/Chatroom/Chatroom ç®€ä»‹/","link":"","permalink":"http://yoursite.com/2020/01/31/Chatroom/Chatroom%20%E7%AE%80%E4%BB%8B/","excerpt":"ä¸€ä¸ªç½‘é¡µç‰ˆçš„çº¿ä¸ŠèŠå¤©å®¤","text":"ä¸€ä¸ªç½‘é¡µç‰ˆçš„çº¿ä¸ŠèŠå¤©å®¤ é¡¹ç›®åŸºæœ¬æ€è·¯æ­¤é¡¹ç›®ä»¥ Tomcat ä½œä¸ºæ ¸å¿ƒæœåŠ¡å™¨ç”¨äºå¤„ç†å®¢æˆ·ç™»å½•ã€ä¸ªäººä¿¡æ¯ç®¡ç†ç­‰ HTTP ç±»å‹çš„è¯·æ±‚ï¼Œç«¯å£å·ï¼š8080ã€‚ åœ¨ Tomcat æœåŠ¡å™¨ä¸­å¦å¼€ä¸€ä¸ªçº¿ç¨‹å¯åŠ¨ Netty WebSocket æœåŠ¡å™¨ç”¨äºå¤„ç†ç”¨æˆ·æ¶ˆæ¯é€šä¿¡çš„ WebSocket ç±»å‹çš„è¯·æ±‚ï¼Œç«¯å£å·ï¼š3333ã€‚ ç”¨æˆ·ç™»å½•åï¼š Tomcat æœåŠ¡å™¨ä¼šè¿”å›ç”¨æˆ·çš„ä¸ªäººä¿¡æ¯ï¼ŒåŒæ—¶æ›´æ–°è®°å½•åœ¨çº¿ç”¨æˆ·ï¼Œæ ¹æ®ç”¨æˆ· id å»ºç«‹ä¸€æ¡ WebSocket è¿æ¥å¹¶ä¿å­˜åœ¨åç«¯ä»¥ä¾¿è¿›è¡Œå®æ—¶é€šä¿¡ã€‚ æµè§ˆå™¨å°†ç»´æŒä¸€ä¸ª Session å¯¹è±¡æ¥ä¿æŒç™»å½•çŠ¶æ€ï¼ˆ30 minï¼‰ã€‚ ç”¨æˆ·ä¸ç”¨æˆ·è¿›è¡Œé€šä¿¡ï¼š æœåŠ¡å™¨æ ¹æ®æ”¶åˆ°çš„æ¶ˆæ¯å†…å®¹ä¸­çš„å¯¹è¯æ–¹çš„ç”¨æˆ· id æ‰¾åˆ°ä¿å­˜çš„ WebSocket è¿æ¥ï¼Œé€šè¿‡è¯¥è¿æ¥å‘é€æ¶ˆæ¯ã€‚ ç”¨æˆ·é€€å‡ºï¼š é‡Šæ”¾ç”¨æˆ·çš„ WebSocket è¿æ¥ã€‚ æ¸…ç©ºç”¨æˆ·åœ¨ Session å¯¹è±¡ä¸­çš„ç™»é™†çŠ¶æ€ã€‚ ç³»ç»ŸåŠŸèƒ½æ¨¡å—ç™»å½•æ¨¡å—ï¼šç”¨æˆ·ç™»å½•ã€ç”¨æˆ·æ³¨é”€ã€‚ èŠå¤©ç®¡ç†æ¨¡å—ï¼šå•æ¡æ¶ˆæ¯å‘é€ã€ç¾¤ç»„æ¶ˆæ¯å‘é€ã€‚ï¼ˆæ¶ˆæ¯ï¼šæ–‡æœ¬ã€æ–‡ä»¶ï¼‰","categories":[{"name":"Project","slug":"Project","permalink":"http://yoursite.com/categories/Project/"}],"tags":[{"name":"Chatroom","slug":"Chatroom","permalink":"http://yoursite.com/tags/Chatroom/"}]},{"title":"Maven å®‰è£…å’Œé…ç½®","slug":"Software/Maven çš„å®‰è£…å’Œé…ç½®","date":"2020-01-30T06:36:59.000Z","updated":"2020-04-19T06:41:37.312Z","comments":true,"path":"2020/01/30/Software/Maven çš„å®‰è£…å’Œé…ç½®/","link":"","permalink":"http://yoursite.com/2020/01/30/Software/Maven%20%E7%9A%84%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE/","excerpt":"Maven æ˜¯ä¸€ä¸ªé¡¹ç›®ç®¡ç†å·¥å…·ï¼Œå¯ä»¥å¯¹ Java é¡¹ç›®è¿›è¡Œæ„å»ºã€ä¾èµ–ç®¡ç†ã€‚","text":"Maven æ˜¯ä¸€ä¸ªé¡¹ç›®ç®¡ç†å·¥å…·ï¼Œå¯ä»¥å¯¹ Java é¡¹ç›®è¿›è¡Œæ„å»ºã€ä¾èµ–ç®¡ç†ã€‚ Maven çš„å®‰è£…Maven ä¸‹è½½åœ°å€ï¼šMaven ä¸‹è½½ 3..6.x ç‰ˆæœ¬ä¼šæœ‰è«åå…¶å¦™çš„æŠ¥é”™ï¼Œå»ºè®®ä½¿ç”¨ 3.5.x ç‰ˆæœ¬ è§£å‹åè¿›è¡Œç¯å¢ƒå˜é‡çš„é…ç½®ï¼šM2_HOMEã€%M2_HOME%\\binã€‚ åœ¨ cmd çª—å£ä¸‹è¾“å…¥mvn -væ˜¾ç¤º Maven ç‰ˆæœ¬å³é…ç½®æˆåŠŸã€‚ ä¿®æ”¹é…ç½®æ–‡ä»¶ç›®å½•ï¼šâ€¦apache-maven-3.6.3\\conf\\settings.xml æœ¬åœ°ä»“åº“ä½ç½®çš„ä¿®æ”¹åœ¨&lt;localRepository&gt;æ ‡ç­¾å†…æ·»åŠ è‡ªå·±çš„æœ¬åœ°ä½ç½®è·¯å¾„ã€‚ ä¿®æ”¹é»˜è®¤çš„ JDK ç‰ˆæœ¬123456789101112&lt;profile&gt; &lt;id&gt;JDK-1.8&lt;/id&gt; &lt;activation&gt; &lt;activeByDefault&gt;true&lt;/activeByDefault&gt; &lt;jdk&gt;1.8&lt;/jdk&gt; &lt;/activation&gt; &lt;properties&gt; &lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt; &lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt; &lt;maven.compiler.compilerVersion&gt;1.8&lt;/maven.compiler.compilerVersion&gt; &lt;/properties&gt; &lt;/profile&gt; æ·»åŠ å›½å†…é•œåƒæº1234567891011121314151617181920212223&lt;!-- é˜¿é‡Œäº‘ä»“åº“ --&gt;&lt;mirror&gt; &lt;id&gt;alimaven&lt;/id&gt; &lt;mirrorOf&gt;central&lt;/mirrorOf&gt; &lt;name&gt;aliyun maven&lt;/name&gt; &lt;url&gt;http://maven.aliyun.com/nexus/content/repositories/central/&lt;/url&gt;&lt;/mirror&gt;&lt;!-- ä¸­å¤®ä»“åº“1 --&gt;&lt;mirror&gt; &lt;id&gt;repo1&lt;/id&gt; &lt;mirrorOf&gt;central&lt;/mirrorOf&gt; &lt;name&gt;Human Readable Name for this Mirror.&lt;/name&gt; &lt;url&gt;http://repo1.maven.org/maven2/&lt;/url&gt;&lt;/mirror&gt;&lt;!-- ä¸­å¤®ä»“åº“2 --&gt;&lt;mirror&gt; &lt;id&gt;repo2&lt;/id&gt; &lt;mirrorOf&gt;central&lt;/mirrorOf&gt; &lt;name&gt;Human Readable Name for this Mirror.&lt;/name&gt; &lt;url&gt;http://repo2.maven.org/maven2/&lt;/url&gt;&lt;/mirror&gt; IDEA ä¸­é…ç½® Maven","categories":[{"name":"Software","slug":"Software","permalink":"http://yoursite.com/categories/Software/"}],"tags":[{"name":"Maven","slug":"Maven","permalink":"http://yoursite.com/tags/Maven/"}]},{"title":"IDEA å®‰è£…ä¸é…ç½®","slug":"Software/IDEA å®‰è£…ä¸é…ç½®","date":"2020-01-29T08:25:01.000Z","updated":"2020-04-19T06:41:32.058Z","comments":true,"path":"2020/01/29/Software/IDEA å®‰è£…ä¸é…ç½®/","link":"","permalink":"http://yoursite.com/2020/01/29/Software/IDEA%20%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/","excerpt":"IDEA å…¨ç§° IntelliJ IDEAï¼Œæ˜¯javaè¯­è¨€å¼€å‘çš„é›†æˆç¯å¢ƒï¼ŒIntelliJåœ¨ä¸šç•Œè¢«å…¬è®¤ä¸ºæœ€å¥½çš„javaå¼€å‘å·¥å…·ä¹‹ä¸€ã€‚è®©æˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹è¿™æ¬¾ç¼–è¾‘å™¨ï¼Œå¹¶ä¸”è¿›è¡Œä¸€å®šçš„é…ç½®ã€‚","text":"IDEA å…¨ç§° IntelliJ IDEAï¼Œæ˜¯javaè¯­è¨€å¼€å‘çš„é›†æˆç¯å¢ƒï¼ŒIntelliJåœ¨ä¸šç•Œè¢«å…¬è®¤ä¸ºæœ€å¥½çš„javaå¼€å‘å·¥å…·ä¹‹ä¸€ã€‚è®©æˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹è¿™æ¬¾ç¼–è¾‘å™¨ï¼Œå¹¶ä¸”è¿›è¡Œä¸€å®šçš„é…ç½®ã€‚ IDEA å®‰è£…ä¸ç ´è§£ä¸‹è½½ IDEAï¼Œé“¾æ¥ï¼šhttps://share.weiyun.com/50wrg7G ä¸‹è½½ç ´è§£è¡¥ä¸ï¼Œé“¾æ¥ï¼šhttps://share.weiyun.com/5kRW75Z å®‰è£…è½¯ä»¶ ï¼ˆå…¨éƒ¨é»˜è®¤å°±è¡Œï¼Œå°ç¼–å®‰è£…åœ¨ D ç›˜çš„æ ¹ç›®å½•ï¼‰ï¼Œå®‰è£…å¥½åå°†ç ´è§£è¡¥ä¸å¤åˆ¶åˆ° \\IntelliJ IDEA 2019.1.4\\bin\\ ç›®å½•ä¸‹ï¼Œåœ¨ bin ç›®å½•ä¸‹åˆ†åˆ«æ‰¾åˆ° idea.exe.vmoptions å’Œ idea64.exe.vmoptionsï¼Œåœ¨æœ«å°¾æ·»åŠ -javaagent:å®‰è£…ç›®å½•ä¸‹çš„\\IntelliJ IDEA 2019.1.3\\bin\\jetbrains-agent.jaråä¿å­˜ã€‚ æ‰“å¼€ IDEAï¼Œé€‰æ‹©ä½¿ç”¨ï¼ˆEvaluate for freeï¼‰ï¼Œé€‰æ‹© Configure - Edit Custom VM Optionsï¼Œåœ¨å¼¹å‡ºçš„çª—å£ç¡®å®šæœ«å°¾æ˜¯åˆšåˆšä¿®æ”¹çš„å‚æ•° -javaagent:D:\\IntelliJ IDEA 2019.1.4\\bin\\jetbrains-agent.jar ï¼ˆå¦‚æœæç¤ºåˆ›å»ºï¼Œé€‰æ‹©æ˜¯ï¼Œåœ¨æœ«å°¾å†æ·»åŠ ä¸Šé¢çš„å‚æ•°ï¼‰ã€‚ é€‰æ‹© Manage Licenseï¼Œ License Server å¡«å†™http://jetbrains-license-serverï¼Œç‚¹å‡» Activateã€‚é‡å¯ä½ çš„ IDEA ,æŸ¥çœ‹æ˜¯å¦å·²ç»ç ´è§£æˆåŠŸã€‚ IDEA æ¨¡å—åœ¨ Eclipse ä¸­æˆ‘ä»¬æœ‰ Workspaceï¼ˆå·¥ä½œç©ºé—´ï¼‰å’Œ Projectï¼ˆå·¥ç¨‹ï¼‰çš„æ¦‚å¿µï¼Œåœ¨ IDEA ä¸­åªæœ‰ Projectï¼ˆå·¥ç¨‹ï¼‰å’Œ Moduleï¼ˆæ¨¡å—ï¼‰çš„æ¦‚å¿µã€‚ Eclipse IDEA Workspace Project Project Module IntelliJ IDEA æ˜¯æ— æ³•åœ¨åŒä¸€ä¸ªçª—å£ç®¡ç† n ä¸ªé¡¹ç›®ã€‚ IntelliJ IDEA æä¾›çš„è§£å†³æ–¹æ¡ˆæ˜¯æ‰“å¼€å¤šä¸ªé¡¹ç›®å®ä¾‹ï¼Œå³æ‰“å¼€å¤šä¸ªé¡¹ç›®çª—å£ã€‚ å³ï¼š ä¸€ä¸ª Project æ‰“å¼€ä¸€ä¸ª Window çª—å£ã€‚ åœ¨ IntelliJ IDEA ä¸­ Project æ˜¯æœ€é¡¶çº§çš„çº§åˆ«ï¼Œæ¬¡çº§åˆ«æ˜¯ Moduleã€‚ä¸€ä¸ª Project å¯ä»¥æœ‰å¤šä¸ª Moduleã€‚ç›®å‰ä¸»æµçš„å¤§å‹é¡¹ç›®éƒ½æ˜¯åˆ†å¸ƒå¼éƒ¨ç½²çš„ï¼Œ ç»“æ„éƒ½æ˜¯ç±»ä¼¼è¿™ç§å¤š Module ç»“æ„ã€‚ IDEA é…ç½®Viewï¼šToolbar [âˆš] è®¾ç½®ä¸»é¢˜ä¸‹è½½å–œæ¬¢çš„ IDEA çš„ä¸»é¢˜ï¼Œä¸‹è½½åœ°å€ï¼šthemesmap Fileï¼šImport setting é€‰ä¸­ä¸‹è½½çš„ä¸»é¢˜å¯¼å…¥åæç¤ºé‡å¯ï¼Œç­‰å¾…é‡å¯å®Œæˆ Editor General Mouseï¼šChange font size(Zoom) with Ctrl+Mouse Whee Otherï¼šShow quick documentation on mouse move Auto Import Javaï¼š appearanceï¼šShow method separators Code Completionï¼šMatch case [Ã—] Editor Tabsï¼šShow tabs in one row [Ã—] Fontï¼šSize File and Code Templates 1234/**@author Wingo@create $&#123;YEAR&#125;-$&#123;MONTH&#125;-$&#123;DAY&#125; $&#123;TIME&#125;*/ File Encodingï¼š Properties Filesï¼šUTF-8 [âˆš] å¿«æ·é”®è®¾ç½®KeyMapï¼šEclipse Eclipse å¸¸ç”¨å¿«æ·é”® æ‰§è¡Œ (run) alt+r æç¤ºè¡¥å…¨ (Class Name Completion) alt+/ å•è¡Œæ³¨é‡Š ctrl + / å¤šè¡Œæ³¨é‡Š ctrl + shift + / å‘ä¸‹å¤åˆ¶ä¸€è¡Œ (Duplicate Lines) ctrl+alt+down åˆ é™¤ä¸€è¡Œæˆ–é€‰ä¸­è¡Œ (delete line) ctrl+d å‘ä¸‹ç§»åŠ¨è¡Œ (move statement down) alt+down å‘ä¸Šç§»åŠ¨è¡Œ (move statement up) alt+up å‘ä¸‹å¼€å§‹æ–°çš„ä¸€è¡Œ (start new line) shift+enter å‘ä¸Šå¼€å§‹æ–°çš„ä¸€è¡Œ (Start New Line before current) ctrl+shift+enter å¦‚ä½•æŸ¥çœ‹æºç  (class) ctrl + é€‰ä¸­æŒ‡å®šçš„ç»“æ„ / ctrl + shift + t ä¸‡èƒ½è§£é”™ / ç”Ÿæˆè¿”å›å€¼å˜é‡ alt + enter é€€å›åˆ°å‰ä¸€ä¸ªç¼–è¾‘çš„é¡µé¢ (back) alt + left è¿›å…¥åˆ°ä¸‹ä¸€ä¸ªç¼–è¾‘çš„é¡µé¢ ( é’ˆå¯¹äºä¸Šæ¡ ) (forward) alt + right æŸ¥çœ‹ç»§æ‰¿å…³ç³» (type hierarchy) F4 æ ¼å¼åŒ–ä»£ç  (reformat code) ctrl+shift+F æç¤ºæ–¹æ³•å‚æ•°ç±»å‹ (Parameter Info) ctrl+alt+/ å¤åˆ¶ä»£ç  ctrl + c æ’¤é”€ ctrl + z åæ’¤é”€ ctrl + y æŸ¥çœ‹ç±»çš„ç»“æ„ï¼šç±»ä¼¼äº eclipse çš„ outline ctrl+o é‡æ„ï¼š ä¿®æ”¹å˜é‡åä¸æ–¹æ³•å (rename) alt+shift+r å¤§å†™è½¬å°å†™ / å°å†™è½¬å¤§å†™ (toggle case) ctrl+shift+y ç”Ÿæˆæ„é€ å™¨/get/set/toString alt +shift + s æŸ¥çœ‹æ–‡æ¡£è¯´æ˜(quick documentation) F2 ç”Ÿæˆ try-catch ç­‰(surround with) alt+shift+z å±€éƒ¨å˜é‡æŠ½å–ä¸ºæˆå‘˜å˜é‡(introduce field) alt+shift+f æŸ¥æ‰¾/æ›¿æ¢(å½“å‰) ctrl+f æŸ¥æ‰¾(å…¨å±€) ctrl+h æŸ¥æ‰¾æ–‡ä»¶ double Shift æŸ¥çœ‹ç±»çš„ç»§æ‰¿ç»“æ„å›¾(Show UML Diagram) ctrl + shift + u æŸ¥çœ‹æ–¹æ³•çš„å¤šå±‚é‡å†™ç»“æ„(method hierarchy) ctrl+alt+h æŠ½å–æ–¹æ³•(Extract Method) alt+shift+m å…³é—­å½“å‰æ‰“å¼€çš„ä»£ç æ (close) ctrl + w å…³é—­æ‰“å¼€çš„æ‰€æœ‰ä»£ç æ (close all) ctrl + shift + w å¿«é€Ÿæœç´¢ç±»ä¸­çš„é”™è¯¯(next highlighted error) ctrl + shift + q æŸ¥æ‰¾æ–¹æ³•åœ¨å“ªé‡Œè¢«è°ƒç”¨(Call Hierarchy) ctrl+shift+h å…³äºæ¨¡æ¿Editor &gt; General &gt; Postfix Completion Editor &gt; Live Templatesï¼ˆå¯è‡ªå®šä¹‰ï¼‰ ä¿®æ”¹å½“è¡Œæ³¨è§£é£æ ¼æ‰“å¼€ idea çš„è®¾ç½®ï¼Œä¾æ¬¡ç‚¹å‡»ã€ŒEditorã€â€”â€”ã€ŒCode Styleã€â€”â€”ã€ŒJavaã€â€”â€”ã€ŒCode Generationã€ï¼Œç„¶åå–æ¶ˆå‹¾é€‰ Line comment at first columnï¼ŒåŒæ—¶å‹¾é€‰ Add a space at comment start","categories":[{"name":"Software","slug":"Software","permalink":"http://yoursite.com/categories/Software/"}],"tags":[{"name":"IDEA","slug":"IDEA","permalink":"http://yoursite.com/tags/IDEA/"}]},{"title":"Hexo å®‰è£…ä¸é…ç½®","slug":"Software/Hexo å®‰è£…ä¸é…ç½®","date":"2020-01-29T04:59:01.000Z","updated":"2020-04-19T06:41:25.577Z","comments":true,"path":"2020/01/29/Software/Hexo å®‰è£…ä¸é…ç½®/","link":"","permalink":"http://yoursite.com/2020/01/29/Software/Hexo%20%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/","excerpt":"Hexo ä»‹ç»Hexo æ˜¯ä¸€ä¸ªç®€å•ã€å¿«é€Ÿã€å¼ºå¤§çš„åŸºäº Github Pages çš„åšå®¢å‘å¸ƒå·¥å…·ï¼Œæ”¯æŒMarkdownæ ¼å¼ï¼Œæœ‰ä¼—å¤šä¼˜ç§€æ’ä»¶å’Œä¸»é¢˜ã€‚","text":"Hexo ä»‹ç»Hexo æ˜¯ä¸€ä¸ªç®€å•ã€å¿«é€Ÿã€å¼ºå¤§çš„åŸºäº Github Pages çš„åšå®¢å‘å¸ƒå·¥å…·ï¼Œæ”¯æŒMarkdownæ ¼å¼ï¼Œæœ‰ä¼—å¤šä¼˜ç§€æ’ä»¶å’Œä¸»é¢˜ã€‚ å®˜ç½‘ï¼š http://hexo.io GitHub æ­å»ºå·¥ä½œä»“åº“æ­å»ºHexo æ˜¯åŸºäº GitHub çš„ï¼Œé¦–å…ˆä½ éœ€è¦æœ‰ä¸€ä¸ª GitHub çš„è´¦å·ï¼Œå¹¶ä¸”åˆ›å»ºä¸€ä¸ªç”¨äºå­˜æ”¾åšå®¢çš„é™æ€æ–‡ä»¶çš„ä»“åº“ã€‚è¿™ä¸ªä»“åº“çš„åç§°å¿…é¡»æ˜¯[username].github.ioï¼Œä¹‹åä½ ä¾¿å¯ä»¥ç”¨http://[username].github.ioè®¿é—®ä½ æ­å»ºçš„åšå®¢ã€‚ åŸŸåç»‘å®šåœ¨äº‘å¹³å°è´­ä¹°è‡ªå·±å–œæ¬¢çš„åŸŸåï¼Œå¹¶ä¸”åœ¨å¹³å°çš„æ§åˆ¶å°è¿›è¡ŒåŸŸåçš„ç»‘å®šã€‚ æ‰“å¼€æ§åˆ¶å°ping http://[username].github.ioï¼Œå¾—åˆ° IP åœ°å€ã€‚ ç„¶ååˆ°ä½ çš„åŸŸå DNS è®¾ç½®é¡µï¼Œå°† A è®°å½•æŒ‡å‘ä½  ping å‡ºæ¥çš„ IPï¼Œå°† CNAME æŒ‡å‘[username].github.ioï¼Œè¿™æ ·å¯ä»¥ä¿è¯æ— è®ºæ˜¯å¦æ·»åŠ  www éƒ½å¯ä»¥è®¿é—®ã€‚ CNAME æ–‡ä»¶ï¼šåˆ›å»ºä¸€ä¸ª CNAME ï¼Œåœ¨å…¶ä¸­è¾“å…¥ä½ çš„åŸŸåï¼Œä¿å­˜åæ”¾ç½®åœ¨ä½ çš„ theme ç›®å½•ä¸‹çš„ resource ç›®å½•ä¸‹ é…ç½® SSH Keyåˆ° Github å®˜ç½‘ä¸‹è½½å®¢æˆ·ç«¯ï¼Œå³é”®é€‰æ‹© git bash hereã€‚è¾“å…¥ cd ~/.ssh æ£€æŸ¥æœ¬æœºæ˜¯å¦å·²ç»å­˜åœ¨ SSH å¯†é’¥ã€‚ è‹¥æ˜¾ç¤º No such file or directory åˆ™è¯´æ˜æœ¬æœºè¿˜æœªåˆ›å»º SSH å¯†é’¥ã€‚ è¾“å…¥ssh-keygen -t rsa -C &quot;[email]&quot;ï¼Œå¹¶è¿ç»­å›è½¦ç›´åˆ°æç¤ºå¯†é’¥ç”ŸæˆæˆåŠŸã€‚ è¾“å…¥cd ~/.sshï¼Œç„¶åè¾“å…¥lså³å¯çœ‹åˆ°æ­¤ç›®å½•ä¸‹ç”Ÿæˆçš„å…¬é’¥ï¼ˆpubï¼‰å’Œç§é’¥ã€‚åˆ©ç”¨catå‘½ä»¤å–å¾—å…¬é’¥çš„å†…å®¹ï¼Œå¹¶ä¸”å¤åˆ¶å…¬é’¥å†…å®¹ï¼Œç²˜è´´åˆ° GitHub çš„ Settings ä¸­çš„ SSH Keys ä¸­ï¼ˆåç§°è‡ªå®šä¹‰å³å¯ï¼‰ã€‚ è¾“å…¥ssh -T git@github.comï¼Œè¾“å…¥ yes åè‹¥æç¤ºè¿æ¥æˆåŠŸåˆ™ SSH Key é…ç½®æˆåŠŸã€‚ æ­¤å¤–ï¼Œä½ è¿˜éœ€è¦è¾“å…¥git config --global user.name &quot;[username]&quot;å’Œgit config --global user.email &quot;[email]&quot;è¿›è¡Œé…ç½®ã€‚ï¼ˆå±€éƒ¨é…ç½®æ—¶ä¸åŠ  --globalï¼‰ å¤šä¸ª SSH Keyä¸ºäº†åŒºåˆ«ä¸ªäºº / å…¬å¸çš„ä»£ç ä»“åº“ï¼Œå…¬å¸çš„ä»£ç ä»“åº“çš„é‚®ä»¶ç”Ÿæˆä¸€ä¸ªæ–°çš„ SSH Keyï¼Œä¸ºé¿å…ä¹‹å‰çš„åˆ›å»ºçš„ id_rsa è¢«è¦†ç›–ï¼Œæ­¤æ¬¡åˆ›å»ºéœ€è¦æ˜¾ç¤ºçš„é‡å‘½åæ–‡ä»¶ id_rsa_welabã€‚ å¾—åˆ°å…¬é’¥å¹¶ä¸”å¤åˆ¶åˆ°å…¬å¸ç”¨æˆ·åï¼Œè¿›è¡Œé¡¹ç›®å…‹éš†æ—¶æŠ¥é”™ï¼Œæ’æŸ¥åå‘ç°æ­¤ id_rsa_welab éé»˜è®¤å‘½åï¼Œæ•…éœ€è¦æ‰‹åŠ¨æ·»åŠ åˆ° ssh-agent ä¸­ï¼ˆéœ€æ‰‹åŠ¨å¼€å¯ï¼‰ã€‚ 12# å¼€å¯ ssh-agent !!! æ³¨æ„ æ˜¯ ~ ä¸‹é¢çš„ ``ï¼Œä¸æ˜¯ ''eval `ssh-agent` è¾“å…¥ ssh-add [path]å‘½ä»¤ã€‚ æ·»åŠ åå³å¯æˆåŠŸå…‹éš†é¡¹ç›®ã€‚ Hexo å®‰è£…é¦–å…ˆè¦å®‰è£… Node.jsï¼Œç„¶ååˆ©ç”¨ npm å®‰è£… Hexoã€‚ å³é”®é€‰æ‹© git bash hereã€‚è¾“å…¥npm install -g Hexoï¼Œç­‰å¾…ä¸‹è½½å®Œæˆã€‚ è¾“å…¥ cd [blog catalogue]ï¼Œåˆ°ä½ æ”¾ç½® Blog æ–‡ä»¶çš„ç›®å½•ä¸‹ï¼Œè¾“å…¥hexo initåˆå§‹åŒ– Hexo æ–‡ä»¶ã€‚ è¾“å…¥ hexo generateå›è½¦ï¼Œhexo serverå›è½¦ï¼Œæµè§ˆå™¨è¾“å…¥localhost:4000å³å¯çœ‹åˆ°åšå®¢é¡µé¢ å¸¸ç”¨å‘½ä»¤1234hexo cleanhexo generatehexo serverhexo deploy ä¸»é¢˜æ›´æ¢è§ï¼š[hexo-theme-indigo]","categories":[{"name":"Software","slug":"Software","permalink":"http://yoursite.com/categories/Software/"}],"tags":[{"name":"Hexo","slug":"Hexo","permalink":"http://yoursite.com/tags/Hexo/"},{"name":"Github","slug":"Github","permalink":"http://yoursite.com/tags/Github/"}]},{"title":"Netty å¼•å¯¼","slug":"Netty/Netty å…¥é—¨/Netty å¼•å¯¼","date":"2020-01-25T16:25:24.000Z","updated":"2020-04-19T06:31:12.172Z","comments":true,"path":"2020/01/26/Netty/Netty å…¥é—¨/Netty å¼•å¯¼/","link":"","permalink":"http://yoursite.com/2020/01/26/Netty/Netty%20%E5%85%A5%E9%97%A8/Netty%20%E5%BC%95%E5%AF%BC/","excerpt":"å¼•å¯¼ä¸€ä¸ªåº”ç”¨ç¨‹åºæ˜¯æŒ‡å¯¹å®ƒè¿›è¡Œé…ç½®ï¼Œå¹¶ä½¿å®ƒè¿è¡Œèµ·æ¥çš„è¿‡ç¨‹ã€‚Nettyå¤„ç†å¼•å¯¼çš„æ–¹å¼ä½¿ä½ çš„åº”ç”¨ç¨‹åºå’Œç½‘ç»œå±‚ç›¸éš”ç¦»ï¼Œæ— è®ºå®ƒæ˜¯å®¢æˆ·ç«¯è¿˜æ˜¯æœåŠ¡å™¨ã€‚æ‰€æœ‰çš„æ¡†æ¶ç»„ä»¶éƒ½å°†ä¼šåœ¨åå°ç»“åˆåœ¨ ä¸€èµ·å¹¶ä¸”å¯ç”¨ã€‚","text":"å¼•å¯¼ä¸€ä¸ªåº”ç”¨ç¨‹åºæ˜¯æŒ‡å¯¹å®ƒè¿›è¡Œé…ç½®ï¼Œå¹¶ä½¿å®ƒè¿è¡Œèµ·æ¥çš„è¿‡ç¨‹ã€‚Nettyå¤„ç†å¼•å¯¼çš„æ–¹å¼ä½¿ä½ çš„åº”ç”¨ç¨‹åºå’Œç½‘ç»œå±‚ç›¸éš”ç¦»ï¼Œæ— è®ºå®ƒæ˜¯å®¢æˆ·ç«¯è¿˜æ˜¯æœåŠ¡å™¨ã€‚æ‰€æœ‰çš„æ¡†æ¶ç»„ä»¶éƒ½å°†ä¼šåœ¨åå°ç»“åˆåœ¨ ä¸€èµ·å¹¶ä¸”å¯ç”¨ã€‚ Bootstrap ç±»å¼•å¯¼ç±»çš„å±‚æ¬¡ç»“æ„åŒ…æ‹¬ä¸€ä¸ªæŠ½è±¡çš„çˆ¶ç±»å’Œä¸¤ä¸ªå…·ä½“çš„å¼•å¯¼å­ç±»ã€‚ ç›¸å¯¹äºå°†å…·ä½“çš„å¼•å¯¼ç±»åˆ†åˆ«çœ‹ä½œç”¨äºæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„å¼•å¯¼æ¥è¯´ï¼Œè®°ä½å®ƒä»¬çš„æœ¬æ„æ˜¯ç”¨æ¥æ”¯ æ’‘ä¸åŒçš„åº”ç”¨ç¨‹åºçš„åŠŸèƒ½ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒæœåŠ¡å™¨è‡´åŠ›äºä½¿ç”¨ä¸€ä¸ªçˆ¶ Channel æ¥æ¥å—æ¥è‡ªå®¢æˆ·ç«¯çš„è¿æ¥ï¼Œå¹¶åˆ›å»ºå­ Channel ä»¥ç”¨äºå®ƒä»¬ä¹‹é—´çš„é€šä¿¡ï¼›è€Œå®¢æˆ·ç«¯å°†æœ€å¯èƒ½åªéœ€è¦ä¸€ä¸ªå•ç‹¬çš„ã€æ²¡æœ‰çˆ¶ Channel çš„ Channel æ¥ç”¨äºæ‰€æœ‰çš„ç½‘ç»œäº¤äº’ã€‚ ä¸ºä»€ä¹ˆå¼•å¯¼ç±»æ˜¯ Cloneable çš„ï¼š ä½ æœ‰æ—¶å¯èƒ½ä¼šéœ€è¦åˆ›å»ºå¤šä¸ªå…·æœ‰ç±»ä¼¼é…ç½®æˆ–è€…å®Œå…¨ç›¸åŒé…ç½®çš„Channelã€‚ä¸ºäº†æ”¯æŒè¿™ç§æ¨¡å¼è€Œåˆä¸éœ€è¦ä¸ºæ¯ä¸ª Channel éƒ½åˆ›å»ºå¹¶é…ç½®ä¸€ä¸ªæ–°çš„å¼•å¯¼ç±»å®ä¾‹ï¼Œ AbstractBootstrap è¢«æ ‡è®°ä¸ºäº† Cloneableã€‚ æ³¨æ„ï¼Œè¿™ç§æ–¹å¼åªä¼šåˆ›å»ºå¼•å¯¼ç±»å®ä¾‹çš„ EventLoopGroup çš„ä¸€ä¸ªæµ…æ‹·è´ï¼Œæ‰€ä»¥ï¼Œåè€…å°†åœ¨æ‰€æœ‰å…‹éš†çš„ Channel å®ä¾‹ä¹‹é—´å…±äº«ã€‚è¿™æ˜¯å¯ä»¥æ¥å—çš„ï¼Œå› ä¸ºé€šå¸¸è¿™äº›å…‹éš†çš„ Channel çš„ç”Ÿå‘½å‘¨æœŸéƒ½å¾ˆçŸ­æš‚ï¼Œä¸€ä¸ªå…¸å‹çš„åœºæ™¯æ˜¯ï¼šåˆ›å»ºä¸€ä¸ª Channel ä»¥è¿›è¡Œä¸€æ¬¡HTTPè¯·æ±‚ã€‚ å¼•å¯¼å®¢æˆ·ç«¯Bootstrap ç±»è´Ÿè´£ä¸ºå®¢æˆ·ç«¯å’Œä½¿ç”¨æ— è¿æ¥åè®®çš„åº”ç”¨ç¨‹åºåˆ›å»º Channelã€‚ 12345678910111213141516171819202122232425262728293031323334// å¼•å¯¼ä¸€ä¸ªå®¢æˆ·ç«¯EventLoopGroup group = new NioEventLoopGroup();// åˆ›å»ºä¸€ä¸ª Bootstrap ç±»çš„å®ä¾‹ç”¨æ¥åˆ›å»ºå’Œè¿æ¥æ–°çš„å®¢æˆ·ç«¯ ChannelBootstrap bootstrap = new Bootstrap();// è®¾ç½® EventLoopGroup æä¾›ç”¨äºå¤„ç† Channel äº‹ä»¶çš„ EventLoopbootstrap.group(group) // æŒ‡å®šè¦ä½¿ç”¨çš„ Channel å®ç° .channel(NioSocketChannel.class) .handler( // è®¾ç½®ç”¨äº Channel äº‹ä»¶å’Œæ•°æ®çš„ ChannelInboundHandler new SimpleChannelInboundHandler&lt;ByteBuf&gt;() &#123; @Override protected void channeRead0(ChannelHandlerContext channelHandlerContext, ByteBuf byteBuf) throws Exception &#123; System.out.println(\"Received data\"); &#125; &#125; );ChannelFuture future = bootstrap.connect( // è¿æ¥åˆ°è¿œç¨‹ä¸»æœº new InetSocketAddress(\"www.manning.com\", 80));future.addListener( new ChannelFutureListener() &#123; @Override public void operationComplete(ChannelFuture channelFuture) throws Exception &#123; if (channelFuture.isSuccess()) &#123; System.out.println(\"Connection established\"); &#125; else &#123; System.err.println(\"Connection attempt failed\"); channelFuture.cause().printStackTrace(); &#125; &#125; &#125; ); å¼•å¯¼æœåŠ¡å™¨è´Ÿè´£å¼•å¯¼ ServerChannel çš„ ServerBootstrap æä¾›äº†è´Ÿè´£åˆ›å»ºå­ Channel çš„æ–¹æ³• childXxx()ï¼Œè¿™äº›å­ Channel ä»£è¡¨äº†å·²è¢«æ¥æ”¶çš„è¿æ¥ã€‚ 1234567891011121314151617181920212223242526272829// å¼•å¯¼æœåŠ¡å™¨NioEventLoopGroup group = new NioEventLoopGroup();ServerBootstrap bootstrap = new ServerBootstrap();bootstrap.group(group) .channel(NioServerSocketChannel.class) // å­çº¿ç¨‹ .childHandler( new SimpleChannelInboundHandler&lt;ByteBuf&gt;() &#123; @Override protected void channelRead0(ChannelHandlerContext ctx, ByteBuf byteBuf) throws Exception &#123; System.out.println(\"Received data\"); &#125; &#125; );// ç›‘å¬ç«¯å£ChannelFuture future = bootstrap.bind(new InetSocketAddress(8080));future.addListener( new ChannelFutureListener() &#123; @Override public void operationComplete(ChannelFuture channelFuture) throws Exception &#123; if (channelFuture.isSuccess()) &#123; System.out.println(\"Server bound\"); &#125; else &#123; System.err.println(\"Bound attempt failed\"); channelFuture.cause().printStackTrace(); &#125; &#125; &#125; ); ä» Channel å¼•å¯¼å®¢æˆ·ç«¯å‡è®¾ä½ çš„æœåŠ¡å™¨æ­£åœ¨å¤„ç†ä¸€ä¸ªå®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œè¿™ä¸ªè¯·æ±‚éœ€è¦å®ƒå……å½“ç¬¬ä¸‰æ–¹ç³»ç»Ÿçš„å®¢æˆ·ç«¯ã€‚ 1234567891011121314151617181920212223242526272829303132333435ServerBootstrap bootstrap = new ServerBootstrap();bootstrap.group(new NioEventLoopGroup(), new NioEventLoopGroup()) .channel(NioServerSocketChannel.class) .childHandler( new SimpleChannelInboundHandler&lt;ByteBuf&gt;() &#123; ChannelFuture connectFuture; @Override public void channelActive(ChannelHandlerContext ctx) throws Exception &#123; Bootstrap bootstrap = new Bootstrap(); bootstrap.channel(NioSocketChannel.class).handler( new SimpleChannelInboundHandler&lt;ByteBuf&gt;() &#123; @Override protected void channelRead0(ChannelHandlerContext ctx, ByteBuf in) throws Exception &#123; System.out.println(\"Received data\"); &#125; &#125; ); // ä½¿ç”¨ä¸åˆ†é…ç»™å·²è¢«æ¥å—çš„å­ Channel ç›¸åŒçš„ EventLoop bootstrap.group(ctx.channel().eventLoop()); connectFuture = bootstrap.connect( new InetSocketAddress(\"www.manning.com\", 80)); &#125; @Override protected void channelRead0(ChannelHandlerContext channelHandlerContext, ByteBuf byteBuf) throws Exception &#123; if (connectFuture.isDone()) &#123; // do something with the data &#125; &#125; &#125; );ChannelFuture future = bootstrap.bind(new InetSocketAddress(8080));future.addListener(new ChannelFutureListener() &#123; @Override public void operationComplete(ChannelFuture channelFuture)throws Exception &#123; if (channelFuture.isSuccess()) &#123; System.out.println(\"Server bound\"); &#125; else &#123; System.err.println(\"Bind attempt failed\"); channelFuture.cause().printStackTrace(); &#125; &#125; &#125; ); å°½å¯èƒ½åœ°é‡ç”¨ EventLoopï¼Œä»¥å‡å°‘çº¿ç¨‹åˆ›å»ºæ‰€å¸¦æ¥çš„å¼€é”€ã€‚ åœ¨å¼•å¯¼è¿‡ç¨‹ä¸­æ·»åŠ å¤šä¸ª ChannelHandleråœ¨å‰é¢çš„å‡ ä¸ªä¾‹å­ä¸­ï¼Œåœ¨å¼•å¯¼çš„è¿‡ç¨‹ä¸­è°ƒç”¨äº† handler() æˆ–è€… childHandler() æ–¹æ³•æ¥æ·»åŠ å•ä¸ªçš„ ChannelHandlerã€‚è¿™å¯¹äºç®€å•çš„åº”ç”¨ç¨‹åºæ¥è¯´å¯èƒ½å·²ç»è¶³å¤Ÿäº†ï¼Œä½†æ˜¯å®ƒä¸èƒ½æ»¡è¶³æ›´åŠ å¤æ‚çš„éœ€æ±‚ã€‚ protected abstract void initChannel(C ch) throws Exception; è¿™ä¸ªæ–¹æ³•æä¾›äº†ä¸€ç§å°†å¤šä¸ª ChannelHandler æ·»åŠ åˆ°ä¸€ä¸ª ChannelPipeline ä¸­çš„ç®€ä¾¿æ–¹æ³• 12345678910111213141516// å¼•å¯¼å’Œä½¿ç”¨ ChannelInitializerServerBootstrap bootstrap = new ServerBootstrap();bootstrap.group(new NioEventLoopGroup(), new NioEventLoopGroup()) .channel(NioServerSocketChannel.class) .childHandler(new ChannelInitializerImpl());ChannelFuture future = bootstrap.bind(new InetSocketAddress(8080));future.sync();// ChannelInitializer çš„å®ç°final class ChannelInitializerImpl extends ChannelInitializer&lt;Channel&gt; &#123; @Override protected void initChannel(Channel ch) throws Exception &#123; ChannelPipeline pipeline = ch.pipeline(); pipeline.addLast(new HttpClientCodec()); pipeline.addLast(new HttpObjectAggregator(Integer.MAX_VALUE)); &#125; &#125; å¦‚æœä½ çš„åº”ç”¨ç¨‹åºä½¿ç”¨äº†å¤šä¸ª ChannelHandlerï¼Œè¯·å®šä¹‰ä½ è‡ªå·±çš„ ChannelInitializer å®ç°æ¥å°†å®ƒä»¬å®‰è£…åˆ° ChannelPipeline ä¸­ã€‚ ChannelOption å’Œå±æ€§ä½ å¯ä»¥ä½¿ç”¨ option() æ–¹æ³•æ¥å°† ChannelOption åº”ç”¨åˆ°å¼•å¯¼ã€‚ä½ æ‰€æä¾›çš„å€¼å°†ä¼šè¢«è‡ªåŠ¨åº”ç”¨åˆ°å¼•å¯¼æ‰€åˆ›å»ºçš„æ‰€æœ‰ Channelã€‚å¯ç”¨çš„ ChannelOption åŒ…æ‹¬äº†åº•å±‚è¿æ¥çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¦‚ keep-alive æˆ–è€…è¶…æ—¶å±æ€§ä»¥åŠç¼“å†²åŒºè®¾ç½®ã€‚ Netty æä¾›äº† AttributeMap æŠ½è±¡ï¼ˆä¸€ä¸ªç”± Channel å’Œå¼•å¯¼ç±»æä¾›çš„é›†åˆï¼‰ä»¥åŠ AttributeKeyï¼ˆä¸€ ä¸ªç”¨äºæ’å…¥å’Œè·å–å±æ€§å€¼çš„æ³›å‹ç±»ï¼‰ã€‚ä½¿ç”¨è¿™äº›å·¥å…·ï¼Œä¾¿å¯ä»¥å®‰å…¨åœ°å°†ä»»ä½•ç±»å‹çš„æ•°æ®é¡¹ä¸å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ Channelï¼ˆåŒ…å« ServerChannel çš„å­ Channelï¼‰ç›¸å…³è”äº†ã€‚ 123456789101112131415161718192021222324252627// ä½¿ç”¨å±æ€§å€¼// åˆ›å»ºä¸€ä¸ª AttributeKey ä»¥æ ‡è¯†è¯¥å±æ€§final AttributeKey&lt;Integer&gt; id = new AttributeKey&lt;Integer&gt;(\"ID\");Bootstrap bootstrap = new Bootstrap();bootstrap.group(new NioEventLoopGroup()) .channel(NioSocketChannel.class) .handler( new SimpleChannelInboundHandler&lt;ByteBuf&gt;() &#123; @Override public void channelRegistered(ChannelHandlerContext ctx) throws Exception &#123; // ä½¿ç”¨ AttributeKey æ£€ç´¢å±æ€§ä»¥åŠå®ƒçš„å€¼ Integer idValue = ctx.channel().attr(id).get(); // do something with the idValue &#125; @Override protected void channelRead0(ChannelHandlerContext channelHandlerContext, ByteBuf byteBuf) throws Exception &#123; System.out.println(\"Received data\"); &#125; &#125; );// å¼•å¯¼çš„æ¯ä¸€ä¸ª Channel éƒ½å°†å…·æœ‰è¿™äº›å±æ€§bootstrap.option(ChannelOption.SO_KEEPALIVE,true) .option(ChannelOption.CONNECT_TIMEOUT_MILLIS, 5000);// å­˜å‚¨è¯¥ id å±æ€§bootstrap.attr(id, 123456);ChannelFuture future = bootstrap.connect(new InetSocketAddress(\"www.manning.com\", 80));future.syncUninterruptibly(); å¼•å¯¼ DatagramChannelé™¤äº†åŸºäº TCP åè®®çš„ SocketChannelï¼ŒBootstrap ç±»ä¹Ÿå¯ä»¥è¢«ç”¨äºæ— è¿æ¥åè®®ã€‚ä¸ºæ­¤ã€‚Netty æä¾›äº†å„ç§ DatagramChannel çš„å®ç°ã€‚å”¯ä¸€åŒºåˆ«å°±æ˜¯ï¼Œä¸å†è°ƒç”¨ connect() æ–¹æ³•ï¼Œè€Œæ˜¯åªè°ƒç”¨ bind() æ–¹æ³•ã€‚ 1234567891011121314151617181920212223242526// ä½¿ç”¨ Bootstrap å’Œ DatagramChannelBootstrap bootstrap = new Bootstrap();bootstrap.group(new OioEventLoopGroup()) .channel(OioDatagramChannel.class) .handler( new SimpleChannelInboundHandler&lt;DatagramPacket&gt;()&#123; @Override public void channelRead0(ChannelHandlerContext ctx, DatagramPacket msg) throws Exception &#123; // Do something with the packet &#125; &#125; );// è°ƒç”¨ bind() æ–¹æ³•ï¼Œå› ä¸ºè¯¥åè®®æ˜¯æ— è¿æ¥çš„ChannelFuture future = bootstrap.bind(new InetSocketAddress(0));future.addListener(new ChannelFutureListener() &#123; @Override public void operationComplete(ChannelFuture channelFuture) throws Exception &#123; if (channelFuture.isSuccess()) &#123; System.out.println(\"Channel bound\"); &#125; else &#123; System.err.println(\"Bind attempt failed\"); channelFuture.cause().printStackTrace(); &#125; &#125;&#125;); å…³é—­å¼•å¯¼ä½¿ä½ çš„åº”ç”¨ç¨‹åºå¯åŠ¨å¹¶ä¸”è¿è¡Œèµ·æ¥ï¼Œä½†æ˜¯è¿Ÿæ—©ä½ éƒ½éœ€è¦ä¼˜é›…åœ°å°†å®ƒå…³é—­ã€‚ 123456789// ä¼˜é›…çš„å…³é—­EventLoopGroup group = new NioEventLoopGroup();Bootstrap bootstrap = new Bootstrap();bootstrap.group(group) .channel(NioSocketChannel.class);...;Future&lt;?&gt; future = group.shutdownGracefully();// block until the group has shutdownfuture.syncUninterruptibly(); æ³¨æ„ï¼ŒshutdownGracefully() æ–¹æ³•ä¹Ÿæ˜¯ä¸€ä¸ªå¼‚æ­¥çš„æ“ä½œï¼Œæ‰€ä»¥ä½ éœ€è¦é˜»å¡ç­‰å¾…ç›´åˆ°å®ƒå®Œæˆï¼Œæˆ–è€…å‘æ‰€è¿”å›çš„ Future æ³¨å†Œä¸€ä¸ªç›‘å¬å™¨ä»¥åœ¨å…³é—­å®Œæˆæ—¶è·å¾—é€šçŸ¥ã€‚","categories":[{"name":"Java","slug":"Java","permalink":"http://yoursite.com/categories/Java/"}],"tags":[{"name":"Netty","slug":"Netty","permalink":"http://yoursite.com/tags/Netty/"}]},{"title":"Netty EventLoop å’Œçº¿ç¨‹æ¨¡å‹","slug":"Netty/Netty å…¥é—¨/Netty EventLoop å’Œçº¿ç¨‹æ¨¡å‹","date":"2020-01-25T08:09:20.000Z","updated":"2020-04-19T06:32:52.820Z","comments":true,"path":"2020/01/25/Netty/Netty å…¥é—¨/Netty EventLoop å’Œçº¿ç¨‹æ¨¡å‹/","link":"","permalink":"http://yoursite.com/2020/01/25/Netty/Netty%20%E5%85%A5%E9%97%A8/Netty%20EventLoop%20%E5%92%8C%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B/","excerpt":"çº¿ç¨‹æ¨¡å‹æŒ‡å®šäº†æ“ä½œç³»ç»Ÿã€ç¼–ç¨‹è¯­è¨€ã€æ¡†æ¶æˆ–è€…åº”ç”¨ç¨‹åºçš„ä¸Šä¸‹æ–‡ä¸­çš„çº¿ç¨‹ç®¡ç†çš„å…³é”®æ–¹é¢ï¼Œå¦‚ä½•ä»¥åŠä½•æ—¶åˆ›å»ºçº¿ç¨‹å°†å¯¹åº”ç”¨ç¨‹åºä»£ç çš„æ‰§è¡Œäº§ç”Ÿæ˜¾è‘—çš„å½±å“ã€‚","text":"çº¿ç¨‹æ¨¡å‹æŒ‡å®šäº†æ“ä½œç³»ç»Ÿã€ç¼–ç¨‹è¯­è¨€ã€æ¡†æ¶æˆ–è€…åº”ç”¨ç¨‹åºçš„ä¸Šä¸‹æ–‡ä¸­çš„çº¿ç¨‹ç®¡ç†çš„å…³é”®æ–¹é¢ï¼Œå¦‚ä½•ä»¥åŠä½•æ—¶åˆ›å»ºçº¿ç¨‹å°†å¯¹åº”ç”¨ç¨‹åºä»£ç çš„æ‰§è¡Œäº§ç”Ÿæ˜¾è‘—çš„å½±å“ã€‚ çº¿ç¨‹æ¨¡å‹æ¦‚è¿°å¤šæ ¸å¿ƒæˆ–å¤šä¸ª CPU çš„è®¡ç®—æœºç°åœ¨å·²ç»å¸ç©ºè§æƒ¯ï¼Œå¤§å¤šæ•°çš„ç°ä»£åº”ç”¨ç¨‹åºéƒ½åˆ©ç”¨äº† å¤æ‚çš„å¤šçº¿ç¨‹å¤„ç†æŠ€æœ¯ä»¥æœ‰æ•ˆåœ°åˆ©ç”¨ç³»ç»Ÿèµ„æºã€‚ åœ¨æ—©æœŸçš„ Java è¯­è¨€ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨å¤šçº¿ç¨‹å¤„ç†çš„ä¸»è¦æ–¹å¼æ— éæ˜¯æŒ‰éœ€åˆ›å»ºå’Œå¯åŠ¨æ–°çš„ Thread æ¥æ‰§è¡Œå¹¶å‘çš„ä»»åŠ¡å•å…ƒï¼Œè¿™æ˜¯ä¸€ç§åœ¨é«˜è´Ÿè½½ä¸‹å·¥ä½œå¾—å¾ˆå·®çš„åŸå§‹æ–¹å¼ã€‚Java 5 éšåå¼•å…¥äº† Executor APIï¼Œå…¶çº¿ç¨‹æ± é€šè¿‡ç¼“å­˜å’Œé‡ç”¨ Thread æå¤§åœ°æé«˜äº†æ€§èƒ½ã€‚ è™½ç„¶æ± åŒ–å’Œé‡ç”¨çº¿ç¨‹ç›¸å¯¹äºç®€å•åœ°ä¸ºæ¯ä¸ªä»»åŠ¡éƒ½åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹æ˜¯ä¸€ç§è¿›æ­¥ï¼Œä½†æ˜¯å®ƒå¹¶ä¸èƒ½ æ¶ˆé™¤ç”±ä¸Šä¸‹æ–‡åˆ‡æ¢æ‰€å¸¦æ¥çš„å¼€é”€ï¼Œå…¶å°†éšç€çº¿ç¨‹æ•°é‡çš„å¢åŠ å¾ˆå¿«å˜å¾—æ˜æ˜¾ï¼Œå¹¶ä¸”åœ¨é«˜è´Ÿè½½ä¸‹æ„ˆæ¼”æ„ˆçƒˆã€‚Netty æ¡†æ¶å¸®åŠ©ç®€åŒ–äº†è¿™ä¸€å¤„ç†ã€‚ EventLoop æ¥å£è¿è¡Œä»»åŠ¡æ¥å¤„ç†åœ¨è¿æ¥çš„ç”Ÿå‘½å‘¨æœŸå†…å‘ç”Ÿçš„äº‹ä»¶æ˜¯ä»»ä½•ç½‘ç»œæ¡†æ¶çš„åŸºæœ¬åŠŸèƒ½ã€‚ä¸ä¹‹ç›¸åº”çš„ç¼–ç¨‹ä¸Šçš„æ„é€ é€šå¸¸è¢«ç§°ä¸ºäº‹ä»¶å¾ªç¯ï¼šNetty ä½¿ç”¨äº† interface io.netty.channel.EventLoop æ¥é€‚é…çš„æœ¯è¯­ã€‚ 1234567// åœ¨äº‹ä»¶å¾ªç¯ä¸­æ‰§è¡Œä»»åŠ¡while (!terminated) &#123; List&lt;Runnable&gt; readyEvents = blockUntilEventsReady(); for (Runnable ev: readyEvents) &#123; ev.run(); &#125; &#125; Netty çš„ EventLoop æ˜¯ååŒè®¾è®¡çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒé‡‡ç”¨äº†ä¸¤ä¸ªåŸºæœ¬çš„ APIï¼šå¹¶å‘å’Œç½‘ç»œç¼–ç¨‹ã€‚é¦–å…ˆï¼Œio.netty.util.concurrent åŒ…æ„å»ºåœ¨ JDK çš„ java.util.concurrent åŒ…ä¸Šï¼Œç”¨æ¥æä¾›çº¿ç¨‹æ‰§è¡Œå™¨ã€‚å…¶æ¬¡ï¼Œio.netty.channel åŒ…ä¸­çš„ç±»ï¼Œä¸ºäº†ä¸ Channel çš„äº‹ä»¶è¿›è¡Œäº¤äº’ï¼Œæ‰©å±•äº†è¿™äº›æ¥å£/ç±»ã€‚ åœ¨è¿™ä¸ªæ¨¡å‹ä¸­ï¼Œä¸€ä¸ª EventLoop å°†ç”±ä¸€ä¸ªæ°¸è¿œéƒ½ä¸ä¼šæ”¹å˜çš„ Thread é©±åŠ¨ï¼ŒåŒæ—¶ä»»åŠ¡ ï¼ˆRunnable æˆ–è€… Callableï¼‰å¯ä»¥ç›´æ¥æäº¤ç»™ EventLoop å®ç°ï¼Œä»¥ç«‹å³æ‰§è¡Œæˆ–è€…è°ƒåº¦æ‰§è¡Œã€‚æ ¹æ®é…ç½®å’Œå¯ç”¨æ ¸å¿ƒçš„ä¸åŒï¼Œå¯èƒ½ä¼šåˆ›å»ºå¤šä¸ª EventLoop å®ä¾‹ç”¨ä»¥ä¼˜åŒ–èµ„æºçš„ä½¿ç”¨ï¼Œå¹¶ä¸”å•ä¸ª EventLoop å¯èƒ½ä¼šè¢«æŒ‡æ´¾ç”¨äºæœåŠ¡å¤šä¸ª Channelã€‚ äº‹ä»¶/ä»»åŠ¡çš„æ‰§è¡Œé¡ºåº ï¼š äº‹ä»¶å’Œä»»åŠ¡æ˜¯ä»¥å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰çš„é¡ºåºæ‰§è¡Œçš„ã€‚è¿™æ ·å¯ä»¥é€šè¿‡ä¿è¯å­—èŠ‚å†…å®¹æ€»æ˜¯æŒ‰æ­£ç¡®çš„é¡ºåºè¢«å¤„ç†ï¼Œæ¶ˆé™¤æ½œåœ¨çš„æ•°æ®æŸåçš„å¯èƒ½æ€§ã€‚ ä»»åŠ¡è°ƒåº¦ä½¿ç”¨æ ¸å¿ƒçš„ Java API å’Œ Netty çš„ EventLoop æ¥è°ƒåº¦ä»»åŠ¡ JDK çš„ä»»åŠ¡è°ƒåº¦ API123456789101112// ä½¿ç”¨ ScheduledExecutorService æ¥åœ¨ 60 ç§’çš„å»¶è¿Ÿä¹‹åæ‰§è¡Œä¸€ä¸ªä»»åŠ¡ScheduledExecutorService executor = Executors.newScheduledThreadPool(10);ScheduledFuture&lt;?&gt; future = executor.schedule( new Runnable() &#123; @Override public void run() &#123; System.out.println(\"60 seconds later\"); &#125; &#125;, 60, TimeUnit.SECONDS); // è°ƒåº¦ä»»åŠ¡åœ¨ä»ç°åœ¨å¼€å§‹çš„ 60 ç§’ä¹‹åæ‰§è¡Œ...;executor.shutdown(); ä½¿ç”¨ EventLoop è°ƒåº¦ä»»åŠ¡12345678910// ä½¿ç”¨ EventLoop æ¥åœ¨ 60 ç§’çš„å»¶è¿Ÿä¹‹åæ‰§è¡Œä¸€ä¸ªä»»åŠ¡Channel ch = ...;ScheduledFuture&lt;?&gt; future = ch.eventLoop().schedule( new Runnable() &#123; @Override public void run() &#123; System.out.println(\"60 seconds later\"); &#125; &#125;, 60, TimeUnit.SECONDS); 123456789101112// ä½¿ç”¨ EventLoop è°ƒåº¦å‘¨æœŸæ€§çš„ä»»åŠ¡Channel ch = ...;ScheduledFuture&lt;?&gt; future = ch.eventLoop().scheduleAtFixedRate( new Runnable() &#123; @Override public void run() &#123; System.out.println(\"Run every 60 seconds\"); &#125; &#125;, 60, 60, TimeUnit.Seconds);// åˆ©ç”¨æ¯ä¸ªå¼‚æ­¥æ“ä½œæ‰€è¿”å›çš„ ScheduledFuture å–æ¶ˆä»»åŠ¡future.cancel(false); å®ç°ç»†èŠ‚æ›´åŠ è¯¦ç»†åœ°æ¢è®¨ Netty çš„çº¿ç¨‹æ¨¡å‹å’Œä»»åŠ¡è°ƒåº¦å®ç°çš„ä¸»è¦å†…å®¹ã€‚ çº¿ç¨‹ç®¡ç†Netty çº¿ç¨‹æ¨¡å‹çš„å“è¶Šæ€§èƒ½å–å†³äºå¯¹äºå½“å‰æ‰§è¡Œçš„ Thread çš„èº«ä»½çš„ç¡®å®šã€‚ æ°¸è¿œä¸è¦å°†ä¸€ä¸ªé•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡æ”¾å…¥åˆ°æ‰§è¡Œé˜Ÿåˆ—ä¸­ï¼Œå› ä¸ºå®ƒå°†é˜»å¡éœ€è¦åœ¨åŒä¸€çº¿ç¨‹ä¸Šæ‰§è¡Œçš„ä»»ä½•å…¶ä»–ä»»åŠ¡ã€‚å¦‚æœå¿…é¡»è¦è¿›è¡Œé˜»å¡è°ƒç”¨æˆ–è€…æ‰§è¡Œé•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡ï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨ä¸€ä¸ªä¸“é—¨çš„ EventExecutorã€‚ EventLoop / çº¿ç¨‹çš„åˆ†é…æœåŠ¡äº Channel çš„ I/O å’Œäº‹ä»¶çš„ EventLoop åŒ…å«åœ¨ EventLoopGroup ä¸­ã€‚æ ¹æ®ä¸åŒçš„ä¼ è¾“å®ç°ï¼ŒEventLoop çš„åˆ›å»ºå’Œåˆ†é…æ–¹å¼ä¹Ÿä¸åŒã€‚ å¼‚æ­¥ä¼ è¾“å¼‚æ­¥ä¼ è¾“å®ç°åªä½¿ç”¨äº†å°‘é‡çš„ EventLoopï¼ˆä»¥åŠå’Œå®ƒä»¬ç›¸å…³è”çš„ Threadï¼‰ï¼Œè€Œä¸”åœ¨å½“å‰çš„çº¿ç¨‹æ¨¡å‹ä¸­ï¼Œå®ƒä»¬å¯èƒ½ä¼šè¢«å¤šä¸ª Channel æ‰€å…±äº«ã€‚è¿™ä½¿å¾—å¯ä»¥é€šè¿‡å°½å¯èƒ½å°‘é‡çš„ Thread æ¥æ”¯æ’‘å¤§é‡çš„ Channelï¼Œè€Œä¸æ˜¯æ¯ä¸ª Channel åˆ†é…ä¸€ä¸ª Threadã€‚ ä¸€æ—¦ä¸€ä¸ª Channel è¢«åˆ†é…ç»™ä¸€ä¸ª EventLoopï¼Œå®ƒå°†åœ¨å®ƒçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­éƒ½ä½¿ç”¨è¿™ä¸ª EventLoopï¼ˆä»¥åŠç›¸å…³è”çš„ Threadï¼‰ã€‚ é˜»å¡ä¼ è¾“è¿™é‡Œæ¯ä¸€ä¸ª Channel éƒ½å°†è¢«åˆ†é…ç»™ä¸€ä¸ª EventLoopï¼ˆä»¥åŠå®ƒçš„ Threadï¼‰ã€‚ æ¯ä¸ª Channel çš„ I/O äº‹ä»¶éƒ½å°†åªä¼šè¢«ä¸€ä¸ª Thread ï¼ˆç”¨äºæ”¯æ’‘è¯¥ Channel çš„ EventLoop çš„é‚£ä¸ª Threadï¼‰å¤„ç†ï¼ˆNetty çš„ä¸€è‡´æ€§ä½“ç°ï¼‰ã€‚","categories":[{"name":"Java","slug":"Java","permalink":"http://yoursite.com/categories/Java/"}],"tags":[{"name":"Netty","slug":"Netty","permalink":"http://yoursite.com/tags/Netty/"}]},{"title":"Netty ChannelHandler å’Œ ChannelPipeline","slug":"Netty/Netty å…¥é—¨/Netty ChannelHandler å’Œ ChannelPipeline","date":"2020-01-24T14:09:35.000Z","updated":"2020-04-19T06:32:46.172Z","comments":true,"path":"2020/01/24/Netty/Netty å…¥é—¨/Netty ChannelHandler å’Œ ChannelPipeline/","link":"","permalink":"http://yoursite.com/2020/01/24/Netty/Netty%20%E5%85%A5%E9%97%A8/Netty%20ChannelHandler%20%E5%92%8C%20ChannelPipeline/","excerpt":"ChannelPipeline ä¸­å°† ChannelHandler é“¾æ¥åœ¨ä¸€èµ·ä»¥ç»„ç»‡å¤„ç†é€»è¾‘ï¼Œè¿˜æœ‰ä¸€ä¸ªé‡è¦çš„å…³ç³» ChannelHandlerContextã€‚","text":"ChannelPipeline ä¸­å°† ChannelHandler é“¾æ¥åœ¨ä¸€èµ·ä»¥ç»„ç»‡å¤„ç†é€»è¾‘ï¼Œè¿˜æœ‰ä¸€ä¸ªé‡è¦çš„å…³ç³» ChannelHandlerContextã€‚ ChannelHandler å®¶æ—Channel çš„ç”Ÿå‘½å‘¨æœŸå½“ Channel çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œå°†ä¼šç”Ÿæˆå¯¹åº”çš„äº‹ä»¶ã€‚è¿™äº›äº‹ä»¶å°†ä¼šè¢«è½¬å‘ç»™ ChannelPipeline ä¸­çš„ ChannelHandlerï¼Œå…¶å¯ä»¥éšåå¯¹å®ƒä»¬åšå‡ºå“åº”ã€‚ ChannelHandler çš„ç”Ÿå‘½å‘¨æœŸ ç±»å‹ æè¿° handlerAdded å½“æŠŠ ChannelHandler æ·»åŠ åˆ° ChannelPipeline ä¸­æ—¶è¢«è°ƒç”¨ handlerRemoved å½“ä» ChannelPipeline ä¸­ç§»é™¤ ChannelHandler æ—¶è¢«è°ƒç”¨ exceptionCaught å½“å¤„ç†è¿‡ç¨‹ä¸­åœ¨ ChannelPipeline ä¸­æœ‰é”™è¯¯äº§ç”Ÿæ—¶è¢«è°ƒç”¨ Netty å®šä¹‰äº†ä¸¤ä¸ªé‡è¦çš„ Channelhandler å­æ¥å£ï¼š ChannelInboundHandlerâ€”â€”å¤„ç†å…¥ç«™æ•°æ®ä»¥åŠå„ç§çŠ¶æ€å˜åŒ–ï¼› ChannelOutboundHandlerâ€”â€”å¤„ç†å‡ºç«™æ•°æ®å¹¶ä¸”å…è®¸æ‹¦æˆªæ‰€æœ‰çš„æ“ä½œã€‚ ChannelInboundHandler æ¥å£12345678910// é‡Šæ”¾æ¶ˆæ¯èµ„æº@Sharable// æ‰©å±•äº† ChannelInboundHandlerAdapterpublic class DiscardHandler extends ChannelInboundHandlerAdapter &#123; @Override public void channelRead(ChannelHandlerContext ctx, Object msg) &#123; // ä¸¢å¼ƒå·²æ¥æ”¶çš„æ¶ˆæ¯ ReferenceCountUtil.release(msg); &#125; &#125; 123456789// ä½¿ç”¨ SimpleChannelInboundHandler ä¼šè‡ªåŠ¨é‡Šæ”¾èµ„æº@Sharablepublic class SimpleDiscardHandler extends SimpleChannelInboundHandler&lt;Object&gt; &#123; @Override public void channelRead0(ChannelHandlerContext ctx, Object msg) &#123; // ä¸éœ€è¦ä»»ä½•æ˜¾å¼çš„èµ„æºé‡Šæ”¾ // No need to do anything special &#125; &#125; ChannelOutboundHandler æ¥å£ChannelOutboundHandler çš„ä¸€ä¸ªå¼ºå¤§çš„åŠŸèƒ½æ˜¯å¯ä»¥æŒ‰éœ€æ¨è¿Ÿæ“ä½œæˆ–è€…äº‹ä»¶ï¼Œè¿™ä½¿å¾—å¯ ä»¥é€šè¿‡ä¸€äº›å¤æ‚çš„æ–¹æ³•æ¥å¤„ç†è¯·æ±‚ã€‚ ChannelPromise ä¸ ChannelFutureï¼šChannelOutboundHandler ä¸­çš„å¤§éƒ¨åˆ†æ–¹æ³•éƒ½éœ€è¦ä¸€ä¸ª ChannelPromise å‚æ•°ï¼Œä»¥ä¾¿åœ¨æ“ä½œå®Œæˆæ—¶å¾—åˆ°é€šçŸ¥ã€‚ChannelPromise æ˜¯ ChannelFuture çš„ä¸€ä¸ªå­ç±»ï¼Œå…¶å®šä¹‰äº†ä¸€äº›å¯å†™çš„æ–¹æ³•ï¼Œå¦‚ setSuccess() å’Œ setFailure()ï¼Œä»è€Œä½¿ ChannelFuture ä¸å¯å˜ã€‚ ChannelHandler é€‚é…å™¨é€‚é…å™¨å¯¹ ChannelHandler è¿›è¡Œäº†ç®€å•çš„å®ç°ï¼Œåªéœ€è¦ç®€å•åœ°æ‰©å±•å®ƒä»¬ï¼Œå¹¶ä¸”é‡å†™é‚£äº›ä½ æƒ³è¦è‡ªå®šä¹‰çš„æ–¹æ³•ã€‚ ChannelInboundHandlerAdapter å’Œ ChannelOutboundHandlerAdapter ä¸­æ‰€æä¾›çš„æ–¹æ³•ä½“è°ƒç”¨äº†å…¶ç›¸å…³è”çš„ ChannelHandlerContext ä¸Šçš„ç­‰æ•ˆæ–¹æ³•ï¼Œä»è€Œå°†äº‹ä»¶è½¬å‘åˆ°äº† ChannelPipeline ä¸­çš„ä¸‹ä¸€ä¸ª ChannelHandler ä¸­ã€‚ èµ„æºç®¡ç†æ¯å½“é€šè¿‡è°ƒç”¨ ChannelInboundHandler.channelRead() æˆ–è€… ChannelOutboundHandler.write() æ–¹æ³•æ¥å¤„ç†æ•°æ®æ—¶ï¼Œä½ éƒ½éœ€è¦ç¡®ä¿æ²¡æœ‰ä»»ä½•çš„èµ„æºæ³„æ¼ã€‚ Netty ä½¿ç”¨å¼•ç”¨è®¡æ•°æ¥å¤„ç†æ± åŒ–çš„ ByteBufã€‚æ‰€ä»¥åœ¨å®Œå…¨ä½¿ç”¨å®ŒæŸä¸ª ByteBuf åï¼Œè°ƒæ•´å…¶å¼•ç”¨è®¡æ•°æ˜¯å¾ˆé‡è¦çš„ã€‚ 123456789101112// ä¸¢å¼ƒå¹¶é‡Šæ”¾å‡ºæˆ˜æ¶ˆæ¯@Sharablepublic class DiscardOutboundHandler extends ChannelOutboundHandlerAdapter &#123; @Override public void write(ChannelHandlerContext ctx, Object msg, ChannelPromise promise) &#123; // é‡Šæ”¾èµ„æº ReferenceCountUtil.release(msg); // é€šçŸ¥ ChannelPromise æ•°æ®å·²ç»è¢«å¤„ç†äº† promise.setSuccess(); &#125;&#125; é‡è¦çš„æ˜¯ï¼Œä¸ä»…è¦é‡Šæ”¾èµ„æºï¼Œè¿˜è¦é€šçŸ¥ ChannelPromiseã€‚å¦åˆ™å¯èƒ½ä¼šå‡ºç° ChannelFutureListener æ”¶ä¸åˆ°æŸä¸ªæ¶ˆæ¯å·²ç»è¢«å¤„ç†äº†çš„é€šçŸ¥çš„æƒ…å†µã€‚ å¦‚æœä¸€ä¸ªæ¶ˆæ¯è¢«æ¶ˆè´¹æˆ–è€…ä¸¢å¼ƒäº†ï¼Œå¹¶ä¸”æ²¡æœ‰ä¼ é€’ç»™ ChannelPipeline ä¸­çš„ä¸‹ä¸€ä¸ª ChannelOutboundHandlerï¼Œé‚£ä¹ˆç”¨æˆ·å°±æœ‰è´£ä»»è°ƒç”¨ ReferenceCountUtil.release()ã€‚ ChannelPipeline æ¥å£æ¯ä¸€ä¸ªæ–°åˆ›å»ºçš„ Channel éƒ½å°†ä¼šè¢«åˆ†é…ä¸€ä¸ªæ–°çš„ ChannelPipelineã€‚è¿™é¡¹å…³è”æ˜¯æ°¸ä¹…æ€§çš„ï¼›Channel æ—¢ä¸èƒ½é™„åŠ å¦å¤–ä¸€ä¸ª ChannelPipelineï¼Œä¹Ÿä¸èƒ½åˆ†ç¦»å…¶å½“å‰çš„ã€‚ æ ¹æ®äº‹ä»¶çš„èµ·æºï¼Œäº‹ä»¶å°†ä¼šè¢« ChannelInboundHandler æˆ–è€… ChannelOutboundHandler å¤„ç†ã€‚éšåï¼Œé€šè¿‡è°ƒç”¨ ChannelHandlerContext å®ç°ï¼Œå®ƒå°†è¢«è½¬å‘ç»™åŒä¸€è¶…ç±»å‹çš„ä¸‹ä¸€ä¸ª ChannelHandlerã€‚ ä¿®æ”¹ ChannelPipelineChannelHandler å¯ä»¥é€šè¿‡æ·»åŠ  addXxx()ã€åˆ é™¤ remove() æˆ–è€…æ›¿æ¢ replace() å…¶ä»–çš„ ChannelHandler æ¥å®æ—¶åœ°ä¿®æ”¹ ChannelPipeline çš„å¸ƒå±€ã€‚ ChannelHandler çš„æ‰§è¡Œå’Œé˜»å¡ é€šå¸¸ ChannelPipeline ä¸­çš„æ¯ä¸€ä¸ª ChannelHandler éƒ½æ˜¯é€šè¿‡å®ƒçš„ EventLoopï¼ˆI/O çº¿ç¨‹ï¼‰æ¥å¤„ç†ä¼ é€’ç»™å®ƒçš„äº‹ä»¶çš„ã€‚æ‰€ä»¥è‡³å…³é‡è¦çš„æ˜¯ä¸è¦é˜»å¡è¿™ä¸ªçº¿ç¨‹ï¼Œå› ä¸ºè¿™ä¼šå¯¹æ•´ä½“çš„ I/O å¤„ç†äº§ç”Ÿè´Ÿé¢çš„å½±å“ã€‚ ä½†æœ‰æ—¶å¯èƒ½éœ€è¦ä¸é‚£äº›ä½¿ç”¨é˜»å¡ API çš„é—ç•™ä»£ç è¿›è¡Œäº¤äº’ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼ŒChannelPipeline æœ‰ä¸€äº›æ¥å—ä¸€ä¸ª EventExecutorGroup çš„ add()æ–¹æ³•ã€‚å¦‚æœä¸€ä¸ªäº‹ä»¶è¢«ä¼ é€’ç»™ä¸€ä¸ªè‡ªå®šä¹‰çš„ EventExecutorGroupï¼Œå®ƒå°†è¢«åŒ…å«åœ¨è¿™ä¸ª EventExecutorGroup ä¸­çš„æŸä¸ª EventExecutor æ‰€å¤„ç†ï¼Œä»è€Œè¢«ä»è¯¥ Channel æœ¬èº«çš„ EventLoop ä¸­ç§»é™¤ã€‚å¯¹äºè¿™ç§ç”¨ä¾‹ï¼ŒNetty æä¾›äº†ä¸€ä¸ªå« DefaultEventExecutorGroup çš„é»˜è®¤å®ç°ã€‚ getXxx()ï¼šé€šè¿‡ç±»å‹æˆ–è€…åç§°æ¥è®¿é—® ChannelHandler çš„æ–¹æ³•ã€‚ context()ï¼šè¿”å›å’Œ ChannelHandler ç»‘å®šçš„ ChannelHandlerContextã€‚ names()ï¼šè¿”å› ChannelPipeline ä¸­æ‰€æœ‰ ChannelHandler çš„åç§°ã€‚ è§¦å‘äº‹ä»¶ChannelPipeline çš„ API å…¬å¼€äº†ç”¨äºè°ƒç”¨å…¥ç«™å’Œå‡ºç«™æ“ä½œçš„é™„åŠ æ–¹æ³•ã€‚ å°ç»“ ChannelPipeline ä¿å­˜äº†ä¸ Channel ç›¸å…³è”çš„ ChannelHandlerï¼› ChannelPipeline å¯ä»¥æ ¹æ®éœ€è¦ï¼Œé€šè¿‡æ·»åŠ æˆ–è€…åˆ é™¤ ChannelHandler æ¥åŠ¨æ€åœ°ä¿®æ”¹ï¼› ChannelPipeline æœ‰ç€ä¸°å¯Œçš„ API ç”¨ä»¥è¢«è°ƒç”¨ï¼Œä»¥å“åº”å…¥ç«™å’Œå‡ºç«™äº‹ä»¶ã€‚ ChannelHandlerContext æ¥å£ChannelHandlerContext ä»£è¡¨äº† ChannelHandler å’Œ ChannelPipeline ä¹‹é—´çš„å…³è”ï¼Œæ¯å½“æœ‰ ChannelHandler æ·»åŠ åˆ° ChannelPipeline ä¸­æ—¶ï¼Œéƒ½ä¼šåˆ›å»º ChannelHandlerContextã€‚ ChannelHandlerContext çš„ä¸»è¦åŠŸèƒ½æ˜¯ç®¡ç†å®ƒæ‰€å…³è”çš„ ChannelHandler å’Œåœ¨åŒä¸€ä¸ª ChannelPipeline ä¸­çš„å…¶ä»– ChannelHandler ä¹‹é—´çš„äº¤äº’ã€‚ ChannelHandlerContext å’Œ ChannelHandler ä¹‹é—´çš„å…³è”ï¼ˆç»‘å®šï¼‰æ˜¯æ°¸è¿œä¸ä¼šæ”¹å˜çš„ï¼Œæ‰€ä»¥ç¼“å­˜å¯¹å®ƒçš„å¼•ç”¨æ˜¯å®‰å…¨çš„ï¼› ä½¿ç”¨ ChannelHandlerContextChannelã€ChannelPipelineã€ChannelHandler ä»¥åŠ ChannelHandlerContext ä¹‹é—´çš„å…³ç³» 1234// ä» ChannelHandlerContext è®¿é—® ChannelChannelHandlerContext ctx = ..;Channel channel = ctx.channel();channel.write(Unpooled.copiedBuffer(\"Netty in Action\", CharsetUtil.UTF_8)); 1234// é€šè¿‡ ChannelHandlerContext è®¿é—® ChannelPipelineChannelHandlerContext ctx = ..;ChannelPipeline pipeline = ctx.pipeline();pipeline.write(Unpooled.copiedBuffer(\"Netty in Action\", CharsetUtil.UTF_8)); é‡è¦çš„æ˜¯è¦æ³¨æ„åˆ°ï¼Œè™½ç„¶è¢«è°ƒç”¨çš„ Channel æˆ– ChannelPipeline ä¸Šçš„ write()æ–¹æ³•å°†ä¸€ç›´ä¼ æ’­äº‹ä»¶é€š è¿‡æ•´ä¸ª ChannelPipelineï¼Œä½†æ˜¯åœ¨ ChannelHandler çš„çº§åˆ«ä¸Šï¼Œäº‹ä»¶ä»ä¸€ä¸ª ChannelHandler åˆ°ä¸‹ä¸€ä¸ª ChannelHandler çš„ç§»åŠ¨æ˜¯ç”± ChannelHandlerContext ä¸Šçš„è°ƒç”¨å®Œæˆçš„. 1234// è°ƒç”¨ ChannelHandlerContext çš„ write()æ–¹æ³•ChannelHandlerContext ctx = ..;// write()æ–¹æ³•å°†æŠŠç¼“å†²åŒºæ•°æ®å‘é€åˆ°ä¸‹ä¸€ä¸ª ChannelHandlerctx.write(Unpooled.copiedBuffer(\"Netty in Action\", CharsetUtil.UTF_8)); é«˜çº§ç”¨æ³•ç¼“å­˜ ChannelHandlerContext çš„å¼•ç”¨ä»¥ä¾›ç¨åä½¿ç”¨ï¼Œè¿™å¯èƒ½ä¼šå‘ç”Ÿåœ¨ä»»ä½•çš„ ChannelHandler æ–¹æ³•ä¹‹å¤–ï¼Œç”šè‡³æ¥è‡ªäºä¸åŒçš„çº¿ç¨‹ã€‚ 12345678910111213// ç¼“å­˜åˆ° ChannelHandlerContext çš„å¼•ç”¨public class WriteHandler extends ChannelHandlerAdapter &#123; private ChannelHandlerContext ctx; @Override public void handlerAdded(ChannelHandlerContext ctx) &#123; //å­˜å‚¨åˆ° ChannelHandlerContext çš„å¼•ç”¨ä»¥ä¾›ç¨åä½¿ç”¨ this.ctx = ctx; &#125; public void send(String msg) &#123; // ä½¿ç”¨ä¹‹å‰å­˜å‚¨çš„åˆ° ChannelHandlerContext çš„å¼•ç”¨æ¥å‘é€æ¶ˆæ¯ ctx.writeAndFlush(msg); &#125; &#125; å› ä¸ºä¸€ä¸ª ChannelHandler å¯ä»¥ä»å±äºå¤šä¸ª ChannelPipelineï¼Œæ‰€ä»¥å®ƒä¹Ÿå¯ä»¥ç»‘å®šåˆ°å¤šä¸ª ChannelHandlerContext å®ä¾‹ã€‚å¯¹äºè¿™ç§ç”¨æ³•æŒ‡åœ¨å¤šä¸ª ChannelPipeline ä¸­å…±äº«åŒä¸€ ä¸ª ChannelHandlerï¼Œå¯¹åº”çš„ ChannelHandler å¿…é¡»è¦ä½¿ç”¨ @Sharable æ³¨è§£æ ‡æ³¨ï¼›å¦åˆ™ï¼Œ è¯•å›¾å°†å®ƒæ·»åŠ åˆ°å¤šä¸ª ChannelPipeline æ—¶å°†ä¼šè§¦å‘å¼‚å¸¸ã€‚æ˜¾è€Œæ˜“è§ï¼Œä¸ºäº†å®‰å…¨åœ°è¢«ç”¨äºå¤šä¸ª å¹¶å‘çš„ Channelï¼ˆå³è¿æ¥ï¼‰ï¼Œè¿™æ ·çš„ ChannelHandler å¿…é¡»æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ 123456789// å¯å…±äº«çš„ ChannelHandler@Sharable public class SharableHandler extends ChannelInboundHandlerAdapter &#123; @Override public void channelRead(ChannelHandlerContext ctx, Object msg) &#123; System.out.println(\"Channel read message: \" + msg); ctx.fireChannelRead(msg); &#125; &#125; å¼‚å¸¸å¤„ç†Netty æä¾›äº†å‡ ç§æ–¹å¼ç”¨äºå¤„ç†å…¥ç«™æˆ–è€…å‡ºç«™å¤„ç†è¿‡ç¨‹ä¸­æ‰€æŠ›å‡ºçš„å¼‚å¸¸ã€‚ å¤„ç†å…¥ç«™å¼‚å¸¸12345678// åŸºæœ¬çš„å…¥ç«™å¼‚å¸¸å¤„ç†public class InboundExceptionHandler extends ChannelInboundHandlerAdapter &#123; @Override public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) &#123; cause.printStackTrace(); ctx.close(); &#125; &#125; å¤„ç†å‡ºç«™å¼‚å¸¸å‡ºç«™çš„å¼‚å¸¸å¤„ç†åŸºäºä¸€ä¸‹é€šçŸ¥æœºåˆ¶ï¼š æ¯ä¸ªå‡ºç«™æ“ä½œéƒ½å°†è¿”å›ä¸€ä¸ª ChannelFutureã€‚æ³¨å†Œåˆ° ChannelFuture çš„ ChannelFutureListener å°†åœ¨æ“ä½œå®Œæˆæ—¶è¢«é€šçŸ¥è¯¥æ“ä½œæ˜¯æˆåŠŸäº†è¿˜æ˜¯å‡ºé”™äº†ã€‚ å‡ ä¹æ‰€æœ‰çš„ ChannelOutboundHandler ä¸Šçš„æ–¹æ³•éƒ½ä¼šä¼ å…¥ä¸€ä¸ª ChannelPromise çš„å®ä¾‹ã€‚ä½œä¸º ChannelFuture çš„å­ç±»ï¼ŒChannelPromise ä¹Ÿå¯ä»¥è¢«åˆ†é…ç”¨äºå¼‚æ­¥é€šçŸ¥çš„ç›‘å¬å™¨ã€‚ä½†æ˜¯ï¼ŒChannelPromise è¿˜å…·æœ‰æä¾›ç«‹å³é€šçŸ¥çš„å¯å†™æ–¹æ³•ã€‚ ChannelPromise çš„å¯å†™æ–¹æ³• é€šè¿‡è°ƒç”¨ ChannelPromise ä¸Šçš„ setSuccess() å’Œ setFailure() æ–¹æ³•ï¼Œå¯ä»¥ä½¿ä¸€ä¸ªæ“ä½œçš„çŠ¶æ€åœ¨ ChannelHandler çš„æ–¹æ³•è¿”å›ç»™å…¶è°ƒç”¨è€…æ—¶ä¾¿å³åˆ»è¢«æ„ŸçŸ¥åˆ°ã€‚ 12345678910// æ·»åŠ  ChannelFutureListener åˆ° ChannelFutureChannelFuture future = channel.write(someMessage);future.addListener(new ChannelFutureListener() &#123; @Override public void operationComplete(ChannelFuture f) &#123; if (!f.isSuccess()) &#123; f.cause().printStackTrace(); f.channel().close(); &#125; &#125;&#125;); 123456789101112131415// æ·»åŠ  ChannelFutureListener åˆ° ChannelPromisepublic class OutboundExceptionHandler extends ChannelOutboundHandlerAdapter &#123; @Override public void write(ChannelHandlerContext ctx, Object msg, ChannelPromise promise) &#123; promise.addListener(new ChannelFutureListener() &#123; @Override public void operationComplete(ChannelFuture f) &#123; if (!f.isSuccess()) &#123; f.cause().printStackTrace(); f.channel().close(); &#125; &#125; &#125;); &#125; &#125;","categories":[{"name":"Java","slug":"Java","permalink":"http://yoursite.com/categories/Java/"}],"tags":[{"name":"Netty","slug":"Netty","permalink":"http://yoursite.com/tags/Netty/"}]},{"title":"Netty ByteBuf","slug":"Netty/Netty å…¥é—¨/Netty ByteBuf","date":"2020-01-24T03:29:09.000Z","updated":"2020-04-19T06:32:38.747Z","comments":true,"path":"2020/01/24/Netty/Netty å…¥é—¨/Netty ByteBuf/","link":"","permalink":"http://yoursite.com/2020/01/24/Netty/Netty%20%E5%85%A5%E9%97%A8/Netty%20ByteBuf/","excerpt":"æ€»æ‰€å‘¨çŸ¥ï¼Œç½‘ç»œæ•°æ®çš„åŸºæœ¬å•ä½æ€»æ˜¯å­—èŠ‚ã€‚Java NIO æä¾›äº† ByteBuffer ä½œä¸ºå®ƒçš„å­—èŠ‚å®¹å™¨ï¼Œä½†æ˜¯è¿™ä¸ªç±»ä½¿ç”¨èµ·æ¥è¿‡äºå¤æ‚ï¼Œè€Œä¸”ä¹Ÿæœ‰äº›ç¹çã€‚å› æ­¤ï¼ŒNetty æä¾›äº†ä¸€ä¸ªæ›¿ä»£å“ ByteBufï¼Œä¸€ä¸ªå¼ºå¤§çš„å®ç°ï¼Œæ—¢è§£å†³äº† JDK API çš„å±€é™æ€§ï¼Œåˆä¸ºç½‘ç»œåº”ç”¨ç¨‹åºçš„å¼€å‘è€…æä¾›äº†æ›´å¥½çš„ APIã€‚","text":"æ€»æ‰€å‘¨çŸ¥ï¼Œç½‘ç»œæ•°æ®çš„åŸºæœ¬å•ä½æ€»æ˜¯å­—èŠ‚ã€‚Java NIO æä¾›äº† ByteBuffer ä½œä¸ºå®ƒçš„å­—èŠ‚å®¹å™¨ï¼Œä½†æ˜¯è¿™ä¸ªç±»ä½¿ç”¨èµ·æ¥è¿‡äºå¤æ‚ï¼Œè€Œä¸”ä¹Ÿæœ‰äº›ç¹çã€‚å› æ­¤ï¼ŒNetty æä¾›äº†ä¸€ä¸ªæ›¿ä»£å“ ByteBufï¼Œä¸€ä¸ªå¼ºå¤§çš„å®ç°ï¼Œæ—¢è§£å†³äº† JDK API çš„å±€é™æ€§ï¼Œåˆä¸ºç½‘ç»œåº”ç”¨ç¨‹åºçš„å¼€å‘è€…æä¾›äº†æ›´å¥½çš„ APIã€‚ ByteBuf çš„ APINetty çš„æ•°æ®å¤„ç† API é€šè¿‡ä¸¤ä¸ªç»„ä»¶æš´éœ²ï¼šabstract class ByteBuf å’Œ interface ByteBufHolderã€‚ ByteBuf ç±»ByteBuf ç±»æ˜¯ Netty çš„æ•°æ®å®¹å™¨ï¼Œé€šè¿‡ä½¿ç”¨ä¸åŒçš„ç´¢å¼•æ¥ç®€åŒ–å¯¹å®ƒæ‰€åŒ…å«çš„æ•°æ®çš„è®¿é—®ã€‚ HowByteBuf ç»´æŠ¤äº†ä¸¤ä¸ªä¸åŒçš„ç´¢å¼•ï¼šä¸€ä¸ªç”¨äºè¯»å–ï¼Œä¸€ä¸ªç”¨äºå†™å…¥ã€‚è¯»å–æ—¶ï¼ŒreaderIndex å°†ä¼šè¢«é€’å¢å·²ç»è¢«è¯»å–çš„å­—èŠ‚æ•°ï¼›å†™å…¥æ—¶ï¼ŒwriterIndex ä¹Ÿä¼šè¢«é€’å¢ã€‚readerIndex == writerIndex æ—¶åˆ™åˆ°è¾¾å¯è¯»å–æ•°æ®çš„æœ«å°¾ã€‚ åç§°ä»¥ read æˆ–è€… write å¼€å¤´çš„ ByteBuf æ–¹æ³•ï¼Œå°†ä¼šæ¨è¿›å…¶å¯¹åº”çš„ç´¢å¼•ï¼Œè€Œåç§°ä»¥ set æˆ–è€… get å¼€å¤´çš„æ“ä½œåˆ™ä¸ä¼šã€‚åé¢çš„è¿™äº›æ–¹æ³•å°†åœ¨ä½œä¸ºä¸€ä¸ªå‚æ•°ä¼ å…¥çš„ä¸€ä¸ªç›¸å¯¹ç´¢å¼•ä¸Šæ‰§è¡Œæ“ä½œã€‚ Modeåœ¨ä½¿ç”¨ Netty æ—¶ï¼Œæœ‰å‡ ç§å¸¸è§çš„å›´ç»• ByteBuf è€Œæ„å»ºçš„ä½¿ç”¨æ¨¡å¼ã€‚ å †ç¼“å†²åŒºæœ€å¸¸ç”¨çš„ ByteBuf æ¨¡å¼æ˜¯å°†æ•°æ®å­˜å‚¨åœ¨ JVM çš„å †ç©ºé—´ä¸­ã€‚è¿™ç§æ¨¡å¼è¢«ç§°ä¸ºæ”¯æ’‘æ•°ç»„ã€‚ 12345678910111213// æ”¯æ’‘æ•°ç»„ByteBuf heapBuf = ...;// æ£€æŸ¥ ByteBuf æ˜¯å¦æœ‰ä¸€ä¸ªæ”¯æ’‘æ•°ç»„if (heapBuf.hasArray()) &#123; // è·å–å¯¹è¯¥æ•°ç»„çš„å¼•ç”¨ byte[] array = heapBuf.array(); // è®¡ç®—ç¬¬ä¸€ä¸ªå­—èŠ‚çš„åç§»é‡ int offset = heapBuf.arrayOffset() + heapBuf.readerIndex(); // è·å–å¯è¯»å­—èŠ‚æ•° int length = heapBuf.readableBytes(); // ä½¿ç”¨è·å–çš„ä¿¡æ¯ä½œä¸ºå‚æ•°è°ƒç”¨è‡ªå®šä¹‰æ–¹æ³• handleArray(array, offset, length);&#125; ç›´æ¥ç¼“å†²åŒºï¼ˆUpdatingï¼‰å¤åˆç¼“å†²å™¨ï¼ˆUpdatingï¼‰å­—èŠ‚çº§æ“ä½œByteBuf æä¾›äº†è®¸å¤šè¶…å‡ºåŸºæœ¬è¯»ã€å†™æ“ä½œçš„æ–¹æ³•ç”¨äºä¿®æ”¹å®ƒçš„æ•°æ®ã€‚ éšæœºè®¿é—®ç´¢å¼•123456// è®¿é—®æ•°æ®ByteBuf buffer = ...;for (int i = 0; i &lt; buffer.capacity(); i++) &#123; byte b = buffer.getByte(i); System.out.println((char)b);&#125; é¡ºåºè®¿é—®ç´¢å¼•è™½ç„¶ ByteBuf åŒæ—¶å…·æœ‰è¯»ç´¢å¼•å’Œå†™ç´¢å¼•ï¼Œä½†æ˜¯ JDK çš„ ByteBuffer å´åªæœ‰ä¸€ä¸ªç´¢å¼•ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆå¿…é¡»è°ƒç”¨ flip() æ–¹æ³•æ¥åœ¨è¯»æ¨¡å¼å’Œå†™æ¨¡å¼ä¹‹é—´è¿›è¡Œåˆ‡æ¢çš„åŸå›  ByteBuf çš„å†…éƒ¨åˆ†æ®µ å¯ä¸¢å¼ƒå­—èŠ‚å¯ä¸¢å¼ƒå­—èŠ‚çš„åˆ†æ®µåŒ…å«äº†å·²ç»è¢«è¯»è¿‡çš„å­—èŠ‚ã€‚é€šè¿‡è°ƒç”¨ discardReadBytes() æ–¹æ³•ï¼Œå¯ä»¥ä¸¢å¼ƒå®ƒä»¬å¹¶å›æ”¶ç©ºé—´ã€‚è¿™ä¸ªåˆ†æ®µçš„åˆå§‹å¤§å°ä¸º 0ï¼Œå­˜å‚¨åœ¨ readerIndex ä¸­ï¼Œä¼šéšç€ read æ“ä½œçš„æ‰§è¡Œè€Œå¢åŠ ï¼ˆget*æ“ä½œä¸ä¼šç§»åŠ¨ readerIndexï¼‰ã€‚ å¯è¯»å­—èŠ‚ByteBuf çš„å¯è¯»å­—èŠ‚åˆ†æ®µå­˜å‚¨äº†å®é™…æ•°æ®ã€‚ 12345// è¯»å–æ‰€æœ‰æ•°æ®ByteBuf buffer = ...;while (buffer.isReadable()) &#123; System.out.println(buffer.readByte());&#125; å¯å†™å­—èŠ‚å¯å†™å­—èŠ‚åˆ†æ®µæ˜¯æŒ‡ä¸€ä¸ªæ‹¥æœ‰æœªå®šä¹‰å†…å®¹çš„ã€å†™å…¥å°±ç»ªçš„å†…å­˜åŒºåŸŸã€‚ 12345// å†™æ•°æ®ByteBuf buffer = ...;while (buffer.writableBytes() &gt;= 4) &#123; buffer.writeInt(random.nextInt());&#125; ç´¢å¼•ç®¡ç†å¯ä»¥é€šè¿‡è°ƒç”¨ markReaderIndex()ã€markWriterIndex()ã€resetWriterIndex() å’Œ resetReaderIndex() æ¥æ ‡è®°å’Œé‡ç½® ByteBuf çš„ readerIndex å’Œ writerIndexã€‚ ä¹Ÿå¯ä»¥é€šè¿‡è°ƒç”¨ readerIndex(int) æˆ–è€… writerIndex(int) æ¥å°†ç´¢å¼•ç§»åŠ¨åˆ°æŒ‡å®šä½ç½®ã€‚è¯•å›¾å°†ä»»ä½•ä¸€ä¸ªç´¢å¼•è®¾ç½®åˆ°ä¸€ä¸ªæ— æ•ˆçš„ä½ç½®éƒ½å°†å¯¼è‡´ä¸€ä¸ª IndexOutOfBoundsExceptionã€‚ å¯ä»¥é€šè¿‡è°ƒç”¨ clear()æ–¹æ³•æ¥å°† readerIndex å’Œ writerIndex éƒ½è®¾ç½®ä¸º 0ï¼ˆä¸ä¼šæ¸…é™¤å†…å­˜ä¸­çš„å†…å®¹ï¼‰ã€‚ æŸ¥æ‰¾æ“ä½œï¼ˆUpdatingï¼‰123// ä½¿ç”¨ ByteBufProcessor æ¥å¯»æ‰¾\\rByteBuf buffer = ...;int index = buffer.forEachByte(ByteBufProcessor.FIND_CR); æ´¾ç”Ÿç¼“å†²åŒºæ´¾ç”Ÿç¼“å†²åŒºä¸º ByteBuf æä¾›äº†ä»¥ä¸“é—¨çš„æ–¹å¼æ¥å‘ˆç°å…¶å†…å®¹çš„è§†å›¾ã€‚ä¿®æ”¹äº†å…¶ä¸­ä¸€ä¸ªï¼Œæºå®ä¾‹ä¹Ÿä¼šè¢«ä¿®æ”¹ï¼ˆå…±äº«ï¼‰ã€‚ 12345678910// å¯¹ ByteBuf è¿›è¡Œåˆ‡ç‰‡Charset utf8 = Charset.forName(\"UTF-8\");ByteBuf buf = Unpooled.copiedBuffer(\"Netty in Action rocks!\", utf8);ByteBuf sliced = buf.slice(0, 15);// æ‰“å° Netty in ActionSystem.out.println(sliced.toString(utf8));// æ›´æ”¹ç´¢å¼• 0 å¤„çš„å­—èŠ‚buf.setByte(0, (byte)'J');// True å› ä¸ºæ•°æ®æ˜¯å…±äº«å…³ç³»assert buf.getByte(0) == sliced.getByte(0); ByteBuf å¤åˆ¶ å¦‚æœéœ€è¦ä¸€ä¸ªç°æœ‰ç¼“å†²åŒºçš„çœŸå®å‰¯æœ¬ï¼Œè¯·ä½¿ç”¨ copy() æˆ–è€… copy(int, int) æ–¹æ³•ã€‚ä¸åŒäºæ´¾ç”Ÿç¼“å†²åŒºï¼Œç”±è¿™ä¸ªè°ƒç”¨æ‰€è¿”å›çš„ ByteBuf æ‹¥æœ‰ç‹¬ç«‹çš„æ•°æ®å‰¯æœ¬ 12345678// å¤åˆ¶ä¸€ä¸ª ByteBufCharset utf8 = Charset.forName(\"UTF-8\");ByteBuf buf = Unpooled.copiedBuffer(\"Netty in Action rocks!\", utf8);ByteBuf copy = buf.copy(0, 15);System.out.println(copy.toString(utf8));buf.setByte(0, (byte) 'J');// True å› ä¸ºæ•°æ®æ˜¯éå…±äº«å…³ç³»assert buf.getByte(0) != copy.getByte(0); é™¤äº†ä¿®æ”¹åŸå§‹ ByteBuf çš„åˆ‡ç‰‡æˆ–è€…å‰¯æœ¬çš„æ•ˆæœä»¥å¤–ï¼Œè¿™ä¸¤ç§åœºæ™¯æ˜¯ç›¸åŒçš„ã€‚åªè¦æœ‰å¯èƒ½ï¼Œ ä½¿ç”¨ slice() æ–¹æ³•æ¥é¿å…å¤åˆ¶å†…å­˜çš„å¼€é”€ã€‚ è¯»å†™æ“ä½œgetXxx() å’Œ setXxx() æ“ä½œï¼Œä»ç»™å®šçš„ç´¢å¼•å¼€å§‹ï¼Œå¹¶ä¸”ä¿æŒç´¢å¼•ä¸å˜ã€‚ 12345678910111213// getXxx() And setXxx()Charset utf8 = Charset.forName(\"UTF-8\");ByteBuf buf = Unpooled.copiedBuffer(\"Netty in Action rocks!\", utf8);// æ‰“å°ç¬¬ä¸€ä¸ªå­—ç¬¦ NSystem.out.println((char)buf.getByte(0));int readerIndex = buf.readerIndex();int writerIndex = buf.writerIndex();// æ›´æ”¹ç´¢å¼• 0 å¤„çš„å­—èŠ‚buf.setByte(0, (byte)'B');System.out.println((char)buf.getByte(0));// True ä¸ä¼šå½±å“ç›¸åº”çš„ç´¢å¼•assert readerIndex == buf.readerIndex();assert writerIndex == buf.writerIndex(); readXxx() å’Œ writeXxx() æ“ä½œï¼Œä»ç»™å®šçš„ç´¢å¼•å¼€å§‹ï¼Œå¹¶ä¸”ä¼šæ ¹æ®å·²ç»è®¿é—®è¿‡çš„å­—èŠ‚æ•°å¯¹ç´¢ å¼•è¿›è¡Œè°ƒæ•´ã€‚ 1234567891011// readXxx() And writeXxx()Charset utf8 = Charset.forName(\"UTF-8\");ByteBuf buf = Unpooled.copiedBuffer(\"Netty in Action rocks!\", utf8);System.out.println((char)buf.readByte());int readerIndex = buf.readerIndex();int writerIndex = buf.writerIndex();// å°†å­—ç¬¦ ï¼Ÿ è¿½åŠ åˆ°ç¼“å­˜åŒºï¼ŒwriterIndex æ”¹å˜buf.writeByte((byte)'?');// Trueassert readerIndex == buf.readerIndex();assert writerIndex != buf.writerIndex(); ByteBufHolder æ¥å£å¦‚æœæƒ³è¦å®ç°ä¸€ä¸ªå°†å…¶æœ‰æ•ˆè´Ÿè½½å­˜å‚¨åœ¨ ByteBuf ä¸­çš„æ¶ˆæ¯å¯¹è±¡ï¼Œé‚£ä¹ˆ ByteBufHolder å°†æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ã€‚ ByteBuf åˆ†é…å¸¸è§çš„å‡ ç§ç®¡ç† ByteBuf å®ä¾‹çš„ä¸åŒæ–¹å¼ã€‚ æŒ‰éœ€åˆ†é…ï¼šByteBufAllocator æ¥å£ä¸ºäº†é™ä½åˆ†é…å’Œé‡Šæ”¾å†…å­˜çš„å¼€é”€ï¼ŒNetty é€šè¿‡ interface ByteBufAllocator å®ç°äº†ï¼ˆByteBuf çš„ï¼‰æ± åŒ–ï¼Œå®ƒå¯ä»¥ç”¨æ¥åˆ†é…æˆ‘ä»¬æ‰€æè¿°è¿‡çš„ä»»æ„ç±»å‹çš„ ByteBuf å®ä¾‹ã€‚ å¯ä»¥é€šè¿‡ Channelï¼ˆæ¯ä¸ªéƒ½å¯ä»¥æœ‰ä¸€ä¸ªä¸åŒçš„ ByteBufAllocator å®ä¾‹ï¼‰æˆ–è€…ç»‘å®šåˆ° ChannelHandler çš„ ChannelHandlerContext è·å–ä¸€ä¸ªåˆ° ByteBufAllocator çš„å¼•ç”¨ã€‚ 1234567// è·å–ä¸€ä¸ªåˆ° ByteBufAllocator çš„å¼•ç”¨Channel channel = ...;ByteBufAllocator allocator = channel.alloc();....ChannelHandlerContext ctx = ...;ByteBufAllocator allocator2 = ctx.alloc();... Nettyæä¾›äº†ä¸¤ç§ByteBufAllocatorçš„å®ç°ï¼šPooledByteBufAllocator å’Œ UnpooledByteBufAllocatorã€‚ Unpooled ç¼“å†²æ± å¯èƒ½æŸäº›æƒ…å†µä¸‹ï¼Œä½ ä¸éœ€è¦ä¸€ä¸ª ByteBufAllocator çš„å¼•ç”¨ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼ŒNetty æä¾›äº†ä¸€ä¸ªç®€å•çš„ç§°ä¸º Unpooled çš„å·¥å…·ç±»ï¼Œå®ƒæä¾›äº†é™æ€çš„è¾…åŠ©æ–¹æ³•æ¥åˆ›å»ºæœªæ± åŒ–çš„ ByteBuf å®ä¾‹ã€‚ ByteBufUtil ç±»ByteBufUtil æä¾›äº†ç”¨äºæ“ä½œ ByteBuf çš„é™æ€çš„è¾…åŠ©æ–¹æ³•ã€‚ å¼•ç”¨è®¡æ•°å¼•ç”¨è®¡æ•°æ˜¯ä¸€ç§é€šè¿‡åœ¨æŸä¸ªå¯¹è±¡æ‰€æŒæœ‰çš„èµ„æºä¸å†è¢«å…¶ä»–å¯¹è±¡å¼•ç”¨æ—¶é‡Šæ”¾è¯¥å¯¹è±¡æ‰€æŒæœ‰çš„èµ„æºæ¥ä¼˜åŒ–å†…å­˜ä½¿ç”¨å’Œæ€§èƒ½çš„æŠ€æœ¯ã€‚Netty åœ¨ç¬¬ 4 ç‰ˆä¸­ä¸º ByteBuf å’Œ ByteBufHolder å¼•å…¥äº†å¼•ç”¨è®¡æ•°æŠ€æœ¯ï¼Œå®ƒä»¬éƒ½å®ç°äº† interface ReferenceCountedã€‚","categories":[{"name":"Java","slug":"Java","permalink":"http://yoursite.com/categories/Java/"}],"tags":[{"name":"Netty","slug":"Netty","permalink":"http://yoursite.com/tags/Netty/"}]},{"title":"Netty ä¼ è¾“","slug":"Netty/Netty å…¥é—¨/Netty ä¼ è¾“","date":"2020-01-22T11:03:21.000Z","updated":"2020-04-19T06:30:56.156Z","comments":true,"path":"2020/01/22/Netty/Netty å…¥é—¨/Netty ä¼ è¾“/","link":"","permalink":"http://yoursite.com/2020/01/22/Netty/Netty%20%E5%85%A5%E9%97%A8/Netty%20%E4%BC%A0%E8%BE%93/","excerpt":"æµç»ç½‘ç»œçš„æ•°æ®æ€»æ˜¯å…·æœ‰ç›¸åŒçš„ç±»å‹ï¼šå­—èŠ‚ã€‚è¿™äº›å­—èŠ‚æ˜¯å¦‚ä½•æµåŠ¨çš„ä¸»è¦å–å†³äºæˆ‘ä»¬æ‰€è¯´çš„ç½‘ç»œä¼ è¾“ï¼ˆä¸€ä¸ªå¸®åŠ©æˆ‘ä»¬æŠ½è±¡åº•å±‚æ•°æ®ä¼ è¾“æœºåˆ¶çš„æ¦‚å¿µï¼‰","text":"æµç»ç½‘ç»œçš„æ•°æ®æ€»æ˜¯å…·æœ‰ç›¸åŒçš„ç±»å‹ï¼šå­—èŠ‚ã€‚è¿™äº›å­—èŠ‚æ˜¯å¦‚ä½•æµåŠ¨çš„ä¸»è¦å–å†³äºæˆ‘ä»¬æ‰€è¯´çš„ç½‘ç»œä¼ è¾“ï¼ˆä¸€ä¸ªå¸®åŠ©æˆ‘ä»¬æŠ½è±¡åº•å±‚æ•°æ®ä¼ è¾“æœºåˆ¶çš„æ¦‚å¿µï¼‰ æ¡ˆä¾‹ç ”ç©¶ï¼šJDK VS. NettyåŸç”Ÿ JDK123456789101112131415161718192021222324252627282930313233343536// JDK çš„é˜»å¡ç½‘ç»œç¼–ç¨‹public class PlainOioServer &#123; public void serve(int port) throws IOException &#123; final ServerSocket socket = new ServerSocket(port); try &#123; for (;;) &#123; final Socket clientSocket = socket.accept(); System.out.println(\"Accepted connection from \" + clientSocket); new Thread( // åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹æ¥å¤„ç†è¯¥è¿æ¥ new Runnable() &#123; @Override public void run() &#123; OutputStream out; try &#123; out = clientSocket.getOutputStream(); // å°†æ¶ˆæ¯å†™ç»™å·²è¿æ¥çš„å®¢æˆ·ç«¯ out.write(\"Hi!\\r\\n\".getBytes(Charset.forName(\"UTF-8\"))); out.flush(); clientSocket.close(); &#125;catch (IOException e) &#123; e.printStackTrace(); &#125;finally &#123; try &#123; clientSocket.close(); &#125;catch (IOException ex) &#123; // ignore on close &#125; &#125; &#125; &#125;).start(); // å¯åŠ¨çº¿ç¨‹ &#125; &#125;catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; &#125; éšç€åº”ç”¨ç¨‹åºçš„ç”¨æˆ·è¶Šæ¥è¶Šå¤šï¼Œé˜»å¡ I/O å¹¶ä¸èƒ½å¾ˆå¥½åœ°ä¼¸ç¼©åˆ°æ”¯æ’‘æˆåƒä¸Šä¸‡åœ°å¹¶å‘è¿å…¥è¿æ¥ã€‚æ­¤æ—¶å¼‚æ­¥ I/O å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†å¼‚æ­¥ I/O çš„ API æ˜¯å®Œå…¨ä¸åŒçš„ï¼Œå› æ­¤ä¸å¾—ä¸é‡å†™æ­¤åº”ç”¨ç¨‹åºã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465// JDK éé˜»å¡ç½‘ç»œå¤„ç†public class PlainNioServer &#123; public void serve(int port) throws IOException &#123; ServerSocketChannel serverChannel = ServerSocketChannel.open(); serverChannel.configureBlocking(false); ServerSocket ssocket = serverChannel.socket(); InetSocketAddress address = new InetSocketAddress(port); ssocket.bind(address); // æ‰“å¼€ Selector æ¥å¤„ç† Channel Selector selector = Selector.open(); // å°† ServerChannel æ³¨å†Œåˆ° Selector ä»¥ä¾¿æ¥å—è¿æ¥ï¼ˆæŠ¥ä¸ªåï¼‰ serverChannel.register(selector, SelectionKey.OP_ACCEPT); final ByteBuffer msg = ByteBuffer.wrap(\"Hi!\\r\\n\".getBytes()); for (;;) &#123; try &#123; // ç­‰å¾… select() éœ€è¦å¤„ç†çš„æ–°äº‹ä»¶ï¼Œé˜»å¡å°†ä¸€ç›´æŒç»­åˆ°ä¸‹ä¸€ä¸ªä¼ å…¥äº‹ä»¶ selector.select(); &#125; catch (IOException ex) &#123; ex.printStackTrace(); // handle exception break; &#125; // è·å–æ‰€æœ‰æ¥æ”¶äº‹ä»¶çš„æ ‡è¯† SelectionKey() Set&lt;SelectionKey&gt; readyKeys = selector.selectedKeys(); Iterator&lt;SelectionKey&gt; iterator = readyKeys.iterator(); while (iterator.hasNext()) &#123; // å–å‡ºæ ‡è¯†ï¼Œä»¥ä¾¿æ ‡è¯†æ‰€å¯¹åº”çš„äº‹ä»¶è¿›è¡Œä¸šåŠ¡æ“ä½œ SelectionKey key = iterator.next(); // æ­¤äº‹ä»¶å·²ç»å–å‡ºå¤„ç†ï¼Œå°†å…¶æ ‡è¯†ç¬¦ç§»é™¤ iterator.remove(); try &#123; // æ£€æŸ¥äº‹ä»¶ç±»å‹ if (key.isAcceptable()) &#123; ServerSocketChannel server = (ServerSocketChannel)key.channel(); // æ¥å—å®¢æˆ·ç«¯ SocketChannel client = server.accept(); client.configureBlocking(false); // å°†å®¢æˆ·ç«¯æ³¨å†Œåˆ°é€‰æ‹©å™¨ client.register(selector, SelectionKey.OP_WRITE | SelectionKey.OP_READ, msg.duplicate()); System.out.println(\"Accepted connection from \" + client); &#125; // æ£€æŸ¥äº‹ä»¶ç±»å‹ if (key.isWritable()) &#123; SocketChannel client = (SocketChannel)key.channel(); ByteBuffer buffer =(ByteBuffer)key.attachment(); while (buffer.hasRemaining()) &#123; // å°†æ•°æ®å†™åˆ°å·²è¿æ¥çš„å®¢æˆ·ç«¯ if (client.write(buffer) == 0) &#123; break; &#125; &#125; client.close(); &#125; &#125; catch (IOException ex) &#123; key.cancel(); try &#123; key.channel().close(); &#125; catch (IOException cex) &#123; // ignore on close &#125; &#125; &#125; // while &#125; // for &#125; &#125; Netty æ¡†æ¶å› ä¸º Netty ä¸ºæ¯ç§ä¼ è¾“çš„å®ç°éƒ½æš´éœ²äº†ç›¸åŒçš„ APIï¼Œé˜»å¡ä¸éé˜»å¡ç½‘ç»œä¼ è¾“çš„å®ç°éƒ½ä¾èµ–äº interface Channelã€ ChannelPipeline å’Œ ChannelHandlerã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243// ä½¿ç”¨ Netty çš„ç½‘ç»œå¤„ç†public class NettyOioServer &#123; public void server(int port) throws Exception &#123; final ByteBuf buf = Unpooled.unreleasableBuffer( Unpooled.copiedBuffer(\"Hi!\\r\\n\", Charset.forName(\"UTF-8\")) ); // é˜»å¡æ¨¡å¼ EventLoopGroup group = new OioEventLoopGroup(); // éé˜»å¡æ¨¡å¼ // EventLoopGroup group = new OioEventLoopGroup(); try &#123; ServerBootstrap b = new ServerBootstrap(); b.group(group) // éé˜»å¡æ¨¡å¼ // .channel(NioServerSocketChannel.class) .channel(OioServerSocketChannel.class) .localAddress(new InetSocketAddress(port)) // æ¯ä¸ªè¿æ¥çš„é€šé“éƒ½éœ€è¦è°ƒç”¨æ­¤åˆå§‹åŒ–æ–¹æ³• .childHandler( new ChannelInitializer&lt;SocketChannel&gt;() &#123; @Override public void initChannel(SocketChannel ch) throws Exception &#123; ch.pipeline().addLast( // æ‹¦æˆªå’Œå¤„ç†äº‹ä»¶ new ChannelInboundHandlerAdapter() &#123; @Override public void channelActive(ChannelHandlerContext ctx)throws Exception &#123; ctx.writeAndFlush(buf.duplicate()) // ç›‘å¬ï¼Œä»¥ä¾¿åœ¨æ¶ˆæ¯å†™å®Œåå…³é—­è¿æ¥ .addListener(ChannelFutureListener.CLOSE); &#125; &#125; ); &#125; &#125; ); ChannelFuture f = b.bind().sync(); f.channel().closeFuture().sync(); &#125; finally &#123; group.shutdownGracefully().sync(); &#125; &#125; &#125; ä¼ è¾“ APIä¼ è¾“ API çš„æ ¸å¿ƒæ˜¯ interface Channelï¼Œå®ƒè¢«ç”¨äºæ‰€æœ‰çš„ I/O æ“ä½œ æ¯ä¸ª Channel éƒ½å°†ä¼šè¢«åˆ†é…ä¸€ä¸ª ChannelPipeline å’Œ ChannelConfigã€‚ChannelConfig åŒ…å«äº†è¯¥ Channel çš„æ‰€æœ‰é…ç½®è®¾ç½®ï¼Œå¹¶ä¸”æ”¯æŒçƒ­æ›´æ–°ã€‚ ç”±äº Channel æ˜¯ç‹¬ä¸€æ— äºŒçš„ï¼Œä¸ºäº†ä¿è¯é¡ºåºå°† Channel å£°æ˜ä¸º java.lang. Comparable çš„ä¸€ä¸ªå­æ¥å£ã€‚ ChannelPipeline æŒæœ‰æ‰€æœ‰å°†åº”ç”¨äºå…¥ç«™å’Œå‡ºç«™æ•°æ®ä»¥åŠäº‹ä»¶çš„ ChannelHandler å®ä¾‹ï¼Œè¿™äº› ChannelHandler å®ç°äº†åº”ç”¨ç¨‹åºç”¨äºå¤„ç†çŠ¶æ€å˜åŒ–ä»¥åŠæ•°æ®å¤„ç†çš„é€»è¾‘ã€‚ä½ ä¹Ÿå¯ä»¥æ ¹æ®éœ€è¦é€šè¿‡æ·»åŠ æˆ–è€…ç§»é™¤ChannelHandlerå®ä¾‹æ¥ä¿®æ”¹ ChannelPipelineã€‚é€šè¿‡åˆ©ç”¨Nettyçš„è¿™é¡¹èƒ½åŠ›å¯ä»¥æ„å»ºå‡ºé«˜åº¦çµæ´»çš„åº”ç”¨ç¨‹åºã€‚ 123456789101112131415161718192021// å†™å‡ºåˆ° ChannelChannel channel = ...;// åˆ›å»ºæŒæœ‰è¦å†™æ•°æ®çš„ ByteBufByteBuf buf = Unpooled.copiedBuffer(\"your data\", CharsetUtil.UTF_8);// å†™æ•°æ®å¹¶ä¸”å†²åˆ·å®ƒChannelFuture cf = channel.writeAndFlush(buf);// æ·»åŠ ç›‘å¬å™¨ä»¥ä¾¿åœ¨æ“ä½œå®Œæˆåæ¥æ”¶åˆ°é€šçŸ¥cf.addListener( new ChannelFutureListener() &#123; @Override public void operationComplete(ChannelFuture future) &#123; // æ“ä½œå®Œæˆå¹¶ä¸”æ²¡æœ‰å‘ç”Ÿé”™è¯¯ if (future.isSuccess()) &#123; System.out.println(\"Write successful\"); &#125; else &#123; System.err.println(\"Write error\"); future.cause().printStackTrace(); &#125; &#125; &#125;); Netty çš„ Channel å®ç°æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› æ­¤ä½ å¯ä»¥å­˜å‚¨ä¸€ä¸ªåˆ° Channel çš„å¼•ç”¨ï¼Œå¹¶ä¸”æ¯å½“ä½ éœ€è¦å‘è¿œç¨‹èŠ‚ç‚¹å†™æ•°æ®æ—¶ï¼Œéƒ½å¯ä»¥ä½¿ç”¨å®ƒï¼Œå³ä½¿å½“æ—¶è®¸å¤šçº¿ç¨‹éƒ½åœ¨ä½¿ç”¨å®ƒã€‚ 1234567891011121314151617// ä»å¤šä¸ªçº¿ç¨‹ä½¿ç”¨åŒä¸€ä¸ª Channelfinal Channel channel = ...;final ByteBuf buf = Unpooled.copiedBuffer(\"your data\",CharsetUtil.UTF_8).retain();// åˆ›å»ºå°†æ•°æ®å†™åˆ° Channel çš„ RunnableRunnable writer = new Runnable() &#123; @Override public void run() &#123; channel.writeAndFlush(buf.duplicate()); &#125;&#125;;// è·å–åˆ°çº¿ç¨‹æ±  Executor çš„å¼•ç”¨Executor executor = Executors.newCachedThreadPool();// write in one threadexecutor.execute(writer);// write in another threadexecutor.execute(writer);... å†…ç½®çš„ä¼ è¾“Netty å†…ç½®äº†ä¸€äº›å¯å¼€ç®±å³ç”¨çš„ä¼ è¾“ã€‚å› ä¸ºå¹¶ä¸æ˜¯å®ƒä»¬æ‰€æœ‰çš„ä¼ è¾“éƒ½æ”¯æŒæ¯ä¸€ç§åè®®ï¼Œæ‰€ä»¥ä½ å¿…é¡»é€‰æ‹©ä¸€ä¸ªå’Œä½ çš„åº”ç”¨ç¨‹åºæ‰€ä½¿ç”¨çš„åè®®ç›¸å®¹çš„ä¼ è¾“ã€‚ NIONIO æä¾›äº†ä¸€ä¸ªæ‰€æœ‰ I/O æ“ä½œçš„å…¨å¼‚æ­¥çš„å®ç°ï¼Œåˆ©ç”¨äº† JDK1.4 æ—¶ä¾¿å¯ç”¨çš„åŸºäºé€‰æ‹©å™¨çš„ APIã€‚ é€‰æ‹©å™¨èƒŒåçš„åŸºæœ¬æ¦‚å¿µæ˜¯å……å½“ä¸€ä¸ªæ³¨å†Œè¡¨ï¼Œåœ¨é‚£é‡Œä½ å°†å¯ä»¥è¯·æ±‚åœ¨ Channel çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶å¾—åˆ°é€šçŸ¥ã€‚ class java.nio.channels.SelectionKey å®šä¹‰äº†ä¸€ç»„åº”ç”¨ç¨‹åºæ­£åœ¨è¯·æ±‚é€šçŸ¥çš„çŠ¶æ€å˜åŒ–é›†ã€‚ é€‰æ‹©å™¨é€‰æ‹©å¹¶å¤„ç†çŠ¶æ€çš„å˜åŒ– é›¶æ‹·è´ï¼ˆzero-copyï¼‰ï¼šå®ƒä½¿ä½ å¯ä»¥å¿«é€Ÿé«˜æ•ˆåœ°å°†æ•°æ®ä»æ–‡ä»¶ç³»ç»Ÿç§»åŠ¨åˆ°ç½‘ç»œæ¥å£ï¼Œè€Œä¸éœ€è¦å°†å…¶ä»å†…æ ¸ç©ºé—´å¤åˆ¶åˆ°ç”¨æˆ·ç©ºé—´ï¼Œå…¶åœ¨åƒ FTP æˆ–è€… HTTP è¿™æ ·çš„åè®®ä¸­å¯ä»¥æ˜¾è‘—åœ°æå‡æ€§èƒ½ã€‚ Epollç”¨äº Linux çš„æœ¬åœ°éé˜»å¡ä¼ è¾“ï¼ŒLinux JDK NIO API ä½¿ç”¨äº†è¿™äº› epoll è°ƒç”¨ã€‚ OIONetty çš„ OIO ä¼ è¾“å®ç°ä»£è¡¨äº†ä¸€ç§æŠ˜ä¸­ï¼šå®ƒå¯ä»¥é€šè¿‡å¸¸è§„çš„ä¼ è¾“ API ä½¿ç”¨ï¼Œä½†æ˜¯ç”±äºå®ƒæ˜¯å»ºç«‹åœ¨ java.net åŒ…çš„é˜»å¡å®ç°ä¹‹ä¸Šçš„ï¼Œæ‰€ä»¥å®ƒä¸æ˜¯å¼‚æ­¥çš„ã€‚ä½†æ˜¯ï¼Œå®ƒä»ç„¶éå¸¸é€‚åˆäºæŸäº›ç”¨é€”ã€‚ Local ä¼ è¾“ç”¨äºåœ¨åŒä¸€ä¸ª JVM ä¸­è¿è¡Œçš„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç¨‹åºä¹‹é—´çš„å¼‚æ­¥é€šä¿¡ã€‚ Embedded ä¼ è¾“Netty æä¾›äº†ä¸€ç§é¢å¤–çš„ä¼ è¾“ï¼Œä½¿å¾—ä½ å¯ä»¥å°†ä¸€ç»„ ChannelHandler ä½œä¸ºå¸®åŠ©å™¨ç±»åµŒå…¥åˆ°å…¶ä»–çš„ ChannelHandler å†…éƒ¨ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½ å°†å¯ä»¥æ‰©å±•ä¸€ä¸ª ChannelHandler çš„åŠŸèƒ½ï¼Œè€Œåˆä¸éœ€è¦ä¿®æ”¹å…¶å†…éƒ¨ä»£ç ã€‚","categories":[{"name":"Java","slug":"Java","permalink":"http://yoursite.com/categories/Java/"}],"tags":[{"name":"Netty","slug":"Netty","permalink":"http://yoursite.com/tags/Netty/"}]},{"title":"Netty ç»„ä»¶å’Œè®¾è®¡","slug":"Netty/Netty å…¥é—¨/Netty ç»„ä»¶å’Œè®¾è®¡","date":"2020-01-22T06:09:03.000Z","updated":"2020-04-19T06:31:16.834Z","comments":true,"path":"2020/01/22/Netty/Netty å…¥é—¨/Netty ç»„ä»¶å’Œè®¾è®¡/","link":"","permalink":"http://yoursite.com/2020/01/22/Netty/Netty%20%E5%85%A5%E9%97%A8/Netty%20%E7%BB%84%E4%BB%B6%E5%92%8C%E8%AE%BE%E8%AE%A1/","excerpt":"Channelã€EventLoop å’Œ ChannelFutureChannelã€EventLoop å’Œ ChannelFuture ç±»åˆåœ¨ä¸€èµ·å¯ä»¥è¢«è®¤ä¸ºæ˜¯ Netty çš„ç½‘ç»œæŠ½è±¡ä»£è¡¨","text":"Channelã€EventLoop å’Œ ChannelFutureChannelã€EventLoop å’Œ ChannelFuture ç±»åˆåœ¨ä¸€èµ·å¯ä»¥è¢«è®¤ä¸ºæ˜¯ Netty çš„ç½‘ç»œæŠ½è±¡ä»£è¡¨ Channelï¼šSocket EventLoopï¼šæ§åˆ¶æµã€å¤šçº¿ç¨‹å¤„ç†ã€å¹¶å‘ ChannelFutureï¼šå¼‚æ­¥é€šçŸ¥ Channel æ¥å£åŸºæœ¬çš„ I/O æ“ä½œï¼ˆbind()ã€connect()ã€read()å’Œ write()ï¼‰ä¾èµ–äºåº•å±‚ç½‘ç»œä¼ è¾“æ‰€æä¾›çš„åŸè¯­ã€‚åœ¨åŸºäº Java çš„ç½‘ç»œç¼–ç¨‹ä¸­ï¼Œå…¶åŸºæœ¬çš„æ„é€ æ˜¯ class Socketã€‚Netty çš„ Channel æ¥å£æ‰€æä¾›çš„ APIï¼Œå¤§å¤§åœ°é™ä½äº†ç›´æ¥ä½¿ç”¨ Socket ç±»çš„å¤æ‚æ€§ã€‚æ­¤å¤–ï¼ŒChannel ä¹Ÿæ˜¯æ‹¥æœ‰è®¸å¤šé¢„å®šä¹‰çš„ã€ä¸“é—¨åŒ–å®ç°çš„å¹¿æ³›ç±»å±‚æ¬¡ç»“æ„çš„æ ¹ã€‚ EvenLoop æ¥å£ ä¸€ä¸ª EventLoopGroup åŒ…å«ä¸€ä¸ªæˆ–è€…å¤šä¸ª EventLoopï¼› ä¸€ä¸ª EventLoop åœ¨å®ƒçš„ç”Ÿå‘½å‘¨æœŸå†…åªå’Œä¸€ä¸ª Thread ç»‘å®šï¼› æ‰€æœ‰ç”± EventLoop å¤„ç†çš„ I/O äº‹ä»¶éƒ½å°†åœ¨å®ƒä¸“æœ‰çš„ Thread ä¸Šè¢«å¤„ç†ï¼› ä¸€ä¸ª Channel åœ¨å®ƒçš„ç”Ÿå‘½å‘¨æœŸå†…åªæ³¨å†Œäºä¸€ä¸ª EventLoopï¼› ä¸€ä¸ª EventLoop å¯èƒ½ä¼šè¢«åˆ†é…ç»™ä¸€ä¸ªæˆ–å¤šä¸ª Channelã€‚ åœ¨è¿™ç§è®¾è®¡ä¸­ï¼Œä¸€ä¸ªç»™å®š Channel çš„ I/O æ“ä½œéƒ½æ˜¯ç”±ç›¸åŒçš„ Thread æ‰§è¡Œçš„ï¼Œå®é™…ä¸Šæ¶ˆé™¤äº†å¯¹äºåŒæ­¥çš„éœ€è¦ã€‚ channelFuture æ¥å£Netty ä¸­æ‰€æœ‰çš„ I/O æ“ä½œéƒ½æ˜¯å¼‚æ­¥çš„ï¼Œå› ä¸ºä¸€ä¸ªæ“ä½œå¯èƒ½ä¸ä¼šç«‹å³è¿”å›ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ç§ç”¨äºåœ¨ä¹‹åçš„æŸä¸ªæ—¶é—´ç‚¹ç¡®å®šå…¶ç»“æœçš„æ–¹æ³•ã€‚ä¸ºæ­¤ï¼ŒNetty æä¾›äº† ChannelFuture æ¥å£ï¼Œå…¶ addListener() æ–¹æ³•æ³¨å†Œäº†ä¸€ä¸ª ChannelFutureListenerï¼Œä»¥ä¾¿åœ¨æŸä¸ªæ“ä½œå®Œæˆæ—¶ï¼ˆæ— è®ºæ˜¯å¦æˆåŠŸï¼‰å¾—åˆ°é€šçŸ¥ã€‚ ChannelHandler å’Œ ChannelPipelineæ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬æ›´åŠ ç»†è‡´çš„çœ‹ä¸€çœ‹å“ªé‚£äº›ç®¡ç†æ•°æ®æµä»¥åŠæ‰§è¡Œåº”ç”¨ç¨‹åºå¤„ç†é€»è¾‘çš„ç»„ä»¶ã€‚ ChannelHandler æ¥å£ä»åº”ç”¨ç¨‹åºå¼€å‘äººå‘˜çš„è§’åº¦æ¥çœ‹ï¼ŒNetty çš„ä¸»è¦ç»„ä»¶æ˜¯ ChannelHandlerï¼Œå®ƒå……å½“äº†æ‰€æœ‰å¤„ç†å…¥ç«™å’Œå‡ºç«™æ•°æ®çš„åº”ç”¨ç¨‹åºé€»è¾‘çš„å®¹å™¨ã€‚è¿™æ˜¯å¯è¡Œçš„ï¼Œå› ä¸º ChannelHandler çš„æ–¹æ³•æ˜¯ç”±ç½‘ç»œäº‹ä»¶ï¼ˆå…¶ä¸­æœ¯è¯­â€œäº‹ä»¶â€çš„ä½¿ç”¨éå¸¸å¹¿æ³›ï¼‰è§¦å‘çš„ã€‚äº‹å®ä¸Šï¼ŒChannelHandler å¯ä¸“é—¨ç”¨äºå‡ ä¹ä»»ä½•ç±»å‹çš„åŠ¨ä½œï¼Œä¾‹å¦‚å°†æ•°æ®ä»ä¸€ç§æ ¼å¼è½¬æ¢ä¸ºå¦å¤–ä¸€ç§æ ¼å¼ï¼Œæˆ–è€…å¤„ç†è½¬æ¢è¿‡ç¨‹ä¸­æ‰€æŠ›å‡ºçš„å¼‚å¸¸ã€‚ ä½ çš„åº”ç”¨ç¨‹åºçš„ä¸šåŠ¡é€»è¾‘é€šå¸¸é©»ç•™åœ¨ä¸€ä¸ªæˆ–è€…å¤šä¸ª ChannelInboundHandler ä¸­ã€‚ ChannelPipeline æ¥å£ChannelPipeline æä¾›äº† ChannelHandler é“¾çš„å®¹å™¨ï¼Œå¹¶å®šä¹‰äº†ç”¨äºåœ¨è¯¥é“¾ä¸Šä¼ æ’­å…¥ç«™å’Œå‡ºç«™äº‹ä»¶æµçš„ APIã€‚å½“ Channel è¢«åˆ›å»ºæ—¶ï¼Œå®ƒä¼šè¢«è‡ªåŠ¨åœ°åˆ†é…åˆ°å®ƒä¸“å±çš„ ChannelPipelineã€‚ ChannelHandler å®‰è£…åˆ° ChannelPipeline ä¸­çš„è¿‡ç¨‹ï¼š ä¸€ä¸ªChannelInitializerçš„å®ç°è¢«æ³¨å†Œåˆ°äº†ServerBootstrapä¸­ï¼› å½“ ChannelInitializer.initChannel() æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼ŒChannelInitializer å°†åœ¨ ChannelPipeline ä¸­å®‰è£…ä¸€ç»„è‡ªå®šä¹‰çš„ ChannelHandlerï¼› ChannelInitializer å°†å®ƒè‡ªå·±ä» ChannelPipeline ä¸­ç§»é™¤ã€‚ ChannelHandler æ˜¯ä¸“ä¸ºæ”¯æŒå¹¿æ³›çš„ç”¨é€”è€Œè®¾è®¡çš„ï¼Œå¯ä»¥å°†å®ƒçœ‹ä½œæ˜¯å¤„ç†å¾€æ¥ ChannelPipeline äº‹ä»¶ï¼ˆåŒ…æ‹¬æ•°æ®ï¼‰çš„ä»»ä½•ä»£ç çš„é€šç”¨å®¹å™¨ã€‚ä½¿å¾—äº‹ä»¶æµç» ChannelPipeline æ˜¯ ChannelHandler çš„å·¥ä½œï¼Œå®ƒä»¬æ˜¯åœ¨åº”ç”¨ç¨‹åºçš„åˆå§‹åŒ–æˆ–è€…å¼•å¯¼é˜¶æ®µè¢«å®‰è£…çš„ã€‚è¿™äº›å¯¹è±¡æ¥æ”¶äº‹ä»¶ã€æ‰§è¡Œå®ƒä»¬æ‰€å®ç°çš„å¤„ç†é€»è¾‘ï¼Œå¹¶å°†æ•°æ®ä¼ é€’ç»™é“¾ä¸­çš„ä¸‹ä¸€ä¸ª ChannelHandlerã€‚å®ƒä»¬çš„æ‰§è¡Œé¡ºåºæ˜¯ç”±å®ƒä»¬è¢«æ·»åŠ çš„é¡ºåºæ‰€å†³å®šçš„ã€‚å®é™…ä¸Šï¼Œè¢«æˆ‘ä»¬ç§°ä¸º ChannelPipeline çš„æ˜¯è¿™äº› ChannelHandler çš„ç¼–æ’é¡ºåºã€‚ å¦‚åŒä¸Šå›¾æ‰€ç¤ºï¼Œå…¥ç«™å’Œå‡ºç«™ ChannelHandler å¯ä»¥è¢«å®‰è£…åˆ°åŒä¸€ä¸ª ChannelPipeline ä¸­ã€‚è™½ç„¶ ChannelInboundHandle å’Œ ChannelOutboundHandle éƒ½æ‰©å±•è‡ª ChannelHandlerï¼Œä½†æ˜¯ Netty èƒ½åŒºåˆ† ChannelInboundHandler å®ç°å’Œ ChannelOutboundHandler å®ç°ï¼Œå¹¶ç¡®ä¿æ•°æ®åªä¼šåœ¨å…·æœ‰ç›¸åŒå®šå‘ç±»å‹çš„ä¸¤ä¸ª ChannelHandler ä¹‹é—´ä¼ é€’ã€‚ å½“ ChannelHandler è¢«æ·»åŠ åˆ° ChannelPipeline æ—¶ï¼Œå®ƒå°†ä¼šè¢«åˆ†é…ä¸€ä¸ª ChannelHandlerContextï¼Œå…¶ä»£è¡¨äº† ChannelHandler å’Œ ChannelPipeline ä¹‹é—´çš„ç»‘å®šã€‚è™½ç„¶è¿™ä¸ªå¯¹è±¡å¯ä»¥è¢«ç”¨äºè·å–åº•å±‚çš„ Channelï¼Œä½†æ˜¯å®ƒä¸»è¦è¿˜æ˜¯è¢«ç”¨äºå†™å‡ºç«™æ•°æ®ã€‚ åœ¨ Netty ä¸­ï¼Œæœ‰ä¸¤ç§å‘é€æ¶ˆæ¯çš„æ–¹å¼ã€‚ä½ å¯ä»¥ç›´æ¥å†™åˆ° Channel ä¸­ï¼Œä¹Ÿå¯ä»¥å†™åˆ°å’Œ ChannelHandler ç›¸å…³è”çš„ ChannelHandlerContext å¯¹è±¡ä¸­ã€‚å‰ä¸€ç§æ–¹å¼å°†ä¼šå¯¼è‡´æ¶ˆæ¯ä» ChannelPipeline çš„å°¾ç«¯å¼€å§‹æµåŠ¨ï¼Œè€Œåè€…å°†å¯¼è‡´æ¶ˆæ¯ä» ChannelPipeline ä¸­çš„ä¸‹ä¸€ä¸ª ChannelHandler å¼€å§‹æµåŠ¨ã€‚ ç¼–ç å™¨å’Œè§£ç å™¨æ­£å¦‚æœ‰ç”¨æ¥ç®€åŒ– ChannelHandler çš„åˆ›å»ºçš„é€‚é…å™¨ç±»ä¸€æ ·ï¼Œæ‰€æœ‰ç”± Netty æä¾›çš„ç¼–ç å™¨/è§£ç å™¨é€‚é…å™¨ç±»éƒ½å®ç° äº† ChannelOutboundHandler æˆ–è€… ChannelInboundHandler æ¥å£ã€‚ é€šå¸¸æ¥è¯´ï¼Œè¿™äº›åŸºç±»çš„åç§°å°†ç±»ä¼¼äº ByteToMessageDecoder æˆ– MessageToByteEncoderã€‚å¯¹äºç‰¹æ®Šçš„ç±»å‹ï¼Œä½ å¯èƒ½ä¼šå‘ç°ç±»ä¼¼äº ProtobufEncoder å’Œ ProtobufDecoder è¿™æ ·çš„åç§°â€”â€”é¢„ç½®çš„ç”¨æ¥æ”¯æŒ Google çš„ Protocol Buffersã€‚ æŠ½è±¡ç±» SimpleChannelInboundHandleræœ€å¸¸è§çš„æƒ…å†µæ˜¯ï¼Œä½ çš„åº”ç”¨ç¨‹åºä¼šåˆ©ç”¨ä¸€ä¸ª ChannelHandler æ¥æ¥æ”¶è§£ç æ¶ˆæ¯ï¼Œå¹¶å¯¹è¯¥æ•°æ®åº”ç”¨ä¸šåŠ¡é€»è¾‘ã€‚è¦åˆ›å»ºä¸€ä¸ªè¿™æ ·çš„ ChannelHandlerï¼Œä½ åªéœ€è¦æ‰©å±•åŸºç±» SimpleChannelInboundHandler&lt;T&gt;ï¼Œå…¶ä¸­ T æ˜¯ä½ è¦å¤„ç†çš„æ¶ˆæ¯çš„ Java ç±»å‹ ã€‚åœ¨è¿™ä¸ª ChannelHandler ä¸­ï¼Œä½ å°†éœ€è¦é‡å†™åŸºç±»çš„ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ–¹æ³•ï¼Œå¹¶ä¸”è·å–ä¸€ä¸ªåˆ° ChannelHandlerContext çš„å¼•ç”¨ï¼Œ è¿™ä¸ªå¼•ç”¨å°†ä½œä¸ºè¾“å…¥å‚æ•°ä¼ é€’ç»™ ChannelHandler çš„æ‰€æœ‰æ–¹æ³•ã€‚ å¼•å¯¼Netty çš„å¼•å¯¼ç±»ä¸ºåº”ç”¨ç¨‹åºçš„ç½‘ç»œå±‚é…ç½®æä¾›äº†å®¹å™¨ï¼Œè¿™æ¶‰åŠå°†ä¸€ä¸ªè¿›ç¨‹ç»‘å®šåˆ°æŸä¸ªæŒ‡å®šçš„ç«¯å£ï¼Œæˆ–è€…å°†ä¸€ä¸ªè¿›ç¨‹è¿æ¥åˆ°å¦ä¸€ä¸ªè¿è¡Œåœ¨æŸä¸ªæŒ‡å®šä¸»æœºçš„æŒ‡å®šç«¯å£ä¸Šçš„è¿›ç¨‹ã€‚ â€œæœåŠ¡å™¨â€å’Œâ€œå®¢æˆ·ç«¯â€å®é™…ä¸Šè¡¨ç¤ºäº†ä¸åŒçš„ç½‘ç»œè¡Œä¸ºï¼›æ¢å¥è¯è¯´ï¼Œæ˜¯ç›‘å¬ä¼ å…¥çš„è¿æ¥è¿˜æ˜¯å»ºç«‹åˆ°ä¸€ä¸ªæˆ–è€…å¤šä¸ªè¿›ç¨‹çš„è¿æ¥ã€‚ å› æ­¤ï¼Œæœ‰ä¸¤ç§ç±»å‹çš„å¼•å¯¼ï¼šä¸€ç§ç”¨äºå®¢æˆ·ç«¯ï¼ˆç®€å•åœ°ç§°ä¸º Bootstrapï¼‰ï¼Œè€Œå¦ä¸€ç§ï¼ˆServerBootstrapï¼‰ç”¨äºæœåŠ¡å™¨ã€‚æ— è®ºä½ çš„åº”ç”¨ç¨‹åºä½¿ç”¨å“ªç§åè®®æˆ–è€…å¤„ç†å“ªç§ç±»å‹çš„æ•°æ®ï¼Œå”¯ä¸€å†³å®šå®ƒä½¿ç”¨å“ªç§å¼•å¯¼ç±»çš„æ˜¯å®ƒæ˜¯ä½œä¸ºä¸€ä¸ªå®¢æˆ·ç«¯è¿˜æ˜¯ä½œä¸ºä¸€ä¸ªæœåŠ¡å™¨ã€‚ Bootstrap å°†è¿æ¥è¿œç¨‹ä¸»æœºå’Œç«¯å£ï¼Œæ•°é‡é€šå¸¸ä¸ºä¸€ä¸ªã€‚ ServerBootstrap å°†ç»‘å®šåˆ°ä¸€ä¸ªç«¯å£ï¼Œå› ä¸ºæœåŠ¡å™¨å¿…é¡»è¦ç›‘å¬è¿æ¥ï¼Œæ•°é‡é€šå¸¸ä¸ºä¸¤ä¸ªã€‚ ç¬¬ä¸€ç»„å°†åªåŒ…å«ä¸€ä¸ª ServerChannelï¼Œä»£è¡¨æœåŠ¡å™¨è‡ªèº«çš„å·²ç»‘å®šåˆ°æŸä¸ªæœ¬åœ°ç«¯å£çš„æ­£åœ¨ç›‘å¬çš„å¥—æ¥å­—ã€‚ ç¬¬äºŒç»„å°†åŒ…å«æ‰€æœ‰å·²åˆ›å»ºçš„ç”¨æ¥å¤„ç†ä¼ å…¥å®¢æˆ·ç«¯è¿æ¥ï¼ˆå¯¹äºæ¯ä¸ªæœåŠ¡å™¨å·²ç»æ¥å—çš„è¿æ¥éƒ½æœ‰ä¸€ä¸ªï¼‰çš„ Channelã€‚ ä¸ ServerChannel ç›¸å…³è”çš„ EventLoopGroup å°†åˆ†é…ä¸€ä¸ªè´Ÿè´£ä¸ºä¼ å…¥è¿æ¥è¯·æ±‚åˆ›å»º Channel çš„ EventLoopã€‚ä¸€æ—¦è¿æ¥è¢«æ¥å—ï¼Œç¬¬äºŒä¸ª EventLoopGroup å°±ä¼šç»™å®ƒçš„ Channel åˆ†é…ä¸€ä¸ª EventLoopã€‚","categories":[{"name":"Java","slug":"Java","permalink":"http://yoursite.com/categories/Java/"}],"tags":[{"name":"Netty","slug":"Netty","permalink":"http://yoursite.com/tags/Netty/"}]},{"title":"ä¸€ä¸ªç®€å•çš„ Netty åº”ç”¨ç¨‹åº","slug":"Netty/Netty å…¥é—¨/Netty ç®€å•åº”ç”¨ç¨‹åº","date":"2020-01-21T14:46:53.000Z","updated":"2020-02-17T10:51:25.668Z","comments":true,"path":"2020/01/21/Netty/Netty å…¥é—¨/Netty ç®€å•åº”ç”¨ç¨‹åº/","link":"","permalink":"http://yoursite.com/2020/01/21/Netty/Netty%20%E5%85%A5%E9%97%A8/Netty%20%E7%AE%80%E5%8D%95%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F/","excerpt":"åº”ç”¨ç¨‹åº EchoEcho å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„äº¤äº’æ˜¯éå¸¸ç®€å•çš„ï¼›åœ¨å®¢æˆ·ç«¯å»ºç«‹ä¸€ä¸ªè¿æ¥ä¹‹åï¼Œå®ƒä¼šå‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªæˆ–å¤šä¸ªæ¶ˆæ¯ï¼Œåè¿‡æ¥ï¼ŒæœåŠ¡å™¨åˆä¼šå°†æ¯ä¸ªæ¶ˆæ¯å›é€ç»™å®¢æˆ·ç«¯ã€‚è¿™ä¸€ç®€å•çš„åŠŸèƒ½å……åˆ†ä½“ç°äº†å®¢æˆ·ç«¯/æœåŠ¡å™¨ç³»ç»Ÿä¸­å…¸å‹çš„è¯·æ±‚-å“åº”äº¤äº’æ¨¡å¼ã€‚","text":"åº”ç”¨ç¨‹åº EchoEcho å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„äº¤äº’æ˜¯éå¸¸ç®€å•çš„ï¼›åœ¨å®¢æˆ·ç«¯å»ºç«‹ä¸€ä¸ªè¿æ¥ä¹‹åï¼Œå®ƒä¼šå‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªæˆ–å¤šä¸ªæ¶ˆæ¯ï¼Œåè¿‡æ¥ï¼ŒæœåŠ¡å™¨åˆä¼šå°†æ¯ä¸ªæ¶ˆæ¯å›é€ç»™å®¢æˆ·ç«¯ã€‚è¿™ä¸€ç®€å•çš„åŠŸèƒ½å……åˆ†ä½“ç°äº†å®¢æˆ·ç«¯/æœåŠ¡å™¨ç³»ç»Ÿä¸­å…¸å‹çš„è¯·æ±‚-å“åº”äº¤äº’æ¨¡å¼ã€‚ ç¼–å†™ Echo æœåŠ¡å™¨æ‰€æœ‰çš„ Netty æœåŠ¡å™¨éƒ½éœ€è¦ä»¥ä¸‹ä¸¤éƒ¨åˆ† è‡³å°‘ä¸€ä¸ª ChannelHandlerï¼šè¯¥ç»„ä»¶å®ç°äº†æœåŠ¡å™¨å¯¹ä»å®¢æˆ·ç«¯æ¥æ”¶çš„æ•°æ®çš„å¤„ç†ï¼Œå³å®ƒçš„ä¸šåŠ¡é€»è¾‘ã€‚ å¼•å¯¼ï¼šè¿™æ˜¯é…ç½®æœåŠ¡å™¨çš„å¯åŠ¨ä»£ç ã€‚è‡³å°‘ï¼Œå®ƒä¼šå°†æœåŠ¡å™¨ç»‘å®šåˆ°å®ƒè¦ç›‘å¬è¿æ¥è¯·æ±‚çš„ç«¯å£ä¸Šã€‚ ChannelHandler å’Œä¸šåŠ¡é€»è¾‘å› ä¸ºä½ çš„ Echo æœåŠ¡å™¨ä¼šå“åº”ä¼ å…¥çš„æ¶ˆæ¯ï¼Œæ‰€ä»¥å®ƒéœ€è¦å®ç° ChannelInboundHandler æ¥å£ï¼Œç”¨æ¥å®šä¹‰å“åº”å…¥ç«™äº‹ä»¶çš„æ–¹æ³•ã€‚è¿™ä¸ªç®€å•çš„åº”ç”¨ç¨‹åºåªéœ€è¦ç”¨åˆ°å°‘é‡çš„è¿™äº›æ–¹æ³•ï¼Œæ‰€ä»¥ç»§æ‰¿ ChannelInboundHandlerAdapter ç±»ä¹Ÿå°±è¶³å¤Ÿäº†ï¼Œå®ƒæä¾›äº† ChannelInboundHandler çš„é»˜è®¤å®ç°ã€‚ 123456789101112131415161718192021222324// EchoServerHandler ç±»@Sharable // æ ‡ç¤ºä¸€ä¸ª ChannelHandler å¯ä»¥è¢«å¤šä¸ª Channel å®‰å…¨åœ°å…±äº«public class EchoServerHandler extends ChannelInboundHandlerAdapter &#123; // å¯¹äºæ¯ä¸ªä¼ å…¥çš„æ¶ˆæ¯éƒ½è¦è°ƒç”¨ @Override public void channelRead(ChannelHandlerContext ctx, Object msg) &#123; ByteBuf in = (ByteBuf) msg; System.out.println(\"Server received: \" + in.toString(CharsetUtil.UTF_8)); // å°†æ¥æ”¶åˆ°çš„æ•°æ®å†™ç»™å‘é€è€… ctx.write(in); &#125; // é€šçŸ¥ ChannelInboundHandler æœ€åä¸€æ¬¡å¯¹ channelRead() çš„è°ƒç”¨æ˜¯å½“å‰æ‰¹é‡è¯»å–ä¸­çš„æœ€åä¸€æ¡æ¶ˆæ¯ @Override public void channelReadComplete(ChannelHandlerContext ctx) &#123; // å°†æ¶ˆæ¯å†²åˆ·åˆ°è¿œç¨‹èŠ‚ç‚¹å¹¶ä¸”å…³é—­è¯¥ Channel ctx.writeAndFlush(Unpooled.EMPTY_BUFFER).addListener(ChannelFutureListener.CLOSE); &#125; // åœ¨è¯»å–æ“ä½œæœŸé—´ï¼Œæœ‰å¼‚å¸¸æŠ›å‡ºæ—¶ä¼šè°ƒç”¨ @Override public void exceptionCaught(ChannelHandlerContext ctx,Throwable cause) &#123; cause.printStackTrace(); ctx.close(); &#125;&#125; ChannelHandler çš„ä¸€äº›å…³é”®ç‚¹ï¼š é’ˆå¯¹ä¸åŒç±»å‹çš„äº‹ä»¶æ¥è°ƒç”¨ ChannelHandlerï¼› åº”ç”¨ç¨‹åºé€šè¿‡å®ç°æˆ–è€…æ‰©å±• ChannelHandler æ¥æŒ‚é’©åˆ°äº‹ä»¶çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¹¶ä¸”æä¾›è‡ªå®šä¹‰çš„åº”ç”¨ç¨‹åºé€»è¾‘ï¼› åœ¨æ¶æ„ä¸Šï¼ŒChannelHandler æœ‰åŠ©äºä¿æŒä¸šåŠ¡é€»è¾‘ä¸ç½‘ç»œå¤„ç†ä»£ç çš„åˆ†ç¦»ã€‚è¿™ç®€åŒ–äº†å¼€å‘è¿‡ç¨‹ï¼Œå› ä¸ºä»£ç å¿…é¡»ä¸æ–­åœ°æ¼”åŒ–ä»¥å“åº”ä¸æ–­å˜åŒ–çš„éœ€æ±‚ã€‚ å¼•å¯¼æœåŠ¡å™¨ç»‘å®šåˆ°æœåŠ¡å™¨å°†åœ¨å…¶ä¸Šç›‘å¬å¹¶æ¥å—ä¼ å…¥è¿æ¥è¯·æ±‚çš„ç«¯å£ï¼› é…ç½® Channelï¼Œä»¥å°†æœ‰å…³çš„å…¥ç«™æ¶ˆæ¯é€šçŸ¥ç»™ EchoServerHandler å®ä¾‹ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546// EchoServer ç±»public class EchoServer &#123; private final int port; public EchoServer(int port) &#123; this.port = port; &#125; public static void main(String[] args) throws Exception &#123; if (args.length != 1) &#123; System.err.println(\"Usage: \" + EchoServer.class.getSimpleName() + \" &lt;port&gt;\"); &#125; int port = Integer.parseInt(args[0]); new EchoServer(port).start(); &#125; public void start() throws Exception &#123; final EchoServerHandler serverHandler = new EchoServerHandler(); // åˆ›å»ºä¸€ä¸ªå¾ªç¯ç»„ EventLoopGroup EventLoopGroup group = new NioEventLoopGroup(); try &#123; // åˆ›å»ºä¸€ä¸ª ServerBootstrap çš„å®ä¾‹ä»¥å¼•å¯¼å’Œç»‘å®šæœåŠ¡å™¨ ServerBootstrap b = new ServerBootstrap(); b.group(group) .channel(NioServerSocketChannel.class) // æŒ‡å®šæœåŠ¡å™¨ç»‘å®šçš„æœ¬åœ°çš„ InetSocketAddress .localAddress(new InetSocketAddress(port)) .childHandler( // æ¥å—ä¸€ä¸ªæ–°è¿æ¥åˆ™ä¸€ä¸ªæ–°çš„å­ Channel å°†ä¼šè¢«åˆ›å»º new ChannelInitializer&lt;SocketChannel&gt;()&#123; // ä½¿ç”¨ä¸€ä¸ª EchoServerHandler çš„å®ä¾‹åˆå§‹åŒ–æ¯ä¸€ä¸ªæ–°çš„ Channel @Override public void initChannel(SocketChannel ch)throws Exception &#123; ch.pipeline().addLast(serverHandler); &#125; &#125; ); // å¼‚æ­¥åœ°ç»‘å®šæœåŠ¡å™¨ï¼Œsync() æ–¹æ³•çš„è°ƒç”¨å°†å¯¼è‡´å½“å‰ Thread é˜»å¡ï¼Œä¸€ç›´åˆ°ç»‘å®šæ“ä½œå®Œæˆä¸ºæ­¢ ChannelFuture f = b.bind().sync(); // å¼‚æ­¥åœ°å…³é—­æœåŠ¡å™¨ f.channel().closeFuture().sync(); &#125; finally &#123; group.shutdownGracefully().sync(); &#125; &#125; &#125; ç¼–å†™ Echo å®¢æˆ·ç«¯ Echo å®¢æˆ·ç«¯å°†ä¼šï¼š è¿æ¥åˆ°æœåŠ¡å™¨ï¼› å‘é€ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ¶ˆæ¯ï¼› å¯¹äºæ¯ä¸ªæ¶ˆæ¯ï¼Œç­‰å¾…å¹¶æ¥å—ä»æœåŠ¡å™¨å‘é€å›çš„ç›¸åŒæ¶ˆæ¯ å…³é—­è¿æ¥ã€‚ é€šè¿‡ ChannelHandler å®ç°å®¢æˆ·ç«¯é€»è¾‘å¦‚åŒæœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯å°†æ‹¥æœ‰ä¸€ä¸ªç”¨æ¥å¤„ç†æ•°æ®çš„ ChannelInboundHandlerã€‚ 123456789101112131415161718192021// å®¢æˆ·ç«¯çš„ ChannelHandler// ByteBuf ä¸º Nutty çš„å­—èŠ‚å®¹å™¨@Sharablepublic class EchoClientHandler extends SimpleChannelInboundHandler&lt;ByteBuf&gt; &#123; // åœ¨åˆ°æœåŠ¡å™¨çš„è¿æ¥å·²ç»å»ºç«‹ä¹‹åå°†è¢«è°ƒç”¨ @Override public void channelActive(ChannelHandlerContext ctx) &#123; ctx.writeAndFlush(Unpooled.copiedBuffer(\"Netty rocks!\",CharsetUtil.UTF_8)); &#125; // å½“ä»æœåŠ¡å™¨æ¥æ”¶åˆ°ä¸€æ¡æ¶ˆæ¯æ—¶è¢«è°ƒç”¨ @Override public void channelRead0(ChannelHandlerContext ctx, ByteBuf in) &#123; System.out.println(\"Client received: \" + in.toString(CharsetUtil.UTF_8)); &#125; // åœ¨å¤„ç†è¿‡ç¨‹ä¸­å¼•å‘å¼‚å¸¸æ—¶è¢«è°ƒç”¨ @Override public void exceptionCaught(ChannelHandlerContext ctx,Throwable cause) &#123; cause.printStackTrace(); ctx.close(); &#125;&#125; SimpleChannelInboundHandler ä¸ ChannelInboundHandler ä½ å¯èƒ½ä¼šæƒ³ï¼šä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨å®¢æˆ·ç«¯ä½¿ç”¨çš„æ˜¯ SimpleChannelInboundHandlerï¼Œè€Œä¸æ˜¯åœ¨ EchoServerHandler ä¸­æ‰€ä½¿ç”¨çš„ ChannelInboundHandlerAdapter å‘¢ï¼Ÿè¿™å’Œä¸¤ä¸ªå› ç´ çš„ç›¸äº’ä½œç”¨æœ‰å…³ï¼šä¸šåŠ¡é€»è¾‘å¦‚ä½•å¤„ç†æ¶ˆæ¯ä»¥åŠ Netty å¦‚ä½•ç®¡ç†èµ„æºã€‚ åœ¨å®¢æˆ·ç«¯ï¼Œå½“ channelRead0() æ–¹æ³•å®Œæˆæ—¶ï¼Œä½ å·²ç»æœ‰äº†ä¼ å…¥æ¶ˆæ¯ï¼Œå¹¶ä¸”å·²ç»å¤„ç†å®Œå®ƒäº†ã€‚å½“è¯¥æ–¹æ³•è¿”å›æ—¶ï¼ŒSimpleChannelInboundHandler è´Ÿè´£é‡Šæ”¾æŒ‡å‘ä¿å­˜è¯¥æ¶ˆæ¯çš„ ByteBuf çš„å†…å­˜å¼•ç”¨ã€‚ åœ¨ EchoServerHandler ä¸­ï¼Œä½ ä»ç„¶éœ€è¦å°†ä¼ å…¥æ¶ˆæ¯å›é€ç»™å‘é€è€…ï¼Œè€Œ write()æ“ä½œæ˜¯å¼‚æ­¥çš„ï¼Œç›´åˆ° channelRead() æ–¹æ³•è¿”å›åå¯èƒ½ä»ç„¶æ²¡æœ‰å®Œæˆã€‚ä¸ºæ­¤ï¼ŒEchoServerHandler æ‰©å±•äº† ChannelInboundHandlerAdapterï¼Œå…¶åœ¨è¿™ä¸ªæ—¶é—´ç‚¹ä¸Šä¸ä¼šé‡Šæ”¾æ¶ˆæ¯ã€‚ æ¶ˆæ¯åœ¨ EchoServerHandler çš„ channelReadComplete() æ–¹æ³•ä¸­ï¼Œå½“ writeAndFlush() æ–¹æ³•è¢«è°ƒç”¨æ—¶è¢«é‡Šæ”¾ å¼•å¯¼å®¢æˆ·ç«¯å¼•å¯¼å®¢æˆ·ç«¯ç±»ä¼¼äºå¼•å¯¼æœåŠ¡å™¨ï¼Œä¸åŒçš„æ˜¯ï¼Œå®¢æˆ·ç«¯æ˜¯ä½¿ç”¨ä¸»æœºå’Œç«¯å£å‚æ•°æ¥è¿æ¥è¿œç¨‹åœ°å€ï¼Œä¹Ÿå°±æ˜¯è¿™é‡Œçš„ Echo æœåŠ¡å™¨çš„åœ°å€ï¼Œè€Œä¸æ˜¯ç»‘å®šåˆ°ä¸€ä¸ªä¸€ç›´è¢«ç›‘å¬çš„ç«¯å£ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940// å®¢æˆ·ç«¯çš„ä¸»ç±»public class EchoClient &#123; private final String host; private final int port; public EchoClient(String host, int port) &#123; this.host = host; this.port = port; &#125; public void start() throws Exception &#123; EventLoopGroup group = new NioEventLoopGroup(); try &#123; Bootstrap b = new Bootstrap(); b.group(group) .channel(NioSocketChannel.class) .remoteAddress(new InetSocketAddress(host, port)) .handler( new ChannelInitializer&lt;SocketChannel&gt;() &#123; @Override public void initChannel(SocketChannel ch) throws Exception &#123; ch.pipeline().addLast(new EchoClientHandler()); &#125; &#125; ); ChannelFuture f = b.connect().sync(); f.channel().closeFuture().sync(); &#125; finally &#123; group.shutdownGracefully().sync(); &#125; &#125; public static void main(String[] args) throws Exception &#123; if (args.length != 2) &#123; System.err.println(\"Usage: \" + EchoClient.class.getSimpleName() + \" &lt;host&gt; &lt;port&gt;\"); return; &#125; String host = args[0]; int port = Integer.parseInt(args[1]); new EchoClient(host, port).start(); &#125; &#125;","categories":[{"name":"Java","slug":"Java","permalink":"http://yoursite.com/categories/Java/"}],"tags":[{"name":"Netty","slug":"Netty","permalink":"http://yoursite.com/tags/Netty/"}]},{"title":"ç¯å¢ƒå˜é‡","slug":"ç¯å¢ƒå˜é‡","date":"2020-01-21T14:35:41.000Z","updated":"2020-02-14T13:31:29.028Z","comments":true,"path":"2020/01/21/ç¯å¢ƒå˜é‡/","link":"","permalink":"http://yoursite.com/2020/01/21/%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F/","excerpt":"Java ç¯å¢ƒè®¾ç½®JAVA_HOMEï¼š[ JDK å®‰è£…ç›®å½• ]","text":"Java ç¯å¢ƒè®¾ç½®JAVA_HOMEï¼š[ JDK å®‰è£…ç›®å½• ] CLASSPATHï¼šâ€¦;%JAVA_HOME%\\bin Maven ç¯å¢ƒè®¾ç½®M2_HOMEï¼š[ å®‰è£…ç›®å½• ]/apache-maven-x.x.x CLASSPATHï¼šâ€¦;%M2_HOME%\\bin","categories":[{"name":"Tool","slug":"Tool","permalink":"http://yoursite.com/categories/Tool/"}],"tags":[{"name":"Path","slug":"Path","permalink":"http://yoursite.com/tags/Path/"}]},{"title":"Netty å…¥é—¨ç®€ä»‹","slug":"Netty/Netty å…¥é—¨/Netty å…¥é—¨ç®€ä»‹","date":"2020-01-21T01:37:11.000Z","updated":"2020-04-19T06:31:06.211Z","comments":true,"path":"2020/01/21/Netty/Netty å…¥é—¨/Netty å…¥é—¨ç®€ä»‹/","link":"","permalink":"http://yoursite.com/2020/01/21/Netty/Netty%20%E5%85%A5%E9%97%A8/Netty%20%E5%85%A5%E9%97%A8%E7%AE%80%E4%BB%8B/","excerpt":"Java IOæ— è®ºæ˜¯ C è¯­è¨€ï¼Œè¿˜æ˜¯ Javaï¼Œåœ¨è¿›è¡Œç½‘ç»œç¼–ç¨‹çš„å¼€å‘æ—¶éƒ½è¾ƒä¸ºä¸å‹å¥½ã€‚æ—©æœŸçš„ Java APIï¼ˆ java.net ï¼‰åªæ”¯æŒç”±æœ¬åœ°ç³»ç»Ÿå¥—æ¥å­—åº“æä¾›æ‰€è°“çš„é˜»å¡å‡½æ•°ã€‚","text":"Java IOæ— è®ºæ˜¯ C è¯­è¨€ï¼Œè¿˜æ˜¯ Javaï¼Œåœ¨è¿›è¡Œç½‘ç»œç¼–ç¨‹çš„å¼€å‘æ—¶éƒ½è¾ƒä¸ºä¸å‹å¥½ã€‚æ—©æœŸçš„ Java APIï¼ˆ java.net ï¼‰åªæ”¯æŒç”±æœ¬åœ°ç³»ç»Ÿå¥—æ¥å­—åº“æä¾›æ‰€è°“çš„é˜»å¡å‡½æ•°ã€‚ 12345678910111213141516171819202122// é˜»å¡ I/O ç¤ºä¾‹I/O// åˆ›å»ºä¸€ä¸ª ServerSocket ç”¨ä»¥ç›‘å¬ç«¯å£ä¸Šçš„è¿æ¥è¯·æ±‚ServerSocket serverSocket = new ServerSocket(portNumber);// accept() æ–¹æ³•è°ƒç”¨å°†è¢«é˜»å¡ï¼Œç›´åˆ°ä¸€ä¸ªè¿æ¥å»ºç«‹Socket clientSocket = serverSocket.accept();BufferReader in = new BufferReader( new InputStreamReader( clientSocket.getInputStream() ));// PrintWriter(OutputStream out, boolean autoFlush) ???PrintWriter out = new PrintWriter(clientSocket.getOutputStream(), true);String request, response;while ((request = in.readLine()) != null) &#123; if (\"Done\".equals(request)) &#123; break; // å®¢æˆ·ç«¯å‘é€äº† Done åˆ™é€€å‡ºå¤„ç†å¾ªç¯ &#125; // You can use ProcessRequest to handle your request response = processRequest(request); out.println(response);&#125; è¿™æ®µä»£ç ç‰‡æ®µå°†åªèƒ½åŒæ—¶å¤„ç†ä¸€ä¸ªè¿æ¥ï¼Œè¦ç®¡ç†å¤šä¸ªå¹¶å‘å®¢æˆ·ç«¯ï¼Œéœ€è¦ä¸ºæ¯ä¸ªæ–°çš„å®¢æˆ·ç«¯ Socket åˆ›å»ºä¸€ä¸ªæ–°çš„ Threadã€‚ ä½¿ç”¨é˜»å¡ I/Oå¤„ç†å¤šä¸ªè¿æ¥ï¼š Java NIOclass java.nio.channels.Selector æ˜¯ Java çš„éé˜»å¡ I/O å®ç°çš„å…³é”®ã€‚å®ƒä½¿ç”¨äº†äº‹ä»¶é€šçŸ¥ API ä»¥ç¡®å®šåœ¨ä¸€ç»„éé˜»å¡å¥—æ¥å­—ä¸­æœ‰å“ªäº›å·²ç»å°±ç»ªèƒ½å¤Ÿè¿› è¡Œ I/O ç›¸å…³çš„æ“ä½œã€‚å› ä¸ºå¯ä»¥åœ¨ä»»ä½•çš„æ—¶é—´æ£€æŸ¥ä»»æ„ çš„è¯»æ“ä½œæˆ–è€…å†™æ“ä½œçš„å®ŒæˆçŠ¶æ€ã€‚ ä½¿ç”¨ Selector çš„éé˜»å¡ I/O Netty ç®€ä»‹åœ¨ç½‘ç»œç¼–ç¨‹é¢†åŸŸï¼ŒNetty æ˜¯ Java çš„å“è¶Šæ¡†æ¶ã€‚å®ƒé©¾é©­äº† Java é«˜ API çš„èƒ½åŠ›ï¼Œå¹¶å°†å…¶éšè—åœ¨ä¸€ä¸ªæ˜“äºä½¿ç”¨çš„ API ä¹‹åã€‚Netty ä½¿ä½ å¯ä»¥ä¸“æ³¨äºè‡ªå·±çœŸæ­£æ„Ÿå…´è¶£çš„ï¼šä½ çš„åº”ç”¨ç¨‹åºçš„ç‹¬ä¸€æ— äºŒçš„ä»·å€¼ã€‚ ä¸€ä¸ªæ—¢æ˜¯å¼‚æ­¥çš„åˆæ˜¯äº‹ä»¶é©±åŠ¨çš„ç³»ç»Ÿä¼šè¡¨ç°å‡ºä¸€ç§ç‰¹æ®Šçš„ã€å¯¹æˆ‘ä»¬æ¥è¯´æå…·ä»·å€¼çš„è¡Œä¸ºï¼šå®ƒå¯ä»¥ä»¥ä»»æ„çš„é¡ºåºå“åº”åœ¨ä»»æ„çš„æ—¶é—´ç‚¹äº§ç”Ÿçš„äº‹ä»¶ã€‚ å®Œå…¨å¼‚æ­¥çš„ I/Oï¼šéé˜»å¡ç½‘ç»œè°ƒç”¨ä½¿å¾—æˆ‘ä»¬å¯ä»¥ä¸å¿…ç­‰å¾…ä¸€ä¸ªæ“ä½œçš„å®Œæˆã€‚å¼‚æ­¥æ–¹æ³•ä¼šç«‹å³è¿”å›ï¼Œå¹¶ä¸”åœ¨å®ƒå®Œæˆæ—¶ï¼Œä¼šç›´æ¥æˆ–è€…åœ¨ç¨åçš„æŸä¸ªæ—¶é—´ç‚¹é€šçŸ¥ç”¨æˆ·ã€‚ é€‰æ‹©å™¨ä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿé€šè¿‡è¾ƒå°‘çš„çº¿ç¨‹ä¾¿å¯ç›‘è§†è®¸å¤šè¿æ¥ä¸Šçš„äº‹ä»¶ã€‚ Netty çš„æ ¸å¿ƒç»„ä»¶ChannelChannel æ—¶ Java NIO çš„ä¸€ä¸ªåŸºæœ¬æ„é€ ã€‚ å®ƒä»£è¡¨ä¸€ä¸ªåˆ°å®ä½“ï¼ˆå¦‚ä¸€ä¸ªç¡¬ä»¶è®¾å¤‡ã€ä¸€ä¸ªæ–‡ä»¶ã€ä¸€ä¸ªç½‘ç»œå¥—æ¥å­—æˆ–è€…ä¸€ä¸ªèƒ½å¤Ÿæ‰§ è¡Œä¸€ä¸ªæˆ–è€…å¤šä¸ªä¸åŒçš„I/Oæ“ä½œçš„ç¨‹åºç»„ä»¶ï¼‰çš„å¼€æ”¾è¿æ¥ï¼Œå¦‚è¯»æ“ä½œå’Œå†™æ“ä½œã€‚ åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥æŠŠ Channel çœ‹ä½œæ˜¯ä¼ å…¥ï¼ˆå…¥ç«™ï¼‰æˆ–è€…ä¼ å‡ºï¼ˆå‡ºç«™ï¼‰æ•°æ®çš„è½½ä½“ã€‚å› æ­¤ï¼Œå®ƒå¯ä»¥è¢«æ‰“å¼€æˆ–è€…è¢«å…³é—­ï¼Œè¿æ¥æˆ–è€…æ–­å¼€è¿æ¥ã€‚ å›è°ƒNetty åœ¨å†…éƒ¨ä½¿ç”¨äº†å›è°ƒæ¥å¤„ç†äº‹ä»¶ï¼›å½“ä¸€ä¸ªå›è°ƒè¢«è§¦å‘æ—¶ï¼Œç›¸å…³çš„äº‹ä»¶å¯ä»¥è¢«ä¸€ä¸ª interfaceChannelHandler çš„å®ç°å¤„ç† 12345678910// è¢«å›è°ƒè§¦å‘çš„ ChannelHandlerpublic class ConnectHandler extends ChannelInboundHandlerAdapter &#123; @Override // å½“ä¸€ä¸ªæ–°çš„è¿æ¥è¢«å»ºç«‹å®Œæˆæ—¶ï¼Œæ­¤æ–¹æ³•å°†ä¼šè¢«è°ƒç”¨ public void channelActive(ChannelHandlerContext ctx) throws Exception &#123; System.out.println( \"Client \" + ctx.channel().remoteAddress() + \" connected\" ); &#125;&#125; FutureFuture æä¾›äº†å¦ä¸€ç§åœ¨æ“ä½œå®Œæˆæ—¶é€šçŸ¥åº”ç”¨ç¨‹åºçš„æ–¹å¼ã€‚è¿™ä¸ªå¯¹è±¡å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œçš„ç»“æœçš„å ä½ç¬¦ï¼›å®ƒå°†åœ¨æœªæ¥çš„æŸä¸ªæ—¶åˆ»å®Œæˆï¼Œå¹¶æä¾›å¯¹å…¶ç»“æœçš„è®¿é—®ã€‚ JDK é¢„ç½®äº† interface java.util.concurrent.Futureï¼Œä½†æ˜¯å…¶æ‰€æä¾›çš„å®ç°ï¼Œåªå…è®¸æ‰‹åŠ¨æ£€æŸ¥å¯¹åº”çš„æ“ä½œæ˜¯å¦å·²ç»å®Œæˆï¼Œæˆ–è€…ä¸€ç›´é˜»å¡ç›´åˆ°å®ƒå®Œæˆã€‚è¿™æ˜¯éå¸¸ç¹ççš„ï¼Œæ‰€ä»¥ Netty æä¾›äº†å®ƒè‡ªå·±çš„å®ç°ï¼šChannelFutureï¼Œç”¨äºåœ¨æ‰§è¡Œå¼‚æ­¥æ“ä½œçš„æ—¶å€™ä½¿ç”¨ã€‚ ChannelFutureæä¾›äº†å‡ ç§é¢å¤–çš„æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•ä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿæ³¨å†Œä¸€ä¸ªæˆ–è€…å¤šä¸ª ChannelFutureListener å®ä¾‹ã€‚ç”± ChannelFutureListener æä¾›çš„é€šçŸ¥æœºåˆ¶æ¶ˆé™¤äº†æ‰‹åŠ¨æ£€æŸ¥å¯¹åº”çš„æ“ä½œæ˜¯å¦å®Œæˆçš„å¿…è¦ã€‚ ç›‘å¬å™¨çš„å›è°ƒæ–¹æ³• operationComplete()ï¼šå°†ä¼šåœ¨å¯¹åº”çš„æ“ä½œå®Œæˆæ—¶è¢«è°ƒç”¨ã€‚ ç›‘å¬å™¨å¯ä»¥åˆ¤æ–­æ“ä½œæ˜¯æˆåŠŸåœ°å®Œæˆäº†è¿˜æ˜¯å‡ºé”™äº†ï¼ˆ æ£€ç´¢äº§ç”Ÿçš„ Throwable ï¼‰ã€‚ æ¯ä¸ª Netty çš„å‡ºç«™ I/O æ“ä½œéƒ½å°†è¿”å›ä¸€ä¸ª ChannelFutureï¼›ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä»¬éƒ½ä¸ä¼šé˜»å¡ã€‚æ­£å¦‚æˆ‘ä»¬å‰é¢æ‰€æåˆ°è¿‡çš„ä¸€æ ·ï¼ŒNetty å®Œå…¨æ˜¯å¼‚æ­¥å’Œäº‹ä»¶é©±åŠ¨çš„ã€‚ 123456789101112131415161718192021222324252627// å¼‚æ­¥çš„å»ºç«‹è¿æ¥Channel channel = ...;// Does not blockChannelFuture future = channel.connect( // å¼‚æ­¥åœ°è¿æ¥åˆ°è¿œç¨‹èŠ‚ç‚¹ new InetSocketAddress(\"192.168.0.1\", 25));// æ³¨å†Œä¸€ä¸ª ChannelFutureListener ä»¥ä¾¿åœ¨æ“ä½œå®Œæˆæ—¶è·å¾—é€šçŸ¥future.addListener( new ChannelFutureListener() &#123; @Override public void operationComplete(ChannelFuture future) &#123; // æ£€æŸ¥æ“ä½œçš„çŠ¶æ€ if (future.isSuccess())&#123; ByteBuf buffer = Unpooled.copiedBuffer( \"Hello\",Charset.defaultCharset() ); // å°†æ•°æ®å¼‚æ­¥å‘é€åˆ°è¿œç¨‹èŠ‚ç‚¹ ChannelFuture wf = future.channel().writeAndFlush(buffer); .... &#125; else &#123; Throwable cause = future.cause(); cause.printStackTrace(); &#125; &#125; &#125;); å›è°ƒå’Œ Future æ˜¯ç›¸äº’è¡¥å……çš„æœºåˆ¶ï¼›å®ƒä»¬ç›¸äº’ç»“åˆï¼Œæ„æˆäº† Netty æœ¬èº«çš„å…³é”®æ„ä»¶å—ä¹‹ä¸€ã€‚ äº‹ä»¶å’Œ ChannelHandlerNetty æ˜¯ä¸€ä¸ªç½‘ç»œç¼–ç¨‹æ¡†æ¶ï¼Œæ‰€ä»¥äº‹ä»¶æ˜¯æŒ‰ç…§å®ƒä»¬ä¸å…¥ç«™æˆ–å‡ºç«™æ•°æ®æµçš„ç›¸å…³æ€§è¿›è¡Œåˆ†ç±»çš„ã€‚ å¯èƒ½ç”±å…¥ç«™æ•°æ®æˆ–è€…ç›¸å…³çš„çŠ¶æ€æ›´æ”¹è€Œè§¦å‘çš„äº‹ä»¶ï¼š è¿æ¥å·²è¢«æ¿€æ´»æˆ–è€…è¿æ¥å¤±æ´»ï¼› æ•°æ®è¯»å–ï¼› ç”¨æˆ·äº‹ä»¶ï¼› é”™è¯¯äº‹ä»¶ã€‚ å‡ºç«™äº‹ä»¶æ˜¯æœªæ¥å°†ä¼šè§¦å‘çš„æŸä¸ªåŠ¨ä½œçš„æ“ä½œç»“æœï¼Œè¿™äº›åŠ¨ä½œåŒ…æ‹¬ï¼š æ‰“å¼€æˆ–è€…å…³é—­åˆ°è¿œç¨‹èŠ‚ç‚¹çš„è¿æ¥ï¼› å°†æ•°æ®å†™åˆ°æˆ–è€…å†²åˆ·åˆ°å¥—æ¥å­—ã€‚ æ¯ä¸ªäº‹ä»¶éƒ½å¯ä»¥è¢«åˆ†å‘ç»™ ChannelHandler ç±»ä¸­çš„æŸä¸ªç”¨æˆ·å®ç°çš„æ–¹æ³•ï¼Œåé¢ä¼šå¯¹æ­¤ç±»è¿›è¡Œæ›´è¿›ä¸€æ­¥çš„è¯´æ˜ï¼Œç›®å‰ä½ å¯ä»¥æ¯ä¸ª ChannelHandler çš„å®ä¾‹éƒ½ç±»ä¼¼äºä¸€ç§ä¸ºäº†å“åº”ç‰¹å®šäº‹ä»¶è€Œè¢«æ‰§è¡Œçš„å›è°ƒã€‚ æµç» ChannelHandler é“¾çš„å…¥ç«™äº‹ä»¶å’Œå‡ºç«™äº‹ä»¶ å„ç»„ä»¶çš„æ•´åˆ Futureã€å›è°ƒå’Œ ChannelHandler Netty çš„å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹æ˜¯å»ºç«‹åœ¨ Future å’Œå›è°ƒçš„æ¦‚å¿µä¹‹ä¸Šçš„ï¼Œè€Œå°†äº‹ä»¶æ´¾å‘åˆ° ChannelHandler çš„æ–¹æ³•åˆ™å‘ç”Ÿåœ¨æ›´æ·±çš„å±‚æ¬¡ä¸Šã€‚ç»“åˆåœ¨ä¸€èµ·ï¼Œè¿™äº›å…ƒç´ å°±æä¾›äº†ä¸€ä¸ªå¤„ç†ç¯å¢ƒï¼Œä½¿ä½ çš„åº”ç”¨ç¨‹åºé€» è¾‘å¯ä»¥ç‹¬ç«‹äºä»»ä½•ç½‘ç»œæ“ä½œç›¸å…³çš„é¡¾è™‘è€Œç‹¬ç«‹åœ°æ¼”å˜ã€‚è¿™ä¹Ÿæ˜¯ Netty çš„è®¾è®¡æ–¹å¼çš„ä¸€ä¸ªå…³é”®ç›®æ ‡ã€‚ æ‹¦æˆªæ“ä½œä»¥åŠé«˜é€Ÿåœ°è½¬æ¢å…¥ç«™æ•°æ®å’Œå‡ºç«™æ•°æ®ï¼Œéƒ½åªéœ€è¦ä½ æä¾›å›è°ƒæˆ–è€…åˆ©ç”¨æ“ä½œæ‰€è¿”å›çš„ Futureã€‚è¿™ä½¿å¾—é“¾æ¥æ“ä½œå˜å¾—æ—¢ç®€å•åˆé«˜æ•ˆï¼Œå¹¶ä¸”ä¿ƒè¿›äº†å¯é‡ç”¨çš„é€šç”¨ä»£ç çš„ç¼–å†™ã€‚ é€‰æ‹©å™¨ã€äº‹ä»¶å’Œ EventLoop Netty é€šè¿‡è§¦å‘äº‹ä»¶å°† Selector ä»åº”ç”¨ç¨‹åºä¸­æŠ½è±¡å‡ºæ¥ï¼Œæ¶ˆé™¤äº†æ‰€æœ‰æœ¬æ¥å°†éœ€è¦æ‰‹åŠ¨ç¼–å†™ çš„æ´¾å‘ä»£ç ã€‚åœ¨å†…éƒ¨ï¼Œå°†ä¼šä¸ºæ¯ä¸ª Channel åˆ†é…ä¸€ä¸ª EventLoopï¼Œç”¨ä»¥å¤„ç†æ‰€æœ‰äº‹ä»¶ã€‚ EventLoop æœ¬èº«åªç”±ä¸€ä¸ªçº¿ç¨‹é©±åŠ¨ï¼Œå…¶å¤„ç†äº†ä¸€ä¸ª Channel çš„æ‰€æœ‰ I/O äº‹ä»¶ï¼Œå¹¶ä¸”åœ¨è¯¥ EventLoop çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…éƒ½ä¸ä¼šæ”¹å˜ï¼ˆ æ— éœ€é¡¾è™‘åŒæ­¥ ï¼‰ã€‚","categories":[{"name":"Java","slug":"Java","permalink":"http://yoursite.com/categories/Java/"}],"tags":[{"name":"Netty","slug":"Netty","permalink":"http://yoursite.com/tags/Netty/"}]}],"categories":[{"name":"Big Data","slug":"Big-Data","permalink":"http://yoursite.com/categories/Big-Data/"},{"name":"OS","slug":"OS","permalink":"http://yoursite.com/categories/OS/"},{"name":"BigData","slug":"BigData","permalink":"http://yoursite.com/categories/BigData/"},{"name":"Python","slug":"Python","permalink":"http://yoursite.com/categories/Python/"},{"name":"Distributed","slug":"Distributed","permalink":"http://yoursite.com/categories/Distributed/"},{"name":"Demo","slug":"Demo","permalink":"http://yoursite.com/categories/Demo/"},{"name":"Tool","slug":"Tool","permalink":"http://yoursite.com/categories/Tool/"},{"name":"ORM","slug":"ORM","permalink":"http://yoursite.com/categories/ORM/"},{"name":"FrontEnd","slug":"FrontEnd","permalink":"http://yoursite.com/categories/FrontEnd/"},{"name":"Java","slug":"Java","permalink":"http://yoursite.com/categories/Java/"},{"name":"Software","slug":"Software","permalink":"http://yoursite.com/categories/Software/"},{"name":"Welab","slug":"Welab","permalink":"http://yoursite.com/categories/Welab/"},{"name":"English","slug":"English","permalink":"http://yoursite.com/categories/English/"},{"name":"Project","slug":"Project","permalink":"http://yoursite.com/categories/Project/"},{"name":"Life","slug":"Life","permalink":"http://yoursite.com/categories/Life/"}],"tags":[{"name":"Hive","slug":"Hive","permalink":"http://yoursite.com/tags/Hive/"},{"name":"Linux","slug":"Linux","permalink":"http://yoursite.com/tags/Linux/"},{"name":"Hadoop","slug":"Hadoop","permalink":"http://yoursite.com/tags/Hadoop/"},{"name":"HDFS","slug":"HDFS","permalink":"http://yoursite.com/tags/HDFS/"},{"name":"MapReduce","slug":"MapReduce","permalink":"http://yoursite.com/tags/MapReduce/"},{"name":"Machine Learning","slug":"Machine-Learning","permalink":"http://yoursite.com/tags/Machine-Learning/"},{"name":"sklearn","slug":"sklearn","permalink":"http://yoursite.com/tags/sklearn/"},{"name":"RabbitMQ","slug":"RabbitMQ","permalink":"http://yoursite.com/tags/RabbitMQ/"},{"name":"Dubbo","slug":"Dubbo","permalink":"http://yoursite.com/tags/Dubbo/"},{"name":"Redis","slug":"Redis","permalink":"http://yoursite.com/tags/Redis/"},{"name":"H2","slug":"H2","permalink":"http://yoursite.com/tags/H2/"},{"name":"Mybatis","slug":"Mybatis","permalink":"http://yoursite.com/tags/Mybatis/"},{"name":"Vue","slug":"Vue","permalink":"http://yoursite.com/tags/Vue/"},{"name":"Spring Boot","slug":"Spring-Boot","permalink":"http://yoursite.com/tags/Spring-Boot/"},{"name":"Aysnc","slug":"Aysnc","permalink":"http://yoursite.com/tags/Aysnc/"},{"name":"Scheduled","slug":"Scheduled","permalink":"http://yoursite.com/tags/Scheduled/"},{"name":"Email","slug":"Email","permalink":"http://yoursite.com/tags/Email/"},{"name":"Security","slug":"Security","permalink":"http://yoursite.com/tags/Security/"},{"name":"Shiro","slug":"Shiro","permalink":"http://yoursite.com/tags/Shiro/"},{"name":"ElasticSearch","slug":"ElasticSearch","permalink":"http://yoursite.com/tags/ElasticSearch/"},{"name":"MQ","slug":"MQ","permalink":"http://yoursite.com/tags/MQ/"},{"name":"Springboot","slug":"Springboot","permalink":"http://yoursite.com/tags/Springboot/"},{"name":"Cache","slug":"Cache","permalink":"http://yoursite.com/tags/Cache/"},{"name":"MyBatis","slug":"MyBatis","permalink":"http://yoursite.com/tags/MyBatis/"},{"name":"High Concurrency","slug":"High-Concurrency","permalink":"http://yoursite.com/tags/High-Concurrency/"},{"name":"Design Patterns","slug":"Design-Patterns","permalink":"http://yoursite.com/tags/Design-Patterns/"},{"name":"Crawler","slug":"Crawler","permalink":"http://yoursite.com/tags/Crawler/"},{"name":"Base","slug":"Base","permalink":"http://yoursite.com/tags/Base/"},{"name":"Tool","slug":"Tool","permalink":"http://yoursite.com/tags/Tool/"},{"name":"Project","slug":"Project","permalink":"http://yoursite.com/tags/Project/"},{"name":"CET6","slug":"CET6","permalink":"http://yoursite.com/tags/CET6/"},{"name":"JPA","slug":"JPA","permalink":"http://yoursite.com/tags/JPA/"},{"name":"Druid","slug":"Druid","permalink":"http://yoursite.com/tags/Druid/"},{"name":"JDBC","slug":"JDBC","permalink":"http://yoursite.com/tags/JDBC/"},{"name":"Docker","slug":"Docker","permalink":"http://yoursite.com/tags/Docker/"},{"name":"MySQL","slug":"MySQL","permalink":"http://yoursite.com/tags/MySQL/"},{"name":"Web","slug":"Web","permalink":"http://yoursite.com/tags/Web/"},{"name":"Log","slug":"Log","permalink":"http://yoursite.com/tags/Log/"},{"name":"Netty","slug":"Netty","permalink":"http://yoursite.com/tags/Netty/"},{"name":"Chatroom","slug":"Chatroom","permalink":"http://yoursite.com/tags/Chatroom/"},{"name":"Servlet","slug":"Servlet","permalink":"http://yoursite.com/tags/Servlet/"},{"name":"Netty Websocket","slug":"Netty-Websocket","permalink":"http://yoursite.com/tags/Netty-Websocket/"},{"name":"Spring MVC","slug":"Spring-MVC","permalink":"http://yoursite.com/tags/Spring-MVC/"},{"name":"Friends","slug":"Friends","permalink":"http://yoursite.com/tags/Friends/"},{"name":"WebSocket","slug":"WebSocket","permalink":"http://yoursite.com/tags/WebSocket/"},{"name":"Notes","slug":"Notes","permalink":"http://yoursite.com/tags/Notes/"},{"name":"Env","slug":"Env","permalink":"http://yoursite.com/tags/Env/"},{"name":"Git","slug":"Git","permalink":"http://yoursite.com/tags/Git/"},{"name":"MessyCode","slug":"MessyCode","permalink":"http://yoursite.com/tags/MessyCode/"},{"name":"Maven","slug":"Maven","permalink":"http://yoursite.com/tags/Maven/"},{"name":"IDEA","slug":"IDEA","permalink":"http://yoursite.com/tags/IDEA/"},{"name":"Hexo","slug":"Hexo","permalink":"http://yoursite.com/tags/Hexo/"},{"name":"Github","slug":"Github","permalink":"http://yoursite.com/tags/Github/"},{"name":"Path","slug":"Path","permalink":"http://yoursite.com/tags/Path/"}]}