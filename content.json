{"meta":{"title":"Wingo's Blog","subtitle":"","description":"","author":"Wingo","url":"http://yoursite.com","root":"/"},"pages":[{"title":"","date":"2020-08-04T14:21:58.399Z","updated":"2020-01-20T15:05:42.000Z","comments":true,"path":"categories/index.html","permalink":"http://yoursite.com/categories/index.html","excerpt":"","text":""},{"title":"","date":"2020-08-04T14:21:58.399Z","updated":"2020-07-10T04:26:45.605Z","comments":true,"path":"tags/index.html","permalink":"http://yoursite.com/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"çº¿æ€§ä»£æ•°","slug":"æ•°å­¦æ¨å¯¼/çº¿æ€§ä»£æ•°","date":"2020-08-15T09:55:40.000Z","updated":"2020-08-15T09:58:27.117Z","comments":true,"path":"2020/08/15/æ•°å­¦æ¨å¯¼/çº¿æ€§ä»£æ•°/","link":"","permalink":"http://yoursite.com/2020/08/15/%E6%95%B0%E5%AD%A6%E6%8E%A8%E5%AF%BC/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0/","excerpt":"ä½œä¸ºä¸€ä¸ªå­¦æ¸£ï¼Œåœ¨çœ‹ä¹¦ä¸­æ€»ä¼šé‡åˆ°è®¸å¤šä¸æ‡‚çš„åŸºç¡€çŸ¥è¯†ï¼Œåœ¨è¿™é‡Œåšä¸ªæ±‡æ€»æ–¹ä¾¿æŸ¥çœ‹ï¼Œè¿™é‡Œæ˜¯æ•°å­¦æ¨å¯¼çš„çº¿æ€§ä»£æ•°ç¯‡ã€‚","text":"ä½œä¸ºä¸€ä¸ªå­¦æ¸£ï¼Œåœ¨çœ‹ä¹¦ä¸­æ€»ä¼šé‡åˆ°è®¸å¤šä¸æ‡‚çš„åŸºç¡€çŸ¥è¯†ï¼Œåœ¨è¿™é‡Œåšä¸ªæ±‡æ€»æ–¹ä¾¿æŸ¥çœ‹ï¼Œè¿™é‡Œæ˜¯æ•°å­¦æ¨å¯¼çš„çº¿æ€§ä»£æ•°ç¯‡ã€‚ çŸ©é˜µæ±‚å¯¼","categories":[{"name":"æ•°å­¦æ¨å¯¼","slug":"æ•°å­¦æ¨å¯¼","permalink":"http://yoursite.com/categories/%E6%95%B0%E5%AD%A6%E6%8E%A8%E5%AF%BC/"}],"tags":[{"name":"çº¿æ€§ä»£æ•°","slug":"çº¿æ€§ä»£æ•°","permalink":"http://yoursite.com/tags/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0/"}]},{"title":"æ·±åº¦å­¦ä¹ å…¥é—¨","slug":"æ·±åº¦å­¦ä¹ /æ·±åº¦å­¦ä¹ å…¥é—¨","date":"2020-08-08T02:16:57.000Z","updated":"2020-08-16T13:47:21.715Z","comments":true,"path":"2020/08/08/æ·±åº¦å­¦ä¹ /æ·±åº¦å­¦ä¹ å…¥é—¨/","link":"","permalink":"http://yoursite.com/2020/08/08/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E5%85%A5%E9%97%A8/","excerpt":"æ·±åº¦å­¦ä¹ å…¥é—¨ï¼šåŸºäº Python çš„ç†è®ºä¸å®ç°ã€‚","text":"æ·±åº¦å­¦ä¹ å…¥é—¨ï¼šåŸºäº Python çš„ç†è®ºä¸å®ç°ã€‚ å¿…å¤‡çŸ¥è¯†åœ¨æ­£å¼å¼€å§‹å­¦ä¹ å­¦ä¹ æ·±åº¦å­¦ä¹ ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€äº›å¿…é¡»è¦æŒæ¡çš„åŸºæœ¬çŸ¥è¯†ã€‚ï¼ˆPython çš„åŸºç¡€è¯­æ³•è¯·å‚ç…§æœ¬äººçš„å¦ä¸€ç¯‡åšå®¢ï¼šçˆ¶ä¸å­ç¼–ç¨‹ä¹‹æ—…ï¼‰ AnacondaAnaconda å¯ä»¥ç»Ÿä¸€ç®¡ç†å¼€å‘ç¯å¢ƒï¼Œä»¥åŠä¾¿æ·çš„è·å–åŠç®¡ç†åŒ…ã€‚ 12345678# åˆ›å»ºä¸€ä¸ªåä¸º py37 çš„å¼€å‘ç¯å¢ƒï¼Œå¹¶æŒ‡å®š python ç‰ˆæœ¬conda create -n py37 python=3.7# æ¿€æ´» py37 ç¯å¢ƒconda activate py37# é€€å‡º py37 ç¯å¢ƒconda deactivate py37# åˆ é™¤conda remove -n py37 --all NumPyåœ¨æ·±åº¦å­¦ä¹ çš„å®ç°ä¸­ï¼Œç»å¸¸å‡ºç°æ•°ç»„å’ŒçŸ©é˜µçš„è®¡ç®—ã€‚NumPy çš„æ•°ç»„ç±» numpy.array ä¸­æä¾›äº†å¾ˆå¤šä¾¿æ·çš„æ–¹æ³•ï¼Œåœ¨å®ç°æ·±åº¦å­¦ä¹ æ—¶ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨è¿™äº›æ–¹æ³•ã€‚æœ¬èŠ‚æˆ‘ä»¬æ¥ç®€å•ä»‹ç»ä¸€ä¸‹åé¢ä¼šç”¨åˆ°çš„ NumPyã€‚ 123456789101112131415## å¯¼å…¥ NumPy åº“import numpy as np## ç”Ÿæˆ NumPy æ•°ç»„x = np.array([1.0, 2.0, 3.0])print(x) # [ 1. 2. 3.]type(x) # &lt;class 'numpy.ndarray'&gt;## NumPy æ•°ç»„çš„ç®—æœ¯è¿ç®—x = np.array([1.0, 2.0, 3.0])y = np.array([2.0, 4.0, 6.0])x + y # array([ 3., 6., 9.])x - y # array([ -1., -2., -3.])x * y # array([ 2., 8., 18.])x / y # array([ 0.5, 0.5, 0.5]) æ³¨æ„ï¼Œåœ¨ä¸Šé¢çš„ NumPy ç®—æ•°è¿ç®—ä¸­ï¼Œæ•°ç»„ x å’Œæ•°ç»„ y çš„å…ƒç´ ä¸ªæ•°æ˜¯ç›¸åŒçš„ï¼ˆå¯¹åº”å…ƒç´ è®¡ç®—ï¼‰ï¼Œå¦‚æœå…ƒç´ ä¸ªæ•°ä¸åŒï¼Œç¨‹åºå°±ä¼šæŠ¥é”™ï¼Œæ‰€ä»¥å…ƒç´ ä¸ªæ•°ä¿æŒä¸€è‡´éå¸¸é‡è¦ã€‚ æ­¤å¤–ï¼ŒNumPy æ•°ç»„ä¸ä»…å¯ä»¥è¿›è¡Œ element-wise è¿ç®—ï¼Œä¹Ÿå¯ä»¥å’Œå•ä¸€çš„æ•°å€¼ï¼ˆæ ‡é‡ï¼‰ç»„åˆå™¨æ¥è¿›è¡Œè¿ç®—ã€‚ æ­¤æ—¶ï¼Œéœ€è¦åœ¨ NumPy æ•°ç»„çš„å„ä¸ªå…ƒç´ å’Œæ ‡é‡ä¹‹é—´è¿›è¡Œè¿ç®—ã€‚ è¿™ä¸ªåŠŸèƒ½ä¹Ÿè¢«ç§°ä¸ºå¹¿æ’­ã€‚ 12345678910111213141516171819202122232425262728293031x = np.array([1.0, 2.0, 3.0])x / 2.0 # array([ 0.5, 1. , 1.5])## NumPy çš„ N ç»´æ•°ç»„A = np.array([[1, 2], [3, 4]])print(A)'''[[1 2] [3 4]]'''A.shape # (2, 2) ç¬¬ä¸€ä¸ªç»´åº¦æœ‰ä¸¤ä¸ªå…ƒç´  ç¬¬äºŒç»´åº¦æœ‰ä¸¤ä¸ªå…ƒç´ A.dtype # dtype('int64') çŸ©é˜µå…ƒç´ çš„æ•°æ®ç±»å‹## çŸ©é˜µçš„ç®—æœ¯è¿ç®—B = np.array([[3, 0],[0, 6]])A + B'''array([[ 4, 2], [ 3, 10]])'''A * B'''array([[ 3, 0], [ 0, 24]])'''# ä¸æ ‡é‡ç›¸ä¹˜çš„å¹¿æ’­åŠŸèƒ½A * 10'''array([[ 10, 20], [ 30, 40]])''' NumPy æ•°ç»„ np.array å¯ä»¥ç”Ÿæˆ N ç»´æ•°ç»„ï¼Œå³å¯ä»¥ç”Ÿæˆä¸€ç»´æ•°ç»„ã€ äºŒç»´æ•°ç»„ã€ä¸‰ç»´æ•°ç»„ç­‰ä»»æ„ç»´æ•°çš„æ•°ç»„ã€‚æ•°å­¦ä¸Šå°†ä¸€ç»´æ•°ç»„ç§°ä¸ºå‘é‡ï¼Œ å°†äºŒç»´æ•°ç»„ç§°ä¸ºçŸ©é˜µã€‚å¦å¤–ï¼Œå¯ä»¥å°†ä¸€èˆ¬åŒ–ä¹‹åçš„å‘é‡æˆ–çŸ©é˜µç­‰ç»Ÿç§°ä¸ºå¼ é‡ï¼ˆtensorï¼‰ã€‚æœ¬ä¹¦åŸºæœ¬ä¸Šå°†äºŒç»´æ•°ç»„ç§°ä¸ºçŸ©é˜µï¼Œå°†ä¸‰ç»´æ•°ç»„åŠä¸‰ç»´ä»¥ä¸Šçš„æ•°ç»„ç§°ä¸ºå¼ é‡æˆ–å¤šç»´æ•°ç»„ã€‚ 1234567891011121314151617181920212223242526## è®¿é—®å…ƒç´ # ç´¢å¼•è®¿é—®X = np.array([[51, 55], [14, 19], [0, 4]])print(X)'''[[51 55] [14 19] [ 0 4]]'''X[0] # ç¬¬ 0 è¡Œ array([51, 55])X[0][1] # (0,1) çš„å…ƒç´  55# for è¯­å¥è®¿é—®for row in X: print(row)'''[51 55][14 19][ 0 4]'''# æ•°ç»„è®¿é—®X = X.flatten() # å°† X è½¬æ¢ä¸ºä¸€ç»´æ•°ç»„print(X) # [51 55 14 19 0 4]X[np.array([0, 2, 4])] # è·å–ç´¢å¼•ä¸º 0ã€2ã€4 çš„å…ƒç´  array([51, 14, 0])# è¿ç”¨æ ‡è®°æ³•ï¼Œä» X ä¸­æŠ½å‡ºå¤§äº 15 çš„å…ƒç´ X &gt; 15 # array([ True, True, False, True, False, False], dtype=bool)X[X&gt;15] # array([51, 55, 19]) å–å‡º True å¯¹åº”çš„å…ƒç´  çŸ©é˜µçš„è¿ç®—ã€‚ï¼ˆæ³¨æ„ï¼ï¼ï¼çŸ©é˜µçš„ç‚¹ä¹˜å¾—éµå¾ªä¸€å®šçš„æ³•åˆ™ (A, B) Â· (B, A) = (A, A)ï¼‰ 12345678910111213A = np.array([[1,2,3], [4,5,6]])np.ndim(A) # 2 æœ‰ä¸¤ä¸ªç»´åº¦A.shape # (2, 3)B = np.array([[1,2], [3,4], [5,6]])B.shape # (3, 2)np.dot(A, B) # ç‚¹ä¹˜ï¼ŒçŸ©é˜µçš„ä¹˜æ³•'''array([[22, 28], [49, 64]])'''B = np.array([[1,2], [3,4], [5,6]]np.ndim(B) # 2B.shape # (3, 2) Matplotlibæ·±åº¦å­¦ä¹ å®éªŒä¸­ï¼Œå›¾å½¢çš„ç»˜åˆ¶å’Œæ•°æ®çš„å¯è§†åŒ–éå¸¸é‡è¦ã€‚Matplotlib æ˜¯ç”¨äºç»˜åˆ¶å›¾å½¢çš„åº“ï¼Œä½¿ç”¨ Matplotlib å¯ä»¥è½»æ¾åœ°ç»˜åˆ¶å›¾å½¢å’Œå®ç°æ•°æ®çš„å¯è§†åŒ–ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬æ¥ä»‹ç»ä¸€ä¸‹å›¾å½¢çš„ç»˜åˆ¶æ–¹æ³•å’Œå›¾åƒçš„æ˜¾ç¤ºæ–¹æ³•ã€‚ 12345678910111213141516import numpy as npimport matplotlib.pyplot as plt## ç»˜åˆ¶ sin ä»¥åŠ cos å‡½æ•°çš„å›¾å½¢# ç”Ÿæˆæ•°æ®x = np.arange(0, 6, 0.1) # ä»¥ 0.1 ä¸ºæ­¥é•¿å•ä½ï¼Œç”Ÿæˆ 0 åˆ° 6 çš„æ•°æ®y1 = np.sin(x)y2 = np.cos(x)# ç»˜åˆ¶å›¾å½¢plt.plot(x, y1, label=\"sin\")plt.plot(x, y2, linestyle = \"--\", label=\"cos\") # ç”¨è™šçº¿ç»˜åˆ¶plt.xlabel(\"x\") # x è½´æ ‡ç­¾plt.ylabel(\"y\") # y è½´æ ‡ç­¾plt.title('sin &amp; cos') # æ ‡é¢˜plt.legend() # è‡ªåŠ¨å¯¹ä¸Šè¯‰æ·»åŠ çš„æ ‡ç­¾å¸ƒå±€ï¼Œå¤æ‚æ—¶å¯ä»¥è‡ªå®šä¹‰plt.show() pyplot ä¸­è¿˜æä¾›äº†ç”¨äºæ˜¾ç¤ºå›¾åƒçš„æ–¹æ³• imshow()ã€‚å¦å¤–ï¼Œå¯ä»¥ä½¿ç”¨ matplotlib.image æ¨¡å—çš„ imread() æ–¹æ³•è¯»å…¥å›¾åƒã€‚ 1234567## æ˜¾ç¤ºå›¾åƒimport matplotlib.pyplot as pltfrom matplotlib.image import imreadimg = imread('lena.png') # è¯»å…¥å›¾åƒï¼ˆè®¾å®šåˆé€‚çš„è·¯å¾„ï¼ï¼‰plt.imshow(img)plt.show() æ„ŸçŸ¥æœºæ„ŸçŸ¥æœºå¯ä»¥è¯´æ˜¯ç¥ç»ç½‘ç»œï¼ˆæ·±åº¦å­¦ä¹ ï¼‰çš„èµ·æºçš„ç®—æ³•ï¼Œå› æ­¤ï¼Œ å­¦ä¹ æ„ŸçŸ¥æœºçš„æ„é€ ä¹Ÿå°±æ˜¯å­¦ä¹ é€šå‘ç¥ç»ç½‘ç»œå’Œæ·±åº¦å­¦ä¹ çš„ä¸€ç§é‡è¦æ€æƒ³ã€‚ æ„ŸçŸ¥æœºæ¥æ”¶å¤šä¸ªè¾“å…¥ä¿¡å·ï¼Œè¾“å‡ºä¸€ä¸ªä¿¡å·ã€‚ ç®€å•é€»è¾‘ç”µè·¯å½¢å¼ä¸€ï¼šx1w1 + x2w2 â‰¤ Î¸ ğŸ‘‰ y = 0 ï¼ˆÎ¸ ä»£è¡¨é˜ˆå€¼ã€x ä»£è¡¨è¾“å…¥ä¿¡å·ã€w ä»£è¡¨æƒé‡ï¼‰ å½¢å¼äºŒï¼šx1w1 + x2w2 + b â‰¤ 0 ï¼ˆå…¶ä¸­ b = -Î¸ï¼‰ ğŸ‘‰ y = 0 ï¼ˆb ä»£è¡¨åç½®ï¼‰ 123456789101112131415161718192021222324252627282930313233343536373839404142## ä¸é—¨# ç®€å•å®ç° def AND(x1, x2): w1, w2, theta = 0.5, 0.5, 0.7 tmp = x1*w1 + x2*w2 if tmp &lt;= theta: return 0 elif tmp &gt; theta: return 1# ä½¿ç”¨æƒé‡å’Œåç½®çš„å®ç°def AND(x1, x2): x = np.array([x1, x2]) w = np.array([0.5, 0.5]) b = -0.7 tmp = np.sum(w*x) + b if tmp &lt;= 0: return 0 else: return 1## éé—¨ï¼šä¸é—¨åè¿‡æ¥å³å¯def NAND(x1, x2): x = np.array([x1, x2]) w = np.array([-0.5, -0.5]) # ä»…æƒé‡å’Œåç½®ä¸ AND ä¸åŒï¼ b = 0.7 tmp = np.sum(w*x) + b if tmp &lt;= 0: return 0 else: return 1## æˆ–é—¨def OR(x1, x2): x = np.array([x1, x2]) w = np.array([0.5, 0.5]) # ä»…æƒé‡å’Œåç½®ä¸ANDä¸åŒï¼ b = -0.2 tmp = np.sum(w*x) + b if tmp &lt;= 0: return 0 else: return 1## å¼‚æˆ–é—¨ï¼ˆæ— æ³•ç”¨ä¸Šé¢ç±»ä¼¼çš„å½¢å¼è¿›è¡Œå®ç°ï¼‰ ä¸ºä»€ä¹ˆå¼‚æˆ–é—¨æ— æ³•ç”¨ä¸Šè¿°ç›¸ä¼¼çš„å½¢å¼ï¼ˆçº¿æ€§ï¼‰è¿›è¡Œå®ç°å‘¢ï¼Ÿå…ˆæ¥çœ‹çœ‹å¼‚æˆ–é—¨çš„ç»“æœåˆ†éƒ¨ã€‚ é€šè¿‡åˆ†æä¸Šå›¾å¯ä»¥å‘ç°ï¼Œæ— æ³•ç”¨çº¿æ€§ç©ºé—´ï¼ˆç›´çº¿ï¼‰å°† 0 å’Œ 1 è¿™ä¸¤ç§æƒ…å†µè¿›è¡ŒåŒºåŸŸçš„åˆ’åˆ†ã€‚ä½†ç”¨éçº¿æ€§çš„ç©ºé—´ï¼ˆæ›²çº¿ï¼‰å¯ä»¥ï¼Œé‚£å¦‚ä½•åˆ’åˆ†éçº¿æ€§ç©ºé—´å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼šå åŠ æ„ŸçŸ¥æœºã€‚å³å¤šå±‚æ„ŸçŸ¥æœºã€‚ å¤šå±‚æ„ŸçŸ¥æœºé€šè¿‡ç»„åˆä¸é—¨ã€ä¸éé—¨ã€æˆ–é—¨å®ç°å¼‚æˆ–é—¨ã€‚ 123456# å¼‚æˆ–é—¨def XOR(x1, x2): s1 = NAND(x1, x2) s2 = OR(x1, x2) y = AND(s1, s2) return y ç¥ç»ç½‘ç»œåœ¨ä¸Šä¸€ç« ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨æ„ŸçŸ¥æœºå®ç°äº†ç®€å•çš„é€»è¾‘ç”µè·¯ã€‚ä»å®ç°çš„é€»è¾‘ä¸­æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå³ä½¿æ˜¯å¤æ‚çš„å‡½æ•°ï¼Œæ„ŸçŸ¥æœºä¹Ÿéšå«ç€èƒ½å¤Ÿä»£è¡¨å®ƒçš„å¯èƒ½æ€§ã€‚ä½†æœ‰ä¸€ä¸ªå¾ˆä»¤äººå¤´ç–¼çš„é—®é¢˜ï¼Œé‚£ä¾¿æ˜¯æƒé‡çš„è®¾å®šã€‚åœ¨å®ç°ç®€å•é€»è¾‘ç”µè·¯ç­‰ç®€å•å‡½æ•°æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è§‚å¯Ÿå½’çº³å¾—å‡ºç¬¦åˆæ¡ä»¶çš„æƒé‡ï¼Œä½†å¦‚æœå‡½æ•°ç‰¹åˆ«çš„å¤æ‚ï¼Œé‚£ä¹ˆå…‰é äººè„‘å»çŒœæµ‹å…¶æƒé‡æ˜¾ç„¶æ˜¯ä¸åˆé€‚çš„ã€‚ ç¥ç»ç½‘ç»œçš„å‡ºç°å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜çš„ã€‚å…·ä½“åœ°è®²ï¼Œç¥ç»ç½‘ç»œçš„ä¸€ ä¸ªé‡è¦æ€§è´¨æ˜¯å®ƒå¯ä»¥è‡ªåŠ¨åœ°ä»æ•°æ®ä¸­å­¦ä¹ åˆ°åˆé€‚çš„æƒé‡å‚æ•°ã€‚ æ¿€æ´»å‡½æ•°æ¿€æ´»å‡½æ•°æ˜¯è¿æ¥æ„ŸçŸ¥æœºå’Œç¥ç»ç½‘ç»œçš„æ¡¥æ¢ã€‚ éšè—ï¼ˆä¸­é—´å±‚ï¼‰çš„æ¿€æ´»å‡½æ•°ã€‚ Sigmoid å‡½æ•°12def sigmoid(x): return 1 / (1 + np.exp(-x)) é˜¶è·ƒå‡½æ•°12345678910# ç®€å•å®ç°def step_function(x): if x &gt; 0: return 1 else: return 0# æ”¯æŒ NumPy æ•°ç»„å®ç°def step_function(x): y = x &gt; 0 return y.astype(np.int) # æŠŠæ•°ç»„ y çš„å…ƒç´ ç±»å‹ä» boole å‹è½¬æ¢ä¸º int å‹ ReLU å‡½æ•°12def relu(x): return np.maximum(0, x) è¾“å‡ºå±‚çš„æ¿€æ´»å‡½æ•°ã€‚ å¦‚ä½•é€‰æ‹©è¾“å‡ºå±‚çš„æ¿€æ´»å‡½æ•°ï¼Ÿ ä¸€èˆ¬åœ°ï¼Œå›å½’é—®é¢˜å¯ä»¥ä½¿ç”¨æ’ç­‰å‡½æ•°ï¼ŒäºŒå…ƒåˆ†ç±»é—®é¢˜å¯ä»¥ä½¿ç”¨ sigmoid å‡½æ•°ï¼Œ å¤šå…ƒåˆ†ç±»é—®é¢˜å¯ä»¥ä½¿ç”¨ softmax å‡½æ•°ã€‚ æœºå™¨å­¦ä¹ çš„é—®é¢˜å¤§è‡´å¯ä»¥åˆ†ä¸ºåˆ†ç±»é—®é¢˜å’Œå›å½’é—®é¢˜ã€‚åˆ†ç±»é—®é¢˜æ˜¯æ•°æ®å±äºå“ªä¸€ä¸ªç±»åˆ«çš„é—®é¢˜ï¼ˆå¯»æ‰¾å†³ç­–è¾¹ç•Œï¼‰ã€‚æ¯”å¦‚ï¼ŒåŒºåˆ†å›¾åƒä¸­çš„äººæ˜¯ç”·æ€§è¿˜æ˜¯å¥³æ€§çš„é—®é¢˜å°±æ˜¯åˆ†ç±»é—®é¢˜ã€‚è€Œå›å½’é—®é¢˜æ˜¯æ ¹æ®æŸä¸ªè¾“å…¥é¢„æµ‹ä¸€ä¸ªï¼ˆè¿ç»­çš„ï¼‰ æ•°å€¼çš„é—®é¢˜ï¼ˆæ‰¾åˆ°æœ€ä¼˜æ‹Ÿåˆï¼‰ã€‚ æ’ç­‰å‡½æ•°12def identity_function(x): return x softmax å‡½æ•°exp(x) æ˜¯è¡¨ç¤º ex çš„æŒ‡æ•°å‡½æ•°ï¼ˆe æ˜¯çº³çš®å°”å¸¸æ•°2.7182 â€¦ï¼‰ï¼Œå®¹æ˜“å‡ºç°å¾ˆå¤§çš„å€¼ä»è€Œå¯¼è‡´æ•°å€¼çš„æº¢å‡ºé—®é¢˜ã€‚åœ¨è¿›è¡Œ softmax çš„æŒ‡æ•°å‡½æ•°çš„è¿ç®—æ—¶ï¼ŒåŠ ä¸Šï¼ˆæˆ–è€…å‡å»ï¼‰æŸä¸ªå¸¸æ•°å¹¶ä¸ä¼šæ”¹å˜è¿ç®—çš„ç»“æœï¼Œä¸ºäº†é˜²æ­¢æº¢å‡ºï¼Œä¸€èˆ¬ä¼šä½¿ç”¨è¾“å…¥ä¿¡å·ä¸­çš„æœ€å¤§å€¼ã€‚ å¦‚ä¸Šæ‰€ç¤ºï¼Œsoftmax å‡½æ•°çš„è¾“å‡ºæ˜¯ 0.0 åˆ° 1.0 ä¹‹é—´çš„å®æ•°ã€‚å¹¶ä¸”ï¼Œsoftmax å‡½æ•°çš„è¾“å‡ºå€¼çš„æ€»å’Œæ˜¯ 1ã€‚è¾“å‡ºæ€»å’Œä¸º 1 æ˜¯ softmax å‡½æ•°çš„ä¸€ä¸ªé‡è¦æ€§è´¨ã€‚æ­£å› ä¸ºæœ‰äº†è¿™ä¸ªæ€§è´¨ï¼Œæˆ‘ä»¬æ‰å¯ä»¥æŠŠ softmax å‡½æ•°çš„è¾“å‡ºè§£é‡Šä¸ºæ¦‚ç‡ã€‚ 123456789101112def softmax(a): exp_a = np.exp(a) sum_exp_a = np.sum(exp_a) y = exp_a / sum_exp_a return y# ä¼˜åŒ–def softmax(a): c = np.max(a) exp_a = np.exp(a - c) # æº¢å‡ºå¯¹ç­– sum_exp_a = np.sum(exp_a) y = exp_a / sum_exp_a return y ç®€å•å®ç°äº†è§£äº†æ¿€æ´»å‡½æ•°ï¼Œè®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªç®€å•çš„ç¥ç»ç½‘ç»œã€‚è¿™ä¸ªç¥ç»ç½‘ç»œçœç•¥äº†åç½®å’Œæ¿€æ´»å‡½æ•°ï¼Œåªæœ‰æƒé‡ã€‚ æˆ‘ä»¬éœ€è¦äº†è§£çš„é‡ç‚¹æ˜¯ï¼šç¥ç»ç½‘ç»œçš„è¿ç®—å¯ä»¥ä½œä¸ºçŸ©é˜µè¿ç®—æ‰“åŒ…è¿›è¡Œã€‚ éšè—ï¼ˆä¸­é—´ï¼‰å±‚çš„æ¿€æ´»å‡½æ•°è¡¨ç¤ºä¸ºï¼šh() è¾“å‡ºå±‚çš„æ¿€æ´»å‡½æ•°è¡¨ç¤ºä¸ºï¼šÏƒ() 1234567891011X = np.array([1, 2])X.shape # (2,)W = np.array([[1, 3, 5], [2, 4, 6]])print(W)'''[[1 3 5] [2 4 6]]'''W.shape # (2, 3)Y = np.dot(X, W)print(Y) # [ 5 11 17] å¦‚ä¸Šæ‰€ç¤ºï¼Œä½¿ç”¨ np.dot ï¼ˆå¤šç»´æ•°ç»„çš„ç‚¹ç§¯ï¼‰ï¼Œå¯ä»¥ä¸€æ¬¡æ€§è®¡ç®—å‡º Y çš„ç»“æœã€‚ è¿™æ„å‘³ç€ï¼Œå³ä¾¿ Y çš„å…ƒç´ ä¸ªæ•°ä¸º 100 æˆ– 1000ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä¸€æ¬¡è¿ç®—å°±è®¡ç®—å‡ºç»“æœï¼å¦‚æœä¸ä½¿ç”¨ np.dotï¼Œå°±å¿…é¡»å•ç‹¬è®¡ç®— Y çš„æ¯ä¸€ä¸ªå…ƒç´ ï¼ˆæˆ–è€…è¯´å¿…é¡»ä½¿ç”¨ for è¯­å¥ï¼‰ï¼Œéå¸¸éº»çƒ¦ã€‚å› æ­¤ï¼Œé€šè¿‡çŸ©é˜µçš„ä¹˜ç§¯ä¸€æ¬¡æ€§å®Œæˆè®¡ç®—çš„æŠ€å·§ï¼Œåœ¨å®ç°çš„å±‚é¢ä¸Šå¯ä»¥è¯´æ˜¯éå¸¸é‡è¦çš„ã€‚ ç°åœ¨æˆ‘ä»¬å°†åç½®è¿˜æœ‰æ¿€æ´»å‡½æ•°è€ƒè™‘è¿›æ¥ã€‚ 12345678910111213141516171819202122232425262728## ç¬¬ä¸€å±‚å¤„ç†# è®¾ç½®ä¿¡å·ã€æƒé‡ã€åç½®ä¸ºæŸä¸€ä»»æ„å€¼X = np.array([1.0, 0.5])W1 = np.array([[0.1, 0.3, 0.5], [0.2, 0.4, 0.6]])B1 = np.array([0.1, 0.2, 0.3])print(W1.shape) # (2, 3)print(X.shape) # (2,)print(B1.shape) # (3,)A1 = np.dot(X, W1) + B1 # ä¸€æ¬¡å¾—å‡ºç¬¬ä¸€å±‚çš„æ‰€æœ‰çš„ aZ1 = sigmoid(A1)print(A1) # [0.3, 0.7, 1.1] # ç¬¬ä¸€å±‚çš„ç»“æœprint(Z1) # [0.57444252, 0.66818777, 0.75026011] # sigmoid å‡½æ•°è¿›è¡Œå¤„ç†## ç¬¬äºŒå±‚å¤„ç†ï¼Œä¸ç¬¬ä¸€å±‚ç±»ä¼¼W2 = np.array([[0.1, 0.4], [0.2, 0.5], [0.3, 0.6]])B2 = np.array([0.1, 0.2])print(Z1.shape) # (3,)print(W2.shape) # (3, 2)print(B2.shape) # (2,)A2 = np.dot(Z1, W2) + B2Z2 = sigmoid(A2)## ç¬¬äºŒå±‚åˆ°è¾“å‡ºå±‚çš„å¤„ç†# è¾“å‡ºå±‚çš„æ¿€æ´»å‡½æ•°ä¸ä¹‹å‰éšè—å±‚çš„æœ‰æ‰€ä¸åŒdef identity_function(x): return x # æ’ç­‰å‡½æ•°W3 = np.array([[0.1, 0.3], [0.2, 0.4]])B3 = np.array([0.1, 0.2])A3 = np.dot(Z2, W3) + B3Y = identity_function(A3) # æˆ–è€… Y = A3ï¼Œæ­¤å¤„æŒ‰ç…§è§„èŒƒä½¿ç”¨ä¸€ä¸ªè¿”å›è‡ªèº«çš„æ¿€æ´»å‡½æ•° æœ€åæˆ‘ä»¬å°†æœ¬ç« çš„ä»£ç æµç¨‹è¿›è¡Œæ•´ç†ï¼Œæ–¹ä¾¿é˜…è¯»ã€‚ 12345678910111213141516171819202122232425## æƒé‡åŠåç½®çš„åˆå§‹åŒ–def init_network(): network = &#123;&#125; # ä¿å­˜æ‰€æœ‰åˆå§‹åŒ–å‚æ•°çš„å­—å…¸ network['W1'] = np.array([[0.1, 0.3, 0.5], [0.2, 0.4, 0.6]]) network['b1'] = np.array([0.1, 0.2, 0.3]) network['W2'] = np.array([[0.1, 0.4], [0.2, 0.5], [0.3, 0.6]]) network['b2'] = np.array([0.1, 0.2]) network['W3'] = np.array([[0.1, 0.3], [0.2, 0.4]]) network['b3'] = np.array([0.1, 0.2]) return network## å°ä½äº†å°†è¾“å…¥ä¿¡å·è½¬æ¢ä¸ºè¾“å‡ºä¿¡å·çš„å¤„ç†è¿‡ç¨‹def forward(network, x): W1, W2, W3 = network['W1'], network['W2'], network['W3'] b1, b2, b3 = network['b1'], network['b2'], network['b3'] a1 = np.dot(x, W1) + b1 z1 = sigmoid(a1) a2 = np.dot(z1, W2) + b2 z2 = sigmoid(a2) a3 = np.dot(z2, W3) + b3 y = identity_function(a3) return ynetwork = init_network()x = np.array([1.0, 0.5])y = forward(network, x)print(y) # [ 0.31682708 0.69627909] æ‰‹å†™æ•°å­—è¯†åˆ«ä»‹ç»å®Œç¥ç»ç½‘ç»œçš„ç»“æ„ä¹‹åï¼Œç°åœ¨æˆ‘ä»¬æ¥è¯•ç€è§£å†³å®é™…é—®é¢˜ã€‚ å‡è®¾å­¦ä¹ å·²ç»å…¨éƒ¨ç»“æŸï¼Œæˆ‘ä»¬ä½¿ç”¨å­¦ä¹ åˆ°çš„å‚æ•°ï¼Œå…ˆå®ç°ç¥ç»ç½‘ç»œçš„æ¨ç†å¤„ç†ã€‚è¿™ä¸ªæ¨ç†å¤„ç†ä¹Ÿç§°ä¸ºç¥ç»ç½‘ç»œçš„å‰å‘ä¼ æ’­ï¼ˆforward propagationï¼‰ã€‚ æ±‚è§£æœºå™¨å­¦ä¹ é—®é¢˜çš„æ­¥éª¤å¯ä»¥åˆ†ä¸ºå­¦ä¹ å’Œæ¨ç†ä¸¤ä¸ªé˜¶æ®µã€‚ é¦–å…ˆï¼Œåœ¨å­¦ä¹ é˜¶æ®µè¿›è¡Œæ¨¡å‹çš„å­¦ä¹ ï¼Œ ç„¶åï¼Œåœ¨æ¨ç†é˜¶æ®µï¼Œç”¨å­¦åˆ°çš„æ¨¡å‹å¯¹æœªçŸ¥çš„æ•°æ®è¿›è¡Œæ¨ç†ï¼ˆåˆ†ç±»ï¼‰ã€‚ ä¸€èˆ¬è€Œè¨€ï¼Œç¥ç»ç½‘ç»œåªæŠŠè¾“å‡ºå€¼æœ€å¤§çš„ç¥ç»å…ƒæ‰€å¯¹åº”çš„ç±»åˆ«ä½œä¸ºè¯†åˆ«ç»“æœã€‚ å¹¶ä¸”ï¼Œå³ä¾¿ä½¿ç”¨ softmax å‡½æ•°ï¼Œè¾“å‡ºå€¼æœ€å¤§çš„ç¥ç»å…ƒçš„ä½ç½®ä¹Ÿä¸ä¼šå˜ã€‚å› æ­¤ï¼Œ ç¥ç»ç½‘ç»œåœ¨è¿›è¡Œåˆ†ç±»æ—¶ï¼Œè¾“å‡ºå±‚çš„ softmax å‡½æ•°å¯ä»¥çœç•¥ã€‚ åœ¨è¾“å‡ºå±‚ä½¿ç”¨ softmax å‡½æ•°æ˜¯å› ä¸ºå®ƒå’Œç¥ç»ç½‘ç»œçš„å­¦ä¹ æœ‰å…³ç³»ã€‚ 1234567891011121314151617181920212223242526272829303132## è®©æˆ‘ä»¬å…ˆå°è¯•ç€å°†æ•°æ®é›† MINST è¿›è¡Œå¯¼å…¥import sys, ossys.path.append(os.pardir) # ä¸ºäº†å¯¼å…¥çˆ¶ç›®å½•ä¸­çš„æ–‡ä»¶è€Œè¿›è¡Œçš„è®¾å®šfrom dataset.mnist import load_mnist# è¯»å…¥ MNIST æ•°æ®é›†ï¼ˆç¬¬ä¸€æ¬¡è°ƒç”¨ä¼šèŠ±è´¹å‡ åˆ†é’Ÿï¼‰# flatten å°†å½¢çŠ¶å‹æˆä¸€ç»´# normalize å°†è¾“å…¥å›¾åƒæ­£è§„åŒ–ä¸º 0.0ï½1.0 çš„å€¼# (è®­ç»ƒå›¾åƒ ,è®­ç»ƒæ ‡ç­¾)ï¼Œ(æµ‹è¯•å›¾åƒï¼Œæµ‹è¯•æ ‡ç­¾)(x_train, t_train), (x_test, t_test) = load_mnist(flatten=True, normalize=False)# è¾“å‡ºå„ä¸ªæ•°æ®çš„å½¢çŠ¶print(x_train.shape) # (60000, 784)print(t_train.shape) # (60000,)print(x_test.shape) # (10000, 784)print(t_test.shape) # (10000,)## æ¥ä¸‹æ¥è¯•ç€ä½¿ç”¨ PILï¼ˆPython Image Libraryï¼‰ æ¨¡å—æ¥æ˜¾ç¤ºå›¾ç‰‡import sys, ossys.path.append(os.pardir)import numpy as npfrom dataset.mnist import load_mnistfrom PIL import Imagedef img_show(img): # å®šä¹‰æ˜¾ç¤ºå›¾ç‰‡çš„å‡½æ•° pil_img = Image.fromarray(np.uint8(img)) pil_img.show()(x_train, t_train), (x_test, t_test) = load_mnist(flatten=True, normalize=False)img = x_train[0]label = t_train[0]print(label) # 5print(img.shape) # (784,)img = img.reshape(28, 28) # æŠŠå›¾åƒçš„å½¢çŠ¶å˜æˆåŸæ¥çš„å°ºå¯¸print(img.shape) # (28, 28)img_show(img) å¥½äº†ï¼Œåˆ°è¿™ä¸€æ­¥æˆ‘ä»¬å·²ç»å¯¹è¿™ä¸ªæ•°æ®é›†æœ‰ä¸€å®šçš„äº†è§£ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥æ€è€ƒä¸€ä¸‹å¯¹è¿™ä¸ª MINST æ•°æ®é›†å®ç°ç¥ç»ç½‘ç»œçš„æ¨ç†å¤„ç†ã€‚ ç¥ç»ç½‘ç»œçš„è¾“å…¥å±‚æœ‰ 784 ä¸ªç¥ç»å…ƒï¼Œè¾“å‡ºå±‚æœ‰ 10 ä¸ªç¥ç»å…ƒã€‚è¾“å…¥å±‚çš„ 784 è¿™ä¸ªæ•°å­—æ¥æºäºå›¾åƒå¤§å°çš„ 28 Ã— 28 = 784ï¼Œè¾“å‡ºå±‚çš„10 è¿™ä¸ªæ•°å­—æ¥æºäº 10 ç±»åˆ«åˆ†ç±»ï¼ˆæ•°å­— 0 åˆ° 9ï¼Œå…± 10 ä¸ªç±»åˆ«ï¼‰ã€‚æ­¤å¤–ï¼Œè¿™ä¸ªç¥ç»ç½‘ç»œæœ‰ 2 ä¸ªéšè—å±‚ï¼Œç¬¬ 1 ä¸ªéšè—å±‚æœ‰ 50 ä¸ªç¥ç»å…ƒï¼Œç¬¬ 2 ä¸ªéšè—å±‚æœ‰ 100 ä¸ªç¥ç»å…ƒã€‚è¿™ä¸ª 50 å’Œ 100 å¯ä»¥è®¾ç½®ä¸ºä»»ä½•å€¼ã€‚ 1234567891011121314151617181920212223242526272829303132333435## è·å–æµ‹è¯•æ•°æ®ï¼ˆæµ‹è¯•é›†ä¸æ ‡ç­¾é›†ï¼‰def get_data(): (x_train, t_train), (x_test, t_test) = \\ load_mnist(normalize=True, flatten=True, one_hot_label=False) return x_test, t_test## è·å–æƒé‡ï¼ˆæ•°æ®é›†è‡ªå¸¦çš„ï¼‰def init_network(): # Binary Mode è¿”å› Bytes with open(\"sample_weight.pkl\", 'rb') as f: network = pickle.load(f) return network## é¢„æµ‹è¿‡ç¨‹ï¼ˆæ¨¡å‹ï¼‰def predict(network, x): W1, W2, W3 = network['W1'], network['W2'], network['W3'] b1, b2, b3 = network['b1'], network['b2'], network['b3'] a1 = np.dot(x, W1) + b1 z1 = sigmoid(a1) a2 = np.dot(z1, W2) + b2 z2 = sigmoid(a2) a3 = np.dot(z2, W3) + b3 y = softmax(a3) return y## è¯„ä»·è¯†åˆ«ç²¾åº¦x, t = get_data()network = init_network()accuracy_cnt = 0for i in range(len(x)): y = predict(network, x[i]) p = np.argmax(y) # è·å–æ¦‚ç‡æœ€é«˜çš„å…ƒç´ çš„ç´¢å¼• if p == t[i]: accuracy_cnt += 1 # è®°å½•æ­£ç¡®çš„æ¬¡æ•°print(\"Accuracy:\" + str(float(accuracy_cnt) / len(x))) æŠŠæ•°æ®é™å®šåˆ°æŸä¸ªèŒƒå›´å†…çš„å¤„ç†ç§°ä¸ºæ­£è§„åŒ–ï¼ˆnormalizationï¼‰ã€‚æ­¤å¤–ï¼Œå¯¹ç¥ç»ç½‘ç»œçš„è¾“å…¥æ•°æ®è¿›è¡ŒæŸç§æ—¢å®šçš„è½¬æ¢ç§°ä¸ºé¢„å¤„ç†ï¼ˆpreprocessingï¼‰ã€‚ å¾ˆå¤šé¢„å¤„ç†éƒ½ä¼šè€ƒè™‘åˆ°æ•°æ®çš„æ•´ä½“åˆ†å¸ƒã€‚æ¯”å¦‚ï¼Œåˆ©ç”¨æ•°æ®æ•´ä½“çš„å‡å€¼æˆ–æ ‡å‡†å·®ï¼Œç§»åŠ¨æ•°æ®ï¼Œä½¿æ•°æ®æ•´ä½“ä»¥ 0 ä¸ºä¸­å¿ƒåˆ†å¸ƒï¼Œæˆ–è€…è¿›è¡Œæ­£è§„åŒ–ï¼ŒæŠŠæ•°æ®çš„å»¶å±•æ§åˆ¶åœ¨ä¸€å®šèŒƒå›´å†…ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰å°†æ•°æ®æ•´ä½“çš„åˆ†å¸ƒå½¢çŠ¶å‡åŒ€åŒ–çš„æ–¹æ³•ï¼Œå³æ•°æ®ç™½åŒ–ï¼ˆwhiteningï¼‰ç­‰ã€‚ æ‰¹å¤„ç†åœ¨ä¸Šé¢çš„é¢„æµ‹ä¸­ï¼Œæˆ‘ä»¬ä¸€æ¬¡åªé¢„æµ‹ä¸€ä¸ªè¾“å…¥ã€‚å…¶å®è¿˜æœ‰ä¸€ç§æ›´ç®€å•å¿«æ·çš„æ–¹å¼ï¼šæ‰¹å¤„ç†ã€‚ æ‰¹å¤„ç†å¯¹è®¡ç®—æœºçš„è¿ç®—å¤§æœ‰åˆ©å¤„ï¼Œå¯ä»¥å¤§å¹…ç¼©çŸ­æ¯å¼ å›¾åƒçš„å¤„ç†æ—¶é—´ã€‚è¿™æ˜¯å› ä¸ºå¤§å¤šæ•°å¤„ç†æ•°å€¼è®¡ç®—çš„åº“éƒ½è¿›è¡Œäº†èƒ½å¤Ÿé«˜æ•ˆå¤„ç†å¤§å‹æ•°ç»„è¿ç®—çš„æœ€ä¼˜åŒ–ã€‚å¹¶ä¸”ï¼Œåœ¨ç¥ç»ç½‘ç»œçš„è¿ç®—ä¸­ï¼Œå½“æ•°æ®ä¼ é€æˆä¸ºç“¶é¢ˆæ—¶ï¼Œæ‰¹å¤„ç†å¯ä»¥å‡è½»æ•°æ®æ€»çº¿çš„è´Ÿè·ï¼ˆä¸¥æ ¼åœ°è®²ï¼Œç›¸å¯¹äºæ•°æ®è¯»å…¥ï¼Œå¯ä»¥å°†æ›´å¤šçš„æ—¶é—´ç”¨åœ¨è®¡ç®—ä¸Šï¼‰ã€‚ 12345678910x, t = get_data()network = init_network()batch_size = 100 # æ‰¹æ•°é‡accuracy_cnt = 0for i in range(0, len(x), batch_size): [0, 100, 200 ...] x_batch = x[i:i+batch_size] # åˆ‡ç‰‡ [0, 100) [100, 200) y_batch = predict(network, x_batch) p = np.argmax(y_batch, axis=1) # å–å¾—æ‰€æœ‰ç¬¬ä¸€ä¸ªç»´åº¦ä¸Šçš„æœ€å¤§å€¼ accuracy_cnt += np.sum(p == t[i:i+batch_size]) # æ‰¹é‡åˆ¤æ–­æ˜¯å¦å‡†ç¡®å¹¶ç´¯åŠ print(\"Accuracy:\" + str(float(accuracy_cnt) / len(x))) ç¥ç»ç½‘ç»œçš„å­¦ä¹ ä¸Šä¸€ç« æˆ‘ä»¬äº†è§£ç¥ç»ç½‘ç»œçš„æ¨æµ‹è¿‡ç¨‹ï¼Œåœ¨æ¨æµ‹çš„è¿‡ç¨‹ä¸­æˆ‘ä»¬ä½¿ç”¨åˆ°äº†æƒé‡ä¸åç½®å‚æ•°ï¼Œè¿™äº›å‚æ•°åœ¨ä¸Šä¸€ç« ä¸­å¹¶æ²¡æœ‰æåŠæ˜¯å¦‚ä½•å¾—å‡ºçš„ã€‚ è€Œç¥ç»ç½‘ç»œçš„å­¦ä¹ ï¼Œå…¶å­¦ä¹ è¿‡ç¨‹ä¾¿æ˜¯æŒ‡ä»è®­ç»ƒæ•°æ®ä¸­è‡ªåŠ¨è·å–æœ€ä¼˜æƒé‡å‚æ•°çš„è¿‡ç¨‹ã€‚ æœ¬ç« ä¸­ï¼Œä¸ºäº†ä½¿ç¥ç»ç½‘ç»œèƒ½è¿›è¡Œå­¦ä¹ ï¼Œå°†å¯¼å…¥æŸå¤±å‡½æ•°è¿™ä¸€æŒ‡æ ‡ã€‚è€Œå­¦ä¹ çš„ç›®çš„å°±æ˜¯ä»¥è¯¥æŸå¤±å‡½æ•°ä¸ºåŸºå‡†ï¼Œæ‰¾å‡ºèƒ½ä½¿å®ƒçš„å€¼è¾¾åˆ°æœ€å°çš„æƒé‡å‚æ•°ã€‚ä¸ºäº†æ‰¾å‡ºå°½å¯èƒ½å°çš„æŸå¤±å‡½æ•°çš„å€¼ï¼Œæœ¬ç« æˆ‘ä»¬å°†ä»‹ç»åˆ©ç”¨äº†å‡½æ•°æ–œç‡çš„æ¢¯åº¦æ³•ã€‚ ä»æ•°æ®ä¸­å­¦ä¹ åœ¨å®é™…çš„ç¥ç»ç½‘ç»œä¸­ï¼Œå‚æ•°çš„æ•°é‡å¯èƒ½æ˜¯æˆåƒä¸Šä¸‡ä¸ªï¼Œåœ¨å±‚æ•°æ›´æ·±çš„æ·±åº¦å­¦ä¹ ä¸­ï¼Œå‚æ•°çš„æ•°é‡ç”šè‡³å¯èƒ½ä¸Šäº¿ï¼Œæƒ³è¦äººå·¥å†³å®šè¿™äº›å‚æ•°çš„å€¼æ˜¯ä¸å¯èƒ½çš„ã€‚ æ‰€ä»¥ï¼Œæˆ‘ä»¬è¦å®Œæˆä¸€ä»¶éå¸¸äº†ä¸èµ·çš„äº‹æƒ…ï¼šæ•°æ®è‡ªåŠ¨å†³å®šæƒé‡å‚æ•°çš„å€¼ã€‚ ä¸€èˆ¬æ¥è®²ï¼Œéœ€è¦åœ¨æ•°æ®ä¸­æå–ç‰¹å¾é‡ï¼Œè¿™é‡Œæ‰€è¯´çš„ç‰¹å¾é‡æ˜¯æŒ‡å¯ä»¥ä»è¾“å…¥æ•°æ®ï¼ˆè¾“å…¥å›¾åƒï¼‰ä¸­å‡†ç¡®åœ°æå–æœ¬è´¨æ•°æ®ï¼ˆé‡è¦çš„æ•°æ®ï¼‰çš„è½¬æ¢å™¨ã€‚ç‰¹å¾çš„é‡çš„æå–å¯ä»¥åˆ†ä¸ºäººå·¥æå–ï¼ˆæœºå™¨å­¦ä¹ ï¼‰ä¸æœºå™¨æå–ï¼ˆæ·±åº¦å­¦ä¹ ï¼‰ä¸¤å¤§ç±»ã€‚ æœºå™¨å­¦ä¹ ä¸­ï¼Œä¸€èˆ¬å°†æ•°æ®åˆ†ä¸ºè®­ç»ƒæ•°æ®å’Œæµ‹è¯•æ•°æ®ä¸¤éƒ¨åˆ†æ¥è¿›è¡Œå­¦ä¹ å’Œå®éªŒç­‰ã€‚é¦–å…ˆï¼Œä½¿ç”¨è®­ç»ƒæ•°æ®è¿›è¡Œå­¦ä¹ ï¼Œå¯»æ‰¾æœ€ä¼˜çš„å‚æ•°ï¼›ç„¶åï¼Œä½¿ç”¨æµ‹è¯•æ•°æ®è¯„ä»·è®­ç»ƒå¾—åˆ°çš„æ¨¡å‹çš„å®é™…èƒ½åŠ›ã€‚ ä¸ºä»€ä¹ˆéœ€è¦å°†æ•°æ®åˆ†ä¸ºè®­ç»ƒæ•°æ®å’Œæµ‹è¯•æ•°æ®å‘¢ï¼Ÿå› ä¸ºæˆ‘ä»¬è¿½æ±‚çš„æ˜¯æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚ä¸ºäº†æ­£ç¡®è¯„ä»·æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ï¼Œå°±å¿…é¡»åˆ’åˆ†è®­ç»ƒæ•°æ®å’Œæµ‹è¯•æ•°æ®ã€‚å¦å¤–ï¼Œè®­ç»ƒæ•°æ®ä¹Ÿå¯ä»¥ç§°ä¸ºç›‘ç£æ•°æ®ã€‚ æ³›åŒ–èƒ½åŠ›æ˜¯æŒ‡å¤„ç†æœªè¢«è§‚å¯Ÿè¿‡çš„æ•°æ®ï¼ˆä¸åŒ…å«åœ¨è®­ç»ƒæ•°æ®ä¸­çš„æ•°æ®ï¼‰çš„èƒ½åŠ›ã€‚è·å¾—æ³›åŒ–èƒ½åŠ›æ˜¯æœºå™¨å­¦ä¹ çš„æœ€ç»ˆç›®æ ‡ã€‚é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œåªå¯¹æŸä¸ªæ•°æ®é›†è¿‡åº¦æ‹Ÿåˆçš„çŠ¶æ€ç§°ä¸ºè¿‡æ‹Ÿåˆï¼ˆOver Fittingï¼‰ã€‚é¿å…è¿‡æ‹Ÿåˆä¹Ÿæ˜¯æœºå™¨å­¦ä¹ çš„ä¸€ä¸ªé‡è¦è¯¾é¢˜ã€‚ æŸå¤±å‡½æ•°æŸå¤±å‡½æ•°æ˜¯è¡¨ç¤ºç¥ç»ç½‘ç»œæ€§èƒ½çš„æ¶åŠ£ç¨‹åº¦çš„æŒ‡æ ‡ï¼Œå³å½“å‰çš„ç¥ç»ç½‘ç»œå¯¹ç›‘ç£æ•°æ®åœ¨å¤šå¤§ç¨‹åº¦ä¸Šä¸æ‹Ÿåˆï¼Œåœ¨å¤šå¤§ç¨‹åº¦ä¸Šä¸ä¸€è‡´ã€‚ å‡æ–¹è¯¯å·®12345678910def mean_squared_error(y, t): return 0.5 * np.sum((y-t)**2) # y ä»£è¡¨ç¥ç»ç½‘ç»œè¾“å‡º t ä»£è¡¨ç›‘ç£æ•°æ®# è®¾ 2 ä¸ºæ­£ç¡®è§£t = [0, 0, 1, 0, 0, 0, 0, 0, 0, 0]# 2 çš„æ¦‚ç‡æœ€é«˜çš„æƒ…å†µï¼ˆ0.6ï¼‰y = [0.1, 0.05, 0.6, 0.0, 0.05, 0.1, 0.0, 0.1, 0.0, 0.0]mean_squared_error(np.array(y), np.array(t)) # 0.097500000000000031# 7 çš„æ¦‚ç‡æœ€é«˜çš„æƒ…å†µï¼ˆ0.6ï¼‰y = [0.1, 0.05, 0.1, 0.0, 0.05, 0.1, 0.0, 0.6, 0.0, 0.0]mean_squared_error(np.array(y), np.array(t)) # 0.59750000000000003 äº¤å‰ç†µè¯¯å·®1234567891011121314151617181920212223242526272829def cross_entropy_error(y, t): delta = 1e-7 # å¾®å°å€¼ä¿æŠ¤ np.log(0) ä¼šå˜ä¸ºè´Ÿæ— é™å¤§çš„ -inf return -np.sum(t * np.log(y + delta))t = [0, 0, 1, 0, 0, 0, 0, 0, 0, 0]y = [0.1, 0.05, 0.6, 0.0, 0.05, 0.1, 0.0, 0.1, 0.0, 0.0]cross_entropy_error(np.array(y), np.array(t))0.51082545709933802y = [0.1, 0.05, 0.1, 0.0, 0.05, 0.1, 0.0, 0.6, 0.0, 0.0]cross_entropy_error(np.array(y), np.array(t))2.3025840929945458## mini-batch ç‰ˆæœ¬å®ç°def cross_entropy_error(y, t): if y.ndim == 1: t = t.reshape(1, t.size) y = y.reshape(1, y.size) batch_size = y.shape[0] # ç”¨ batch çš„ä¸ªæ•°è¿›è¡Œæ­£è§„åŒ–ï¼Œè®¡ç®—å•ä¸ªæ•°æ®çš„å¹³å‡äº¤å‰ç†µè¯¯å·® return -np.sum(t * np.log(y + 1e-7)) / batch_size# ç›‘ç£æ•°æ®æ˜¯æ ‡ç­¾å½¢å¼ï¼Œå³é one-hotdef cross_entropy_error(y, t): if y.ndim == 1: t = t.reshape(1, t.size) y = y.reshape(1, y.size) batch_size = y.shape[0] # np.arange(batch_size) ç”Ÿæˆä» 0 åˆ° batch_size-1 çš„æ•°ç»„ # y[np.arange(batch_size), t] ç”Ÿæˆ [y[0,2], y[1,7], y[2,0], y[3,9], y[4,4]] return -np.sum(np.log(y[np.arange(batch_size), t] + 1e-7)) / batch_size åœ¨è¿›è¡Œç¥ç»ç½‘ç»œçš„å­¦ä¹ æ—¶ï¼Œä¸èƒ½å°†è¯†åˆ«ç²¾åº¦ä½œä¸ºæŒ‡æ ‡ã€‚å› ä¸ºå¦‚æœä»¥è¯†åˆ«ç²¾åº¦ä¸ºæŒ‡æ ‡ï¼Œåˆ™å‚æ•°çš„å¯¼æ•°åœ¨ç»å¤§å¤šæ•°åœ°æ–¹éƒ½ä¼šå˜ä¸º 0ã€‚ æ•°å€¼å¾®åˆ†æ¢¯åº¦æ³•çš„æ ¸å¿ƒå°±æ˜¯æ•°å€¼å¾®åˆ†ï¼Œåœ¨äº†è§£æ¢¯åº¦æ³•ä¹‹å‰æˆ‘ä»¬å…ˆæ¥è®¨è®ºä¸€ä¸‹æ•°å€¼å¾®åˆ†ä¸­çš„å¯¼æ•°å’Œåå¯¼æ•°ã€‚ å¯¼æ•°åªå­˜åœ¨ä¸€ä¸ªå˜é‡çš„æƒ…å†µã€‚ 123def numerical_diff(f, x): h = 1e-4 # 0.0001 return (f(x+h) - f(x-h)) / (2*h) # ä¸­å¿ƒå·®åˆ† åå¯¼æ•°å’Œæ¢¯åº¦å­˜åœ¨å¤šä¸ªå˜é‡ã€‚ ç”±å…¨éƒ¨å˜é‡çš„åå¯¼æ•°æ±‡æ€»è€Œæˆçš„å‘é‡ç§°ä¸ºæ¢¯åº¦ï¼ˆgradientï¼‰ã€‚ 1234567891011121314def numerical_gradient(f, x): h = 1e-4 # 0.0001 grad = np.zeros_like(x) # ç”Ÿæˆå’Œ x å½¢çŠ¶ç›¸åŒçš„æ•°ç»„ for idx in range(x.size): # æ¯æ¬¡åªå¯¹ä¸€ä¸ªå˜é‡è¿›è¡Œä¸­å¿ƒå·®åˆ†æ±‚å¯¼ tmp_val = x[idx] # f(x+h)çš„è®¡ç®— x[idx] = tmp_val + h fxh1 = f(x) # f(x-h)çš„è®¡ç®— x[idx] = tmp_val - h fxh2 = f(x) grad[idx] = (fxh1 - fxh2) / (2*h) x[idx] = tmp_val # è¿˜åŸå€¼ return grad å®é™…ä¸Šï¼Œ æ¢¯åº¦ä¼šæŒ‡å‘å„ç‚¹å¤„çš„å‡½æ•°å€¼é™ä½çš„æ–¹å‘ã€‚æ›´ä¸¥æ ¼åœ°è®²ï¼Œæ¢¯åº¦æŒ‡ç¤ºçš„æ–¹å‘æ˜¯å„ç‚¹å¤„çš„å‡½æ•°å€¼å‡å°æœ€å¤šçš„æ–¹å‘ã€‚é€šè¿‡å·§å¦™åœ°ä½¿ç”¨æ¢¯åº¦æ¥å¯»æ‰¾å‡½æ•°æœ€å°å€¼ ï¼ˆæˆ–è€…å°½å¯èƒ½å°çš„å€¼ï¼‰çš„æ–¹æ³•å°±æ˜¯æ¢¯åº¦æ³•ã€‚ åœ¨æ¢¯åº¦æ³•ä¸­ï¼Œå‡½æ•°çš„å–å€¼ä»å½“å‰ä½ç½®æ²¿ç€æ¢¯åº¦æ–¹å‘å‰è¿›ä¸€å®šè·ç¦»ï¼Œç„¶ååœ¨æ–°çš„åœ°æ–¹é‡æ–°æ±‚æ¢¯åº¦ï¼Œå†æ²¿ç€æ–°æ¢¯åº¦æ–¹å‘å‰è¿›ï¼Œ å¦‚æ­¤åå¤ï¼Œä¸æ–­åœ°æ²¿æ¢¯åº¦æ–¹å‘å‰è¿›ã€‚åƒè¿™æ ·ï¼Œé€šè¿‡ä¸æ–­åœ°æ²¿æ¢¯åº¦æ–¹å‘å‰è¿›ï¼Œ é€æ¸å‡å°å‡½æ•°å€¼çš„è¿‡ç¨‹å°±æ˜¯æ¢¯åº¦æ³•ï¼ˆgradient methodï¼‰ã€‚æ¢¯åº¦æ³•æ˜¯è§£å†³æœºå™¨å­¦ä¹ ä¸­æœ€ä¼˜åŒ–é—®é¢˜çš„å¸¸ç”¨æ–¹æ³•ï¼Œç‰¹åˆ«æ˜¯åœ¨ç¥ç»ç½‘ç»œçš„å­¦ä¹ ä¸­ç»å¸¸è¢«ä½¿ç”¨ã€‚ ä¸æ–­çš„å‰è¿›çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘ä¸€æ¬¡å‰è¿›å¤šå°‘ï¼Ÿè¿™å°±æ˜¯ç¥ç»ç½‘ç»œçš„å­¦ä¹ ä¸­çš„å­¦ä¹ ç‡ã€‚ 1234567# æ¢¯åº¦ä¸‹é™æ³• å­¦ä¹ ç‡ä¸º 0.01 å­¦ä¹ æ¬¡æ•°ä¸º 100 æ¬¡def gradient_descent(f, init_x, lr=0.01, step_num=100): x = init_x for i in range(step_num): grad = numerical_gradient(f, x) x -= lr * grad return x åƒå­¦ä¹ ç‡è¿™æ ·çš„ç”±äººå·¥è®¾å®šçš„å‚æ•°ç§°ä¸ºè¶…å‚æ•°ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè¶…å‚æ•°éœ€è¦å°è¯•å¤šä¸ªå€¼ï¼Œä»¥ä¾¿æ‰¾åˆ°ä¸€ç§å¯ä»¥ä½¿å­¦ä¹ é¡ºåˆ©è¿›è¡Œçš„è®¾å®šã€‚ ç¥ç»ç½‘ç»œçš„æ¢¯åº¦ç¥ç»ç½‘ç»œçš„å­¦ä¹ ä¹Ÿè¦æ±‚æ¢¯åº¦ã€‚è¿™é‡Œæ‰€è¯´çš„æ¢¯åº¦æ˜¯æŒ‡æŸå¤±å‡½æ•°å…³äºæƒé‡å‚æ•°çš„æ¢¯åº¦ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839import sys, ossys.path.append(os.pardir)import numpy as npfrom common.functions import softmax, cross_entropy_errorfrom common.gradient import numerical_gradientclass simpleNet: def __init__(self): self.W = np.random.randn(2,3) # ç”¨é«˜æ–¯åˆ†å¸ƒè¿›è¡Œåˆå§‹åŒ– def predict(self, x): return np.dot(x, self.W) def loss(self, x, t): z = self.predict(x) y = softmax(z) loss = cross_entropy_error(y, t) # äº¤å‰ç†µè¯¯å·® return loss## æ±‚è¿™ä¸ªç®€å•ç¥ç»ç½‘ç»œçš„æŸå¤±net = simpleNet()print(net.W) # æƒé‡å‚æ•°'''[[ 0.47355232 0.9977393 0.84668094], [ 0.85557411 0.03563661 0.69422093]])'''x = np.array([0.6, 0.9])p = net.predict(x)print(p) # [ 1.05414809 0.63071653 1.1328074]np.argmax(p) # æœ€å¤§å€¼çš„ç´¢å¼•t = np.array([0, 0, 1]) # æ­£ç¡®è§£æ ‡ç­¾net.loss(x, t) # 0.92806853663411326## æ±‚æ¢¯åº¦f = lambda w: net.loss(x, t) # æ­¤å¤„ä¼ å‚ w ä¸ºä¼ªå‚æ•°ï¼Œæ±‚æ¢¯åº¦ä¸­ä¼šè¿›è¡Œä¼ å‚dW = numerical_gradient(f, net.W)print(dW)'''[[ 0.21924763 0.14356247 -0.36281009] [ 0.32887144 0.2153437 -0.54421514]]''' åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»å¾—åˆ°äº†è¿™ä¸ªç¥ç»ç½‘ç»œçš„æŸå¤±å‡½æ•°æ‰€å¯¹åº”çš„æ¢¯åº¦äº†ï¼Œè®©æˆ‘ä»¬æ¥è§‚å¯Ÿä¸€ä¸‹è¿™ä¸ªæ¢¯åº¦çŸ©é˜µã€‚é¦–å…ˆï¼Œå½¢çŠ¶ä¸Šæ¢¯åº¦çŸ©é˜µä¸æƒé‡çŸ©é˜µçš„å½¢çŠ¶ç›¸åŒï¼Œå¹¶ä¸”åº”è¯¥æ˜¯å¯¹åº”çš„å…³ç³»ï¼šw(2,3) å¯¹åº”çš„æ¢¯åº¦å¤§çº¦ä¸º -0.5ï¼Œè¿™æ„å‘³ç€è¿™ä¸ªæ–¹å‘ä¸Šçš„æƒé‡æ¯å¢åŠ  hï¼ŒæŸå¤±å‡½æ•°çš„å€¼å°†å‡å° 0.5*h æ±‚å‡ºç¥ç»ç½‘ç»œçš„æ¢¯åº¦åï¼Œæ¥ä¸‹æ¥åªéœ€æ ¹æ®æ¢¯åº¦æ³•ï¼Œæ›´æ–°æƒé‡å‚æ•°å³å¯ã€‚ å­¦ä¹ ç®—æ³•çš„å®ç°æ­¥éª¤ 1ï¼ˆmini-batchï¼‰ï¼š ä»è®­ç»ƒæ•°æ®ä¸­éšæœºé€‰å‡ºä¸€éƒ¨åˆ†æ•°æ®ï¼Œè¿™éƒ¨åˆ†æ•°æ®ç§°ä¸ºmini-batchã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯å‡å° mini-batch çš„æŸå¤±å‡½æ•°çš„å€¼ã€‚ æ­¥éª¤ 2ï¼ˆè®¡ç®—æ¢¯åº¦ï¼‰ï¼š ä¸ºäº†å‡å° mini-batch çš„æŸå¤±å‡½æ•°çš„å€¼ï¼Œéœ€è¦æ±‚å‡ºå„ä¸ªæƒé‡å‚æ•°çš„æ¢¯åº¦ã€‚ æ¢¯åº¦è¡¨ç¤ºæŸå¤±å‡½æ•°çš„å€¼å‡å°æœ€å¤šçš„æ–¹å‘ã€‚ æ­¥éª¤ 3ï¼ˆæ›´æ–°å‚æ•°ï¼‰ï¼š å°†æƒé‡å‚æ•°æ²¿æ¢¯åº¦æ–¹å‘è¿›è¡Œå¾®å°æ›´æ–°ã€‚ æ­¥éª¤ 4ï¼ˆé‡å¤ï¼‰ï¼š é‡å¤æ­¥éª¤1ã€æ­¥éª¤2ã€æ­¥éª¤3ã€‚ å› ä¸ºè¿™é‡Œä½¿ç”¨çš„æ•°æ®æ˜¯éšæœºé€‰æ‹©çš„ mini batch æ•°æ®ï¼Œæ‰€ä»¥åˆç§°ä¸ºéšæœºæ¢¯åº¦ä¸‹é™æ³• SGDï¼ˆStochastic Gradient Descentï¼‰ã€‚ ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥å®ç°æ‰‹å†™æ•°å­—è¯†åˆ«çš„ç¥ç»ç½‘ç»œã€‚è¿™é‡Œä»¥ 2 å±‚ç¥ç»ç½‘ç»œï¼ˆéšè—å±‚ä¸º 1 å±‚çš„ç½‘ç»œï¼‰ä¸ºå¯¹è±¡ï¼Œä½¿ç”¨ MNIST æ•°æ®é›†è¿›è¡Œå­¦ä¹ ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940## ä¸¤å±‚ç¥ç»ç½‘ç»œçš„ç±»import sys, ossys.path.append(os.pardir)from common.functions import *from common.gradient import numerical_gradientclass TwoLayerNet: def __init__(self, input_size, hidden_size, output_size, weight_init_std=0.01): # åˆå§‹åŒ–æƒé‡ self.params = &#123;&#125; self.params['W1'] = weight_init_std * np.random.randn(input_size, hidden_size) self.params['b1'] = np.zeros(hidden_size) self.params['W2'] = weight_init_std * np.random.randn(hidden_size, output_size) self.params['b2'] = np.zeros(output_size) def predict(self, x): W1, W2 = self.params['W1'], self.params['W2'] b1, b2 = self.params['b1'], self.params['b2'] a1 = np.dot(x, W1) + b1 z1 = sigmoid(a1) a2 = np.dot(z1, W2) + b2 y = softmax(a2) return y # x:è¾“å…¥æ•°æ®, t:ç›‘ç£æ•°æ® def loss(self, x, t): y = self.predict(x) return cross_entropy_error(y, t) def accuracy(self, x, t): y = self.predict(x) y = np.argmax(y, axis=1) t = np.argmax(t, axis=1) accuracy = np.sum(y == t) / float(x.shape[0]) return accuracy # x:è¾“å…¥æ•°æ®, t:ç›‘ç£æ•°æ® def numerical_gradient(self, x, t): loss_W = lambda W: self.loss(x, t) grads = &#123;&#125; grads['W1'] = numerical_gradient(loss_W, self.params['W1']) grads['b1'] = numerical_gradient(loss_W, self.params['b1']) grads['W2'] = numerical_gradient(loss_W, self.params['W2']) grads['b2'] = numerical_gradient(loss_W, self.params['b2']) return grads mini-batch çš„å®ç° 12345678910111213141516171819202122232425import numpy as npfrom dataset.mnist import load_mnistfrom two_layer_net import TwoLayerNet(x_train, t_train), (x_test, t_test) = load_mnist(normalize=True, one_hot_laobel = True)train_loss_list = []# è¶…å‚æ•°iters_num = 10000 # å¾ªç¯æ¬¡æ•°train_size = x_train.shape[0]batch_size = 100learning_rate = 0.1network = TwoLayerNet(input_size=784, hidden_size=50, output_size=10)for i in range(iters_num): # è·å– mini-batchï¼Œéšæœºè·å– 100 ä¸ª batch_mask = np.random.choice(train_size, batch_size) x_batch = x_train[batch_mask] t_batch = t_train[batch_mask] # è®¡ç®—æ¢¯åº¦ grad = network.numerical_gradient(x_batch, t_batch) # grad = network.gradient(x_batch, t_batch) # é«˜é€Ÿç‰ˆ! # æ›´æ–°å‚æ•° for key in ('W1', 'b1', 'W2', 'b2'): network.params[key] -= learning_rate * grad[key] # è®°å½•å­¦ä¹ è¿‡ç¨‹ loss = network.loss(x_batch, t_batch) train_loss_list.append(loss) è¿™é‡Œç»™å‡ºçš„ç®—æ³•è®°å½•äº†æ¯ä¸€æ¬¡çš„æŸå¤±ï¼Œä½†å…¶å®è¿™æ˜¯æ²¡æœ‰å¿…è¦çš„ï¼Œæˆ‘ä»¬å…¶å®åªè¦å¯¹ä¸€æ¬¡ epoch åšä¸€æ¬¡è¯„ä»·å°±å¯ä»¥ã€‚ epoch æ˜¯ä¸€ä¸ªå•ä½ã€‚ä¸€ä¸ª epoch è¡¨ç¤ºå­¦ä¹ ä¸­æ‰€æœ‰è®­ç»ƒæ•°æ®å‡è¢«ï¼ˆå®è§‚ä¸Šï¼‰ä½¿ç”¨è¿‡ä¸€æ¬¡æ—¶çš„æ›´æ–°æ¬¡æ•°ã€‚ 1234567891011121314151617181920212223242526272829303132333435import numpy as npfrom dataset.mnist import load_mnistfrom two_layer_net import TwoLayerNet(x_train, t_train), (x_test, t_test) = \\ load_mnist(normalize=True, one_hot_ laobel = True)train_loss_list = []train_acc_list = []test_acc_list = []# å¹³å‡æ¯ä¸ª epoch çš„é‡å¤æ¬¡æ•°iter_per_epoch = max(train_size / batch_size, 1)# è¶…å‚æ•°iters_num = 10000batch_size = 100learning_rate = 0.1network = TwoLayerNet(input_size=784, hidden_size=50, output_size=10)for i in range(iters_num): # è·å– mini-batch batch_mask = np.random.choice(train_size, batch_size) x_batch = x_train[batch_mask] t_batch = t_train[batch_mask] # è®¡ç®—æ¢¯åº¦ grad = network.numerical_gradient(x_batch, t_batch) # grad = network.gradient(x_batch, t_batch) # é«˜é€Ÿç‰ˆ! # æ›´æ–°å‚æ•° for key in ('W1', 'b1', 'W2', 'b2'): network.params[key] -= learning_rate * grad[key] loss = network.loss(x_batch, t_batch) train_loss_list.append(loss) # è®¡ç®—æ¯ä¸ª epoch çš„è¯†åˆ«ç²¾åº¦ if i % iter_per_epoch == 0: train_acc = network.accuracy(x_train, t_train) test_acc = network.accuracy(x_test, t_test) train_acc_list.append(train_acc) test_acc_list.append(test_acc) print(\"train acc, test acc | \" + str(train_acc) + \", \" + str(test_acc)) è¯¯å·®åå‘ä¼ æ’­åœ¨å‰é¢çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬ç”¨æ•°å€¼å¾®åˆ†è®¡ç®—äº†ç¥ç»ç½‘ç»œçš„æƒé‡å‚æ•°çš„æ¢¯åº¦ã€‚æ•°å€¼å¾®åˆ†ç®€å•æ˜“å®ç°ï¼Œä½†åœ¨è®¡ç®—ä¸Šæ˜¯æ¯”è¾ƒè€—è´¹æ—¶é—´çš„ã€‚æœ¬ç« æˆ‘ä»¬å°†å­¦ä¹ ä¸€ä¸ªé«˜æ•ˆè®¡ç®—æƒé‡å‚æ•°çš„æ¢¯åº¦æ–¹æ³•ï¼šè¯¯å·®åå‘ä¼ æ’­ã€‚ é¦–å…ˆæˆ‘ä»¬é€šè¿‡å›¾ç‰‡æ¥ç†è§£è¿™ä¸€æ–¹æ³•ã€‚ ä¸Šå›¾è¡¨ç¤ºçš„æ˜¯åŸºäºåå‘ä¼ æ’­çš„å¯¼æ•°ä¼ é€’ã€‚ è®©æˆ‘ä»¬æ¥çœ‹çœ‹å›¾ä¸­çš„å„æ•°å€¼ä»£è¡¨ä»€ä¹ˆã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œåå‘ä¼ æ’­ä»å³å‘å·¦ä¼ é€’å¯¼æ•°çš„å€¼ï¼ˆ1 ğŸ‘‰ 1.1 ğŸ‘‰2.2ï¼‰ã€‚è¿™è¡¨ç¤ºæ”¯ä»˜é‡‘é¢å…³äºè‹¹æœä»·æ ¼çš„å¯¼æ•°çš„å€¼æ˜¯ 2.2ï¼Œå³è‹¹æœæ¯ä¸Šæ¶¨ Ã° å…ƒï¼Œæœ€ç»ˆçš„æ”¯ä»˜é‡‘é¢ä¼šå¢åŠ  2.2Ã° å…ƒã€‚ é€šè¿‡è§‚å¯Ÿæˆ‘ä»¬å¯ä»¥å‘ç°ä¸€ä¸ªæ›´ä¸ºé€šç”¨çš„æ³•åˆ™ï¼Œè®¡ç®—ä¸­é€”æ±‚å¾—çš„å¯¼æ•°çš„ç»“æœï¼ˆä¸­é—´ä¼ é€’çš„å¯¼æ•°ï¼‰å¯ä»¥è¢«å…±äº«ï¼Œä»è€Œå¯ä»¥é«˜æ•ˆåœ°è®¡ç®—å¤šä¸ªå¯¼æ•°ï¼ˆé“¾å¼æ³•åˆ™ï¼‰ã€‚ åå‘ä¼ æ’­çš„èŠ‚ç‚¹é™¤äº† x è¿˜æœ‰ +ã€‚åŠ æ³•èŠ‚ç‚¹çš„å˜åŒ–åœ¨ä¼ æ’­çš„è¿‡ç¨‹ä¸­ä¸å¯¹ä¸Šä¸€å±‚çš„é“¾å¼ä¼ æ’­æ•°å€¼äº§ç”Ÿå½±å“ã€‚ æ¥çœ‹ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„ä¾‹å­ã€‚ è‹¹æœä¸ªæ•°å¯¹æœ€ç»ˆä»·æ ¼çš„å½±å“ä¸ºï¼š110ã€‚ æ¨å¯¼è¿‡ç¨‹ï¼šä»å³åˆ°å·¦ 715 = 650 x 1.1 è¿™é‡Œå¾—åˆ°å½±å“å› å­ 1.1 ğŸ‘‰ åŠ æ³•èŠ‚ç‚¹ç›´æ¥ç»§æ‰¿ä¸Šä¸€å±‚çš„å½±å“å› å­ 1.1 ğŸ‘‰ 200 = 2 x 100 è¿™é‡Œå¾—åˆ°å½±å“å› å­ 1.1 x 100 = 110ã€‚ ä»£ç å®ç°åœ¨è¿™é‡Œæˆ‘ä»¬ç”¨ Python å®ç°ä¸Šè¿°çš„ä¾‹å­ã€‚ä¹˜æ³•èŠ‚ç‚¹ä¸ºä¹˜æ³•å±‚ï¼ˆMulLayerï¼‰ï¼ŒåŠ æ³•èŠ‚ç‚¹ç§°ä¸ºåŠ æ³•å±‚ï¼ˆAddLayerï¼‰ã€‚ ä¹˜æ³•å±‚123456789101112131415class MulLayer: def __init__(self): self.x = None self.y = None # æ­£å‘ä¼ æ’­ def forward(self, x, y): self.x = x self.y = y out = x * y return out # åå‘ä¼ æ’­ dout ä¸ºä¸Šæ¸¸ä¼ æ¥çš„å¯¼æ•° def backward(self, dout): dx = dout * self.y # ç¿»è½¬ x å’Œ y dy = dout * self.x return dx, dy é‚£æˆ‘ä»¬ä¹°è‹¹æœçš„è®¡ç®—å›¾çš„æ­£å‘ä¼ æ’­å¯ä»¥ç”¨ä»¥ä¸‹ä»£ç è¡¨ç¤ºã€‚ 12345678910apple = 100apple_num = 2tax = 1.1# layermul_apple_layer = MulLayer()mul_tax_layer = MulLayer()# forwardapple_price = mul_apple_layer.forward(apple, apple_num)price = mul_tax_layer.forward(apple_price, tax)print(price) # 220 å…³äºå„ä¸ªå˜é‡çš„å¯¼æ•°å¯ç”± backward() æ±‚å‡º 12345# backwarddprice = 1dapple_price, dtax = mul_tax_layer.backward(dprice)dapple, dapple_num = mul_apple_layer.backward(dapple_price)print(dapple, dapple_num, dtax) # 2.2 110 200 åŠ æ³•å±‚12345678910class AddLayer: def __init__(self): pass def forward(self, x, y): out = x + y return out def backward(self, dout): dx = dout * 1 dy = dout * 1 return dx, dy æˆ‘ä»¬æ¥ç”¨ Python ä»£ç å®ç°ä¸€ä¸‹ä¹°è‹¹æœå’Œæ©˜å­çš„è®¡ç®—å›¾ã€‚ 1234567891011121314151617181920212223apple = 100apple_num = 2orange = 150orange_num = 3tax = 1.1# layermul_apple_layer = MulLayer()mul_orange_layer = MulLayer()add_apple_orange_layer = AddLayer()mul_tax_layer = MulLayer()# forwardapple_price = mul_apple_layer.forward(apple, apple_num) # (1)orange_price = mul_orange_layer.forward(orange, orange_num) # (2)all_price = add_apple_orange_layer.forward(apple_price, orange_price) # (3)price = mul_tax_layer.forward(all_price, tax) #( 4)# backwarddprice = 1dall_price, dtax = mul_tax_layer.backward(dprice) # (4)dapple_price, dorange_price = add_apple_orange_layer.backward(dall_price) # (3)dorange, dorange_num = mul_orange_layer.backward(dorange_price) # (2)dapple, dapple_num = mul_apple_layer.backward(dapple_price) # (1)print(price) # 715print(dapple_num, dapple, dorange, dorange_num, dtax) # 110 2.2 3.3 165 650 æ¿€æ´»å‡½æ•°å±‚çš„å®ç°ç°åœ¨ï¼Œæˆ‘ä»¬å°†è®¡ç®—å›¾çš„æ€è·¯åº”ç”¨åˆ°ç¥ç»ç½‘ç»œä¸­ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬æŠŠæ„æˆç¥ç»ç½‘ç»œçš„å±‚å®ç°ä¸ºä¸€ä¸ªç±»ã€‚å…ˆæ¥å®ç°æ¿€æ´»å‡½æ•°çš„ ReLU å±‚å’Œ Sigmoid å±‚ã€‚ ReLU å±‚ å¦‚æœæ­£å‘ä¼ æ’­æ—¶çš„è¾“å…¥ x å¤§äº 0ï¼Œåˆ™åå‘ä¼ æ’­ä¼šå°†ä¸Šæ¸¸çš„å€¼åŸå°ä¸åŠ¨åœ°ä¼ ç»™ä¸‹æ¸¸ã€‚åè¿‡æ¥ï¼Œå¦‚æœæ­£å‘ä¼ æ’­æ—¶çš„ x å°äºç­‰äº 0ï¼Œåˆ™åå‘ä¼ æ’­ä¸­ä¼ ç»™ä¸‹æ¸¸çš„ä¿¡å·å°†åœåœ¨æ­¤å¤„ã€‚ 123456789101112class Relu: def __init__(self): self.mask = None def forward(self, x): self.mask = (x &lt;= 0) out = x.copy() out[self.mask] = 0 return out def backward(self, dout): dout[self.mask] = 0 dx = dout return dx ReLU ç±»æœ‰å®ä¾‹å˜é‡ maskã€‚è¿™ä¸ªå˜é‡ mask æ˜¯ç”± True / False æ„æˆçš„ NumPy æ•° ç»„ï¼Œå®ƒä¼šæŠŠæ­£å‘ä¼ æ’­æ—¶çš„è¾“å…¥ x çš„å…ƒç´ ä¸­å°äºç­‰äº 0 çš„åœ°æ–¹ä¿å­˜ä¸º Trueï¼Œå…¶ä»–åœ°æ–¹ï¼ˆå¤§äº 0 çš„å…ƒç´ ï¼‰ä¿å­˜ä¸º Falseã€‚ å¦‚æœæ­£å‘ä¼ æ’­æ—¶çš„è¾“å…¥å€¼å°äºç­‰äº 0ï¼Œåˆ™åå‘ä¼ æ’­çš„å€¼ä¸º 0ã€‚ å› æ­¤ï¼Œåå‘ä¼ æ’­ä¸­ä¼šä½¿ç”¨æ­£å‘ä¼ æ’­æ—¶ä¿å­˜çš„ maskï¼Œå°†ä»ä¸Šæ¸¸ä¼ æ¥çš„ dout çš„ mask ä¸­çš„å…ƒç´ ä¸º True çš„åœ°æ–¹è®¾ä¸º 0ã€‚ Sigmoid å±‚ è¿™é‡Œ / ç”¨å€’æ•°çš„ x è®¡ç®—ã€‚ å¯¹ç»“æœè¿›è¡Œè¿›ä¸€æ­¥çš„æ•´ç†ã€‚ è®©æˆ‘ä»¬å°†æ¨å¯¼çš„è¿‡ç¨‹éšè”½ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€ä¸ª Sigmoid èŠ‚ç‚¹ã€‚ 12345678910class Sigmoid: def __init__(self): self.out = None def forward(self, x): out = 1 / (1 + np.exp(-x)) self.out = out return out def backward(self, dout): dx = dout * (1.0 - self.out) * self.out return dx Affine / Softmax å±‚çš„å®ç°åœ¨å¾ˆå‰é¢çš„ç« èŠ‚ä¸­ï¼ˆå¿˜äº†èµ¶ç´§å›å»ç»™æˆ‘å¤ä¹ ï¼šç¥ç»ç½‘ç»œ / ç®€å•å®ç°]]ï¼‰ï¼Œæˆ‘ä»¬åˆ©ç”¨å…¬å¼ Y = np.dot(X,W) + B è®¡ç®—å‡ºç¥ç»å…ƒçš„åŠ æƒã€‚ç„¶å Y ç»è¿‡æ¿€æ´»å‡½æ•°è½¬æ¢åï¼Œä¼ é€’ç»™ä¸‹ä¸€å±‚ï¼Œè¿™å°±æ˜¯ç¥ç»ç½‘ç»œæ­£å‘ä¼ æ’­è¿‡ç¨‹ã€‚ ç¥ç»ç½‘ç»œçš„æ­£å‘ä¼ æ’­ä¸­è¿›è¡Œçš„çŸ©é˜µçš„ä¹˜ç§¯è¿ç®—åœ¨å‡ ä½•å­¦é¢†åŸŸè¢«ç§°ä¸ºä»¿å°„å˜æ¢ã€‚å› æ­¤ï¼Œè¿™é‡Œå°†è¿›è¡Œä»¿å°„å˜æ¢çš„å¤„ç†å®ç°ä¸º Affine å±‚ã€‚ è®©æˆ‘ä»¬æ¥çœ‹çœ‹å°†è¿™ä¸ªè¿‡ç¨‹è½¬æ¢ä¸ºè®¡ç®—å›¾æ˜¯ä»€ä¹ˆæ ·å­çš„ã€‚ æ­£å‘ä¼ æ’­æ—¶ï¼Œåç½®ä¼šè¢«åŠ åˆ°æ¯ä¸€ä¸ªæ•°æ®ä¸Šã€‚å› æ­¤ï¼Œåå‘ä¼ æ’­æ—¶ï¼Œå„ä¸ªæ•°æ®çš„åå‘ä¼ æ’­çš„å€¼éœ€è¦æ±‡æ€»ä¸ºåç½®çš„å…ƒç´ ã€‚ Affine å±‚ï¼šç¥ç»ç½‘ç»œçš„æ­£å‘ä¼ æ’­ä¸­ï¼Œè¿›è¡Œçš„çŸ©é˜µçš„ä¹˜ç§¯è¿ç®—ï¼Œåœ¨å‡ ä½•å­¦é¢†åŸŸè¢«ç§°ä¸ºä»¿å°„å˜æ¢ã€‚å‡ ä½•ä¸­ï¼Œä»¿å°„å˜æ¢åŒ…æ‹¬ä¸€æ¬¡çº¿æ€§å˜æ¢å’Œä¸€æ¬¡å¹³ç§»ï¼Œåˆ†åˆ«å¯¹åº”ç¥ç»ç½‘ç»œçš„åŠ æƒå’Œè¿ç®—ä¸åŠ åç½®è¿ç®—ã€‚ 12345678910111213141516class Affine: def __init__(self, W, b): self.W = W self.b = b self.x = None self.dW = None self.db = None def forward(self, x): self.x = x out = np.dot(x, self.W) + self.b return out def backward(self, dout): dx = np.dot(dout, self.W.T) self.dW = np.dot(self.x.T, dout) self.db = np.sum(dout, axis=0) # å…¬å¼ 3 æŠŠ b å½“æˆ return dx Softmax-with-Loss å±‚åœ¨ç¥ç»ç½‘ç»œçš„å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬éœ€è¦å°†è¾“å‡ºæ­£è§„åŒ–åè¾“å…¥æŸå¤±å‡½æ•°è¿›è¡Œå¤„ç†ï¼Œä¸€èˆ¬ä¼šä½¿ç”¨ Softmax å±‚ï¼›å½“ç¥ç»ç½‘ç»œçš„æ¨ç†åªéœ€è¦ç»™å‡ºä¸€ä¸ªç­”æ¡ˆçš„æƒ…å†µä¸‹ï¼Œå› ä¸ºæ­¤æ—¶åªå¯¹å¾—åˆ†æœ€å¤§å€¼æ„Ÿå…´è¶£ï¼Œæ‰€ä»¥ä¸éœ€è¦ Softmax å±‚ã€‚ Softmax-with-Lossï¼šè¿™é‡Œçš„ Loss æŒ‡äº¤äº¤å‰ç†µè¯¯å·®å±‚ Cross Entropy Errorã€‚ è¿™å›¾çœ‹åˆ°äººå°±å‚»äº†ï¼Œè®©æˆ‘ä»¬æ¥ç®€åŒ–ä¸€ä¸‹ã€‚ è®©æˆ‘ä»¬æ¥çœ‹çœ‹å„ä¸ªå­—æ¯æ‰€ä»£è¡¨çš„å«ä¹‰ã€‚ï¼ˆy1, y2, y3ï¼‰ æ˜¯ Softmax å±‚çš„è¾“å‡ºï¼Œï¼ˆt1, t2, t3ï¼‰ æ˜¯ç›‘ç£æ•°æ®ï¼Œæ‰€ä»¥ ï¼ˆy1 âˆ’ t1, y2 âˆ’ t2, y3 âˆ’ t3ï¼‰ æ˜¯ Softmax å±‚çš„è¾“å‡ºå’Œæ•™å¸ˆæ ‡ç­¾çš„å·®åˆ†ã€‚æ‰€ä»¥ ï¼ˆy1 âˆ’ t1, y2 âˆ’ t2, y3 âˆ’ t3ï¼‰ æ˜¯ Softmax å±‚çš„è¾“å‡ºå’Œæ•™å¸ˆæ ‡ç­¾çš„å·®åˆ†ï¼ˆå³è¾“å‡ºä¸æ ‡ç­¾çš„è¯¯å·®ï¼‰ã€‚ ä½¿ç”¨äº¤å‰ç†µè¯¯å·®ä½œä¸º softmax å‡½æ•°çš„æŸå¤±å‡½æ•°åï¼Œåå‘ä¼ æ’­å¾—åˆ° ï¼ˆy1 âˆ’ t1, y2 âˆ’ t2, y3 âˆ’ t3ï¼‰ è¿™æ ·æ¼‚äº®çš„ç»“æœã€‚å®é™…ä¸Šï¼Œè¿™æ ·æ¼‚äº®çš„ç»“æœå¹¶ä¸æ˜¯å¶ç„¶çš„ï¼Œè€Œæ˜¯ä¸ºäº†å¾—åˆ°è¿™æ ·çš„ç»“æœï¼Œç‰¹æ„è®¾è®¡äº†äº¤å‰ç†µè¯¯å·®å‡½æ•°ã€‚ å›å½’é—®é¢˜ä¸­è¾“å‡ºå±‚ä½¿ç”¨æ’ç­‰å‡½æ•°ï¼ŒæŸå¤±å‡½æ•°ä½¿ç”¨å¹³æ–¹å’Œè¯¯å·®ï¼Œä¹Ÿæ˜¯å‡ºäºåŒæ ·çš„ç†ç”±ï¼ˆå¿˜äº†å°±ç»™æˆ‘ç¿»å›å»å¤ä¹ ï¼ï¼ï¼ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½¿ç”¨å¹³æ–¹å’Œè¯¯å·®ä½œä¸ºæ’ç­‰å‡½æ•°çš„æŸå¤±å‡½æ•°ï¼Œåå‘ä¼ æ’­æ‰èƒ½å¾—åˆ° ï¼ˆy1 âˆ’ t1, y2 âˆ’ t2, y3 âˆ’ t3ï¼‰ è¿™æ ·æ¼‚äº®çš„ç»“æœã€‚ 1234567891011121314class SoftmaxWithLoss: def __init__(self): self.loss = None # æŸå¤± self.y = None # softmax çš„è¾“å‡º self.t = None # ç›‘ç£æ•°æ®ï¼ˆone-hot vectorï¼‰ def forward(self, x, t): self.t = t self.y = softmax(x) self.loss = cross_entropy_error(self.y, self.t) return self.loss def backward(self, dout=1): batch_size = self.t.shape[0] dx = (self.y - self.t) / batch_size return dx æ€»ç»“ç°åœ¨æ¥è¿›è¡Œç¥ç»ç½‘ç»œçš„å®ç°ã€‚è¿™é‡Œæˆ‘ä»¬è¦æŠŠ 2 å±‚ç¥ç»ç½‘ç»œå®ç°ä¸º TwoLayerNetã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364import sys, ossys.path.append(os.pardir)import numpy as npfrom common.layers import *from common.gradient import numerical_gradientfrom collections import OrderedDictclass TwoLayerNet: # è¾“å…¥å±‚çš„ç¥ç»å…ƒæ•°ã€éšè—å±‚çš„ç¥ç»å…ƒæ•°ã€è¾“å‡ºå±‚çš„ç¥ç»å…ƒæ•°ã€åˆå§‹åŒ–æƒé‡æ—¶çš„é«˜æ–¯åˆ†å¸ƒçš„è§„æ¨¡ def __init__(self, input_size, hidden_size, output_size, weight_init_std=0.01): # åˆå§‹åŒ–æƒé‡ params ä¸ºå‚æ•°å­—å…¸ self.params = &#123;&#125; self.params['W1'] = weight_init_std * np.random.randn(input_size, hidden_size) self.params['b1'] = np.zeros(hidden_size) self.params['W2'] = weight_init_std * np.random.randn(hidden_size, output_size) self.params['b2'] = np.zeros(output_size) # ç”Ÿæˆå±‚ layers æœ‰åºå­—å…¸å‹å˜é‡ ä¿å­˜ç¥ç»ç½‘ç»œçš„å±‚ self.layers = OrderedDict() self.layers['Affine1'] = Affine(self.params['W1'], self.params['b1']) self.layers['Relu1'] = Relu() self.layers['Affine2'] = Affine(self.params['W2'], self.params['b2']) # ç¥ç»ç½‘ç»œçš„æœ€åä¸€å±‚ self.lastLayer = SoftmaxWithLoss() def predict(self, x): for layer in self.layers.values(): x = layer.forward(x) return x # x:è¾“å…¥æ•°æ®, t:ç›‘ç£æ•°æ® def loss(self, x, t): y = self.predict(x) return self.lastLayer.forward(y, t) # è®¡ç®—è¯†åˆ«ç²¾åº¦ def accuracy(self, x, t): y = self.predict(x) y = np.argmax(y, axis=1) if t.ndim != 1 : t = np.argmax(t, axis=1) accuracy = np.sum(y == t) / float(x.shape[0]) return accuracy # x:è¾“å…¥æ•°æ®, t:ç›‘ç£æ•°æ® é€šè¿‡æ•°å€¼å¾®åˆ†è®¡ç®—å…³äºæƒé‡çš„æ¢¯åº¦ def numerical_gradient(self, x, t): loss_W = lambda W: self.loss(x, t) grads = &#123;&#125; grads['W1'] = numerical_gradient(loss_W, self.params['W1']) grads['b1'] = numerical_gradient(loss_W, self.params['b1']) grads['W2'] = numerical_gradient(loss_W, self.params['W2']) grads['b2'] = numerical_gradient(loss_W, self.params['b2']) return grads # é€šè¿‡è¯¯å·®åå‘ä¼ æ’­è®¡ç®—å…³äºæƒé‡å‚æ•°çš„æ¢¯åº¦ def gradient(self, x, t): # forward self.loss(x, t) # backward dout = 1 dout = self.lastLayer.backward(dout) layers = list(self.layers.values()) layers.reverse() for layer in layers: dout = layer.backward(dout) # è®¾å®š grads = &#123;&#125; grads['W1'] = self.layers['Affine1'].dW grads['b1'] = self.layers['Affine1'].db grads['W2'] = self.layers['Affine2'].dW grads['b2'] = self.layers['Affine2'].db return grads æ³¨æ„ï¼Œå°†ç¥ç»ç½‘ç»œçš„å±‚ä¿å­˜åœ¨ OrderedDict è¿™ä¸€ç‚¹éå¸¸é‡è¦ï¼ˆæ­£å‘ä¸åå‘éƒ½éœ€è¦æŒ‰é¡ºåºè°ƒç”¨å„å±‚ï¼‰ã€‚ å¯èƒ½åœ¨åº§çš„å„ä½ä¼šæœ‰ä¸€ä¸ªç–‘é—®ï¼šæ—¢ç„¶æˆ‘ä»¬æœ‰äº†è®¡ç®—è¾ƒä¸ºç®€å•çš„è¯¯å·®åå‘ä¼ æ’­ï¼Œä¸ºä»€ä¹ˆè¿˜è¦ç”±æ•°å€¼å¾®åˆ†çš„æ–¹æ³•å‘¢ï¼Ÿè¯¯å·®åå‘ä¼ æ’­çš„è®¡ç®—è™½ç„¶ç®€å•ï¼Œä½†æ˜¯å®ç°è¾ƒä¸ºå¤æ‚ï¼Œå®¹æ˜“å‡ºé”™ã€‚æ‰€ä»¥ï¼Œç»å¸¸ä¼šæ¯”è¾ƒæ•°å€¼å¾®åˆ†çš„ç»“æœå’Œè¯¯å·®åå‘ä¼ æ’­æ³•çš„ç»“æœï¼Œä»¥ç¡®è®¤è¯¯å·®åå‘ä¼ æ’­æ³•çš„å®ç°æ˜¯å¦æ­£ç¡®ã€‚ 1234567891011121314151617# æ¢¯åº¦ç¡®è®¤import sys, ossys.path.append(os.pardir)import numpy as npfrom dataset.mnist import load_mnistfrom two_layer_net import TwoLayerNet# è¯»å…¥æ•°æ®(x_train, t_train), (x_test, t_test) = load_mnist(normalize=True, one_hot_label = True)network = TwoLayerNet(input_size=784, hidden_size=50, output_size=10)x_batch = x_train[:3]t_batch = t_train[:3]grad_numerical = network.numerical_gradient(x_batch, t_batch)grad_backprop = network.gradient(x_batch, t_batch)# æ±‚å„ä¸ªæƒé‡çš„ç»å¯¹è¯¯å·®çš„å¹³å‡å€¼for key in grad_numerical.keys(): diff = np.average( np.abs(grad_backprop[key] - grad_numerical[key]) ) print(key + \":\" + str(diff)) æœ€åï¼Œæˆ‘ä»¬åˆ©ç”¨åå‘ä¼ æ’­è¯¯å·®æ¥å®ç°ä¸€ä¸‹ç¥ç»ç½‘ç»œçš„å­¦ä¹ ï¼ˆå°±æ˜¯æŠŠå‰é¢çš„æ•°å€¼å¾®åˆ†æ›¿æ¢æˆåå‘è¯¯å·®ä¼ æ’­ï¼‰ã€‚ 12345678910111213141516171819202122232425262728293031323334import sys, ossys.path.append(os.pardir)import numpy as npfrom dataset.mnist import load_mnistfrom two_layer_net import TwoLayerNet# è¯»å…¥æ•°æ®(x_train, t_train), (x_test, t_test) = \\load_mnist(normalize=True, one_hot_label=True)network = TwoLayerNet(input_size=784, hidden_size=50, output_size=10)iters_num = 10000train_size = x_train.shape[0]batch_size = 100learning_rate = 0.1train_loss_list = []train_acc_list = []test_acc_list = []iter_per_epoch = max(train_size / batch_size, 1)for i in range(iters_num): batch_mask = np.random.choice(train_size, batch_size) x_batch = x_train[batch_mask] t_batch = t_train[batch_mask] # é€šè¿‡è¯¯å·®åå‘ä¼ æ’­æ³•æ±‚æ¢¯åº¦ grad = network.gradient(x_batch, t_batch) # æ›´æ–° for key in ('W1', 'b1', 'W2', 'b2'): network.params[key] -= learning_rate * grad[key] loss = network.loss(x_batch, t_batch) train_loss_list.append(loss) if i % iter_per_epoch == 0: train_acc = network.accuracy(x_train, t_train) test_acc = network.accuracy(x_test, t_test) train_acc_list.append(train_acc) test_acc_list.append(test_acc) print(train_acc, test_acc) ä¸å­¦ä¹ ç›¸å…³çš„æŠ€å·§æœ¬ç« å°†ä»‹ç»ä¸€ä¸‹ç¥ç»ç½‘ç»œå­¦ä¹ ä¸­çš„ä¸€äº›é‡è¦è§‚ç‚¹ï¼Œè®©æˆ‘ä»¬å¯ä»¥æ›´é«˜æ•ˆåœ°è¿›è¡Œç¥ç»ç½‘ç»œåœ°å­¦ä¹ ï¼Œæé«˜è¯†åˆ«ç²¾åº¦ã€‚ å‚æ•°æ›´æ–°æˆ‘ä»¬å·²ç»çŸ¥é“ï¼Œç¥ç»ç½‘ç»œçš„å­¦ä¹ ç›®çš„å°±æ˜¯æ‰¾åˆ°ä½¿æŸå¤±å‡½æ•°çš„å°½å¯èƒ½å°çš„å‚æ•°ï¼Œè¿™ä¸ªå¯»æ‰¾æœ€ä¼˜å‚æ•°çš„é—®é¢˜ç§°ä¸ºæœ€ä¼˜åŒ–ã€‚éšæœºæ¢¯åº¦ä¸‹é™æ³•ï¼ˆstochastic gradient descentï¼‰ï¼Œ ç®€ç§° SGD å°±æ˜¯ä¸€ä¸ªç®€å•æœ€ä¼˜åŒ–çš„æ–¹æ³•ã€‚ä½†æ˜¯ï¼Œæ ¹æ®ä¸åŒçš„é—®é¢˜ï¼Œä¹Ÿå­˜åœ¨æ¯” SGD æ›´åŠ èªæ˜çš„æ–¹æ³•ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ä¼šä»‹ç»è¿™äº›æ–¹æ³•ã€‚ SGDå…ˆæ¥çœ‹çœ‹ SGD å§ã€‚ SGD å¯ä»¥ç®€å•çš„ç”¨ä¸Šé¢çš„å›¾è¡¨ç¤ºï¼ˆå³è¾¹çš„å¼å­æ›´æ–°å·¦è¾¹çš„å¼å­ï¼‰ã€‚ 1234567891011class SGD: def __init__(self, lr=0.01): self.lr = lr def update(self, params, grads): for key in params.keys(): params[key] -= self.lr * grads[key]# ä¼˜åŒ–å™¨optimizer = SGD()# ...optimizer.update(params, grads) MomentumMomentum æ˜¯åŠ¨é‡çš„æ„æ€ï¼Œå’Œç‰©ç†æœ‰å…³ã€‚ v å¯¹åº”ç‰©ç†ä¸Šçš„é€Ÿåº¦ã€‚Î±v è¿™ä¸€é¡¹è¡¨ç¤ºåœ¨ç‰©ä½“ä¸å—ä»»ä½•åŠ›æ—¶ï¼Œè¯¥é¡¹æ‰¿æ‹…ä½¿ç‰©ä½“é€æ¸å‡é€Ÿçš„ä»»åŠ¡ï¼ˆÎ± è®¾å®šä¸º 0.9 ä¹‹ç±»çš„å€¼ï¼‰ï¼Œå¯¹åº”ç‰©ç†ä¸Šçš„åœ°é¢æ‘©æ“¦æˆ–ç©ºæ°”é˜»åŠ›ã€‚ å¯¹è¿™ä¸¤ä¸ªå…¬å¼çš„å¤§è‡´ç†è§£ï¼šå°çš„å åŠ ï¼Œå¤§çš„æŠµæ¶ˆï¼ˆå‡å°‘éœ‡è¡ï¼‰ã€‚ AdaGradå‰é¢æåˆ°çš„å­¦ä¹ è¿‡ç¨‹ï¼Œå…¶å­¦ä¹ ç‡æ˜¯å›ºå®šçš„ï¼Œæœ‰äº›ä¼˜åŒ–æ–¹å¼æ˜¯åŠ¨æ€çš„è°ƒèŠ‚å­¦ä¹ ç‡ï¼Œæ¯”å¦‚ï¼šå­¦ä¹ ç‡è¡°å‡ã€‚é€æ¸å‡å°å­¦ä¹ ç‡çš„æƒ³æ³•ï¼Œç›¸å½“äºå°†å…¨ä½“å‚æ•°çš„å­¦ä¹ ç‡å€¼ä¸€èµ·é™ä½ã€‚ è€Œ AdaGrad è¿›ä¸€æ­¥å‘å±•äº†è¿™ä¸ªæƒ³æ³•ï¼Œé’ˆå¯¹ä¸€ä¸ªä¸€ä¸ªçš„å‚æ•°ï¼Œèµ‹äºˆå…¶å®šåˆ¶çš„å€¼ã€‚ AdaGrad ä¼šä¸ºå‚æ•°çš„æ¯ä¸ªå…ƒç´ é€‚å½“åœ°è°ƒæ•´å­¦ä¹ ç‡ï¼Œä¸æ­¤åŒæ—¶è¿›è¡Œå­¦ä¹ ã€‚ h ä¿å­˜äº†ä»¥å‰æ‰€æœ‰æ¢¯åº¦çš„å¹³æ–¹å’Œï¼Œæˆ‘ä»¬ç”¨è¿™ä¸ªå‚æ•°æ¥åŠ¨æ€çš„è°ƒæ•´æ¢¯åº¦çš„å˜åŒ–ç¨‹åº¦ã€‚ 123456789101112class AdaGrad: def __init__(self, lr=0.01): self.lr = lr self.h = None def update(self, params, grads): if self.h is None: self.h = &#123;&#125; for key, val in params.items(): self.h[key] = np.zeros_like(val) for key in params.keys(): self.h[key] += grads[key] * grads[key] params[key] -= self.lr * grads[key] / (np.sqrt(self.h[key]) + 1e-7) æƒé‡åˆå§‹å€¼æƒé‡çš„åˆå§‹å€¼ä¹Ÿå†³å®šäº†è¿™ä¸ªç¥ç»ç½‘ç»œçš„å­¦ä¹ æ˜¯å¦å¯ä»¥æˆåŠŸï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹æƒé‡åˆå§‹å€¼çš„ä¸€äº›æ¨èå€¼ã€‚ ç„¶æˆ‘ä»¬å…ˆæ¥è€ƒè™‘ä¸€ä¸‹æƒå€¼åº”è¯¥è¶Šå¤§è¶Šå¥½ï¼Ÿè¿˜æ˜¯è¶Šå°è¶Šå¥½ï¼Ÿè‹¥æƒå€¼è¶Šå¤§ï¼Œè¿™ä¸ªæ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›å°±å·®ï¼Œæ‰€ä»¥æƒå€¼åº”è¯¥æ˜¯ä¸€ä¸ªè¾ƒå°çš„æ•°ï¼Œåœ¨è¿™ä¹‹å‰çš„æƒé‡åˆå§‹å€¼éƒ½æ˜¯åƒ 0.01 * np.random.randn(10, 100) è¿™æ ·ï¼Œä½¿ç”¨ç”±é«˜æ–¯åˆ†å¸ƒç”Ÿæˆçš„å€¼ä¹˜ä»¥ 0.01 åå¾—åˆ°çš„å€¼ï¼ˆæ ‡å‡†å·®ä¸º0.01çš„é«˜æ–¯åˆ†å¸ƒï¼‰ã€‚ é‚£åˆå§‹æƒå€¼å¯ä»¥è®¾ä¸º 0 å—ï¼Ÿç­”æ¡ˆæ˜¯ä¸å¯çš„ï¼Œè‹¥åˆå§‹æƒé‡éƒ½ä¸º 0ï¼Œè¿™ä½¿å¾—ç¥ç»ç½‘ç»œæ‹¥æœ‰è®¸å¤šä¸åŒçš„æƒé‡çš„æ„ä¹‰ä¸§å¤±äº†ã€‚ä¸ºäº†é˜²æ­¢æƒé‡å‡ä¸€åŒ–ï¼ˆä¸¥æ ¼åœ°è®²ï¼Œæ˜¯ä¸ºäº†ç“¦è§£æƒé‡çš„å¯¹ç§°ç»“æ„ï¼‰ï¼Œå¿…é¡»éšæœºç”Ÿæˆåˆå§‹å€¼ã€‚ å„å±‚çš„æ¿€æ´»å€¼çš„åˆ†å¸ƒéƒ½è¦æ±‚æœ‰é€‚å½“çš„å¹¿åº¦ã€‚é€šè¿‡åœ¨å„å±‚é—´ä¼ é€’å¤šæ ·æ€§çš„æ•°æ®ï¼Œç¥ç»ç½‘ç»œå¯ä»¥è¿›è¡Œé«˜æ•ˆçš„å­¦ä¹ ã€‚åè¿‡æ¥ï¼Œå¦‚æœä¼ é€’çš„æ˜¯æœ‰æ‰€åå‘çš„æ•°æ®ï¼Œå°±ä¼šå‡ºç°æ¢¯åº¦æ¶ˆå¤±æˆ–è€…è¡¨ç°åŠ›å—é™çš„é—®é¢˜ï¼Œå¯¼è‡´å­¦ä¹ å¯èƒ½æ— æ³•é¡ºåˆ©è¿›è¡Œã€‚ ç°åœ¨ï¼Œåœ¨ä¸€èˆ¬çš„æ·±åº¦å­¦ä¹ æ¡†æ¶ä¸­ï¼ŒXavier åˆå§‹å€¼å·²è¢«ä½œä¸ºæ ‡å‡†ä½¿ç”¨ã€‚Xavier åˆå§‹å€¼æ˜¯ä»¥æ¿€æ´»å‡½æ•°æ˜¯çº¿æ€§å‡½æ•°ä¸ºå‰æè€Œæ¨å¯¼å‡ºæ¥çš„ã€‚å› ä¸º sigmoid å‡½æ•°å’Œ tanh å‡½æ•°å·¦å³å¯¹ç§°ï¼Œä¸”ä¸­å¤®é™„è¿‘å¯ä»¥è§†ä½œçº¿æ€§å‡½æ•°ï¼Œæ‰€ä»¥é€‚åˆä½¿ç”¨ Xavier åˆå§‹å€¼ã€‚ å…¶å®ï¼Œæƒé‡åˆå§‹å€¼çš„è®¾å®šä¸æ¿€æ´»å‡½æ•°ä¹Ÿæœ‰ä¸€å®šçš„å…³ç³»ã€‚å½“æ¿€æ´»å‡½æ•°ä½¿ç”¨ ReLU æ—¶ï¼Œä¸€èˆ¬æ¨èä½¿ç”¨ ReLU ä¸“ç”¨çš„åˆå§‹å€¼ He åˆå§‹å€¼ã€‚ Batch Normalizationå‰é¢è®²åˆ°æˆ‘ä»¬éœ€è¦åœ¨å„å±‚æ‹¥æœ‰é€‚å½“çš„å¹¿åº¦ï¼Œè¿™æ ·æ‰å¯ä»¥ä½¿å­¦ä¹ é¡ºåˆ©è¿›è¡Œã€‚é‚£ä¹ˆï¼Œä¸ºäº†ä½¿å„å±‚æ‹¥æœ‰é€‚å½“çš„å¹¿åº¦ï¼Œå¼ºåˆ¶æ€§åœ°è°ƒæ•´æ¿€æ´»å€¼çš„åˆ†å¸ƒä¼šæ€æ ·å‘¢ï¼ŸBatch Normalization å°±æ˜¯åŸºäºè¿™ç§æƒ³æ³•äº§ç”Ÿçš„ã€‚ æ­£åˆ™åŒ–è¿‡æ‹Ÿåˆå­¦ä¹ åç”Ÿæˆçš„æ¨¡å‹æ³›åŒ–èƒ½åŠ›å¼±ï¼šå¯¹æ ·æœ¬æ•°æ®è¯†åˆ«è‰¯å¥½ï¼Œå¯¹æµ‹è¯•æ•°æ®è¯†åˆ«å¾ˆå·®ã€‚ æƒå€¼è¡°é€€æƒå€¼è¡°å‡æ˜¯ä¸€ç›´ä»¥æ¥ç»å¸¸è¢«ä½¿ç”¨çš„ä¸€ç§æŠ‘åˆ¶è¿‡æ‹Ÿåˆçš„æ–¹æ³•ã€‚è¯¥æ–¹æ³•é€šè¿‡åœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­å¯¹å¤§çš„æƒé‡è¿›è¡Œæƒ©ç½šï¼Œæ¥æŠ‘åˆ¶è¿‡æ‹Ÿåˆã€‚å¾ˆå¤šè¿‡æ‹ŸåˆåŸæœ¬å°±æ˜¯å› ä¸ºæƒé‡å‚æ•°å–å€¼è¿‡å¤§æ‰å‘ç”Ÿçš„ã€‚ Dropoutä½œä¸ºæŠ‘åˆ¶è¿‡æ‹Ÿåˆçš„æ–¹æ³•ï¼Œå‰é¢æˆ‘ä»¬ä»‹ç»äº†ä¸ºæŸå¤±å‡½æ•°åŠ ä¸Šæƒé‡çš„ L2 èŒƒæ•°çš„æƒå€¼è¡°å‡æ–¹æ³•ã€‚è¯¥æ–¹æ³•å¯ä»¥ç®€å•åœ°å®ç°ï¼Œåœ¨æŸç§ç¨‹åº¦ä¸Šèƒ½å¤ŸæŠ‘åˆ¶è¿‡æ‹Ÿåˆã€‚ä½†æ˜¯ï¼Œå¦‚æœç½‘ç»œçš„æ¨¡å‹å˜å¾—å¾ˆå¤æ‚ï¼Œåªç”¨æƒå€¼è¡°å‡å°±éš¾ä»¥åº”å¯¹äº†ã€‚åœ¨è¿™ç§æƒ… å†µä¸‹ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šä½¿ç”¨ Dropout æ–¹æ³•ã€‚ Dropout æ˜¯ä¸€ç§åœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­éšæœºåˆ é™¤ç¥ç»å…ƒçš„æ–¹æ³•ã€‚è®­ç»ƒæ—¶ï¼Œéšæœºé€‰å‡ºéšè—å±‚çš„ç¥ç»å…ƒï¼Œç„¶åå°†å…¶åˆ é™¤ã€‚è¢«åˆ é™¤çš„ç¥ç»å…ƒä¸å†è¿›è¡Œä¿¡å·çš„ä¼ é€’ã€‚ å¯ä»¥å°† Dropout ç†è§£ä¸ºï¼Œé€šè¿‡åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­éšæœºåˆ é™¤ç¥ç»å…ƒï¼Œä»è€Œæ¯ä¸€æ¬¡éƒ½è®©ä¸åŒçš„æ¨¡å‹è¿›è¡Œå­¦ä¹ ï¼Œè¿›è€Œè¾¾åˆ°é›†æˆå­¦ä¹ çš„æ•ˆæœã€‚ è¶…å‚æ•°çš„éªŒè¯ç¥ç»ç½‘ç»œä¸­ï¼Œé™¤äº†æƒé‡å’Œåç½®ç­‰å‚æ•°ï¼Œè¶…å‚æ•°ï¼ˆhyper-parameterï¼‰ä¹Ÿç»å¸¸å‡ºç°ã€‚è¶…å‚æ•°çš„å†³å®šè¿‡ç¨‹ä¸­å¸¸å¸¸ä¼´éšç€å¾ˆå¤šè¯•é”™ã€‚ å› æ­¤ï¼Œè°ƒæ•´è¶…å‚æ•°æ—¶ï¼Œå¿…é¡»ä½¿ç”¨è¶…å‚æ•°ä¸“ç”¨çš„ç¡®è®¤æ•°æ®ã€‚ç”¨äºè°ƒæ•´è¶…å‚æ•°çš„æ•°æ®ï¼Œä¸€èˆ¬ç§°ä¸ºéªŒè¯æ•°æ®ï¼ˆvalidation dataï¼‰ã€‚æˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªéªŒè¯æ•°æ®æ¥è¯„ä¼°è¶…å‚æ•°çš„å¥½åã€‚","categories":[{"name":"æ·±åº¦å­¦ä¹ ","slug":"æ·±åº¦å­¦ä¹ ","permalink":"http://yoursite.com/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"}],"tags":[{"name":"æ·±åº¦å­¦ä¹ ","slug":"æ·±åº¦å­¦ä¹ ","permalink":"http://yoursite.com/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"}]},{"title":"çˆ¶ä¸å­çš„ç¼–ç¨‹ä¹‹æ—…","slug":"Python/çˆ¶ä¸å­ç¼–ç¨‹ä¹‹æ—…","date":"2020-07-31T22:08:14.000Z","updated":"2020-08-04T14:29:36.111Z","comments":true,"path":"2020/08/01/Python/çˆ¶ä¸å­ç¼–ç¨‹ä¹‹æ—…/","link":"","permalink":"http://yoursite.com/2020/08/01/Python/%E7%88%B6%E4%B8%8E%E5%AD%90%E7%BC%96%E7%A8%8B%E4%B9%8B%E6%97%85/","excerpt":"ã€Šçˆ¶ä¸å­çš„ç¼–ç¨‹ä¹‹æ—…ï¼šä¸å°å¡ç‰¹ä¸€èµ·å­¦ Pythonã€‹ï¼šå¦‚ä½•ä½¿ç”¨ Python æ¥å‘Šè¯‰è®¡ç®—æœºè¦åšä»€ä¹ˆï¼Ÿ","text":"ã€Šçˆ¶ä¸å­çš„ç¼–ç¨‹ä¹‹æ—…ï¼šä¸å°å¡ç‰¹ä¸€èµ·å­¦ Pythonã€‹ï¼šå¦‚ä½•ä½¿ç”¨ Python æ¥å‘Šè¯‰è®¡ç®—æœºè¦åšä»€ä¹ˆï¼Ÿ åŸºç¡€çŸ¥è¯†ç‚¹æ–œæ ä¸åæ–œæ 1234567# Python 2print 3 / 2 # 1print 3.0 / 2 # 1.5# Python 3print 3 // 2 # 1printt 3 / 2 # 1.5 \\ è¡¨ç¤ºæœ¬è¡Œä»£ç è¿˜æœªç»“æŸï¼Œæ–°èµ·ä¸€è¡Œç»§ç»­ä»£ç ã€‚ æ¬¡æ–¹12print 3 * 3 * 3 * 3 * 3 # 243print 3 ** 5 # æŒ‡æ•° e è®°æ³•3.8E16 æˆ–è€… 3.8e16 ğŸ‘‰ 3.8Ã—1016ã€‚ 123c = 2.6e75d = 1.2e74print c + d # 2.72e+75 æ”¹å˜ç±»å‹Python å®é™…ä¸Šå¹¶æ²¡æœ‰æŠŠä¸€ä¸ªä¸œè¥¿ä»ä¸€ç§ç±»å‹â€œè½¬æ¢â€æˆå¦ä¸€ç§ç±»å‹ã€‚å®ƒåªæ˜¯ç”±åŸæ¥çš„ä¸œè¥¿åˆ›å»ºä¸€ä¸ªæ–°ä¸œè¥¿ï¼Œè€Œä¸”è¿™ä¸ªæ–°ä¸œè¥¿æ­£æ˜¯ä½ æƒ³è¦çš„ç±»å‹ã€‚ float()ã€int() å’Œ str() åé¢æœ‰å°æ‹¬å·ï¼Œå› ä¸ºå®ƒä»¬ä¸æ˜¯ Python å…³é”®å­—ï¼ˆå¦‚ printï¼‰â€”â€”å®ƒä»¬åªæ˜¯ Python çš„å†…ç½®å‡½æ•°ï¼ˆfunctionï¼‰ã€‚ type() å‡½æ•°æŸ¥çœ‹ç±»å‹ã€‚ è¾“å…¥è¾“å‡ºå­—ç¬¦ä¸²ç±»å‹raw_input() å‡½æ•°ä»ç”¨æˆ·é‚£é‡Œå¾—åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚æ­£å¸¸æƒ…å†µä¸‹ä¼šä»é”®ç›˜å¾—åˆ°è¿™ä¸ªè¾“å…¥ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç”¨æˆ·è¦é”®å…¥è¾“å…¥ã€‚åœ¨ Python 3 ä¸­ï¼Œraw_input() æ”¹åä¸º input()äº†ã€‚å®ƒä¸ Python 2 ä¸­çš„ raw_input() å®Œå…¨ä¸€æ ·ã€‚ 1234print \"Enter your name: \", # é€—å·è¡¨ç¤ºåœ¨åŒä¸€è¡Œé”®å…¥ç­”æ¡ˆsomeName = raw_input()# Enter your name: WarrensomeName = raw_input (\"Enter your name: \") åœ¨ Python 3 ä¸­ï¼Œé€šè¿‡åœ¨è¡Œå°¾æ·»åŠ é€—å·ä½¿å¾—æ‰“å°çš„å†…å®¹éƒ½åœ¨åŒä¸€è¡Œçš„æ–¹æ³•ä¸å†æœ‰æ•ˆã€‚è€Œä¸”ï¼Œåœ¨ Python 3 ä¸­ä½¿ç”¨ print() æ—¶ï¼Œè¦æ‰“å°çš„å†…å®¹å¿…é¡»è¢«åŒ…å«åœ¨ä¸€å¯¹æ‹¬å·ä¸­ã€‚ 12345# Python 3print( \"My\" , end=\" \")print( \"name\" , end=\" \")print( \"is\" , end=\" \")print( \"Dave.\" , end=\" \") æ•°å­—ç±»å‹12345temp_string = raw_input()float_type = float(temp_string)# æ›´ç®€ç»ƒçš„å†™æ³•float_type = float(raw_input())int_type = int(raw_input()) å¾—åˆ°æ•°å­—è¾“å…¥è¿˜æœ‰ä¸€ç§æ–¹æ³•ã€‚Python 2 æœ‰ä¸€ä¸ªåå« input() çš„å‡½æ•°ï¼Œå¯ä»¥ç›´æ¥æä¾›ä¸€ä¸ªæ•°ï¼Œæ‰€ä»¥ä¸å¿…ä½¿ç”¨ int() æˆ– float() æ¥è½¬æ¢ã€‚ æ³¨æ„ï¼ŒPython 3 ä¸­å»é™¤äº† input() å‡½æ•°ï¼ˆå¯ä»¥ç›´æ¥è·å–æ•°å­—è€Œä¸éœ€è¦è¿›è¡Œè½¬æ¢ï¼‰ï¼Œåªæœ‰ raw_input()ã€‚æ›´ä»¤äººæ„Ÿåˆ°æ··ä¹±çš„æ˜¯ï¼ŒPython 2 ä¸­çš„ raw_input() åœ¨ Python 3 ä¸­æ”¹åä¸º input()ï¼Œä½†åŠŸèƒ½ä¸å˜ï¼Œä»ç„¶åªä¼šå¾—åˆ°å­—ç¬¦ä¸²ã€‚å› ä¸ºæˆ‘ä»¬å¾ˆæ¸…æ¥šæ€æ ·ä»ä¸€ä¸ªå­—ç¬¦ä¸²åˆ›å»ºä¸€ä¸ªæ•°ï¼Œæ‰€ä»¥å»ºè®®ä½¿ç”¨ raw_input()ï¼Œè€Œä¸è¦ç”¨ Python 2 ä¸­çš„ input()ã€‚ ç½‘ç»œæ•°æ®1234import urllib2file = urllib2.urlopen('http://helloworldbook2.com/data/message.txt')message = file.read()print message æ¡ä»¶ä¸å¾ªç¯æ¡ä»¶1234567if condition01: # conditionA and / or conditionB result01elif condition02: # not conditionC result02# ...else resultN è®¡æ•°å¾ªç¯12345678for looper in [1, 2, 3, 4, 5]: # å¾ªç¯å€¼åˆ—è¡¨ï¼Œç­‰ä»·äº rang(1, 6) æ­¤å¤„çš„ looper ä¸ºå¾ªç¯å˜é‡å print looper# Python 2print range(1, 5) # [1, 2, 3, 4]# Python 3print range(1, 5) # range(1, 5)# range(5) ğŸ‘‰range(0, 5)# range(10, 0, -2) æŒ‰æ­¥é•¿è®¡æ•° åœ¨ Python 3 ä¸­ range() å‡½æ•°ä¸ä¼šæä¾›ä¸€ä¸ªæ•°å­—åˆ—è¡¨ï¼Œè€Œæ˜¯ä¼šæä¾›ä¸€ä¸ªâ€œå¯è¿­ä»£â€ï¼ˆiterableï¼‰çš„ä¸œè¥¿ï¼Œä½ å¯ä»¥ä½¿ç”¨å¾ªç¯æ¥éå†å®ƒã€‚å¦‚æœåœ¨ for å¾ªç¯ä¸­ä½¿ç”¨ range()ï¼Œåˆ™å…¶å·¥ä½œæ–¹å¼æ˜¯å®Œå…¨ä¸€æ ·çš„ï¼Œåªæ˜¯å†…éƒ¨æœºåˆ¶ç•¥æœ‰ä¸åŒè€Œå·²ã€‚ 12for letter in \"Hi there\": # ç¬¦ä¸²å°±åƒä¸€ä¸ªå­—ç¬¦åˆ—è¡¨ print letter æ¡ä»¶å¾ªç¯12while someInput == 3: print \"This is a 3\" åˆ—è¡¨æœ‰æ—¶å€™å¯ä»¥æŠŠä¸€å †ä¸œè¥¿å­˜å‚¨åœ¨ä¸€èµ·ï¼Œæ”¾åœ¨æŸç§â€œç»„â€æˆ–è€…â€œé›†åˆâ€ä¸­ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå°±å¯ä»¥ä¸€æ¬¡å¯¹æ•´ä¸ªé›†åˆåšæŸäº›å¤„ç†ï¼Œä¹Ÿèƒ½æ›´å®¹æ˜“åœ°è®°å½•ä¸€ç»„ä¸œè¥¿ã€‚æœ‰ä¸€ç±»é›†åˆå«åšåˆ—è¡¨ï¼ˆlistï¼‰ï¼Œå¦ä¸€ç±»å«åšå­—å…¸ï¼ˆdictionaryï¼‰ã€‚ åˆ—è¡¨æ·»åŠ 1234567family = ['Mom', 'Dad', 'Junior', 'Baby'] # åˆ—è¡¨family.append('Cat') # å‘åˆ—è¡¨æœ«å°¾æ·»åŠ ä¸€ä¸ªå…ƒç´ print family[0] # Mom ä»åˆ—è¡¨è·å–å…ƒç´ print family[1:3] # ['Dad', 'Junior', 'Baby'] åˆ†ç‰‡ ğŸ‘‰ åˆ—è¡¨print family[:3] # ['Mom', 'Dad', 'Junior', 'Baby']print family[1:] # ['Dad', 'Junior', 'Baby', 'Cat']family.insert(2, 'Dog') # å‘åˆ—è¡¨æ·»åŠ å…ƒç´  ['Mom', 'Dad', 'Dog', Junior', 'Baby', 'Cat'] åˆ—è¡¨å¯ä»¥åŒ…å« Python èƒ½å­˜å‚¨çš„ä»»ä½•ç±»å‹çš„æ•°æ®ï¼Œè¿™åŒ…æ‹¬æ•°å­—ã€å­—ç¬¦ä¸²ã€å¯¹è±¡ï¼Œç”šè‡³å¯ä»¥åŒ…å«å…¶ä»–åˆ—è¡¨ã€‚å¹¶ä¸è¦æ±‚åˆ—è¡¨ä¸­çš„å…ƒç´ æ˜¯åŒç§ç±»å‹æˆ–åŒä¸€ç§ä¸œè¥¿ã€‚ 123letters = ['a', 'b', 'c', 'd', 'e']letters.append(['f', 'g', 'h']) # ['a', 'b', 'c', 'd', 'e', ['f', 'g', 'h']]letters.extend(['f', 'g', 'h']) # ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h'] åˆ—è¡¨åˆ é™¤123456letters = ['a', 'b', 'c', 'd', 'e']letters.remove('c') # æ— éœ€çŸ¥é“å…ƒç´ çš„å…·ä½“ä½ç½®del letters[2] # å…è®¸é€šè¿‡ç´¢å¼•åˆ é™¤å…ƒç´ del pop[2] # å…è®¸é€šè¿‡ç´¢å¼•åˆ é™¤å…ƒç´  pop() é»˜è®¤å¼¹å‡ºåˆ—è¡¨æœ€åä¸€ä¸ªå…ƒç´ print letters # ['a', 'b', 'd', 'e']letters = ['a', 'b', 'c', 'd', 'e'] åˆ—è¡¨æŸ¥æ‰¾1234if 'a' in letters: print \"found 'a' in letters\"else: print \"didn't find 'a' in letters\" åˆ—è¡¨æ’åº12345678letters = ['d', 'a', 'e', 'c', 'b']print letters # ['d', 'a', 'e', 'c', 'b']letters.sort() # æ”¹å˜åŸå§‹åˆ—è¡¨ï¼Œè€Œä¸æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„æœ‰åºåˆ—è¡¨ï¼Œæ­£åºï¼Œå¯ç”¨åˆ†ç‰‡ [:] åˆ›å»ºå‰¯æœ¬# new_list = original_list è¿™ç§å†™æ³•æ˜¯æ— æ³•åˆ›å»ºå‰¯æœ¬çš„ï¼Œåªæ˜¯ç»™åŸåˆ—è¡¨åŠ å¤šäº†ä¸€ä¸ªæ ‡ç­¾# print letters.sort() ä¸ºé”™è¯¯ç”¨æ³•ï¼šNoneprint letters # ['a', 'b', 'c', 'd', 'e']letters.reverse() # é€†åº letters.sort (reverse = True)print letters # ['e', 'd', 'c', 'b', 'a'] å…ƒç»„å…ƒç»„ï¼ˆtupleï¼‰å±äºä¸å¯æ”¹å˜çš„åˆ—è¡¨ã€‚ 1my_tuple = (\"red\", \"green\", \"blue\") æ•°æ®è¡¨æ•°æ®è¡¨æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªåŒé‡åˆ—è¡¨ã€‚ 12classMarks = [ [55,63,77,81], [65,61,67,72], [97,95,92,88] ]print classMarks[0][2] # 77 å­—å…¸Python å­—å…¸ï¼ˆdictionaryï¼‰æ˜¯ä¸€ç§å°†ä¸¤ä¸ªä¸œè¥¿å…³è”åœ¨ä¸€èµ·çš„æ–¹å¼ã€‚è¢«å…³è”åœ¨ä¸€èµ·çš„ä¸¤ä¸ªä¸œè¥¿åˆ†åˆ«ç§°ä¸ºé”®ï¼ˆkeyï¼‰å’Œå€¼ï¼ˆvalueï¼‰ã€‚å­—å…¸ä¸­çš„æ¯ä¸ªé¡¹ï¼ˆitemï¼‰æˆ–æ¡ç›®ï¼ˆentryï¼‰éƒ½æœ‰ä¸€ä¸ªé”®å’Œä¸€ä¸ªå€¼ï¼Œå®ƒä»¬åˆèµ·æ¥è¢«ç§°ä¸ºé”®å€¼å¯¹ï¼ˆkey-value pairï¼‰ã€‚ä¸€ä¸ªå­—å…¸å°±æ˜¯ä¸€äº›é”®å€¼å¯¹çš„é›†åˆã€‚ 123456789phoneNumbers = &#123;&#125;phoneNumbers[\"John\"] = \"555-1234\" # æ–¹å¼ä¸€phoneNumbers = &#123;\"John\": \"555-1234\"&#125; # æ–¹å¼äºŒprint phoneNumbers[\"John\"] # '555-1234' åˆ—è¡¨é€šè¿‡ç¼©ç´¢å¼•è®¿é—®ï¼Œå­—å…¸é€šè¿‡é”®å€¼è®¿é—®phoneNumbers.keys() # åˆ—å‡ºæ‰€æœ‰é”®ï¼Œè¿”å›ä¸€ä¸ªåˆ—è¡¨phoneNumbers.values() # åˆ—å‡ºæ‰€æœ‰å€¼ï¼Œè¿”å›ä¸€ä¸ªåˆ—è¡¨del phoneNumbers[\"John\"] # åˆ é™¤æ¡ç›®phoneNumbers.clear() # æ¸…ç©ºæ¡ç›®\"Bob\" in phoneNumbers # False ç¡®è®¤é”®å€¼æ˜¯å¦å­˜åœ¨ å’Œåˆ—è¡¨ä¸€æ ·ï¼Œå­—å…¸ä¸­çš„æ¡ç›®ä¹Ÿå¯ä»¥æ˜¯ä»»æ„ç±»å‹ï¼ŒåŒ…æ‹¬ç®€å•ç±»å‹ï¼ˆæ•´æ•°ã€æµ®ç‚¹æ•°ã€å­—ç¬¦ä¸²ï¼‰å’Œé›†åˆï¼ˆåˆ—è¡¨ã€å­—å…¸ï¼‰ä»¥åŠå¤åˆç±»å‹ï¼ˆå¯¹è±¡ï¼‰ã€‚ä½†äº‹å®ä¸Šï¼Œè¿™å¥è¯å¹¶ä¸å®Œå…¨å¯¹ã€‚å­—å…¸çš„é”®åªå¯ä»¥ä½¿ç”¨ä¸å¯å˜ç±»å‹ï¼ˆå¸ƒå°”ã€æ•´æ•°ã€æµ®ç‚¹æ•°ã€å­—ç¬¦ä¸²å’Œå…ƒç»„ï¼‰ã€‚ä½ ä¸èƒ½ä½¿ç”¨ä¸€ä¸ªåˆ—è¡¨æˆ–è€…å­—å…¸æ¥å½“ä½œé”®ï¼Œå› ä¸ºå®ƒä»¬æ˜¯å¯å˜ç±»å‹ã€‚ å­—å…¸å’Œåˆ—è¡¨æœ‰ä¸€ä¸ªä¸åŒä¹‹å¤„ï¼Œå°±æ˜¯å­—å…¸æ˜¯æ— åºçš„ã€‚ä½†è®©å­—å…¸æœ‰åºè¾“å‡ºè¿˜æ˜¯å¯ä»¥çš„ã€‚ 12for key in sorted(phoneNumbers.keys()): print key, phoneNumbers[key] é«˜çº§éƒ¨åˆ†å‡½æ•°æœ€ç®€å•åœ°è®²ï¼Œå‡½æ•°å°±æ˜¯å¯ä»¥å®ŒæˆæŸä¸ªå·¥ä½œçš„ä»£ç å—ã€‚è¿™æ˜¯å¯ä»¥ç”¨æ¥æ„å»ºæ›´å¤§ç¨‹åºçš„ä¸€ä¸ªå°éƒ¨åˆ†ã€‚å¯ä»¥æŠŠè¿™ä¸ªå°éƒ¨åˆ†ä¸å…¶ä»–éƒ¨åˆ†æ”¾åœ¨ä¸€èµ·ï¼Œå°±åƒç”¨ç§¯æœ¨æ­æˆ¿å­ä¸€æ ·ã€‚ 1234567def printMyAddress(myName, myPhoneNum): # åˆ›å»ºæˆ–å®šä¹‰å‡½æ•°è¦ä½¿ç”¨ Python çš„ def å…³é”®å­— print myName print myPhoneNum print \"123 Main Street\" printprintMyAddress(\"wingo\", \"0123456789\") # å‡½æ•°è°ƒç”¨print \"Done the function\" è™½ç„¶å¯ä»¥å‘å‡½æ•°ä¼ æ¯’ N ä¸ªå‡½æ•°ï¼Œä½†æ˜¯å¦‚æœä½ çš„å‡½æ•°æœ‰è¶…è¿‡ 5 åˆ° 6 ä¸ªå‚æ•°ï¼Œå¯èƒ½å°±åº”è¯¥è€ƒè™‘é‡‡ç”¨åˆ«çš„åšæ³•äº†ã€‚ä¸€ç§åšæ³•æ˜¯æŠŠæ‰€æœ‰å‚æ•°æ”¶é›†åˆ°ä¸€ä¸ªåˆ—è¡¨ä¸­ï¼Œç„¶åæŠŠè¿™ä¸ªåˆ—è¡¨ä¼ é€’åˆ°å‡½æ•°ã€‚è¿™æ ·ä¸€æ¥ï¼Œå°±åªæ˜¯ä¼ é€’ä¸€ä¸ªå˜é‡ï¼ˆåˆ—è¡¨å˜é‡ï¼‰ï¼Œåªä¸è¿‡å…¶ä¸­åŒ…å«æœ‰ä¸€ç»„å€¼ã€‚è¿™æ ·å¯ä»¥è®©ä½ çš„ä»£ç æ›´æ˜“è¯»ã€‚ 1234def calculateTax(price, tax_rate): taxTotal = price + (price * tax_rate) return taxTotal # è¿”å›å€¼totalPrice = calculateTax(7.99, 0.06) # å‡½æ•°è°ƒç”¨ï¼Œè¿”å›å€¼æ¥æ”¶ å…¨å±€å˜é‡ä¸å±€éƒ¨å˜é‡ï¼šè‹¥è¯•å›¾åœ¨å‡½æ•°å†…éƒ¨æ”¹å˜å…¨å±€å˜é‡ï¼Œä½ ä¼šå¾—åˆ°ä¸€ä¸ªæ–°çš„å±€éƒ¨å˜é‡ï¼Œå…¨å±€å˜é‡å¹¶ä¸ä¼šè¢«æ”¹å˜ã€‚è‹¥è¦åœ¨å‡½æ•°å†…éƒ¨å¼ºåˆ¶ä½¿ç”¨å…¨å±€å˜é‡ï¼Œå¯ä»¥ä½¿ç”¨ global å…³é”®å­—ã€‚ 12def calculateTax(price, tax rate): global my_price # å‘Šè¯‰ Python ä½ æƒ³ä½¿ç”¨å…¨å±€ç‰ˆæœ¬çš„ my_price å¯¹è±¡åœ¨ Python ä¸­ï¼Œä¸€ä¸ªå¯¹è±¡çš„ç‰¹å¾ç§°ä¸ºå±æ€§ï¼ˆattributeï¼‰ï¼ŒåŠ¨ä½œç§°ä¸ºæ–¹æ³•ï¼ˆmethodï¼‰ã€‚ å¯¹è±¡ = å±æ€§ + æ–¹æ³• 12345class Ball: # å‘Šè¯‰ Python å»ºç«‹ä¸€ä¸ªç±» def bounce(self): # å®šä¹‰ä¸€ä¸ªæ–¹æ³• if self.direction = \"down\": self.direction = \"up\" ä»¥ä¸Šçš„ä»£ç æ˜¯ä¸€ä¸ªçƒçš„ç±»å®šä¹‰ï¼Œå…¶ä¸­åªæœ‰ä¸€ä¸ªæ–¹æ³• bounce()ã€‚ä¸è¿‡ï¼Œå±æ€§å‘¢ï¼Ÿå—¯ï¼Œå±æ€§å¹¶ä¸å±äºç±»ï¼Œå®ƒä»¬å±äºå„ä¸ªå®ä¾‹ã€‚å› ä¸ºæ¯ä¸ªå®ä¾‹å¯ä»¥æœ‰ä¸åŒçš„å±æ€§ï¼ˆå¯ä»¥ç”¨åˆå§‹åŒ–æ–¹æ³•è®¾ç½®ï¼‰ã€‚ 12345myBall = Ball() # åˆ›å»ºä¸€ä¸ªå®ä¾‹å¯¹è±¡myBall.direction = \"down\"myBall.color = \"green\"myBall.size = \"small\" åˆå§‹åŒ–åˆ›å»ºç±»å®šä¹‰æ—¶ï¼Œå¯ä»¥å®šä¹‰ä¸€ä¸ªç‰¹å®šçš„æ–¹æ³•ï¼Œåä¸º __init__()ï¼Œåªè¦åˆ›å»ºè¿™ä¸ªç±»çš„ä¸€ä¸ªæ–°å®ä¾‹ï¼Œå°±ä¼šè¿è¡Œè¿™ä¸ªæ–¹æ³•ã€‚å¯ä»¥å‘ __init__() æ–¹æ³•ä¼ é€’å‚æ•°ï¼Œè¿™æ ·åˆ›å»ºå®ä¾‹æ—¶å°±ä¼šæŠŠå±æ€§è®¾ç½®ä¸ºä½ å¸Œæœ›çš„å€¼ã€‚ 12345678910class Ball: def __init__ (self, color, size, direction) # åˆ›å»ºå¯¹è±¡æ—¶çš„åˆå§‹åŒ–æ–¹æ³• self.color = color self.size = size self.direction = direction def bounce(self): if self.direction = \"down\": self.direction = \"up\" é­”æ³•æ–¹æ³•Python ä¸­çš„å¯¹è±¡æœ‰ä¸€äº›â€œé­”æ³•â€æ–¹æ³•ï¼Œå½“ç„¶å®ƒä»¬å¹¶ä¸æ˜¯çœŸçš„æœ‰é­”æ³•ï¼è¿™äº›åªæ˜¯åœ¨ä½ åˆ›å»ºç±»æ—¶ Python è‡ªåŠ¨åŒ…å«çš„ä¸€äº›æ–¹æ³•ã€‚Python ç¨‹åºå‘˜é€šå¸¸æŠŠå®ƒä»¬å«åšç‰¹æ®Šæ–¹æ³•ï¼ˆspecial methodï¼‰ã€‚ 12345678910class Ball: def __init__ (self, color, size, direction) # åˆ›å»ºå¯¹è±¡æ—¶çš„åˆå§‹åŒ–æ–¹æ³• é­”æ³•æ–¹æ³• self.color = color self.size = size self.direction = direction def __str__ (self): # è‡ªå®šä¹‰ print myBall çš„å…·ä½“è¾“å‡ºå†…å®¹ msg =\"Hi, I'm a \" self.size + \" \" + self.color + \" ball!\" return msg å¤šæ€å’Œç»§æ‰¿å¤šæ€ï¼šåŒä¸€ä¸ªæ–¹æ³•çš„ä¸åŒè¡Œä¸ºã€‚ ç»§æ‰¿ï¼šå‘çˆ¶ç±»å­¦ä¹ ã€‚ å¯ä»¥ä½¿ç”¨ pass å…³é”®å­—ä½œä¸ºä¸€ä¸ªå ä½ç¬¦å»ºç«‹ä¸€ä¸ªä»£ç æ¡©ï¼Œä½¿å¾…å®šä¹‰çš„æ–¹æ³•èƒ½å¤Ÿé€šè¿‡æµ‹è¯•ã€‚ æ¨¡å—å¯ä»¥è¢«ä¸åŒçš„ç¨‹åºä½¿ç”¨ï¼Œæå–ä¸€äº›é€šç”¨çš„åŠŸèƒ½ä¾¿äºä½¿ç”¨ã€‚ 12345678910## å®šä¹‰æ¨¡å—# this is the file \"my_module.py\"# we're going to use it in another programdef c_to_f(celsius): fahrenheit = celsius * 9.0 / 5 + 32 return fahrenheit## å¼•å…¥æ¨¡å—ä½¿ç”¨import my_modulefahrenheit c_to_f(celsius) # my_module.c_to_f(celsius) æ ‡å‡†æ¨¡å—Python æä¾›äº†å¤§é‡æ ‡å‡†æ¨¡å—ï¼Œå¯ä»¥ç”¨æ¥å®Œæˆå¾ˆå¤šå·¥ä½œï¼Œæ¯”å¦‚æŸ¥æ‰¾æ–‡ä»¶ã€æŠ¥æ—¶ï¼ˆæˆ–è®¡æ—¶ï¼‰ã€ç”Ÿæˆéšæœºæ•°ï¼Œä»¥åŠå¾ˆå¤šå…¶ä»–åŠŸèƒ½ã€‚è¿™ç§°ä¸º Python æ ‡å‡†åº“ã€‚ 123456789import time time.sleep(2)sleep(2) # æŠ¥é”™## ç¡çœ from time import sleep # å‘½åç©ºé—´sleep(2)## éšæœºæ•°import randomprint random.randint(0, 100) # 4 æ‰“å°æ ¼å¼åŒ–12345678910111213141516171819202122## æ¢è¡Œç¬¦ \\nprint \"Hello \\nWorld\" # python# Hello## World## åˆ¶è¡¨ç¬¦ \\t ï¼šæ¯ 8 ä¸ªå­—ç¬¦ä¹‹åæœ‰ä¸€ä¸ªåˆ¶è¡¨ç‚¹ï¼ˆtab stopï¼‰ã€‚ä»ä¸‹ä¸€ä¸ªåˆ¶è¡¨ç‚¹å¼€å§‹print 'ABC\\tXYZ' # ABC XYZ## è½¬ä¹‰å­—ç¬¦ \\print 'hi\\\\there' # hi\\there## åœ¨å­—ç¬¦ä¸²ä¸­æ’å…¥å˜é‡name = 'Warren Sande'print 'My name is %s and I wrote this book' % name # %sã€%f å’Œ %i éƒ½ç§°ä¸ºæ ¼å¼å­—ç¬¦ä¸²# %.2f æµ®ç‚¹æ•°å››èˆäº”å…¥åˆ°ä¸¤ä½å°æ•°number = -98.76print '% .2f' % number # æ­¤å¤„çš„æ ¼å¼ä¸ºæ•°å­—å‰ç©ºä¸€æ ¼ï¼Œæ–¹ä¾¿æ­£è´Ÿæ•°å¯¹é½ -98.76# %e æ ¼å¼å­—ç¬¦ä¸²æ‰“å° E è®°æ³•ã€‚å®ƒæ€»æ˜¯æ‰“å° 6 ä½å°æ•°ï¼Œé™¤éä½ å¦ä½œè¦æ±‚ã€‚print '%.8e' % number # 1.23456000e+01 ä¿ç•™å…«ä½ï¼Œä¸è¶³çš„ç”¨ 0 å¡«å……# Python è‡ªåŠ¨é€‰æ‹©æµ®ç‚¹æ•°è®°æ³•æˆ– E è®°æ³•ï¼Œå¯ä»¥ä½¿ç”¨ %g æ ¼å¼å­—ç¬¦ä¸²# å½“æœ‰æ ¼å¼å­—ç¬¦ä¸²æ—¶ï¼Œæ‰“å° % ä½¿ç”¨ %% è½¬ä¹‰# å¤šä¸ªæ ¼å¼å­—ç¬¦ä¸²print 'I got %.1f in math and %.1f in science' % (math, science)print 'I got &#123;0:.1f&#125; in math, &#123;1:.1f&#125; in science'.format(math, science) # 2.6 ä»¥åçš„æ–°æ–¹æ³• å­—ç¬¦ä¸²åˆ†è§£å­—ç¬¦ä¸²123name_string = 'Sam,Brad,Alex,Cameron,Toby,Gwen,Jenn,Connor'names = name_string.split(',') # æ ¹æ®éœ€è¦å¡«å†™åˆ†è§£æ ‡è®°# ['Sam','Brad','Alex','Cameron','Toby','Gwen','Jenn','Connor'] è”æ¥å­—ç¬¦ä¸²12word_list = ['My', 'name', 'is', 'Warren']long_string = ' '.join(word_list) # 'My name is Warren' æœç´¢å­—ç¬¦ä¸²12345678# startwithif name.startswith(\"Frank\"): print \"Can I call you Frank?\"# inaddr1 = '657 Maple Lane'if 'Maple' in addr: position = addr.index('Maple') # è·å–ç´¢å¼• 4 print \"found 'Maple' at index\", position åˆ é™¤éƒ¨åˆ†å­—ç¬¦ä¸²123name = 'Warren Sande'short_name = name.strip('de') # å¦‚æœæ²¡æœ‰å‘Šè¯‰ strip() è¦å‰¥é™¤å“ªä¸€éƒ¨åˆ†ï¼Œå®ƒå°±ä¼šå»é™¤æ‰€æœ‰ç©ºç™½ç¬¦short_name # 'Warren San' æ”¹å˜å¤§å°å†™123stringA = \"Hello\"stringB = stringA.lower() # hellostringC = stringA.upper() # HELLO æ–‡ä»¶æ“ä½œè¯»12345678## è¯»æ–‡æœ¬æ–‡ä»¶my_file = open('notes.txt', 'r')lines = my_file.readline() # æŒ‰è¡Œè¯»å–ï¼Œå¹¶è®°ä½ç›®å‰åœ¨ä»€ä¹ˆä½ç½®my_file.seek(0) # å›åˆ°ç¬¬ 0 è¡Œlines = my_file.readlines() # è¯»å–æ‰€æœ‰è¡Œmy_file.close() # å¤„ç†å®Œæ–‡ä»¶ä¸€å®šè¦å…³é—­ï¼Œå¦åˆ™æ­¤æ–‡ä»¶å°†ä¸€ç›´è¢«å ç”¨## è¯»å–äºŒè¿›åˆ¶æ–‡ä»¶my_music_file = open('bg_music.mp3', 'rb') # ä¸ºæ–‡ä»¶æ¨¡å¼å¢åŠ ä¸€ä¸ª b æ¥æ‰“å¼€äºŒè¿›åˆ¶æ–‡ä»¶ å†™1234567891011## å†™æ–‡ä»¶ï¼šè¿½åŠ æ¨¡å¼new_file = open(\"my_new_notes.txt\", 'a')new_file.write(\"Eat supper\\n\")# å†™æ–‡ä»¶ï¼šæ›¿æ¢æ¨¡å¼new_file = open(\"my_new_notes.txt\", 'w')new_file.write(\"Eat supper\\n\")new_file.close()# ä½¿ç”¨ print å†™æ–‡ä»¶my_file = open(\"new_file.txt\", 'w')print &gt;&gt; my_file, \"Hello there, neighbor!\"my_file.close() ä¿å­˜12345678910import picklemy_list = ['Fred', 73, 'Hello there', 81.9876e-13]pickle_file = open('my_pickled_list.pk', 'w')pickle.dump(my_list, pickle_file) # ç”¨ dump() æŠŠåˆ—è¡¨â€œå€’â€åœ¨ pickle æ–‡ä»¶ä¸­pickle_file.close()## è¿˜åŸpickle_file = open('my_pickled_list.pk', 'r')recovered_list = pickle.load(pickle_file) # ['Fred', 73, 'Hello there', 8.1987599999999997e-012]pickle_file.close()","categories":[{"name":"Python","slug":"Python","permalink":"http://yoursite.com/categories/Python/"}],"tags":[{"name":"åŸºç¡€","slug":"åŸºç¡€","permalink":"http://yoursite.com/tags/%E5%9F%BA%E7%A1%80/"}]},{"title":"Spring å®æˆ˜å­¦ä¹ ç¬”è®°","slug":"åå°æŠ€æœ¯/Spring å®æˆ˜å­¦ä¹ ç¬”è®°","date":"2020-05-20T07:12:26.000Z","updated":"2020-07-10T04:07:13.921Z","comments":true,"path":"2020/05/20/åå°æŠ€æœ¯/Spring å®æˆ˜å­¦ä¹ ç¬”è®°/","link":"","permalink":"http://yoursite.com/2020/05/20/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/Spring%20%E5%AE%9E%E6%88%98%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/","excerpt":"ã€ŠSpring å®æˆ˜ã€‹é˜…è¯»ç¬”è®°ã€‚","text":"ã€ŠSpring å®æˆ˜ã€‹é˜…è¯»ç¬”è®°ã€‚ bean çš„è£…é…åœ¨ XML ä¸­è¿›è¡Œæ˜¾å¼é…ç½®ï¼›åœ¨ Java ä¸­è¿›è¡Œæ˜¾å¼é…ç½®ï¼›éšå¼çš„ bean å‘ç°æœºåˆ¶å’Œè‡ªåŠ¨è£…é…ã€‚ è‡ªåŠ¨åŒ–è£…é… beanç»„ä»¶æ‰«æ component scanningSpring ä¼šè‡ªåŠ¨å‘ç°åº”ç”¨ä¸Šä¸‹æ–‡ä¸­æ‰€åˆ›å»ºçš„ beanï¼›è‡ªåŠ¨è£…é… autowiringSpring è‡ªåŠ¨æ»¡è¶³ bean ä¹‹é—´çš„ä¾èµ–ã€‚ @Component @Namedæ³¨è§£è¡¨æ˜è¯¥ç±»ä¼šä½œä¸ºç»„ä»¶ç±»å¹¶å‘ŠçŸ¥ Spring è¦ä¸ºè¿™ä¸ªç±»åˆ›å»º beanã€‚ @ComponentSacn(basePackages={...}) &lt;context:component-scan base-package=&quot;...&quot; /&gt;æ³¨è§£å¯åŠ¨äº†ç»„ä»¶æ‰«æã€‚ @Configuration æ³¨è§£è¡¨æ˜è¿™ä¸ªç±»æ˜¯ä¸€ä¸ªé…ç½®ç±»ï¼Œè¯¥ç±»åº”è¯¥åŒ…å«å¦‚ä½•åœ¨ Spring åº”ç”¨ä¸Šä¸‹æ–‡ä¸­åˆ›å»º bean çš„ç»†èŠ‚ã€‚ 1234@Configuration@ComponentScan // é»˜è®¤æ‰«æåŒåŒ…ç±»ï¼Œå¯æŒ‡å®š public class MyConfig &#123;&#125; @Autowired(required=&quot;T/F&quot;) @Injectæ³¨è§£å®ç°è‡ªåŠ¨è£…é…ã€‚ï¼ˆåœ¨ Spring åº”ç”¨ä¸Šä¸‹æ–‡ä¸­å¯»æ‰¾åŒ¹é…æŸä¸ª bean éœ€æ±‚çš„å…¶ä»– beanï¼‰ å¯ä»¥ç”¨åœ¨ç±»çš„ä»»ä½•æ–¹æ³•ä¸Šï¼Œä¸ç®¡æ˜¯æ„é€ å™¨ã€Setter æ–¹æ³•è¿˜æ˜¯å…¶ä»–çš„æ–¹æ³• Spring éƒ½ä¼šå°è¯•æ»¡è¶³æ–¹æ³•å‚æ•°ä¸Šæ‰€å£°æ˜çš„ä¾èµ–ã€‚å‡å¦‚æœ‰ä¸”åªæœ‰ä¸€ä¸ª bean åŒ¹é…ä¾èµ–éœ€æ±‚çš„è¯é‚£ä¹ˆè¿™ä¸ª bean å°†ä¼šè¢«è£…é…è¿›æ¥ã€‚å¦‚æœæ²¡æœ‰åŒ¹é…çš„ bean é‚£ä¹ˆåœ¨åº”ç”¨ä¸Šä¸‹æ–‡åˆ›å»ºçš„æ—¶å€™ Spring ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚ä¸ºäº†é¿å…å¼‚å¸¸çš„å‡ºç°ä½ å¯ä»¥å°†@Autowiredçš„requiredå±æ€§è®¾ç½®ä¸ºfalseã€‚å¦‚æœæœ‰å¤šä¸ªbeanéƒ½èƒ½æ»¡è¶³ä¾èµ–å…³ç³»çš„è¯Springå°†ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸è¡¨æ˜æ²¡æœ‰æ˜ç¡®æŒ‡å®šè¦é€‰æ‹©å“ªä¸ªbeanè¿›è¡Œè‡ªåŠ¨è£…é…ã€‚ @Beanæ³¨è§£ä¼šå‘Šè¯‰ Spring è¿™ä¸ªæ–¹æ³•å°†ä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡è¯¥å¯¹è±¡è¦æ³¨å†Œä¸º Spring åº”ç”¨ä¸Šä¸‹æ–‡ä¸­çš„ beanã€‚æ–¹æ³•ä½“ä¸­åŒ…å«äº†æœ€ç»ˆäº§ç”Ÿ bean å®ä¾‹çš„é€»è¾‘ã€‚ XML è£…é… bean å¯¹å¼ºä¾èµ–ä½¿ç”¨æ„é€ å™¨æ³¨å…¥è€Œå¯¹å¯é€‰æ€§çš„ä¾èµ–ä½¿ç”¨å±æ€§æ³¨å…¥ã€‚ 12345678910111213141516171819202122232425262728293031&lt;bean id=\"\" class=\"\"&gt; &lt;!-- æ„é€ å™¨æ³¨å…¥ --&gt; &lt;constructor-arg ref=\"...\" /&gt; &lt;!-- æ„é€ å™¨å‚æ•°å --&gt; &lt;c:[name]-ref=\"...\" /&gt; &lt;!-- å‚æ•°ç´¢å¼• --&gt; &lt;c:_0-ref=\"...\" /&gt; &lt;!-- åªæœ‰ä¸€ä¸ªç´¢å¼•çš„çœç•¥å½¢å¼ --&gt; &lt;c:_-ref=\"...\" /&gt; &lt;!-- å­—é¢é‡è£…é… --&gt; &lt;constructor-arg value=\"...\" /&gt; &lt;c:_[name]=\"...\" /&gt; &lt;c:_0=\"...\" /&gt; &lt;c:_=\"...\" /&gt; &lt;!-- list / set --&gt; &lt;constructor-arg&gt; &lt;list&gt; &lt;ref bean=\"\" /&gt; &lt;value&gt;\"...\"&lt;/value&gt; &lt;/list&gt; &lt;/constructor-arg&gt; &lt;!-- å±æ€§æ³¨å…¥ï¼ˆç”¨æ³•åŒä¸Šï¼‰ --&gt; &lt;property name=\"...\" ref=\"...\" /&gt; &lt;!-- å±æ€§å --&gt; &lt;p:[name]-ref=\"...\" /&gt;&lt;/bean&gt;&lt;!-- util å‘½åç©ºé—´ --&gt;&lt;util:list id=\"...\"&gt; &lt;value&gt;\"...\"&lt;/value&gt;&lt;/util:list&gt; é…ç½®çš„å¼•ç”¨@ComponentScan &lt;context:component-scan&gt; @Import({MyConfig.class, ...}) &lt;bean class=&quot;MyConfig.class&quot; /&gt; @ImportResource(â€œclasspath:my-config.xmlâ€) &lt;import resource=&quot;my-config.xml&quot; /&gt; å¤„ç†æ­§ä¹‰æ€§å°†å¯é€‰ bean ä¸­çš„æŸä¸€ä¸ªè®¾ä¸ºé¦–é€‰ primary çš„ bean æˆ–è€…ä½¿ç”¨é™å®šç¬¦ qualifier æ¥å¸®åŠ© Spring å°†å¯é€‰çš„ bean çš„èŒƒå›´ç¼©å°åˆ°åªæœ‰ä¸€ä¸ª beanã€‚ @Primary &lt;bean id=&quot;...&quot; class=&quot;...&quot; primary=&quot;true&quot; /&gt;æ³¨è§£å£°æ˜ä¸ºé¦–é€‰çš„ beanã€‚ @Qualifier(&quot;[Name]&quot;)æ³¨è§£ä¸@Autowiredå’Œ@InjectååŒä½¿ç”¨åœ¨æ³¨å…¥çš„æ—¶å€™æŒ‡å®šæƒ³è¦æ³¨å…¥è¿›å»çš„æ˜¯å“ªä¸ª beanã€‚æ³¨è§£ä¸@Componentå’Œ@BeanååŒä½¿ç”¨åˆ›å»ºè‡ªå®šä¹‰é™å®šç¬¦ã€‚ bean çš„ id å‘ç”Ÿæ”¹å˜åˆ™è£…é…å¤±è´¥ï¼Ÿåˆ›å»ºè‡ªå®šä¹‰é™å®šç¬¦å¯ä»¥è§£å†³æ­¤é—®é¢˜ã€‚ å¯ä»¥åˆ›å»ºè‡ªå®šä¹‰çš„é™å®šç¬¦æ³¨è§£ï¼Œè§£å†³ Java ä¸å…è®¸åœ¨åŒä¸€ä¸ªæ¡ç›®ä¸Šé‡å¤å‡ºç°ç›¸åŒç±»å‹çš„å¤šä¸ªæ³¨è§£çš„è§„åˆ™ã€‚ 1234@Target(&#123;ElementType.CONSTRUCTOR, ElementType.FIELD, ElementType.METHOD, ElementType.TYPE&#125;)@Retention(RetentionPolicy.RUNTIME)@Qualifierpublic @interface Wingo &#123;&#125; bean çš„ä½œç”¨åŸŸåœ¨é»˜è®¤æƒ…å†µä¸‹ Spring åº”ç”¨ä¸Šä¸‹æ–‡ä¸­æ‰€æœ‰ bean éƒ½æ˜¯ä½œä¸ºä»¥å•ä¾‹ singleton çš„å½¢å¼åˆ›å»ºçš„ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸ç®¡ç»™å®šçš„ä¸€ä¸ª bean è¢«æ³¨å…¥åˆ°å…¶ä»– bean å¤šå°‘æ¬¡æ¯æ¬¡æ‰€æ³¨å…¥çš„éƒ½æ˜¯åŒä¸€ä¸ªå®ä¾‹ã€‚ å•ä¾‹ Singleton åœ¨æ•´ä¸ªåº”ç”¨ä¸­åªåˆ›å»º bean çš„ä¸€ä¸ªå®ä¾‹ï¼› åŸå‹ Prototype æ¯æ¬¡æ³¨å…¥æˆ–è€…é€šè¿‡ Spring åº”ç”¨ä¸Šä¸‹æ–‡è·å–çš„æ—¶å€™éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ bean å®ä¾‹ï¼› ä¼šè¯ Session åœ¨ Web åº”ç”¨ä¸­ä¸ºæ¯ä¸ªä¼šè¯åˆ›å»ºä¸€ä¸ª bean å®ä¾‹ï¼› è¯·æ±‚ Rquest åœ¨ Web åº”ç”¨ä¸­ä¸ºæ¯ä¸ªè¯·æ±‚åˆ›å»ºä¸€ä¸ª bean å®ä¾‹ã€‚ @Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE) &lt;bean id=&quot;...&quot; class=&quot;...&quot; scope=&quot;prototype&quot; /&gt; åœ¨å…¸å‹çš„ç”µå­å•†åŠ¡åº”ç”¨ä¸­å¯èƒ½ä¼šæœ‰ä¸€ä¸ª bean ä»£è¡¨ç”¨æˆ·çš„è´­ç‰©è½¦ã€‚å¦‚æœè´­ç‰©è½¦æ˜¯å•ä¾‹çš„è¯é‚£ä¹ˆå°†ä¼šå¯¼è‡´æ‰€æœ‰çš„ç”¨æˆ·éƒ½ä¼šå‘åŒä¸€ä¸ªè´­ç‰©è½¦ä¸­æ·»åŠ å•†å“ã€‚å¦ä¸€æ–¹é¢å¦‚æœè´­ç‰©è½¦æ˜¯åŸå‹ä½œç”¨åŸŸçš„é‚£ä¹ˆåœ¨åº”ç”¨ä¸­æŸä¸€ä¸ªåœ°æ–¹å¾€è´­ç‰©è½¦ä¸­æ·»åŠ å•†å“åœ¨åº”ç”¨çš„å¦å¤–ä¸€ä¸ªåœ°æ–¹å¯èƒ½å°±ä¸å¯ç”¨äº†å› ä¸ºåœ¨è¿™é‡Œæ³¨å…¥çš„æ˜¯å¦å¤–ä¸€ä¸ªåŸå‹ä½œç”¨åŸŸçš„è´­ç‰©è½¦ã€‚ å°±è´­ç‰©è½¦ bean æ¥è¯´ä¼šè¯ä½œç”¨åŸŸæ˜¯æœ€ä¸ºåˆé€‚çš„å› ä¸ºå®ƒä¸ç»™å®šçš„ç”¨æˆ·å…³è”æ€§æœ€å¤§ã€‚è¦æŒ‡å®šä¼šè¯ä½œç”¨åŸŸæˆ‘ä»¬å¯ä»¥ä½¿ç”¨@Scopeæ³¨è§£å®ƒçš„ä½¿ç”¨æ–¹å¼ä¸æŒ‡å®šåŸå‹ä½œç”¨åŸŸæ˜¯ç›¸åŒçš„ã€‚ 12345@Component@Scope&#123;value=WebApplication.SCOPE_SESSION, proxyMode=ScopedProxyMode.INTERFACES&#125;public ShoppingCart cart()&#123; // ??? è¿™é‡Œæœ‰ç‚¹ä¸ç†è§£ï¼Œå’‹å°±æŠŠä¸€ä¸ªæ–¹æ³•ç”³æ˜æˆä¸€ä¸ª Component äº†ï¼Œç„¶åä»£ç†è¿˜æ˜¯ç”¨çš„ INTERFACE&#125; 12345&lt;bean id=\"...\" class=\"...\" scope=\"prototype\" &gt; &lt;!-- é»˜è®¤æƒ…å†µä¸‹å®ƒä¼šä½¿ç”¨ CGLib åˆ›å»ºç›®æ ‡ç±»çš„ä»£ç† --&gt; &lt;!-- è®¾ç½®ä¸º false åˆ™ç”ŸæˆåŸºäºæ¥å£çš„ä»£ç† --&gt; &lt;aop:scope-proxy proxy-target-class=\"false \"/&gt;&lt;/bean&gt; è¦æ³¨æ„çš„æ˜¯@ScopeåŒæ—¶è¿˜æœ‰ä¸€ä¸ªproxyModeå±æ€§å®ƒè¢«è®¾ç½®æˆäº†ScopedProxyMode.INTERFACESã€‚è¿™ä¸ªå±æ€§è§£å†³äº†å°†ä¼šè¯æˆ–è¯·æ±‚ä½œç”¨åŸŸçš„beanæ³¨å…¥åˆ°å•ä¾‹beanä¸­æ‰€é‡åˆ°çš„é—®é¢˜ã€‚ å› ä¸ºStoreServiceæ˜¯ä¸€ä¸ªå•ä¾‹çš„beanä¼šåœ¨Springåº”ç”¨ä¸Šä¸‹æ–‡åŠ è½½çš„æ—¶å€™åˆ›å»ºã€‚å½“å®ƒåˆ›å»ºçš„æ—¶å€™Springä¼šè¯•å›¾å°†ShoppingCart beanæ³¨å…¥åˆ°setShoppingCart()æ–¹æ³•ä¸­ã€‚ä½†æ˜¯ShoppingCartbeanæ˜¯ä¼šè¯ä½œç”¨åŸŸçš„æ­¤æ—¶å¹¶ä¸å­˜åœ¨ã€‚ç›´åˆ°æŸä¸ªç”¨æˆ·è¿›å…¥ç³»ç»Ÿåˆ›å»ºäº†ä¼šè¯ä¹‹åæ‰ä¼šå‡ºç°ShoppingCartå®ä¾‹ã€‚ å¦å¤–ç³»ç»Ÿä¸­å°†ä¼šæœ‰å¤šä¸ªShoppingCartå®ä¾‹æ¯ä¸ªç”¨æˆ·ä¸€ä¸ªã€‚æˆ‘ä»¬å¹¶ä¸æƒ³è®© Spring æ³¨å…¥æŸä¸ªå›ºå®šçš„ShoppingCartå®ä¾‹åˆ°StoreServiceä¸­ã€‚æˆ‘ä»¬å¸Œæœ›çš„æ˜¯å½“StoreServiceå¤„ç†è´­ç‰©è½¦åŠŸèƒ½æ—¶å®ƒæ‰€ä½¿ç”¨çš„ShoppingCartå®ä¾‹æ°å¥½æ˜¯å½“å‰ä¼šè¯æ‰€å¯¹åº”çš„é‚£ä¸€ä¸ªã€‚ è¯·æ±‚ä½œç”¨åŸŸçš„ bean ä¼šé¢ä¸´ç›¸åŒçš„è£…é…é—®é¢˜ã€‚å› æ­¤è¯·æ±‚ä½œç”¨åŸŸçš„ bean åº”è¯¥ä¹Ÿä»¥ä½œç”¨åŸŸä»£ç†çš„æ–¹å¼è¿›è¡Œæ³¨å…¥ã€‚ Spring å¹¶ä¸ä¼šå°†å®é™…çš„ShoppingCart bean æ³¨å…¥åˆ° StoreService ä¸­ï¼ŒSpring ä¼šæ³¨å…¥ä¸€ä¸ªåˆ°ShoppingCart bean çš„ä»£ç†ã€‚è¿™ä¸ªä»£ç†ä¼šæš´éœ²ä¸ShoppingCartç›¸åŒçš„æ–¹æ³•æ‰€ä»¥StoreServiceä¼šè®¤ä¸ºå®ƒå°±æ˜¯ä¸€ä¸ªè´­ç‰©è½¦ã€‚ä½†æ˜¯å½“StoreServiceè°ƒç”¨ShoppingCartçš„æ–¹æ³•æ—¶ä»£ç†ä¼šå¯¹å…¶è¿›è¡Œæ‡’è§£æå¹¶å°†è°ƒç”¨å§”æ‰˜ç»™ä¼šè¯ä½œç”¨åŸŸå†…çœŸæ­£çš„ShoppingCart beanã€‚ å¦‚æœShoppingCartæ˜¯æ¥å£è€Œä¸æ˜¯ç±»çš„è¯è¿™æ˜¯å¯ä»¥çš„ä¹Ÿæ˜¯æœ€ä¸ºç†æƒ³çš„ä»£ç†æ¨¡å¼ã€‚ä½†å¦‚æœShoppingCartæ˜¯ä¸€ä¸ªå…·ä½“çš„ç±»çš„è¯ Spring å°±æ²¡æœ‰åŠæ³•åˆ›å»ºåŸºäºæ¥å£çš„ä»£ç†äº†ã€‚æ­¤æ—¶å®ƒå¿…é¡»ä½¿ç”¨ CGLib æ¥ç”ŸæˆåŸºäºç±»çš„ä»£ç†ã€‚æ‰€ä»¥å¦‚æœ bean ç±»å‹æ˜¯å…·ä½“ç±»çš„è¯æˆ‘ä»¬å¿…é¡»è¦å°†proxyModeå±æ€§è®¾ç½®ä¸ºScopedProxyMode.TARGET_CLASSä»¥æ­¤æ¥è¡¨æ˜è¦ä»¥ç”Ÿæˆç›®æ ‡ç±»æ‰©å±•çš„æ–¹å¼åˆ›å»ºä»£ç†ã€‚ è¿è¡Œæ—¶å€¼æ³¨å…¥ å±æ€§å ä½ç¬¦ Property placeholderï¼› Spring è¡¨è¾¾å¼è¯­è¨€ SpELã€‚ @PropertySource(&quot;classpath:app.properties&quot;)æ³¨è§£å£°æ˜å±æ€§æºå¹¶é€šè¿‡ Spring çš„Environmentæ¥æ£€ç´¢å±æ€§ã€‚ @Value(&quot;${xxx.xxx}&quot;)æ³¨è§£é…åˆè§£æå±æ€§å ä½ç¬¦ä½¿ç”¨ã€‚ ä¸ºäº†ä½¿ç”¨å ä½ç¬¦æˆ‘ä»¬å¿…é¡»è¦é…ç½®ä¸€ä¸ªPropertySourcesPlaceholderConfigurer beanã€‚ 1234@Beanpublic static PropertysourcesPlaceholderConfigurer placeholderConfigurer() &#123; return new PropertySourcesPlaceholderConfigurer();&#125; 123&lt;beans&gt; &lt;context:property-placeholder /&gt;&lt;/beans&gt; è§£æå¤–éƒ¨å±æ€§èƒ½å¤Ÿå°†å€¼çš„å¤„ç†æ¨è¿Ÿåˆ°è¿è¡Œæ—¶ä½†æ˜¯å®ƒçš„å…³æ³¨ç‚¹åœ¨äºæ ¹æ®åç§°è§£ææ¥è‡ªäº Spring Environmentå’Œå±æ€§æºçš„å±æ€§ã€‚è€Œ Spring è¡¨è¾¾å¼è¯­è¨€æä¾›äº†ä¸€ç§æ›´é€šç”¨çš„æ–¹å¼åœ¨è¿è¡Œæ—¶è®¡ç®—æ‰€è¦æ³¨å…¥çš„å€¼ã€‚ Spring 3 å¼•å…¥äº† Spring è¡¨è¾¾å¼è¯­è¨€ Spring Expression Languageï¼ŒSpEL å®ƒèƒ½å¤Ÿä»¥ä¸€ç§å¼ºå¤§å’Œç®€æ´çš„æ–¹å¼å°†å€¼è£…é…åˆ° bean å±æ€§å’Œæ„é€ å™¨å‚æ•°ä¸­ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æ‰€ä½¿ç”¨çš„è¡¨è¾¾å¼ä¼šåœ¨è¿è¡Œæ—¶è®¡ç®—å¾—åˆ°å€¼ã€‚ åœ¨ XML é…ç½®ä¸­ä½ å¯ä»¥å°† SpEL è¡¨è¾¾å¼ä¼ å…¥&lt;property&gt;æˆ–```çš„ value å±æ€§ä¸­æˆ–è€…å°†å…¶ä½œä¸º p- å‘½åç©ºé—´æˆ– c- å‘½åç©ºé—´æ¡ç›®çš„å€¼ã€‚ #{} @Value(&quot;#{ststemProperties[&#39;xxx.xxx&#39;]}&quot;) ä½¿ç”¨ bean çš„ ID æ¥å¼•ç”¨ beanï¼› è°ƒç”¨æ–¹æ³•å’Œè®¿é—®å¯¹è±¡çš„å±æ€§ï¼› å¯¹å€¼è¿›è¡Œç®—æœ¯ã€å…³ç³»å’Œé€»è¾‘è¿ç®—ï¼› æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼› é›†åˆæ“ä½œã€‚ ç¯å¢ƒä¸ Profileé…ç½®@profile(&quot;dev&quot;) 12345678&lt;beans&gt; &lt;beans profile=\"dev\"&gt; &lt;/beans&gt; &lt;beans profile=\"prod\"&gt; &lt;/beans&gt;&lt;/beans&gt; æ¿€æ´»@ActiveProfiles 123456789101112131415161718&lt;!-- web.xml --&gt;&lt;!-- ä½œä¸º Web åº”ç”¨çš„ä¸Šä¸‹æ–‡å‚æ•° --&gt;&lt;context-param&gt; &lt;param-name&gt;spring.profiles.default&lt;/param-name&gt; &lt;param-value&gt;dev&lt;/param-value&gt;&lt;/context-param&gt;&lt;!-- ä½œä¸º DispatcherServlet çš„åˆå§‹åŒ–å‚æ•° --&gt;&lt;servlet&gt; &lt;servlet-name&gt;appServlet&lt;/servlet-name&gt; &lt;servlet-class&gt; org.springframework.web.servlet.DispatcherServlet &lt;/servlet-class&gt; &lt;init-param&gt; &lt;param-name&gt;spring.profiles.default&lt;/param-name&gt; &lt;param-value&gt;dev&lt;/param-value&gt; &lt;/init-param&gt; &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;&lt;/servlet&gt; æ¡ä»¶åŒ–Spring 4 å¼•å…¥äº†ä¸€ä¸ªæ–°çš„@Conditionalæ³¨è§£å®ƒå¯ä»¥ç”¨åˆ°å¸¦æœ‰@Beanæ³¨è§£çš„æ–¹æ³•ä¸Šã€‚å¦‚æœç»™å®šçš„æ¡ä»¶è®¡ç®—ç»“æœä¸ºtrueå°±ä¼šåˆ›å»ºè¿™ä¸ª bean å¦åˆ™çš„è¯è¿™ä¸ª bean ä¼šè¢«å¿½ç•¥ã€‚ 123456789101112131415public class MyConfig &#123; @Bean @Conditional(MyCondition.class) // æ¡ä»¶åŒ–åœ°åˆ›å»º bean public ConditionBean conditionBean() &#123; return new ConditonBean(); &#125; &#125;public class Mycondition implements Condition &#123; public boolean matches (ConditionContext ctxt, AnnotatedTypeMetadata metadata)&#123; // å…·ä½“åˆ¤æ–­é€»è¾‘ &#125;&#125; é¢å‘åˆ‡é¢ é¢å‘åˆ‡é¢ç¼–ç¨‹çš„åŸºæœ¬åŸç† é€šè¿‡ POJO åˆ›å»ºåˆ‡é¢ ä½¿ç”¨@AspectJæ³¨è§£ ä¸º AspectJ åˆ‡é¢æ³¨å…¥ä¾èµ– Spring åªæ”¯æŒæ–¹æ³•çº§åˆ«çš„è¿æ¥ç‚¹ï¼Œå¦‚æœéœ€è¦æ–¹æ³•æ‹¦æˆªä¹‹å¤–çš„è¿æ¥ç‚¹æ‹¦æˆªåŠŸèƒ½é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ Aspect æ¥è¡¥å…… Spring AOP çš„åŠŸèƒ½ã€‚ æè¿°åˆ‡é¢çš„å¸¸ç”¨æœ¯è¯­æœ‰é€šçŸ¥ adviceã€åˆ‡ç‚¹ pointcut å’Œè¿æ¥ç‚¹ join pointã€‚ å¼•å…¥ Introdutionå…è®¸å‘ç°æœ‰çš„ç±»æ·»åŠ æ–°æ–¹æ³•æˆ–å±æ€§ã€‚ ç»‡å…¥ Weavingç»‡å…¥æ˜¯æŠŠåˆ‡é¢åº”ç”¨åˆ°ç›®æ ‡å¯¹è±¡å¹¶åˆ›å»ºæ–°çš„ä»£ç†å¯¹è±¡çš„è¿‡ç¨‹ã€‚ ç¼–è¯‘æœŸåˆ‡é¢åœ¨ç›®æ ‡ç±»ç¼–è¯‘æ—¶è¢«ç»‡å…¥ã€‚è¿™ç§æ–¹å¼éœ€è¦ç‰¹æ®Šçš„ç¼–è¯‘å™¨ã€‚AspectJ çš„ç»‡å…¥ç¼–è¯‘å™¨å°±æ˜¯ä»¥è¿™ç§æ–¹å¼ç»‡å…¥åˆ‡é¢çš„ã€‚ ç±»åŠ è½½æœŸåˆ‡é¢åœ¨ç›®æ ‡ç±»åŠ è½½åˆ° JVM æ—¶è¢«ç»‡å…¥ã€‚è¿™ç§æ–¹å¼éœ€è¦ç‰¹æ®Šçš„ç±»åŠ è½½å™¨ClassLoaderå®ƒå¯ä»¥åœ¨ç›®æ ‡ç±»è¢«å¼•å…¥åº”ç”¨ä¹‹å‰å¢å¼ºè¯¥ç›®æ ‡ç±»çš„å­—èŠ‚ç ã€‚AspectJ 5 çš„åŠ è½½æ—¶ç»‡å…¥ load-time weavingLTW å°±æ”¯æŒä»¥è¿™ç§æ–¹å¼ç»‡å…¥åˆ‡é¢ã€‚ è¿è¡ŒæœŸåˆ‡é¢åœ¨åº”ç”¨è¿è¡Œçš„æŸä¸ªæ—¶åˆ»è¢«ç»‡å…¥ã€‚ä¸€èˆ¬æƒ…å†µä¸‹åœ¨ç»‡å…¥åˆ‡é¢æ—¶ AOP å®¹å™¨ä¼šä¸ºç›®æ ‡å¯¹è±¡åŠ¨æ€åœ°åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡ã€‚Spring AOP å°±æ˜¯ä»¥è¿™ç§æ–¹å¼ç»‡å…¥åˆ‡é¢çš„ã€‚ Spring åˆ‡é¢å¯ä»¥åº”ç”¨ 5 ç§ç±»å‹çš„é€šçŸ¥ï¼š å‰ç½®é€šçŸ¥ Before åœ¨ç›®æ ‡æ–¹æ³•è¢«è°ƒç”¨ä¹‹å‰è°ƒç”¨é€šçŸ¥åŠŸèƒ½ï¼› åç½®é€šçŸ¥ After åœ¨ç›®æ ‡æ–¹æ³•å®Œæˆä¹‹åè°ƒç”¨é€šçŸ¥æ­¤æ—¶ä¸ä¼šå…³å¿ƒæ–¹æ³•çš„è¾“å‡ºæ˜¯ä»€ä¹ˆï¼› è¿”å›é€šçŸ¥ After-returning åœ¨ç›®æ ‡æ–¹æ³•æˆåŠŸæ‰§è¡Œä¹‹åè°ƒç”¨é€šçŸ¥ï¼› å¼‚å¸¸é€šçŸ¥ After-throwing åœ¨ç›®æ ‡æ–¹æ³•æŠ›å‡ºå¼‚å¸¸åè°ƒç”¨é€šçŸ¥ï¼› ç¯ç»•é€šçŸ¥Aroundé€šçŸ¥åŒ…è£¹äº†è¢«é€šçŸ¥çš„æ–¹æ³•åœ¨è¢«é€šçŸ¥çš„æ–¹æ³•è°ƒç”¨ä¹‹å‰å’Œè°ƒç”¨ä¹‹åæ‰§è¡Œè‡ªå®šä¹‰çš„è¡Œä¸ºã€‚ ä»£ç†ç±»å°è£…äº†ç›®æ ‡ç±»å¹¶æ‹¦æˆªè¢«é€šçŸ¥æ–¹æ³•çš„è°ƒç”¨å†æŠŠè°ƒç”¨è½¬å‘ç»™çœŸæ­£çš„ç›®æ ‡ beanã€‚å½“ä»£ç†æ‹¦æˆªåˆ°æ–¹æ³•è°ƒç”¨æ—¶åœ¨è°ƒç”¨ç›®æ ‡ bean æ–¹æ³•ä¹‹å‰ä¼šæ‰§è¡Œåˆ‡é¢é€»è¾‘ã€‚ å®šä¹‰åˆ‡é¢Spring å€ŸåŠ© AspectJ çš„åˆ‡ç‚¹è¡¨è¾¾å¼è¯­è¨€æ¥å®šä¹‰ Spring åˆ‡é¢ã€‚ AspectJ æŒ‡ç¤ºå™¨ æ è¿° arg() é™åˆ¶è¿æ¥ç‚¹åŒ¹é…å‚æ•°ä¸ºæŒ‡å®šç±»å‹çš„æ‰§è¡Œæ–¹æ³• @args() é™åˆ¶è¿æ¥ç‚¹åŒ¹é…å‚æ•°ç”±æŒ‡å®šæ³¨è§£æ ‡æ³¨çš„æ‰§è¡Œæ–¹æ³• execution() ç”¨äºåŒ¹é…æ˜¯è¿æ¥ç‚¹çš„æ‰§è¡Œæ–¹æ³• this() é™åˆ¶è¿æ¥ç‚¹åŒ¹é… AOP ä»£ç†çš„ bean å¼•ç”¨ä¸ºæŒ‡å®šç±»å‹çš„ç±» target é™åˆ¶è¿æ¥ç‚¹åŒ¹é…ç›®æ ‡å¯¹è±¡ä¸ºæŒ‡å®šç±»å‹çš„ç±» @target() é™åˆ¶è¿æ¥ç‚¹åŒ¹é…ç‰¹å®šçš„æ‰§è¡Œå¯¹è±¡è¿™äº›å¯¹è±¡å¯¹åº”çš„ç±»è¦å…·æœ‰æŒ‡å®šç±»å‹çš„æ³¨è§£ within() é™åˆ¶è¿æ¥ç‚¹åŒ¹é…æŒ‡å®šçš„ç±»å‹ @within() é™åˆ¶è¿æ¥ç‚¹åŒ¹é…æŒ‡å®šæ³¨è§£æ‰€æ ‡æ³¨çš„ç±»å‹å½“ä½¿ç”¨ Spring AOP æ—¶æ–¹æ³•å®šä¹‰åœ¨ç”±æŒ‡å®šçš„æ³¨è§£æ‰€æ ‡æ³¨çš„ç±»é‡Œ @annotation é™å®šåŒ¹é…å¸¦æœ‰æŒ‡å®šæ³¨è§£çš„è¿æ¥ç‚¹ XML ä¸­çš„åˆ‡é¢å£°æ˜ã€‚ AOPé…ç½®å…ƒç´  ç”¨ é€” &lt;aop:advisor&gt; å®šä¹‰ AOP é€šçŸ¥å™¨ &lt;aop:after&gt; å®šä¹‰ AOP åç½®é€šçŸ¥ä¸ç®¡è¢«é€šçŸ¥çš„æ–¹æ³•æ˜¯å¦æ‰§è¡ŒæˆåŠŸ &lt;aop:after-returning&gt; å®šä¹‰ AOP è¿”å›é€šçŸ¥ &lt;aop:after-throwing&gt; å®šä¹‰ AOP å¼‚å¸¸é€šçŸ¥ &lt;aop:around&gt; å®šä¹‰ AOP ç¯ç»•é€šçŸ¥ &lt;aop:aspect&gt; å®šä¹‰ä¸€ä¸ªåˆ‡é¢ &lt;aop:aspectj-autoproxy&gt; å¯ç”¨ @AspectJæ³¨è§£é©±åŠ¨çš„åˆ‡é¢ &lt;aop:before&gt; å®šä¹‰ä¸€ä¸ª AOP å‰ç½®é€šçŸ¥ &lt;aop:config&gt; é¡¶å±‚çš„ AOP é…ç½®å…ƒç´ ã€‚å¤§å¤šæ•°çš„ &lt;aop:*&gt;å…ƒç´ å¿…é¡»åŒ…å«åœ¨&lt;aop:config&gt;å…ƒç´ å†… &lt;aop:declare-parents&gt; ä»¥é€æ˜çš„æ–¹å¼ä¸ºè¢«é€šçŸ¥çš„å¯¹è±¡å¼•å…¥é¢å¤–çš„æ¥å£ &lt;aop:pointcut&gt; å®šä¹‰ä¸€ä¸ªåˆ‡ç‚¹ ä¸ºäº†é˜è¿° Spring ä¸­çš„åˆ‡é¢æˆ‘ä»¬éœ€è¦æœ‰ä¸ªä¸»é¢˜æ¥å®šä¹‰åˆ‡é¢çš„åˆ‡ç‚¹ã€‚ä¸ºæ­¤æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªPerformanceæ¥å£ã€‚ 1234package concert;public interface Performance &#123; public void perform();&#125; é€šçŸ¥Spring ä½¿ç”¨ AspectJ æ³¨è§£æ¥å£°æ˜é€šçŸ¥æ–¹æ³•ã€‚ æ³¨ è§£ é€š çŸ¥ @After é€šçŸ¥æ–¹æ³•ä¼šåœ¨ç›®æ ‡æ–¹æ³•è¿”å›æˆ–æŠ›å‡ºå¼‚å¸¸åè°ƒç”¨ @AfterReturning é€šçŸ¥æ–¹æ³•ä¼šåœ¨ç›®æ ‡æ–¹æ³•è¿”å›åè°ƒç”¨ @AfterThrowing é€šçŸ¥æ–¹æ³•ä¼šåœ¨ç›®æ ‡æ–¹æ³•æŠ›å‡ºå¼‚å¸¸åè°ƒç”¨ @Around é€šçŸ¥æ–¹æ³•ä¼šå°†ç›®æ ‡æ–¹æ³•å°è£…èµ·æ¥ @Before é€šçŸ¥æ–¹æ³•ä¼šåœ¨ç›®æ ‡æ–¹æ³•è°ƒç”¨ä¹‹å‰æ‰§è¡Œ 1234567891011@Aspectpublic class Audience &#123; @Pointcut(\"execution(* concert.Performance.perform(..))\") public void performance()&#123;&#125; @Before(\"performance()\") public void silenceCellPhones() &#123; System.out.println(\"Silencing cell phones\") &#125;&#125; 12345678910@Configuration@EnableAspectJAutoProxy // å¯åŠ¨ AspectJ è‡ªåŠ¨ä»£ç†@ComponentScanpublic class ConcertConfig &#123; @Bean public Audience audience() &#123; // å£°æ˜ Audience bean return new Audience(); &#125;&#125; 123456789101112&lt;beans&gt; &lt;context:component-scan base-package=\"concert\" /&gt; &lt;aop:aspectj-autoproxy /&gt; &lt;bean id=\"audience\" class=\"concert.Audiance\" /&gt; &lt;aop:config&gt; &lt;aop:aspect ref=\"audience\"&gt; &lt;aop:pointcut id=\"performance\" expression=\"execution(* concert.Performance.perform(..))\" /&gt; &lt;aop:before pointcut-ref=\"performance\" method=\"silenceCellPhones\" /&gt; &lt;/aop:aspect&gt; &lt;/aop:config&gt;&lt;/beans&gt; ç¯ç»•é€šçŸ¥ç¯ç»•é€šçŸ¥æ˜¯æœ€ä¸ºå¼ºå¤§çš„é€šçŸ¥ç±»å‹ã€‚å®ƒèƒ½å¤Ÿè®©ä½ æ‰€ç¼–å†™çš„é€»è¾‘å°†è¢«é€šçŸ¥çš„ç›®æ ‡æ–¹æ³•å®Œå…¨åŒ…è£…èµ·æ¥ã€‚å®é™…ä¸Šå°±åƒåœ¨ä¸€ä¸ªé€šçŸ¥æ–¹æ³•ä¸­åŒæ—¶ç¼–å†™å‰ç½®é€šçŸ¥å’Œåç½®é€šçŸ¥ã€‚ é€šçŸ¥æ–¹æ³•ä¸­å¯ä»¥åšä»»ä½•çš„äº‹æƒ…ï¼Œå½“è¦å°†æ§åˆ¶æƒäº¤ç»™è¢«é€šçŸ¥çš„æ–¹æ³•æ—¶å®ƒéœ€è¦è°ƒç”¨ProceedingJoinPointçš„proceed()æ–¹æ³•ã€‚ 1234567891011@Around(\"performance()\")public void watchPerformance(ProceedingJoinPoint jp) try &#123; System.out.println(\"Silencing cell phones\"); System.out.println(\"Taking seats\"); jp.proceed(); // ä¸è°ƒè¿™ä¸ªæ–¹æ³•çš„è¯é‚£ä¹ˆä½ çš„é€šçŸ¥å®é™…ä¸Šä¼šé˜»å¡å¯¹è¢«é€šçŸ¥æ–¹æ³•çš„è°ƒç”¨ System.out.println(\"CLAP CLAP CLAP!!!\"); &#125; catch (Throwable e) &#123; System.out.println(\"Demanding a refund\"); &#125;&#125; 123456&lt;aop:config&gt; &lt;aop:aspect ref=\"audience\"&gt; &lt;aop:pointcut id=\"performance\" expression=\"execution(* concert.Performance.perform(..))\" /&gt; &lt;aop:around pointcut-ref=\"performance\" method=\"watchPerformance\" /&gt; &lt;/aop:aspect&gt;&lt;/aop:config&gt; å‚æ•°åŒ–é€šçŸ¥ï¼Œä½¿ç”¨å‚æ•°åŒ–çš„é€šçŸ¥æ¥è®°å½•ç£é“æ’­æ”¾çš„æ¬¡æ•°ã€‚ å¼•å…¥å¦‚æœåˆ‡é¢èƒ½å¤Ÿä¸ºç°æœ‰çš„æ–¹æ³•å¢åŠ é¢å¤–çš„åŠŸèƒ½ï¼Œä¸ºä»€ä¹ˆä¸èƒ½ä¸ºä¸€ä¸ªå¯¹è±¡å¢åŠ æ–°çš„æ–¹æ³•å‘¢ï¼Ÿå®é™…ä¸Šåˆ©ç”¨è¢«ç§°ä¸ºå¼•å…¥çš„ AOP æ¦‚å¿µåˆ‡é¢å¯ä»¥ä¸º Spring bean æ·»åŠ æ–°æ–¹æ³•ã€‚ Web ä¸­çš„ SpringSpring é€šå¸¸ç”¨æ¥å¼€å‘ Web åº”ç”¨ã€‚ æ„å»º Spring Web æ˜ å°„è¯·æ±‚åˆ° Spring æ§åˆ¶å™¨ é€æ˜åœ°ç»‘å®šè¡¨å•å‚æ•° æ ¡éªŒè¡¨å•æäº¤ ä½¿ç”¨ Spring MVC æ‰€ç»å†çš„æ‰€æœ‰ç«™ç‚¹ã€‚ è¯·æ±‚æ—…ç¨‹çš„ç¬¬ä¸€ç«™æ˜¯ Spring çš„DispatcherServletã€‚ä¸å¤§å¤šæ•°åŸºäºJava çš„ Web æ¡†æ¶ä¸€æ · Spring MVC æ‰€æœ‰çš„è¯·æ±‚éƒ½ä¼šé€šè¿‡ä¸€ä¸ªå‰ç«¯æ§åˆ¶å™¨ front controllerServletã€‚å‰ç«¯æ§åˆ¶å™¨æ˜¯å¸¸ç”¨çš„ Web åº”ç”¨ç¨‹åºæ¨¡å¼åœ¨è¿™é‡Œä¸€ä¸ªå•å®ä¾‹çš„ Servlet å°†è¯·æ±‚å§”æ‰˜ç»™åº”ç”¨ç¨‹åºçš„å…¶ä»–ç»„ä»¶æ¥æ‰§è¡Œå®é™…çš„å¤„ç†ã€‚åœ¨ Spring MVC ä¸­DispatcherServletå°±æ˜¯å‰ç«¯æ§åˆ¶å™¨ã€‚ DispatcherServletçš„ä»»åŠ¡æ˜¯å°†è¯·æ±‚å‘é€ç»™ Spring MVC æ§åˆ¶å™¨ controllerã€‚æ§åˆ¶å™¨æ˜¯ä¸€ä¸ªç”¨äºå¤„ç†è¯·æ±‚çš„ Spring ç»„ä»¶ã€‚åœ¨å…¸å‹çš„åº”ç”¨ç¨‹åºä¸­å¯èƒ½ä¼šæœ‰å¤šä¸ªæ§åˆ¶å™¨DispatcherServletéœ€è¦çŸ¥é“åº”è¯¥å°†è¯·æ±‚å‘é€ç»™å“ªä¸ªæ§åˆ¶å™¨ã€‚æ‰€ä»¥DispatcherServletä¼šæŸ¥è¯¢ä¸€ä¸ªæˆ–å¤šä¸ªå¤„ç†å™¨æ˜ å°„ handler mapping æ¥ç¡®å®šè¯·æ±‚çš„ä¸‹ä¸€ç«™åœ¨å“ªé‡Œã€‚å¤„ç†å™¨æ˜ å°„ä¼šæ ¹æ®è¯·æ±‚æ‰€æºå¸¦çš„ URL ä¿¡æ¯æ¥è¿›è¡Œå†³ç­–ã€‚ ä¸€æ—¦é€‰æ‹©äº†åˆé€‚çš„æ§åˆ¶å™¨DispatcherServletä¼šå°†è¯·æ±‚å‘é€ç»™é€‰ä¸­çš„æ§åˆ¶å™¨ã€‚åˆ°äº†æ§åˆ¶å™¨è¯·æ±‚ä¼šå¸ä¸‹å…¶è´Ÿè½½ç”¨æˆ·æäº¤çš„ä¿¡æ¯å¹¶è€å¿ƒç­‰å¾…æ§åˆ¶å™¨å¤„ç†è¿™äº›ä¿¡æ¯ã€‚å®é™…ä¸Šè®¾è®¡è‰¯å¥½çš„æ§åˆ¶å™¨æœ¬èº«åªå¤„ç†å¾ˆå°‘ç”šè‡³ä¸å¤„ç†å·¥ä½œè€Œæ˜¯å°†ä¸šåŠ¡é€»è¾‘å§”æ‰˜ç»™ä¸€ä¸ªæˆ–å¤šä¸ªæœåŠ¡å¯¹è±¡è¿›è¡Œå¤„ç†ã€‚ æ§åˆ¶å™¨åœ¨å®Œæˆé€»è¾‘å¤„ç†åé€šå¸¸ä¼šäº§ç”Ÿä¸€äº›ä¿¡æ¯è¿™äº›ä¿¡æ¯éœ€è¦è¿”å›ç»™ç”¨æˆ·å¹¶åœ¨æµè§ˆå™¨ä¸Šæ˜¾ç¤ºã€‚è¿™äº›ä¿¡æ¯è¢«ç§°ä¸ºæ¨¡å‹ modelã€‚ä¸è¿‡ä»…ä»…ç»™ç”¨æˆ·è¿”å›åŸå§‹çš„ä¿¡æ¯æ˜¯ä¸å¤Ÿçš„â€”â€”è¿™äº›ä¿¡æ¯éœ€è¦ä»¥ç”¨æˆ·å‹å¥½çš„æ–¹å¼è¿›è¡Œæ ¼å¼åŒ–ä¸€èˆ¬ä¼šæ˜¯ HTMLã€‚æ‰€ä»¥ä¿¡æ¯éœ€è¦å‘é€ç»™ä¸€ä¸ªè§†å›¾ view é€šå¸¸ä¼šæ˜¯ JSPã€‚ æ§åˆ¶å™¨æ‰€åšçš„æœ€åä¸€ä»¶äº‹å°±æ˜¯å°†æ¨¡å‹æ•°æ®æ‰“åŒ…å¹¶ä¸”æ ‡ç¤ºå‡ºç”¨äºæ¸²æŸ“è¾“å‡ºçš„è§†å›¾åã€‚å®ƒæ¥ä¸‹æ¥ä¼šå°†è¯·æ±‚è¿åŒæ¨¡å‹å’Œè§†å›¾åå‘é€å›DispatcherServletã€‚ è¿™æ ·æ§åˆ¶å™¨å°±ä¸ä¼šä¸ç‰¹å®šçš„è§†å›¾ç›¸è€¦åˆä¼ é€’ç»™DispatcherServletçš„è§†å›¾åå¹¶ä¸ç›´æ¥è¡¨ç¤ºæŸä¸ªç‰¹å®šçš„ JSPã€‚å®é™…ä¸Šå®ƒç”šè‡³å¹¶ä¸èƒ½ç¡®å®šè§†å›¾å°±æ˜¯JSPã€‚ç›¸åå®ƒä»…ä»…ä¼ é€’äº†ä¸€ä¸ªé€»è¾‘åç§°ï¼Œè¿™ä¸ªåå­—å°†ä¼šç”¨æ¥æŸ¥æ‰¾äº§ç”Ÿç»“æœçš„çœŸæ­£è§†å›¾ã€‚DispatcherServletå°†ä¼šä½¿ç”¨è§†å›¾è§£æå™¨ view resolver æ¥å°†é€»è¾‘è§†å›¾ååŒ¹é…ä¸ºä¸€ä¸ªç‰¹å®šçš„è§†å›¾å®ç°ï¼Œå®ƒå¯èƒ½æ˜¯ä¹Ÿå¯èƒ½ä¸æ˜¯ JSPã€‚ æ—¢ç„¶DispatcherServletå·²ç»çŸ¥é“ç”±å“ªä¸ªè§†å›¾æ¸²æŸ“ç»“æœï¼Œé‚£è¯·æ±‚çš„ä»»åŠ¡åŸºæœ¬ä¸Šä¹Ÿå°±å®Œæˆäº†ã€‚å®ƒçš„æœ€åä¸€ç«™æ˜¯è§†å›¾çš„å®ç°ï¼Œå¯èƒ½æ˜¯ JSPï¼Œåœ¨è¿™é‡Œå®ƒäº¤ä»˜æ¨¡å‹æ•°æ®ã€‚è¯·æ±‚çš„ä»»åŠ¡å°±å®Œæˆäº†ã€‚è§†å›¾å°†ä½¿ç”¨æ¨¡å‹æ•°æ®æ¸²æŸ“è¾“å‡ºï¼Œè¿™ä¸ªè¾“å‡ºä¼šé€šè¿‡å“åº”å¯¹è±¡ä¼ é€’ç»™å®¢æˆ·ç«¯ã€‚ DispatcherServletæ­¤ Servlet ä¸º Spring MVC çš„æ ¸å¿ƒç±»ã€‚ æŒ‰ç…§ä¼ ç»Ÿçš„æ–¹å¼åƒDispatcherServletè¿™æ ·çš„ Servlet ä¼šé…ç½®åœ¨ web.xml æ–‡ä»¶ä¸­è¿™ä¸ªæ–‡ä»¶ä¼šæ”¾åˆ°åº”ç”¨çš„ WAR åŒ…é‡Œé¢ã€‚å½“ç„¶è¿™æ˜¯é…ç½®DispatcherServletçš„æ–¹æ³•ä¹‹ä¸€ã€‚ä½†æ˜¯å€ŸåŠ©äº Servlet 3 è§„èŒƒå’Œ Spring 3.1 çš„åŠŸèƒ½å¢å¼ºå¯ä»¥ä½¿ç”¨ Java å°†DispatcherServleté…ç½®åœ¨ Servlet å®¹å™¨ä¸­è€Œä¸ä¼šå†ä½¿ç”¨ web.xml æ–‡ä»¶ã€‚ 12345678910111213141516171819// é…ç½® DispatcherServletpackage spittr.config;import org.springframework.web.servlet.support.AbstractAnnotationConfigDispatcherServletInitializer;public class SpittrWebAppInitializer extends AbstractAnnotationConfigDispactcherServletInitializer &#123; @Override protected String[] getServletMappings() &#123; // å°† DispatcherServlet æ˜ å°„åˆ° â€œ/â€ return new String[] &#123;\"/\"&#125;; &#125; // å®šä¹‰æ‹¦æˆªå™¨ ContextLoaderListener åº”ç”¨ä¸Šä¸‹æ–‡çš„ beans @Override protected class&lt;?&gt;[] getRootConfigClasses() &#123; return new class&lt;?&gt;[] &#123;RootConfig.class&#125;; &#125; // å®šä¹‰ DispatcherServlet åº”ç”¨ä¸Šä¸‹æ–‡çš„ beans @Override protected class&lt;?&gt;[] getServletConfigClasses() &#123; // æŒ‡å®šé…ç½®ç±» return new class&lt;?&gt;[] &#123;WebConfig.class&#125;; &#125;&#125; æ‰©å±•AbstractAnnotation-ConfigDispatcherServletInitializerçš„ä»»æ„ç±»éƒ½ä¼šè‡ªåŠ¨åœ°é…ç½®Dispatcher-Servletå’Œ Spring åº”ç”¨ä¸Šä¸‹æ–‡ï¼ŒSpring çš„åº”ç”¨ä¸Šä¸‹æ–‡ä¼šä½äºåº”ç”¨ç¨‹åºçš„ Servlet ä¸Šä¸‹æ–‡ä¹‹ä¸­ã€‚ æœ€å°ä½†å¯ç”¨çš„ Spring MVC é…ç½®ã€‚ 12345678910111213141516171819@Configuration@EnableWebMvc // å¯ç”¨ Spring MVC@ComponentScan(\"spittr.web\") // å¼€å¯ç»„ä»¶æ‰«æ @Controllerpublic class WebConfig extends WebMvcConfigurerAdapter &#123; @Bean public ViewResolver viewResolver() &#123; // é…ç½® JSP è§†å›¾è§£æå™¨ InternalResourceViewResolver resolver = new InternalResourceViewResolver(); resolver.setPrefix(\"/WEB-INF/views/\"); resolver.setSuffix(\".jsp\"); resolver.setExposeContextBeansAsAttributes(true); return resolver; &#125; @Override public void configureDefaultServletHandling(DefaultServletHandlerConfigurer configurer) &#123; configurer.enable(); // é…ç½®é™æ€èµ„æºçš„å¤„ç† &#125;&#125; 12345678@Configuration@ComponentScan(basePackages=&#123;\"spitter\"&#125;, excludeFilter=&#123; @Filter&#123;type=FilterType.ANNOTATION, value=EnbaleWebMVC.class&#125; &#125;)public class RootConfig &#123;&#125; æ·»åŠ å…¶å®ƒç»„ä»¶é™¤äº†DispatcherServletä»¥å¤–ï¼Œé¡¹ç›®å¯èƒ½è¿˜éœ€è¦é¢å¤–çš„ Servlet å’Œ Filter ï¼Œå¹¶ä¸”å¯èƒ½è¿˜éœ€è¦å¯¹DispatcherServletæœ¬èº«åšä¸€äº›é¢å¤–çš„é…ç½®ã€‚ åœ¨AbstractAnnotation-ConfigDispatcherServletInitializerå°†DispatcherServletæ³¨å†Œåˆ°Servletå®¹å™¨ä¸­ä¹‹åï¼Œå°±ä¼šè°ƒç”¨customizeRegistration()å¹¶å°†Servletæ³¨å†Œåå¾—åˆ°çš„Registration.Dynamicä¼ é€’è¿›æ¥ã€‚é€šè¿‡é‡è½½customizeRegistration()æ–¹æ³•æˆ‘ä»¬å¯ä»¥å¯¹DispatcherServletè¿›è¡Œé¢å¤–çš„é…ç½®ã€‚ å¦‚æœæˆ‘ä»¬æƒ³å¾€ Web å®¹å™¨ä¸­æ³¨å†Œå…¶ä»–ç»„ä»¶çš„è¯ï¼Œåªéœ€åˆ›å»ºä¸€ä¸ªæ–°çš„åˆå§‹åŒ–å™¨å°±å¯ä»¥äº†ã€‚æœ€ç®€å•çš„æ–¹å¼å°±æ˜¯å®ç° Spring çš„WebApplicationInitializeræ¥å£ã€‚ 12345678910111213public class MyServletInitializer extends WebApplicationInitializer &#123; @Override public void onStartup(ServletContext servletContext) throws ServletException &#123; // æ·»åŠ è‡ªå®šä¹‰ servlet Dynamic myServlet = servlectContext.addServlet(\"myServlet\", MyServlet.class); myServlect.addMapping(\"/custom/**\"); // æ·»åŠ è‡ªå®šä¹‰ Filter javax.servlet.FilterRegistration.Dynamic filter = servletContext.addFilter(\"myFilter\", MyFilter.class); filter.addMappingForUrlPatterns(null, false, \"/custom/**\"); &#125;&#125; æºç ç‰‡æ®µï¼š 1234// å¯»æ‰¾ä»»ä½•ç»§æ‰¿äº† WebApplicationInitializer æ¥å£çš„ç±»å¹¶ç”¨å…¶æ¥é…ç½® servlet å®¹å™¨for (WebApplicationInitializer initializer : initializers) &#123; initializer.onStartup(servletContext);&#125; ç¼–å†™åŸºæœ¬æ§åˆ¶å™¨@Controlleræ³¨è§£è¾…åŠ©å®ç°ç»„ä»¶æ‰«æï¼Œä¸@Componentæ³¨è§£æ‰€å®ç°çš„æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯åœ¨è¡¨æ„æ€§ä¸Šå¯èƒ½ä¼šå·®ä¸€äº›ã€‚ @RequestMapping(value=&quot;/&quot;, method=GET)æ³¨è§£ç»‘å®šè¯·æ±‚ï¼švalueå±æ€§æŒ‡å®šäº†è¿™ä¸ªæ–¹æ³•æ‰€è¦å¤„ç†çš„è¯·æ±‚è·¯å¾„ï¼Œmethodå±æ€§ç»†åŒ–äº†å®ƒæ‰€å¤„ç†çš„ HTTP æ–¹æ³•ã€‚ æ§åˆ¶å™¨æ–¹æ³•çš„ Model å‚æ•°å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ª Mapï¼Œä¹Ÿå°±æ˜¯ key-value å¯¹çš„é›†åˆï¼Œå®ƒä¼šä¼ é€’ç»™è§†å›¾ï¼Œè¿™æ ·æ•°æ®å°±èƒ½æ¸²æŸ“åˆ°å®¢æˆ·ç«¯äº†ã€‚ 12(Model model)(Map mode) ä¼ å‚Spring MVC å…è®¸ä»¥å¤šç§æ–¹å¼å°†å®¢æˆ·ç«¯ä¸­çš„æ•°æ®ä¼ é€åˆ°æ§åˆ¶å™¨çš„å¤„ç†å™¨æ–¹æ³•ä¸­ã€‚ æŸ¥è¯¢å‚æ•° Query Parameterï¼› è¡¨å•å‚æ•° Form Parameterï¼› è·¯å¾„å˜é‡ Path Variableã€‚ @RequrearParam(&quot;ParamName&quot;) [URL]?ParamName=xxxæ³¨è§£ç”¨äºå‚æ•°ã€‚ @RequestMapping(value=&quot;/{ParamName}&quot;, method=GET) @PathVariable{&quot;ParamName&quot;} [URL]/xxx è¡¨å• POST è¯·æ±‚çš„æ§åˆ¶å™¨æ–¹æ³•å‚æ•°å¯ç›´æ¥ä½¿ç”¨å¯¹è±¡ï¼ŒSpring MVC å°†ä¼šä½¿ç”¨è¯·æ±‚ä¸­åŒåçš„å‚æ•°è¿›è¡Œå¡«å……ã€‚ æ ¡éªŒ ä» Spring 3.0 å¼€å§‹åœ¨ Spring MVC ä¸­æä¾›äº†å¯¹ Java æ ¡éªŒ API çš„æ”¯æŒã€‚ Java æ ¡éªŒ API æ‰€æä¾›çš„æ ¡éªŒæ³¨è§£ã€‚ æ³¨ è§£ æ è¿° @AssertFalse æ‰€æ³¨è§£çš„å…ƒç´ å¿…é¡»æ˜¯Booleanç±»å‹å¹¶ä¸”å€¼ä¸º false @AssertTrue æ‰€æ³¨è§£çš„å…ƒç´ å¿…é¡»æ˜¯Booleanç±»å‹å¹¶ä¸”å€¼ä¸º true @DecimalMax æ‰€æ³¨è§£çš„å…ƒç´ å¿…é¡»æ˜¯æ•°å­—å¹¶ä¸”å®ƒçš„å€¼è¦å°äºæˆ–ç­‰äºç»™å®šçš„ BigDecimalStringå€¼ @DecimalMin æ‰€æ³¨è§£çš„å…ƒç´ å¿…é¡»æ˜¯æ•°å­—å¹¶ä¸”å®ƒçš„å€¼è¦å¤§äºæˆ–ç­‰äºç»™å®šçš„ BigDecimalStringå€¼ @Digits æ‰€æ³¨è§£çš„å…ƒç´ å¿…é¡»æ˜¯æ•°å­—å¹¶ä¸”å®ƒçš„å€¼å¿…é¡»æœ‰æŒ‡å®šçš„ä½æ•° @Future æ‰€æ³¨è§£çš„å…ƒç´ çš„å€¼å¿…é¡»æ˜¯ä¸€ä¸ªå°†æ¥çš„æ—¥æœŸ @Max æ‰€æ³¨è§£çš„å…ƒç´ å¿…é¡»æ˜¯æ•°å­—å¹¶ä¸”å®ƒçš„å€¼è¦å°äºæˆ–ç­‰äºç»™å®šçš„å€¼ @Min æ‰€æ³¨è§£çš„å…ƒç´ å¿…é¡»æ˜¯æ•°å­—å¹¶ä¸”å®ƒçš„å€¼è¦å¤§äºæˆ–ç­‰äºç»™å®šçš„å€¼ @NotNull æ‰€æ³¨è§£å…ƒç´ çš„å€¼å¿…é¡»ä¸èƒ½ä¸º null @Null æ‰€æ³¨è§£å…ƒç´ çš„å€¼å¿…é¡»ä¸º null @Past æ‰€æ³¨è§£çš„å…ƒç´ çš„å€¼å¿…é¡»æ˜¯ä¸€ä¸ªå·²è¿‡å»çš„æ—¥æœŸ @Pattern æ‰€æ³¨è§£çš„å…ƒç´ çš„å€¼å¿…é¡»åŒ¹é…ç»™å®šçš„æ­£åˆ™è¡¨è¾¾å¼ @Size æ‰€æ³¨è§£çš„å…ƒç´ çš„å€¼å¿…é¡»æ˜¯ Stringã€é›†åˆæˆ–æ•°ç»„å¹¶ä¸”å®ƒçš„é•¿åº¦è¦ç¬¦åˆç»™å®šçš„èŒƒå›´ @validæ³¨è§£ç”¨äºå‚æ•°ï¼Œæ·»åŠ äº†@Validæ³¨è§£è¿™ä¼šå‘ŠçŸ¥Springéœ€è¦ç¡®ä¿è¿™ä¸ªå¯¹è±¡æ»¡è¶³æ ¡éªŒé™åˆ¶ã€‚ å±æ€§ä¸Šæ·»åŠ æ ¡éªŒé™åˆ¶å¹¶ä¸èƒ½é˜»æ­¢è¡¨å•æäº¤ï¼Œå¦‚æœæœ‰æ ¡éªŒå‡ºç°é”™è¯¯çš„è¯é‚£ä¹ˆè¿™äº›é”™è¯¯å¯ä»¥é€šè¿‡Errorså¯¹è±¡è¿›è¡Œè®¿é—®ï¼ŒErrorså¯¹è±¡å¯ä½œä¸ºæ§åˆ¶å™¨æ–¹æ³•çš„ä¸€ä¸ªå‚æ•°ã€‚é¦–æ¬¡è°ƒç”¨Errors.hasErrors()æ¥æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯ï¼Œä¹‹åå†è¿›è¡Œä¸šåŠ¡é€»è¾‘å¤„ç†ã€‚ æ¸²æŸ“ Web è§†å›¾ å°†æ¨¡å‹æ•°æ®æ¸²æŸ“ä¸º HTML ä½¿ç”¨ JSP è§†å›¾ é€šè¿‡ tiles å®šä¹‰è§†å›¾å¸ƒå±€ ä½¿ç”¨ Thymeleaf è§†å›¾ Spring è‡ªå¸¦äº† 13 ä¸ªè§†å›¾è§£æå™¨èƒ½å¤Ÿå°†é€»è¾‘è§†å›¾åè½¬æ¢ä¸ºç‰©ç†å®ç°ã€‚ è§†å›¾è§£æå™¨ æ è¿° BeanNameViewResolver å°†è§†å›¾è§£æä¸º Spring åº”ç”¨ä¸Šä¸‹æ–‡ä¸­çš„ bean å…¶ä¸­ bean çš„ ID ä¸è§†å›¾çš„åå­—ç›¸åŒ ContentNegotiatingViewResolver é€šè¿‡è€ƒè™‘å®¢æˆ·ç«¯éœ€è¦çš„å†…å®¹ç±»å‹æ¥è§£æè§†å›¾å§”æ‰˜ç»™å¦å¤–ä¸€ä¸ªèƒ½å¤Ÿäº§ç”Ÿå¯¹åº”å†…å®¹ç±» å‹çš„è§†å›¾è§£æå™¨ FreeMarkerViewResolver å°†è§†å›¾è§£æä¸º FreeMarker æ¨¡æ¿ InternalResourceViewResolver å°†è§†å›¾è§£æä¸º Web åº”ç”¨çš„å†…éƒ¨èµ„æºä¸€èˆ¬ä¸º JSP JasperReportsViewResolver å°†è§†å›¾è§£æä¸º JasperReports å®šä¹‰ ResourceBundleViewResolver å°†è§†å›¾è§£æä¸ºèµ„æº bundle ä¸€èˆ¬ä¸ºå±æ€§æ–‡ä»¶ TilesViewResolver å°†è§†å›¾è§£æä¸º Apache Tile å®šä¹‰å…¶ä¸­ tile ID ä¸è§†å›¾åç§°ç›¸åŒã€‚æ³¨æ„æœ‰ä¸¤ä¸ªä¸åŒçš„ TilesViewResolverå®ç°åˆ†åˆ«å¯¹åº”äº Tiles 2.0 å’Œ Tiles 3.0 UrlBasedViewResolver ç›´æ¥æ ¹æ®è§†å›¾çš„åç§°è§£æè§†å›¾è§†å›¾çš„åç§°ä¼šåŒ¹é…ä¸€ä¸ªç‰©ç†è§†å›¾çš„å®šä¹‰ VelocityLayoutViewResolver å°†è§†å›¾è§£æä¸º Velocity å¸ƒå±€ä»ä¸åŒçš„ Velocity æ¨¡æ¿ä¸­ç»„åˆé¡µé¢ VelocityViewResolver å°†è§†å›¾è§£æä¸º Velocity æ¨¡æ¿ XmlViewResolver å°†è§†å›¾è§£æä¸ºç‰¹å®š XML æ–‡ä»¶ä¸­çš„ bean å®šä¹‰ã€‚ç±»ä¼¼äºBeanName-ViewResolver XsltViewResolver å°†è§†å›¾è§£æä¸º XSLT è½¬æ¢åçš„ç»“æœ é…ç½®é€‚ç”¨äº JSP çš„è§†å›¾è§£æå™¨InternalResourceViewResolverã€‚å®ƒéµå¾ªä¸€ç§çº¦å®šä¼šåœ¨è§†å›¾åä¸Šæ·»åŠ å‰ç¼€å’Œåç¼€è¿›è€Œç¡®å®šä¸€ä¸ª Web åº”ç”¨ä¸­è§†å›¾èµ„æºçš„ç‰©ç†è·¯å¾„ã€‚ 12345678@Beanpublic ViewResolver viewResolver() &#123; // é…ç½® JSP è§†å›¾è§£æå™¨ InternalResourceViewResolver resolver = new InternalResourceViewResolver(); resolver.setPrefix(\"/WEB-INF/views/\"); resolver.setSuffix(\".jsp\"); resolver.serViewClass(InternalResourceViewResolver) // è§£æ JSTL è§†å›¾ return resolver;&#125; 1234&lt;bean id=\"viewResolver\" class=\"org.springframework.web.servlet.view.InternalResourceViewResolver\" p:prefix=\"/WEB-INF/views\" p:suffix=\".jsp\" p:viewClass=\"InternalResourceViewResolver\" /&gt; è§£æ JSTL è§†å›¾ï¼Œä½¿ç”¨ Spring çš„ JSP åº“ã€‚ å€ŸåŠ© Spring è¡¨å•ç»‘å®šæ ‡ç­¾åº“ä¸­æ‰€åŒ…å«çš„æ ‡ç­¾æˆ‘ä»¬èƒ½å¤Ÿå°†æ¨¡å‹å¯¹è±¡ç»‘å®šåˆ°æ¸²æŸ“åçš„ HTML è¡¨å•ä¸­ã€‚ 12&lt;!-- ä¸ºäº†ä½¿ç”¨è¡¨å•ç»‘å®šåº“éœ€è¦åœ¨JSPé¡µé¢ä¸­å¯¹å…¶è¿›è¡Œå£°æ˜ --&gt;&lt;%@taglib prefix=\"sf\" uri=\"http://www.springframework.org/tags/form\" %&gt; JSPæ ‡ç­¾ æ è¿° &lt;sf:checkbox&gt; æ¸²æŸ“æˆä¸€ä¸ª HTML &lt;input&gt;æ ‡ç­¾å…¶ä¸­typeå±æ€§è®¾ç½®ä¸ºcheckbox &lt;sf:checkboxes&gt; æ¸²æŸ“æˆå¤šä¸ª HTML &lt;input&gt;æ ‡ç­¾å…¶ä¸­typeå±æ€§è®¾ç½®ä¸ºcheckbox &lt;sf:errors&gt; åœ¨ä¸€ä¸ª HTML &lt;span&gt;ä¸­æ¸²æŸ“è¾“å…¥åŸŸçš„é”™è¯¯ &lt;sf:form&gt; æ¸²æŸ“æˆä¸€ä¸ª HTML &lt;form&gt;æ ‡ç­¾å¹¶ä¸ºå…¶å†…éƒ¨æ ‡ç­¾æš´éœ²ç»‘å®šè·¯å¾„ç”¨äºæ•°æ®ç»‘å®š &lt;sf:hidden&gt; æ¸²æŸ“æˆä¸€ä¸ª HTML &lt;input&gt;æ ‡ç­¾å…¶ä¸­typeå±æ€§è®¾ç½®ä¸ºhidden &lt;sf:input&gt; æ¸²æŸ“æˆä¸€ä¸ª HTML &lt;input&gt;æ ‡ç­¾å…¶ä¸­typeå±æ€§è®¾ç½®ä¸ºtext &lt;sf:label&gt; æ¸²æŸ“æˆä¸€ä¸ª HTML &lt;label&gt;æ ‡ç­¾ &lt;sf:option&gt; æ¸²æŸ“æˆä¸€ä¸ª HTML &lt;option&gt;æ ‡ç­¾å…¶selectedå±æ€§æ ¹æ®æ‰€ç»‘å®šçš„å€¼è¿›è¡Œè®¾ç½® &lt;sf:options&gt; æŒ‰ç…§ç»‘å®šçš„é›†åˆã€æ•°ç»„æˆ– Map æ¸²æŸ“æˆä¸€ä¸ªHTML &lt;option&gt;æ ‡ç­¾çš„åˆ—è¡¨ &lt;sf:password&gt; æ¸²æŸ“æˆä¸€ä¸ª HTML &lt;input&gt;æ ‡ç­¾å…¶ä¸­typeå±æ€§è®¾ç½®ä¸ºpassword &lt;sf:radiobutton&gt; æ¸²æŸ“æˆä¸€ä¸ª HTML &lt;input&gt;æ ‡ç­¾å…¶ä¸­typeå±æ€§è®¾ç½®ä¸ºradio &lt;sf:radiobuttons&gt; æ¸²æŸ“æˆå¤šä¸ª HTML &lt;input&gt;æ ‡ç­¾å…¶ä¸­typeå±æ€§è®¾ç½®ä¸ºradio &lt;sf:select&gt; æ¸²æŸ“ä¸ºä¸€ä¸ª HTML &lt;select&gt;æ ‡ç­¾ &lt;sf:textarea&gt; æ¸²æŸ“ä¸ºä¸€ä¸ª HTML &lt;textarea&gt;æ ‡ç­¾ ThymeLeafThymeleaf æ¨¡æ¿æ˜¯åŸç”Ÿçš„,ä¸ä¾èµ–äºæ ‡ç­¾åº“ã€‚å®ƒèƒ½åœ¨æ¥å—åŸå§‹ HTML çš„åœ°æ–¹è¿›è¡Œç¼–è¾‘å’Œæ¸²æŸ“ã€‚å› ä¸ºå®ƒæ²¡æœ‰ä¸ Servlet è§„èŒƒè€¦åˆï¼Œå› æ­¤ Thymeleaf æ¨¡æ¿èƒ½å¤Ÿè¿›å…¥ JSP æ‰€æ— æ³•æ¶‰è¶³çš„é¢†åŸŸã€‚ ThymeleafViewResolverå°†é€»è¾‘è§†å›¾åç§°è§£æä¸º Thymeleaf æ¨¡æ¿è§†å›¾ï¼› SpringTemplateEngineå¤„ç†æ¨¡æ¿å¹¶æ¸²æŸ“ç»“æœï¼› TemplateResolveråŠ è½½ Thymeleaf æ¨¡æ¿ã€‚ 12345678910111213141516171819202122232425// thymeleaf è§†å›¾è§£æå™¨@Beanpublic ViewResolver viewResolver(TemplateEngine templateEngine)&#123; ThymeleafViewResolver viewResolver = new ThymeleafViewResolver(); viewResolver.setTemplateEngine(templateEngine); return viewResolver;&#125;// æ¨¡æ¿å¼•æ“@Beanpublic TemplateEngine templateEngine(TemplateResolver templateResolver)&#123; SpringTemplateEngine templateEngine = new SpringTemplateEngine(); templateEngine.setTemplateResolver(templateResolver); return templateEngine;&#125;// æ¨¡æ¿è§£æå™¨@Beanpublic ITemplateResolver templateResolver()&#123; SpringResourceTemplateResolver templateResolver = new SpringResourceTemplateResolver(); templateResolver.setPrefix(\"/WEB-INF/templates/\"); templateResolver.setSuffix(\".html\"); templateResolver.setTemplateMode(\"HTML5\") return templateResolver;&#125; Thymeleaf æ•™ç¨‹ æ–‡ä»¶ä¸Šä¼ ä¸€èˆ¬è¡¨å•æäº¤æ‰€å½¢æˆçš„è¯·æ±‚ç»“æœæ˜¯å¾ˆç®€å•çš„ï¼Œå°±æ˜¯ä»¥&amp;ç¬¦åˆ†å‰²çš„å¤šä¸ª name-value å¯¹ã€‚ å°½ç®¡è¿™ç§ç¼–ç å½¢å¼å¾ˆç®€å•ï¼Œå¹¶ä¸”å¯¹äºå…¸å‹çš„åŸºäºæ–‡æœ¬çš„è¡¨å•æäº¤ä¹Ÿè¶³å¤Ÿæ»¡è¶³è¦æ±‚ï¼Œä½†æ˜¯å¯¹äºä¼ é€äºŒè¿›åˆ¶æ•°æ®ï¼Œå¦‚ä¸Šä¼ å›¾ç‰‡ï¼Œå°±æ˜¾å¾—åŠ›ä¸ä»å¿ƒäº†ã€‚ä¸ä¹‹ä¸åŒçš„æ˜¯ï¼Œmultipart æ ¼å¼çš„æ•°æ®ä¼šå°†ä¸€ä¸ªè¡¨å•æ‹†åˆ†ä¸ºå¤šä¸ªéƒ¨åˆ†ï¼ˆpartï¼‰ï¼Œæ¯ä¸ªéƒ¨åˆ†å¯¹åº”ä¸€ä¸ªè¾“å…¥åŸŸã€‚åœ¨ä¸€èˆ¬çš„è¡¨å•è¾“å…¥åŸŸä¸­ï¼Œå®ƒæ‰€å¯¹åº”çš„éƒ¨åˆ†ä¸­ä¼šæ”¾ç½®æ–‡æœ¬å‹æ•°æ®ï¼Œä½†æ˜¯å¦‚æœä¸Šä¼ æ–‡ä»¶çš„è¯ï¼Œå®ƒæ‰€å¯¹åº”çš„éƒ¨åˆ†å¯ä»¥æ˜¯äºŒè¿›åˆ¶ã€‚ åœ¨ç¼–å†™æ§åˆ¶å™¨æ–¹æ³•å¤„ç†æ–‡ä»¶ä¸Šä¼ ä¹‹å‰æˆ‘ä»¬å¿…é¡»è¦é…ç½®ä¸€ä¸ª multipart è§£æå™¨é€šè¿‡å®ƒæ¥å‘Šè¯‰DispatcherServletè¯¥å¦‚ä½•è¯»å– multipart è¯·æ±‚ã€‚ 1234@Beanpublic MultipartResolver multipartResolver() throws IOException &#123; return new StandardServletMultipartResolver();&#125; åœ¨ Servlet registration ä¸Šè°ƒç”¨setMultipartConfig()æ–¹æ³•ä¼ å…¥ä¸€ä¸ªMultipartConfig-Elementå®ä¾‹ã€‚ 12345DispatcherServlet ds = new DispatchServlet();Dynamic registration = context.addServlet(\"appServlet\", ds);registration.addMapping(\"/\");// å°†ä¸´æ—¶è·¯å¾„è®¾ç½®ä¸º /tmp/spittr/uploadsregistration.setMultipartConfig(new MultipartConfigElement(\"/tmp/spittr/uploads\")); å¦‚æœæˆ‘ä»¬é…ç½®DispatcherServletçš„Servletåˆå§‹åŒ–ç±»ç»§æ‰¿äº†Abstract AnnotationConfigDispatcherServletInitializeræˆ–AbstractDispatcher-ServletInitializerçš„è¯é‚£ä¹ˆæˆ‘ä»¬ä¸ä¼šç›´æ¥åˆ›å»ºDispatcherServletå®ä¾‹å¹¶å°†å…¶æ³¨å†Œåˆ° Servlet ä¸Šä¸‹æ–‡ä¸­ã€‚è¿™æ ·çš„è¯å°†ä¸ä¼šæœ‰å¯¹Dynamic Servlet registration çš„å¼•ç”¨ä¾›æˆ‘ä»¬ä½¿ç”¨äº†ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡é‡è½½customizeRegistration()æ–¹æ³•å®ƒä¼šå¾—åˆ°ä¸€ä¸ªDynamicä½œä¸ºå‚æ•°æ¥é…ç½® multipart çš„å…·ä½“ç»†èŠ‚ã€‚ 123456@Overrideprotected void customizeRegistration(Dynamic registration) &#123; registration.setMultipartConfig( new MultipartConfigElement(\"/tmp/spittr/uploads\", 2097152, 4194304, 0); );&#125; 123456789101112&lt;servlet&gt; &lt;servlet-name&gt;appServlet&lt;/servlet-name&gt; &lt;servlet-class&gt; org.springframework.web.servlet.DispatchServlet &lt;/servlet-class&gt; &lt;load-on-startup&gt;1&lt;/load-on-startup&gt; &lt;multipart-config&gt; &lt;location&gt;/tmp/spittr/upload&lt;/location&gt; &lt;max-file-size&gt;2097152&lt;/max-file-size&gt; &lt;max-request-size&gt;4194304&lt;/max-request-size&gt; &lt;/multipart-config&gt;&lt;/servlet&gt; å¯¹äºé Servlet 3.0 ç¯å¢ƒï¼ŒSpring å†…ç½®äº† CommonsMultipartResolverï¼Œå¯ä»¥ä½œä¸º StandardServletMultipartResolver çš„æ›¿ä»£æ–¹æ¡ˆã€‚ @RequestPartæ³¨è§£æŒ‡å®šç”¨äºæ¥æ”¶è¯·æ±‚ä¸­å¯¹åº” part çš„æ•°ç»„ã€‚ 1234&lt;form method=\"POST\" th:object=\"$&#123;spitter&#125;\" enctype=\"multipart/form-data\"&gt; &lt;label&gt;Profile Picture&lt;/label&gt;: &lt;input type=\"file\" name=\"profilePicture\" accept=\"image/jpeg,image/png,image/gif\" /&gt;&lt;br/&gt;&lt;/form&gt; 1234567@RequestMapping(value=\"/register\", method=POST)public String processRegistration( @RequestPart(\"profilePicture\") byte[] profilePicture, @Valid Spittr spittr, Errors errors) &#123; // å°†æ–‡ä»¶ä¿å­˜åˆ°æŸä¸ªä½ç½®&#125; ä½¿ç”¨ä¸Šä¼ æ–‡ä»¶çš„åŸå§‹byteæ¯”è¾ƒç®€å•ä½†æ˜¯åŠŸèƒ½æœ‰é™ã€‚å› æ­¤ Spring è¿˜æä¾›äº†MultipartFileæ¥å£å®ƒä¸ºå¤„ç† multipart æ•°æ®æä¾›äº†å†…å®¹æ›´ä¸ºä¸°å¯Œçš„å¯¹è±¡ã€‚ 12345678910111213141516package org.springframework.web.multipart;import java.io.File;import java.io.IOException;import java.io.InputStream;public interface MultipartFile &#123; String getName(); String getOriginalFilename(); String getContentType(); boolean isEmpty(); long getSize(); byte[] getBytes() throws IOException; InputStream getInputStream() throws IOException; void transferTo(File dest) throws IOException;&#125; 12// å°†ä¸Šä¼ çš„æ–‡ä»¶å†™å…¥åˆ°æ–‡ä»¶ç³»ç»Ÿä¸­çš„ä¾¿æ·æ–¹æ³•profilePicture.tranferTo(new File(\"/data/spittr/\" + profilePicture.getOriginalFilename())); å¦‚å°†åº”ç”¨éƒ¨ç½²åˆ° Servlet 3.0 çš„å®¹å™¨ä¸­ï¼Œé‚£ä¹ˆä¼šæœ‰MultipartFileçš„ä¸€ä¸ªæ›¿ä»£æ–¹æ¡ˆã€‚Spring MVC ä¹Ÿèƒ½æ¥å—javax.servlet.http.Partä½œä¸ºæ§åˆ¶å™¨æ–¹æ³•çš„å‚æ•°ã€‚ Part æ¥å£ä¸MultipartFileå¹¶æ²¡æœ‰å¤ªå¤§çš„å·®åˆ«ï¼ŒPart æ¥å£ä¸­çš„ä¸€äº›æ–¹æ³•å…¶å®æ˜¯ä¸MultipartFileç›¸å¯¹åº”çš„ã€‚ å¼‚å¸¸å¤„ç† ç‰¹å®šçš„ Spring å¼‚å¸¸å°†ä¼šè‡ªåŠ¨æ˜ å°„ä¸ºæŒ‡å®šçš„ HTTP çŠ¶æ€ç ï¼› å¼‚å¸¸ä¸Šå¯ä»¥æ·»åŠ @ResponseStatusæ³¨è§£ä»è€Œå°†å…¶æ˜ å°„ä¸ºæŸä¸€ä¸ª HTTP çŠ¶æ€ç ï¼› åœ¨æ–¹æ³•ä¸Šå¯ä»¥æ·»åŠ @ExceptionHandleræ³¨è§£ä½¿å…¶ç”¨æ¥å¤„ç†å¼‚å¸¸ã€‚ Spring çš„ä¸€äº›å¼‚å¸¸ä¼šé»˜è®¤æ˜ å°„ä¸º HTTP çŠ¶æ€ç ã€‚ Springå¼‚å¸¸ HTTPçŠ¶æ€ç  BindException 400 - Bad Request ConversionNotSupportedException 500 - Internal Server Error HttpMediaTypeNotAcceptableException 406 - Not Acceptable HttpMediaTypeNotSupportedException 415 - Unsupported Media Type HttpMessageNotReadableException 400 - Bad Request HttpMessageNotWritableException 500 - Internal Server Error HttpRequestMethodNotSupportedException 405 - Method Not Allowed MethodArgumentNotValidException 400 - Bad Request MissingServletRequestParameterException 400 - Bad Request MissingServletRequestPartException 400 - Bad Request NoSuchRequestHandlingMethodException 404 - Not Found TypeMismatchException 400 - Bad Request 1234567891011@RequestMapping(value=\"/&#123;spittleId&#125;\", method=RequestMethod.GET)public String spittle( @PathVariable(\"spittleId\") long spittleId, Model model) &#123; Spittle spittle = spittleRepository.findOne(spittleId); if (spittle == null) &#123; // è‹¥æœªæ‰¾åˆ°æ­¤å¯¹è±¡åˆ™æŠ›å‡ºå¼‚å¸¸ throw new SpittleNotFoundException(); &#125; model.addAttribute(spittle); return \"spittle\";&#125; 12345678package spittr.web;import org.springframework.http.HttpStatus;import org.springframework.web.bind.annotation.ResponseStatus;@ResponseStatus(value=HttpStatus.NOT_FOUND, reason=\"Spittle Not Found\")public class SpittleNotFoundException extends RuntimeException &#123;&#125; åœ¨å¾ˆå¤šçš„åœºæ™¯ä¸‹ï¼Œå°†å¼‚å¸¸æ˜ å°„ä¸ºçŠ¶æ€ç æ˜¯å¾ˆç®€å•çš„æ–¹æ¡ˆï¼Œå¹¶ä¸”å°±åŠŸèƒ½æ¥è¯´ä¹Ÿè¶³å¤Ÿäº†ã€‚ä½†æ˜¯å¦‚æœæƒ³åœ¨å“åº”ä¸­ä¸ä»…è¦åŒ…æ‹¬çŠ¶æ€ç ï¼Œè¿˜è¦åŒ…å«æ‰€äº§ç”Ÿçš„é”™è¯¯ï¼Œé‚£è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿæ­¤æ—¶çš„è¯ï¼Œæˆ‘ä»¬å°±ä¸èƒ½å°†å¼‚å¸¸è§†ä¸º HTTP é”™è¯¯äº†ï¼Œè€Œæ˜¯è¦æŒ‰ç…§å¤„ç†è¯·æ±‚çš„æ–¹å¼æ¥å¤„ç†å¼‚å¸¸äº†ã€‚ 123456789101112// åœ¨å¤„ç†è¯·æ±‚çš„æ–¹æ³•ä¸­ç›´æ¥å¤„ç†å¼‚å¸¸@RequestMapping(method=RequestMethod.POST)public String saveSpittle(SpittleForm form, Model model) &#123; try &#123; spittleRepository.save( new Spittle(null, form.getMessage(), new Date(), form.getLongitude(), form.getLatitude()) ); return \"redirect:/spittles\"; &#125; catch (DuplicateSpittleException e) &#123; return \"error/duplicate\"; &#125;&#125; å®ƒè¿è¡Œèµ·æ¥æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ³•æœ‰äº›å¤æ‚ã€‚è¯¥æ–¹æ³•å¯ä»¥æœ‰ä¸¤ä¸ªè·¯å¾„ï¼Œæ¯ä¸ªè·¯å¾„ä¼šæœ‰ä¸åŒçš„è¾“å‡ºã€‚å¦‚æœèƒ½è®©saveSpittle()æ–¹æ³•åªå…³æ³¨æ­£ç¡®çš„è·¯å¾„ï¼Œè€Œè®©å…¶ä»–æ–¹æ³•å¤„ç†å¼‚å¸¸çš„è¯ï¼Œé‚£ä¹ˆå®ƒå°±èƒ½ç®€å•ä¸€äº›ã€‚ 123456789101112@RequestMapping(method=RequestMethod.POST)public String saveSpittle(SpittleForm form, Model model) &#123; spittleRepository.save( new Spittle(null, form.getMessage(), new Date(), form.getLongitude(), form.getLatitude()) ); return \"redirect:/spittles\";&#125;@ExceptionHandler(DuplicateSpittleException.class)public String handleDuplicateSpittle() &#123; return \"error/duplicate\";&#125; å¦‚æœè¦åœ¨å¤šä¸ªæ§åˆ¶å™¨ä¸­å¤„ç†å¼‚å¸¸é‚£@ExceptionHandleræ³¨è§£æ‰€æ ‡æ³¨çš„æ–¹æ³•æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚ä¸è¿‡å¦‚æœå¤šä¸ªæ§åˆ¶å™¨ç±»ä¸­éƒ½ä¼šæŠ›å‡ºæŸä¸ªç‰¹å®šçš„å¼‚å¸¸é‚£ä¹ˆä½ å¯èƒ½ä¼šå‘ç°è¦åœ¨æ‰€æœ‰çš„æ§åˆ¶å™¨æ–¹æ³•ä¸­é‡å¤ç›¸åŒçš„@ExceptionHandleræ–¹æ³•ã€‚æˆ–è€…ä¸ºäº†é¿å…é‡å¤æˆ‘ä»¬ä¼šåˆ›å»ºä¸€ä¸ªåŸºç¡€çš„æ§åˆ¶å™¨ç±»æ‰€æœ‰æ§åˆ¶å™¨ç±»è¦æ‰©å±•è¿™ä¸ªç±»ä»è€Œç»§æ‰¿é€šç”¨çš„@ExceptionHandleræ–¹æ³•ã€‚ Spring 3.2 ä¸ºè¿™ç±»é—®é¢˜å¼•å…¥äº†ä¸€ä¸ªæ–°çš„è§£å†³æ–¹æ¡ˆæ§åˆ¶å™¨é€šçŸ¥ã€‚æ§åˆ¶å™¨é€šçŸ¥ controller advice æ˜¯ä»»æ„å¸¦æœ‰@ControllerAdviceæ³¨è§£çš„ç±»è¿™ä¸ªç±»ä¼šåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªå¦‚ä¸‹ç±»å‹çš„æ–¹æ³• @ExceptionHandleræ³¨è§£æ ‡æ³¨çš„æ–¹æ³•ï¼› @InitBinderæ³¨è§£æ ‡æ³¨çš„æ–¹æ³•ï¼› @ModelAttributeæ³¨è§£æ ‡æ³¨çš„æ–¹æ³•ã€‚ 1234567@ControllerAdvicepublic class AppWideExceptionHandler &#123; @ExceptionHandler(DuplicateSpittleException.class) public String handleNotFound() &#123; return \"error/duplicate\"; &#125;&#125; é‡å®šå‘åœ¨å¤„ç†å®Œ POST è¯·æ±‚åé€šå¸¸æ¥è®²ä¸€ä¸ªæœ€ä½³å®è·µå°±æ˜¯æ‰§è¡Œä¸€ä¸‹é‡å®šå‘ã€‚é™¤äº†å…¶ä»–çš„ä¸€äº›å› ç´ å¤–ï¼Œè¿™æ ·åšèƒ½å¤Ÿé˜²æ­¢ç”¨æˆ·ç‚¹å‡»æµè§ˆå™¨çš„åˆ·æ–°æŒ‰é’®æˆ–åé€€ç®­å¤´æ—¶å®¢æˆ·ç«¯é‡æ–°æ‰§è¡Œå±é™©çš„ POST è¯·æ±‚ã€‚ å½“æ§åˆ¶å™¨æ–¹æ³•è¿”å›çš„Stringå€¼ä»¥â€œredirect:â€å¼€å¤´çš„è¯é‚£ä¹ˆè¿™ä¸ªStringä¸æ˜¯ç”¨æ¥æŸ¥æ‰¾è§†å›¾çš„è€Œæ˜¯ç”¨æ¥æŒ‡å¯¼æµè§ˆå™¨è¿›è¡Œé‡å®šå‘çš„è·¯å¾„ã€‚ 1return &quot;redirect:&#x2F;spitter&#x2F;&quot; + spitter.getUsername(); æ¨¡å‹çš„å±æ€§æ˜¯ä»¥è¯·æ±‚å±æ€§çš„å½¢å¼å­˜æ”¾åœ¨è¯·æ±‚ä¸­çš„åœ¨é‡å®šå‘åæ— æ³•å­˜æ´»ã€‚ ä½¿ç”¨ URL æ¨¡æ¿ä»¥è·¯å¾„å˜é‡å’Œ / æˆ–æŸ¥è¯¢å‚æ•°çš„å½¢å¼ä¼ é€’æ•°æ®ï¼› é€šè¿‡ flash å±æ€§å‘é€æ•°æ®ã€‚ 123456@RequestMapping(value=\"/register\", method=POST);public String processRegistration(Spitter spitter, Model model) &#123; spitterRepository.save(spitter); model.addAttribute(\"username\", spitter.getUsername()); return \"redirect:/spitter/&#123;username&#125;\";&#125; é™¤æ­¤ä¹‹å¤–ï¼Œæ¨¡å‹ä¸­æ‰€æœ‰å…¶ä»–çš„åŸå§‹ç±»å‹å€¼éƒ½å¯ä»¥æ·»åŠ åˆ° URL ä¸­ä½œä¸ºæŸ¥è¯¢å‚æ•°ã€‚ 1234567@RequestMapping(value=\"/register\", method=POST)public String processRegistration(Spitter spitter, Model model) &#123; spitterRepository.save(spitter); model.addAttribute(\"username\", spitter.getUsername()); model.addAttribute(\"spitterId\", spitter.getId()); // ä¼šä»¥æŸ¥è¯¢å‚æ•°çš„å½¢å¼è¿›è¡Œé‡å®šå‘ return \"redirect:/spitter/&#123;username&#125;\";&#125; å¦‚æœ username å±æ€§çš„å€¼æ˜¯ habuma å¹¶ä¸” spitterId å±æ€§çš„å€¼æ˜¯ 42ï¼Œé‚£ä¹ˆç»“æœå¾—åˆ°çš„é‡å®šå‘ URL è·¯å¾„å°†ä¼šæ˜¯ /spitter/habuma?spitterId=42ã€‚ åœ¨ URL ä¸­ï¼Œå¹¶æ²¡æœ‰åŠæ³•å‘é€æ›´ä¸ºå¤æ‚çš„å€¼ï¼Œä½†è¿™æ­£æ˜¯flashå±æ€§èƒ½å¤Ÿæä¾›å¸®åŠ©çš„é¢†åŸŸã€‚ Spring æä¾›äº†é€šè¿‡RedirectAttributesè®¾ç½® flash å±æ€§çš„æ–¹æ³•ï¼Œè¿™æ˜¯ Spring 3.1 å¼•å…¥çš„Modelçš„ä¸€ä¸ªå­æ¥å£ã€‚RedirectAttributesæä¾›äº†Modelçš„æ‰€æœ‰åŠŸèƒ½é™¤æ­¤ä¹‹å¤–è¿˜æœ‰å‡ ä¸ªæ–¹æ³•æ˜¯ç”¨æ¥è®¾ç½® flash å±æ€§çš„ã€‚ 1234567@RequestMapping(value=\"/register\", method=POST)public String processRegistration(Spitter spitter, RedirectAttribute model) &#123; spitterRespository.save(spitter); model.addAttribute(\"username\", spitter.getUsername()); model.addFlashAttribute(\"spitter\", spitter); // flash å±æ€§ return \"redirect:/spitter/&#123;username&#125;\";&#125; å®‰å…¨ Spring Security ä»‹ç»ï¼› ä½¿ç”¨ Servlet è§„èŒƒä¸­çš„ Filter ä¿æŠ¤Webåº”ç”¨ï¼› åŸºäºæ•°æ®åº“å’Œ LDAP è¿›è¡Œè®¤è¯ã€‚ Spring Security æ˜¯ä¸ºåŸºäº Spring çš„åº”ç”¨ç¨‹åºæä¾›å£°æ˜å¼å®‰å…¨ä¿æŠ¤çš„å®‰å…¨æ€§æ¡†æ¶ã€‚Spring Security æä¾›äº†å®Œæ•´çš„å®‰å…¨æ€§è§£å†³æ–¹æ¡ˆï¼Œèƒ½å¤Ÿåœ¨ Web è¯·æ±‚çº§åˆ«å’Œæ–¹æ³•è°ƒç”¨çº§åˆ«å¤„ç†èº«ä»½è®¤è¯å’Œæˆæƒã€‚å› ä¸ºåŸºäº Spring æ¡†æ¶æ‰€ä»¥ Spring Security å……åˆ†åˆ©ç”¨äº†ä¾èµ–æ³¨å…¥ dependency injectionDI å’Œé¢å‘åˆ‡é¢çš„æŠ€æœ¯ã€‚ Spring Security ä»ä¸¤ä¸ªè§’åº¦æ¥è§£å†³å®‰å…¨æ€§é—®é¢˜ã€‚å®ƒä½¿ç”¨ Servlet è§„èŒƒä¸­çš„ Filter ä¿æŠ¤ Web è¯·æ±‚å¹¶é™åˆ¶ URL çº§åˆ«çš„è®¿é—®ã€‚Spring Security è¿˜èƒ½å¤Ÿä½¿ç”¨ Spring AOP ä¿æŠ¤æ–¹æ³•è°ƒç”¨â€”â€”å€ŸåŠ©äºå¯¹è±¡ä»£ç†å’Œä½¿ç”¨é€šçŸ¥èƒ½å¤Ÿç¡®ä¿åªæœ‰å…·å¤‡é€‚å½“æƒé™çš„ç”¨æˆ·æ‰èƒ½è®¿é—®å®‰å…¨ä¿æŠ¤çš„æ–¹æ³•ã€‚ Spring Security è¢«åˆ†æˆäº†11ä¸ªæ¨¡å—ã€‚ æ¨¡ å— æ è¿° ACL æ”¯æŒé€šè¿‡è®¿é—®æ§åˆ¶åˆ—è¡¨ access control list ä¸ºåŸŸå¯¹è±¡æä¾›å®‰å…¨æ€§ Aspects å½“ä½¿ç”¨ Spring Security æ³¨è§£æ—¶ï¼Œä¼šä½¿ç”¨åŸºäº AspectJ çš„åˆ‡é¢ï¼Œè€Œä¸æ˜¯ä½¿ç”¨æ ‡å‡†çš„ Spring AOP CAS Client æä¾›ä¸ Jasig çš„ä¸­å¿ƒè®¤è¯æœåŠ¡ Central Authentication Service è¿›è¡Œé›†æˆçš„åŠŸèƒ½ Configuration åŒ…å«é€šè¿‡ XML å’Œ Java é…ç½® Spring Security çš„åŠŸèƒ½æ”¯æŒ Core æä¾› Spring Security åŸºæœ¬åº“ Cryptography æä¾›äº†åŠ å¯†å’Œå¯†ç ç¼–ç çš„åŠŸèƒ½ LDAP æ”¯æŒåŸºäº LDAP è¿›è¡Œè®¤è¯ OpenID æ”¯æŒä½¿ç”¨ OpenID è¿›è¡Œé›†ä¸­å¼è®¤è¯ Remoting æä¾›äº†å¯¹ Spring Remoting çš„æ”¯æŒ Tag Library Spring Security çš„ JSP æ ‡ç­¾åº“ Web æä¾›äº† Spring Security åŸºäº Filter çš„ Web å®‰å…¨æ€§æ”¯æŒ Spring Security å€ŸåŠ©ä¸€ç³»åˆ— Servlet Filter æ¥æä¾›å„ç§å®‰å…¨æ€§åŠŸèƒ½ã€‚è¿™æ˜¯å¦æ„å‘³ç€æˆ‘ä»¬éœ€è¦åœ¨ web.xml æˆ–WebApplicationInitializerä¸­é…ç½®å¤šä¸ª Filter å‘¢ï¼Ÿå®é™…ä¸Šå€ŸåŠ©äº Spring çš„å°æŠ€å·§æˆ‘ä»¬åªéœ€é…ç½®ä¸€ä¸ª Filter å°±å¯ä»¥äº†ã€‚ DelegatingFilterProxyæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ Servlet Filter å®ƒæœ¬èº«æ‰€åšçš„å·¥ä½œå¹¶ä¸å¤šã€‚åªæ˜¯å°†å·¥ä½œå§”æ‰˜ç»™ä¸€ä¸ªjavax.servlet.Filterå®ç°ç±»è¿™ä¸ªå®ç°ç±»ä½œä¸ºä¸€ä¸ª&lt;bean&gt;æ³¨å†Œåœ¨ Spring åº”ç”¨çš„ä¸Šä¸‹æ–‡ã€‚ ä¸ç®¡æˆ‘ä»¬é€šè¿‡ web.xml è¿˜æ˜¯é€šè¿‡AbstractSecurityWebApplicationInitializerçš„å­ç±»æ¥é…ç½®DelegatingFilterProxyå®ƒéƒ½ä¼šæ‹¦æˆªå‘å¾€åº”ç”¨ä¸­çš„è¯·æ±‚å¹¶å°†è¯·æ±‚å§”æ‰˜ç»™IDä¸ºspringSecurityFilterChain beanã€‚ springSecurityFilterChainæœ¬èº«æ˜¯å¦ä¸€ä¸ªç‰¹æ®Šçš„ Filterï¼Œå®ƒä¹Ÿè¢«ç§°ä¸ºFilterChainProxyã€‚å®ƒå¯ä»¥é“¾æ¥ä»»æ„ä¸€ä¸ªæˆ–å¤šä¸ªå…¶ä»–çš„ Filterã€‚Spring Security ä¾èµ–ä¸€ç³»åˆ— Servlet Filter æ¥æä¾›ä¸åŒçš„å®‰å…¨ç‰¹æ€§ã€‚ä¸éœ€è¦çŸ¥é“è¿™äº›ç»†èŠ‚å› ä¸ºå¼€å‘ä¸­ä¸éœ€è¦æ˜¾å¼å£°æ˜springSecurityFilterChainä»¥åŠå®ƒæ‰€é“¾æ¥åœ¨ä¸€èµ·çš„å…¶ä»– Filterã€‚å½“æˆ‘ä»¬å¯ç”¨ Web å®‰å…¨æ€§çš„æ—¶å€™ä¼šè‡ªåŠ¨åˆ›å»ºè¿™äº›Filterã€‚ ç®€å•çš„å®‰å…¨æ€§é…ç½® æ–¹ æ³• æ è¿° configure(WebSecurity) é€šè¿‡é‡è½½é…ç½® Spring Security çš„ Filter é“¾ configure(HttpSecurity) é€šè¿‡é‡è½½é…ç½®å¦‚ä½•é€šè¿‡æ‹¦æˆªå™¨ä¿æŠ¤è¯·æ±‚ configure(AuthenticationManagerBuilder) é€šè¿‡é‡è½½é…ç½® user-detail æœåŠ¡ @EnableWebSecurityæ³¨è§£å°†ä¼šå¯ç”¨ Web å®‰å…¨åŠŸèƒ½ã€‚ä½†å®ƒæœ¬èº«å¹¶æ²¡æœ‰ä»€ä¹ˆç”¨å¤„ Spring Security å¿…é¡»é…ç½®åœ¨ä¸€ä¸ªå®ç°äº†WebSecurityConfigurerçš„ bean ä¸­æˆ–è€…ç®€å•èµ·è§æ‰©å±•WebSecurityConfigurerAdapterã€‚ @EnableWebSecurityå¯ä»¥å¯ç”¨ä»»æ„ Web åº”ç”¨çš„å®‰å…¨æ€§åŠŸèƒ½ï¼Œä¸è¿‡å¦‚æœæ˜¯ä½¿ç”¨ Spring MVC å¼€å‘çš„é‚£ä¹ˆå°±åº”è¯¥è€ƒè™‘ä½¿ç”¨@EnableWebMvcSecurity`æ›¿ä»£å®ƒã€‚ 12345678910111213@Configuration@EnableWebMvcSecuritypublic class SecurityConfig extends WebSecurityConfigurerAdapter &#123; @Override protected void configure(AuthenticationManagerBuilder auth) throws Exception &#123; auth .inMemoryAuthentication() .withUser(\"user\").password(\"password\").roles(\"USER\") .and .withUser(\"user\").password(\"password\").authorities(\"ROLE_USER\"); // ç­‰ä»· &#125;&#125; AuthenticationManagerBuilderæœ‰å¤šä¸ªæ–¹æ³•ç”¨æ¥é…ç½® Spring Security å¯¹è®¤è¯çš„æ”¯æŒã€‚é€šè¿‡inMemoryAuthentication()æ–¹æ³•æˆ‘ä»¬å¯ä»¥å¯ç”¨ã€é…ç½®å¹¶ä»»æ„å¡«å……åŸºäºå†…å­˜çš„ç”¨æˆ·å­˜å‚¨ã€‚ withUser()æ–¹æ³•è¿”å›çš„æ˜¯UserDetailsManagerConfigurer.UserDetailsBuilderï¼Œè¿™ä¸ªå¯¹è±¡æä¾›äº†å¤šä¸ªè¿›ä¸€æ­¥é…ç½®ç”¨æˆ·çš„æ–¹æ³•åŒ…æ‹¬è®¾ç½®ç”¨æˆ·å¯†ç çš„password()æ–¹æ³•ä»¥åŠä¸ºç»™å®šç”¨æˆ·æˆäºˆä¸€ä¸ªæˆ–å¤šä¸ªè§’è‰²æƒé™çš„roles()æ–¹æ³•ã€‚ é…ç½®ç”¨æˆ·è¯¦ç»†ä¿¡æ¯çš„æ–¹æ³•ã€‚ æ–¹ æ³• æ è¿° accountExpired(boolean) å®šä¹‰è´¦å·æ˜¯å¦å·²ç»è¿‡æœŸ accountLocked(boolean) å®šä¹‰è´¦å·æ˜¯å¦å·²ç»é”å®š and() ç”¨æ¥è¿æ¥é…ç½® authorities(GrantedAuthority...) æˆäºˆæŸä¸ªç”¨æˆ·ä¸€é¡¹æˆ–å¤šé¡¹æƒé™ authorities(List) æˆäºˆæŸä¸ªç”¨æˆ·ä¸€é¡¹æˆ–å¤šé¡¹æƒé™ authorities(String...) æˆäºˆæŸä¸ªç”¨æˆ·ä¸€é¡¹æˆ–å¤šé¡¹æƒé™ credentialsExpired(boolean) å®šä¹‰å‡­è¯æ˜¯å¦å·²ç»è¿‡æœŸ disabled(boolean) å®šä¹‰è´¦å·æ˜¯å¦å·²è¢«ç¦ç”¨ password(String) å®šä¹‰ç”¨æˆ·çš„å¯†ç  roles(String...) æˆäºˆæŸä¸ªç”¨æˆ·ä¸€é¡¹æˆ–å¤šé¡¹è§’è‰² åŸºäºæ•°æ®åº“è¡¨è®¤è¯ç”¨æˆ·æ•°æ®é€šå¸¸ä¼šå­˜å‚¨åœ¨å…³ç³»å‹æ•°æ®åº“ä¸­å¹¶é€šè¿‡ JDBC è¿›è¡Œè®¿é—®ã€‚ä¸ºäº†é…ç½® Spring Security ä½¿ç”¨ä»¥ JDBC ä¸ºæ”¯æ’‘çš„ç”¨æˆ·å­˜å‚¨ï¼Œå¯ä»¥ä½¿ç”¨jdbcAuthentication()æ–¹æ³•ã€‚ 123456789101112@Overrideprotected void configure(AuthenticationManagerBuilder auth) throws Exception &#123; auth .jdbcAuthentication() .dataSource(dataSource) .usersByUsernameQuery( \"select username, password, true \" + \"from Spitter where username=?\") .authoritiesByUsernameQuery( \"select username, 'ROLE_USER' from Spitter where username=?\") .passwordEncoder(new StandardPasswordEnconder(\"123456\"));&#125; passwordEncoder()æ–¹æ³•å¯ä»¥æ¥å— Spring Security ä¸­PasswordEncoderæ¥å£çš„ä»»æ„å®ç°ã€‚Spring Security çš„åŠ å¯†æ¨¡å—åŒ…æ‹¬äº†ä¸‰ä¸ªè¿™æ ·çš„å®ç°BCryptPasswordEncoderã€NoOpPasswordEncoderå’ŒStandardPasswordEncoderã€‚ åŸºäº LDAPè®¤è¯LDAPï¼ˆLight Directory Access Portocolï¼‰ï¼Œå®ƒæ˜¯åŸºäº X.500 æ ‡å‡†çš„è½»é‡çº§ç›®å½•è®¿é—®åè®®ã€‚ æ‹¦æˆªè¯·æ±‚é€‚é‡åœ°åº”ç”¨å®‰å…¨æ€§ã€‚ åœ¨ä»»ä½•åº”ç”¨ä¸­å¹¶ä¸æ˜¯æ‰€æœ‰çš„è¯·æ±‚éƒ½éœ€è¦åŒç­‰ç¨‹åº¦åœ°ä¿æŠ¤ã€‚æœ‰äº›è¯·æ±‚éœ€è¦è®¤è¯è€Œå¦ä¸€äº›å¯èƒ½å¹¶ä¸éœ€è¦ã€‚æœ‰äº›è¯·æ±‚å¯èƒ½åªæœ‰å…·å¤‡ç‰¹å®šæƒé™çš„ç”¨æˆ·æ‰èƒ½è®¿é—®æ²¡æœ‰è¿™äº›æƒé™çš„ç”¨æˆ·ä¼šæ— æ³•è®¿é—®ã€‚ å¯¹æ¯ä¸ªè¯·æ±‚è¿›è¡Œç»†ç²’åº¦å®‰å…¨æ€§æ§åˆ¶çš„å…³é”®åœ¨äºé‡è½½configure(HttpSecurity)æ–¹æ³•ã€‚ 123456789@Overrideprotected void configure(HttpSecurity http) throws Exception &#123; http .authorizeRequests() .antMatchers(\"/spitters/me\").hasAuthority(\"ROLE_SPITTER\") // è·¯å¾„å¯ä½¿ç”¨ Ant é£æ ¼çš„é€šé…ç¬¦ .antMatchers(HttpMethoed.POST, \"/spitters\").hasAuthority(\"ROLE_SPITTER\") // .antMatchers(HttpMethoed.POST, \"/spitters\").hasRole(\"SPITTER\") åŒä¸Š .anyRequest().permitAll();&#125; ç”¨æ¥å®šä¹‰å¦‚ä½•ä¿æŠ¤è·¯å¾„çš„é…ç½®æ–¹æ³•ã€‚ æ–¹ æ³• èƒ½å¤Ÿåšä»€ä¹ˆ access(String) å¦‚æœç»™å®šçš„SpELè¡¨è¾¾å¼è®¡ç®—ç»“æœä¸ºtrueå°±å…è®¸è®¿é—® anonymous() å…è®¸åŒ¿åç”¨æˆ·è®¿é—® authenticated() å…è®¸è®¤è¯è¿‡çš„ç”¨æˆ·è®¿é—® denyAll() æ— æ¡ä»¶æ‹’ç»æ‰€æœ‰è®¿é—® fullyAuthenticated() å¦‚æœç”¨æˆ·æ˜¯å®Œæ•´è®¤è¯çš„è¯ä¸æ˜¯é€šè¿‡ Remember-me åŠŸèƒ½è®¤è¯çš„å°±å…è®¸è®¿é—® hasAnyAuthority(String...) å¦‚æœç”¨æˆ·å…·å¤‡ç»™å®šæƒé™ä¸­çš„æŸä¸€ä¸ªçš„è¯å°±å…è®¸è®¿é—® hasAnyRole(String...) å¦‚æœç”¨æˆ·å…·å¤‡ç»™å®šè§’è‰²ä¸­çš„æŸä¸€ä¸ªçš„è¯å°±å…è®¸è®¿é—® hasAuthority(String) å¦‚æœç”¨æˆ·å…·å¤‡ç»™å®šæƒé™çš„è¯å°±å…è®¸è®¿é—® hasIpAddress(String) å¦‚æœè¯·æ±‚æ¥è‡ªç»™å®š IP åœ°å€çš„è¯å°±å…è®¸è®¿é—® hasRole(String) å¦‚æœç”¨æˆ·å…·å¤‡ç»™å®šè§’è‰²çš„è¯å°±å…è®¸è®¿é—® not() å¯¹å…¶ä»–è®¿é—®æ–¹æ³•çš„ç»“æœæ±‚å permitAll() æ— æ¡ä»¶å…è®¸è®¿é—® rememberMe() å¦‚æœç”¨æˆ·æ˜¯é€šè¿‡Remember-meåŠŸèƒ½è®¤è¯çš„å°±å…è®¸è®¿é—® ä¸Šè¡¨ä¸­çš„å¤§å¤šæ•°æ–¹æ³•éƒ½æ˜¯ä¸€ç»´çš„ï¼Œä¾‹å¦‚ä½¿ç”¨hasRole()é™åˆ¶æŸä¸ªç‰¹å®šçš„è§’è‰²çš„åŒæ—¶ä¸èƒ½åœ¨ç›¸åŒçš„è·¯å¾„ä¸ŠåŒæ—¶é€šè¿‡hasIpAddress()é™åˆ¶ç‰¹å®šçš„ IP åœ°å€ã€‚ å€ŸåŠ©access()æ–¹æ³•æˆ‘ä»¬ä¹Ÿå¯ä»¥å°† SpEL ä½œä¸ºå£°æ˜è®¿é—®é™åˆ¶çš„ä¸€ç§æ–¹å¼ã€‚ å®‰å…¨è¡¨è¾¾å¼ è®¡ ç®— ç»“ æœ authentication ç”¨æˆ·çš„è®¤è¯å¯¹è±¡ denyAll ç»“æœå§‹ç»ˆä¸º false hasAnyRole(list of roles) å¦‚æœç”¨æˆ·è¢«æˆäºˆäº†åˆ—è¡¨ä¸­ä»»æ„çš„æŒ‡å®šè§’è‰²ç»“æœä¸º true hasRole(role) å¦‚æœç”¨æˆ·è¢«æˆäºˆäº†æŒ‡å®šçš„è§’è‰²ç»“æœä¸º true hasIpAddress(IP Address) å¦‚æœè¯·æ±‚æ¥è‡ªæŒ‡å®šIPçš„è¯ç»“æœä¸º true isAnonymous() å¦‚æœå½“å‰ç”¨æˆ·ä¸ºåŒ¿åç”¨æˆ·ç»“æœä¸º true isAuthenticated() å¦‚æœå½“å‰ç”¨æˆ·è¿›è¡Œäº†è®¤è¯çš„è¯ç»“æœä¸º true isFullyAuthenticated() å¦‚æœå½“å‰ç”¨æˆ·è¿›è¡Œäº†å®Œæ•´è®¤è¯çš„è¯ï¼Œå³é Remember-me åŠŸèƒ½è¿›è¡Œçš„è®¤è¯ç»“æœä¸º true isRememberMe() å¦‚æœå½“å‰ç”¨æˆ·æ˜¯é€šè¿‡ Remember-me è‡ªåŠ¨è®¤è¯çš„ç»“æœä¸º true permitAll ç»“æœå§‹ç»ˆä¸º true principal ç”¨æˆ·çš„ principal å¯¹è±¡ 12.antMatchers(\"/spitter/me\").access(\"hasRole('ROLE_SPITTER') and hasIpAddress('192.168.1.2')\"); // äºŒç»´è®¤è¯ å¼ºåˆ¶é€šé“çš„å®‰å…¨æ€§å¯¹äºæ•æ„Ÿçš„ä¿¡æ¯ï¼Œä¸ºäº†ä¿è¯æ³¨å†Œè¡¨å•çš„æ•°æ®é€šè¿‡ HTTPS ä¼ é€ï¼Œå¯ä»¥åœ¨é…ç½®ä¸­æ·»åŠ requiresChannel()æ–¹æ³•ã€‚ 1234567891011@Overrideprotected void configure(HttpSecurity http) throws Exception &#123; http .authorizeRequests() .antMatchers(\"/spitter/me\").hasRole(\"SPITTER\") .antMatchers(HttpMethod.POST, \"/spittles\").hasRole(\"SPITTER\") .anyRequest().permitAll() .and() .requeresChannel() .antMatchers(\"/spitter/form\").requiresSecure(); // éœ€è¦ HTTPS&#125; ä¸è®ºä½•æ—¶åªè¦æ˜¯å¯¹ â€œ/spitter/formâ€ çš„è¯·æ±‚ï¼ŒSpring Security éƒ½è§†ä¸ºéœ€è¦å®‰å…¨é€šé“é€šè¿‡è°ƒç”¨requiresChannel()ç¡®å®šçš„å¹¶è‡ªåŠ¨å°†è¯·æ±‚é‡å®šå‘åˆ° HTTPS ä¸Šã€‚ ä¸ä¹‹ç›¸åæœ‰äº›é¡µé¢å¹¶ä¸éœ€è¦é€šè¿‡ HTTPS ä¼ é€ï¼Œå¯ä»¥ä½¿ç”¨requiresInsecure()ä»£æ›¿requiresSecure()æ–¹æ³•å°†é¦–é¡µå£°æ˜ä¸ºå§‹ç»ˆé€šè¿‡ HTTP ä¼ é€ã€‚ é˜²æ­¢è·¨ç«™è¯·æ±‚ä¼ªé€ å¦‚æœä¸€ä¸ªç«™ç‚¹æ¬ºéª—ç”¨æˆ·æäº¤è¯·æ±‚åˆ°å…¶ä»–æœåŠ¡å™¨çš„è¯å°±ä¼šå‘ç”Ÿ cross-site request forgery CSRF æ”»å‡»ã€‚ Spring Security é€šè¿‡ä¸€ä¸ªåŒæ­¥ token çš„æ–¹å¼æ¥å®ç° CSRF é˜²æŠ¤çš„åŠŸèƒ½ã€‚å®ƒå°†ä¼šæ‹¦æˆªçŠ¶æ€å˜åŒ–çš„è¯·æ±‚ï¼Œä¾‹å¦‚éGETã€HEADã€OPTIONSå’ŒTRACEçš„è¯·æ±‚å¹¶æ£€æŸ¥ CSRF tokenã€‚å¦‚æœè¯·æ±‚ä¸­ä¸åŒ…å« CSRF token çš„è¯æˆ–è€… token ä¸èƒ½ä¸æœåŠ¡å™¨ç«¯çš„ token ç›¸åŒ¹é…è¯·æ±‚å°†ä¼šå¤±è´¥å¹¶æŠ›å‡ºCsrfExceptionå¼‚å¸¸ã€‚ è¿™æ„å‘³ç€åœ¨ä½ çš„åº”ç”¨ä¸­æ‰€æœ‰çš„è¡¨å•å¿…é¡»åœ¨ä¸€ä¸ª â€œ_csrfâ€ åŸŸä¸­æäº¤ token è€Œä¸”è¿™ä¸ª token å¿…é¡»è¦ä¸æœåŠ¡å™¨ç«¯è®¡ç®—å¹¶å­˜å‚¨çš„ token ä¸€è‡´è¿™æ ·çš„è¯å½“è¡¨å•æäº¤çš„æ—¶å€™æ‰èƒ½è¿›è¡ŒåŒ¹é…ã€‚ 12345&lt;!-- Thymeleaf åªè¦ &lt;form&gt; æ ‡ç­¾çš„ action å±æ€§æ·»åŠ äº† Thymeleaf å‘½åç©ºé—´å‰ç¼€åˆ™ä¼šè‡ªåŠ¨ç”Ÿæˆ â€œ_csrfâ€ éšè—åŸŸ --&gt;&lt;form method=\"POST\" th:action=\"@&#123;/spittles&#125;\"&gt;&lt;/form&gt;&lt;!-- JSP --&gt;&lt;input type=\"hidden\" name=\"$&#123;_csrf.parameterName&#125;\" value=\"$&#123;_csrf.token&#125;\" /&gt; 12345678// æ‰‹åŠ¨ç¦ç”¨ï¼Œä¸æ¨è@Overrideprotected void configure(HttpSecurity http) throws Exception &#123; http // ... .csrf() .disable();&#125; è®¤è¯ç”¨æˆ·é¡µé¢å®é™…ä¸Šåœ¨é‡å†™configure(HttpSecurity)ä¹‹å‰æˆ‘ä»¬éƒ½èƒ½ä½¿ç”¨ä¸€ä¸ªç®€å•å´åŠŸèƒ½å®Œå¤‡çš„ç™»å½•é¡µã€‚ä½†æ˜¯ä¸€æ—¦é‡å†™äº†configure(HttpSecurity)æ–¹æ³•å°±å¤±å»äº†è¿™ä¸ªç®€å•çš„ç™»å½•é¡µé¢ã€‚ 12345678910111213@Overrideprotected void configure(HttpSecurity http) throws Exception &#123; http .formLogin() // æŒ‡å®šè‡ªå®šä¹‰çš„ç™»å½•é¡µé¢çš„è®¿é—®è·¯å¾„ .and() .authorizeRequests() .antMatchers(\"/spitter/me\").hasRole(\"SPITTER\") .antMatchers(HttpMethod.POST, \"/spittles\").hasRole(\"SPITTER\") .anyRequest().permitAll() .and() .requeresChannel() .antMatchers(\"/spitter/form\").requiresSecure();&#125; HTTP Basic è®¤è¯ï¼ˆHTTP Basic Authenticationï¼‰ä¼šç›´æ¥é€šè¿‡ HTTP è¯·æ±‚æœ¬èº«ï¼Œå¯¹è¦è®¿é—®åº”ç”¨ç¨‹åºçš„ç”¨æˆ·è¿›è¡Œè®¤è¯ã€‚ä½ å¯èƒ½åœ¨ä»¥å‰è§è¿‡ HTTP Basic è®¤è¯ã€‚å½“åœ¨ Web æµè§ˆå™¨ä¸­ä½¿ç”¨æ—¶ï¼Œå®ƒå°†å‘ç”¨æˆ·å¼¹å‡ºä¸€ä¸ªç®€å•çš„æ¨¡æ€å¯¹è¯æ¡†ã€‚ ä½†è¿™åªæ˜¯ Web æµè§ˆå™¨çš„æ˜¾ç¤ºæ–¹å¼ã€‚æœ¬è´¨ä¸Šï¼Œè¿™æ˜¯ä¸€ä¸ª HTTP 401 å“åº”ï¼Œ è¡¨æ˜å¿…é¡»è¦åœ¨è¯·æ±‚ä¸­åŒ…å«ä¸€ä¸ªç”¨æˆ·åå’Œå¯†ç ã€‚åœ¨ REST å®¢æˆ·ç«¯å‘å®ƒä½¿ç”¨çš„æœåŠ¡è¿›è¡Œè®¤è¯çš„åœºæ™¯ä¸­ï¼Œè¿™ç§æ–¹å¼æ¯”è¾ƒé€‚åˆã€‚ 1234567891011@Overrideprotected void configure(HttpSecurity http) throws Exception &#123; http .formLogin() .loginPage(\"/login\") .and() .httpBasic() .realmName(\"Spittr\") .and() // ...&#125; Spring Security ä½¿å¾—ä¸ºåº”ç”¨æ·»åŠ  Remember-me åŠŸèƒ½å˜å¾—éå¸¸å®¹æ˜“ã€‚ä¸ºäº†å¯ç”¨è¿™é¡¹åŠŸèƒ½åªéœ€åœ¨configure()æ–¹æ³•æ‰€ä¼ å…¥çš„HttpSecurityå¯¹è±¡ä¸Šè°ƒç”¨rememberMe()å³å¯ã€‚è¿™ä¸ªåŠŸèƒ½æ˜¯é€šè¿‡åœ¨ cookie ä¸­å­˜å‚¨ä¸€ä¸ª token å®Œæˆçš„ã€‚ å­˜å‚¨åœ¨ cookie ä¸­çš„ token åŒ…å«ç”¨æˆ·åã€å¯†ç ã€è¿‡æœŸæ—¶é—´å’Œä¸€ä¸ªç§é’¥ â€”â€” åœ¨å†™å…¥ cookie å‰éƒ½è¿›è¡Œäº† MD5 å“ˆå¸Œã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œç§é’¥çš„åä¸º SpringSecuredï¼Œä½†åœ¨è¿™é‡Œæˆ‘ä»¬å°†å…¶è®¾ç½®ä¸º spitterKeyï¼Œä½¿å®ƒä¸“é—¨ç”¨äº Spittråº”ç”¨ã€‚ 1234567891011@Overrideprotected void configure(HttpSecurity http) throws Exception &#123; http .formLogin() .loginPage(\"/login\") .and() .rememberMe() .tokenValiditySeconds(2419200) // token å››å‘¨å†…æœ‰æ•ˆ .key(\"spittrKey\") // ...&#125; é€€å‡ºåŠŸèƒ½æ˜¯é€šè¿‡ Servlet å®¹å™¨ä¸­çš„ Filter å®ç°çš„ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼‰ï¼Œè¿™ä¸ª Filter ä¼šæ‹¦æˆªé’ˆå¯¹ â€œ/logoutâ€ çš„è¯·æ±‚ã€‚ 1&lt;a th:href=\"@&#123;/logout&#125;\"&gt;Logout&lt;/a&gt; å½“ç”¨æˆ·ç‚¹å‡»è¿™ä¸ªé“¾æ¥çš„æ—¶å€™ï¼Œä¼šå‘èµ·å¯¹ â€œ/logoutâ€ çš„è¯·æ±‚ï¼Œè¿™ä¸ªè¯·æ±‚ä¼šè¢« Spring Security çš„ LogoutFilter æ‰€å¤„ç†ã€‚ç”¨æˆ·ä¼šé€€å‡ºåº”ç”¨ï¼Œæ‰€æœ‰çš„ Remember-me token éƒ½ä¼šè¢«æ¸…é™¤æ‰ã€‚åœ¨é€€å‡ºå®Œæˆåï¼Œç”¨æˆ·æµè§ˆå™¨å°†ä¼š é‡å®šå‘åˆ° â€œ/login?logoutâ€ï¼Œä»è€Œå…è®¸ç”¨æˆ·è¿›è¡Œå†æ¬¡ç™»å½•ã€‚ å¦‚æœä½ å¸Œæœ›ç”¨æˆ·è¢«é‡å®šå‘åˆ°å…¶ä»–çš„é¡µé¢ï¼Œå¦‚åº”ç”¨çš„é¦–é¡µï¼Œé‚£ä¹ˆå¯ä»¥åœ¨ configure() ä¸­è¿›è¡Œé…ç½®ã€‚ 1234567891011@overrideprotected void configure(HttpSecurity http) throws Exception &#123; http .formLogin() .loginPage(\"/login\") .and() .logout() .logoutSuccessUrl(\"/\") // æŒ‡å®šé€€å‡ºæˆåŠŸåçš„è·³è½¬é¡µé¢ .logout(\"signout\") // é‡å†™çš„é»˜è®¤çš„ LogoutFilter æ‹¦æˆªè·¯å¾„ // ...&#125; ä¿æŠ¤è§†å›¾ä½¿ç”¨ Spring Security çš„ JSP æ ‡ç­¾åº“ã€‚ JSP æ ‡ç­¾ ä½œ ç”¨ &lt;security:accesscontrollist&gt; å¦‚æœç”¨æˆ·é€šè¿‡è®¿é—®æ§åˆ¶åˆ—è¡¨æˆäºˆäº†æŒ‡å®šçš„æƒé™é‚£ä¹ˆæ¸²æŸ“è¯¥æ ‡ç­¾ä½“ä¸­çš„å†…å®¹ &lt;security:authentication&gt; æ¸²æŸ“å½“å‰ç”¨æˆ·è®¤è¯å¯¹è±¡çš„è¯¦ç»†ä¿¡æ¯ &lt;security:authorize&gt; å¦‚æœç”¨æˆ·è¢«æˆäºˆäº†ç‰¹å®šçš„æƒé™æˆ–è€… SpEL è¡¨è¾¾å¼çš„è®¡ç®—ç»“æœä¸º true é‚£ä¹ˆæ¸²æŸ“è¯¥æ ‡ç­¾ ä½“ä¸­çš„å†…å®¹ ä½¿ç”¨&lt;security:authentication&gt; JSP æ ‡ç­¾æ¥è®¿é—®ç”¨æˆ·çš„è®¤è¯è¯¦æƒ…ã€‚ è®¤ è¯ å± æ€§ æ è¿° authorities ä¸€ç»„ç”¨äºè¡¨ç¤ºç”¨æˆ·æ‰€æˆäºˆæƒé™çš„ GrantedAuthority å¯¹è±¡ Credentials ç”¨äºæ ¸å®ç”¨æˆ·çš„å‡­è¯é€šå¸¸è¿™ä¼šæ˜¯ç”¨æˆ·çš„å¯†ç  details è®¤è¯çš„é™„åŠ ä¿¡æ¯IPåœ°å€ã€è¯ä»¶åºåˆ—å·ã€ä¼šè¯ ID ç­‰ principal ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯å¯¹è±¡ 1234567891011121314&lt;sec:authorize access=\"hasRole('ROLE_SPITTER')\"&gt; &lt;s:url value=\"/spittles\" var=\"spittle_url\" /&gt; &lt;sf:form modelAttribute=\"spittle\" action=\"$&#123;spittle_url&#125;\"&gt; &lt;sf:label path=\"text\"&gt; &lt;s:message code=\"label.spittle\" text=\"Enter spittle:\" /&gt; &lt;/sf:label&gt; &lt;sf:textarea path=\"text\" row=\"2\" cols=\"40\" /&gt; &lt;sf:errors path=\"text\" /&gt; &lt;br/&gt; &lt;div class=\"spitItSubmit\"&gt; &lt;input type=\"submit\" value=\"Spit it !\" class=\"status-btn round-btn disabled\" /&gt; &lt;/div&gt; &lt;/sf:form&gt;&lt;/sec:authorize&gt; Thymeleaf çš„å®‰å…¨æ–¹è¨€æä¾›äº†æ¡ä»¶åŒ–æ¸²æŸ“å’Œæ˜¾ç¤ºè®¤è¯ç»†èŠ‚çš„èƒ½åŠ›ã€‚ å± æ€§ ä½œ ç”¨ sec:authentication æ¸²æŸ“è®¤è¯å¯¹è±¡çš„å±æ€§ sec:authorize åŸºäºè¡¨è¾¾å¼çš„è®¡ç®—ç»“æœæ¡ä»¶æ€§çš„æ¸²æŸ“å†…å®¹ sec:authorize-acl åŸºäºè¡¨è¾¾å¼çš„è®¡ç®—ç»“æœæ¡ä»¶æ€§çš„æ¸²æŸ“å†…å®¹ sec:authorize-expr sec:authorizeå±æ€§çš„åˆ«å sec:authorize-url åŸºäºç»™å®šURLè·¯å¾„ç›¸å…³çš„å®‰å…¨è§„åˆ™æ¡ä»¶æ€§çš„æ¸²æŸ“å†…å®¹ 1234567@Beanpublic SpringTemplateEngine templateEngine(TemplateResolver templateResolver) &#123; SpringTemplateEngine templateEngine = new SpringTemplateEngine(); templateEngine.setTemplateResolver(templateResolver); templateEngine.addDialect(new SpringSecurityDialect()); // æ³¨å†Œå®‰å…¨æ–¹è¨€ return templateEngine;&#125; 123&lt;div sec:authorize=\"isAuthenticated\"&gt; Hello &lt;span sec:authentication=\"name\"&gt;someone&lt;/span&gt;&lt;/div&gt; åç«¯ä¸­çš„ Springå…³æ³¨ Spring å¦‚ä½•å¸®åŠ©æˆ‘ä»¬åœ¨åç«¯å¤„ç†æ•°æ®ã€‚ Spring ä¸ JDBC å®šä¹‰ Spring å¯¹æ•°æ®è®¿é—®çš„æ”¯æŒï¼› é…ç½®æ•°æ®åº“èµ„æºï¼› ä½¿ç”¨ Spring çš„ JDBC æ¨¡ç‰ˆã€‚ ä¸ºäº†é¿å…æŒä¹…åŒ–çš„é€»è¾‘åˆ†æ•£åˆ°åº”ç”¨çš„å„ä¸ªç»„ä»¶ä¸­æœ€å¥½å°†æ•°æ®è®¿é—®çš„åŠŸèƒ½æ”¾åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªä¸“æ³¨äºæ­¤é¡¹ä»»åŠ¡çš„ç»„ä»¶ä¸­ã€‚è¿™æ ·çš„ç»„ä»¶é€šå¸¸ç§°ä¸ºæ•°æ®è®¿é—®å¯¹è±¡ data access object DAO æˆ– Repositoryã€‚ ä¸ºäº†é¿å…åº”ç”¨ä¸ç‰¹å®šçš„æ•°æ®è®¿é—®ç­–ç•¥è€¦åˆåœ¨ä¸€èµ·ç¼–å†™è‰¯å¥½çš„ Repository åº”è¯¥ä»¥æ¥å£çš„æ–¹å¼æš´éœ²åŠŸèƒ½ã€‚ æœåŠ¡å¯¹è±¡æœ¬èº«å¹¶ä¸ä¼šå¤„ç†æ•°æ®è®¿é—®è€Œæ˜¯å°†æ•°æ®è®¿é—®å§”æ‰˜ç»™ Repositoryï¼ŒRepository æ¥å£ç¡®ä¿å…¶ä¸æœåŠ¡å¯¹è±¡çš„æ¾è€¦åˆã€‚ Spring å°†æ•°æ®è®¿é—®è¿‡ç¨‹ä¸­å›ºå®šçš„å’Œå¯å˜çš„éƒ¨åˆ†æ˜ç¡®åˆ’åˆ†ä¸ºä¸¤ä¸ªä¸åŒçš„ç±»æ¨¡æ¿ template å’Œå›è°ƒ callbackã€‚æ¨¡æ¿ç®¡ç†è¿‡ç¨‹ä¸­å›ºå®šçš„éƒ¨åˆ†è€Œå›è°ƒå¤„ç†è‡ªå®šä¹‰çš„æ•°æ®è®¿é—®ä»£ç ã€‚ é…ç½®æ•°æ®æº é€šè¿‡ JDBC é©±åŠ¨ç¨‹åºå®šä¹‰çš„æ•°æ®æºï¼› é€šè¿‡ JNDI æŸ¥æ‰¾çš„æ•°æ®æºï¼› è¿æ¥æ± çš„æ•°æ®æºã€‚ JNDIï¼ˆJava Naming and Directory Interface ï¼‰ï¼Œç±»ä¼¼äºåœ¨ä¸€ä¸ªä¸­å¿ƒæ³¨å†Œä¸€ä¸ªä¸œè¥¿ï¼Œä»¥åè¦ç”¨çš„æ—¶å€™ï¼Œåªéœ€è¦æ ¹æ®åå­—å»æ³¨å†Œä¸­å¿ƒæŸ¥æ‰¾ï¼Œæ³¨å†Œä¸­å¿ƒè¿”å›ä½ è¦çš„ä¸œè¥¿ã€‚åœ¨ web ç¨‹åºä¸­å¯ä»¥å°†ä¸€äº›ä¸œè¥¿ï¼ˆæ¯”å¦‚æ•°æ®åº“ç›¸å…³çš„ï¼‰äº¤ç»™æœåŠ¡å™¨è½¯ä»¶å»é…ç½®å’Œç®¡ç†ï¼ˆæœ‰å…¨å±€é…ç½®å’Œå•ä¸ª web ç¨‹åºçš„é…ç½®ï¼‰ï¼Œåœ¨ç¨‹åºä»£ç ä¸­åªè¦é€šè¿‡åç§°æŸ¥æ‰¾å°±èƒ½å¾—åˆ°æ³¨å†Œçš„ä¸œè¥¿ï¼Œè€Œä¸”å¦‚æœæ³¨å†Œçš„ä¸œè¥¿æœ‰å˜ï¼Œæ¯”å¦‚æ›´æ¢äº†æ•°æ®åº“ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿®æ”¹æ³¨å†Œä¿¡æ¯ï¼Œåç§°ä¸æ”¹ï¼Œå› æ­¤ä»£ç ä¹Ÿä¸éœ€è¦ä¿®æ”¹ã€‚ 12345678@Beanpublic JndiObjectFactoryBean dataSource() &#123; JndiObjectFactoryBean jndiObjectFB = new JndiObjectFactoryBean(); jndiObjectFB.setJndiName(\"jdbc/SpittrDS\"); jndiObjectFB.setResourceRef(true); jndiObjectFB.setProxyInterface(javax.sql.DataSource.class); return jndiObjectFB;&#125; ä½¿ç”¨æ•°æ®æºè¿æ¥æ± ã€‚ï¼ˆæ¨èï¼‰ 1234567891011@Beanpublic BasicDataSource dataSource() &#123; BasicDataSource ds = new BasicDataSource(); ds.setDriverClassName(\"org.h2.Driver\"); ds.setUrl(\"jdbc:h2:tcp://localhost/~/spitter\"); ds.setUsername(\"sa\"); ds.setPassword(\"\"); ds.setInitialSize(5); ds.setMaxActive(10); return ds;&#125; åœ¨Springä¸­é€šè¿‡ JDBC é©±åŠ¨å®šä¹‰æ•°æ®æºæ˜¯æœ€ç®€å•çš„é…ç½®æ–¹å¼ã€‚Spring æä¾›äº†ä¸‰ä¸ªè¿™æ ·çš„æ•°æ®æºç±»å‡ä½äºorg.springframework.jdbc.datasourceåŒ…ä¸­ä¾›é€‰æ‹©ã€‚ DriverManagerDataSourceåœ¨æ¯ä¸ªè¿æ¥è¯·æ±‚æ—¶éƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°å»ºçš„è¿æ¥ã€‚ä¸ DBCP çš„BasicDataSourceä¸åŒç”±DriverManagerDataSourceæä¾›çš„è¿æ¥å¹¶æ²¡æœ‰è¿›è¡Œæ± åŒ–ç®¡ç† SimpleDriverDataSourceä¸DriverManagerDataSourceçš„å·¥ä½œæ–¹å¼ç±»ä¼¼ä½†æ˜¯å®ƒç›´æ¥ä½¿ç”¨ JDBC é©±åŠ¨æ¥è§£å†³åœ¨ç‰¹å®šç¯å¢ƒä¸‹çš„ç±»åŠ è½½é—®é¢˜è¿™æ ·çš„ç¯å¢ƒåŒ…æ‹¬OSGiå®¹å™¨ SingleConnectionDataSourceåœ¨æ¯ä¸ªè¿æ¥è¯·æ±‚æ—¶éƒ½ä¼šè¿”å›åŒä¸€ä¸ªçš„è¿æ¥ã€‚å°½ç®¡SingleConnectionDataSourceä¸æ˜¯ä¸¥æ ¼æ„ä¹‰ä¸Šçš„è¿æ¥æ± æ•°æ®æºä½†æ˜¯ä½ å¯ä»¥å°†å…¶è§†ä¸ºåªæœ‰ä¸€ä¸ªè¿æ¥çš„æ± ã€‚ 123456789@Beanpublic DataSource dataSource() &#123; DriverManagerDataSource ds = new DriverManagerDataSource(); ds.setDriverClassName(\"org.h2.Driver\"); ds.setUrl(\"jdbc:h2:tcp://localhost/~/spitter\"); ds.setUsername(\"sa\"); ds.setPassword(\"\"); return ds;&#125; ä¸å…·å¤‡æ± åŠŸèƒ½çš„æ•°æ®æºç›¸æ¯”ï¼Œå”¯ä¸€çš„åŒºåˆ«åœ¨äºè¿™äº›æ•°æ®æº bean éƒ½æ²¡æœ‰æä¾›è¿æ¥æ± åŠŸèƒ½ï¼Œæ‰€ä»¥æ²¡æœ‰å¯é…ç½®çš„æ± ç›¸å…³çš„å±æ€§ã€‚ Spring çš„ JDBC å‘½åç©ºé—´èƒ½å¤Ÿç®€åŒ–åµŒå…¥å¼æ•°æ®åº“çš„é…ç½®ï¼Œå¯ä»¥ä½¿ç”¨EmbeddedDatabaseBuilderæ¥æ„å»ºDataSourceã€‚ 12345678@Beanpublic DataSource dataSource() &#123; return new EmbeddedDatabaseBuilder() .setType(EmbeddedDatabaseType.H2) .setScript(\"classpath:schema.sql\") .setScript(\"classpath:text-data.sql\") .build();&#125; ä½¿ç”¨ @profile é€‰æ‹©æ•°æ®æºã€‚ JDBC æ¨¡æ¿ JdbcTemplateæœ€åŸºæœ¬çš„ Spring JDBC æ¨¡æ¿ï¼Œè¿™ä¸ªæ¨¡æ¿æ”¯æŒç®€å•çš„ JDBC æ•°æ®åº“è®¿é—®åŠŸèƒ½ä»¥åŠåŸºäºç´¢å¼•å‚æ•°çš„æŸ¥è¯¢ï¼› NamedParameterJdbcTemplateä½¿ç”¨è¯¥æ¨¡æ¿ç±»æ‰§è¡ŒæŸ¥è¯¢æ—¶å¯ä»¥å°†å€¼ä»¥å‘½åå‚æ•°çš„å½¢å¼ç»‘å®šåˆ° SQL ä¸­è€Œä¸æ˜¯ä½¿ç”¨ç®€å•çš„ç´¢å¼•å‚æ•°ï¼› SimpleJdbcTemplateè¯¥æ¨¡æ¿ç±»åˆ©ç”¨ Java 5 çš„ä¸€äº›ç‰¹æ€§å¦‚è‡ªåŠ¨è£…ç®±ã€æ³›å‹ä»¥åŠå¯å˜å‚æ•°åˆ—è¡¨æ¥ç®€åŒ– JDBC æ¨¡æ¿çš„ä½¿ç”¨ã€‚ ä¸ºäº†è®©JdbcTemplateæ­£å¸¸å·¥ä½œï¼Œåªéœ€è¦ä¸ºå…¶è®¾ç½®DataSourceå°±å¯ä»¥äº†ã€‚ä¹‹åå°†jdbcTemplateè£…é…åˆ° Repository ä¸­å¹¶ä½¿ç”¨å®ƒæ¥è®¿é—®æ•°æ®åº“å°±å¯ä»¥äº†ã€‚ 1234@Beanpublic JdbcTemplate jdbcTemplate(DataSource dataSource) &#123; return new JdbcTemplate(dataSource);&#125; 1234567891011@Respositorypublic class JdbcSpitterRepository implements SpitterRepository &#123; // é€šè¿‡æ³¨å…¥éå…·ä½“çš„ JdbcTemplate è¾¾åˆ°æ¾è€¦åˆ private JdbcOperations jdbcOperations; @Inject public JdbcSpitterRepository(JdbcOperations jdbcOperations) &#123; this.jdbcOperations= jdbcOperations; &#125; // ...&#125; ORM æŒä¹…åŒ–æ•°æ® ä½¿ç”¨ Spring å’Œ Hibernateï¼› å€ŸåŠ©ä¸Šä¸‹æ–‡ Session ç¼–å†™ä¸ä¾èµ–äº Spring çš„ Repositoryï¼› é€šè¿‡ Spring ä½¿ç”¨ JPAï¼› å€ŸåŠ© Spring Data å®ç°è‡ªåŠ¨åŒ–çš„ JPA Repositoryã€‚ HIbernateä½¿ç”¨ Hibernate æ‰€éœ€çš„ä¸»è¦æ¥å£æ˜¯org.hibernate.Sessionã€‚Sessionæ¥å£æä¾›äº†åŸºæœ¬çš„æ•°æ®è®¿é—®åŠŸèƒ½å¦‚ä¿å­˜ã€æ›´æ–°ã€åˆ é™¤ä»¥åŠä»æ•°æ®åº“åŠ è½½å¯¹è±¡çš„åŠŸèƒ½ã€‚é€šè¿‡ Hibernate çš„Sessionæ¥å£åº”ç”¨ç¨‹åºçš„ Repository èƒ½å¤Ÿæ»¡è¶³æ‰€æœ‰çš„æŒä¹…åŒ–éœ€æ±‚ã€‚ è·å– Hibernate Session å¯¹è±¡çš„æ ‡å‡†æ–¹å¼æ˜¯å€ŸåŠ©äº Hibernate SessionFactoryæ¥å£çš„å®ç°ç±»ã€‚é™¤äº†ä¸€äº›å…¶ä»–çš„ä»»åŠ¡SessionFactoryä¸»è¦è´Ÿè´£ Hibernate Sessionçš„æ‰“å¼€ã€å…³é—­ä»¥åŠç®¡ç†ã€‚ JPAåœ¨ Spring ä¸­ä½¿ç”¨ JPA çš„ç¬¬ä¸€æ­¥æ˜¯è¦åœ¨ Spring åº”ç”¨ä¸Šä¸‹æ–‡ä¸­å°†å®ä½“ç®¡ç†å™¨å·¥å‚ï¼ˆentity manager factoryï¼‰æŒ‰ç…§ bean çš„å½¢å¼æ¥è¿›è¡Œé…ç½®ã€‚ åŸºäº JPA çš„åº”ç”¨ç¨‹åºéœ€è¦ä½¿ç”¨ EntityManagerFactory çš„å®ç°ç±»æ¥è·å– EntityManager å®ä¾‹ã€‚ å®¹å™¨ç®¡ç†çš„ JPA é‡‡å–äº†ä¸€ä¸ªä¸åŒçš„æ–¹å¼ã€‚å½“è¿è¡Œåœ¨å®¹å™¨ä¸­æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å®¹å™¨ï¼ˆåœ¨æˆ‘ä»¬çš„åœºæ™¯ä¸‹æ˜¯ Springï¼‰æä¾›çš„ä¿¡æ¯æ¥ç”Ÿæˆ EntityManagerFactoryã€‚ 12345678910111213141516171819@Beanpublic LocalContainerEntityManagerFactoryBean entityManagerFactory( DataSource dataSource, JpaVendorAdapter jpaVendorAdapter) &#123; LocalContainerEntityManagerFactoryBean emfb = new LocalContainerEntityManagerFactoryBean(); emfb.setDataSource(dataSource); emfb.setJpaVendorAdapter(jpaVendorAdapter); return emfb;&#125;@Beanpublic JpaVendorAdapter jpaVendorAdapter() &#123; // Hibernate å‚å•†æä¾›çš„é€‚é…å™¨ HibernateJpaVendorAdapter adapter = new HibernateJpaVendorAdapter(); adapter.setDatabase(\"HSQL\"); adapter.setShowSql(true); adapter.setGenerateDdl(false); adapter.setDatabasePlatform(\"org.hibernet.dialect.HSQLDialect\"); return adapter;&#125; 1234567public interface SpitterRepository extends JpaRepository&lt;Spitter, Long&gt; &#123;&#125;@Configuration@EnableJpaRepositories(basePackages=\"com.habuma.spittr.db\")public class JpaConfiguration &#123;&#125; Repository æ–¹æ³•çš„å‘½åéµå¾ªä¸€ç§æ¨¡å¼ï¼Œæœ‰åŠ©äº Spring Data ç”Ÿæˆé’ˆå¯¹æ•°æ®åº“çš„æŸ¥è¯¢ã€‚ï¼ˆä¸»é¢˜å¯ä»¥çœç•¥ï¼‰ 12// æ–¹æ³•ç­¾åList&lt;Spitter&gt; readByFirstnameIgnoringCaseOrLastnameIgnoringCase(String first, String last); å£°æ˜è‡ªå®šä¹‰æŸ¥è¯¢ã€‚ 12@Query(\"select s from Spitter s where s.email like '%gmail.com'\")List&lt;Spitter&gt; findAllGmailSpitters(); æ··åˆè‡ªå®šä¹‰æŸ¥è¯¢ï¼Œå³åµŒå¥—æŸ¥è¯¢ã€‚ NoSQL ä¸º MongoDB å’Œ Neo4j ç¼–å†™ Repositoryï¼› ä¸ºå¤šç§æ•°æ®å­˜å‚¨å½¢å¼æŒä¹…åŒ–æ•°æ®ï¼› ç»„åˆä½¿ç”¨ Spring å’Œ Redisã€‚ MongoDBMongoDB æ˜¯æœ€ä¸ºæµè¡Œçš„å¼€æºæ–‡æ¡£æ•°æ®åº“ä¹‹ä¸€ã€‚Spring Data MongoDB æä¾›äº†ä¸‰ç§æ–¹å¼åœ¨ Spring åº”ç”¨ä¸­ä½¿ç”¨ MongoDBã€‚ é€šè¿‡æ³¨è§£å®ç°å¯¹è±¡-æ–‡æ¡£æ˜ å°„ï¼› ä½¿ç”¨MongoTemplateå®ç°åŸºäºæ¨¡æ¿çš„æ•°æ®åº“è®¿é—®ï¼› è‡ªåŠ¨åŒ–çš„è¿è¡Œæ—¶ Repository ç”ŸæˆåŠŸèƒ½ã€‚ æ‚é¡¹åŸºäºLDAPè¿›è¡Œè®¤è¯ä½¿ç”¨ Apache Common Lang åŒ…æ¥å®ç°equals()å’ŒhashCode()æ–¹æ³•ã€‚ 12345678@Overridepublic boolean equals(Object that) &#123; return EqualsBuilder.reflectionEquals(this, that, \"id\", \"time\");&#125;@Overridepublic int hashCode() &#123; return HashCodeBuilder.reflectionHashCode(this, \"id\", \"time\");&#125;","categories":[{"name":"åå°æŠ€æœ¯","slug":"åå°æŠ€æœ¯","permalink":"http://yoursite.com/categories/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"Spring","slug":"Spring","permalink":"http://yoursite.com/tags/Spring/"}]},{"title":"Flume","slug":"å¤§æ•°æ®/Flume","date":"2020-05-08T06:27:33.000Z","updated":"2020-07-10T03:37:23.451Z","comments":true,"path":"2020/05/08/å¤§æ•°æ®/Flume/","link":"","permalink":"http://yoursite.com/2020/05/08/%E5%A4%A7%E6%95%B0%E6%8D%AE/Flume/","excerpt":"Flume åŸºæœ¬ä»‹ç»åŠç®€å•ä½¿ç”¨ã€‚","text":"Flume åŸºæœ¬ä»‹ç»åŠç®€å•ä½¿ç”¨ã€‚ åŸºæœ¬æ¦‚å¿µFlume æ˜¯ Cloudera æä¾›çš„ä¸€ä¸ªé«˜å¯ç”¨çš„ï¼Œé«˜å¯é çš„ï¼Œåˆ†å¸ƒå¼çš„æµ·é‡æ—¥å¿—é‡‡é›†ã€èšåˆå’Œä¼ è¾“çš„ç³»ç»Ÿã€‚Flume åŸºäºæµå¼æ¶æ„ï¼Œçµæ´»ç®€å•ã€‚ Flume æœ€ä¸»è¦çš„ä½œç”¨å°±æ˜¯ï¼Œå®æ—¶è¯»å–æœåŠ¡å™¨æœ¬åœ°ç£ç›˜çš„æ•°æ®ï¼Œå°†æ•°æ®å†™å…¥åˆ° HDFSã€‚ åŸºç¡€æ¡†æ¶ Flume æ”¯æŒå°†äº‹ä»¶æµå‘ä¸€ä¸ªæˆ–è€…å¤šä¸ªç›®çš„åœ°ï¼Œè¿™ç§æ¨¡å¼å¯ä»¥å°†ç›¸åŒæ•°æ®å¤åˆ¶åˆ°å¤šä¸ª channel ä¸­ï¼Œæˆ–è€…å°†ä¸åŒæ•°æ®åˆ†å‘åˆ°ä¸åŒçš„ channel ä¸­ï¼Œsink å¯ä»¥é€‰æ‹©ä¼ é€åˆ°ä¸åŒçš„ç›®çš„åœ°ã€‚ Agent Agent æ˜¯ä¸€ä¸ª JVM è¿›ç¨‹ï¼Œå®ƒä»¥äº‹ä»¶çš„å½¢å¼å°†æ•°æ®ä»æºå¤´é€è‡³ç›®çš„ã€‚ Agent ä¸»è¦æœ‰ 3 ä¸ªéƒ¨åˆ†ç»„æˆï¼šSourceã€Channelã€Sinkã€‚ Source Source æ˜¯è´Ÿè´£æ¥æ”¶æ•°æ®åˆ° Flume Agent çš„ç»„ä»¶ã€‚Source ç»„ä»¶å¯ä»¥å¤„ç†å„ç§ç±»å‹ã€å„ç§æ ¼å¼çš„æ—¥å¿—æ•°æ®ï¼ŒåŒ…æ‹¬ avroã€thriftã€execã€jmsã€spooling directoryã€netcatã€sequence generatorã€syslogã€httpã€legacyã€‚ Sink Sink ä¸æ–­åœ°è½®è¯¢ Channel ä¸­çš„äº‹ä»¶ä¸”æ‰¹é‡åœ°ç§»é™¤å®ƒä»¬ï¼Œå¹¶å°†è¿™äº›äº‹ä»¶æ‰¹é‡å†™å…¥åˆ°å­˜å‚¨æˆ–ç´¢å¼•ç³»ç»Ÿã€æˆ–è€…è¢«å‘é€åˆ°å¦ä¸€ä¸ª Flume Agentã€‚ Sink ç»„ä»¶ç›®çš„åœ°åŒ…æ‹¬ hdfsã€loggerã€avroã€thriftã€ipcã€fileã€HBaseã€solrã€è‡ªå®šä¹‰ã€‚ Channel Channel æ˜¯ä½äº Source å’Œ Sink ä¹‹é—´çš„ç¼“å†²åŒºã€‚å› æ­¤ï¼ŒChannel å…è®¸ Source å’Œ Sink è¿ä½œåœ¨ä¸åŒçš„é€Ÿç‡ä¸Šã€‚Channel æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¯ä»¥åŒæ—¶å¤„ç†å‡ ä¸ª Source çš„å†™å…¥æ“ä½œå’Œå‡ ä¸ª Sink çš„è¯»å–æ“ä½œã€‚ Flume è‡ªå¸¦ä¸¤ç§ Channelï¼šMemory Channel å’Œ File Channelã€‚ Memory Channel æ˜¯å†…å­˜ä¸­çš„é˜Ÿåˆ—ã€‚Memory Channel åœ¨ä¸éœ€è¦å…³å¿ƒæ•°æ®ä¸¢å¤±çš„æƒ…æ™¯ä¸‹é€‚ ç”¨ã€‚å¦‚æœéœ€è¦å…³å¿ƒæ•°æ®ä¸¢å¤±ï¼Œé‚£ä¹ˆ Memory Channel å°±ä¸åº”è¯¥ä½¿ç”¨ï¼Œå› ä¸ºç¨‹åºæ­»äº¡ã€æœºå™¨å®•æœºæˆ–è€…é‡å¯éƒ½ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚ File Channel å°†æ‰€æœ‰äº‹ä»¶å†™åˆ°ç£ç›˜ã€‚å› æ­¤åœ¨ç¨‹åºå…³é—­æˆ–æœºå™¨å®•æœºçš„æƒ…å†µä¸‹ä¸ä¼šä¸¢å¤±æ•°æ®ã€‚ Event ä¼ è¾“å•å…ƒï¼ŒFlume æ•°æ®ä¼ è¾“çš„åŸºæœ¬å•å…ƒï¼Œä»¥ Event çš„å½¢å¼å°†æ•°æ®ä»æºå¤´é€è‡³ç›®çš„åœ°ã€‚ Event ç”± Header å’Œ Body ä¸¤éƒ¨åˆ†ç»„æˆï¼ŒHeader ç”¨æ¥å­˜æ”¾è¯¥ event çš„ä¸€äº›å±æ€§ï¼Œä¸º K-V ç»“æ„ï¼Œ Body ç”¨æ¥å­˜æ”¾è¯¥æ¡æ•°æ®ï¼Œå½¢å¼ä¸ºå­—èŠ‚æ•°ç»„ã€‚ å¿«é€Ÿå…¥é—¨12345tar -zxf apache-flume-1.7.0-bin.tar.gz -C /opt/module/mv apache-flume-1.7.0-bin flumemv flume-env.sh.template flume-env.shvi flume-env.sh # export JAVA_HOME=/opt/module/jdk1.8.0_144 ä½¿ç”¨ Flume ç›‘å¬ä¸€ä¸ªç«¯å£ï¼Œæ”¶é›†è¯¥ç«¯å£æ•°æ®ï¼ˆä½¿ç”¨ nectcat å·¥å…·å‘è¯¥ç«¯å£å‘é€æ•°æ®ï¼‰ï¼Œå¹¶æ‰“å°åˆ°æ§åˆ¶å°ã€‚ 1234567891011121314151617181920212223242526272829303132# å®‰è£… netcat å·¥å…·sudo yum install -y nc# åˆ¤æ–­ 44444 ç«¯å£æ˜¯å¦è¢«å ç”¨ sudo netstat -tunlp | grep 44444# åˆ›å»º Flume Agent é…ç½®æ–‡ä»¶ flume-netcat-logger.conf # åœ¨ flume ç›®å½•ä¸‹åˆ›å»º job æ–‡ä»¶å¤¹å¹¶è¿›å…¥ job æ–‡ä»¶å¤¹ã€‚mkdir jobcd job/# åœ¨ job æ–‡ä»¶å¤¹ä¸‹åˆ›å»º Flume Agent é…ç½®æ–‡ä»¶ flume-netcat-logger.confã€‚# vim flume-netcat-logger.conf# åœ¨ flume-netcat-logger.conf æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹ã€‚ï¼ˆå‚è€ƒå®˜æ–¹æ–‡æ¡£é…ç½®ï¼‰ # Name the components on this agent a1.sources = r1 a1.sinks = k1 a1.channels = c1 # Describe/configure the source a1.sources.r1.type = netcat # æ•°æ®æ¥æº netcat å·¥å…· a1.sources.r1.bind = localhost a1.sources.r1.port = 44444 # Describe the sink a1.sinks.k1.type = logger # æ•°æ®è¾“å‡ºç›®çš„åœ°ä¸º logger æ§åˆ¶å°ç±»å‹ # Use a channel which buffers events in memory a1.channels.c1.type = memory # é€šé“çš„å­˜å‚¨ä¸ºå†…å­˜å‹ a1.channels.c1.capacity = 1000 a1.channels.c1.transactionCapacity = 100 # 100 æ¡ even åæ‰æäº¤äº‹åŠ¡ # Bind the source and sink to the channel a1.sources.r1.channels = c1 a1.sinks.k1.channel = c1# å¼€å¯ flume ç›‘å¬ç«¯å£ æ§åˆ¶å°æ—¥å¿—æ‰“å°çº§åˆ«è®¾ç½®ä¸º INFO çº§åˆ«bin/flume-ng agent --conf conf/ --name a1 --conf-file job/flume-netcat-logger.conf -Dflume.root.logger=INFO,console# ä½¿ç”¨ netcat å·¥å…·å‘æœ¬æœºçš„ 44444 ç«¯å£å‘é€å†…å®¹ nc localhost 44444 å®é™…æ¡ˆä¾‹Exec å®æ—¶ç›‘æ§ Hive æ—¥å¿—ï¼Œå¹¶ä¸Šä¼ åˆ° HDFS ä¸­ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243# Flume è¦æƒ³å°†æ•°æ®è¾“å‡ºåˆ° HDFSï¼Œé¡»æŒæœ‰ Hadoop ç›¸å…³ jar åŒ…# åˆ›å»º flume-file-hdfs.conf æ–‡ä»¶ vim flume-file-hdfs.conf # Name the components on this agent a2.sources = r2 a2.sinks = k2 a2.channels = c2 # Describe/configure the source a2.sources.r2.type = exec a2.sources.r2.command = tail -F /opt/module/hive/logs/hive.log a2.sources.r2.shell = /bin/bash -c # Describe the sink a2.sinks.k2.type = hdfs a2.sinks.k2.hdfs.path = hdfs://hadoop102:9000/flume/%Y%m%d/%H # ä¸Šä¼ æ–‡ä»¶çš„å‰ç¼€ a2.sinks.k2.hdfs.filePrefix = logs- # æ˜¯å¦æŒ‰ç…§æ—¶é—´æ»šåŠ¨æ–‡ä»¶å¤¹ a2.sinks.k2.hdfs.round = true # å¤šå°‘æ—¶é—´å•ä½åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶å¤¹ a2.sinks.k2.hdfs.roundValue = 1 # é‡æ–°å®šä¹‰æ—¶é—´å•ä½ a2.sinks.k2.hdfs.roundUnit = hour # æ˜¯å¦ä½¿ç”¨æœ¬åœ°æ—¶é—´æˆ³ a2.sinks.k2.hdfs.useLocalTimeStamp = true # ç§¯æ”’å¤šå°‘ä¸ª Event æ‰ flush åˆ° HDFS ä¸€æ¬¡ a2.sinks.k2.hdfs.batchSize = 1000 # è®¾ç½®æ–‡ä»¶ç±»å‹ï¼Œå¯æ”¯æŒå‹ç¼© a2.sinks.k2.hdfs.fileType = DataStream # å¤šä¹…ç”Ÿæˆä¸€ä¸ªæ–°çš„æ–‡ä»¶ a2.sinks.k2.hdfs.rollInterval = 30 # è®¾ç½®æ¯ä¸ªæ–‡ä»¶çš„æ»šåŠ¨å¤§å° a2.sinks.k2.hdfs.rollSize = 134217700 # æ–‡ä»¶çš„æ»šåŠ¨ä¸ Event æ•°é‡æ— å…³ a2.sinks.k2.hdfs.rollCount = 0 # Use a channel which buffers events in memory a2.channels.c2.type = memory a2.channels.c2.capacity = 1000 a2.channels.c2.transactionCapacity = 100 # Bind the source and sink to the channel a2.sources.r2.channels = c2 a2.sinks.k2.channel = c2bin/flume-ng agent --conf conf/ --name a2 --conf-file job/flume-file-hdfs.conf# å¼€å¯ Hadoop å’Œ Hive å¹¶æ“ä½œ Hive äº§ç”Ÿæ—¥å¿— Spooldir ä½¿ç”¨ Flume ç›‘å¬æ•´ä¸ªç›®å½•çš„æ–‡ä»¶ï¼Œå¹¶ä¸Šä¼ è‡³ HDFSã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142vim flume-dir-hdfs.conf a3.sources = r3 a3.sinks = k3 a3.channels = c3 # Describe/configure the source a3.sources.r3.type = spooldir a3.sources.r3.spoolDir = /opt/module/flume/upload a3.sources.r3.fileSuffix = .COMPLETED # å®šä¹‰æ–‡ä»¶ä¸Šä¼ å®Œçš„åç¼€ a3.sources.r3.fileHeader = true # å¿½ç•¥æ‰€æœ‰ä»¥.tmp ç»“å°¾çš„æ–‡ä»¶ï¼Œä¸ä¸Šä¼  a3.sources.r3.ignorePattern = ([^ ]*\\.tmp) # Describe the sink a3.sinks.k3.type = hdfs a3.sinks.k3.hdfs.path = hdfs://hadoop102:9000/flume/upload/%Y%m%d/%H # ä¸Šä¼ æ–‡ä»¶çš„å‰ç¼€ a3.sinks.k3.hdfs.filePrefix = upload- # æ˜¯å¦æŒ‰ç…§æ—¶é—´æ»šåŠ¨æ–‡ä»¶å¤¹ a3.sinks.k3.hdfs.round = true # å¤šå°‘æ—¶é—´å•ä½åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶å¤¹ a3.sinks.k3.hdfs.roundValue = 1 # é‡æ–°å®šä¹‰æ—¶é—´å•ä½ a3.sinks.k3.hdfs.roundUnit = hour # æ˜¯å¦ä½¿ç”¨æœ¬åœ°æ—¶é—´æˆ³ a3.sinks.k3.hdfs.useLocalTimeStamp = true # ç§¯æ”’å¤šå°‘ä¸ª Event æ‰ flush åˆ° HDFS ä¸€æ¬¡ a3.sinks.k3.hdfs.batchSize = 100 # è®¾ç½®æ–‡ä»¶ç±»å‹ï¼Œå¯æ”¯æŒå‹ç¼© a3.sinks.k3.hdfs.fileType = DataStream # å¤šä¹…ç”Ÿæˆä¸€ä¸ªæ–°çš„æ–‡ä»¶ a3.sinks.k3.hdfs.rollInterval = 60 # è®¾ç½®æ¯ä¸ªæ–‡ä»¶çš„æ»šåŠ¨å¤§å°å¤§æ¦‚æ˜¯ 128M a3.sinks.k3.hdfs.rollSize = 134217700 # æ–‡ä»¶çš„æ»šåŠ¨ä¸ Event æ•°é‡æ— å…³ a3.sinks.k3.hdfs.rollCount = 0 # Use a channel which buffers events in memory a3.channels.c3.type = memory a3.channels.c3.capacity = 1000 a3.channels.c3.transactionCapacity = 100 # Bind the source and sink to the channel a3.sources.r3.channels = c3 a3.sinks.k3.channel = c3bin/flume-ng agent --conf conf/ --name a3 --conf-file job/flume-dir-hdfs.conf Exec source é€‚ç”¨äºç›‘æ§ä¸€ä¸ªå®æ—¶è¿½åŠ çš„æ–‡ä»¶ï¼Œä½†ä¸èƒ½ä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼›Spooldir Source èƒ½å¤Ÿä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼Œä¸”èƒ½å¤Ÿå®ç°æ–­ç‚¹ç»­ä¼ ï¼Œä½†å»¶è¿Ÿè¾ƒé«˜ï¼Œä¸èƒ½å®æ—¶ç›‘æ§ï¼›è€Œ Taildir Source æ—¢èƒ½å¤Ÿå®ç°æ–­ç‚¹ç»­ä¼ ï¼Œåˆå¯ä»¥ä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼Œè¿˜èƒ½å¤Ÿè¿›è¡Œå®æ—¶ç›‘æ§ã€‚ Taildir ä½¿ç”¨ Flume ç›‘å¬æ•´ä¸ªç›®å½•çš„å®æ—¶è¿½åŠ æ–‡ä»¶ï¼Œå¹¶ä¸Šä¼ è‡³ HDFSã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243vim flume-taildir-hdfs.conf a3.sources = r3 a3.sinks = k3 a3.channels = c3 # Describe/configure the source a3.sources.r3.type = TAILDIR # ç»´æŠ¤äº†ä¸€ä¸ª json æ ¼å¼çš„ position File # å…¶ä¼šå®šæœŸçš„å¾€ position File ä¸­æ›´æ–°æ¯ä¸ªæ–‡ä»¶è¯»å–åˆ°çš„æœ€æ–°çš„ä½ç½®ï¼Œå› æ­¤èƒ½å¤Ÿå®ç°æ–­ç‚¹ç»­ä¼  a3.sources.r3.positionFile = /opt/module/flume/tail_dir.json a3.sources.r3.filegroups = f1 a3.sources.r3.filegroups.f1 = /opt/module/flume/files/file.* # Describe the sink a3.sinks.k3.type = hdfs a3.sinks.k3.hdfs.path = hdfs://hadoop102:9000/flume/upload/%Y%m%d/%H # ä¸Šä¼ æ–‡ä»¶çš„å‰ç¼€ a3.sinks.k3.hdfs.filePrefix = upload- # æ˜¯å¦æŒ‰ç…§æ—¶é—´æ»šåŠ¨æ–‡ä»¶å¤¹ a3.sinks.k3.hdfs.round = true # å¤šå°‘æ—¶é—´å•ä½åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶å¤¹ a3.sinks.k3.hdfs.roundValue = 1 # é‡æ–°å®šä¹‰æ—¶é—´å•ä½ a3.sinks.k3.hdfs.roundUnit = hour # æ˜¯å¦ä½¿ç”¨æœ¬åœ°æ—¶é—´æˆ³ a3.sinks.k3.hdfs.useLocalTimeStamp = true # ç§¯æ”’å¤šå°‘ä¸ª Event æ‰ flush åˆ° HDFS ä¸€æ¬¡ a3.sinks.k3.hdfs.batchSize = 100 # è®¾ç½®æ–‡ä»¶ç±»å‹ï¼Œå¯æ”¯æŒå‹ç¼© a3.sinks.k3.hdfs.fileType = DataStream # å¤šä¹…ç”Ÿæˆä¸€ä¸ªæ–°çš„æ–‡ä»¶ a3.sinks.k3.hdfs.rollInterval = 60 # è®¾ç½®æ¯ä¸ªæ–‡ä»¶çš„æ»šåŠ¨å¤§å°å¤§æ¦‚æ˜¯ 128M a3.sinks.k3.hdfs.rollSize = 134217700 # æ–‡ä»¶çš„æ»šåŠ¨ä¸ Event æ•°é‡æ— å…³ a3.sinks.k3.hdfs.rollCount = 0 # Use a channel which buffers events in memory a3.channels.c3.type = memory a3.channels.c3.capacity = 1000 a3.channels.c3.transactionCapacity = 100 # Bind the source and sink to the channel a3.sources.r3.channels = c3 a3.sinks.k3.channel = c3bin/flume-ng agent --conf conf/ --name a3 --conf-file job/flume-taildir-hdfs.conf è¿›é˜¶ç‰¹æ€§äº‹åŠ¡ å†…éƒ¨åŸç† ChannelSelector ChannelSelector çš„ä½œç”¨å°±æ˜¯é€‰å‡º Event å°†è¦è¢«å‘å¾€å“ªä¸ª Channelã€‚å…¶å…±æœ‰ä¸¤ç§ç±»å‹ï¼Œåˆ†åˆ«æ˜¯ Replicatingï¼ˆå¤åˆ¶ï¼‰å’Œ Multiplexingï¼ˆå¤šè·¯å¤ç”¨ï¼‰ã€‚ ReplicatingSelector ä¼šå°†åŒä¸€ä¸ª Event å‘å¾€æ‰€æœ‰çš„ Channelï¼ŒMultiplexing ä¼šæ ¹æ®ç›¸åº”çš„åŸåˆ™ï¼Œå°†ä¸åŒçš„ Event å‘å¾€ä¸åŒçš„ Channelã€‚ SinkProcessor SinkProcessor å…±æœ‰ä¸‰ç§ç±»å‹ï¼Œåˆ†åˆ«æ˜¯ DefaultSinkProcessorã€LoadBalancingSinkProcessor å’Œ FailoverSinkProcessorã€‚ DefaultSinkProcessor å¯¹åº”çš„æ˜¯å•ä¸ªçš„ Sink ï¼Œ LoadBalancingSinkProcessor å’Œ FailoverSinkProcessor å¯¹åº”çš„æ˜¯ Sink Groupï¼ŒLoadBalancingSinkProcessor å¯ä»¥å®ç°è´Ÿè½½å‡è¡¡çš„åŠŸèƒ½ï¼ŒFailoverSinkProcessor å¯ä»¥å®ç°æ•…éšœè½¬ç§»çš„åŠŸèƒ½ã€‚ æ‹“æ‰‘ç»“æ„ç®€å•ä¸²è” å°†å¤šä¸ª flume é¡ºåºè¿æ¥èµ·æ¥äº†ï¼Œä»æœ€åˆçš„ source å¼€å§‹åˆ°æœ€ç»ˆ sink ä¼ é€çš„ç›®çš„å­˜å‚¨ç³»ç»Ÿã€‚æ­¤æ¨¡å¼ä¸å»ºè®®æ¡¥æ¥è¿‡å¤šçš„ flume æ•°é‡ï¼Œflume æ•°é‡è¿‡å¤šä¸ä»…ä¼šå½±å“ä¼ è¾“é€Ÿç‡ï¼Œ è€Œä¸”ä¸€æ—¦ä¼ è¾“è¿‡ç¨‹ä¸­æŸä¸ªèŠ‚ç‚¹ flume å®•æœºï¼Œä¼šå½±å“æ•´ä¸ªä¼ è¾“ç³»ç»Ÿã€‚ å¤åˆ¶å’Œå¤šè·¯å¤ç”¨ Flume æ”¯æŒå°†äº‹ä»¶æµå‘ä¸€ä¸ªæˆ–è€…å¤šä¸ªç›®çš„åœ°ã€‚è¿™ç§æ¨¡å¼å¯ä»¥å°†ç›¸åŒæ•°æ®å¤åˆ¶åˆ°å¤šä¸ª channel ä¸­ï¼Œæˆ–è€…å°†ä¸åŒæ•°æ®åˆ†å‘åˆ°ä¸åŒçš„ channel ä¸­ï¼Œsink å¯ä»¥é€‰æ‹©ä¼ é€åˆ°ä¸åŒçš„ç›®çš„åœ°ã€‚ è´Ÿè½½å‡è¡¡å’Œæ•…éšœè½¬ç§» Flumeæ”¯æŒä½¿ç”¨å°†å¤šä¸ª sink é€»è¾‘ä¸Šåˆ†åˆ°ä¸€ä¸ª sink ç»„ï¼Œsink ç»„é…åˆä¸åŒçš„ SinkProcessor å¯ä»¥å®ç°è´Ÿè½½å‡è¡¡å’Œé”™è¯¯æ¢å¤çš„åŠŸèƒ½ã€‚ èšåˆ è¿™ç§æ¨¡å¼æ˜¯æˆ‘ä»¬æœ€å¸¸è§çš„ï¼Œä¹Ÿéå¸¸å®ç”¨ï¼Œæ—¥å¸¸ web åº”ç”¨é€šå¸¸åˆ†å¸ƒåœ¨ä¸Šç™¾ä¸ªæœåŠ¡å™¨ï¼Œå¤§è€…ç”šè‡³ä¸Šåƒä¸ªã€ä¸Šä¸‡ä¸ªæœåŠ¡å™¨ã€‚äº§ç”Ÿçš„æ—¥å¿—ï¼Œå¤„ç†èµ·æ¥ä¹Ÿéå¸¸éº»çƒ¦ã€‚ç”¨ flume çš„è¿™ç§ç»„åˆæ–¹å¼èƒ½å¾ˆå¥½çš„è§£å†³è¿™ä¸€é—®é¢˜ï¼Œæ¯å°æœåŠ¡å™¨éƒ¨ç½²ä¸€ä¸ª flume é‡‡é›†æ—¥å¿—ï¼Œä¼ é€åˆ°ä¸€ä¸ªé›†ä¸­æ”¶é›†æ—¥å¿—çš„ flumeï¼Œå†ç”±æ­¤ flume ä¸Šä¼ åˆ° hdfsã€hiveã€hbase ç­‰ï¼Œè¿›è¡Œæ—¥å¿—åˆ†æã€‚ ä¼ä¸šå¼€å‘å¤åˆ¶å’Œå¤ç”¨ ä½¿ç”¨ Flume-1 ç›‘æ§æ–‡ä»¶å˜åŠ¨ï¼ŒFlume-1 å°†å˜åŠ¨å†…å®¹ä¼ é€’ç»™ Flume-2ï¼ŒFlume-2 è´Ÿè´£å­˜å‚¨åˆ° HDFSã€‚åŒæ—¶ Flume-1 å°†å˜åŠ¨å†…å®¹ä¼ é€’ç»™ Flume-3ï¼ŒFlume-3 è´Ÿè´£è¾“å‡ºåˆ° Local FileSystemã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899cd group1/mkdir flume3# ç›‘æ§æ–‡ä»¶å˜åŠ¨vim flume-file-flume.conf # Name the components on this agent a1.sources = r1 a1.sinks = k1 k2 a1.channels = c1 c2 # å°†æ•°æ®æµå¤åˆ¶ç»™æ‰€æœ‰ channel a1.sources.r1.selector.type = replicating # Describe/configure the source a1.sources.r1.type = exec a1.sources.r1.command = tail -F /opt/module/hive/logs/hive.log a1.sources.r1.shell = /bin/bash -c # Describe the sink # sink ç«¯çš„ avro æ˜¯ä¸€ä¸ªæ•°æ®å‘é€è€… a1.sinks.k1.type = avro a1.sinks.k1.hostname = hadoop102 a1.sinks.k1.port = 4141 a1.sinks.k2.type = avro a1.sinks.k2.hostname = hadoop102 a1.sinks.k2.port = 4142 # Describe the channel a1.channels.c1.type = memory a1.channels.c1.capacity = 1000 a1.channels.c1.transactionCapacity = 100 a1.channels.c2.type = memory a1.channels.c2.capacity = 1000 a1.channels.c2.transactionCapacity = 100 # Bind the source and sink to the channel a1.sources.r1.channels = c1 c2 a1.sinks.k1.channel = c1 a1.sinks.k2.channel = c2# è´Ÿè´£å­˜å‚¨åˆ° HDFSvim flume-flume-hdfs.conf # Name the components on this agent a2.sources = r1 a2.sinks = k1 a2.channels = c1 # Describe/configure the source # source ç«¯çš„ avro æ˜¯ä¸€ä¸ªæ•°æ®æ¥æ”¶æœåŠ¡ a2.sources.r1.type = avro a2.sources.r1.bind = hadoop102 a2.sources.r1.port = 4141 # Describe the sink a2.sinks.k1.type = hdfs a2.sinks.k1.hdfs.path = hdfs://hadoop102:9000/flume2/%Y%m%d/%H # ä¸Šä¼ æ–‡ä»¶çš„å‰ç¼€ a2.sinks.k1.hdfs.filePrefix = flume2- # æ˜¯å¦æŒ‰ç…§æ—¶é—´æ»šåŠ¨æ–‡ä»¶å¤¹ a2.sinks.k1.hdfs.round = true # å¤šå°‘æ—¶é—´å•ä½åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶å¤¹ a2.sinks.k1.hdfs.roundValue = 1 # é‡æ–°å®šä¹‰æ—¶é—´å•ä½ a2.sinks.k1.hdfs.roundUnit = hour # æ˜¯å¦ä½¿ç”¨æœ¬åœ°æ—¶é—´æˆ³ a2.sinks.k1.hdfs.useLocalTimeStamp = true # ç§¯æ”’å¤šå°‘ä¸ª Event æ‰ flush åˆ° HDFS ä¸€æ¬¡ a2.sinks.k1.hdfs.batchSize = 100 # è®¾ç½®æ–‡ä»¶ç±»å‹ï¼Œå¯æ”¯æŒå‹ç¼© a2.sinks.k1.hdfs.fileType = DataStream # å¤šä¹…ç”Ÿæˆä¸€ä¸ªæ–°çš„æ–‡ä»¶ a2.sinks.k1.hdfs.rollInterval = 600 # è®¾ç½®æ¯ä¸ªæ–‡ä»¶çš„æ»šåŠ¨å¤§å°å¤§æ¦‚æ˜¯ 128M a2.sinks.k1.hdfs.rollSize = 134217700 # æ–‡ä»¶çš„æ»šåŠ¨ä¸ Event æ•°é‡æ— å…³ a2.sinks.k1.hdfs.rollCount = 0 # Describe the channel a2.channels.c1.type = memory a2.channels.c1.capacity = 1000 a2.channels.c1.transactionCapacity = 100 # Bind the source and sink to the channel a2.sources.r1.channels = c1 a2.sinks.k1.channel = c1# ä¿å­˜åˆ°æœ¬åœ°ç›®å½•vim flume-flume-dir.conf # Name the components on this agent a3.sources = r1 a3.sinks = k1 a3.channels = c2 # Describe/configure the source a3.sources.r1.type = avro a3.sources.r1.bind = hadoop102 a3.sources.r1.port = 4142 # Describe the sink a3.sinks.k1.type = file_roll # è¾“å‡ºçš„æœ¬åœ°ç›®å½•å¿…é¡»æ˜¯å·²ç»å­˜åœ¨çš„ç›®å½•ï¼Œå¦‚æœè¯¥ç›®å½•ä¸å­˜åœ¨ï¼Œå¹¶ä¸ä¼šåˆ›å»ºæ–°çš„ç›®å½•ã€‚ a3.sinks.k1.sink.directory = /opt/module/data/flume3 # Describe the channel a3.channels.c2.type = memory a3.channels.c2.capacity = 1000 a3.channels.c2.transactionCapacity = 100 # Bind the source and sink to the channel a3.sources.r1.channels = c2 a3.sinks.k1.channel = c2bin/flume-ng agent --conf conf/ --name a3 --conf-file job/group1/flume-flume-dir.confbin/flume-ng agent --conf conf/ --name a2 --conf-file job/group1/flume-flume-hdfs.confbin/flume-ng agent --conf conf/ --name a1 --conf-file job/group1/flume-file-flume.conf# å¯åŠ¨ Hadoop å’Œ Hiveï¼ŒæŸ¥çœ‹ç»“æœ å‡è¡¡å’Œè½¬ç§» ä½¿ç”¨ Flume1 ç›‘æ§ä¸€ä¸ªç«¯å£ï¼Œå…¶ sink ç»„ä¸­çš„ sink åˆ†åˆ«å¯¹æ¥ Flume2 å’Œ Flume3ï¼Œé‡‡ç”¨ FailoverSinkProcessorï¼Œå®ç°æ•…éšœè½¬ç§»çš„åŠŸèƒ½ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980cd group2/# ç›‘å¬ nectcat å‘é€çš„æ•°æ®vim flume-netcat-flume.conf # Name the components on this agent a1.sources = r1 a1.channels = c1 a1.sinkgroups = g1 a1.sinks = k1 k2 # Describe/configure the source a1.sources.r1.type = netcat a1.sources.r1.bind = localhost a1.sources.r1.port = 44444 # å¤±è´¥é‡è¯• a1.sinkgroups.g1.processor.type = failover a1.sinkgroups.g1.processor.priority.k1 = 5 a1.sinkgroups.g1.processor.priority.k2 = 10 a1.sinkgroups.g1.processor.maxpenalty = 10000 # Describe the sink a1.sinks.k1.type = avro a1.sinks.k1.hostname = hadoop102 a1.sinks.k1.port = 4141 a1.sinks.k2.type = avro a1.sinks.k2.hostname = hadoop102 a1.sinks.k2.port = 4142 # Describe the channel a1.channels.c1.type = memory a1.channels.c1.capacity = 1000 a1.channels.c1.transactionCapacity = 100 # Bind the source and sink to the channel a1.sources.r1.channels = c1 # æˆç»„è´Ÿè½½å¹³è¡¡æˆ–æ•…éšœè½¬ç§»ç­–ç•¥ a1.sinkgroups.g1.sinks = k1 k2 a1.sinks.k1.channel = c1 a1.sinks.k2.channel = c1# æ§åˆ¶å°è¾“å‡º 1 å·vim flume-flume-console1.conf # Name the components on this agent a2.sources = r1 a2.sinks = k1 a2.channels = c1 # Describe/configure the source a2.sources.r1.type = avro a2.sources.r1.bind = hadoop102 a2.sources.r1.port = 4141 # Describe the sink a2.sinks.k1.type = logger # Describe the channel a2.channels.c1.type = memory a2.channels.c1.capacity = 1000 a2.channels.c1.transactionCapacity = 100 # Bind the source and sink to the channel a2.sources.r1.channels = c1 a2.sinks.k1.channel = c1# æ§åˆ¶å°è¾“å‡º 2 å·vim flume-flume-console2.conf # Name the components on this agent a3.sources = r1 a3.sinks = k1 a3.channels = c2 # Describe/configure the source a3.sources.r1.type = avro a3.sources.r1.bind = hadoop102 a3.sources.r1.port = 4142 # Describe the sink a3.sinks.k1.type = logger # Describe the channel a3.channels.c2.type = memory a3.channels.c2.capacity = 1000 a3.channels.c2.transactionCapacity = 100 # Bind the source and sink to the channel a3.sources.r1.channels = c2 a3.sinks.k1.channel = c2bin/flume-ng agent --conf conf/ --name a3 --conf-file job/group2/flume-flume-console2.conf -Dflume.root.logger=INFO,consolebin/flume-ng agent --conf conf/ --name a2 --conf-file job/group2/flume-flume-console1.conf -Dflume.root.logger=INFO,consolebin/flume-ng agent --conf conf/ --name a1 --conf-file job/group2/flume-netcat-flume.conf# ä½¿ç”¨ netcat å·¥å…·å‘æœ¬æœºçš„ 44444 ç«¯å£å‘é€å†…å®¹nc localhost 44444# æŸ¥çœ‹ Flume2 åŠ Flume3 çš„æ§åˆ¶å°æ‰“å°æ—¥å¿— # å°† Flume2 killï¼Œè§‚å¯Ÿ Flume3 çš„æ§åˆ¶å°æ‰“å°æƒ…å†µ# ä½¿ç”¨ jps -ml æŸ¥çœ‹ Flume è¿›ç¨‹ã€‚ èšåˆ hadoop102 ä¸Šçš„ Flume-1 ç›‘æ§æ–‡ä»¶ /opt/module/data/group.logï¼Œhadoop103 ä¸Šçš„ Flume-2 ç›‘æ§æŸä¸€ä¸ªç«¯å£çš„æ•°æ®æµï¼Œ Flume-1 ä¸ Flume-2 å°†æ•°æ®å‘é€ç»™ hadoop104 ä¸Šçš„ Flume-3ï¼ŒFlume-3 å°†æœ€ç»ˆæ•°æ®æ‰“å°åˆ°æ§åˆ¶å°ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677# åˆ†å‘ç¨‹åºxsync flume# å„èŠ‚ç‚¹ä¸Šåˆ›å»ºé…ç½®æ–‡ä»¶ç›®å½•mkdir group3# é…ç½® Source ç”¨äºç›‘æ§ hive.log æ–‡ä»¶ï¼Œé…ç½® Sink è¾“å‡ºæ•°æ®åˆ°ä¸‹ä¸€çº§ Flumeã€‚# åœ¨ hadoop102 ä¸Šç¼–è¾‘é…ç½®æ–‡ä»¶vim flume1-logger-flume.conf # Name the components on this agent a1.sources = r1 a1.sinks = k1 a1.channels = c1 # Describe/configure the source a1.sources.r1.type = exec a1.sources.r1.command = tail -F /opt/module/group.log a1.sources.r1.shell = /bin/bash -c # Describe the sink a1.sinks.k1.type = avro a1.sinks.k1.hostname = hadoop104 a1.sinks.k1.port = 4141 # Describe the channel a1.channels.c1.type = memory a1.channels.c1.capacity = 1000 a1.channels.c1.transactionCapacity = 100 # Bind the source and sink to the channel a1.sources.r1.channels = c1 a1.sinks.k1.channel = c1# é…ç½® Source ç›‘æ§ç«¯å£ 44444 æ•°æ®æµï¼Œé…ç½® Sink æ•°æ®åˆ°ä¸‹ä¸€çº§ Flumeï¼š# åœ¨ hadoop103 ä¸Šç¼–è¾‘é…ç½®æ–‡ä»¶vim flume2-netcat-flume.conf # Name the components on this agent a2.sources = r1 a2.sinks = k1 a2.channels = c1 # Describe/configure the source a2.sources.r1.type = netcat a2.sources.r1.bind = hadoop103 a2.sources.r1.port = 44444 # Describe the sink a2.sinks.k1.type = avro a2.sinks.k1.hostname = hadoop104 a2.sinks.k1.port = 4141 # Use a channel which buffers events in memory a2.channels.c1.type = memory a2.channels.c1.capacity = 1000 a2.channels.c1.transactionCapacity = 100 # Bind the source and sink to the channel a2.sources.r1.channels = c1 a2.sinks.k1.channel = c1# é…ç½® source ç”¨äºæ¥æ”¶ flume1 ä¸ flume2 å‘é€è¿‡æ¥çš„æ•°æ®æµï¼Œæœ€ç»ˆåˆå¹¶å sink åˆ°æ§åˆ¶å°ã€‚# åœ¨ hadoop104 ä¸Šç¼–è¾‘é…ç½®æ–‡ä»¶touch flume3-flume-logger.confvim flume3-flume-logger.conf # Name the components on this agent a3.sources = r1 a3.sinks = k1 a3.channels = c1 # Describe/configure the source a3.sources.r1.type = avro a3.sources.r1.bind = hadoop104 a3.sources.r1.port = 4141 # Describe the sink a3.sinks.k1.type = logger # Describe the channel a3.channels.c1.type = memory a3.channels.c1.capacity = 1000 a3.channels.c1.transactionCapacity = 100 # Bind the source and sink to the channel a3.sources.r1.channels = c1 a3.sinks.k1.channel = c1bin/flume-ng agent --conf conf/ --name a3 --conf-file job/group3/flume3-flume-logger.conf -Dflume.root.logger=INFO,consolebin/flume-ng agent --conf conf/ --name a2 --conf-file job/group3/flume1-logger-flume.confbin/flume-ng agent --conf conf/ --name a1 --conf-file job/group3/flume2-netcat-flume.conf# åœ¨ hadoop103 ä¸Šå‘/opt/module ç›®å½•ä¸‹çš„ group.log è¿½åŠ å†…å®¹ echo 'hello' &gt; group.log# åœ¨ hadoop102 ä¸Šå‘ 44444 ç«¯å£å‘é€æ•°æ® telnet hadoop102 44444# æ£€æŸ¥ hadoop104 ä¸Šæ•°æ® Interceptoråœ¨å®é™…çš„å¼€å‘ä¸­ï¼Œä¸€å°æœåŠ¡å™¨äº§ç”Ÿçš„æ—¥å¿—ç±»å‹å¯èƒ½æœ‰å¾ˆå¤šç§ï¼Œä¸åŒç±»å‹çš„æ—¥å¿—å¯èƒ½éœ€è¦å‘é€åˆ°ä¸åŒçš„åˆ†æç³»ç»Ÿã€‚æ­¤æ—¶ä¼šç”¨åˆ° Flume æ‹“æ‰‘ç»“æ„ä¸­çš„ Multiplexing ç»“æ„ã€‚ Multiplexing çš„åŸç†æ˜¯æ ¹æ® event ä¸­ Header çš„æŸä¸ª key çš„å€¼ï¼Œå°†ä¸åŒçš„ event å‘é€åˆ°ä¸åŒçš„ Channel ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰ä¸€ä¸ª Interceptorï¼Œä¸ºä¸åŒç±»å‹çš„ event çš„ Header ä¸­çš„ key èµ‹äºˆä¸åŒçš„å€¼ã€‚ åœ¨è¯¥æ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬ä»¥ç«¯å£æ•°æ®æ¨¡æ‹Ÿæ—¥å¿—ï¼Œä»¥æ•°å­—ï¼ˆå•ä¸ªï¼‰å’Œå­—æ¯ï¼ˆå•ä¸ªï¼‰æ¨¡æ‹Ÿä¸åŒç±»å‹çš„æ—¥å¿—ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰ interceptor åŒºåˆ†æ•°å­—å’Œå­—æ¯ï¼Œå°†å…¶åˆ†åˆ«å‘å¾€ä¸åŒçš„åˆ†æç³»ç»Ÿ ï¼ˆChannelï¼‰ã€‚ 12345&lt;dependency&gt; &lt;groupId&gt;org.apache.flume&lt;/groupId&gt; &lt;artifactId&gt;flume-ng-core&lt;/artifactId&gt; &lt;version&gt;1.7.0&lt;/version&gt;&lt;/dependency&gt; 123456789101112131415161718192021222324252627282930313233343536// æ‰“æˆ jar åŒ…æ”¾åœ¨ lib ç›®å½•ä¸‹public class CustomInterceptor implements Interceptor &#123; @Override public void initialize() &#123; &#125; @Override public Event intercept(Event event) &#123; byte[] body = event.getBody(); if (body[0] &lt; 'z' &amp;&amp; body[0] &gt; 'a') &#123; // å¤´éƒ¨æ·»åŠ  K-V ç”¨äºè¯†åˆ«åˆ†å‘ event.getHeaders().put(\"type\", \"letter\"); &#125; else if (body[0] &gt; '0' &amp;&amp; body[0] &lt; '9') &#123; event.getHeaders().put(\"type\", \"number\"); &#125; return event; &#125; @Override public List&lt;Event&gt; intercept(List&lt;Event&gt; events) &#123; for (Event event : events) &#123; intercept(event); &#125; return events; &#125; @Override public void close() &#123; &#125; public static class Builder implements Interceptor.Builder &#123; @Override public Interceptor build() &#123; return new CustomInterceptor(); &#125; @Override public void configure(Context context) &#123; &#125; &#125;&#125; ä¸º hadoop102 ä¸Šçš„ Flume1 é…ç½® 1 ä¸ª netcat sourceï¼Œ1 ä¸ª sink groupï¼ˆ2 ä¸ª avro sinkï¼‰ï¼Œ å¹¶é…ç½®ç›¸åº”çš„ ChannelSelector å’Œ interceptorã€‚ 123456789101112131415161718192021222324252627282930313233343536373839# Name the components on this agenta1.sources = r1a1.sinks = k1 k2a1.channels = c1 c2# Describe/configure the sourcea1.sources.r1.type = netcata1.sources.r1.bind = localhosta1.sources.r1.port = 44444a1.sources.r1.interceptors = i1# å…¨è·¯å¾„ï¼Œå¹¶ä¸”ç”¨â€$â€œç¬¦å·åˆ†å‰²åŠ ä¸Šè‡ªå®šä¹‰ Builder çš„ç±»åa1.sources.r1.interceptors.i1.type = com.atguigu.flume.interceptor.CustomInterceptor$Buildera1.sources.r1.selector.type = multiplexinga1.sources.r1.selector.header = type# æ ¹æ®å¤´éƒ¨ value è¿›è¡Œé€šé“çš„é€‰æ‹©a1.sources.r1.selector.mapping.letter = c1a1.sources.r1.selector.mapping.number = c2# Describe the sinka1.sinks.k1.type = avroa1.sinks.k1.hostname = hadoop103a1.sinks.k1.port = 4141a1.sinks.k2.type=avroa1.sinks.k2.hostname = hadoop104a1.sinks.k2.port = 4242# Use a channel which buffers events in memorya1.channels.c1.type = memorya1.channels.c1.capacity = 1000a1.channels.c1.transactionCapacity = 100# Use a channel which buffers events in memorya1.channels.c2.type = memorya1.channels.c2.capacity = 1000a1.channels.c2.transactionCapacity = 100# Bind the source and sink to the channela1.sources.r1.channels = c1 c2a1.sinks.k1.channel = c1a1.sinks.k2.channel = c2# ä¸º hadoop103/104 ä¸Šçš„ Flume3 é…ç½®ä¸€ä¸ª avro source å’Œä¸€ä¸ª logger sink# åˆ†åˆ«åœ¨ hadoop102ï¼Œhadoop103ï¼Œhadoop104 ä¸Šå¯åŠ¨ flume è¿›ç¨‹ï¼Œæ³¨æ„å…ˆåé¡ºåº# åœ¨ hadoop102 ä½¿ç”¨ netcat å‘ localhost:44444 å‘é€å­—æ¯å’Œæ•°å­—# è§‚å¯Ÿ hadoop103 å’Œ hadoop104 æ‰“å°çš„æ—¥å¿— Source ä½¿ç”¨ flume æ¥æ”¶æ•°æ®ï¼Œå¹¶ç»™æ¯æ¡æ•°æ®æ·»åŠ å‰ç¼€ï¼Œè¾“å‡ºåˆ°æ§åˆ¶å°ã€‚å‰ç¼€å¯ä» flume é…ç½®æ–‡ä»¶ä¸­é…ç½®ã€‚ 1234567&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.flume&lt;/groupId&gt; &lt;artifactId&gt;flume-ng-core&lt;/artifactId&gt; &lt;version&gt;1.7.0&lt;/version&gt; &lt;/dependency&gt;&lt;/dependencies&gt; 12345678910111213141516171819202122232425262728293031323334353637383940414243// æ‰“æˆ jar åŒ…æ”¾åœ¨ lib ç›®å½•ä¸‹public class MySource extends AbstractSource implements Configurable, PollableSource &#123; // å®šä¹‰é…ç½®æ–‡ä»¶å°†æ¥è¦è¯»å–çš„å­—æ®µ private Long delay; private String field; // åˆå§‹åŒ–é…ç½®ä¿¡æ¯ @Override public void configure(Context context) &#123; delay = context.getLong(\"delay\"); field = context.getString(\"field\", \"Hello!\"); &#125; @Override public Status process() throws EventDeliveryException &#123; try &#123; // åˆ›å»ºäº‹ä»¶å¤´ä¿¡æ¯ HashMap&lt;String, String&gt; hearderMap = new HashMap&lt;&gt;(); // åˆ›å»ºäº‹ä»¶ SimpleEvent event = new SimpleEvent(); // å¾ªç¯å°è£…äº‹ä»¶ for (int i = 0; i &lt; 5; i++) &#123; // ç»™äº‹ä»¶è®¾ç½®å¤´ä¿¡æ¯ event.setHeaders(hearderMap); // ç»™äº‹ä»¶è®¾ç½®å†…å®¹ event.setBody((field + i).getBytes()); // å°†äº‹ä»¶å†™å…¥ channel getChannelProcessor().processEvent(event); Thread.sleep(delay); &#125; &#125; catch (Exception e) &#123; e.printStackTrace(); return Status.BACKOFF; &#125; return Status.READY; &#125; @Override public long getBackOffSleepIncrement() &#123; return 0; &#125; @Override public long getMaxBackOffSleepInterval() &#123; return 0; &#125;&#125; 123456789101112131415161718# Name the components on this agenta1.sources = r1a1.sinks = k1a1.channels = c1# Describe/configure the sourcea1.sources.r1.type = com.wingo.MySource# è‡ªå®šä¹‰é…ç½®a1.sources.r1.delay = 1000#a1.sources.r1.field = wingo# Describe the sinka1.sinks.k1.type = logger# Use a channel which buffers events in memorya1.channels.c1.type = memorya1.channels.c1.capacity = 1000a1.channels.c1.transactionCapacity = 100# Bind the source and sink to the channela1.sources.r1.channels = c1a1.sinks.k1.channel = c1 SinkSink ä¸æ–­åœ°è½®è¯¢ Channel ä¸­çš„äº‹ä»¶ä¸”æ‰¹é‡åœ°ç§»é™¤å®ƒä»¬ï¼Œå¹¶å°†è¿™äº›äº‹ä»¶æ‰¹é‡å†™å…¥åˆ°å­˜å‚¨æˆ–ç´¢å¼•ç³»ç»Ÿã€æˆ–è€…è¢«å‘é€åˆ°å¦ä¸€ä¸ª Flume Agentã€‚ Sink æ˜¯å®Œå…¨äº‹åŠ¡æ€§çš„ã€‚åœ¨ä» Channel æ‰¹é‡åˆ é™¤æ•°æ®ä¹‹å‰ï¼Œæ¯ä¸ª Sink ç”¨ Channel å¯åŠ¨ä¸€ä¸ªäº‹åŠ¡ã€‚æ‰¹é‡äº‹ä»¶ä¸€æ—¦æˆåŠŸå†™å‡ºåˆ°å­˜å‚¨ç³»ç»Ÿæˆ–ä¸‹ä¸€ä¸ª Flume Agentï¼ŒSink å°±åˆ©ç”¨ Channel æäº¤äº‹åŠ¡ã€‚äº‹åŠ¡ä¸€æ—¦è¢«æäº¤ï¼Œè¯¥ Channel ä»è‡ªå·±çš„å†…éƒ¨ç¼“å†²åŒºåˆ é™¤äº‹ä»¶ã€‚ ä½¿ç”¨ flume æ¥æ”¶æ•°æ®ï¼Œå¹¶åœ¨ Sink ç«¯ç»™æ¯æ¡æ•°æ®æ·»åŠ å‰ç¼€å’Œåç¼€ï¼Œè¾“å‡ºåˆ°æ§åˆ¶å°ã€‚å‰åç¼€å¯åœ¨ flume ä»»åŠ¡é…ç½®æ–‡ä»¶ä¸­é…ç½®ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849// æ‰“æˆ jar åŒ…æ”¾åœ¨ lib ç›®å½•ä¸‹public class MySink extends AbstractSink implements Configurable &#123; // åˆ›å»º Logger å¯¹è±¡ private static final Logger LOG = LoggerFactory.getLogger(AbstractSink.class); private String prefix; private String suffix; @Override public Status process() throws EventDeliveryException &#123; // å£°æ˜è¿”å›å€¼çŠ¶æ€ä¿¡æ¯ Status status; // è·å–å½“å‰ Sink ç»‘å®šçš„ Channel Channel ch = getChannel(); // è·å–äº‹åŠ¡ Transaction txn = ch.getTransaction(); // å£°æ˜äº‹ä»¶ Event event; // å¼€å¯äº‹åŠ¡ txn.begin(); // è¯»å– Channel ä¸­çš„äº‹ä»¶ï¼Œç›´åˆ°è¯»å–åˆ°äº‹ä»¶ç»“æŸå¾ªç¯ while (true) &#123; event = ch.take(); if (event != null) &#123; break; &#125; &#125; try &#123; // å¤„ç†äº‹ä»¶ï¼ˆæ‰“å°ï¼‰ LOG.info(prefix + new String(event.getBody()) + suffix); // äº‹åŠ¡æäº¤ txn.commit(); status = Status.READY; &#125; catch (Exception e) &#123; // é‡åˆ°å¼‚å¸¸ï¼Œäº‹åŠ¡å›æ»š txn.rollback(); status = Status.BACKOFF; &#125; finally &#123; // å…³é—­äº‹åŠ¡ txn.close(); &#125; return status; &#125; @Override public void configure(Context context) &#123; // è¯»å–é…ç½®æ–‡ä»¶å†…å®¹ï¼Œæœ‰é»˜è®¤å€¼ prefix = context.getString(\"prefix\", \"hello:\"); // è¯»å–é…ç½®æ–‡ä»¶å†…å®¹ï¼Œæ— é»˜è®¤å€¼ suffix = context.getString(\"suffix\"); &#125;&#125; 123456789101112131415161718# Name the components on this agenta1.sources = r1a1.sinks = k1a1.channels = c1# Describe/configure the sourcea1.sources.r1.type = netcata1.sources.r1.bind = localhosta1.sources.r1.port = 44444# Describe the sinka1.sinks.k1.type = com.wingo.MySinka1.sinks.k1.suffix = :wingo# Use a channel which buffers events in memorya1.channels.c1.type = memorya1.channels.c1.capacity = 1000a1.channels.c1.transactionCapacity = 100# Bind the source and sink to the channela1.sources.r1.channels = c1a1.sinks.k1.channel = c1 Ganglia ç›‘æ§ å¤§å…¬å¸ä¸€èˆ¬ç”¨å¹³å°ç»„å¼€å‘çš„ç›‘æ§æœåŠ¡ï¼Œä¸­å°å‹å…¬å¸ç”¨çš„æ¯”è¾ƒå¤šçš„æ˜¯è¿™ä¸ªï¼Œäº†è§£å³å¯ã€‚","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://yoursite.com/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"Flume","slug":"Flume","permalink":"http://yoursite.com/tags/Flume/"}]},{"title":"Kafka","slug":"å¤§æ•°æ®/Kafka","date":"2020-05-06T04:05:51.000Z","updated":"2020-07-10T03:41:01.609Z","comments":true,"path":"2020/05/06/å¤§æ•°æ®/Kafka/","link":"","permalink":"http://yoursite.com/2020/05/06/%E5%A4%A7%E6%95%B0%E6%8D%AE/Kafka/","excerpt":"Kafka åŸºæœ¬ä»‹ç»åŠç®€å•ä½¿ç”¨ã€‚","text":"Kafka åŸºæœ¬ä»‹ç»åŠç®€å•ä½¿ç”¨ã€‚ åŸºæœ¬æ¦‚å¿µKafka æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„åŸºäºå‘å¸ƒ / è®¢é˜…æ¨¡å¼çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMessage Queueï¼‰ï¼Œä¸»è¦åº”ç”¨äºå¤§æ•°æ®å®æ—¶å¤„ç†é¢†åŸŸã€‚ ç‚¹å¯¹ç‚¹æ¨¡å¼ï¼ˆä¸€å¯¹ä¸€ï¼Œæ¶ˆè´¹è€…ä¸»åŠ¨æ‹‰å–æ•°æ®ï¼Œæ¶ˆæ¯æ”¶åˆ°åæ¶ˆæ¯æ¸…é™¤ï¼‰ å‘å¸ƒ / è®¢é˜…æ¨¡å¼ï¼ˆä¸€å¯¹å¤šï¼Œæ¶ˆè´¹è€…æ¶ˆè´¹æ•°æ®ä¹‹åä¸ä¼šæ¸…é™¤æ¶ˆæ¯ï¼‰ åŸºç¡€æ¶æ„ Producerï¼šæ¶ˆæ¯ç”Ÿäº§è€…ï¼Œå°±æ˜¯å‘ Kafka Broker å‘æ¶ˆæ¯çš„å®¢æˆ·ç«¯ã€‚ Consumerï¼šæ¶ˆæ¯æ¶ˆè´¹è€…ï¼Œå‘ Kafka Broker å–æ¶ˆæ¯çš„å®¢æˆ·ç«¯ã€‚ Consumer Groupï¼šæ¶ˆè´¹è€…ç»„ï¼Œç”±å¤šä¸ª Consumer ç»„æˆã€‚æ¶ˆè´¹è€…ç»„å†…æ¯ä¸ªæ¶ˆè´¹è€…è´Ÿè´£æ¶ˆè´¹ä¸åŒåˆ†åŒºçš„æ•°æ®ï¼Œä¸€ä¸ªåˆ†åŒºåªèƒ½ç”±ä¸€ä¸ªç»„å†…æ¶ˆè´¹è€…æ¶ˆè´¹ï¼›æ¶ˆè´¹è€…ç»„ä¹‹é—´äº’ä¸å½±å“ã€‚æ‰€æœ‰çš„æ¶ˆè´¹è€…éƒ½å±äºæŸä¸ªæ¶ˆè´¹è€…ç»„ï¼Œå³æ¶ˆè´¹è€…ç»„æ˜¯é€»è¾‘ä¸Šçš„ä¸€ä¸ªè®¢é˜…è€…ã€‚ Brokerï¼šä¸€å° Kafka æœåŠ¡å™¨å°±æ˜¯ä¸€ä¸ª Brokerã€‚ä¸€ä¸ªé›†ç¾¤ç”±å¤šä¸ª Broker ç»„æˆã€‚ä¸€ä¸ª Broker å¯ä»¥å®¹çº³å¤šä¸ª Topicã€‚ Topicï¼šå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªé˜Ÿåˆ—ï¼Œç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…é¢å‘çš„éƒ½æ˜¯ä¸€ä¸ª Topicã€‚ Partitionï¼šä¸ºäº†å®ç°æ‰©å±•æ€§ï¼Œä¸€ä¸ªéå¸¸å¤§çš„ Topic å¯ä»¥åˆ†å¸ƒåˆ°å¤šä¸ª Brokerï¼ˆå³æœåŠ¡å™¨ï¼‰ä¸Šï¼Œä¸€ä¸ª Topic å¯ä»¥åˆ†ä¸ºå¤šä¸ª Partitionï¼Œæ¯ä¸ª Partition æ˜¯ä¸€ä¸ªæœ‰åºçš„é˜Ÿåˆ—ã€‚ Replicaï¼šå‰¯æœ¬ï¼Œä¸ºä¿è¯é›†ç¾¤ä¸­çš„æŸä¸ªèŠ‚ç‚¹å‘ç”Ÿæ•…éšœæ—¶ï¼Œè¯¥èŠ‚ç‚¹ä¸Šçš„ Partition æ•°æ®ä¸ä¸¢å¤±ï¼Œä¸” Kafka ä»ç„¶èƒ½å¤Ÿç»§ç»­å·¥ä½œï¼ŒKafka æä¾›äº†å‰¯æœ¬æœºåˆ¶ï¼Œä¸€ä¸ª Topic çš„æ¯ä¸ªåˆ†åŒºéƒ½æœ‰è‹¥å¹²ä¸ªå‰¯æœ¬ï¼Œä¸€ä¸ª Leader å’Œè‹¥å¹²ä¸ª Followerã€‚ Leaderï¼šæ¯ä¸ªåˆ†åŒºå¤šä¸ªå‰¯æœ¬çš„â€œä¸»â€ï¼Œç”Ÿäº§è€…å‘é€æ•°æ®çš„å¯¹è±¡ï¼Œä»¥åŠæ¶ˆè´¹è€…æ¶ˆè´¹æ•°æ®çš„å¯¹è±¡éƒ½æ˜¯ Leaderã€‚ Followerï¼šæ¯ä¸ªåˆ†åŒºå¤šä¸ªå‰¯æœ¬ä¸­çš„â€œä»â€ï¼Œå®æ—¶ä» Leader ä¸­åŒæ­¥æ•°æ®ï¼Œä¿æŒå’Œ Leader æ•°æ®çš„åŒæ­¥ã€‚Leader å‘ç”Ÿæ•…éšœæ—¶ï¼ŒæŸä¸ª Follower ä¼šæˆä¸ºæ–°çš„ Followerã€‚ å®‰è£…éƒ¨ç½²123456789101112131415161718192021222324252627282930313233343536tar -zxvf kafka_2.11-0.11.0.0.tgz -C /opt/module/mv kafka_2.11-0.11.0.0/ kafkamkdir logscd config/vi server.properties #broker çš„å…¨å±€å”¯ä¸€ç¼–å·ï¼Œä¸èƒ½é‡å¤ broker.id=0 #åˆ é™¤ topic åŠŸèƒ½ä½¿èƒ½ delete.topic.enable=true #å¤„ç†ç½‘ç»œè¯·æ±‚çš„çº¿ç¨‹æ•°é‡ num.network.threads=3 #ç”¨æ¥å¤„ç†ç£ç›˜ IO çš„ç°æˆæ•°é‡ num.io.threads=8 #å‘é€å¥—æ¥å­—çš„ç¼“å†²åŒºå¤§å° socket.send.buffer.bytes=102400 #æ¥æ”¶å¥—æ¥å­—çš„ç¼“å†²åŒºå¤§å° socket.receive.buffer.bytes=102400 #è¯·æ±‚å¥—æ¥å­—çš„ç¼“å†²åŒºå¤§å° socket.request.max.bytes=104857600 #kafka è¿è¡Œæ—¥å¿—å­˜æ”¾çš„è·¯å¾„ log.dirs=/opt/module/kafka/logs #topic åœ¨å½“å‰ broker ä¸Šçš„åˆ†åŒºä¸ªæ•° num.partitions=1 #ç”¨æ¥æ¢å¤å’Œæ¸…ç† data ä¸‹æ•°æ®çš„çº¿ç¨‹æ•°é‡ num.recovery.threads.per.data.dir=1 #segment æ–‡ä»¶ä¿ç•™çš„æœ€é•¿æ—¶é—´ï¼Œè¶…æ—¶å°†è¢«åˆ é™¤ log.retention.hours=168 #é…ç½®è¿æ¥ Zookeeper é›†ç¾¤åœ°å€ zookeeper.connect=hadoop102:2181,hadoop103:2181,hadoop104:2181sudo vi /etc/profile #KAFKA_HOME export KAFKA_HOME=/opt/module/kafka export PATH=$PATH:$KAFKA_HOME/binsource /etc/profile# å°†é…ç½®åˆ†å‘åˆ°å…¶å®ƒ Brokerï¼Œå¹¶ä¸”è®°å¾—ä¿®æ”¹å…¶å®ƒ Broker çš„ç¯å¢ƒå˜é‡# å…¶å®ƒ Broker çš„ broker.id è®°å¾—ä¿®æ”¹ï¼Œä¸å¾—é‡å¤ 123456# Kafka ç¾¤èµ·è„šæœ¬for i in hadoop102 hadoop103 hadoop104 do echo \"========== $i ==========\" ssh $i '/opt/module/kafka/bin/kafka-server-start.sh -daemon /opt/module/kafka/config/server.properties' done Shell æ“ä½œ12345678910111213141516171819# é›†ç¾¤è§„åˆ’ï¼š# hadoop102 ä½ kafka # æŸ¥çœ‹å½“å‰æœåŠ¡å™¨ä¸­çš„æ‰€æœ‰ topicbin/kafka-topics.sh --zookeeper hadoop102:2181 --list# åˆ›å»º topicbin/kafka-topics.sh --zookeeper hadoop102:2181 --create --replication-factor 3 --partitions 1 --topic first# åˆ é™¤ topicbin/kafka-topics.sh --zookeeper hadoop102:2181 --delete --topic first# éœ€è¦ server.properties ä¸­è®¾ç½® delete.topic.enable=true å¦åˆ™åªæ˜¯æ ‡è®°åˆ é™¤ã€‚# å‘é€æ¶ˆæ¯bin/kafka-console-producer.sh --brokerlist hadoop102:9092 --topic first# æ¶ˆè´¹æ¶ˆæ¯bin/kafka-console-consumer.sh --bootstrap-server hadoop102:9092 --topic first# --from-beginningï¼šä¼šæŠŠä¸»é¢˜ä¸­ä»¥å¾€æ‰€æœ‰çš„æ•°æ®éƒ½è¯»å–å‡ºæ¥bin/kafka-console-consumer.sh --bootstrap-server hadoop102:9092 --from-beginning --topic first# æŸ¥çœ‹æŸä¸ª Topic çš„è¯¦æƒ…bin/kafka-topics.sh --zookeeper hadoop102:2181 --describe --topic first# ä¿®æ”¹åˆ†åŒºæ•°bin/kafka-topics.sh --zookeeper hadoop102:2181 --alter --topic first --partitions 6 æ¶æ„æ·±å…¥ Kafka ä¸­æ¶ˆæ¯æ˜¯ä»¥ topic è¿›è¡Œåˆ†ç±»çš„ï¼Œç”Ÿäº§è€…ç”Ÿäº§æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯ï¼Œéƒ½æ˜¯é¢å‘ topic çš„ã€‚ topic æ˜¯é€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œè€Œ partition æ˜¯ç‰©ç†ä¸Šçš„æ¦‚å¿µï¼Œæ¯ä¸ª partition å¯¹åº”äºä¸€ä¸ª log æ–‡ ä»¶ï¼Œè¯¥ log æ–‡ä»¶ä¸­å­˜å‚¨çš„å°±æ˜¯ producer ç”Ÿäº§çš„æ•°æ®ã€‚Producer ç”Ÿäº§çš„æ•°æ®ä¼šè¢«ä¸æ–­è¿½åŠ åˆ°è¯¥ log æ–‡ä»¶æœ«ç«¯ï¼Œä¸”æ¯æ¡æ•°æ®éƒ½æœ‰è‡ªå·±çš„ offsetã€‚æ¶ˆè´¹è€…ç»„ä¸­çš„æ¯ä¸ªæ¶ˆè´¹è€…ï¼Œéƒ½ä¼šå®æ—¶è®°å½•è‡ªå·±æ¶ˆè´¹åˆ°äº†å“ªä¸ª offsetï¼Œä»¥ä¾¿å‡ºé”™æ¢å¤æ—¶ï¼Œä»ä¸Šæ¬¡çš„ä½ç½®ç»§ç»­æ¶ˆè´¹ã€‚ ç”±äºç”Ÿäº§è€…ç”Ÿäº§çš„æ¶ˆæ¯ä¼šä¸æ–­è¿½åŠ åˆ° log æ–‡ä»¶æœ«å°¾ï¼Œä¸ºé˜²æ­¢ log æ–‡ä»¶è¿‡å¤§å¯¼è‡´æ•°æ®å®šä½ æ•ˆç‡ä½ä¸‹ï¼ŒKafka é‡‡å–äº†åˆ†ç‰‡å’Œç´¢å¼•æœºåˆ¶ï¼Œå°†æ¯ä¸ª partition åˆ†ä¸ºå¤šä¸ª segmentã€‚æ¯ä¸ª segment å¯¹åº”ä¸¤ä¸ªæ–‡ä»¶ï¼šâ€œ.indexâ€æ–‡ä»¶å’Œâ€œ.logâ€æ–‡ä»¶ã€‚è¿™äº›æ–‡ä»¶ä½äºä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹ï¼Œè¯¥æ–‡ä»¶å¤¹çš„å‘½åè§„åˆ™ä¸ºï¼štopic åç§°+åˆ†åŒºåºå·ã€‚ ä¾‹å¦‚ï¼Œfirst è¿™ä¸ª topic æœ‰ä¸‰ä¸ªåˆ†åŒºï¼Œåˆ™å…¶å¯¹åº”çš„æ–‡ä»¶å¤¹ä¸º first-0,first-1,first-2ã€‚ index å’Œ log æ–‡ä»¶ä»¥å½“å‰ segment çš„ç¬¬ä¸€æ¡æ¶ˆæ¯çš„ offset å‘½åã€‚ä¸‹å›¾ä¸º index æ–‡ä»¶å’Œ log æ–‡ä»¶çš„ç»“æ„ç¤ºæ„å›¾ã€‚ â€œ.indexâ€æ–‡ä»¶å­˜å‚¨å¤§é‡çš„ç´¢å¼•ä¿¡æ¯ï¼Œâ€œ.logâ€æ–‡ä»¶å­˜å‚¨å¤§é‡çš„æ•°æ®ï¼Œç´¢å¼•æ–‡ä»¶ä¸­çš„å…ƒæ•°æ®æŒ‡å‘å¯¹åº”æ•°æ®æ–‡ä»¶ä¸­ message çš„ç‰©ç†åç§»åœ°å€ã€‚ ç”Ÿäº§è€…åˆ†åŒºç­–ç•¥ æ–¹ä¾¿åœ¨é›†ç¾¤ä¸­æ‰©å±•ï¼Œæ¯ä¸ª Partition å¯ä»¥é€šè¿‡è°ƒæ•´ä»¥é€‚åº”å®ƒæ‰€åœ¨çš„æœºå™¨ï¼Œè€Œä¸€ä¸ª topic åˆå¯ä»¥æœ‰å¤šä¸ª Partition ç»„æˆï¼Œå› æ­¤æ•´ä¸ªé›†ç¾¤å°±å¯ä»¥é€‚åº”ä»»æ„å¤§å°çš„æ•°æ®äº†ï¼› å¯ä»¥æé«˜å¹¶å‘ï¼Œå› ä¸ºå¯ä»¥ä»¥ Partition ä¸ºå•ä½è¯»å†™äº†ã€‚ å°† producer å‘é€çš„æ•°æ®å°è£…æˆä¸€ä¸ª ProducerRecord å¯¹è±¡ã€‚ æŒ‡æ˜ partition çš„æƒ…å†µä¸‹ï¼Œç›´æ¥å°†æŒ‡æ˜çš„å€¼ç›´æ¥ä½œä¸º partiton å€¼ï¼› æ²¡æœ‰æŒ‡æ˜ partition å€¼ä½†æœ‰ key çš„æƒ…å†µä¸‹ï¼Œå°† key çš„ hash å€¼ä¸ topic çš„ partition æ•°è¿›è¡Œå–ä½™å¾—åˆ° partition å€¼ï¼› æ—¢æ²¡æœ‰ partition å€¼åˆæ²¡æœ‰ key å€¼çš„æƒ…å†µä¸‹ï¼Œç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶éšæœºç”Ÿæˆä¸€ä¸ªæ•´æ•°ï¼ˆåé¢æ¯æ¬¡è°ƒç”¨åœ¨è¿™ä¸ªæ•´æ•°ä¸Šè‡ªå¢ï¼‰ï¼Œå°†è¿™ä¸ªå€¼ä¸ topic å¯ç”¨çš„ partition æ€»æ•°å–ä½™å¾—åˆ° partition å€¼ï¼Œä¹Ÿå°±æ˜¯å¸¸è¯´çš„ round-robin ç®—æ³•ã€‚ å¯é æ€§ä¸ºä¿è¯ producer å‘é€çš„æ•°æ®ï¼Œèƒ½å¯é çš„å‘é€åˆ°æŒ‡å®šçš„ topicï¼Œtopic çš„æ¯ä¸ª partition æ”¶åˆ° producer å‘é€çš„æ•°æ®åï¼Œéƒ½éœ€è¦å‘ producer å‘é€ ackï¼ˆacknowledgement ç¡®è®¤æ”¶åˆ°ï¼‰ï¼Œå¦‚æœ producer æ”¶åˆ° ackï¼Œå°±ä¼šè¿›è¡Œä¸‹ä¸€è½®çš„å‘é€ï¼Œå¦åˆ™é‡æ–°å‘é€æ•°æ®ã€‚ Kafka é€‰æ‹©äº†ç¬¬äºŒç§æ–¹æ¡ˆï¼ŒåŸå› å¦‚ä¸‹ï¼š åŒæ ·ä¸ºäº†å®¹å¿ n å°èŠ‚ç‚¹çš„æ•…éšœï¼Œç¬¬ä¸€ç§æ–¹æ¡ˆéœ€è¦ 2n+1 ä¸ªå‰¯æœ¬ï¼Œè€Œç¬¬äºŒç§æ–¹æ¡ˆåªéœ€è¦ n+1 ä¸ªå‰¯æœ¬ï¼Œè€Œ Kafka çš„æ¯ä¸ªåˆ†åŒºéƒ½æœ‰å¤§é‡çš„æ•°æ®ï¼Œç¬¬ä¸€ç§æ–¹æ¡ˆä¼šé€ æˆå¤§é‡æ•°æ®çš„å†—ä½™ã€‚ è™½ç„¶ç¬¬äºŒç§æ–¹æ¡ˆçš„ç½‘ç»œå»¶è¿Ÿä¼šæ¯”è¾ƒé«˜ï¼Œä½†ç½‘ç»œå»¶è¿Ÿå¯¹ Kafka çš„å½±å“è¾ƒå°ã€‚ ISRé‡‡ç”¨ç¬¬äºŒç§æ–¹æ¡ˆä¹‹åï¼Œè®¾æƒ³ä»¥ä¸‹æƒ…æ™¯ï¼šleader æ”¶åˆ°æ•°æ®ï¼Œæ‰€æœ‰ follower éƒ½å¼€å§‹åŒæ­¥æ•°æ®ï¼Œ ä½†æœ‰ä¸€ä¸ª followerï¼Œå› ä¸ºæŸç§æ•…éšœï¼Œè¿Ÿè¿Ÿä¸èƒ½ä¸ leader è¿›è¡ŒåŒæ­¥ï¼Œé‚£ leader å°±è¦ä¸€ç›´ç­‰ä¸‹å»ï¼Œ ç›´åˆ°å®ƒå®ŒæˆåŒæ­¥ï¼Œæ‰èƒ½å‘é€ ackã€‚è¿™ä¸ªé—®é¢˜æ€ä¹ˆè§£å†³å‘¢ï¼Ÿ Leader ç»´æŠ¤äº†ä¸€ä¸ªåŠ¨æ€çš„ in-sync replica set (ISR)ï¼Œæ„ä¸ºå’Œ leader ä¿æŒåŒæ­¥çš„ follower é›† åˆã€‚å½“ ISR ä¸­çš„ follower å®Œæˆæ•°æ®çš„åŒæ­¥ä¹‹åï¼Œfollower å°±ä¼šç»™ fleader å‘é€ ackã€‚å¦‚æœ follower é•¿æ—¶é—´æœªå‘ leader åŒæ­¥æ•°æ® ï¼Œ åˆ™è¯¥ follower å°†è¢«è¸¢å‡º ISR ï¼Œ è¯¥æ—¶é—´é˜ˆå€¼ç”± replica.lag.time.max.ms å‚æ•°è®¾å®šã€‚Leader å‘ç”Ÿæ•…éšœä¹‹åï¼Œå°±ä¼šä» ISR ä¸­é€‰ä¸¾æ–°çš„ leaderã€‚ åº”ç­”æœºåˆ¶å¯¹äºæŸäº›ä¸å¤ªé‡è¦çš„æ•°æ®ï¼Œå¯¹æ•°æ®çš„å¯é æ€§è¦æ±‚ä¸æ˜¯å¾ˆé«˜ï¼Œèƒ½å¤Ÿå®¹å¿æ•°æ®çš„å°‘é‡ä¸¢å¤±ï¼Œ æ‰€ä»¥æ²¡å¿…è¦ç­‰ ISR ä¸­çš„ follower å…¨éƒ¨æ¥æ”¶æˆåŠŸã€‚ æ‰€ä»¥ Kafka ä¸ºç”¨æˆ·æä¾›äº†ä¸‰ç§å¯é æ€§çº§åˆ«ï¼Œç”¨æˆ·æ ¹æ®å¯¹å¯é æ€§å’Œå»¶è¿Ÿçš„è¦æ±‚è¿›è¡Œæƒè¡¡ï¼Œ é€‰æ‹©ä»¥ä¸‹çš„é…ç½®ã€‚ acks ä¸º 0ï¼š producer ä¸ç­‰å¾… broker çš„ ackï¼Œè¿™ä¸€æ“ä½œæä¾›äº†ä¸€ä¸ªæœ€ä½çš„å»¶è¿Ÿï¼Œbroker ä¸€æ¥æ”¶åˆ°è¿˜æ²¡æœ‰å†™å…¥ç£ç›˜å°±å·²ç»è¿”å›ï¼Œå½“ broker æ•…éšœæ—¶æœ‰å¯èƒ½ä¸¢å¤±æ•°æ®ï¼› acks ä¸º 1ï¼šproducer ç­‰å¾… broker çš„ ackï¼Œpartition çš„ leader è½ç›˜æˆåŠŸåè¿”å› ackï¼Œå¦‚æœåœ¨ follower åŒæ­¥æˆåŠŸä¹‹å‰ leader æ•…éšœï¼Œé‚£ä¹ˆå°†ä¼šä¸¢å¤±æ•°æ®ï¼› acks ä¸º -1ï¼ˆallï¼‰ï¼šproducer ç­‰å¾… broker çš„ ackï¼Œpartition çš„ leader å’Œ follower å…¨éƒ¨è½ç›˜æˆåŠŸåæ‰ è¿”å› ackã€‚ä½†æ˜¯å¦‚æœåœ¨ follower åŒæ­¥å®Œæˆåï¼Œbroker å‘é€ ack ä¹‹å‰ï¼Œleader å‘ç”Ÿæ•…éšœï¼Œé‚£ä¹ˆä¼šé€ æˆæ•°æ®é‡å¤ã€‚ æ•…éšœå¤„ç† HWï¼šæŒ‡çš„æ˜¯æ¶ˆè´¹è€…èƒ½è§åˆ°çš„æœ€å¤§çš„ offsetï¼ŒISR é˜Ÿåˆ—ä¸­æœ€å°çš„ LEOã€‚ follower æ•…éšœ follower å‘ç”Ÿæ•…éšœåä¼šè¢«ä¸´æ—¶è¸¢å‡º ISRï¼Œå¾…è¯¥ follower æ¢å¤åï¼Œfollower ä¼šè¯»å–æœ¬åœ°ç£ç›˜è®°å½•çš„ä¸Šæ¬¡çš„ HWï¼Œå¹¶å°† log æ–‡ä»¶é«˜äº HW çš„éƒ¨åˆ†æˆªå–æ‰ï¼Œä» HW å¼€å§‹å‘ leader è¿›è¡ŒåŒæ­¥ã€‚ ç­‰è¯¥ follower çš„ LEO å¤§äºç­‰äºè¯¥ Partition çš„ HWï¼Œå³ follower è¿½ä¸Š leader ä¹‹åï¼Œå°±å¯ä»¥é‡æ–°åŠ å…¥ ISR äº†ã€‚ leader æ•…éšœ leader å‘ç”Ÿæ•…éšœä¹‹åï¼Œä¼šä» ISR ä¸­é€‰å‡ºä¸€ä¸ªæ–°çš„ leaderï¼Œä¹‹åï¼Œä¸ºä¿è¯å¤šä¸ªå‰¯æœ¬ä¹‹é—´çš„æ•°æ®ä¸€è‡´æ€§ï¼Œå…¶ä½™çš„ follower ä¼šå…ˆå°†å„è‡ªçš„ log æ–‡ä»¶é«˜äº HW çš„éƒ¨åˆ†æˆªæ‰ï¼Œç„¶åä»æ–°çš„ leader åŒæ­¥æ•°æ®ã€‚è¿™åªèƒ½ä¿è¯å‰¯æœ¬ä¹‹é—´çš„æ•°æ®ä¸€è‡´æ€§ï¼Œå¹¶ä¸èƒ½ä¿è¯æ•°æ®ä¸ä¸¢å¤±æˆ–è€…ä¸é‡å¤ã€‚ å°†æœåŠ¡å™¨çš„ ACK çº§åˆ«è®¾ç½®ä¸º -1ï¼Œå¯ä»¥ä¿è¯ Producer åˆ° Server ä¹‹é—´ä¸ä¼šä¸¢å¤±æ•°æ®ï¼Œä½†ä¸èƒ½ä¿è¯æ•°æ®ä¸é‡å¤ï¼Œå³ At Least Once è¯­ä¹‰ã€‚ å°†æœåŠ¡å™¨ ACK çº§åˆ«è®¾ç½®ä¸º 0ï¼Œå¯ä»¥ä¿è¯ç”Ÿäº§è€…æ¯æ¡æ¶ˆæ¯åªä¼šè¢«å‘é€ä¸€æ¬¡ï¼Œä½†ä¸èƒ½ä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼Œå³ At Most Once è¯­ä¹‰ã€‚ Exactly Once0.11 ç‰ˆæœ¬çš„ Kafkaï¼Œå¼•å…¥äº†ä¸€é¡¹é‡å¤§ç‰¹æ€§ï¼šå¹‚ç­‰æ€§ã€‚æ‰€è°“çš„å¹‚ç­‰æ€§å°±æ˜¯æŒ‡ Producer ä¸è®º å‘ Server å‘é€å¤šå°‘æ¬¡é‡å¤æ•°æ®ï¼ŒServer ç«¯éƒ½åªä¼šæŒä¹…åŒ–ä¸€æ¡ã€‚å¹‚ç­‰æ€§ç»“åˆ At Least Once è¯­ ä¹‰ï¼Œå°±æ„æˆäº† Kafka çš„ Exactly Once è¯­ä¹‰ã€‚ è¦å¯ç”¨å¹‚ç­‰æ€§ï¼Œåªéœ€è¦å°† Producer çš„å‚æ•°ä¸­ enable.idompotence è®¾ç½®ä¸º true å³å¯ã€‚Kafka çš„å¹‚ç­‰æ€§å®ç°å…¶å®å°±æ˜¯å°†åŸæ¥ä¸‹æ¸¸éœ€è¦åšçš„å»é‡æ”¾åœ¨äº†æ•°æ®ä¸Šæ¸¸ã€‚å¼€å¯å¹‚ç­‰æ€§çš„ Producer åœ¨ åˆå§‹åŒ–çš„æ—¶å€™ä¼šè¢«åˆ†é…ä¸€ä¸ª PIDï¼Œå‘å¾€åŒä¸€ Partition çš„æ¶ˆæ¯ä¼šé™„å¸¦ Sequence Numberã€‚è€Œ Broker ç«¯ä¼šå¯¹åšç¼“å­˜ï¼Œå½“å…·æœ‰ç›¸åŒä¸»é”®çš„æ¶ˆæ¯æäº¤æ—¶ï¼ŒBroker åªä¼šæŒä¹…åŒ–ä¸€æ¡ã€‚ ä½†æ˜¯ PID é‡å¯å°±ä¼šå˜åŒ–ï¼ŒåŒæ—¶ä¸åŒçš„ Partition ä¹Ÿå…·æœ‰ä¸åŒä¸»é”®ï¼Œæ‰€ä»¥å¹‚ç­‰æ€§æ— æ³•ä¿è¯è·¨åˆ†åŒºè·¨ä¼šè¯çš„ Exactly Onceã€‚ æ¶ˆè´¹è€…consumer é‡‡ç”¨ pullï¼ˆæ‹‰ï¼‰æ¨¡å¼ä» broker ä¸­è¯»å–æ•°æ®ã€‚ pushï¼ˆæ¨ï¼‰æ¨¡å¼å¾ˆéš¾é€‚åº”æ¶ˆè´¹é€Ÿç‡ä¸åŒçš„æ¶ˆè´¹è€…ï¼Œå› ä¸ºæ¶ˆæ¯å‘é€é€Ÿç‡æ˜¯ç”± broker å†³å®šçš„ã€‚ å®ƒçš„ç›®æ ‡æ˜¯å°½å¯èƒ½ä»¥æœ€å¿«é€Ÿåº¦ä¼ é€’æ¶ˆæ¯ï¼Œä½†æ˜¯è¿™æ ·å¾ˆå®¹æ˜“é€ æˆ consumer æ¥ä¸åŠå¤„ç†æ¶ˆæ¯ï¼Œå…¸å‹çš„è¡¨ç°å°±æ˜¯æ‹’ç»æœåŠ¡ä»¥åŠç½‘ç»œæ‹¥å¡ã€‚è€Œ pull æ¨¡å¼åˆ™å¯ä»¥æ ¹æ® consumer çš„æ¶ˆè´¹èƒ½åŠ›ä»¥é€‚å½“çš„é€Ÿç‡æ¶ˆè´¹æ¶ˆæ¯ã€‚ pull æ¨¡å¼ä¸è¶³ä¹‹å¤„æ˜¯ï¼Œå¦‚æœ kafka æ²¡æœ‰æ•°æ®ï¼Œæ¶ˆè´¹è€…å¯èƒ½ä¼šé™·å…¥å¾ªç¯ä¸­ï¼Œä¸€ç›´è¿”å›ç©ºæ•°æ®ã€‚é’ˆå¯¹è¿™ä¸€ç‚¹ï¼ŒKafka çš„æ¶ˆè´¹è€…åœ¨æ¶ˆè´¹æ•°æ®æ—¶ä¼šä¼ å…¥ä¸€ä¸ªæ—¶é•¿å‚æ•° timeoutï¼Œå¦‚æœå½“å‰æ²¡æœ‰æ•°æ®å¯ä¾›æ¶ˆè´¹ï¼Œconsumer ä¼šç­‰å¾…ä¸€æ®µæ—¶é—´ä¹‹åå†æ¶ˆè´¹ï¼Œè¿™æ®µæ—¶é•¿å³ä¸º timeoutã€‚ åˆ†åŒºåˆ†é…ç­–ç•¥ä¸€ä¸ª consumer group ä¸­æœ‰å¤šä¸ª consumerï¼Œä¸€ä¸ª topic æœ‰å¤šä¸ª partitionï¼Œæ‰€ä»¥å¿…ç„¶ä¼šæ¶‰åŠåˆ° partition çš„åˆ†é…é—®é¢˜ï¼Œå³ç¡®å®šé‚£ä¸ª partition ç”±å“ªä¸ª consumer æ¥æ¶ˆè´¹ã€‚ Kafka æœ‰ä¸¤ç§åˆ†é…ç­–ç•¥ï¼Œä¸€æ˜¯ RoundRobinï¼Œä¸€æ˜¯ Rangeã€‚ offset ç»´æŠ¤ç”±äº consumer åœ¨æ¶ˆè´¹è¿‡ç¨‹ä¸­å¯èƒ½ä¼šå‡ºç°æ–­ç”µå®•æœºç­‰æ•…éšœï¼Œconsumer æ¢å¤åï¼Œéœ€è¦ä»æ•…éšœå‰çš„ä½ç½®çš„ç»§ç»­æ¶ˆè´¹ï¼Œæ‰€ä»¥ consumer éœ€è¦å®æ—¶è®°å½•è‡ªå·±æ¶ˆè´¹åˆ°äº†å“ªä¸ª offsetï¼Œä»¥ä¾¿æ•…éšœæ¢å¤åç»§ç»­æ¶ˆè´¹ã€‚ Kafka 0.9 ç‰ˆæœ¬ä¹‹å‰ï¼Œconsumer é»˜è®¤å°† offset ä¿å­˜åœ¨ Zookeeper ä¸­ï¼Œä» 0.9 ç‰ˆæœ¬å¼€å§‹ï¼Œ consumer é»˜è®¤å°† offset ä¿å­˜åœ¨ Kafka ä¸€ä¸ªå†…ç½®çš„ topic ä¸­ï¼Œè¯¥ topic ä¸º __consumer_offsetsã€‚ äº‹åŠ¡Kafka äº‹åŠ¡ Kafka ä» 0.11 ç‰ˆæœ¬å¼€å§‹å¼•å…¥äº†äº‹åŠ¡æ”¯æŒã€‚äº‹åŠ¡å¯ä»¥ä¿è¯ Kafka åœ¨ Exactly Once è¯­ä¹‰çš„åŸºç¡€ä¸Šï¼Œç”Ÿäº§å’Œæ¶ˆè´¹å¯ä»¥è·¨åˆ†åŒºå’Œä¼šè¯ï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚ Producer äº‹åŠ¡ ä¸ºäº†å®ç°è·¨åˆ†åŒºè·¨ä¼šè¯çš„äº‹åŠ¡ï¼Œéœ€è¦å¼•å…¥ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„ Transaction IDï¼Œå¹¶å°† Producer è·å¾—çš„ PID å’Œ Transaction ID ç»‘å®šã€‚è¿™æ ·å½“ Producer é‡å¯åå°±å¯ä»¥é€šè¿‡æ­£åœ¨è¿›è¡Œçš„ Transaction ID è·å¾—åŸæ¥çš„ PIDã€‚ ä¸ºäº†ç®¡ç† Transactionï¼ŒKafka å¼•å…¥äº†ä¸€ä¸ªæ–°çš„ç»„ä»¶ Transaction Coordinatorã€‚Producer å°±æ˜¯é€šè¿‡å’Œ Transaction Coordinator äº¤äº’è·å¾— Transaction ID å¯¹åº”çš„ä»»åŠ¡çŠ¶æ€ã€‚Transaction Coordinator è¿˜è´Ÿè´£å°†äº‹åŠ¡æ‰€æœ‰å†™å…¥ Kafka çš„ä¸€ä¸ªå†…éƒ¨ Topicï¼Œè¿™æ ·å³ä½¿æ•´ä¸ªæœåŠ¡é‡å¯ï¼Œç”±äº äº‹åŠ¡çŠ¶æ€å¾—åˆ°ä¿å­˜ï¼Œè¿›è¡Œä¸­çš„äº‹åŠ¡çŠ¶æ€å¯ä»¥å¾—åˆ°æ¢å¤ï¼Œä»è€Œç»§ç»­è¿›è¡Œã€‚ Producer APIæ¶ˆæ¯å‘é€æµç¨‹Kafka çš„ Producer å‘é€æ¶ˆæ¯é‡‡ç”¨çš„æ˜¯å¼‚æ­¥å‘é€çš„æ–¹å¼ã€‚åœ¨æ¶ˆæ¯å‘é€çš„è¿‡ç¨‹ä¸­ï¼Œæ¶‰åŠåˆ°äº†ä¸¤ä¸ªçº¿ç¨‹ï¼šmain çº¿ç¨‹å’Œ Sender çº¿ç¨‹ï¼Œä»¥åŠä¸€ä¸ªçº¿ç¨‹å…±äº«å˜é‡ï¼šRecordAccumulatorã€‚ main çº¿ç¨‹å°†æ¶ˆæ¯å‘é€ç»™ RecordAccumulatorï¼ŒSender çº¿ç¨‹ä¸æ–­ä» RecordAccumulator ä¸­æ‹‰å–æ¶ˆæ¯å‘é€åˆ° Kafka brokerã€‚ ç›¸å…³å‚æ•° batch.sizeï¼šåªæœ‰æ•°æ®ç§¯ç´¯åˆ° batch.size ä¹‹åï¼Œsender æ‰ä¼šå‘é€æ•°æ®ã€‚linger.msï¼šå¦‚æœæ•°æ®è¿Ÿè¿Ÿæœªè¾¾åˆ° batch.sizeï¼Œsender ç­‰å¾… linger.time ä¹‹åå°±ä¼šå‘é€æ•°æ®ã€‚ å¼‚æ­¥å‘é€12345&lt;dependency&gt; &lt;groupId&gt;org.apache.kafka&lt;/groupId&gt; &lt;artifactId&gt;kafka-clients&lt;/artifactId&gt; &lt;version&gt;0.11.0.0&lt;/version&gt;&lt;/dependency&gt; å¸¸ç”¨ç±» KafkaProducerï¼šéœ€è¦åˆ›å»ºä¸€ä¸ªç”Ÿäº§è€…å¯¹è±¡ï¼Œç”¨æ¥å‘é€æ•°æ®ï¼›ProducerConfigï¼šè·å–æ‰€éœ€çš„ä¸€ç³»åˆ—é…ç½®å‚æ•°ï¼›ProducerRecordï¼šæ¯æ¡æ•°æ®éƒ½è¦å°è£…æˆä¸€ä¸ª ProducerRecord å¯¹è±¡ã€‚ 1234567891011121314151617181920212223242526272829// ä¸å¸¦å›è°ƒå‡½æ•°çš„ APIpublic class CustomProducer &#123; public static void main(String[] args) throws ExecutionException, InterruptedException &#123; Properties props = new Properties(); // kafka é›†ç¾¤ï¼Œbroker-list props.put(\"bootstrap.servers\", \"hadoop102:9092\"); props.put(\"acks\", \"all\"); // é‡è¯•æ¬¡æ•° props.put(\"retries\", 1); // æ‰¹æ¬¡å¤§å° props.put(\"batch.size\", 16384); // ç­‰å¾…æ—¶é—´ props.put(\"linger.ms\", 1); // RecordAccumulator ç¼“å†²åŒºå¤§å° props.put(\"buffer.memory\", 33554432); props.put(\"key.serializer\", \"org.apache.kafka.common.serialization.StringSerializer\"); props.put(\"value.serializer\", \"org.apache.kafka.common.serialization.StringSerializer\"); Producer&lt;String, String&gt; producer = new KafkaProducer&lt;&gt;(props); for (int i = 0; i &lt; 10; i++) &#123; producer.send( new ProducerRecord&lt;String, String&gt;( \"first\", Integer.toString(i), Integer.toString(i) // ç»„ key value ) ); &#125; producer.close(); &#125;&#125; å›è°ƒå‡½æ•°ä¼šåœ¨ producer æ”¶åˆ° ack æ—¶è°ƒç”¨ï¼Œä¸ºå¼‚æ­¥è°ƒç”¨ï¼Œè¯¥æ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯ RecordMetadata å’Œ Exceptionï¼Œå¦‚æœ Exception ä¸º nullï¼Œè¯´æ˜æ¶ˆæ¯å‘é€æˆåŠŸï¼Œå¦‚æœ Exception ä¸ä¸º nullï¼Œè¯´æ˜æ¶ˆæ¯å‘é€å¤±è´¥ã€‚ æ¶ˆæ¯å‘é€å¤±è´¥ä¼šè‡ªåŠ¨é‡è¯•ï¼Œä¸éœ€è¦æˆ‘ä»¬åœ¨å›è°ƒå‡½æ•°ä¸­æ‰‹åŠ¨é‡è¯•ã€‚ 1234567891011121314151617181920212223242526// å¸¦å›è°ƒå‡½æ•°çš„ APIpublic class CustomProducer &#123; public static void main(String[] args) throws ExecutionException, InterruptedException &#123; Properties props = new Properties(); // å¸¸è§„é…ç½® Producer&lt;String, String&gt; producer = new KafkaProducer&lt;&gt;(props); for (int i = 0; i &lt; 10; i++) &#123; producer.send( new ProducerRecord&lt;String, String&gt;( \"first\", Integer.toString(i), Integer.toString(i) ), new Callback() &#123; // å›è°ƒå‡½æ•°ï¼Œè¯¥æ–¹æ³•ä¼šåœ¨ Producer æ”¶åˆ° ack æ—¶è°ƒç”¨ï¼Œä¸ºå¼‚æ­¥è°ƒç”¨ @Override public void onCompletion(RecordMetadata metadata, Exception exception) &#123; if (exception == null) &#123; System.out.println(\"success-&gt;\" + metadata.offset()); &#125; else &#123; exception.printStackTrace(); &#125; &#125; &#125; ); &#125; producer.close(); &#125;&#125; åŒæ­¥å‘é€åŒæ­¥å‘é€çš„æ„æ€å°±æ˜¯ï¼Œä¸€æ¡æ¶ˆæ¯å‘é€ä¹‹åï¼Œä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´è‡³è¿”å› ackã€‚ ç”±äº send æ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ª Future å¯¹è±¡ï¼Œæ ¹æ® Futrue å¯¹è±¡çš„ç‰¹ç‚¹ä¹Ÿå¯ä»¥å®ç°åŒæ­¥å‘é€çš„æ•ˆæœï¼Œåªéœ€åœ¨è°ƒç”¨ Future å¯¹è±¡çš„ get æ–¹å‘å³å¯ã€‚ 123456789101112131415public class CustomProducer &#123; public static void main(String[] args) throws ExecutionException, InterruptedException &#123; Properties props = new Properties(); // å¸¸è§„é…ç½® Producer&lt;String, String&gt; producer = new KafkaProducer&lt;&gt;(props); for (int i = 0; i &lt; 10; i++) &#123; producer.send( new ProducerRecord&lt;String, String&gt;( \"first\", Integer.toString(i), Integer.toString(i) ) ).get(); // é˜»å¡ç­‰å¾…è·å–è¿”å›å€¼ &#125; producer.close(); &#125;&#125; Consumer APIconsumer æ¶ˆè´¹æ•°æ®æ—¶çš„å¯é æ€§æ˜¯å¾ˆå®¹æ˜“ä¿è¯çš„ï¼Œå› ä¸ºæ•°æ®åœ¨ Kafka ä¸­æ˜¯æŒä¹…åŒ–çš„ï¼Œæ•…ä¸ç”¨æ‹…å¿ƒæ•°æ®ä¸¢å¤±é—®é¢˜ã€‚ ç”±äº consumer åœ¨æ¶ˆè´¹è¿‡ç¨‹ä¸­å¯èƒ½ä¼šå‡ºç°æ–­ç”µå®•æœºç­‰æ•…éšœï¼Œconsumer æ¢å¤åï¼Œéœ€è¦ä»æ•…éšœå‰çš„ä½ç½®çš„ç»§ç»­æ¶ˆè´¹ï¼Œæ‰€ä»¥ consumer éœ€è¦å®æ—¶è®°å½•è‡ªå·±æ¶ˆè´¹åˆ°äº†å“ªä¸ª offsetï¼Œä»¥ä¾¿æ•…éšœæ¢å¤åç»§ç»­æ¶ˆè´¹ã€‚ æ‰€ä»¥ offset çš„ç»´æŠ¤æ˜¯ consumer æ¶ˆè´¹æ•°æ®æ˜¯å¿…é¡»è€ƒè™‘çš„é—®é¢˜ã€‚ ä¸ºäº†ä½¿æˆ‘ä»¬èƒ½å¤Ÿä¸“æ³¨äºè‡ªå·±çš„ä¸šåŠ¡é€»è¾‘ï¼ŒKafka æä¾›äº†è‡ªåŠ¨æäº¤ offset çš„åŠŸèƒ½ã€‚ è‡ªåŠ¨æäº¤ offset çš„ç›¸å…³å‚æ•°ï¼š enable.auto.commitï¼šæ˜¯å¦å¼€å¯è‡ªåŠ¨æäº¤ offset åŠŸèƒ½ï¼›auto.commit.interval.msï¼šè‡ªåŠ¨æäº¤ offset çš„æ—¶é—´é—´éš”ã€‚ è‡ªåŠ¨æäº¤12345&lt;dependency&gt; &lt;groupId&gt;org.apache.kafka&lt;/groupId&gt; &lt;artifactId&gt;kafka-clients&lt;/artifactId&gt; &lt;version&gt;0.11.0.0&lt;/version&gt;&lt;/dependency&gt; 12345678910111213141516171819202122public class CustomConsumer &#123; public static void main(String[] args) &#123; Properties props = new Properties(); props.put(\"bootstrap.servers\", \"hadoop102:9092\"); props.put(\"group.id\", \"test\"); props.put(\"enable.auto.commit\", \"true\"); props.put(\"auto.commit.interval.ms\", \"1000\"); props.put(\"key.deserializer\", \"org.apache.kafka.common.serialization.StringDeserializer\"); props.put(\"value.deserializer\", \"org.apache.kafka.common.serialization.StringDeserializer\"); KafkaConsumer&lt;String, String&gt; consumer = new KafkaConsumer&lt;&gt;(props); consumer.subscribe(Arrays.asList(\"first\")); while (true) &#123; ConsumerRecords&lt;String, String&gt; records = consumer.poll(100); for (ConsumerRecord&lt;String, String&gt; record : records) &#123; System.out.printf( \"offset = %d, key = %s, value = %s%n\", record.offset(), record.key(), record.value() ); &#125; &#125; &#125;&#125; æ‰‹åŠ¨æäº¤ è‡ªåŠ¨æäº¤æ˜¯åŸºäºæ—¶é—´æäº¤çš„ï¼Œå¼€å‘äººå‘˜éš¾ä»¥æŠŠæ¡ offset æäº¤çš„æ—¶æœºã€‚å› æ­¤ Kafka è¿˜æä¾›äº†æ‰‹åŠ¨æäº¤ offset çš„ APIã€‚ 123456789101112131415161718192021222324252627// åŒæ­¥æäº¤public class CustomComsumer &#123; public static void main(String[] args) &#123; Properties props = new Properties(); // Kafka é›†ç¾¤ props.put(\"bootstrap.servers\", \"hadoop102:9092\"); // æ¶ˆè´¹è€…ç»„ï¼Œåªè¦ group.id ç›¸åŒï¼Œå°±å±äºåŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„ props.put(\"group.id\", \"test\"); props.put(\"enable.auto.commit\", \"false\"); // å…³é—­è‡ªåŠ¨æäº¤ offset props.put(\"key.deserializer\", \"org.apache.kafka.common.serialization.StringDeserializer\"); props.put(\"value.deserializer\", \"org.apache.kafka.common.serialization.StringDeserializer\"); KafkaConsumer&lt;String, String&gt; consumer = new KafkaConsumer&lt;&gt;(props); consumer.subscribe(Arrays.asList(\"first\")); // æ¶ˆè´¹è€…è®¢é˜…ä¸»é¢˜ while (true) &#123; // æ¶ˆè´¹è€…æ‹‰å–æ•°æ® ConsumerRecords&lt;String, String&gt; records = consumer.poll(100); for (ConsumerRecord&lt;String, String&gt; record : records) &#123; System.out.printf( \"offset = %d, key = %s, value = %s%n\", record.offset(), record.key(), record.value() ); &#125; // åŒæ­¥æäº¤ï¼Œå½“å‰çº¿ç¨‹ä¼šé˜»å¡ç›´åˆ° offset æäº¤æˆåŠŸ consumer.commitSync(); &#125; &#125;&#125; 12345678910111213141516171819202122232425262728// å¼‚æ­¥æäº¤public class CustomComsumer &#123; public static void main(String[] args) &#123; Properties props = new Properties(); // ... å¸¸è§„é…ç½® consumer.subscribe(Arrays.asList(\"first\")); // æ¶ˆè´¹è€…è®¢é˜…ä¸»é¢˜ while (true) &#123; // æ¶ˆè´¹è€…æ‹‰å–æ•°æ® ConsumerRecords&lt;String, String&gt; records = consumer.poll(100); for (ConsumerRecord&lt;String, String&gt; record : records) &#123; System.out.printf( \"offset = %d, key = %s, value = %s%n\", record.offset(), record.key(), record.value() ); &#125; //å¼‚æ­¥æäº¤ consumer.commitAsync(new OffsetCommitCallback() &#123; @Override public void onComplete( Map&lt;TopicPartition, OffsetAndMetadata&gt; offsets, Exception exception) &#123; if (exception != null) &#123; System.err.println(\"Commit failed for\" + offsets); &#125; &#125; &#125;); &#125; &#125;&#125; è‡ªå®šä¹‰å­˜å‚¨Kafka 0.9 ç‰ˆæœ¬ä¹‹å‰ï¼Œoffset å­˜å‚¨åœ¨ zookeeperï¼Œ0.9 ç‰ˆæœ¬åŠä¹‹åï¼Œé»˜è®¤å°† offset å­˜å‚¨åœ¨ Kafka çš„ä¸€ä¸ªå†…ç½®çš„ topic ä¸­ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒKafka è¿˜å¯ä»¥é€‰æ‹©è‡ªå®šä¹‰å­˜å‚¨ offsetã€‚ offset çš„ç»´æŠ¤æ˜¯ç›¸å½“ç¹ççš„ï¼Œå› ä¸ºéœ€è¦è€ƒè™‘åˆ°æ¶ˆè´¹è€…çš„ Rebalanceã€‚ å½“æœ‰æ–°çš„æ¶ˆè´¹è€…åŠ å…¥æ¶ˆè´¹è€…ç»„ã€å·²æœ‰çš„æ¶ˆè´¹è€…æ¨å‡ºæ¶ˆè´¹è€…ç»„æˆ–è€…æ‰€è®¢é˜…çš„ä¸»é¢˜çš„åˆ†åŒºå‘ç”Ÿå˜åŒ–ï¼Œå°±ä¼šè§¦å‘åˆ°åˆ†åŒºçš„é‡æ–°åˆ†é…ï¼Œé‡æ–°åˆ†é…çš„è¿‡ç¨‹å«åš Rebalanceã€‚ æ¶ˆè´¹è€…å‘ç”Ÿ Rebalance ä¹‹åï¼Œæ¯ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹çš„åˆ†åŒºå°±ä¼šå‘ç”Ÿå˜åŒ–ã€‚å› æ­¤æ¶ˆè´¹è€…è¦é¦–å…ˆè·å–åˆ°è‡ªå·±è¢«é‡æ–°åˆ†é…åˆ°çš„åˆ†åŒºï¼Œå¹¶ä¸”å®šä½åˆ°æ¯ä¸ªåˆ†åŒºæœ€è¿‘æäº¤çš„ offset ä½ç½®ç»§ç»­æ¶ˆè´¹ã€‚ è¦å®ç°è‡ªå®šä¹‰å­˜å‚¨ offsetï¼Œéœ€è¦å€ŸåŠ© ConsumerRebalanceListenerï¼Œä»¥ä¸‹ä¸ºç¤ºä¾‹ä»£ç ï¼Œå…¶ä¸­æäº¤å’Œè·å– offset çš„æ–¹æ³•ï¼Œéœ€è¦æ ¹æ®æ‰€é€‰çš„ offset å­˜å‚¨ç³»ç»Ÿè‡ªè¡Œå®ç°ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758public class CustomConsumer &#123; // è‡ªå®šä¹‰å­˜å‚¨ offset çš„å®¹å™¨ private static Map&lt;TopicPartition, Long&gt; currentOffset = new HashMap&lt;&gt;(); public static void main(String[] args) &#123; // åˆ›å»ºé…ç½®ä¿¡æ¯ Properties props = new Properties(); // Kafka é›†ç¾¤ props.put(\"bootstrap.servers\", \"hadoop102:9092\"); // æ¶ˆè´¹è€…ç»„ï¼Œåªè¦ group.id ç›¸åŒï¼Œå°±å±äºåŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„ props.put(\"group.id\", \"test\"); // å…³é—­è‡ªåŠ¨æäº¤ offset props.put(\"enable.auto.commit\", \"false\"); // Key å’Œ Value çš„ååºåˆ—åŒ–ç±» props.put(\"key.deserializer\", \"org.apache.kafka.common.serialization.StringDeserializer\"); props.put(\"value.deserializer\", \"org.apache.kafka.common.serialization.StringDeserializer\"); // åˆ›å»ºä¸€ä¸ªæ¶ˆè´¹è€… KafkaConsumer&lt;String, String&gt; consumer = new KafkaConsumer&lt;&gt;(props); //æ¶ˆè´¹è€…è®¢é˜…ä¸»é¢˜ consumer.subscribe( Arrays.asList(\"first\"), new ConsumerRebalanceListener() &#123; // è¯¥æ–¹æ³•ä¼šåœ¨ Rebalance ä¹‹å‰è°ƒç”¨ @Override public void onPartitionsRevoked(Collection&lt;TopicPartition&gt; partitions) &#123; commitOffset(currentOffset); &#125; // è¯¥æ–¹æ³•ä¼šåœ¨ Rebalance ä¹‹åè°ƒç”¨ @Override public void onPartitionsAssigned(Collection&lt;TopicPartition&gt; partitions) &#123; currentOffset.clear(); for (TopicPartition partition : partitions) &#123; // å®šä½åˆ°æœ€è¿‘æäº¤çš„ offset ä½ç½®ç»§ç»­æ¶ˆè´¹ consumer.seek(partition, getOffset(partition)); &#125; &#125; &#125;); while (true) &#123; ConsumerRecords&lt;String, String&gt; records = consumer.poll(100); //æ¶ˆè´¹è€…æ‹‰å–æ•°æ® for (ConsumerRecord&lt;String, String&gt; record : records) &#123; System.out.printf( \"offset = %d, key = %s, value = %s%n\", record.offset(), record.key(), record.value() ); currentOffset.put( new TopicPartition(record.topic(), record.partition()), record.offset() ); &#125; commitOffset(currentOffset); // å¼‚æ­¥æäº¤ &#125; &#125; // è·å–æŸåˆ†åŒºçš„æœ€æ–° offset private static long getOffset(TopicPartition partition) &#123; return 0; &#125; // æäº¤è¯¥æ¶ˆè´¹è€…æ‰€æœ‰åˆ†åŒºçš„ offset private static void commitOffset(Map&lt;TopicPartition, Long&gt; currentOffset) &#123; &#125;&#125; æ‹¦æˆªå™¨producer æ‹¦æˆªå™¨ï¼ˆinterceptorï¼‰æ˜¯åœ¨ Kafka 0.10 ç‰ˆæœ¬è¢«å¼•å…¥çš„ï¼Œä¸»è¦ç”¨äºå®ç° clients ç«¯çš„å®šåˆ¶åŒ–æ§åˆ¶é€»è¾‘ã€‚ å¯¹äº producer è€Œè¨€ï¼Œinterceptor ä½¿å¾—ç”¨æˆ·åœ¨æ¶ˆæ¯å‘é€å‰ä»¥åŠ producer å›è°ƒé€»è¾‘å‰æœ‰æœºä¼šå¯¹æ¶ˆæ¯åšä¸€äº›å®šåˆ¶åŒ–éœ€æ±‚ï¼Œæ¯”å¦‚ä¿®æ”¹æ¶ˆæ¯ç­‰ã€‚ åŒæ—¶ï¼Œproducer å…è®¸ç”¨æˆ·æŒ‡å®šå¤šä¸ª interceptor æŒ‰åºä½œç”¨äºåŒä¸€æ¡æ¶ˆæ¯ä»è€Œå½¢æˆä¸€ä¸ªæ‹¦æˆªé“¾ï¼ˆinterceptor chainï¼‰ã€‚ 123456789101112131415161718192021// å¢åŠ æ—¶é—´æˆ³æ‹¦æˆªå™¨public class TimeInterceptor implements ProducerInterceptor&lt;String, String&gt; &#123; // è·å–é…ç½®ä¿¡æ¯å’Œåˆå§‹åŒ–æ•°æ®æ—¶è°ƒç”¨ @Override public void configure(Map&lt;String, ?&gt; configs) &#123; &#125; // å¯¹æ¶ˆæ¯è¿›è¡Œè‡ªå®šä¹‰æ“ä½œ @Override public ProducerRecord&lt;String, String&gt; onSend(ProducerRecord&lt;String, String&gt; record) &#123; // åˆ›å»ºä¸€ä¸ªæ–°çš„ recordï¼ŒæŠŠæ—¶é—´æˆ³å†™å…¥æ¶ˆæ¯ä½“çš„æœ€å‰éƒ¨ return new ProducerRecord(record.topic(), record.partition(), record.timestamp(), record.key(), System.currentTimeMillis() + \",\" + record.value().toString()); &#125; @Override public void onAcknowledgement(RecordMetadata metadata, Exception exception) &#123; &#125; @Override public void close() &#123; &#125;&#125; 12345678910111213141516171819202122232425262728// ç»Ÿè®¡å‘é€æ¶ˆæ¯æˆåŠŸå’Œå‘é€å¤±è´¥æ¶ˆæ¯æ•°ï¼Œå¹¶åœ¨ producer å…³é—­æ—¶æ‰“å°è¿™ä¸¤ä¸ªè®¡æ•°å™¨public class CounterInterceptor implements ProducerInterceptor&lt;String, String&gt;&#123; private int errorCounter = 0; private int successCounter = 0; @Override public void configure(Map&lt;String, ?&gt; configs) &#123; &#125; @Override public ProducerRecord&lt;String, String&gt; onSend(ProducerRecord&lt;String, String&gt; record) &#123; return record; &#125; // æ¶ˆæ¯å‘é€æˆåŠŸæˆ–è€…å¤±è´¥åéƒ½ä¼šè°ƒç”¨æ­¤æ–¹æ³• @Override public void onAcknowledgement(RecordMetadata metadata, Exception exception) &#123; // ç»Ÿè®¡æˆåŠŸå’Œå¤±è´¥çš„æ¬¡æ•° if (exception == null) &#123; successCounter++; &#125; else &#123; errorCounter++; &#125; &#125; @Override public void close() &#123; // ä¿å­˜ç»“æœ System.out.println(\"Successful sent: \" + successCounter); System.out.println(\"Failed sent: \" + errorCounter); &#125;&#125; 1234567891011121314151617181920212223242526272829// producer public class InterceptorProducer &#123; public static void main(String[] args) throws Exception &#123; // è®¾ç½®é…ç½®ä¿¡æ¯ Properties props = new Properties(); props.put(\"bootstrap.servers\", \"hadoop102:9092\"); props.put(\"acks\", \"all\"); props.put(\"retries\", 3); props.put(\"batch.size\", 16384); props.put(\"linger.ms\", 1); props.put(\"buffer.memory\", 33554432); props.put(\"key.serializer\", \"org.apache.kafka.common.serialization.StringSerializer\"); props.put(\"value.serializer\", \"org.apache.kafka.common.serialization.StringSerializer\"); // æ„å»ºæ‹¦æˆªé“¾ List&lt;String&gt; interceptors = new ArrayList&lt;&gt;(); interceptors.add(\"com.wingo.kafka.interceptor.TimeInterceptor\"); interceptors.add(\"com.wingo.kafka.interceptor.CounterInterceptor\"); props.put(ProducerConfig.INTERCEPTOR_CLASSES_CONFIG, interceptors); String topic = \"first\"; Producer&lt;String, String&gt; producer = new KafkaProducer&lt;&gt;(props); // å‘é€æ¶ˆæ¯ for (int i = 0; i &lt; 10; i++) &#123; ProducerRecord&lt;String, String&gt; record = new ProducerRecord&lt;&gt;(topic, \"message\" + i); producer.send(record); &#125; // ä¸€å®šè¦å…³é—­ producerï¼Œè¿™æ ·æ‰ä¼šè°ƒç”¨ interceptor çš„ close æ–¹æ³• producer.close(); &#125;&#125; Kafka Eagle åŸºäº Web çš„ Kafka ç›‘æ§ã€‚ æ‚é¡¹é«˜æ•ˆè¯»å†™æ•°æ® Kafka çš„ producer ç”Ÿäº§æ•°æ®ï¼Œè¦å†™å…¥åˆ° log æ–‡ä»¶ä¸­ï¼Œå†™çš„è¿‡ç¨‹æ˜¯ä¸€ç›´è¿½åŠ åˆ°æ–‡ä»¶æœ«ç«¯ï¼Œ ä¸ºé¡ºåºå†™ã€‚å®˜ç½‘æœ‰æ•°æ®è¡¨æ˜ï¼ŒåŒæ ·çš„ç£ç›˜ï¼Œé¡ºåºå†™èƒ½åˆ° 600M/sï¼Œè€Œéšæœºå†™åªæœ‰ 100K/sã€‚è¿™ ç£ç›˜çš„æœºæ¢°æœºæ„æœ‰å…³ï¼Œé¡ºåºå†™ä¹‹æ‰€ä»¥å¿«ï¼Œæ˜¯å› ä¸ºå…¶çœå»äº†å¤§é‡ç£å¤´å¯»å€çš„æ—¶é—´ã€‚ é›¶æ‹·è´ã€‚ Zookeeper çš„ä½œç”¨ Kafka é›†ç¾¤ä¸­æœ‰ä¸€ä¸ª broker ä¼šè¢«é€‰ä¸¾ä¸º Controllerï¼Œè´Ÿè´£ç®¡ç†é›†ç¾¤ broker çš„ä¸Šä¸‹çº¿ï¼Œæ‰€æœ‰ topic çš„åˆ†åŒºå‰¯æœ¬åˆ†é…å’Œ leader é€‰ä¸¾ç­‰å·¥ä½œã€‚ Controller çš„ç®¡ç†å·¥ä½œéƒ½æ˜¯ä¾èµ–äº Zookeeper çš„ã€‚","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://yoursite.com/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"Kafka","slug":"Kafka","permalink":"http://yoursite.com/tags/Kafka/"}]},{"title":"Hbase","slug":"å¤§æ•°æ®/HBase","date":"2020-05-03T00:41:00.000Z","updated":"2020-07-10T03:39:13.940Z","comments":true,"path":"2020/05/03/å¤§æ•°æ®/HBase/","link":"","permalink":"http://yoursite.com/2020/05/03/%E5%A4%A7%E6%95%B0%E6%8D%AE/HBase/","excerpt":"HBase çš„ç®€æœ¬ä»‹ç»åŠç®€ä½¿ç”¨ã€‚","text":"HBase çš„ç®€æœ¬ä»‹ç»åŠç®€ä½¿ç”¨ã€‚ ç®€ä»‹HBase æ˜¯ä¸€ç§åˆ†å¸ƒå¼ã€å¯æ‰©å±•ã€æ”¯æŒæµ·é‡æ•°æ®å­˜å‚¨çš„ NoSQL æ•°æ®åº“ã€‚ é€»è¾‘ä¸Šï¼ŒHBase çš„æ•°æ®æ¨¡å‹åŒå…³ç³»å‹æ•°æ®åº“å¾ˆç±»ä¼¼ï¼Œæ•°æ®å­˜å‚¨åœ¨ä¸€å¼ è¡¨ä¸­ï¼Œæœ‰è¡Œæœ‰åˆ—ã€‚ ä½†ä» HBase çš„åº•å±‚ç‰©ç†å­˜å‚¨ç»“æ„ï¼ˆK-Vï¼‰æ¥çœ‹ï¼ŒHBase æ›´åƒæ˜¯ä¸€ä¸ª multi-dimensional mapã€‚ æ•°æ®æ¨¡å‹Name Space å‘½åç©ºé—´ï¼Œç±»ä¼¼äºå…³ç³»å‹æ•°æ®åº“çš„ DatabBase æ¦‚å¿µï¼Œæ¯ä¸ªå‘½åç©ºé—´ä¸‹æœ‰å¤šä¸ªè¡¨ã€‚HBase æœ‰ä¸¤ä¸ªè‡ªå¸¦çš„å‘½åç©ºé—´ï¼Œåˆ†åˆ«æ˜¯ hbase å’Œ defaultï¼Œhbase ä¸­å­˜æ”¾çš„æ˜¯ HBase å†…ç½®çš„è¡¨ï¼Œ default è¡¨æ˜¯ç”¨æˆ·é»˜è®¤ä½¿ç”¨çš„å‘½åç©ºé—´ã€‚ Region ç±»ä¼¼äºå…³ç³»å‹æ•°æ®åº“çš„è¡¨æ¦‚å¿µã€‚ä¸åŒçš„æ˜¯ï¼ŒHBase å®šä¹‰è¡¨æ—¶åªéœ€è¦å£°æ˜åˆ—æ—å³å¯ï¼Œä¸éœ€ è¦å£°æ˜å…·ä½“çš„åˆ—ã€‚è¿™æ„å‘³ç€ï¼Œå¾€ HBase å†™å…¥æ•°æ®æ—¶ï¼Œå­—æ®µå¯ä»¥åŠ¨æ€ã€æŒ‰éœ€æŒ‡å®šã€‚å› æ­¤ï¼Œå’Œå…³ ç³»å‹æ•°æ®åº“ç›¸æ¯”ï¼ŒHBase èƒ½å¤Ÿè½»æ¾åº”å¯¹å­—æ®µå˜æ›´çš„åœºæ™¯ã€‚ Row HBase è¡¨ä¸­çš„æ¯è¡Œæ•°æ®éƒ½ç”±ä¸€ä¸ª RowKey å’Œå¤šä¸ª Columnï¼ˆåˆ—ï¼‰ç»„æˆï¼Œæ•°æ®æ˜¯æŒ‰ç…§ RowKey çš„å­—å…¸é¡ºåºå­˜å‚¨çš„ï¼Œå¹¶ä¸”æŸ¥è¯¢æ•°æ®æ—¶åªèƒ½æ ¹æ® RowKey è¿›è¡Œæ£€ç´¢ï¼Œæ‰€ä»¥ RowKey çš„è®¾è®¡ååˆ†é‡ è¦ã€‚ Column HBase ä¸­çš„æ¯ä¸ªåˆ—éƒ½ç”± (Column Family) åˆ—æ— å’Œ (Column Qualifier )åˆ—é™å®šç¬¦è¿›è¡Œé™ å®šï¼Œä¾‹å¦‚ infoï¼šnameï¼Œinfoï¼šageã€‚å»ºè¡¨æ—¶ï¼Œåªéœ€æŒ‡æ˜åˆ—æ—ï¼Œè€Œåˆ—é™å®šç¬¦æ— éœ€é¢„å…ˆå®šä¹‰ã€‚ Time Stamp ç”¨äºæ ‡è¯†æ•°æ®çš„ä¸åŒç‰ˆæœ¬ï¼ˆversionï¼‰ï¼Œæ¯æ¡æ•°æ®å†™å…¥æ—¶ï¼Œå¦‚æœä¸æŒ‡å®šæ—¶é—´æˆ³ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä¸ºå…¶åŠ ä¸Šè¯¥å­—æ®µï¼Œå…¶å€¼ä¸ºå†™å…¥ HBase çš„æ—¶é—´ã€‚ Cell ç”± {RowKey, Column Familyï¼šColumn Qualifier, Time Stamp} å”¯ä¸€ç¡®å®šçš„å•å…ƒã€‚cell ä¸­çš„æ•°æ®æ˜¯æ²¡æœ‰ç±»å‹çš„ï¼Œå…¨éƒ¨æ˜¯å­—èŠ‚ç å½¢å¼å­˜è´®ã€‚ åŸºæœ¬æ¶æ„ Region Server Region Server ä¸º Region çš„ç®¡ç†è€…ï¼Œå…¶å®ç°ç±»ä¸º HRegionServerï¼Œä¸»è¦ä½œç”¨å¦‚ä¸‹ï¼šå¯¹äºæ•°æ®çš„æ“ä½œï¼šget, put, deleteï¼› å¯¹äº Region çš„æ“ä½œï¼šsplitRegionã€compactRegionã€‚ Master Master æ˜¯æ‰€æœ‰ Region Server çš„ç®¡ç†è€…ï¼Œå…¶å®ç°ç±»ä¸º HMasterï¼Œä¸»è¦ä½œç”¨å¦‚ä¸‹ï¼š å¯¹äºè¡¨çš„æ“ä½œï¼šcreate, delete, alterï¼›å¯¹äº RegionServerçš„æ“ä½œï¼šåˆ†é… regions åˆ°æ¯ä¸ªRegionServerï¼Œç›‘æ§æ¯ä¸ª RegionServer çš„çŠ¶æ€ï¼Œè´Ÿè½½å‡è¡¡å’Œæ•…éšœè½¬ç§»ã€‚ Zookeeper HBase é€šè¿‡ Zookeeper æ¥åš Master çš„é«˜å¯ç”¨ã€RegionServer çš„ç›‘æ§ã€å…ƒæ•°æ®çš„å…¥å£ä»¥åŠé›†ç¾¤é…ç½®çš„ç»´æŠ¤ç­‰å·¥ä½œã€‚ HDFS HDFS ä¸º HBase æä¾›æœ€ç»ˆçš„åº•å±‚æ•°æ®å­˜å‚¨æœåŠ¡ï¼ŒåŒæ—¶ä¸º HBase æä¾›é«˜å¯ç”¨çš„æ”¯æŒã€‚ å®‰è£…éƒ¨ç½² é¦–å…ˆè¦ä¿è¯ Zookeeper é›†ç¾¤å’Œ Hadoop é›†ç¾¤æ­£å¸¸éƒ¨ç½²å¹¶å¯åŠ¨ã€‚ 1234tar -zxvf hbase-1.3.1-bin.tar.gz -C /opt/modulevi hbase-env.sh export JAVA_HOME=/opt/module/jdk1.6.0_144 export HBASE_MANAGES_ZK=false # å…³é—­è‡ªå¸¦çš„ Zookeeper 12345678910111213141516171819202122232425&lt;!-- ä¿®æ”¹ hbase-site.xml é…ç½®æ–‡ä»¶ --&gt;&lt;configuration&gt; &lt;property&gt; &lt;name&gt;hbase.rootdir&lt;/name&gt; &lt;value&gt;hdfs://hadoop102:9000/HBase&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;hbase.cluster.distributed&lt;/name&gt; &lt;value&gt;true&lt;/value&gt; &lt;/property&gt; &lt;!-- 0.98 åçš„æ–°å˜åŠ¨ï¼Œä¹‹å‰ç‰ˆæœ¬æ²¡æœ‰.port,é»˜è®¤ç«¯å£ä¸º 60000 --&gt; &lt;property&gt; &lt;name&gt;hbase.master.port&lt;/name&gt; &lt;value&gt;16000&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;!-- region servers --&gt; &lt;name&gt;hbase.zookeeper.quorum&lt;/name&gt; &lt;value&gt;hadoop102,hadoop103,hadoop104&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;hbase.zookeeper.property.dataDir&lt;/name&gt; &lt;value&gt;/opt/module/zookeeper-3.4.10/zkData&lt;/value&gt; &lt;/property&gt;&lt;/configuration&gt; 12345678# è½¯è¿æ¥ hadoop é…ç½®æ–‡ä»¶åˆ° HBaseln -s /opt/module/hadoop2.7.2/etc/hadoop/core-site.xml /opt/module/hbase/conf/core-site.xmlln -s /opt/module/hadoop2.7.2/etc/hadoop/hdfs-site.xml /opt/module/hbase/conf/hdfs-site.xml# åˆ©ç”¨è„šæœ¬å‘é€åˆ°å…¶å®ƒé›†ç¾¤ xsync hbase/ # æ—¶é—´åŒæ­¥ï¼Œå¦åˆ™ä¼šå¯¼è‡´ regionserver æ— æ³•å¯åŠ¨ï¼ŒæŠ›å‡º ClockOutOfSyncException å¼‚å¸¸ bin/start-hbase.sh # å¯é€šè¿‡ 16010 ç«¯å£è®¿é—® HBase ç®¡ç†é¡µé¢ ShellåŸºæœ¬æ“ä½œ123456# è¿›å…¥ HBase å®¢æˆ·ç«¯å‘½ä»¤è¡Œbin/hbase shell# æŸ¥çœ‹å¸®åŠ©å‘½ä»¤hbase(main):001:0&gt; help# æŸ¥çœ‹å½“å‰æ•°æ®åº“ä¸­æœ‰å“ªäº›è¡¨ hbase(main):002:0&gt; list è¡¨æ“ä½œ1234567891011121314151617181920212223242526272829303132333435# åˆ›å»ºè¡¨ï¼Œåªéœ€è¦åˆå§‹åŒ–ä¸€ä¸ªåˆ—æ—ä¿¡æ¯å³å¯hbase(main):002:0&gt; create 'student','info'# æ’å…¥æ•°æ®åˆ°è¡¨ hbase(main):003:0&gt; put 'student','1001','info:sex','male'hbase(main):004:0&gt; put 'student','1001','info:age','18'hbase(main):005:0&gt; put 'student','1002','info:name','Janna'hbase(main):006:0&gt; put 'student','1002','info:sex','female'hbase(main):007:0&gt; put 'student','1002','info:age','20'# æ‰«ææŸ¥çœ‹è¡¨æ•°æ®hbase(main):008:0&gt; scan 'student'hbase(main):009:0&gt; scan 'student',&#123;STARTROW=&gt;'1001', STOPROW=&gt;'1001'&#125;hbase(main):010:0&gt; scan 'student',&#123;STARTROW=&gt;'1001'&#125;# æŸ¥çœ‹è¡¨ç»“æ„hbase(main):011:0&gt; describe â€˜studentâ€™# æ›´æ–°æŒ‡å®šå­—æ®µçš„æ•°æ®hbase(main):012:0&gt; put 'student','1001','info:name','Nick'hbase(main):013:0&gt; put 'student','1001','info:age','100'hbase(main):014:0&gt; get 'student','1001'hbase(main):015:0&gt; get 'student','1001','info:name'# ç»Ÿè®¡è¡¨æ•°æ®è¡Œæ•°hbase(main):021:0&gt; count 'student'# åˆ é™¤æ•°æ®# åˆ é™¤æŸ rowkey çš„å…¨éƒ¨æ•°æ®hbase(main):016:0&gt; deleteall 'student','1001'# åˆ é™¤æŸ rowkey çš„æŸä¸€åˆ—æ•°æ®hbase(main):017:0&gt; delete 'student','1002','info:sex'# æ¸…ç©ºè¡¨æ•°æ®hbase(main):018:0&gt; truncate 'student'# åˆ é™¤è¡¨ éœ€è¦å…ˆè®©è¯¥è¡¨ä¸º disable çŠ¶æ€hbase(main):019:0&gt; disable 'student'# ç„¶åæ‰èƒ½ drop è¿™ä¸ªè¡¨hbase(main):020:0&gt; drop 'student'# å˜æ›´è¡¨ä¿¡æ¯ å°† info åˆ—æ—ä¸­çš„æ•°æ®å­˜æ”¾ 3 ä¸ªç‰ˆæœ¬hbase(main):022:0&gt; alter 'student',&#123;NAME=&gt;'info',VERSIONS=&gt;3&#125;hbase(main):022:0&gt; get 'student','1001',&#123;COLUMN=&gt;'info:name',VERSIONS=&gt;3&#125; è¿›é˜¶ç»“æ„åŸç† StoreFile ä¿å­˜å®é™…æ•°æ®çš„ç‰©ç†æ–‡ä»¶ï¼ŒStoreFile ä»¥ HFile çš„å½¢å¼å­˜å‚¨åœ¨ HDFS ä¸Šã€‚æ¯ä¸ª Store ä¼šæœ‰ ä¸€ä¸ªæˆ–å¤šä¸ª StoreFileï¼ˆHFileï¼‰ï¼Œæ•°æ®åœ¨æ¯ä¸ª StoreFile ä¸­éƒ½æ˜¯æœ‰åºçš„ã€‚ MemStore å†™ç¼“å­˜ï¼Œç”±äº HFile ä¸­çš„æ•°æ®è¦æ±‚æ˜¯æœ‰åºçš„ï¼Œæ‰€ä»¥æ•°æ®æ˜¯å…ˆå­˜å‚¨åœ¨ MemStore ä¸­ï¼Œæ’å¥½åºåï¼Œç­‰åˆ°è¾¾åˆ·å†™æ—¶æœºæ‰ä¼šåˆ·å†™åˆ° HFileï¼Œæ¯æ¬¡åˆ·å†™éƒ½ä¼šå½¢æˆä¸€ä¸ªæ–°çš„ HFileã€‚ WAL Write-Ahead Logging ç”±äºæ•°æ®è¦ç» MemStore æ’åºåæ‰èƒ½åˆ·å†™åˆ° HFileï¼Œä½†æŠŠæ•°æ®ä¿å­˜åœ¨å†…å­˜ä¸­ä¼šæœ‰å¾ˆé«˜çš„æ¦‚ç‡å¯¼è‡´æ•°æ®ä¸¢å¤±ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ•°æ®ä¼šå…ˆå†™åœ¨ä¸€ä¸ªå«åš Write-Ahead logfile çš„æ–‡ä»¶ ä¸­ï¼Œç„¶åå†å†™å…¥ MemStore ä¸­ã€‚æ‰€ä»¥åœ¨ç³»ç»Ÿå‡ºç°æ•…éšœçš„æ—¶å€™ï¼Œæ•°æ®å¯ä»¥é€šè¿‡è¿™ä¸ªæ—¥å¿—æ–‡ä»¶é‡å»ºã€‚ å†™æµç¨‹ Client å…ˆè®¿é—® zookeeperï¼Œè·å– hbase:meta è¡¨ä½äºå“ªä¸ª Region Serverï¼› è®¿é—®å¯¹åº”çš„ Region Serverï¼Œè·å– hbase:meta è¡¨ï¼Œæ ¹æ®å†™è¯·æ±‚çš„ namespace:table/rowkeyï¼Œ æŸ¥è¯¢å‡ºç›®æ ‡æ•°æ®ä½äºå“ªä¸ª Region Server ä¸­çš„å“ªä¸ª Region ä¸­ã€‚å¹¶å°†è¯¥ table çš„ region ä¿¡æ¯ä»¥ åŠ meta è¡¨çš„ä½ç½®ä¿¡æ¯ç¼“å­˜åœ¨å®¢æˆ·ç«¯çš„ meta cacheï¼Œæ–¹ä¾¿ä¸‹æ¬¡è®¿é—®ï¼› ä¸ç›®æ ‡ Region Server è¿›è¡Œé€šè®¯ï¼› å°†æ•°æ®é¡ºåºå†™å…¥ï¼ˆè¿½åŠ ï¼‰åˆ° WALï¼› å°†æ•°æ®å†™å…¥å¯¹åº”çš„ MemStoreï¼Œæ•°æ®ä¼šåœ¨ MemStore è¿›è¡Œæ’åºï¼› å‘å®¢æˆ·ç«¯å‘é€ ackï¼› ç­‰è¾¾åˆ° MemStore çš„åˆ·å†™æ—¶æœºåï¼Œå°†æ•°æ®åˆ·å†™åˆ° HFileã€‚ MemStore Flush åˆ·å†™æ—¶æœº å½“æŸä¸ª memstroe çš„å¤§å°è¾¾åˆ°äº† hbase.hregion.memstore.flush.sizeï¼ˆé»˜è®¤å€¼ 128Mï¼‰ï¼Œ å…¶æ‰€åœ¨ region çš„æ‰€æœ‰ memstore éƒ½ä¼šåˆ·å†™ã€‚ å½“ memstore çš„å¤§å°è¾¾åˆ°äº† hbase.hregion.memstore.flush.sizeï¼ˆé»˜è®¤å€¼ 128Mï¼‰ * hbase.hregion.memstore.block.multiplierï¼ˆé»˜è®¤å€¼ 4ï¼‰ æ—¶ï¼Œä¼šé˜»æ­¢ç»§ç»­å¾€è¯¥ memstore å†™æ•°æ®ã€‚ å½“ region server ä¸­ memstore çš„æ€»å¤§å°è¾¾åˆ° java_heapsize * hbase.regionserver.global.memstore.sizeï¼ˆé»˜è®¤å€¼ 0.4ï¼‰* hbase.regionserver.global.memstore.size.lower.limitï¼ˆé»˜è®¤å€¼ 0.95ï¼‰ï¼Œ region ä¼šæŒ‰ç…§å…¶æ‰€æœ‰ memstore çš„å¤§å°é¡ºåºï¼ˆç”±å¤§åˆ°å°ï¼‰ä¾æ¬¡è¿›è¡Œåˆ·å†™ã€‚ç›´åˆ° region server ä¸­æ‰€æœ‰ memstore çš„æ€»å¤§å°å‡å°åˆ°ä¸Šè¿°å€¼ä»¥ä¸‹ã€‚ å½“ region server ä¸­ memstore çš„æ€»å¤§å°è¾¾åˆ° java_heapsize * hbase.regionserver.global.memstore.sizeï¼ˆé»˜è®¤å€¼ 0.4ï¼‰ æ—¶ï¼Œä¼šé˜»æ­¢ç»§ç»­å¾€æ‰€æœ‰çš„ memstore å†™æ•°æ®ã€‚ åˆ°è¾¾è‡ªåŠ¨åˆ·å†™çš„æ—¶é—´ï¼Œä¹Ÿä¼šè§¦å‘ memstore flushã€‚è‡ªåŠ¨åˆ·æ–°çš„æ—¶é—´é—´éš”ç”±è¯¥å±æ€§è¿›è¡Œé…ç½®ï¼Œå®˜æ–¹å»ºè®®å…³é—­æ­¤é…ç½®ï¼Œhbase.regionserver.optionalcacheflushintervalï¼ˆé»˜è®¤ 1 å°æ—¶ï¼‰ã€‚ å½“ WAL æ–‡ä»¶çš„æ•°é‡è¶…è¿‡ hbase.regionserver.max.logsï¼Œregion ä¼šæŒ‰ç…§æ—¶é—´é¡ºåºä¾æ¬¡è¿›è¡Œåˆ·å†™ï¼Œç›´åˆ° WAL æ–‡ä»¶æ•°é‡å‡å°åˆ° hbase.regionserver.max.log ä»¥ä¸‹ï¼ˆè¯¥å±æ€§åå·²ç»åºŸå¼ƒï¼Œ ç°æ— éœ€æ‰‹åŠ¨è®¾ç½®ï¼Œæœ€å¤§å€¼ä¸º 32ï¼‰ã€‚ è¯»æµç¨‹ Client å…ˆè®¿é—® zookeeperï¼Œè·å– hbase:meta è¡¨ä½äºå“ªä¸ª Region Serverï¼› è®¿é—®å¯¹åº”çš„ Region Serverï¼Œè·å– hbase:meta è¡¨ï¼Œæ ¹æ®è¯»è¯·æ±‚çš„ namespace:table/rowkeyï¼Œ æŸ¥è¯¢å‡ºç›®æ ‡æ•°æ®ä½äºå“ªä¸ª Region Server ä¸­çš„å“ªä¸ª Region ä¸­ã€‚å¹¶å°†è¯¥ table çš„ region ä¿¡æ¯ä»¥ åŠ meta è¡¨çš„ä½ç½®ä¿¡æ¯ç¼“å­˜åœ¨å®¢æˆ·ç«¯çš„ meta cacheï¼Œæ–¹ä¾¿ä¸‹æ¬¡è®¿é—®ï¼› ä¸ç›®æ ‡ Region Server è¿›è¡Œé€šè®¯ï¼› åˆ†åˆ«åœ¨ Block Cacheï¼ˆè¯»ç¼“å­˜ï¼‰ï¼ŒMemStore å’Œ Store Fileï¼ˆHFileï¼‰ä¸­æŸ¥è¯¢ç›®æ ‡æ•°æ®ï¼Œå¹¶å°†æŸ¥åˆ°çš„æ‰€æœ‰æ•°æ®è¿›è¡Œåˆå¹¶ã€‚æ­¤å¤„æ‰€æœ‰æ•°æ®æ˜¯æŒ‡åŒä¸€æ¡æ•°æ®çš„ä¸åŒç‰ˆæœ¬ï¼ˆtime stampï¼‰æˆ–è€…ä¸åŒçš„ç±»å‹ï¼ˆPut / Deleteï¼‰ï¼› å°†ä»æ–‡ä»¶ä¸­æŸ¥è¯¢åˆ°çš„æ•°æ®å—ï¼ˆBlockï¼ŒHFile æ•°æ®å­˜å‚¨å•å…ƒï¼Œé»˜è®¤å¤§å°ä¸º 64KBï¼‰ç¼“å­˜åˆ° Block Cacheï¼› å°†åˆå¹¶åçš„æœ€ç»ˆç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚ StoreFile Compactionç”±äº memstore æ¯æ¬¡åˆ·å†™éƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„ HFileï¼Œä¸”åŒä¸€ä¸ªå­—æ®µçš„ä¸åŒç‰ˆæœ¬ï¼ˆtimestampï¼‰ å’Œä¸åŒç±»å‹ï¼ˆPut / Deleteï¼‰æœ‰å¯èƒ½ä¼šåˆ†å¸ƒåœ¨ä¸åŒçš„ HFile ä¸­ï¼Œå› æ­¤æŸ¥è¯¢æ—¶éœ€è¦éå†æ‰€æœ‰çš„ HFileã€‚ä¸ºäº†å‡å°‘ HFile çš„ä¸ªæ•°ï¼Œä»¥åŠæ¸…ç†æ‰è¿‡æœŸå’Œåˆ é™¤çš„æ•°æ®ï¼Œä¼šè¿›è¡Œ StoreFile Compactionã€‚ Compaction åˆ†ä¸ºä¸¤ç§ï¼Œåˆ†åˆ«æ˜¯ Minor Compaction å’Œ Major Compactionã€‚ Minor Compaction ä¼šå°†ä¸´è¿‘çš„è‹¥å¹²ä¸ªè¾ƒå°çš„ HFile åˆå¹¶æˆä¸€ä¸ªè¾ƒå¤§çš„ HFileï¼Œä½†ä¸ä¼šæ¸…ç†è¿‡æœŸå’Œåˆ é™¤çš„æ•°æ®ã€‚Major Compaction ä¼šå°†ä¸€ä¸ª Store ä¸‹çš„æ‰€æœ‰çš„ HFile åˆå¹¶æˆä¸€ä¸ªå¤§ HFileï¼Œå¹¶ä¸”ä¼šæ¸…ç†æ‰è¿‡æœŸ å’Œåˆ é™¤çš„æ•°æ®ã€‚ Region Splité»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ª Table èµ·åˆåªæœ‰ä¸€ä¸ª Regionï¼Œéšç€æ•°æ®çš„ä¸æ–­å†™å…¥ï¼ŒRegion ä¼šè‡ªåŠ¨è¿›è¡Œæ‹†åˆ†ã€‚åˆšæ‹†åˆ†æ—¶ï¼Œä¸¤ä¸ªå­ Region éƒ½ä½äºå½“å‰çš„ Region Serverï¼Œä½†å¤„äºè´Ÿè½½å‡è¡¡çš„è€ƒè™‘ï¼Œ HMaster æœ‰å¯èƒ½ä¼šå°†æŸä¸ª Region è½¬ç§»ç»™å…¶ä»–çš„ Region Serverã€‚ Region Split æ—¶æœºï¼š .å½“1ä¸ªregionä¸­çš„æŸä¸ª Store ä¸‹æ‰€æœ‰ StoreFile çš„æ€»å¤§å°è¶…è¿‡ hbase.hregion.max.filesizeï¼Œ è¯¥ Region å°±ä¼šè¿›è¡Œæ‹†åˆ†ï¼ˆ0.94 ç‰ˆæœ¬ä¹‹å‰ï¼‰ã€‚ å½“ 1 ä¸ª region ä¸­ çš„ æŸ ä¸ª Store ä¸‹æ‰€æœ‰ StoreFile çš„ æ€» å¤§ å° è¶… è¿‡Min(R^2 * â€œhbase.hregion.memstore.flush.sizeâ€,hbase.hregion.max.filesizeâ€)ï¼Œè¯¥ Region å°±ä¼šè¿›è¡Œæ‹†åˆ†ï¼Œå…¶ ä¸­ R ä¸ºå½“å‰ Region Server ä¸­å±äºè¯¥ Table çš„ä¸ªæ•°ï¼ˆ0.94 ç‰ˆæœ¬ä¹‹åï¼‰ã€‚ API12345678910&lt;dependency&gt; &lt;groupId&gt;org.apache.hbase&lt;/groupId&gt; &lt;artifactId&gt;hbase-server&lt;/artifactId&gt; &lt;version&gt;1.3.1&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.hbase&lt;/groupId&gt; &lt;artifactId&gt;hbase-client&lt;/artifactId&gt; &lt;version&gt;1.3.1&lt;/version&gt;&lt;/dependency&gt; 123456789// è·å– Configuration å¯¹è±¡public static Configuration conf;static&#123; // ä½¿ç”¨ HBaseConfiguration çš„å•ä¾‹æ–¹æ³•å®ä¾‹åŒ– conf = HBaseConfiguration.create(); // åªéœ€è¦é…ç½® Zookeeper çš„ä¿¡æ¯ï¼Œå› ä¸º mate éƒ½å­˜åœ¨ Zookeeper ä¸­ conf.set(\"hbase.zookeeper.quorum\", \"192.166.9.102\"); conf.set(\"hbase.zookeeper.property.clientPort\", \"2181\");&#125; è¡¨æ“ä½œ123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119// åˆ¤æ–­è¡¨çŸ³æ˜¯å¦å­˜åœ¨public static boolean isTableExist(String tableName) throws MasterNotRunningException,ZooKeeperConnectionException, IOException&#123; // åœ¨ HBase ä¸­ç®¡ç†ã€è®¿é—®è¡¨éœ€è¦å…ˆåˆ›å»º HBaseAdmin å¯¹è±¡ ConnectionFactory.createConnection(conf); HBaseAdmin admin = new HBaseAdmin(conf); return admin.tableExists(tableName);&#125;// åˆ›å»ºè¡¨public static void createTable(String tableName, String... columnFamily) throws MasterNotRunningException, ZooKeeperConnectionException, IOException&#123; HBaseAdmin admin = new HBaseAdmin(conf); // åˆ¤æ–­è¡¨æ˜¯å¦å­˜åœ¨ if(isTableExist(tableName))&#123; System.out.println(\"è¡¨\" + tableName + \"å·²å­˜åœ¨\"); &#125;else&#123; // åˆ›å»ºè¡¨å±æ€§å¯¹è±¡ï¼Œè¡¨åéœ€è¦è½¬å­—èŠ‚ HTableDescriptor descriptor = new HTableDescriptor(TableName.valueOf(tableName)); // åˆ›å»ºå¤šä¸ªåˆ—æ— for(String cf : columnFamily)&#123; descriptor.addFamily(new HColumnDescriptor(cf)); &#125; // æ ¹æ®å¯¹è¡¨çš„é…ç½®ï¼Œåˆ›å»ºè¡¨ admin.createTable(descriptor); System.out.println(\"è¡¨\" + tableName + \"åˆ›å»ºæˆåŠŸï¼\"); &#125;&#125;// åˆ é™¤è¡¨public static void dropTable(String tableName) throws MasterNotRunningException, ZooKeeperConnectionException, IOException&#123; HBaseAdmin admin = new HBaseAdmin(conf); if(isTableExist(tableName))&#123; admin.disableTable(tableName); admin.deleteTable(tableName); System.out.println(\"è¡¨\" + tableName + \"åˆ é™¤æˆåŠŸï¼\"); &#125;else&#123; System.out.println(\"è¡¨\" + tableName + \"ä¸å­˜åœ¨ï¼\"); &#125;&#125;// å‘è¡¨ä¸­æ’å…¥æ•°æ®public static void addRowData( String tableName, String rowKey, String columnFamily, String column, String value) throws IOException&#123; // åˆ›å»º HTable å¯¹è±¡ HTable hTable = new HTable(conf, tableName); // å‘è¡¨ä¸­æ’å…¥æ•°æ® Put put = new Put(Bytes.toBytes(rowKey)); // å‘ Put å¯¹è±¡ä¸­ç»„è£…æ•°æ® put.add(Bytes.toBytes(columnFamily), Bytes.toBytes(column), Bytes.toBytes(value)); hTable.put(put); hTable.close(); System.out.println(\"æ’å…¥æ•°æ®æˆåŠŸ\");&#125;// åˆ é™¤å¤šè¡Œæ•°æ®public static void deleteMultiRow(String tableName, String... rows) throws IOException&#123; HTable hTable = new HTable(conf, tableName); List&lt;Delete&gt; deleteList = new ArrayList&lt;Delete&gt;(); for(String row : rows)&#123; Delete delete = new Delete(Bytes.toBytes(row)); deleteList.add(delete); &#125; hTable.delete(deleteList); hTable.close();&#125;// è·å–æ‰€æœ‰æ•°æ®public static void getAllRows(String tableName) throws IOException&#123; HTable hTable = new HTable(conf, tableName); // å¾—åˆ°ç”¨äºæ‰«æ region çš„å¯¹è±¡ Scan scan = new Scan(); // ä½¿ç”¨ HTable å¾—åˆ° resultcanner å®ç°ç±»çš„å¯¹è±¡ ResultScanner resultScanner = hTable.getScanner(scan); for(Result result : resultScanner)&#123; // è·å–å•å…ƒ Cell[] cells = result.rawCells(); for(Cell cell : cells)&#123; //å¾—åˆ° rowkey System.out.println(\" è¡Œ é”® :\" + Bytes.toString(CellUtil.cloneRow(cell))); //å¾—åˆ°åˆ—æ— System.out.println(\" åˆ— æ— \" + Bytes.toString(CellUtil.cloneFamily(cell))); System.out.println(\" åˆ— :\" + Bytes.toString(CellUtil.cloneQualifier(cell))); System.out.println(\" å€¼ :\" + Bytes.toString(CellUtil.cloneValue(cell))); &#125; &#125;&#125;// è·å–æŸä¸€è¡Œæ•°æ®public static void getRow(String tableName, String rowKey) throws IOException&#123; HTable table = new HTable(conf, tableName); Get get = new Get(Bytes.toBytes(rowKey)); Result result = table.get(get); for(Cell cell : result.rawCells())&#123; System.out.println(\" è¡Œ é”® :\" + Bytes.toString(result.getRow())); System.out.println(\" åˆ— æ— \" + Bytes.toString(CellUtil.cloneFamily(cell))); System.out.println(\" åˆ— :\" + Bytes.toString(CellUtil.cloneQualifier(cell))); System.out.println(\" å€¼ :\" + Bytes.toString(CellUtil.cloneValue(cell))); System.out.println(\"æ—¶é—´æˆ³:\" + cell.getTimestamp()); &#125;&#125;// è·å–æŸä¸€è¡ŒæŒ‡å®š(åˆ—æ—:åˆ—)çš„æ•°æ®public static void getRowQualifier( String tableName, String rowKey, String family, String qualifier) throws IOException&#123; HTable table = new HTable(conf, tableName); Get get = new Get(Bytes.toBytes(rowKey)); get.addColumn(Bytes.toBytes(family),Bytes.toBytes(qualifier)); Result result = table.get(get); for(Cell cell : result.rawCells())&#123; System.out.println(\" è¡Œ é”® :\" + Bytes.toString(result.getRow())); System.out.println(\" åˆ— æ— \" + Bytes.toString(CellUtil.cloneFamily(cell))); System.out.println(\" åˆ— :\" + Bytes.toString(CellUtil.cloneQualifier(cell))); System.out.println(\" å€¼ :\" + Bytes.toString(CellUtil.cloneValue(cell))); &#125;&#125; MapReduceé€šè¿‡ HBase çš„ç›¸å…³ Java APIï¼Œæˆ‘ä»¬å¯ä»¥å®ç°ä¼´éš HBase æ“ä½œçš„ MapReduce è¿‡ç¨‹ï¼Œæ¯”å¦‚ä½¿ç”¨ MapReduce å°†æ•°æ®ä»æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿå¯¼å…¥åˆ° HBase çš„è¡¨ä¸­ï¼Œæ¯”å¦‚æˆ‘ä»¬ä» HBase ä¸­è¯»å–ä¸€äº›åŸ å§‹æ•°æ®åä½¿ç”¨ MapReduce åšæ•°æ®åˆ†æã€‚ å®˜æ–¹æ¡ˆä¾‹12345678910111213141516171819202122vi /etc/profile # export HBASE_HOME=/opt/module/hbase # export HADOOP_HOME=/opt/module/hadoop-2.7.2vi hadoop-env.sh # æ³¨æ„ï¼šåœ¨ for å¾ªç¯ä¹‹åé… # export HADOOP_CLASSPATH=$HADOOP_CLASSPATH:/opt/module/hbase/lib/*# ä½¿ç”¨ MapReduce å°†æœ¬åœ°æ•°æ®å¯¼å…¥åˆ° HBasevi fruit.tsv # 1001 Apple Red # 1002 Pear Yellow # 1003 Pineapple Yellow# åˆ›å»º Hbase è¡¨Hbase(main):001:0&gt; create 'fruit','info'# åœ¨ HDFS ä¸­åˆ›å»º input_fruit æ–‡ä»¶å¤¹å¹¶ä¸Šä¼  fruit.tsv æ–‡ä»¶/opt/module/hadoop-2.7.2/bin/hdfs dfs -mkdir /input_fruit//opt/module/hadoop-2.7.2/bin/hdfs dfs -put fruit.tsv /input_fruit/# æ‰§è¡Œ MapReduce åˆ° HBase çš„ fruit è¡¨ä¸­/opt/module/hadoop-2.7.2/bin/yarn jar lib/hbase-server-1.3.1.jarimporttsv \\-Dimporttsv.columns=HBASE_ROW_KEY,info:name,info:color fruit \\hdfs://hadoop102:9000/input_fruit# ä½¿ç”¨ scan å‘½ä»¤æŸ¥çœ‹å¯¼å…¥åçš„ç»“æœHbase(main):001:0&gt; scan â€˜fruitâ€™ è‡ªå®šä¹‰ å°† fruit è¡¨ä¸­çš„ä¸€éƒ¨åˆ†æ•°æ®ï¼Œé€šè¿‡ MR è¿å…¥åˆ° fruit_mr è¡¨ä¸­ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677// ç»§æ‰¿çš„éƒ½æ˜¯ HBase æä¾›çš„ Mapper å’Œ Reducerpublic class ReadFruitMapper extends TableMapper&lt;ImmutableBytesWritable, Put&gt; &#123; @Override protected void map(ImmutableBytesWritable key, Result value, Context context) throws IOException, InterruptedException &#123; // å°† fruit çš„ name å’Œ color æå–å‡ºæ¥ï¼Œç›¸å½“äºå°†æ¯ä¸€è¡Œæ•°æ®è¯»å–å‡ºæ¥æ”¾å…¥åˆ° Put å¯¹è±¡ä¸­ Put put = new Put(key.get()); // éå†æ·»åŠ  column è¡Œ for(Cell cell: value.rawCells())&#123; // æ·»åŠ /å…‹éš†åˆ—æ—:info if(\"info\".equals(Bytes.toString(CellUtil.cloneFamily(cell))))&#123; // æ·»åŠ /å…‹éš†åˆ—ï¼šname if(\"name\".equals(Bytes.toString(CellUtil.cloneQualifier(cell))))&#123; // å°†è¯¥åˆ— cell åŠ å…¥åˆ° put å¯¹è±¡ä¸­ put.add(cell); // æ·»åŠ /å…‹éš†åˆ—:color &#125;else if(\"color\".equals(Bytes.toString(CellUtil.cloneQualifier(cell))))&#123; // å‘è¯¥åˆ— cell åŠ å…¥åˆ° put å¯¹è±¡ä¸­ put.add(cell); &#125; &#125; &#125; // å°†ä» fruit è¯»å–åˆ°çš„æ¯è¡Œæ•°æ®å†™å…¥åˆ° context ä¸­ä½œä¸º map çš„è¾“å‡º context.write(key, put); &#125;&#125;public class WriteFruitMRReducer extends TableReducer&lt;ImmutableBytesWritable, Put, NullWritable&gt; &#123; @Override protected void reduce(ImmutableBytesWritable key, Iterable&lt;Put&gt; values, Context context) throws IOException, InterruptedException &#123; // è¯»å‡ºæ¥çš„æ¯ä¸€è¡Œæ•°æ®å†™å…¥åˆ° fruit_mr è¡¨ä¸­ for(Put put: values)&#123; context.write(NullWritable.get(), put); &#125; &#125;&#125;public class Fruit2FruitMRRunner extends Configured implements Tool&#123; // ç»„è£… Job public int run(String[] args) throws Exception &#123; // å¾—åˆ° Configuration Configuration conf = this.getConf(); // åˆ›å»º Job ä»»åŠ¡ Job job = Job.getInstance(conf, this.getClass().getSimpleName()); job.setJarByClass(Fruit2FruitMRRunner.class); // é…ç½® Job Scan scan = new Scan(); scan.setCacheBlocks(false); scan.setCaching(500); // è®¾ç½® Mapperï¼Œæ³¨æ„å¯¼å…¥çš„æ˜¯ mapreduce åŒ…ä¸‹çš„ï¼Œä¸æ˜¯ mapred åŒ…ä¸‹çš„ï¼Œåè€…æ˜¯è€ç‰ˆæœ¬ TableMapReduceUtil.initTableMapperJob( \"fruit\", // æ•°æ®æºçš„è¡¨å scan, // scan æ‰«ææ§åˆ¶å™¨ ReadFruitMapper.class, // è®¾ç½® Mapper ç±» ImmutableBytesWritable.class, // è®¾ç½® Mapper è¾“å‡º key ç±»å‹ Put.class, // è®¾ç½® Mapper è¾“å‡º value å€¼ç±»å‹ job // è®¾ç½®ç»™å“ªä¸ª JOB ); // è®¾ç½® Reducer TableMapReduceUtil.initTableReducerJob(\"fruit_mr\", WriteFruitMRReducer.class, job); // è®¾ç½® Reduce æ•°é‡ï¼Œæœ€å°‘ 1 ä¸ª job.setNumReduceTasks(1); boolean isSuccess = job.waitForCompletion(true); if(!isSuccess)&#123; throw new IOException(\"Job running with error\"); &#125; return isSuccess ? 0 : 1; &#125;&#125;public static void main( String[] args ) throws Exception&#123; Configuration conf = HbaseConfiguration.create(); int status = ToolRunner.run(conf, new Fruit2FruitMRRunner(), args); System.exit(status);&#125; å®ç°å°† HDFS ä¸­çš„æ•°æ®å†™å…¥åˆ° Hbase è¡¨ä¸­ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061public class ReadFruitFromHDFSMapper extends Mapper&lt;LongWritable, Text, ImmutableBytesWritable, Put&gt; &#123; @Override protected void map(LongWritable key, Text value, Context context) throws IOException, InterruptedException &#123; // ä» HDFS ä¸­è¯»å–çš„æ•°æ® String lineValue = value.toString(); // è¯»å–å‡ºæ¥çš„æ¯è¡Œæ•°æ®ä½¿ç”¨ \\t è¿›è¡Œåˆ†å‰²ï¼Œå­˜äº String æ•°ç»„ String[] values = lineValue.split(\"\\t\"); // æ ¹æ®æ•°æ®ä¸­å€¼çš„å«ä¹‰å–å€¼ String rowKey = values[0]; String name = values[1]; String color = values[2]; // åˆå§‹åŒ– rowKey ImmutableBytesWritable rowKeyWritable = new ImmutableBytesWritable(Bytes.toBytes(rowKey)); // åˆå§‹åŒ– put å¯¹è±¡ Put put = new Put(Bytes.toBytes(rowKey)); // å‚æ•°åˆ†åˆ« åˆ—æ—ã€åˆ—ã€å€¼ put.add(Bytes.toBytes(\"info\"), Bytes.toBytes(\"name\"), Bytes.toBytes(name)); put.add(Bytes.toBytes(\"info\"), Bytes.toBytes(\"color\"),Bytes.toBytes(color)); context.write(rowKeyWritable, put); &#125;&#125;public class WriteFruitMRFromTxtReducer extends TableReducer&lt;ImmutableBytesWritable, Put, NullWritable&gt; &#123; @Override protected void reduce(ImmutableBytesWritable key, Iterable&lt;Put&gt; values, Context context) throws IOException, InterruptedException&#123; // è¯»å‡ºæ¥çš„æ¯ä¸€è¡Œæ•°æ®å†™å…¥åˆ° fruit_hdfs è¡¨ä¸­ for(Put put: values)&#123; context.write(NullWritable.get(), put); &#125; &#125;&#125;public class Txt2FruitRunner extends Configured implements Tool&#123; public int run(String[] args) throws Exception &#123; // å¾—åˆ° Configuration Configuration conf = this.getConf(); // åˆ›å»º Job ä»»åŠ¡ Job job = Job.getInstance(conf, this.getClass().getSimpleName()); job.setJarByClass(Txt2FruitRunner.class); Path inPath = new Path(\"hdfs://hadoop102:9000/input_fruit/fruit.tsv\"); FileInputFormat.addInputPath(job, inPath); // è®¾ç½® Mapper job.setMapperClass(ReadFruitFromHDFSMapper.class); job.setMapOutputKeyClass(ImmutableBytesWritable.class); job.setMapOutputValueClass(Put.class); // è®¾ç½® Reducer TableMapReduceUtil.initTableReducerJob(\"fruit_mr\", WriteFruitMRFromTxtReducer.class, job); // è®¾ç½® Reduce æ•°é‡ï¼Œæœ€å°‘ 1 ä¸ª job.setNumReduceTasks(1); boolean isSuccess = job.waitForCompletion(true); if(!isSuccess)&#123; throw new IOException(\"Job running with error\"); &#125; return isSuccess ? 0 : 1; &#125;&#125; é›†æˆ Hive æ“ä½œ Hive çš„åŒæ—¶å¯¹ HBase ä¹Ÿä¼šäº§ç”Ÿå½±å“ï¼Œæ‰€ä»¥ Hive éœ€è¦æŒæœ‰æ“ä½œ HBase çš„ Jarã€‚ 1234567891011# è¿™é‡Œä½¿ç”¨è½¯é“¾æ¥çš„æ–¹å¼å¼•åŒ…export HBASE_HOME=/opt/module/hbaseexport HIVE_HOME=/opt/module/hiveln -s $HBASE_HOME/lib/hbase-common-1.3.1.jar $HIVE_HOME/lib/hbase-common-1.3.1.jarln -s $HBASE_HOME/lib/hbase-server-1.3.1.jar $HIVE_HOME/lib/hbaseserver-1.3.1.jarln -s $HBASE_HOME/lib/hbase-client-1.3.1.jar $HIVE_HOME/lib/hbase-client-1.3.1.jarln -s $HBASE_HOME/lib/hbase-protocol-1.3.1.jar $HIVE_HOME/lib/hbase-protocol-1.3.1.jarln -s $HBASE_HOME/lib/hbase-it-1.3.1.jar $HIVE_HOME/lib/hbase-it1.3.1.jarln -s $HBASE_HOME/lib/htrace-core-3.1.0-incubating.jar $HIVE_HOME/lib/htrace-core-3.1.0-incubating.jarln -s $HBASE_HOME/lib/hbase-hadoop2-compat-1.3.1.jar $HIVE_HOME/lib/hbase-hadoop2-compat-1.3.1.jarln -s $HBASE_HOME/lib/hbase-hadoop-compat-1.3.1.jar $HIVE_HOME/lib/hbase-hadoop-compat-1.3.1.jar 1234567891011121314&lt;!-- ä¿®æ”¹ hive-site.xml --&gt;&lt;property&gt; &lt;name&gt;hive.zookeeper.quorum&lt;/name&gt; &lt;value&gt;hadoop102,hadoop103,hadoop104&lt;/value&gt; &lt;description&gt;The list of ZooKeeper servers to talk to. This is only needed for read/write locks.&lt;/description&gt;&lt;/property&gt;&lt;property&gt; &lt;name&gt;hive.zookeeper.client.port&lt;/name&gt; &lt;value&gt;2181&lt;/value&gt; &lt;description&gt;The port of ZooKeeper servers to talk to. This is only needed for read/write locks.&lt;/description&gt;&lt;/property&gt; 1234567891011121314151617181920212223242526272829303132333435# åœ¨ Hive ä¸­åˆ›å»ºè¡¨åŒæ—¶å…³è” HBaseCREATE TABLE hive_hbase_emp_table( empno int, ename string, job string, mgr int, hiredate string, sal double, comm double, deptno int)STORED BY 'org.apache.hadoop.hive.hbase.HBaseStorageHandler'WITH SERDEPROPERTIES (\"hbase.columns.mapping\" = \":key, info:ename, info:job, info:mgr,i nfo:hiredate,i nfo:sal, info:comm, info:deptno\")TBLPROPERTIES (\"hbase.table.name\" = \"hbase_emp_table\");# å®Œæˆä¹‹åï¼Œå¯ä»¥åˆ†åˆ«è¿›å…¥ Hive å’Œ HBase æŸ¥çœ‹ï¼Œéƒ½ç”Ÿæˆäº†å¯¹åº”çš„è¡¨# ä¸èƒ½å°†æ•°æ®ç›´æ¥ load è¿› Hive æ‰€å…³è” HBase çš„é‚£å¼ è¡¨ä¸­CREATE TABLE emp( empno int, ename string, job string, mgr int, hiredate string, sal double, comm double, deptno int)row format delimited fields terminated by '\\t';# å‘ Hive ä¸­é—´è¡¨ä¸­ load æ•°æ®load data local inpath '/home/admin/softwares/data/emp.txt' into table emp;# é€šè¿‡ insert å‘½ä»¤å°†ä¸­é—´è¡¨ä¸­çš„æ•°æ®å¯¼å…¥åˆ° Hive å…³è” Hbase çš„é‚£å¼ è¡¨ä¸­insert into table hive_hbase_emp_table select * from emp;# æŸ¥çœ‹ Hive ä»¥åŠå…³è”çš„ HBase è¡¨ä¸­æ˜¯å¦å·²ç»æˆåŠŸçš„åŒæ­¥æ’å…¥äº†æ•°æ®select * from hive_hbase_emp_table;scan â€˜hbase_emp_tableâ€™ åœ¨ HBase ä¸­å·²ç»å­˜å‚¨äº†æŸä¸€å¼ è¡¨ hbase_emp_tableï¼Œç„¶ååœ¨ Hive ä¸­åˆ›å»ºä¸€ä¸ªå¤–éƒ¨è¡¨æ¥å…³è” HBase ä¸­çš„ hbase_emp_table è¿™å¼ è¡¨ï¼Œä½¿ä¹‹å¯ä»¥å€ŸåŠ© Hive æ¥åˆ†æ HBase è¿™å¼ è¡¨ä¸­çš„æ•°æ®ã€‚ 12345678910111213141516CREATE EXTERNAL TABLE relevance_hbase_emp( empno int, ename string, job string, mgr int, hiredate string, sal double, comm double, deptno int)STORED BY 'org.apache.hadoop.hive.hbase.HBaseStorageHandler'WITH SERDEPROPERTIES (\"hbase.columns.mapping\" =\":key, info:ename, info:job, info:mgr, info:hiredate, info:sal, info:comm, info:deptno\")TBLPROPERTIES (\"hbase.table.name\" = \"hbase_emp_table\");# å…³è”åå°±å¯ä»¥ä½¿ç”¨ Hive å‡½æ•°è¿›è¡Œä¸€äº›åˆ†ææ“ä½œäº† select * from relevance_hbase_emp; ä¼˜åŒ–é«˜å¯ç”¨åœ¨ HBase ä¸­ HMaster è´Ÿè´£ç›‘æ§ HRegionServer çš„ç”Ÿå‘½å‘¨æœŸï¼Œå‡è¡¡ RegionServer çš„è´Ÿè½½ï¼Œ å¦‚æœ HMaster æŒ‚æ‰äº†ï¼Œé‚£ä¹ˆæ•´ä¸ª HBase é›†ç¾¤å°†é™·å…¥ä¸å¥åº·çš„çŠ¶æ€ï¼Œå¹¶ä¸”æ­¤æ—¶çš„å·¥ä½œçŠ¶æ€å¹¶ ä¸ä¼šç»´æŒå¤ªä¹…ã€‚æ‰€ä»¥ HBase æ”¯æŒå¯¹ HMaster çš„é«˜å¯ç”¨é…ç½®ã€‚ 123456789# å…³é—­ HBase é›†ç¾¤ bin/stop-hbase.sh# åœ¨ conf ç›®å½•ä¸‹åˆ›å»º backup-masters æ–‡ä»¶touch conf/backup-masters# åœ¨ backup-masters æ–‡ä»¶ä¸­é…ç½®é«˜å¯ç”¨ HMaster èŠ‚ç‚¹echo hadoop103 &gt; conf/backup-master# å°†æ•´ä¸ª conf ç›®å½• scp åˆ°å…¶ä»–èŠ‚ç‚¹scp -r conf/ hadoop103:/opt/module/hbase/scp -r conf/ hadoop104:/opt/module/hbase/ é¢„åˆ†åŒºæ¯ä¸€ä¸ª region ç»´æŠ¤ç€ StartRow ä¸ EndRowï¼Œå¦‚æœåŠ å…¥çš„æ•°æ®ç¬¦åˆæŸä¸ª Region ç»´æŠ¤çš„ RowKey èŒƒå›´ï¼Œåˆ™è¯¥æ•°æ®äº¤ç»™è¿™ä¸ª Region ç»´æŠ¤ã€‚é‚£ä¹ˆä¾ç…§è¿™ä¸ªåŸåˆ™ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ•°æ®æ‰€è¦æŠ•æ”¾çš„åˆ†åŒºæå‰å¤§è‡´çš„è§„åˆ’å¥½ï¼Œä»¥æé«˜ HBase æ€§èƒ½ã€‚ 123456# æ‰‹åŠ¨è®¾å®šé¢„åˆ†åŒºcreate 'staff1','info','partition1',SPLITS =&gt; ['1000','2000','3000','4000']# ç”Ÿæˆ 16 è¿›åˆ¶åºåˆ—é¢„åˆ†åŒºcreate 'staff2','info','partition2',&#123;NUMREGIONS =&gt; 15, SPLITALGO =&gt; 'HexStringSplit'&#125;# æŒ‰ç…§æ–‡ä»¶ä¸­è®¾ç½®çš„è§„åˆ™é¢„åˆ†åŒºcreate 'staff3','partition3',SPLITS_FILE =&gt; 'splits.txt' 123456789// Java API// è‡ªå®šä¹‰ç®—æ³•ï¼Œäº§ç”Ÿä¸€ç³»åˆ— hash æ•£åˆ—å€¼å­˜å‚¨åœ¨äºŒç»´æ•°ç»„ä¸­byte[][] splitKeys = æŸä¸ªæ•£åˆ—å€¼å‡½æ•°// åˆ›å»º HbaseAdmin å®ä¾‹HBaseAdmin hAdmin = new HBaseAdmin(HbaseConfiguration.create());// åˆ›å»º HTableDescriptor å®ä¾‹HTableDescriptor tableDesc = new HTableDescriptor(tableName);// é€šè¿‡ HTableDescriptor å®ä¾‹å’Œæ•£åˆ—å€¼äºŒç»´æ•°ç»„åˆ›å»ºå¸¦æœ‰é¢„åˆ†åŒºçš„ Hbase è¡¨hAdmin.createTable(tableDesc, splitKeys); RowKeyä¸€æ¡æ•°æ®çš„å”¯ä¸€æ ‡è¯†å°±æ˜¯ RowKeyï¼Œé‚£ä¹ˆè¿™æ¡æ•°æ®å­˜å‚¨äºå“ªä¸ªåˆ†åŒºï¼Œå–å†³äº RowKey å¤„äºå“ªä¸ªä¸€ä¸ªé¢„åˆ†åŒºçš„åŒºé—´å†…ï¼Œè®¾è®¡ RowKey çš„ä¸»è¦ç›®çš„ ï¼Œå°±æ˜¯è®©æ•°æ®å‡åŒ€çš„åˆ†å¸ƒäºæ‰€æœ‰çš„ region ä¸­ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šé˜²æ­¢æ•°æ®å€¾æ–œã€‚ HASHï¼Œåœ¨åšæ­¤æ“ä½œä¹‹å‰ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¼šé€‰æ‹©ä»æ•°æ®é›†ä¸­æŠ½å–æ ·æœ¬ï¼Œæ¥å†³å®šä»€ä¹ˆæ ·çš„ rowKey æ¥ Hash åä½œä¸ºæ¯ä¸ªåˆ†åŒºçš„ä¸´ç•Œå€¼ã€‚ å†…å­˜ä¼˜åŒ–HBase æ“ä½œè¿‡ç¨‹ä¸­éœ€è¦å¤§é‡çš„å†…å­˜å¼€é”€ï¼Œæ¯•ç«Ÿ Table æ˜¯å¯ä»¥ç¼“å­˜åœ¨å†…å­˜ä¸­çš„ï¼Œä¸€èˆ¬ä¼šåˆ†é…æ•´ä¸ªå¯ç”¨å†…å­˜çš„ 70%ç»™ HBase çš„ Java å †ã€‚ä½†æ˜¯ä¸å»ºè®®åˆ†é…éå¸¸å¤§çš„å †å†…å­˜ï¼Œå› ä¸º GC ç¨‹æŒç»­å¤ªä¹…ä¼šå¯¼è‡´ RegionServer å¤„äºé•¿æœŸä¸å¯ç”¨çŠ¶æ€ï¼Œä¸€èˆ¬ 16~48G å†…å­˜å°±å¯ä»¥äº†ï¼Œå¦‚æœå› ä¸ºæ¡†æ¶å ç”¨å†…å­˜è¿‡é«˜å¯¼è‡´ç³»ç»Ÿå†…å­˜ä¸è¶³ï¼Œæ¡†æ¶ä¸€æ ·ä¼šè¢«ç³»ç»ŸæœåŠ¡æ‹–æ­»ã€‚ å±æ€§ï¼šdfs.support.appendè§£é‡Šï¼šå¼€å¯ HDFS è¿½åŠ åŒæ­¥ï¼Œå¯ä»¥ä¼˜ç§€çš„é…åˆ HBase çš„æ•°æ®åŒæ­¥å’ŒæŒä¹…åŒ–ã€‚é»˜è®¤å€¼ä¸º trueã€‚ å±æ€§ï¼šdfs.datanode.max.transfer.threadsè§£é‡Šï¼šHBase ä¸€èˆ¬éƒ½ä¼šåŒä¸€æ—¶é—´æ“ä½œå¤§é‡çš„æ–‡ä»¶ï¼Œæ ¹æ®é›†ç¾¤çš„æ•°é‡å’Œè§„æ¨¡ä»¥åŠæ•°æ®åŠ¨ä½œï¼Œ è®¾ç½®ä¸º 4096 æˆ–è€…æ›´é«˜ã€‚é»˜è®¤å€¼ï¼š4096 å±æ€§ï¼šdfs.image.transfer.timeoutè§£é‡Šï¼šå¦‚æœå¯¹äºæŸä¸€æ¬¡æ•°æ®æ“ä½œæ¥è®²ï¼Œå»¶è¿Ÿéå¸¸é«˜ï¼Œsocket éœ€è¦ç­‰å¾…æ›´é•¿çš„æ—¶é—´ï¼Œå»ºè®®æŠŠè¯¥å€¼è®¾ç½®ä¸ºæ›´å¤§çš„å€¼ï¼ˆé»˜è®¤ 60000 æ¯«ç§’ï¼‰ï¼Œä»¥ç¡®ä¿ socket ä¸ä¼šè¢« timeout æ‰ã€‚ å±æ€§ï¼šmapreduce.map.output.compress mapreduce.map.output.compress.codecè§£é‡Šï¼šå¼€å¯è¿™ä¸¤ä¸ªæ•°æ®å¯ä»¥å¤§å¤§æé«˜æ–‡ä»¶çš„å†™å…¥æ•ˆç‡ï¼Œå‡å°‘å†™å…¥æ—¶é—´ã€‚ç¬¬ä¸€ä¸ªå±æ€§å€¼ä¿®æ”¹ä¸º trueï¼Œç¬¬äºŒä¸ªå±æ€§å€¼ä¿®æ”¹ä¸ºï¼šorg.apache.hadoop.io.compress.GzipCodec æˆ–è€…å…¶ä»–å‹ç¼©æ–¹å¼ã€‚ å±æ€§ï¼šHbase.regionserver.handler.countè§£é‡Šï¼šé»˜è®¤å€¼ä¸º 30ï¼Œç”¨äºæŒ‡å®š RPC ç›‘å¬çš„æ•°é‡ï¼Œå¯ä»¥æ ¹æ®å®¢æˆ·ç«¯çš„è¯·æ±‚æ•°è¿›è¡Œè°ƒæ•´ï¼Œè¯»å†™è¯·æ±‚è¾ƒå¤šæ—¶ï¼Œå¢åŠ æ­¤å€¼ã€‚ å±æ€§ï¼šhbase.hregion.max.filesizeè§£é‡Šï¼šé»˜è®¤å€¼ 10737418240ï¼ˆ10GBï¼‰ï¼Œå¦‚æœéœ€è¦è¿è¡Œ HBase çš„ MR ä»»åŠ¡ï¼Œå¯ä»¥å‡å°æ­¤å€¼ï¼Œ å› ä¸ºä¸€ä¸ª region å¯¹åº”ä¸€ä¸ª map ä»»åŠ¡ï¼Œå¦‚æœå•ä¸ª region è¿‡å¤§ï¼Œä¼šå¯¼è‡´ map ä»»åŠ¡æ‰§è¡Œæ—¶é—´è¿‡é•¿ã€‚è¯¥å€¼çš„æ„æ€å°±æ˜¯ï¼Œå¦‚æœ HFile çš„å¤§å°è¾¾åˆ°è¿™ä¸ªæ•°å€¼ï¼Œåˆ™è¿™ä¸ª region ä¼šè¢«åˆ‡åˆ†ä¸ºä¸¤ä¸ª Hfileã€‚ å±æ€§ï¼šhbase.client.write.bufferè§£é‡Šï¼šç”¨äºæŒ‡å®š Hbase å®¢æˆ·ç«¯ç¼“å­˜ï¼Œå¢å¤§è¯¥å€¼å¯ä»¥å‡å°‘ RPC è°ƒç”¨æ¬¡æ•°ï¼Œä½†æ˜¯ä¼šæ¶ˆè€—æ›´å¤šå†…å­˜ï¼Œåä¹‹åˆ™åä¹‹ã€‚ä¸€èˆ¬æˆ‘ä»¬éœ€è¦è®¾å®šä¸€å®šçš„ç¼“å­˜å¤§å°ï¼Œä»¥è¾¾åˆ°å‡å°‘ RPC æ¬¡æ•°çš„ç›®çš„ã€‚ å±æ€§ï¼šhbase.client.scanner.cachingè§£é‡Šï¼šç”¨äºæŒ‡å®š scan.next æ–¹æ³•è·å–çš„é»˜è®¤è¡Œæ•°ï¼Œå€¼è¶Šå¤§ï¼Œæ¶ˆè€—å†…å­˜è¶Šå¤§ã€‚ flushã€compactã€split æœºåˆ¶ å½“ MemStore è¾¾åˆ°é˜ˆå€¼ï¼Œå°† Memstore ä¸­çš„æ•°æ® Flush è¿› Storefileï¼›compact æœºåˆ¶åˆ™æ˜¯æŠŠ flush å‡ºæ¥çš„å°æ–‡ä»¶åˆå¹¶æˆå¤§çš„ Storefile æ–‡ä»¶ã€‚split åˆ™æ˜¯å½“ Region è¾¾åˆ°é˜ˆå€¼ï¼Œä¼šæŠŠè¿‡å¤§çš„ Region ä¸€åˆ†ä¸ºäºŒã€‚ hbase.hregion.memstore.flush.sizeï¼š134217728 è¿™ä¸ªå‚æ•°çš„ä½œç”¨æ˜¯å½“å•ä¸ª HRegion å†…æ‰€æœ‰çš„ Memstore å¤§å°æ€»å’Œè¶…è¿‡æŒ‡å®šå€¼æ—¶ï¼Œflush è¯¥ HRegion çš„æ‰€æœ‰ memstoreã€‚RegionServer çš„ flush æ˜¯é€šè¿‡å°†è¯·æ±‚æ·»åŠ ä¸€ä¸ªé˜Ÿåˆ—ï¼Œæ¨¡æ‹Ÿç”Ÿ äº§æ¶ˆè´¹æ¨¡å‹æ¥å¼‚æ­¥å¤„ç†çš„ã€‚é‚£è¿™é‡Œå°±æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå½“é˜Ÿåˆ—æ¥ä¸åŠæ¶ˆè´¹ï¼Œäº§ç”Ÿå¤§é‡ç§¯å‹è¯·æ±‚ æ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´å†…å­˜é™¡å¢ï¼Œæœ€åçš„æƒ…å†µæ˜¯è§¦å‘ OOM hbase.regionserver.global.memstore.upperLimitï¼š0.4hbase.regionserver.global.memstore.lowerLimitï¼š0.38å½“ MemStore ä½¿ç”¨å†…å­˜æ€»é‡è¾¾åˆ°hbase.regionserver.global.memstore.upperLimit æŒ‡å®šå€¼æ—¶ï¼Œå°†ä¼šæœ‰å¤šä¸ª MemStores flush åˆ°æ–‡ä»¶ä¸­ï¼ŒMemStore flush é¡ºåºæ˜¯æŒ‰ç…§å¤§å°é™åºæ‰§è¡Œçš„ï¼Œç›´åˆ°åˆ·æ–°åˆ° MemStore ä½¿ç”¨å†…å­˜ç•¥å°äº lowerLimit é¡¹ç›®å®æˆ˜ å¾®åšå†…å®¹çš„æµè§ˆï¼Œæ•°æ®åº“è¡¨è®¾è®¡ï¼›ç”¨æˆ·ç¤¾äº¤ä½“ç°ï¼šå…³æ³¨ç”¨æˆ·ï¼Œå–å…³ç”¨æˆ·ï¼›æ‹‰å–å…³æ³¨çš„äººçš„å¾®åšå†…å®¹ã€‚ è¡¨çš„åˆ›å»º 123456789101112131415161718192021222324252627282930313233343536373839// åˆ›å»ºå‘½åç©ºé—´ä»¥åŠè¡¨åçš„å®šä¹‰// è·å–é…ç½® confprivate Configuration conf = HbaseConfiguration.create();// å¾®åšå†…å®¹è¡¨çš„è¡¨åprivate static final byte[] TABLE_CONTENT = Bytes.toBytes(\"weibo:content\");// ç”¨æˆ·å…³ç³»è¡¨çš„è¡¨åprivate static final byte[] TABLE_RELATIONS = Bytes.toBytes(\"weibo:relations\");// å¾®åšæ”¶ä»¶ç®±è¡¨çš„è¡¨åprivate static final byte[] TABLE_RECEIVE_CONTENT_EMAIL = Bytes.toBytes(\"weibo:receive_content_email\");public void initNamespace()&#123; HbaseAdmin admin = null; try &#123; admin = new HbaseAdmin(conf); // å‘½åç©ºé—´ç±»ä¼¼äºå…³ç³»å‹æ•°æ®åº“ä¸­çš„ schemaï¼Œå¯ä»¥æƒ³è±¡æˆæ–‡ä»¶å¤¹ NamespaceDescriptor weibo = NamespaceDescriptor .create(\"weibo\") .addConfiguration(\"creator\", \"wingo\") .addConfiguration(\"create_time\", System.currentTimeMillis() + \"\") .build(); admin.createNamespace(weibo); &#125; catch (MasterNotRunningException e) &#123; e.printStackTrace(); &#125; catch (ZooKeeperConnectionException e) &#123; e.printStackTrace(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125;finally&#123; if(null != admin)&#123; try &#123; admin.close(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; &#125;&#125; åˆ›å»ºå¾®åšå†…å®¹è¡¨ 12345678910111213141516171819202122232425262728293031323334353637383940414243/** è¡¨ç»“æ„Table Name weibo:contentRowKey ç”¨æˆ· ID_æ—¶é—´æˆ³ColumnFamily infoColumnLabel å†…å®¹Version 1 ä¸ªç‰ˆæœ¬*/public void createTableContent()&#123; HbaseAdmin admin = null; try &#123; admin = new HbaseAdmin(conf); // åˆ›å»ºè¡¨è¡¨è¿° HTableDescriptor content = new HTableDescriptor(TableName.valueOf(TABLE_CONTENT)); // åˆ›å»ºåˆ—æ—æè¿° HColumnDescriptor info = new HColumnDescriptor(Bytes.toBytes(\"info\")); // è®¾ç½®å—ç¼“å­˜ info.setBlockCacheEnabled(true); // è®¾ç½®å—ç¼“å­˜å¤§å° info.setBlocksize(2097152); // è®¾ç½®å‹ç¼©æ–¹å¼ // info.setCompressionType(Algorithm.SNAPPY); // è®¾ç½®ç‰ˆæœ¬æ•°é‡ info.setMaxVersions(1); info.setMinVersions(1); content.addFamily(info); admin.createTable(content); &#125; catch (MasterNotRunningException e) &#123; e.printStackTrace(); &#125; catch (ZooKeeperConnectionException e) &#123; e.printStackTrace(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125;finally&#123; if(null != admin)&#123; try &#123; admin.close(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; &#125;&#125; åˆ›å»ºç”¨æˆ·å…³ç³»è¡¨ 12345678910111213141516171819202122232425262728293031323334353637383940414243/** è¡¨ç»“æ„Table Name weibo:relationsRowKey ç”¨æˆ· IDColumnFamily attendsã€fansColumnLabel å…³æ³¨ç”¨æˆ· IDï¼Œç²‰ä¸ç”¨æˆ· IDColumnValue ç”¨æˆ· IDVersion 1 ä¸ªç‰ˆæœ¬*/public void createTableRelations()&#123; HbaseAdmin admin = null; try &#123; admin = new HbaseAdmin(conf); HTableDescriptor relations = new HTableDescriptor(TableName.valueOf(TABLE_RELATIONS)); HColumnDescriptor attends = new HColumnDescriptor(Bytes.toBytes(\"attends\")); attends.setBlockCacheEnabled(true); attends.setBlocksize(2097152); attends.setMaxVersions(1); attends.setMinVersions(1); HColumnDescriptor fans = new HColumnDescriptor(Bytes.toBytes(\"fans\")); fans.setBlockCacheEnabled(true); fans.setBlocksize(2097152); fans.setMaxVersions(1); fans.setMinVersions(1); relations.addFamily(attends); relations.addFamily(fans); admin.createTable(relations); &#125; catch (MasterNotRunningException e) &#123; e.printStackTrace(); &#125; catch (ZooKeeperConnectionException e) &#123; e.printStackTrace(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125;finally&#123; if(null != admin)&#123; try &#123; admin.close(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; &#125;&#125; åˆ›å»ºå¾®åšæ”¶ä»¶ç®±è¡¨ 1234567891011121314151617181920212223242526272829303132333435363738/** è¡¨ç»“æ„Table Name weibo:receive_content_emailRowKey ç”¨æˆ· IDColumnFamily infoColumnLabel ç”¨æˆ· IDColumnValue å–å¾®åšå†…å®¹çš„ RowKeyVersion 1000*/public void createTableReceiveContentEmail()&#123; HbaseAdmin admin = null; try &#123; admin = new HbaseAdmin(conf); HTableDescriptor receive_content_email = new HTableDescriptor(TableName.valueOf(TABLE_RECEIVE_CONTENT_EMAIL)); HColumnDescriptor info = new HColumnDescriptor(Bytes.toBytes(\"info\")); info.setBlockCacheEnabled(true); info.setBlocksize(2097152); info.setMaxVersions(1000); info.setMinVersions(1000); receive_content_email.addFamily(info);; admin.createTable(receive_content_email); &#125; catch (MasterNotRunningException e) &#123; e.printStackTrace(); &#125; catch (ZooKeeperConnectionException e) &#123; e.printStackTrace(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125;finally&#123; if(null != admin)&#123; try &#123; admin.close(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; &#125;&#125; åŠŸèƒ½å®ç°12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182/**å¾®åšå†…å®¹è¡¨ä¸­æ·»åŠ  1 æ¡æ•°æ®å¾®åšæ”¶ä»¶ç®±è¡¨å¯¹æ‰€æœ‰ç²‰ä¸ç”¨æˆ·æ·»åŠ æ•°æ®ï¼šå¾®åšå†…å®¹çš„ RowKey*/public class Message &#123; private String uid; private String timestamp; private String content; public String getUid() &#123; return uid; &#125; public void setUid(String uid) &#123; this.uid = uid; &#125; public String getTimestamp() &#123; return timestamp; &#125; public void setTimestamp(String timestamp) &#123; this.timestamp = timestamp; &#125; public String getContent() &#123; return content; &#125; public void setContent(String content) &#123; this.content = content; &#125; @Override public String toString() &#123; return \"Message [uid=\" + uid + \", timestamp=\" + timestamp + \", content=\" + content + \"]\"; &#125;&#125;public void publishContent(String uid, String content)&#123; HConnection connection = null; try &#123; connection = HConnectionManager.createConnection(conf); // å¾®åšå†…å®¹è¡¨ä¸­æ·»åŠ  1 æ¡æ•°æ®ï¼Œé¦–å…ˆè·å–å¾®åšå†…å®¹è¡¨æè¿° HTableInterface contentTBL = connection.getTable(TableName.valueOf(TABLE_CONTENT)); // ç»„è£… Rowkey long timestamp = System.currentTimeMillis(); String rowKey = uid + \"_\" + timestamp; Put put = new Put(Bytes.toBytes(rowKey)); put.add(Bytes.toBytes(\"info\"), Bytes.toBytes(\"content\"), timestamp, Bytes.toBytes(content)); contentTBL.put(put); // å‘å¾®åšæ”¶ä»¶ç®±è¡¨ä¸­åŠ å…¥å‘å¸ƒçš„ Rowkey // æŸ¥è¯¢ç”¨æˆ·å…³ç³»è¡¨ï¼Œå¾—åˆ°å½“å‰ç”¨æˆ·æœ‰å“ªäº›ç²‰ä¸ HTableInterface relationsTBL = connection.getTable(TableName.valueOf(TABLE_RELATIONS)); // å–å‡ºç›®æ ‡æ•°æ® Get get = new Get(Bytes.toBytes(uid)); // æŒ‡å®šå–å‡ºçš„ç›®æ ‡æ•°æ®çš„å€¼ get.addFamily(Bytes.toBytes(\"fans\")); Result result = relationsTBL.get(get); // åˆå§‹åŒ–ä¸€ä¸ªäºŒè¿›åˆ¶æ•°ç»„ç”¨äºå­˜æ”¾æ•°æ® List&lt;byte[]&gt; fans = new ArrayList&lt;byte[]&gt;(); // éå†å–å‡ºå½“å‰å‘å¸ƒå¾®åšçš„ç”¨æˆ·çš„æ‰€æœ‰ç²‰ä¸æ•°æ® for(Cell cell : result.rawCells())&#123; fans.add(CellUtil.cloneQualifier(cell)); &#125; // å¦‚æœè¯¥ç”¨æˆ·æ²¡æœ‰ç²‰ä¸ï¼Œåˆ™ç›´æ¥ return if(fans.size() &lt;= 0) return; // å¼€å§‹æ“ä½œæ”¶ä»¶ç®±è¡¨ HTableInterface recTBL = connection.getTable(TableName.valueOf(TABLE_RECEIVE_CONTENT_EMAIL)); List&lt;Put&gt; puts = new ArrayList&lt;Put&gt;(); for(byte[] fan : fans)&#123; Put fanPut = new Put(fan); fanPut.add(Bytes.toBytes(\"info\"), Bytes.toBytes(uid), timestamp, Bytes.toBytes(rowKey)); puts.add(fanPut); &#125; recTBL.put(puts); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125;finally&#123; if(null != connection)&#123; try &#123; connection.close(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; &#125;&#125; æ·»åŠ å…³æ³¨ç”¨æˆ· 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485/**åœ¨å¾®åšç”¨æˆ·å…³ç³»è¡¨ä¸­ï¼Œå¯¹å½“å‰ä¸»åŠ¨æ“ä½œçš„ç”¨æˆ·æ·»åŠ æ–°å…³æ³¨çš„å¥½å‹åœ¨å¾®åšç”¨æˆ·å…³ç³»è¡¨ä¸­ï¼Œå¯¹è¢«å…³æ³¨çš„ç”¨æˆ·æ·»åŠ æ–°çš„ç²‰ä¸å¾®åšæ”¶ä»¶ç®±è¡¨ä¸­æ·»åŠ æ‰€å…³æ³¨çš„ç”¨æˆ·å‘å¸ƒçš„å¾®åš*/public void addAttends(String uid, String... attends)&#123; // å‚æ•°è¿‡æ»¤ if(attends == null || attends.length &lt;= 0 || uid == null || uid.length() &lt;= 0)&#123; return; &#125; HConnection connection = null; try &#123; connection = HConnectionManager.createConnection(conf); // ç”¨æˆ·å…³ç³»è¡¨æ“ä½œå¯¹è±¡ï¼ˆè¿æ¥åˆ°ç”¨æˆ·å…³ç³»è¡¨ï¼‰ HTableInterface relationsTBL = connection.getTable(TableName.valueOf(TABLE_RELATIONS)); List&lt;Put&gt; puts = new ArrayList&lt;Put&gt;(); // åœ¨å¾®åšç”¨æˆ·å…³ç³»è¡¨ä¸­ï¼Œæ·»åŠ æ–°å…³æ³¨çš„å¥½å‹ Put attendPut = new Put(Bytes.toBytes(uid)); for(String attend : attends)&#123; // ä¸ºå½“å‰ç”¨æˆ·æ·»åŠ å…³æ³¨çš„äºº attendPut.add(Bytes.toBytes(\"attends\"), Bytes.toBytes(attend), Bytes.toBytes(attend)); // ä¸ºè¢«å…³æ³¨çš„äººï¼Œæ·»åŠ ç²‰ä¸ Put fansPut = new Put(Bytes.toBytes(attend)); fansPut.add(Bytes.toBytes(\"fans\"), Bytes.toBytes(uid), Bytes.toBytes(uid)); // å°†æ‰€æœ‰å…³æ³¨çš„äººä¸€ä¸ªä¸€ä¸ªçš„æ·»åŠ åˆ° putsï¼ˆListï¼‰é›†åˆä¸­ puts.add(fansPut); &#125; puts.add(attendPut); relationsTBL.put(puts); // å¾®åšæ”¶ä»¶ç®±æ·»åŠ å…³æ³¨çš„ç”¨æˆ·å‘å¸ƒçš„å¾®åšå†…å®¹ï¼ˆcontentï¼‰çš„ rowkey HTableInterface contentTBL = connection.getTable(TableName.valueOf(TABLE_CONTENT)); Scan scan = new Scan(); // ç”¨äºå­˜æ”¾å–å‡ºæ¥çš„å…³æ³¨çš„äººæ‰€å‘å¸ƒçš„å¾®åšçš„ rowkey List&lt;byte[]&gt; rowkeys = new ArrayList&lt;byte[]&gt;(); for(String attend : attends)&#123; // è¿‡æ»¤æ‰«æ rowkeyï¼Œå³ï¼šå‰ç½®ä½åŒ¹é…è¢«å…³æ³¨çš„äººçš„ uid_ RowFilter filter = new RowFilter (CompareFilter.CompareOp.EQUAL, new SubstringComparator(attend + \"_\")); // ä¸ºæ‰«æå¯¹è±¡æŒ‡å®šè¿‡æ»¤è§„åˆ™ scan.setFilter(filter); // é€šè¿‡æ‰«æå¯¹è±¡å¾—åˆ° scanner ResultScanner result = contentTBL.getScanner(scan); // è¿­ä»£å™¨éå†æ‰«æå‡ºæ¥çš„ç»“æœé›† Iterator&lt;Result&gt; iterator = result.iterator(); while(iterator.hasNext())&#123; // å–å‡ºæ¯ä¸€ä¸ªç¬¦åˆæ‰«æç»“æœçš„é‚£ä¸€è¡Œæ•°æ® Result r = iterator.next(); for(Cell cell : r.rawCells())&#123; // å°†å¾—åˆ°çš„ rowkey æ”¾ç½®äºé›†åˆå®¹å™¨ä¸­ rowkeys.add(CellUtil.cloneRow(cell)); &#125; &#125; &#125; // å°†å–å‡ºçš„å¾®åš rowkey æ”¾ç½®äºå½“å‰æ“ä½œç”¨æˆ·çš„æ”¶ä»¶ç®±ä¸­ if(rowkeys.size() &lt;= 0) return; // å¾—åˆ°å¾®åšæ”¶ä»¶ç®±è¡¨çš„æ“ä½œå¯¹è±¡ HTableInterface recTBL =connection.getTable(TableName.valueOf(TABLE_RECEIVE_CONTENT_EMAIL)); // ç”¨äºå­˜æ”¾å¤šä¸ªå…³æ³¨çš„ç”¨æˆ·çš„å‘å¸ƒçš„å¤šæ¡å¾®åš rowkey ä¿¡æ¯ List&lt;Put&gt; recPuts = new ArrayList&lt;Put&gt;(); for(byte[] rk : rowkeys)&#123; Put put = new Put(Bytes.toBytes(uid)); // uid_timestamp String rowKey = Bytes.toString(rk); // æˆªå– uid String attendUID = rowKey.substring(0, rowKey.indexOf(\"_\")); long timestamp = Long.parseLong(rowKey.substring(rowKey.indexOf(\"_\") + 1)); // å°†å¾®åš rowkey æ·»åŠ åˆ°æŒ‡å®šå•å…ƒæ ¼ä¸­ put.add(Bytes.toBytes(\"info\"), Bytes.toBytes(attendUID), timestamp, rk); recPuts.add(put); &#125; recTBL.put(recPuts); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125;finally&#123; if(null != connection)&#123; try &#123; connection.close(); &#125; catch (IOException e) &#123; // TODO Auto-generated catch block e.printStackTrace(); &#125; &#125; &#125;&#125; å–å…³ç”¨æˆ· 12345678910111213141516171819202122232425262728293031323334// å³å…³æ³¨ç”¨æˆ·çš„åå‘æ“ä½œpublic void removeAttends(String uid, String... attends)&#123; // è¿‡æ»¤æ•°æ® if(uid == null || uid.length() &lt;= 0 || attends == null || attends.length &lt;= 0) return; HConnection connection = null; try &#123; connection = HConnectionManager.createConnection(conf); // åœ¨å¾®åšç”¨æˆ·å…³ç³»è¡¨ä¸­ï¼Œåˆ é™¤å·²å…³æ³¨çš„å¥½å‹ HTableInterface relationsTBL = connection.getTable(TableName.valueOf(TABLE_RELATIONS)); // å¾…åˆ é™¤çš„ç”¨æˆ·å…³ç³»è¡¨ä¸­çš„æ‰€æœ‰æ•°æ® List&lt;Delete&gt; deletes = new ArrayList&lt;Delete&gt;(); // å½“å‰å–å…³æ“ä½œè€…çš„ uid å¯¹åº”çš„ Delete å¯¹è±¡ Delete attendDelete = new Delete(Bytes.toBytes(uid)); // éå†å–å…³ï¼ŒåŒæ—¶æ¯æ¬¡å–å…³éƒ½è¦å°†è¢«å–å…³çš„äººçš„ç²‰ä¸ -1 for(String attend : attends)&#123; attendDelete.deleteColumn(Bytes.toBytes(\"attends\"), Bytes.toBytes(attend)); Delete fansDelete = new Delete(Bytes.toBytes(attend)); fansDelete.deleteColumn(Bytes.toBytes(\"fans\"), Bytes.toBytes(uid)); deletes.add(fansDelete); &#125; deletes.add(attendDelete); relationsTBL.delete(deletes); // æ”¶ä»¶ç®±è¡¨ä¸­åˆ é™¤å–å…³çš„äººçš„å¾®åš rowkey HTableInterface recTBL = connection.getTable(TableName.valueOf(TABLE_RECEIVE_CONTENT_EMAIL)); Delete recDelete = new Delete(Bytes.toBytes(uid)); for(String attend : attends)&#123; recDelete.deleteColumn(Bytes.toBytes(\"info\"), Bytes.toBytes(attend)); &#125; recTBL.delete(recDelete); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125;&#125; è·å–å…³æ³¨çš„äººçš„å¾®åšå†…å®¹ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152// å³é€šè¿‡å¾®åšæ”¶ä»¶ç®±ä¸­çš„ RowKey è·å–å¯¹åº”çš„å¾®åšå†…å®¹public List&lt;Message&gt; getAttendsContent(String uid)&#123; HConnection connection = null; try &#123; connection = HConnectionManager.createConnection(conf); HTableInterface recTBL = connection.getTable(TableName.valueOf(TABLE_RECEIVE_CONTENT_EMAIL)); // ä»æ”¶ä»¶ç®±ä¸­å–å¾—å¾®åš rowKey Get get = new Get(Bytes.toBytes(uid)); // è®¾ç½®æœ€å¤§ç‰ˆæœ¬å· get.setMaxVersions(5); List&lt;byte[]&gt; rowkeys = new ArrayList&lt;byte[]&gt;(); Result result = recTBL.get(get); for(Cell cell : result.rawCells())&#123; rowkeys.add(CellUtil.cloneValue(cell)); &#125; // æ ¹æ®å–å‡ºçš„æ‰€æœ‰ rowkey å»å¾®åšå†…å®¹è¡¨ä¸­æ£€ç´¢æ•°æ® HTableInterface contentTBL = connection.getTable(TableName.valueOf(TABLE_CONTENT)); List&lt;Get&gt; gets = new ArrayList&lt;Get&gt;(); // æ ¹æ® rowkey å–å‡ºå¯¹åº”å¾®åšçš„å…·ä½“å†…å®¹ for(byte[] rk : rowkeys)&#123; Get g = new Get(rk); gets.add(g); &#125; // å¾—åˆ°æ‰€æœ‰çš„å¾®åšå†…å®¹çš„ result å¯¹è±¡ Result[] results = contentTBL.get(gets); List&lt;Message&gt; messages = new ArrayList&lt;Message&gt;(); for(Result res : results)&#123; for(Cell cell : res.rawCells())&#123; Message message = new Message(); String rowKey = Bytes.toString(CellUtil.cloneRow(cell)); String userid = rowKey.substring(0, rowKey.indexOf(\"_\")); String timestamp = rowKey.substring(rowKey.indexOf(\"_\") + 1); String content = Bytes.toString(CellUtil.cloneValue(cell)); message.setContent(content); message.setTimestamp(timestamp); message.setUid(userid); messages.add(message); &#125; &#125; return messages; &#125; catch (IOException e) &#123; e.printStackTrace(); &#125;finally&#123; try &#123; connection.close(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; return null;&#125;","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://yoursite.com/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"HBase","slug":"HBase","permalink":"http://yoursite.com/tags/HBase/"}]},{"title":"ç®—æ³•æ•´ç†","slug":"æŠ€æœ¯åŸç†/åå¤§æ’åºç®—æ³•ï¼ˆå†…éƒ¨æ’åºï¼‰","date":"2020-04-30T14:22:10.000Z","updated":"2020-07-10T02:56:24.973Z","comments":true,"path":"2020/04/30/æŠ€æœ¯åŸç†/åå¤§æ’åºç®—æ³•ï¼ˆå†…éƒ¨æ’åºï¼‰/","link":"","permalink":"http://yoursite.com/2020/04/30/%E6%8A%80%E6%9C%AF%E5%8E%9F%E7%90%86/%E5%8D%81%E5%A4%A7%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95%EF%BC%88%E5%86%85%E9%83%A8%E6%8E%92%E5%BA%8F%EF%BC%89/","excerpt":"ä¸€äº›å¸¸ç”¨çš„ç®—æ³•æ•´ç†ã€‚","text":"ä¸€äº›å¸¸ç”¨çš„ç®—æ³•æ•´ç†ã€‚ åå¤§æ’åºç®—æ³•æ’å…¥æ’åº - ç›´æ¥æ’å…¥æ’åºåŸºæœ¬æ€æƒ³ å°†ä¸€ä¸ªè®°å½•æ’å…¥åˆ°å·²æ’åºå¥½çš„æœ‰åºè¡¨ä¸­ï¼Œä»è€Œå¾—åˆ°ä¸€ä¸ªæ–°ï¼Œè®°å½•æ•°å¢1çš„æœ‰åºè¡¨ã€‚å³ï¼šå…ˆå°†åºåˆ—çš„ç¬¬1ä¸ªè®°å½•çœ‹æˆæ˜¯ä¸€ä¸ªæœ‰åºçš„å­åºåˆ—ï¼Œç„¶åä»ç¬¬2ä¸ªè®°å½•é€ä¸ªè¿›è¡Œæ’å…¥ï¼Œç›´è‡³æ•´ä¸ªåºåˆ—æœ‰åºä¸ºæ­¢ å¦‚æœç¢°è§ä¸€ä¸ªå’Œæ’å…¥å…ƒç´ ç›¸ç­‰çš„ï¼Œé‚£ä¹ˆæ’å…¥å…ƒç´ æŠŠæƒ³æ’å…¥çš„å…ƒç´ æ”¾åœ¨ç›¸ç­‰å…ƒç´ çš„åé¢ã€‚æ‰€ä»¥ï¼Œç›¸ç­‰å…ƒç´ çš„å‰åé¡ºåºæ²¡æœ‰æ”¹å˜ï¼Œä»åŸæ— åºåºåˆ—å‡ºå»çš„é¡ºåºå°±æ˜¯æ’å¥½åºåçš„é¡ºåºï¼Œæ‰€ä»¥æ’å…¥æ’åºæ˜¯ç¨³å®šçš„ æ—¶é—´å¤æ‚åº¦ï¼šO(n^2) æ’åºç¤ºä¾‹ åˆå§‹å…³é”®å­—ï¼Œæ­¤æ—¶æœ‰åºè¡¨åªæœ‰ä¸€ä¸ªæ•°å­— 49 (49) 38 65 97 76 12 27 49 å°† 38 æ’å…¥æœ‰åºè¡¨ä¸­è¿›è¡Œæ’ï¼Œæ­¤æ—¶æœ‰åºè¡¨åªæœ‰ä¸¤ä¸ªæ•°å­— (38 49) 65 97 76 12 27 49 å¾ªç¯æ­¤è¿‡ç¨‹ (38 49 65) 97 76 12 27 49 (38 49 65 97) 76 12 27 49 (38 49 65 76 97) 12 27 49 (12 38 49 65 76 97) 27 49 (12 27 38 49 65 76 97) 49 (12 27 38 49 49 65 76 97) ç®—æ³•å®ç°12345678910111213141516171819202122232425262728293031/** * æ’å…¥æ’åº * @param data è¦æ’åºçš„æ•°ç»„ * @param reverse ä»å¤§åˆ°å°(false)è¿˜æ˜¯ä»å°åˆ°å¤§(ture) */public static void sort(int[] data, boolean reverse) &#123; if (data.length == 1) &#123; return; //é•¿åº¦ä¸º 1 çš„æ•°ç»„å·²æœ‰åº &#125; int tmp = 0; //ä¸´æ—¶å­˜å‚¨å˜é‡ for (int i = 1; i &lt; data.length; i**) &#123; tmp = data[i]; int n = i - 1; for (; n &gt;= 0; n--) &#123; if (reverse) &#123; //ä»å°åˆ°å¤§æ’åº if (data[n] &gt;= tmp) &#123; data[n + 1] = data[n]; //å°†å¤§äºå½“å‰å€¼çš„æ•°åç§»ä¸€ä¸ªä½ç½® &#125; else &#123; break; //å·²æœ‰åºï¼Œæ— éœ€ç»§ç»­æ¯”è¾ƒ &#125; &#125; else &#123; //ä»å¤§åˆ°å°æ’åº if (data[n] &lt;= tmp) &#123; data[n + 1] = data[n]; //å°†å°äºå½“å‰å€¼çš„æ•°åç§»ä¸€ä¸ªä½ç½® &#125; else &#123; break; &#125; &#125; &#125; data[n+1] = tmp; &#125;&#125; æ’å…¥æ’åº - å¸Œå°”æ’åºåŸºæœ¬æ€æƒ³ å…ˆå°†æ•´ä¸ªå¾…æ’åºçš„è®°å½•åºåˆ—åˆ†å‰²æˆä¸ºè‹¥å¹²å­åºåˆ—åˆ†åˆ«è¿›è¡Œç›´æ¥æ’å…¥æ’åºï¼Œå¾…æ•´ä¸ªåºåˆ—ä¸­çš„è®°å½•â€œåŸºæœ¬æœ‰åºâ€æ—¶ï¼Œå†å¯¹å…¨ä½“è®°å½•è¿›è¡Œä¾æ¬¡ç›´æ¥æ’å…¥æ’åº å¸Œå°”æ’åºæ—¶æ•ˆåˆ†æå¾ˆéš¾ï¼Œå…³é”®ç çš„æ¯”è¾ƒæ¬¡æ•°ä¸è®°å½•ç§»åŠ¨æ¬¡æ•°ä¾èµ–äºå¢é‡å› å­åºåˆ— d çš„é€‰å–ï¼Œç‰¹å®šæƒ…å†µä¸‹å¯ä»¥å‡†ç¡®ä¼°ç®—å‡ºå…³é”®ç çš„æ¯”è¾ƒæ¬¡æ•°å’Œè®°å½•çš„ç§»åŠ¨æ¬¡æ•° æ—¶é—´å¤æ‚åº¦ï¼šO(n^2) æ“ä½œæ€æƒ³ é€‰æ‹©ä¸€ä¸ªå¢é‡åºåˆ— n/2, n/4, â€¦, 1 æŒ‰å¢é‡åºåˆ—ä¸ªæ•° kï¼Œå¯¹åºåˆ—è¿›è¡Œ k è¶Ÿæ’åºï¼› æ¯è¶Ÿæ’åºï¼Œæ ¹æ®å¯¹åº”çš„å¢é‡ï¼Œå°†å¾…æ’åºåˆ—åˆ†å‰²æˆè‹¥å¹²é•¿åº¦çš„å­åºåˆ—ï¼Œåˆ†åˆ«å¯¹å„å­è¡¨è¿›è¡Œç›´æ¥æ’å…¥æ’åºã€‚ä»…å¢é‡å› å­ä¸º 1 æ—¶ï¼Œæ•´ä¸ªåºåˆ—ä½œä¸ºä¸€ä¸ªè¡¨æ¥å¤„ç†ï¼Œè¡¨é•¿åº¦å³ä¸ºæ•´ä¸ªåºåˆ—çš„é•¿åº¦ æ’åºç¤ºä¾‹ åˆå§‹å…³é”®å­—ï¼ˆå¢é‡ä¸º 10/2 = 5ï¼‰ 49 38 65 97 76 13 27 49 55 04 æ ¹æ®å¢é‡åˆ’åˆ†å­åºåˆ—ï¼Œå¹¶å¯¹å­åºåˆ—è¿›è¡Œæ’åº 49 13 -&gt; 13 49 38 27 -&gt; 27 38 65 49 -&gt; 49 65 97 55 -&gt; 55 97 76 04 -&gt; 04 76 ç¬¬ä¸€èººæ’åºç»“æœ 13 27 49 55 04 49 38 65 97 76 æ ¹æ®å¢é‡åˆ’åˆ†å­åºåˆ—ï¼ˆå¢é‡ä¸º 10/4 â‰ˆ 3ï¼‰ 13 55 38 76 -&gt; 13 38 55 76 27 04 65 -&gt; 04 27 65 49 49 97 -&gt; 49 49 97 ç¬¬äºŒèººæ’åºç»“æœ 13 04 49 38 27 49 55 65 97 76 ç¬¬ä¸‰èººæ’åºç»“æœ 04 13 27 38 49 49 55 65 76 97 ç®—æ³•å®ç°12345678910111213141516171819202122232425262728293031323334/** * å¸Œå°”æ’åº * @param data è¦æ’åºçš„æ•°ç»„ * @param reverse ä»å¤§åˆ°å°(false)è¿˜æ˜¯ä»å°åˆ°å¤§(ture) */public static void sort(int[] data, boolean reverse) &#123; if (data.length == 1) &#123; return; &#125; for (int d = data.length / 2; d &gt;= 1; d = d / 2) &#123; //ç»„å¤§å° for (int k = 0; k &lt; d; k**) &#123; //å¤šå°‘ç»„ for (int n = d + k; n &lt; data.length; n = n + d) &#123; //åŒä¸€ç»„ int cur = n; while (cur - d &gt;= 0) &#123; //æ’å…¥æ’åº int tmp = 0; if (reverse) &#123; //å°åˆ°å¤§(ture) if (data[cur] &lt;= data[cur - d]) &#123; tmp = data[cur]; data[cur] = data[cur - d]; data[cur - d] = tmp; &#125; &#125; else &#123; //ä»å¤§åˆ°å°(false) if (data[cur] &gt;= data[cur - d]) &#123; tmp = data[cur]; data[cur] = data[cur - d]; data[cur - d] = tmp; &#125; &#125; cur = cur - d; &#125; &#125; &#125; &#125;&#125; é€‰æ‹©æ’åº - ç›´æ¥é€‰æ‹©æ’åºåŸºæœ¬æ€æƒ³ åœ¨è¦æ’åºçš„ä¸€ç»„æ•°ä¸­ï¼Œé€‰å‡ºæœ€å°ï¼ˆæˆ–è€…æœ€å¤§ï¼‰çš„ä¸€ä¸ªæ•°ä¸ç¬¬1ä¸ªä½ç½®çš„æ•°äº¤æ¢ï¼›ç„¶ååœ¨å‰©ä¸‹çš„æ•°å½“ä¸­å†æ‰¾æœ€å°ï¼ˆæˆ–è€…æœ€å¤§ï¼‰çš„ä¸ç¬¬2ä¸ªä½ç½®çš„æ•°äº¤æ¢ï¼Œä¾æ¬¡ç±»æ¨ï¼Œç›´åˆ°ç¬¬n-1ä¸ªå…ƒç´ ï¼ˆå€’æ•°ç¬¬äºŒä¸ªæ•°ï¼‰å’Œç¬¬nä¸ªå…ƒç´ ï¼ˆæœ€åä¸€ä¸ªæ•°ï¼‰æ¯”è¾ƒä¸ºæ­¢ æ—¶é—´å¤æ‚åº¦ï¼šO(n^2) ä¸ç¨³å®š æ’åºç¤ºä¾‹ åˆå§‹å€¼ ()3 1 5 7 2 4 9 6 æ— åºåºåˆ—ä¸­æ‰¾å‡ºæœ€å°çš„å€¼æ”¾å…¥æœ‰åºåºåˆ— (1) 3 5 7 2 4 9 6 é‡å¤ä¸Šä¸€æ­¥éª¤ (1 2) 3 5 7 4 9 6 (1 2 3) 5 7 4 9 6 (1 2 3 4) 5 7 9 6 (1 2 3 4 5) 7 9 6 (1 2 3 4 5 6) 7 9 (1 2 3 4 5 6 7) 9 (1 2 3 4 5 6 7 9) ç®—æ³•å®ç°123456789101112131415public static void selectSort(int array[])&#123; for(int i = 0; i &lt; array.length-1; i**)&#123; int minIndex = i; //å–æ— åºåºåˆ—çš„ç¬¬ä¸€ä¸ªå€¼ä¸ºæœ€å°å€¼ï¼ˆæ ‡è¯†ä½ï¼‰ for(int j = i+1; j &lt; array.length-1; j**)&#123; //æ¯”è¾ƒé€‰æ‹©æœ€å°å€¼ if(array[j] &lt; array[minIndex])&#123; minIndex = j; &#125; &#125; if(minIndex != i)&#123; //åªæœ‰å½“æ— åºåºåˆ—çš„ç¬¬ä¸€ä¸ªæ•°ä¸æ˜¯æœ€å°å€¼æ—¶æ‰è¿›è¡Œäº¤æ¢ int temp = array[i]; array[i] = array[minIndex]; array[minIndex] = temp; &#125; &#125;&#125; é€‰æ‹©æ’åº - å †æ’åºåŸºæœ¬æ€æƒ³ å †æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ ‘å½¢æ•°æ®ç»“æ„ï¼Œå…¶æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä¸€ä¸ªå€¼ï¼Œé€šå¸¸æåˆ°çš„å †æ˜¯æŒ‡ä¸€é¢—å®Œå…¨äºŒå‰æ ‘ï¼Œæ ¹èŠ‚ç‚¹çš„å€¼å°äºï¼ˆæˆ–å¤§äºï¼‰ä¸¤ä¸ªå­èŠ‚ç‚¹çš„å€¼ï¼Œä¸”æ ¹èŠ‚ç‚¹çš„ä¸¤ä¸ªå­—æ•°ä¹Ÿåˆ†åˆ«æ˜¯ä¸€ä¸ªå † é€»è¾‘ç»“æ„ï¼šæ ‘å½¢ç»“æ„ å­˜å‚¨ç»“æ„ï¼šé¡ºåºå­˜å‚¨ï¼ˆæ•°ç»„ï¼‰ æ—¶é—´å¤æ‚åº¦ï¼šO(nlog2n) ä¸ç¨³å®š ä¸¤ä¸ªå…³é”®é—®é¢˜ å°†ä¸€ä¸ªæ— åºåºåˆ—æ„æˆä¸€ä¸ªå † è¾“å‡ºé¡¶å †å…ƒç´ åï¼Œè°ƒæ•´å‰©ä½™å…ƒç´ æˆä¸ºä¸€ä¸ªæ–°å † æ’åºç¤ºä¾‹ 1 6 7 2 3 4 5 å·¦å­æ ‘å’Œå³å­æ ‘éƒ½ç¬¦åˆæœ€å¤§å † æ ¹å…ƒç´ æ‰€åœ¨çš„æ•°å¹¶ä¸ç¬¦åˆï¼Œä¸” 7 &gt; 6 &gt; 1 å°† 7 ä¸ 1 äº¤æ¢ä½ç½® 7 6 1 2 3 4 5 æ­¤æ—¶å³å­æ ‘ä¸ç¬¦åˆæœ€å¤§å †ï¼Œä¸” 5 &gt; 4 &gt; 1 å°† 5 ä¸ 1 äº¤æ¢ä½ç½® 7 6 5 2 3 4 1 æ­¤æ—¶å»ºå †æ“ä½œå®Œæˆï¼Œæ­¤åºåˆ—çš„æœ€å¤§å€¼å°±åœ¨å †çš„æ ¹èŠ‚ç‚¹ä¸Š éšåå°†å †é¡¶æœ€å¤§å€¼å’Œæ•°ç»„æœ€åçš„å…ƒç´ è¿›è¡Œæ›¿æ¢ï¼Œæˆ‘ä»¬å°±å®Œæˆäº†ä¸€è¶Ÿæ’åºäº† 1 6 5 2 3 4 (7) é‡å¤ä¸Šè¿°è¿‡ç¨‹ç›´åˆ°åºåˆ—æ’åºå®Œæˆ ç®—æ³•å®ç°12345678910111213141516171819202122232425262728293031323334353637383940/** * å»ºå † * * @param arrays çœ‹ä½œæ˜¯å®Œå…¨äºŒå‰æ ‘ * @param currentRootNode å½“å‰çˆ¶èŠ‚ç‚¹ä½ç½® * @param size èŠ‚ç‚¹æ€»æ•° */public static void heapify(int[] arrays, int currentRootNode, int size) &#123; if (currentRootNode &lt; size) &#123; //å·¦å­æ ‘å’Œå³å­—æ•°çš„ä½ç½® int left = 2 * currentRootNode + 1; int right = 2 * currentRootNode + 2; //æŠŠå½“å‰çˆ¶èŠ‚ç‚¹ä½ç½®çœ‹æˆæ˜¯æœ€å¤§çš„ int max = currentRootNode; if (left &lt; size) &#123; //å¦‚æœæ¯”å½“å‰æ ¹å…ƒç´ è¦å¤§ï¼Œè®°å½•å®ƒçš„ä½ç½® if (arrays[max] &lt; arrays[left]) &#123; max = left; &#125; &#125; if (right &lt; size) &#123; //å¦‚æœæ¯”å½“å‰æ ¹å…ƒç´ è¦å¤§ï¼Œè®°å½•å®ƒçš„ä½ç½® if (arrays[max] &lt; arrays[right]) &#123; max = right; &#125; &#125; //å¦‚æœæœ€å¤§çš„ä¸æ˜¯æ ¹å…ƒç´ ä½ç½®ï¼Œé‚£ä¹ˆå°±äº¤æ¢ if (max != currentRootNode) &#123; int temp = arrays[max]; arrays[max] = arrays[currentRootNode]; arrays[currentRootNode] = temp; //ç»§ç»­æ¯”è¾ƒï¼Œç›´åˆ°å®Œæˆä¸€æ¬¡å»ºå † heapify(arrays, max, size); &#125; &#125;&#125; æ˜¾ç„¶ï¼Œä¸€ä¸ªæ™®é€šçš„æ•°ç»„å¹¶ä¸èƒ½æœ‰è¿™ç§æ¡ä»¶(çˆ¶&gt;å­)ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å¾€å¾€æ˜¯ä»æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ æ¥è¿›è¡Œå»ºå † 1234567891011/** * å®Œæˆä¸€æ¬¡å»ºå †ï¼Œæœ€å¤§å€¼åœ¨å †çš„é¡¶éƒ¨(æ ¹èŠ‚ç‚¹) */public static void maxHeapify(int[] arrays, int size) &#123; // ä»æ•°ç»„çš„å°¾éƒ¨å¼€å§‹ï¼Œç›´åˆ°ç¬¬ä¸€ä¸ªå…ƒç´ (è§’æ ‡ä¸º0) for (int i = size - 1; i &gt;= 0; i--) &#123; heapify(arrays, i, size); &#125;&#125; å®Œæˆç¬¬ä¸€æ¬¡å»ºå †ä¹‹åï¼Œæˆ‘ä»¬ä¼šå‘ç°æœ€å¤§å€¼ä¼šåœ¨æ•°ç»„çš„é¦–ä½ æ¥ä¸‹æ¥ä¸æ–­å»ºå †ï¼Œç„¶åè®©æ•°ç»„æœ€åä¸€ä½ä¸å½“å‰å †é¡¶(æ•°ç»„ç¬¬ä¸€ä½)è¿›è¡Œäº¤æ¢å³å¯æ’åº 1234567891011for (int i = 0; i &lt; arrays.length; i**) &#123; //æ¯æ¬¡å»ºå †å°±å¯ä»¥æ’é™¤ä¸€ä¸ªå…ƒç´ äº†ï¼ˆå…¶å®å¯ä»¥ä¸ç”¨æ¯æ¬¡éƒ½ä»æœ€åä¸€ä¸ªå…ƒç´ è¿›è¡Œå»ºå †ï¼‰ maxHeapify(arrays, arrays.length - i); //äº¤æ¢ int temp = arrays[0]; arrays[0] = arrays[(arrays.length - 1) - i]; arrays[(arrays.length - 1) - i] = temp;&#125; äº¤æ¢æ’åº - å†’æ³¡æ’åºåŸºæœ¬æ€æƒ³ ä¸¤ä¸ªæ•°æ¯”è¾ƒå¤§å°ï¼Œè¾ƒå¤§çš„æ•°ä¸‹æ²‰ï¼Œè¾ƒå°çš„æ•°å†’èµ·æ¥ æ—¶é—´å¤æ‚åº¦ï¼šO(n^2) æ’åºè¿‡ç¨‹ æ¯”è¾ƒç›¸é‚»çš„ä¸¤ä¸ªæ•°æ®ï¼Œå¦‚æœç¬¬äºŒä¸ªæ•°å°ï¼Œå°±äº¤æ¢ä½ç½® ä»åå‘å‰ä¸¤ä¸¤æ¯”è¾ƒï¼Œä¸€ç›´åˆ°æ¯”è¾ƒæœ€å‰ä¸¤ä¸ªæ•°æ®ã€‚æœ€ç»ˆæœ€å°æ•°è¢«äº¤æ¢åˆ°èµ·å§‹çš„ä½ç½®ï¼Œè¿™æ ·ç¬¬ä¸€ä¸ªæœ€å°æ•°çš„ä½ç½®å°±æ’å¥½äº† ç»§ç»­é‡å¤ä¸Šè¿°è¿‡ç¨‹ï¼Œä¾æ¬¡å°†ç¬¬2.3â€¦n-1ä¸ªæœ€å°æ•°æ’å¥½ä½ç½® ç®—æ³•å®ç°1234567891011121314public static void BubbleSort(int [] arr)&#123; int temp;//ä¸´æ—¶å˜é‡ for(int i=0; i&lt;arr.length-1; i**)&#123; //è¡¨ç¤ºè¶Ÿæ•°ï¼Œä¸€å…±arr.length-1æ¬¡ã€‚ for(int j=arr.length-1; j&gt;i; j--)&#123; if(arr[j] &lt; arr[j-1])&#123; temp = arr[j]; arr[j] = arr[j-1]; arr[j-1] = temp; &#125; &#125; &#125;&#125; äº¤æ¢æ’åº - å¿«é€Ÿæ’åºåŸºæœ¬æ€æƒ³ å…ˆä»æ•°åˆ—ä¸­å–å‡ºä¸€ä¸ªæ•°ä½œä¸º key å€¼ å°†æ¯”è¿™ä¸ªæ•°å°çš„æ•°å…¨éƒ¨æ”¾åœ¨å®ƒçš„å·¦è¾¹ï¼Œå¤§äºæˆ–ç­‰äºå®ƒçš„æ•°å…¨éƒ¨æ”¾åœ¨å®ƒçš„å³è¾¹ å¯¹å·¦å³ä¸¤ä¸ªå°æ•°åˆ—é‡å¤ç¬¬äºŒæ­¥ï¼Œç›´è‡³å„åŒºé—´åªæœ‰ 1 ä¸ªæ•° æ—¶é—´å¤æ‚åº¦ï¼šO(n^2) ä¸ç¨³å®š æ’åºç¤ºä¾‹ ()ï¼šlowæŒ‡é’ˆä½ç½® []ï¼šhighæŒ‡é’ˆä½ç½® åˆå§‹æ— åºåºåˆ— (23) 46 0 8 11 [18] ç”¨ä¸€ä¸ªä¸´æ—¶å˜é‡å­˜å‚¨åŸºå‡†æ•°æ® key = 23 é¦–å…ˆä»ååŠéƒ¨åˆ†å¼€å§‹ å¦‚æœæ‰«æåˆ°çš„å€¼å¤§äºåŸºå‡†æ•°æ®å°±è®©highå‡1 å¦‚æœå‘ç°æœ‰å…ƒç´ æ¯”è¯¥åŸºå‡†æ•°æ®çš„å€¼å°ï¼Œå°±å°†highä½ç½®çš„å€¼èµ‹å€¼ç»™lowä½ç½® ç¬¬ 1 æ¬¡æ‰«æåçš„åºåˆ—ï¼ˆhigh æŒ‡é’ˆæŒ‡å‘çš„å€¼ 18 &lt; keyï¼‰ (18) 46 0 8 11 [18] ç„¶åå¼€å§‹ä»å‰å¾€åæ‰«æ å¦‚æœæ‰«æåˆ°çš„å€¼å°äºåŸºå‡†æ•°æ®å°±è®©lowåŠ 1 å¦‚æœå‘ç°æœ‰å…ƒç´ å¤§äºåŸºå‡†æ•°æ®çš„å€¼ï¼Œå°±å†å°†lowä½ç½®çš„å€¼èµ‹å€¼ç»™highä½ç½®çš„å€¼,æŒ‡é’ˆç§»åŠ¨å¹¶ä¸”æ•°æ®äº¤æ¢ ç¬¬ 2 æ¬¡æ‰«æåçš„åºåˆ—ï¼ˆ18 &lt; keyï¼‰ 18 (46) 0 8 11 [18] ç¬¬ 3 æ¬¡æ‰«æåçš„åºåˆ—ï¼ˆ46 &gt; keyï¼‰ 18 (46) 0 8 11 [46] ç¬¬ 4 æ¬¡æ‰«æåçš„åºåˆ—ï¼ˆ46 &gt; keyï¼‰ 18 (46) 0 8 [11] 46 ç¬¬ 5 æ¬¡æ‰«æåçš„åºåˆ—ï¼ˆ11 &lt; keyï¼‰ 18 (11) 0 8 [11] 46 ç¬¬ 6 æ¬¡æ‰«æåçš„åºåˆ—ï¼ˆ11 &lt; keyï¼‰ 18 11 (0) 8 [11] 46 ç¬¬ 7 æ¬¡æ‰«æåçš„åºåˆ—ï¼ˆ0 &lt; keyï¼‰ 18 11 0 (8) [11] 46 ç¬¬ 8 æ¬¡æ‰«æåçš„åºåˆ—ï¼ˆ8 &lt; keyï¼‰ 18 11 0 8 ([11]) 46 èµ‹ key å€¼ 18 11 0 8 ([23]) 46 ç®—æ³•å®ç°123456789101112131415161718192021222324252627282930313233343536public static int getIndex(int[] arr, int low, int high) &#123; // åŸºå‡†æ•°æ® int tmp = arr[low]; while (low &lt; high) &#123; // å½“é˜Ÿå°¾çš„å…ƒç´ å¤§äºç­‰äºåŸºå‡†æ•°æ®æ—¶,å‘å‰æŒªåŠ¨highæŒ‡é’ˆ while (low &lt; high &amp;&amp; arr[high] &gt;= tmp) &#123; high--; &#125; // å¦‚æœé˜Ÿå°¾å…ƒç´ å°äºtmpäº†,éœ€è¦å°†å…¶èµ‹å€¼ç»™low arr[low] = arr[high]; // å½“é˜Ÿé¦–å…ƒç´ å°äºç­‰äºtmpæ—¶,å‘å‰æŒªåŠ¨lowæŒ‡é’ˆ while (low &lt; high &amp;&amp; arr[low] &lt;= tmp) &#123; low**; &#125; // å½“é˜Ÿé¦–å…ƒç´ å¤§äºtmpæ—¶,éœ€è¦å°†å…¶èµ‹å€¼ç»™high arr[high] = arr[low]; &#125; // è·³å‡ºå¾ªç¯æ—¶lowå’Œhighç›¸ç­‰,æ­¤æ—¶çš„lowæˆ–highå°±æ˜¯tmpçš„æ­£ç¡®ç´¢å¼•ä½ç½® // ç”±åŸç†éƒ¨åˆ†å¯ä»¥å¾ˆæ¸…æ¥šçš„çŸ¥é“lowä½ç½®çš„å€¼å¹¶ä¸æ˜¯tmp,æ‰€ä»¥éœ€è¦å°†tmpèµ‹å€¼ç»™arr[low] arr[low] = tmp; return low; // è¿”å›tmpçš„æ­£ç¡®ä½ç½®&#125;private static void quickSort(int[] arr, int low, int high) &#123; if (low &lt; high) &#123; // æ‰¾å¯»åŸºå‡†æ•°æ®çš„æ­£ç¡®ç´¢å¼• int index = getIndex(arr, low, high); // è¿›è¡Œè¿­ä»£å¯¹indexä¹‹å‰å’Œä¹‹åçš„æ•°ç»„è¿›è¡Œç›¸åŒçš„æ“ä½œä½¿æ•´ä¸ªæ•°ç»„å˜æˆæœ‰åº quickSort(arr, low, index - 1); quickSort(arr, index + 1, high); &#125;&#125; å½’å¹¶æ’åºåŸºæœ¬æ€æƒ³ æ˜¯åˆ©ç”¨é€’å½’ä¸åˆ†æ²»çš„æŠ€æœ¯å°†æ•°æ®åºåˆ—åˆ’åˆ†ä¸ºè¶Šæ¥è¶Šå°çš„åŠå­è¡¨ï¼Œå†å¯¹åŠå­è¡¨æ’åºï¼Œæœ€åå†ç”¨é€’å½’æ–¹æ³•å°†æ’å¥½åºçš„åŠå­è¡¨åˆå¹¶æˆè¶Šæ¥è¶Šå¤§çš„æœ‰åºåºåˆ— æ—¶é—´å¤æ‚åº¦ï¼šO(nlog2n) ç®—æ³•å®ç°12345678910111213141516171819202122232425262728293031323334public static void mergeSort(int[] arr) &#123; sort(arr, 0, arr.length - 1);&#125;public static void sort(int[] arr, int L, int R) &#123; if(L == R) &#123; return; &#125; int mid = L + ((R - L) &gt;&gt; 1); sort(arr, L, mid); sort(arr, mid + 1, R); merge(arr, L, mid, R);&#125;public static void merge(int[] arr, int L, int mid, int R) &#123; int[] temp = new int[R - L + 1]; int i = 0; int p1 = L; int p2 = mid + 1; // æ¯”è¾ƒå·¦å³ä¸¤éƒ¨åˆ†çš„å…ƒç´ ï¼Œå“ªä¸ªå°ï¼ŒæŠŠé‚£ä¸ªå…ƒç´ å¡«å…¥tempä¸­ while(p1 &lt;= mid &amp;&amp; p2 &lt;= R) &#123; temp[i**] = arr[p1] &lt; arr[p2] ? arr[p1**] : arr[p2**]; &#125; // ä¸Šé¢çš„å¾ªç¯é€€å‡ºåï¼ŒæŠŠå‰©ä½™çš„å…ƒç´ ä¾æ¬¡å¡«å…¥åˆ°tempä¸­ // ä»¥ä¸‹ä¸¤ä¸ªwhileåªæœ‰ä¸€ä¸ªä¼šæ‰§è¡Œ while(p1 &lt;= mid) &#123; temp[i**] = arr[p1**]; &#125; while(p2 &lt;= R) &#123; temp[i**] = arr[p2**]; &#125; // æŠŠæœ€ç»ˆçš„æ’åºçš„ç»“æœå¤åˆ¶ç»™åŸæ•°ç»„ for(i = 0; i &lt; temp.length; i**) &#123; arr[L + i] = temp[i]; &#125;&#125; åŸºæ•°æ’åºåŸºæœ¬æ€æƒ³ BinSortæƒ³æ³•éå¸¸ç®€å•ï¼Œé¦–å…ˆåˆ›å»ºæ•°ç»„A[MaxValue]ï¼›ç„¶åå°†æ¯ä¸ªæ•°æ”¾åˆ°ç›¸åº”çš„ä½ç½®ä¸Šï¼ˆä¾‹å¦‚17æ”¾åœ¨ä¸‹æ ‡17çš„æ•°ç»„ä½ç½®ï¼‰ï¼›æœ€åéå†æ•°ç»„ï¼Œå³ä¸ºæ’åºåçš„ç»“æœ åŸºæ•°æ’åºæ˜¯åœ¨BinSortçš„åŸºç¡€ä¸Šï¼Œé€šè¿‡åŸºæ•°çš„é™åˆ¶æ¥å‡å°‘ç©ºé—´çš„å¼€é”€ æ’åºç¤ºä¾‹ åˆå§‹åºåˆ—ï¼ˆåŸºæ•°ä¸º 10 ï¼‰ 27 91 01 97 17 23 84 28 72 05 67 25 ç¬¬ 1 æ¬¡æ’åºï¼šå¯¹ (å…ƒç´  % 10) è¿›è¡Œæ’åº 91 01 72 23 84 05 25 27 97 17 67 28 ç¬¬ 2 æ¬¡æ’åºï¼šå¯¹ (å…ƒç´  / 10) è¿›è¡Œæ’åº 01 05 17 23 25 27 28 67 72 84 91 97 ç®—æ³•å®ç°12345678910111213141516171819202122232425262728293031public static void radixSort(int[] array,int d)&#123; int n=1;//ä»£è¡¨ä½æ•°å¯¹åº”çš„æ•°ï¼š1,10,100... int k=0;//ä¿å­˜æ¯ä¸€ä½æ’åºåçš„ç»“æœç”¨äºä¸‹ä¸€ä½çš„æ’åºè¾“å…¥ int length=array.length; int[][] bucket=new int[10][length];//æ’åºæ¡¶ç”¨äºä¿å­˜æ¯æ¬¡æ’åºåçš„ç»“æœï¼Œè¿™ä¸€ä½ä¸Šæ’åºç»“æœç›¸åŒçš„æ•°å­—æ”¾åœ¨åŒä¸€ä¸ªæ¡¶é‡Œ int[] order=new int[length];//ç”¨äºä¿å­˜æ¯ä¸ªæ¡¶é‡Œæœ‰å¤šå°‘ä¸ªæ•°å­— while(n&lt;d) &#123; for(int num:array) //å°†æ•°ç»„arrayé‡Œçš„æ¯ä¸ªæ•°å­—æ”¾åœ¨ç›¸åº”çš„æ¡¶é‡Œ &#123; int digit=(num/n)%10; bucket[digit][order[digit]]=num; order[digit]**; &#125; for(int i=0;i&lt;length;i**)//å°†å‰ä¸€ä¸ªå¾ªç¯ç”Ÿæˆçš„æ¡¶é‡Œçš„æ•°æ®è¦†ç›–åˆ°åŸæ•°ç»„ä¸­ç”¨äºä¿å­˜è¿™ä¸€ä½çš„æ’åºç»“æœ &#123; if(order[i]!=0)//è¿™ä¸ªæ¡¶é‡Œæœ‰æ•°æ®ï¼Œä»ä¸Šåˆ°ä¸‹éå†è¿™ä¸ªæ¡¶å¹¶å°†æ•°æ®ä¿å­˜åˆ°åŸæ•°ç»„ä¸­ &#123; for(int j=0;j&lt;order[i];j**) &#123; array[k]=bucket[i][j]; k**; &#125; &#125; order[i]=0;//å°†æ¡¶é‡Œè®¡æ•°å™¨ç½®0ï¼Œç”¨äºä¸‹ä¸€æ¬¡ä½æ’åº &#125; n*=10; k=0;//å°†kç½®0ï¼Œç”¨äºä¸‹ä¸€è½®ä¿å­˜ä½æ’åºç»“æœ &#125;&#125;","categories":[{"name":"æŠ€æœ¯åŸç†","slug":"æŠ€æœ¯åŸç†","permalink":"http://yoursite.com/categories/%E6%8A%80%E6%9C%AF%E5%8E%9F%E7%90%86/"}],"tags":[{"name":"ç®—æ³•æ•´ç†","slug":"ç®—æ³•æ•´ç†","permalink":"http://yoursite.com/tags/%E7%AE%97%E6%B3%95%E6%95%B4%E7%90%86/"}]},{"title":"MySQL å¸¸ç”¨å‘½ä»¤","slug":"å¼€å‘æ‚é¡¹/MySQL å¸¸ç”¨å‘½ä»¤","date":"2020-04-30T05:33:19.000Z","updated":"2020-07-10T04:15:45.074Z","comments":true,"path":"2020/04/30/å¼€å‘æ‚é¡¹/MySQL å¸¸ç”¨å‘½ä»¤/","link":"","permalink":"http://yoursite.com/2020/04/30/%E5%BC%80%E5%8F%91%E6%9D%82%E9%A1%B9/MySQL%20%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/","excerpt":"MySQL å¸¸ç”¨å‘½ä»¤æ±‡æ€»ã€‚","text":"MySQL å¸¸ç”¨å‘½ä»¤æ±‡æ€»ã€‚ DDLï¼ˆData Definition Languageï¼‰DMLï¼ˆData Manipulation Languageï¼‰DCLï¼ˆData Control Languageï¼‰TCLï¼ˆTransaction Control Languageï¼‰ Shell æ“ä½œ12345678910111213&#x2F;* å¯åŠ¨MySQL *&#x2F;net start mysql&#x2F;* è¿æ¥ä¸æ–­å¼€æœåŠ¡å™¨ *&#x2F;mysql -h åœ°å€ -P ç«¯å£ -u ç”¨æˆ·å -p å¯†ç &#x2F;* è·³è¿‡æƒé™éªŒè¯ç™»å½•MySQL *&#x2F;mysqld --skip-grant-tables-- ä¿®æ”¹ root å¯†ç  å¯†ç åŠ å¯†å‡½æ•° password()update mysql.user set password&#x3D;password(&#39;root&#39;);SHOW PROCESSLIST -- æ˜¾ç¤ºå“ªäº›çº¿ç¨‹æ­£åœ¨è¿è¡ŒSHOW VARIABLES -- æ˜¾ç¤ºæ‰€æœ‰é…ç½®å‚æ•°ï¼Œé…åˆ like ä»¥åŠ % å¯è¿›è¡ŒæŸ¥è¯¢æŸä¸€å‚æ•° å¯¼å…¥å¯¼å‡º12345678910111213141516171819202122232425262728293031323334353637383940414243&#x2F;* å¤‡ä»½ä¸è¿˜åŸ *&#x2F;-- å¤‡ä»½ï¼Œå°†æ•°æ®çš„ç»“æ„ä¸è¡¨å†…æ•°æ®ä¿å­˜èµ·æ¥ã€‚-- åˆ©ç”¨ mysqldump æŒ‡ä»¤å®Œæˆã€‚-- å¯¼å‡º-- å¯¼å‡ºä¸€å¼ è¡¨mysqldump -uç”¨æˆ·å -på¯†ç  åº“å è¡¨å &gt; æ–‡ä»¶å(D:&#x2F;a.sql)-- å¯¼å‡ºå¤šå¼ è¡¨mysqldump -uç”¨æˆ·å -på¯†ç  åº“å è¡¨1 è¡¨2 è¡¨3 &gt; æ–‡ä»¶å(D:&#x2F;a.sql)-- å¯¼å‡ºæ‰€æœ‰è¡¨mysqldump -uç”¨æˆ·å -på¯†ç  åº“å &gt; æ–‡ä»¶å(D:&#x2F;a.sql)-- å¯¼å‡ºä¸€ä¸ªåº“ mysqldump -uç”¨æˆ·å -på¯†ç  -B åº“å &gt; æ–‡ä»¶å(D:&#x2F;a.sql)-- å¯ä»¥ -w æºå¸¦å¤‡ä»½æ¡ä»¶-- å¯¼å…¥-- åœ¨ç™»å½• mysql çš„æƒ…å†µä¸‹ï¼šsource å¤‡ä»½æ–‡ä»¶-- åœ¨ä¸ç™»å½•çš„æƒ…å†µä¸‹mysql -uç”¨æˆ·å -på¯†ç  åº“å &lt; å¤‡ä»½æ–‡ä»¶&#x2F;* å¯¼å…¥å¯¼å‡º *&#x2F;select * into outfile æ–‡ä»¶åœ°å€ [æ§åˆ¶æ ¼å¼] from è¡¨å; -- å¯¼å‡ºè¡¨æ•°æ®load data [local] infile æ–‡ä»¶åœ°å€ [replace|ignore] into table è¡¨å [æ§åˆ¶æ ¼å¼]; -- å¯¼å…¥æ•°æ® ç”Ÿæˆçš„æ•°æ®é»˜è®¤çš„åˆ†éš”ç¬¦æ˜¯åˆ¶è¡¨ç¬¦ localæœªæŒ‡å®šï¼Œåˆ™æ•°æ®æ–‡ä»¶å¿…é¡»åœ¨æœåŠ¡å™¨ä¸Š replace å’Œ ignore å…³é”®è¯æ§åˆ¶å¯¹ç°æœ‰çš„å”¯ä¸€é”®è®°å½•çš„é‡å¤çš„å¤„ç† -- æ§åˆ¶æ ¼å¼fields æ§åˆ¶å­—æ®µæ ¼å¼é»˜è®¤ï¼šfields terminated by &#39;\\t&#39; enclosed by &#39;&#39; escaped by &#39;\\\\&#39; terminated by &#39;string&#39; -- ç»ˆæ­¢ enclosed by &#39;char&#39; -- åŒ…è£¹ escaped by &#39;char&#39; -- è½¬ä¹‰ -- ç¤ºä¾‹ï¼š SELECT a,b,a+b INTO OUTFILE &#39;&#x2F;tmp&#x2F;result.text&#39; FIELDS TERMINATED BY &#39;,&#39; OPTIONALLY ENCLOSED BY &#39;&quot;&#39; LINES TERMINATED BY &#39;\\n&#39; FROM test_table;lines æ§åˆ¶è¡Œæ ¼å¼é»˜è®¤ï¼šlines terminated by &#39;\\n&#39; terminated by &#39;string&#39; -- ç»ˆæ­¢ æƒé™æ“ä½œ123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869&#x2F;* ç”¨æˆ·å’Œæƒé™ç®¡ç† *&#x2F; ------------------ç”¨æˆ·ä¿¡æ¯è¡¨ï¼šmysql.user-- åˆ·æ–°æƒé™FLUSH PRIVILEGES-- å¢åŠ ç”¨æˆ·CREATE USER ç”¨æˆ·å IDENTIFIED BY [PASSWORD] å¯†ç (å­—ç¬¦ä¸²) - å¿…é¡»æ‹¥æœ‰mysqlæ•°æ®åº“çš„å…¨å±€CREATE USERæƒé™ï¼Œæˆ–æ‹¥æœ‰INSERTæƒé™ã€‚ - åªèƒ½åˆ›å»ºç”¨æˆ·ï¼Œä¸èƒ½èµ‹äºˆæƒé™ã€‚ - ç”¨æˆ·åï¼Œæ³¨æ„å¼•å·ï¼šå¦‚ &#39;user_name&#39;@&#39;192.168.1.1&#39; - å¯†ç ä¹Ÿéœ€å¼•å·ï¼Œçº¯æ•°å­—å¯†ç ä¹Ÿè¦åŠ å¼•å· - è¦åœ¨çº¯æ–‡æœ¬ä¸­æŒ‡å®šå¯†ç ï¼Œéœ€å¿½ç•¥PASSWORDå…³é”®è¯ã€‚è¦æŠŠå¯†ç æŒ‡å®šä¸ºç”±PASSWORD()å‡½æ•°è¿”å›çš„æ··ç¼–å€¼ï¼Œéœ€åŒ…å«å…³é”®å­—PASSWORD-- é‡å‘½åç”¨æˆ·RENAME USER old_user TO new_user-- è®¾ç½®å¯†ç SET PASSWORD &#x3D; PASSWORD(&#39;å¯†ç &#39;) -- ä¸ºå½“å‰ç”¨æˆ·è®¾ç½®å¯†ç SET PASSWORD FOR ç”¨æˆ·å &#x3D; PASSWORD(&#39;å¯†ç &#39;) -- ä¸ºæŒ‡å®šç”¨æˆ·è®¾ç½®å¯†ç -- åˆ é™¤ç”¨æˆ·DROP USER ç”¨æˆ·å-- åˆ†é…æƒé™&#x2F;æ·»åŠ ç”¨æˆ·GRANT æƒé™åˆ—è¡¨ ON è¡¨å TO ç”¨æˆ·å [IDENTIFIED BY [PASSWORD] &#39;password&#39;] - all privileges è¡¨ç¤ºæ‰€æœ‰æƒé™ - *.* è¡¨ç¤ºæ‰€æœ‰åº“çš„æ‰€æœ‰è¡¨ - åº“å.è¡¨å è¡¨ç¤ºæŸåº“ä¸‹é¢çš„æŸè¡¨-- æŸ¥çœ‹æƒé™SHOW GRANTS FOR ç”¨æˆ·å -- æŸ¥çœ‹å½“å‰ç”¨æˆ·æƒé™ SHOW GRANTS; æˆ– SHOW GRANTS FOR CURRENT_USER; æˆ– SHOW GRANTS FOR CURRENT_USER();-- æ’¤æ¶ˆæƒé™REVOKE æƒé™åˆ—è¡¨ ON è¡¨å FROM ç”¨æˆ·åREVOKE ALL PRIVILEGES, GRANT OPTION FROM ç”¨æˆ·å -- æ’¤é”€æ‰€æœ‰æƒé™-- æƒé™å±‚çº§-- è¦ä½¿ç”¨GRANTæˆ–REVOKEï¼Œæ‚¨å¿…é¡»æ‹¥æœ‰GRANT OPTIONæƒé™ï¼Œå¹¶ä¸”æ‚¨å¿…é¡»ç”¨äºæ‚¨æ­£åœ¨æˆäºˆæˆ–æ’¤é”€çš„æƒé™ã€‚å…¨å±€å±‚çº§ï¼šå…¨å±€æƒé™é€‚ç”¨äºä¸€ä¸ªç»™å®šæœåŠ¡å™¨ä¸­çš„æ‰€æœ‰æ•°æ®åº“ï¼Œmysql.user GRANT ALL ON *.*å’Œ REVOKE ALL ON *.*åªæˆäºˆå’Œæ’¤é”€å…¨å±€æƒé™ã€‚æ•°æ®åº“å±‚çº§ï¼šæ•°æ®åº“æƒé™é€‚ç”¨äºä¸€ä¸ªç»™å®šæ•°æ®åº“ä¸­çš„æ‰€æœ‰ç›®æ ‡ï¼Œmysql.db, mysql.host GRANT ALL ON db_name.*å’ŒREVOKE ALL ON db_name.*åªæˆäºˆå’Œæ’¤é”€æ•°æ®åº“æƒé™ã€‚è¡¨å±‚çº§ï¼šè¡¨æƒé™é€‚ç”¨äºä¸€ä¸ªç»™å®šè¡¨ä¸­çš„æ‰€æœ‰åˆ—ï¼Œmysql.talbes_priv GRANT ALL ON db_name.tbl_nameå’ŒREVOKE ALL ON db_name.tbl_nameåªæˆäºˆå’Œæ’¤é”€è¡¨æƒé™ã€‚åˆ—å±‚çº§ï¼šåˆ—æƒé™é€‚ç”¨äºä¸€ä¸ªç»™å®šè¡¨ä¸­çš„å•ä¸€åˆ—ï¼Œmysql.columns_priv å½“ä½¿ç”¨REVOKEæ—¶ï¼Œæ‚¨å¿…é¡»æŒ‡å®šä¸è¢«æˆæƒåˆ—ç›¸åŒçš„åˆ—ã€‚-- æƒé™åˆ—è¡¨ALL [PRIVILEGES] -- è®¾ç½®é™¤GRANT OPTIONä¹‹å¤–çš„æ‰€æœ‰ç®€å•æƒé™ALTER -- å…è®¸ä½¿ç”¨ALTER TABLEALTER ROUTINE -- æ›´æ”¹æˆ–å–æ¶ˆå·²å­˜å‚¨çš„å­ç¨‹åºCREATE -- å…è®¸ä½¿ç”¨CREATE TABLECREATE ROUTINE -- åˆ›å»ºå·²å­˜å‚¨çš„å­ç¨‹åºCREATE TEMPORARY TABLES -- å…è®¸ä½¿ç”¨CREATE TEMPORARY TABLECREATE USER -- å…è®¸ä½¿ç”¨CREATE USER, DROP USER, RENAME USERå’ŒREVOKE ALL PRIVILEGESã€‚CREATE VIEW -- å…è®¸ä½¿ç”¨CREATE VIEWDELETE -- å…è®¸ä½¿ç”¨DELETEDROP -- å…è®¸ä½¿ç”¨DROP TABLEEXECUTE -- å…è®¸ç”¨æˆ·è¿è¡Œå·²å­˜å‚¨çš„å­ç¨‹åºFILE -- å…è®¸ä½¿ç”¨SELECT...INTO OUTFILEå’ŒLOAD DATA INFILEINDEX -- å…è®¸ä½¿ç”¨CREATE INDEXå’ŒDROP INDEXINSERT -- å…è®¸ä½¿ç”¨INSERTLOCK TABLES -- å…è®¸å¯¹æ‚¨æ‹¥æœ‰SELECTæƒé™çš„è¡¨ä½¿ç”¨LOCK TABLESPROCESS -- å…è®¸ä½¿ç”¨SHOW FULL PROCESSLISTREFERENCES -- æœªè¢«å®æ–½RELOAD -- å…è®¸ä½¿ç”¨FLUSHREPLICATION CLIENT -- å…è®¸ç”¨æˆ·è¯¢é—®ä»å±æœåŠ¡å™¨æˆ–ä¸»æœåŠ¡å™¨çš„åœ°å€REPLICATION SLAVE -- ç”¨äºå¤åˆ¶å‹ä»å±æœåŠ¡å™¨ï¼ˆä»ä¸»æœåŠ¡å™¨ä¸­è¯»å–äºŒè¿›åˆ¶æ—¥å¿—äº‹ä»¶ï¼‰SELECT -- å…è®¸ä½¿ç”¨SELECTSHOW DATABASES -- æ˜¾ç¤ºæ‰€æœ‰æ•°æ®åº“SHOW VIEW -- å…è®¸ä½¿ç”¨SHOW CREATE VIEWSHUTDOWN -- å…è®¸ä½¿ç”¨mysqladmin shutdownSUPER -- å…è®¸ä½¿ç”¨CHANGE MASTER, KILL, PURGE MASTER LOGSå’ŒSET GLOBALè¯­å¥ï¼Œmysqladmin debugå‘½ä»¤ï¼›å…è®¸æ‚¨è¿æ¥ï¼ˆä¸€æ¬¡ï¼‰ï¼Œå³ä½¿å·²è¾¾åˆ°max_connectionsã€‚UPDATE -- å…è®¸ä½¿ç”¨UPDATEUSAGE -- â€œæ— æƒé™â€çš„åŒä¹‰è¯GRANT OPTION -- å…è®¸æˆäºˆæƒé™ æ•°æ®åº“æ“ä½œ1234567891011121314151617-- æŸ¥çœ‹å½“å‰æ•°æ®åº“select database();-- æ˜¾ç¤ºå½“å‰æ—¶é—´ã€ç”¨æˆ·åã€æ•°æ®åº“ç‰ˆæœ¬select now(), user(), version();-- åˆ›å»ºåº“create database [if not exists] æ•°æ®åº“å æ•°æ®åº“é€‰é¡¹-- æ•°æ®åº“é€‰é¡¹ï¼š -- CHARACTER SET charset_name æŒ‡å®šæ•°æ®åº“é‡‡ç”¨çš„å­—ç¬¦é›† -- COLLATE collation_name æŒ‡å®šæ•°æ®åº“å­—ç¬¦é›†çš„æ¯”è¾ƒæ–¹å¼ï¼ˆé»˜è®¤ utf8_general_ciï¼‰-- æŸ¥çœ‹å·²æœ‰åº“show databases [like &#39;pattern&#39;]-- æŸ¥çœ‹å½“å‰åº“ä¿¡æ¯show create database æ•°æ®åº“å-- ä¿®æ”¹åº“çš„é€‰é¡¹ä¿¡æ¯alter database åº“å é€‰é¡¹ä¿¡æ¯-- åˆ é™¤åº“ï¼ŒåŒæ—¶åˆ é™¤è¯¥æ•°æ®åº“ç›¸å…³çš„ç›®å½•åŠå…¶ç›®å½•å†…å®¹drop database [if exists] æ•°æ®åº“å è¡¨æ“ä½œCREATE12345678910111213141516171819202122232425262728293031323334-- åˆ›å»ºè¡¨create [temporary] table [if not exists] [åº“å.]è¡¨å (è¡¨çš„ç»“æ„å®šä¹‰) [è¡¨é€‰é¡¹] -- æ¯ä¸ªå­—æ®µå¿…é¡»æœ‰æ•°æ®ç±»å‹ -- æœ€åä¸€ä¸ªå­—æ®µåä¸èƒ½æœ‰é€—å· -- temporary ä¸´æ—¶è¡¨ï¼Œä¼šè¯ç»“æŸæ—¶è¡¨è‡ªåŠ¨æ¶ˆå¤± -- å¯¹äºå­—æ®µçš„å®šä¹‰ï¼š -- å­—æ®µå æ•°æ®ç±»å‹ -- [NOT NULL | NULL] -- [DEFAULT default_value] -- [AUTO_INCREMENT] -- [UNIQUE [KEY] | [PRIMARY] KEY] -- [COMMENT &#39;string&#39;] -- è¡¨é€‰é¡¹ -- å­—ç¬¦é›†ï¼Œå¦‚æœè¡¨æ²¡æœ‰è®¾å®šï¼Œåˆ™ä½¿ç”¨æ•°æ®åº“å­—ç¬¦é›† CHARSET &#x3D; charset_name -- å­˜å‚¨å¼•æ“ ENGINE &#x3D; engine_name -- è¡¨åœ¨ç®¡ç†æ•°æ®æ—¶é‡‡ç”¨çš„ä¸åŒçš„æ•°æ®ç»“æ„ï¼Œç»“æ„ä¸åŒä¼šå¯¼è‡´å¤„ç†æ–¹å¼ã€æä¾›çš„ç‰¹æ€§æ“ä½œç­‰ä¸åŒ -- å¸¸è§çš„å¼•æ“ï¼šInnoDB MyISAM Memory&#x2F;Heap BDB Merge Example CSV MaxDB Archive -- ä¸åŒçš„å¼•æ“åœ¨ä¿å­˜è¡¨çš„ç»“æ„å’Œæ•°æ®æ—¶é‡‡ç”¨ä¸åŒçš„æ–¹å¼ -- MyISAMè¡¨æ–‡ä»¶å«ä¹‰ï¼š.frmè¡¨å®šä¹‰ï¼Œ.MYDè¡¨æ•°æ®ï¼Œ.MYIè¡¨ç´¢å¼• -- InnoDBè¡¨æ–‡ä»¶å«ä¹‰ï¼š.frmè¡¨å®šä¹‰ï¼Œè¡¨ç©ºé—´æ•°æ®å’Œæ—¥å¿—æ–‡ä»¶ &#x2F;* åˆ—å±æ€§ï¼ˆåˆ—çº¦æŸï¼‰ *&#x2F;primary key -- èƒ½å”¯ä¸€æ ‡è¯†è®°å½•çš„å­—æ®µï¼Œå¯ä»¥ä½œä¸ºä¸»é”®ã€‚ -- ä¸€ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªä¸»é”®ã€‚ -- ä¸»é”®å…·æœ‰å”¯ä¸€æ€§ã€‚ -- å£°æ˜å­—æ®µæ—¶ï¼Œç”¨ primary key æ ‡è¯†ã€‚ -- ä¹Ÿå¯ä»¥åœ¨å­—æ®µåˆ—è¡¨ä¹‹åå£°æ˜ -- ä¾‹ï¼šcreate table tab ( id int, stu varchar(10), primary key (id)); -- ä¸»é”®å­—æ®µçš„å€¼ä¸èƒ½ä¸ºnullã€‚ -- ä¸»é”®å¯ä»¥ç”±å¤šä¸ªå­—æ®µå…±åŒç»„æˆã€‚æ­¤æ—¶éœ€è¦åœ¨å­—æ®µåˆ—è¡¨åå£°æ˜çš„æ–¹æ³•ã€‚ -- ä¾‹ï¼šcreate table tab ( id int, stu varchar(10), age int, primary key (stu, age)); åˆ—å±æ€§1234567891011121314151617181920212223242526272829303132333435363738unique -- å”¯ä¸€ç´¢å¼•ï¼ˆå”¯ä¸€çº¦æŸï¼‰-- ä½¿å¾—æŸå­—æ®µçš„å€¼ä¸èƒ½é‡å¤ã€‚null -- çº¦æŸ-- null ä¸æ˜¯æ•°æ®ç±»å‹ï¼Œæ˜¯åˆ—çš„ä¸€ä¸ªå±æ€§ã€‚-- è¡¨ç¤ºå½“å‰åˆ—æ˜¯å¦å¯ä»¥ä¸º nullï¼Œè¡¨ç¤ºä»€ä¹ˆéƒ½æ²¡æœ‰ã€‚ -- null, å…è®¸ä¸ºç©ºã€‚é»˜è®¤ã€‚ -- not null, ä¸å…è®¸ä¸ºç©ºã€‚default -- é»˜è®¤å€¼å±æ€§ï¼Œå½“å‰å­—æ®µçš„é»˜è®¤å€¼ã€‚insert into tab values (default, &#39;val&#39;); -- æ­¤æ—¶è¡¨ç¤ºå¼ºåˆ¶ä½¿ç”¨é»˜è®¤å€¼ã€‚create table tab ( add_time timestamp default current_timestamp ); -- è¡¨ç¤ºå°†å½“å‰æ—¶é—´çš„æ—¶é—´æˆ³è®¾ä¸ºé»˜è®¤å€¼ã€‚-- å¸¸ç”¨é»˜è®¤å€¼ current_date, current_timeauto_increment -- è‡ªåŠ¨å¢é•¿çº¦æŸ-- è‡ªåŠ¨å¢é•¿å¿…é¡»ä¸ºç´¢å¼•ï¼ˆä¸»é”®æˆ–uniqueï¼‰ï¼Œåªèƒ½å­˜åœ¨ä¸€ä¸ªå­—æ®µä¸ºè‡ªåŠ¨å¢é•¿ã€‚-- é»˜è®¤ä¸º 1 å¼€å§‹è‡ªåŠ¨å¢é•¿ã€‚å¯ä»¥é€šè¿‡è¡¨å±æ€§ auto_increment &#x3D; x è¿›è¡Œè®¾ç½®ã€‚-- æˆ– alter table tbl auto_increment &#x3D; xã€‚comment -- æ³¨é‡Š-- ä¾‹ï¼šcreate table tab (id int) comment &#39;æ³¨é‡Šå†…å®¹&#39;;foreign key -- å¤–é”®çº¦æŸï¼Œç”¨äºé™åˆ¶ä¸»è¡¨ä¸ä»è¡¨æ•°æ®å®Œæ•´æ€§ã€‚alter table t1 add constraint &#96;t1_t2_fk&#96; foreign key (t1_id) references t2(id);-- å°†è¡¨ t1 çš„ t1_id å¤–é”®å…³è”åˆ°è¡¨ t2 çš„ id å­—æ®µã€‚-- æ¯ä¸ªå¤–é”®éƒ½æœ‰ä¸€ä¸ªåå­—ï¼Œå¯ä»¥é€šè¿‡ constraint æŒ‡å®š-- å­˜åœ¨å¤–é”®çš„è¡¨ï¼Œç§°ä¹‹ä¸ºä»è¡¨ï¼ˆå­è¡¨ï¼‰ï¼Œå¤–é”®æŒ‡å‘çš„è¡¨ï¼Œç§°ä¹‹ä¸ºä¸»è¡¨ï¼ˆçˆ¶è¡¨ï¼‰ã€‚-- ä½œç”¨ï¼šä¿æŒæ•°æ®ä¸€è‡´æ€§ï¼Œå®Œæ•´æ€§ï¼Œä¸»è¦ç›®çš„æ˜¯æ§åˆ¶å­˜å‚¨åœ¨å¤–é”®è¡¨ï¼ˆä»è¡¨ï¼‰ä¸­çš„æ•°æ®ã€‚-- MySQLä¸­ï¼Œå¯ä»¥å¯¹ InnoDB å¼•æ“ä½¿ç”¨å¤–é”®çº¦æŸï¼šforeign key (å¤–é”®å­—æ®µï¼‰ references ä¸»è¡¨å (å…³è”å­—æ®µ) [ä¸»è¡¨è®°å½•åˆ é™¤æ—¶çš„åŠ¨ä½œ] [ä¸»è¡¨è®°å½•æ›´æ–°æ—¶çš„åŠ¨ä½œ]-- æ­¤æ—¶éœ€è¦æ£€æµ‹ä¸€ä¸ªä»è¡¨çš„å¤–é”®éœ€è¦çº¦æŸä¸ºä¸»è¡¨çš„å·²å­˜åœ¨çš„å€¼ã€‚å¤–é”®åœ¨æ²¡æœ‰å…³è”çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥è®¾ç½®ä¸º nullï¼Œå‰ææ˜¯è¯¥å¤–é”®åˆ—ï¼Œæ²¡æœ‰ not nullã€‚-- å¯ä»¥ä¸æŒ‡å®šä¸»è¡¨è®°å½•æ›´æ”¹æˆ–æ›´æ–°æ—¶çš„åŠ¨ä½œï¼Œé‚£ä¹ˆæ­¤æ—¶ä¸»è¡¨çš„æ“ä½œè¢«æ‹’ç»ã€‚-- å¦‚æœæŒ‡å®šäº† on update æˆ– on deleteï¼šåœ¨åˆ é™¤æˆ–æ›´æ–°æ—¶ï¼Œæœ‰å¦‚ä¸‹å‡ ä¸ªæ“ä½œå¯ä»¥é€‰æ‹©ï¼š -- cascadeï¼Œçº§è”æ“ä½œã€‚ä¸»è¡¨æ•°æ®è¢«æ›´æ–°ï¼ˆä¸»é”®å€¼æ›´æ–°ï¼‰ï¼Œä»è¡¨ä¹Ÿè¢«æ›´æ–°ï¼ˆå¤–é”®å€¼æ›´æ–°ï¼‰ã€‚ä¸»è¡¨è®°å½•è¢«åˆ é™¤ï¼Œä»è¡¨ç›¸å…³è®°å½•ä¹Ÿè¢«åˆ é™¤ã€‚ -- set nullï¼Œè®¾ç½®ä¸ºnullã€‚ä¸»è¡¨æ•°æ®è¢«æ›´æ–°ï¼ˆä¸»é”®å€¼æ›´æ–°ï¼‰ï¼Œä»è¡¨çš„å¤–é”®è¢«è®¾ç½®ä¸ºnullã€‚ä¸»è¡¨è®°å½•è¢«åˆ é™¤ï¼Œä»è¡¨ç›¸å…³è®°å½•å¤–é”®è¢«è®¾ç½®æˆnullã€‚ä½†æ³¨æ„ï¼Œè¦æ±‚è¯¥å¤–é”®åˆ—ï¼Œæ²¡æœ‰not nullå±æ€§çº¦æŸã€‚ -- restrictï¼Œæ‹’ç»çˆ¶è¡¨åˆ é™¤å’Œæ›´æ–°ã€‚-- æ³¨æ„ï¼Œå¤–é”®åªè¢«InnoDBå­˜å‚¨å¼•æ“æ‰€æ”¯æŒã€‚å…¶ä»–å¼•æ“æ˜¯ä¸æ”¯æŒçš„ã€‚ å»ºè¡¨è§„èŒƒ12345678910111213-- Normal Format, NF -- æ¯ä¸ªè¡¨ä¿å­˜ä¸€ä¸ªå®ä½“ä¿¡æ¯ -- æ¯ä¸ªå…·æœ‰ä¸€ä¸ª ID å­—æ®µä½œä¸ºä¸»é”® -- ID ä¸»é”® + åŸå­è¡¨-- 1NF, ç¬¬ä¸€èŒƒå¼ -- å­—æ®µä¸èƒ½å†åˆ†ï¼Œå°±æ»¡è¶³ç¬¬ä¸€èŒƒå¼ã€‚-- 2NF, ç¬¬äºŒèŒƒå¼ -- æ»¡è¶³ç¬¬ä¸€èŒƒå¼çš„å‰æä¸‹ï¼Œä¸èƒ½å‡ºç°éƒ¨åˆ†ä¾èµ–ã€‚ -- æ¶ˆé™¤ç¬¦åˆä¸»é”®å°±å¯ä»¥é¿å…éƒ¨åˆ†ä¾èµ–ã€‚å¢åŠ å•åˆ—å…³é”®å­—ã€‚-- 3NF, ç¬¬ä¸‰èŒƒå¼ -- æ»¡è¶³ç¬¬äºŒèŒƒå¼çš„å‰æä¸‹ï¼Œä¸èƒ½å‡ºç°ä¼ é€’ä¾èµ–ã€‚ -- æŸä¸ªå­—æ®µä¾èµ–äºä¸»é”®ï¼Œè€Œæœ‰å…¶ä»–å­—æ®µä¾èµ–äºè¯¥å­—æ®µã€‚è¿™å°±æ˜¯ä¼ é€’ä¾èµ–ã€‚ -- å°†ä¸€ä¸ªå®ä½“ä¿¡æ¯çš„æ•°æ®æ”¾åœ¨ä¸€ä¸ªè¡¨å†…å®ç°ã€‚ SHOW12345678910111213141516SHOW ENGINES -- æ˜¾ç¤ºå­˜å‚¨å¼•æ“çš„çŠ¶æ€ä¿¡æ¯SHOW ENGINE å¼•æ“å &#123;LOGS|STATUS&#125; -- æ˜¾ç¤ºå­˜å‚¨å¼•æ“çš„æ—¥å¿—æˆ–çŠ¶æ€ä¿¡æ¯ -- æ•°æ®æ–‡ä»¶ç›®å½• DATA DIRECTORY &#x3D; &#39;ç›®å½•&#39; -- ç´¢å¼•æ–‡ä»¶ç›®å½• INDEX DIRECTORY &#x3D; &#39;ç›®å½•&#39; -- è¡¨æ³¨é‡Š COMMENT &#x3D; &#39;string&#39; -- åˆ†åŒºé€‰é¡¹ PARTITION BY ... (è¯¦ç»†è§æ‰‹å†Œ)-- æŸ¥çœ‹æ‰€æœ‰è¡¨SHOW TABLES [LIKE &#39;pattern&#39;]SHOW TABLES FROM è¡¨å-- æŸ¥çœ‹è¡¨ç»“æ„SHOW CREATE TABLE è¡¨å &#x2F; DESC è¡¨å &#x2F; DESCRIBE è¡¨å &#x2F; EXPLAIN è¡¨å &#x2F; SHOW COLUMNS FROM è¡¨å [LIKE &#39;PATTERN&#39;]SHOW TABLE STATUS [FROM db_name] [LIKE &#39;pattern&#39;] ALTER12345678910111213141516171819-- ä¿®æ”¹è¡¨-- ä¿®æ”¹è¡¨æœ¬èº«çš„é€‰é¡¹ ALTER TABLE è¡¨å è¡¨çš„é€‰é¡¹ -- EG: ALTER TABLE è¡¨å ENGINE&#x3D;MYISAM;-- ä¿®æ”¹è¡¨çš„å­—æ®µç»“æ„ALTER TABLE è¡¨å æ“ä½œå -- æ“ä½œå ADD [COLUMN] å­—æ®µå -- å¢åŠ å­—æ®µ AFTER å­—æ®µå -- è¡¨ç¤ºå¢åŠ åœ¨è¯¥å­—æ®µååé¢ FIRST -- è¡¨ç¤ºå¢åŠ åœ¨ç¬¬ä¸€ä¸ª ADD PRIMARY KEY(å­—æ®µå) -- åˆ›å»ºä¸»é”® ADD UNIQUE [ç´¢å¼•å] (å­—æ®µå) -- åˆ›å»ºå”¯ä¸€ç´¢å¼• ADD INDEX [ç´¢å¼•å] (å­—æ®µå) -- åˆ›å»ºæ™®é€šç´¢å¼• DROP [COLUMN] å­—æ®µå -- åˆ é™¤å­—æ®µ MODIFY [COLUMN] å­—æ®µå å­—æ®µå±æ€§ -- æ”¯æŒå¯¹å­—æ®µå±æ€§è¿›è¡Œä¿®æ”¹ï¼Œä¸èƒ½ä¿®æ”¹å­—æ®µå CHANGE [COLUMN] åŸå­—æ®µå æ–°å­—æ®µå å­—æ®µå±æ€§ -- æ”¯æŒå¯¹å­—æ®µåä¿®æ”¹ DROP PRIMARY KEY -- åˆ é™¤ä¸»é”®(åˆ é™¤ä¸»é”®å‰éœ€åˆ é™¤å…¶ AUTO_INCREMENT å±æ€§) DROP INDEX ç´¢å¼•å -- åˆ é™¤ç´¢å¼• DROP FOREIGN KEY å¤–é”® -- åˆ é™¤å¤–é”® SELECT1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556select [all|distinct] select_expr from -&gt; where -&gt; group by [åˆè®¡å‡½æ•°] -&gt; having -&gt; order by -&gt; limit-- select_expr å¯ä»¥ç”¨ * è¡¨ç¤ºæ‰€æœ‰å­—æ®µã€‚select * from tb;-- å¯ä»¥ä½¿ç”¨è¡¨è¾¾å¼ï¼ˆè®¡ç®—å…¬å¼ã€å‡½æ•°è°ƒç”¨ã€å­—æ®µä¹Ÿæ˜¯ä¸ªè¡¨è¾¾å¼ï¼‰select stu, 29+25, now() from tb;-- å¯ä»¥ä¸ºæ¯ä¸ªåˆ—ä½¿ç”¨åˆ«åã€‚é€‚ç”¨äºç®€åŒ–åˆ—æ ‡è¯†ï¼Œé¿å…å¤šä¸ªåˆ—æ ‡è¯†ç¬¦é‡å¤ã€‚-- ä½¿ç”¨ as å…³é”®å­—ï¼Œä¹Ÿå¯çœç•¥ as.select stu+10 as add10 from tb;from -- å­å¥ ç”¨äºæ ‡è¯†æŸ¥è¯¢æ¥æºã€‚-- å¯ä»¥ä¸ºè¡¨èµ·åˆ«åã€‚ä½¿ç”¨aså…³é”®å­—ã€‚select * from tb1 as tt, tb2 as bb;-- fromå­å¥åï¼Œå¯ä»¥åŒæ—¶å‡ºç°å¤šä¸ªè¡¨ã€‚-- å¤šä¸ªè¡¨ä¼šæ¨ªå‘å åŠ åˆ°ä¸€èµ·ï¼Œè€Œæ•°æ®ä¼šå½¢æˆä¸€ä¸ªç¬›å¡å°”ç§¯ã€‚select * from tb1, tb2;where -- å­å¥ -- ä» from è·å¾—çš„æ•°æ®æºä¸­è¿›è¡Œç­›é€‰ã€‚ -- æ•´å‹ 1 è¡¨ç¤ºçœŸï¼Œ0 è¡¨ç¤ºå‡ã€‚ -- è¡¨è¾¾å¼ç”±è¿ç®—ç¬¦å’Œè¿ç®—æ•°ç»„æˆã€‚ -- è¿ç®—æ•°ï¼šå˜é‡ï¼ˆå­—æ®µï¼‰ã€å€¼ã€å‡½æ•°è¿”å›å€¼ -- è¿ç®—ç¬¦ï¼š&#x3D;, &lt;&#x3D;&gt;, &lt;&gt;, !&#x3D;, &lt;&#x3D;, &lt;, &gt;&#x3D;, &gt;, !, &amp;&amp;, ||, -- in (not) null, (not) like, (not) in, (not) between and, is (not), and, or, not, xor -- is&#x2F;is not åŠ ä¸Š ture &#x2F; false &#x2F; unknown æ£€éªŒæŸä¸ªå€¼çš„çœŸå‡ -- &lt;&#x3D;&gt; ä¸ &lt;&gt; åŠŸèƒ½ç›¸åŒï¼Œ&lt;&#x3D;&gt; å¯ç”¨äºnullæ¯”è¾ƒgroup by -- å­å¥, åˆ†ç»„å­å¥group by å­—æ®µ&#x2F;åˆ«å [æ’åºæ–¹å¼]-- åˆ†ç»„åä¼šè¿›è¡Œæ’åºã€‚å‡åºï¼šASCï¼Œé™åºï¼šDESC-- ä»¥ä¸‹ [åˆè®¡å‡½æ•°] éœ€é…åˆ group by ä½¿ç”¨ï¼šgroup by ç›¸å½“äºç»™åˆè®¡å‡½æ•°åˆ’å®šåˆè®¡èŒƒå›´ï¼Œå¦åˆ™ç»Ÿè®¡å…¨å±€æ•°æ® -- count è¿”å›ä¸åŒçš„éNULLå€¼æ•°ç›® count(*)ã€count(å­—æ®µ) -- sum æ±‚å’Œ -- max æ±‚æœ€å¤§å€¼ -- min æ±‚æœ€å°å€¼ -- avg æ±‚å¹³å‡å€¼ -- group_concat è¿”å›å¸¦æœ‰æ¥è‡ªä¸€ä¸ªç»„çš„è¿æ¥çš„é NULL å€¼çš„å­—ç¬¦ä¸²ç»“æœã€‚ç»„å†…å­—ç¬¦ä¸²è¿æ¥ã€‚having -- å­å¥ï¼Œæ¡ä»¶å­å¥ï¼Œä¸ where åŠŸèƒ½ã€ç”¨æ³•ç›¸åŒï¼Œæ‰§è¡Œæ—¶æœºä¸åŒã€‚ -- where åœ¨å¼€å§‹æ—¶æ‰§è¡Œæ£€æµ‹æ•°æ®ï¼Œå¯¹åŸæ•°æ®è¿›è¡Œè¿‡æ»¤ã€‚ -- having å¯¹ç­›é€‰å‡ºçš„ç»“æœå†æ¬¡è¿›è¡Œè¿‡æ»¤ã€‚ -- having å­—æ®µå¿…é¡»æ˜¯æŸ¥è¯¢å‡ºæ¥çš„ï¼Œwhere å­—æ®µå¿…é¡»æ˜¯æ•°æ®è¡¨å­˜åœ¨çš„ã€‚ -- where ä¸å¯ä»¥ä½¿ç”¨å­—æ®µçš„åˆ«åï¼Œhaving å¯ä»¥ã€‚å› ä¸ºæ‰§è¡Œ WHERE ä»£ç æ—¶ï¼Œå¯èƒ½å°šæœªç¡®å®šåˆ—å€¼ã€‚ -- where ä¸å¯ä»¥ä½¿ç”¨åˆè®¡å‡½æ•°ã€‚ä¸€èˆ¬éœ€ç”¨åˆè®¡å‡½æ•°æ‰ä¼šç”¨ having -- SQL æ ‡å‡†è¦æ±‚ HAVING å¿…é¡»å¼•ç”¨ GROUP BY å­å¥ä¸­çš„åˆ—æˆ–ç”¨äºåˆè®¡å‡½æ•°ä¸­çš„åˆ—ã€‚order by -- å­å¥ï¼Œæ’åºå­å¥order by æ’åºå­—æ®µ&#x2F;åˆ«å æ’åºæ–¹å¼ [,æ’åºå­—æ®µ&#x2F;åˆ«å æ’åºæ–¹å¼]...-- å‡åºï¼šASCï¼Œé™åºï¼šDESC æ”¯æŒå¤šä¸ªå­—æ®µçš„æ’åºã€‚limit -- å­å¥ï¼Œé™åˆ¶ç»“æœæ•°é‡å­å¥-- ä»…å¯¹å¤„ç†å¥½çš„ç»“æœè¿›è¡Œæ•°é‡é™åˆ¶ã€‚å°†å¤„ç†å¥½çš„ç»“æœçš„çœ‹ä½œæ˜¯ä¸€ä¸ªé›†åˆï¼ŒæŒ‰ç…§è®°å½•å‡ºç°çš„é¡ºåºï¼Œç´¢å¼•ä» 0 å¼€å§‹ã€‚limit èµ·å§‹ä½ç½®, è·å–æ¡æ•°-- çœç•¥ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè¡¨ç¤ºä»ç´¢å¼• 0 å¼€å§‹ã€‚limit è·å–æ¡æ•°distinct -- distinct å»é™¤é‡å¤è®°å½•ï¼Œé»˜è®¤ä¸º all, å…¨éƒ¨è®°å½• UNION12345678&#x2F;* UNION *&#x2F;-- å°†å¤šä¸ª select æŸ¥è¯¢çš„ç»“æœç»„åˆæˆä¸€ä¸ªç»“æœé›†åˆã€‚SELECT ... UNION [ALL|DISTINCT] SELECT ...-- é»˜è®¤ DISTINCT æ–¹å¼ï¼Œå³æ‰€æœ‰è¿”å›çš„è¡Œéƒ½æ˜¯å”¯ä¸€çš„ã€‚-- å»ºè®®ï¼Œå¯¹æ¯ä¸ªSELECTæŸ¥è¯¢åŠ ä¸Šå°æ‹¬å·åŒ…è£¹ã€‚-- ORDER BY æ’åºæ—¶ï¼Œéœ€åŠ ä¸Š LIMIT è¿›è¡Œç»“åˆã€‚-- éœ€è¦å„ select æŸ¥è¯¢çš„å­—æ®µæ•°é‡ä¸€æ ·ã€‚-- æ¯ä¸ª select æŸ¥è¯¢çš„å­—æ®µåˆ—è¡¨(æ•°é‡ã€ç±»å‹)åº”ä¸€è‡´ï¼Œå› ä¸ºç»“æœä¸­çš„å­—æ®µåä»¥ç¬¬ä¸€æ¡ select è¯­å¥ä¸ºå‡†ã€‚ å­æŸ¥è¯¢1234567891011121314151617181920212223242526272829&#x2F;* å­æŸ¥è¯¢ *&#x2F;-- å­æŸ¥è¯¢éœ€ç”¨æ‹¬å·åŒ…è£¹ã€‚-- fromå‹ -- from åè¦æ±‚æ˜¯ä¸€ä¸ªè¡¨ï¼Œå¿…é¡»ç»™å­æŸ¥è¯¢ç»“æœå–ä¸ªåˆ«åã€‚ -- ç®€åŒ–æ¯ä¸ªæŸ¥è¯¢å†…çš„æ¡ä»¶ã€‚ -- from å‹éœ€å°†ç»“æœç”Ÿæˆä¸€ä¸ªä¸´æ—¶è¡¨æ ¼ï¼Œå¯ç”¨ä»¥åŸè¡¨çš„é”å®šçš„é‡Šæ”¾ã€‚ -- å­æŸ¥è¯¢è¿”å›ä¸€ä¸ªè¡¨ï¼Œè¡¨å‹å­æŸ¥è¯¢ã€‚select * from (select * from tb where id&gt;0) as subfrom where id&gt;1;-- whereå‹ -- å­æŸ¥è¯¢è¿”å›ä¸€ä¸ªå€¼ï¼Œæ ‡é‡å­æŸ¥è¯¢ã€‚ -- ä¸éœ€è¦ç»™å­æŸ¥è¯¢å–åˆ«åã€‚ -- where å­æŸ¥è¯¢å†…çš„è¡¨ï¼Œä¸èƒ½ç›´æ¥ç”¨ä»¥æ›´æ–°ã€‚select * from tb where money &#x3D; (select max(money) from tb);-- åˆ—å­æŸ¥è¯¢ -- å¦‚æœå­æŸ¥è¯¢ç»“æœè¿”å›çš„æ˜¯ä¸€åˆ—ã€‚ -- ä½¿ç”¨ in æˆ– not in å®ŒæˆæŸ¥è¯¢ -- exists å’Œ not exists æ¡ä»¶ -- å¦‚æœå­æŸ¥è¯¢è¿”å›æ•°æ®ï¼Œåˆ™è¿”å› 1 æˆ– 0ã€‚å¸¸ç”¨äºåˆ¤æ–­æ¡ä»¶ã€‚select column1 from t1 where exists (select * from t2);-- è¡Œå­æŸ¥è¯¢ æŸ¥è¯¢æ¡ä»¶æ˜¯ä¸€ä¸ªè¡Œã€‚select * from t1 where (id, gender) in (select id, gender from t2);-- è¡Œæ„é€ ç¬¦ï¼š(col1, col2, ...) æˆ– ROW(col1, col2, ...)-- è¡Œæ„é€ ç¬¦é€šå¸¸ç”¨äºä¸å¯¹èƒ½è¿”å›ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šåˆ—çš„å­æŸ¥è¯¢è¿›è¡Œæ¯”è¾ƒã€‚-- ç‰¹æ®Šè¿ç®—ç¬¦!&#x3D; all() -- ç›¸å½“äº not in&#x3D; some() -- ç›¸å½“äº inï¼Œany æ˜¯ some çš„åˆ«å!&#x3D; some() -- ä¸ç­‰åŒäº not inï¼Œä¸ç­‰äºå…¶ä¸­æŸä¸€ä¸ªã€‚all, some -- å¯ä»¥é…åˆå…¶ä»–è¿ç®—ç¬¦ä¸€èµ·ä½¿ç”¨ã€‚ è¿æ¥æŸ¥è¯¢1234567891011121314151617181920212223242526&#x2F;* è¿æ¥æŸ¥è¯¢(join) *&#x2F; -- å°†å¤šä¸ªè¡¨çš„å­—æ®µè¿›è¡Œè¿æ¥ï¼Œå¯ä»¥æŒ‡å®šè¿æ¥æ¡ä»¶ã€‚-- å†…è¿æ¥(inner join) -- é»˜è®¤å°±æ˜¯å†…è¿æ¥ï¼Œå¯çœç•¥innerã€‚ -- åªæœ‰æ•°æ®å­˜åœ¨æ—¶æ‰èƒ½å‘é€è¿æ¥ã€‚å³è¿æ¥ç»“æœä¸èƒ½å‡ºç°ç©ºè¡Œã€‚ -- on è¡¨ç¤ºè¿æ¥æ¡ä»¶ã€‚å…¶æ¡ä»¶è¡¨è¾¾å¼ä¸whereç±»ä¼¼ã€‚ä¹Ÿå¯ä»¥çœç•¥æ¡ä»¶ï¼ˆè¡¨ç¤ºæ¡ä»¶æ°¸è¿œä¸ºçœŸï¼‰ -- ä¹Ÿå¯ç”¨ where è¡¨ç¤ºè¿æ¥æ¡ä»¶ã€‚ -- è¿˜æœ‰ using, ä½†éœ€å­—æ®µåç›¸åŒã€‚ using (å­—æ®µå)-- äº¤å‰è¿æ¥ cross join å³ï¼Œæ²¡æœ‰æ¡ä»¶çš„å†…è¿æ¥ã€‚select * from tb1 cross join tb2;-- å¤–è¿æ¥(outer join) å¦‚æœæ•°æ®ä¸å­˜åœ¨ï¼Œä¹Ÿä¼šå‡ºç°åœ¨è¿æ¥ç»“æœä¸­ã€‚-- å·¦å¤–è¿æ¥ left join å¦‚æœæ•°æ®ä¸å­˜åœ¨ï¼Œå·¦è¡¨è®°å½•ä¼šå‡ºç°ï¼Œè€Œå³è¡¨ä¸ºnullå¡«å……-- å³å¤–è¿æ¥ right join å¦‚æœæ•°æ®ä¸å­˜åœ¨ï¼Œå³è¡¨è®°å½•ä¼šå‡ºç°ï¼Œè€Œå·¦è¡¨ä¸ºnullå¡«å……-- è‡ªç„¶è¿æ¥(natural join) è‡ªåŠ¨åˆ¤æ–­è¿æ¥æ¡ä»¶å®Œæˆè¿æ¥ã€‚ -- ç›¸å½“äºçœç•¥äº†usingï¼Œä¼šè‡ªåŠ¨æŸ¥æ‰¾ç›¸åŒå­—æ®µåã€‚natural joinnatural left joinnatural right joinselect info.id, info.name, info.stu_num, extra_info.hobby, extra_info.sex from info, extra_info where info.stu_num &#x3D; extra_info.stu_id; INSERT1234567891011121314151617181920&#x2F;* insert *&#x2F;selectè¯­å¥è·å¾—çš„æ•°æ®å¯ä»¥ç”¨insertæ’å…¥ã€‚å¯ä»¥çœç•¥å¯¹åˆ—çš„æŒ‡å®šï¼Œè¦æ±‚ values () æ‹¬å·å†…ï¼Œæä¾›ç»™äº†æŒ‰ç…§åˆ—é¡ºåºå‡ºç°çš„æ‰€æœ‰å­—æ®µçš„å€¼ã€‚ æˆ–è€…ä½¿ç”¨setè¯­æ³•ã€‚ insert into tbl_name set field&#x3D;value,...ï¼›å¯ä»¥ä¸€æ¬¡æ€§ä½¿ç”¨å¤šä¸ªå€¼ï¼Œé‡‡ç”¨(), (), ();çš„å½¢å¼ã€‚ insert into tbl_name values (), (), ();å¯ä»¥åœ¨åˆ—å€¼æŒ‡å®šæ—¶ï¼Œä½¿ç”¨è¡¨è¾¾å¼ã€‚ insert into tbl_name values (field_value, 10+10, now());å¯ä»¥ä½¿ç”¨ä¸€ä¸ªç‰¹æ®Šå€¼ defaultï¼Œè¡¨ç¤ºè¯¥åˆ—ä½¿ç”¨é»˜è®¤å€¼ã€‚ insert into tbl_name values (field_value, default);å¯ä»¥é€šè¿‡ä¸€ä¸ªæŸ¥è¯¢çš„ç»“æœï¼Œä½œä¸ºéœ€è¦æ’å…¥çš„å€¼ã€‚ insert into tbl_name select ...;å¯ä»¥æŒ‡å®šåœ¨æ’å…¥çš„å€¼å‡ºç°ä¸»é”®ï¼ˆæˆ–å”¯ä¸€ç´¢å¼•ï¼‰å†²çªæ—¶ï¼Œæ›´æ–°å…¶ä»–éä¸»é”®åˆ—çš„ä¿¡æ¯ã€‚ insert into tbl_name values&#x2F;set&#x2F;select on duplicate key update å­—æ®µ&#x3D;å€¼, â€¦; DELETE123456789101112131415161718&#x2F;* delete *&#x2F;DELETE FROM tbl_name [WHERE where_definition] [ORDER BY ...] [LIMIT row_count]-- æŒ‰ç…§æ¡ä»¶åˆ é™¤-- æŒ‡å®šåˆ é™¤çš„æœ€å¤šè®°å½•æ•° Limit-- å¯ä»¥é€šè¿‡æ’åºæ¡ä»¶åˆ é™¤ order by + limit-- æ”¯æŒå¤šè¡¨åˆ é™¤ï¼Œä½¿ç”¨ç±»ä¼¼è¿æ¥è¯­æ³•ã€‚delete from éœ€è¦åˆ é™¤æ•°æ®å¤šè¡¨1ï¼Œè¡¨2 using è¡¨è¿æ¥æ“ä½œ æ¡ä»¶ã€‚&#x2F;* truncate *&#x2F;TRUNCATE [TABLE] tbl_name-- æ¸…ç©ºæ•°æ®-- åˆ é™¤é‡å»ºè¡¨-- åŒºåˆ«ï¼š 1ï¼Œtruncate æ˜¯åˆ é™¤è¡¨å†åˆ›å»ºï¼Œdelete æ˜¯é€æ¡åˆ é™¤ 2ï¼Œtruncate é‡ç½® auto_increment çš„å€¼ã€‚è€Œ delete ä¸ä¼š 3ï¼Œtruncate ä¸çŸ¥é“åˆ é™¤äº†å‡ æ¡ï¼Œè€Œ delete çŸ¥é“ã€‚ 4ï¼Œå½“è¢«ç”¨äºå¸¦åˆ†åŒºçš„è¡¨æ—¶ï¼Œtruncate ä¼šä¿ç•™åˆ†åŒº Other12345678910111213141516171819202122232425262728-- å¯¹è¡¨è¿›è¡Œé‡å‘½åRENAME TABLE åŸè¡¨å TO æ–°è¡¨åRENAME TABLE åŸè¡¨å TO åº“å.è¡¨å -- å¯å°†è¡¨ç§»åŠ¨åˆ°å¦ä¸€ä¸ªæ•°æ®åº“-- åˆ é™¤è¡¨ DROP TABLE [IF EXISTS] è¡¨å-- æ¸…ç©ºè¡¨æ•°æ® TRUNCATE [TABLE] è¡¨å-- å¤åˆ¶è¡¨ç»“æ„ CREATE TABLE è¡¨å LIKE è¦å¤åˆ¶çš„è¡¨å-- å¤åˆ¶è¡¨ç»“æ„å’Œæ•°æ® CREATE TABLE è¡¨å [AS] SELECT * FROM è¦å¤åˆ¶çš„è¡¨å-- æ£€æŸ¥è¡¨æ˜¯å¦æœ‰é”™è¯¯ CHECK TABLE tbl_name [, tbl_name] ... [option] ...-- ä¼˜åŒ–è¡¨ OPTIMIZE [LOCAL | NO_WRITE_TO_BINLOG] TABLE tbl_name [, tbl_name] ...-- ä¿®å¤è¡¨ REPAIR [LOCAL | NO_WRITE_TO_BINLOG] TABLE tbl_name [, tbl_name] ... [QUICK] [EXTENDED] [USE_FRM]-- åˆ†æè¡¨ ANALYZE [LOCAL | NO_WRITE_TO_BINLOG] TABLE tbl_name [, tbl_name] ...&#x2F;* è¡¨ç»´æŠ¤ *&#x2F;-- åˆ†æå’Œå­˜å‚¨è¡¨çš„å…³é”®å­—åˆ†å¸ƒANALYZE [LOCAL | NO_WRITE_TO_BINLOG] TABLE è¡¨å ...-- æ£€æŸ¥ä¸€ä¸ªæˆ–å¤šä¸ªè¡¨æ˜¯å¦æœ‰é”™è¯¯CHECK TABLE tbl_name [, tbl_name] ... [option] ...option &#x3D; &#123;QUICK | FAST | MEDIUM | EXTENDED | CHANGED&#125;-- æ•´ç†æ•°æ®æ–‡ä»¶çš„ç¢ç‰‡OPTIMIZE [LOCAL | NO_WRITE_TO_BINLOG] TABLE tbl_name [, tbl_name] ... æ•°æ®æ“ä½œ123456789101112131415-- å¢INSERT [INTO] è¡¨å [(å­—æ®µåˆ—è¡¨)] VALUES [(å€¼åˆ—è¡¨)] -- å¦‚æœè¦æ’å…¥çš„å€¼åˆ—è¡¨åŒ…å«æ‰€æœ‰å­—æ®µå¹¶ä¸”é¡ºåºä¸€è‡´ï¼Œåˆ™å¯ä»¥çœç•¥å­—æ®µåˆ—è¡¨ã€‚ -- å¯åŒæ—¶æ’å…¥å¤šæ¡æ•°æ®è®°å½• -- REPLACE ä¸ INSERT å®Œå…¨ä¸€æ ·ï¼Œå¯äº’æ¢ã€‚INSERT [INTO] è¡¨å SET å­—æ®µå&#x3D;å€¼[, å­—æ®µå&#x3D;å€¼, ...]-- æŸ¥SELECT å­—æ®µåˆ—è¡¨ FROM è¡¨å [å…¶ä»–å­å¥] -- å¯æ¥è‡ªå¤šä¸ªè¡¨çš„å¤šä¸ªå­—æ®µ -- å…¶ä»–å­å¥å¯ä»¥ä¸ä½¿ç”¨ -- å­—æ®µåˆ—è¡¨å¯ä»¥ç”¨ * ä»£æ›¿ï¼Œè¡¨ç¤ºæ‰€æœ‰å­—æ®µ-- åˆ  DELETE FROM è¡¨å [åˆ é™¤æ¡ä»¶å­å¥]-- æ”¹ UPDATE è¡¨å SET å­—æ®µå&#x3D;æ–°å€¼[, å­—æ®µå&#x3D;æ–°å€¼] [æ›´æ–°æ¡ä»¶] å­—ç¬¦é›†ç¼–ç 123456789101112131415-- æ•°æ®ç¼–ç ä¸å®¢æˆ·ç«¯ç¼–ç ä¸éœ€ä¸€è‡´SHOW VARIABLES LIKE &#39;character_set_%&#39; -- æŸ¥çœ‹æ‰€æœ‰å­—ç¬¦é›†ç¼–ç é¡¹ -- character_set_client å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€æ•°æ®æ—¶ä½¿ç”¨çš„ç¼–ç  -- character_set_results æœåŠ¡å™¨ç«¯å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯æ‰€ä½¿ç”¨çš„ç¼–ç  -- character_set_connection è¿æ¥å±‚ç¼–ç -- SET å˜é‡å &#x3D; å˜é‡å€¼set character_set_client &#x3D; gbk;set character_set_results &#x3D; gbk;set character_set_connection &#x3D; gbk;SET NAMES GBK; -- ç›¸å½“äºå®Œæˆä»¥ä¸Šä¸‰ä¸ªè®¾ç½®-- æ ¡å¯¹é›† æ ¡å¯¹é›†ç”¨ä»¥æ’åºSHOW CHARACTER SET [LIKE &#39;pattern&#39;] &#x2F; SHOW CHARSET [LIKE &#39;pattern&#39;] -- æŸ¥çœ‹æ‰€æœ‰å­—ç¬¦é›†SHOW COLLATION [LIKE &#39;pattern&#39;] -- æŸ¥çœ‹æ‰€æœ‰æ ¡å¯¹é›†-- charset å­—ç¬¦é›†ç¼–ç  è®¾ç½®å­—ç¬¦é›†ç¼–ç -- collate æ ¡å¯¹é›†ç¼–ç  è®¾ç½®æ ¡å¯¹é›†ç¼–ç  æ•°å€¼ç±»å‹æ•´å‹12345678910111213ç±»å‹ å­—èŠ‚ èŒƒå›´ï¼ˆæœ‰ç¬¦å·ä½ï¼‰tinyint 1å­—èŠ‚ -128 ~ 127 æ— ç¬¦å·ä½ï¼š0 ~ 255smallint 2å­—èŠ‚ -32768 ~ 32767mediumint 3å­—èŠ‚ -8388608 ~ 8388607int 4å­—èŠ‚bigint 8å­—èŠ‚int(M) -- Mè¡¨ç¤ºæ€»ä½æ•°-- é»˜è®¤å­˜åœ¨ç¬¦å·ä½ï¼Œunsigned å±æ€§ä¿®æ”¹-- æ˜¾ç¤ºå®½åº¦ï¼Œå¦‚æœæŸä¸ªæ•°ä¸å¤Ÿå®šä¹‰å­—æ®µæ—¶è®¾ç½®çš„ä½æ•°ï¼Œåˆ™å‰é¢ä»¥ 0 è¡¥å¡«ï¼Œzerofill å±æ€§ä¿®æ”¹int(5) -- æ’å…¥ä¸€ä¸ªæ•°&#39;123&#39;ï¼Œè¡¥å¡«åä¸º&#39;00123&#39;-- åœ¨æ»¡è¶³è¦æ±‚çš„æƒ…å†µä¸‹ï¼Œè¶Šå°è¶Šå¥½ã€‚-- 1 è¡¨ç¤º bool å€¼çœŸï¼Œ0 è¡¨ç¤º bool å€¼å‡ã€‚MySQL æ²¡æœ‰å¸ƒå°”ç±»å‹ï¼Œé€šè¿‡æ•´å‹ 0 å’Œ 1 è¡¨ç¤ºã€‚å¸¸ç”¨ tinyint(1) è¡¨ç¤ºå¸ƒå°”å‹ã€‚ æµ®ç‚¹å‹1234567891011121314ç±»å‹ å­—èŠ‚float(å•ç²¾åº¦) 4å­—èŠ‚double(åŒç²¾åº¦) 8å­—èŠ‚-- æµ®ç‚¹å‹æ—¢æ”¯æŒç¬¦å·ä½ unsigned å±æ€§ï¼Œä¹Ÿæ”¯æŒæ˜¾ç¤ºå®½åº¦ zerofill å±æ€§ã€‚-- ä¸åŒäºæ•´å‹ï¼Œå‰åå‡ä¼šè¡¥å¡«0.-- å®šä¹‰æµ®ç‚¹å‹æ—¶ï¼Œéœ€æŒ‡å®šæ€»ä½æ•°å’Œå°æ•°ä½æ•°ã€‚float(M, D) double(M, D)-- M è¡¨ç¤ºæ€»ä½æ•°ï¼ŒD è¡¨ç¤ºå°æ•°ä½æ•°ã€‚-- M å’Œ D çš„å¤§å°ä¼šå†³å®šæµ®ç‚¹æ•°çš„èŒƒå›´ã€‚ä¸åŒäºæ•´å‹çš„å›ºå®šèŒƒå›´ã€‚-- M æ—¢è¡¨ç¤ºæ€»ä½æ•°ï¼ˆä¸åŒ…æ‹¬å°æ•°ç‚¹å’Œæ­£è´Ÿå·ï¼‰ï¼Œä¹Ÿè¡¨ç¤ºæ˜¾ç¤ºå®½åº¦ï¼ˆæ‰€æœ‰æ˜¾ç¤ºç¬¦å·å‡åŒ…æ‹¬ï¼‰ã€‚-- æ”¯æŒç§‘å­¦è®¡æ•°æ³•è¡¨ç¤ºã€‚-- æµ®ç‚¹æ•°è¡¨ç¤ºè¿‘ä¼¼å€¼ã€‚ å®šç‚¹æ•°1234decimal -- å¯å˜é•¿åº¦decimal(M, D) -- Mä¹Ÿè¡¨ç¤ºæ€»ä½æ•°ï¼ŒDè¡¨ç¤ºå°æ•°ä½æ•°ã€‚-- ä¿å­˜ä¸€ä¸ªç²¾ç¡®çš„æ•°å€¼ï¼Œä¸ä¼šå‘ç”Ÿæ•°æ®çš„æ”¹å˜ï¼Œä¸åŒäºæµ®ç‚¹æ•°çš„å››èˆäº”å…¥ã€‚-- å°†æµ®ç‚¹æ•°è½¬æ¢ä¸ºå­—ç¬¦ä¸²æ¥ä¿å­˜ï¼Œæ¯ 9 ä½æ•°å­—ä¿å­˜ä¸º 4 ä¸ªå­—èŠ‚ã€‚ å­—ç¬¦ä¸²1234567891011121314151617181920212223242526-- a. char, varchar ----------char -- å®šé•¿å­—ç¬¦ä¸²ï¼Œé€Ÿåº¦å¿«ï¼Œä½†æµªè´¹ç©ºé—´varchar -- å˜é•¿å­—ç¬¦ä¸²ï¼Œé€Ÿåº¦æ…¢ï¼Œä½†èŠ‚çœç©ºé—´-- M è¡¨ç¤ºèƒ½å­˜å‚¨çš„æœ€å¤§é•¿åº¦ï¼Œæ­¤é•¿åº¦æ˜¯å­—ç¬¦æ•°ï¼Œéå­—èŠ‚æ•°ã€‚-- ä¸åŒçš„ç¼–ç ï¼Œæ‰€å ç”¨çš„ç©ºé—´ä¸åŒã€‚ -- char æœ€å¤š 255 ä¸ªå­—ç¬¦ï¼Œä¸ç¼–ç æ— å…³ã€‚ -- varchar æœ€å¤š 65535 å­—ç¬¦ï¼Œä¸ç¼–ç æœ‰å…³ã€‚-- ä¸€æ¡æœ‰æ•ˆè®°å½•æœ€å¤§ä¸èƒ½è¶…è¿‡65535ä¸ªå­—èŠ‚ã€‚-- utf8 æœ€å¤§ä¸º 21844 ä¸ªå­—ç¬¦ï¼Œgbk æœ€å¤§ä¸º 32766 ä¸ªå­—ç¬¦ï¼Œlatin1 æœ€å¤§ä¸º 65532 ä¸ªå­—ç¬¦-- varchar æ˜¯å˜é•¿çš„ï¼Œéœ€è¦åˆ©ç”¨å­˜å‚¨ç©ºé—´ä¿å­˜ varchar çš„é•¿åº¦ï¼Œå¦‚æœæ•°æ®å°äº 255 ä½ï¼Œåˆ™é‡‡ç”¨ä¸€ä¸ªå­—èŠ‚æ¥ä¿å­˜é•¿åº¦ï¼Œåä¹‹éœ€è¦ä¸¤ä¸ªå­—èŠ‚æ¥ä¿å­˜ã€‚-- varchar çš„æœ€å¤§æœ‰æ•ˆé•¿åº¦ç”±æœ€å¤§è¡Œå¤§å°å’Œä½¿ç”¨çš„å­—ç¬¦é›†ç¡®å®šã€‚-- æœ€å¤§æœ‰æ•ˆé•¿åº¦æ˜¯ 65532 å­—èŠ‚ï¼Œå› ä¸ºåœ¨ varchar å­˜å­—ç¬¦ä¸²æ—¶ï¼Œç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯ç©ºçš„ï¼Œä¸å­˜åœ¨ä»»ä½•æ•°æ®ï¼Œç„¶åè¿˜éœ€ä¸¤ä¸ªå­—èŠ‚æ¥å­˜æ”¾å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œæ‰€ä»¥æœ‰æ•ˆé•¿åº¦æ˜¯ 64432-1-2&#x3D;65532 å­—èŠ‚ã€‚-- ä¾‹ï¼šè‹¥ä¸€ä¸ªè¡¨å®šä¹‰ä¸º CREATE TABLE tb(c1 int, c2 char(30), c3 varchar(N)) charset&#x3D;utf8; é—® N çš„æœ€å¤§å€¼æ˜¯å¤šå°‘ï¼Ÿ -- ç­”ï¼šMySQLå®šä¹‰è¡Œçš„é•¿åº¦ä¸èƒ½è¶…è¿‡65535ï¼Œ(65535-1-2-4-30*3)&#x2F;3-- b. blob, text ----------blob -- äºŒè¿›åˆ¶å­—ç¬¦ä¸²ï¼ˆå­—èŠ‚å­—ç¬¦ä¸²ï¼‰tinyblob, blob, mediumblob, longblobtext -- éäºŒè¿›åˆ¶å­—ç¬¦ä¸²ï¼ˆå­—ç¬¦å­—ç¬¦ä¸²ï¼‰tinytext, text, mediumtext, longtexttext -- åœ¨å®šä¹‰æ—¶ï¼Œä¸éœ€è¦å®šä¹‰é•¿åº¦ï¼Œä¹Ÿä¸ä¼šè®¡ç®—æ€»é•¿åº¦ã€‚text -- ç±»å‹åœ¨å®šä¹‰æ—¶ï¼Œä¸å¯ç»™ default å€¼-- c. binary, varbinary ------------ ç±»ä¼¼äº char å’Œ varcharï¼Œç”¨äºä¿å­˜äºŒè¿›åˆ¶å­—ç¬¦ä¸²ï¼Œä¹Ÿå°±æ˜¯ä¿å­˜å­—èŠ‚å­—ç¬¦ä¸²è€Œéå­—ç¬¦å­—ç¬¦ä¸²ã€‚-- char, varchar, text å¯¹åº” binary, varbinary, blob. æ—¥æœŸç±»å‹123456789101112-- ä¸€èˆ¬ç”¨æ•´å‹ä¿å­˜æ—¶é—´æˆ³ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„å°†æ—¶é—´æˆ³è¿›è¡Œæ ¼å¼åŒ–ã€‚datetime 8å­—èŠ‚ æ—¥æœŸåŠæ—¶é—´ 1000-01-01 00:00:00 åˆ° 9999-12-31 23:59:59date 3å­—èŠ‚ æ—¥æœŸ 1000-01-01 åˆ° 9999-12-31timestamp 4å­—èŠ‚ æ—¶é—´æˆ³ 1970-01-01 00:00:00 åˆ° 2038-01-19 03:14:07time 3å­—èŠ‚ æ—¶é—´ -838:59:59 åˆ° 838:59:59year 1å­—èŠ‚ å¹´ä»½ 1901 - 2155datetime â€œYYYY-MM-DD hh:mm:ssâ€timestamp â€œYYYY-MM-DD hh:mm:ssâ€date â€œYYYY-MM-DDâ€time â€œhh:mm:ssâ€year â€œYYYYâ€ æšä¸¾å’Œé›†åˆ1234567891011121314-- æšä¸¾(enum) ----------enum(val1, val2, val3...)-- åœ¨å·²çŸ¥çš„å€¼ä¸­è¿›è¡Œå•é€‰ã€‚æœ€å¤§æ•°é‡ä¸º 65535ã€‚-- æšä¸¾å€¼åœ¨ä¿å­˜æ—¶ï¼Œä»¥ 2 ä¸ªå­—èŠ‚çš„æ•´å‹ (smallint) ä¿å­˜ã€‚æ¯ä¸ªæšä¸¾å€¼ï¼ŒæŒ‰ä¿å­˜çš„ä½ç½®é¡ºåºï¼Œä» 1 å¼€å§‹é€ä¸€é€’å¢ã€‚-- è¡¨ç°ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼Œå­˜å‚¨å´æ˜¯æ•´å‹ã€‚-- NULL å€¼çš„ç´¢å¼•æ˜¯ NULLã€‚-- ç©ºå­—ç¬¦ä¸²é”™è¯¯å€¼çš„ç´¢å¼•å€¼æ˜¯ 0ã€‚-- é›†åˆï¼ˆsetï¼‰ ----------set(val1, val2, val3...)create table tab ( gender set(&#39;ç”·&#39;, &#39;å¥³&#39;, &#39;æ— &#39;) );insert into tab values (&#39;ç”·, å¥³&#39;);-- æœ€å¤šå¯ä»¥æœ‰ 64 ä¸ªä¸åŒçš„æˆå‘˜ã€‚ä»¥ bigint å­˜å‚¨ï¼Œå…± 8 ä¸ªå­—èŠ‚ã€‚é‡‡å–ä½è¿ç®—çš„å½¢å¼ã€‚-- å½“åˆ›å»ºè¡¨æ—¶ï¼ŒSET æˆå‘˜å€¼çš„å°¾éƒ¨ç©ºæ ¼å°†è‡ªåŠ¨è¢«åˆ é™¤ã€‚ å†…ç½®å‡½æ•°12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061-- å†…ç½®å‡½æ•° ------------ æ•°å€¼å‡½æ•°abs(x) -- ç»å¯¹å€¼ abs(-10.9) &#x3D; 10format(x, d) -- æ ¼å¼åŒ–åƒåˆ†ä½æ•°å€¼ format(1234567.456, 2) &#x3D; 1,234,567.46ceil(x) -- å‘ä¸Šå–æ•´ ceil(10.1) &#x3D; 11floor(x) -- å‘ä¸‹å–æ•´ floor (10.1) &#x3D; 10round(x) -- å››èˆäº”å…¥å»æ•´mod(m, n) -- m%n m mod n æ±‚ä½™ 10%3&#x3D;1pi() -- è·å¾—åœ†å‘¨ç‡pow(m, n) -- m^nsqrt(x) -- ç®—æœ¯å¹³æ–¹æ ¹rand() -- éšæœºæ•°truncate(x, d) -- æˆªå–dä½å°æ•°-- æ—¶é—´æ—¥æœŸå‡½æ•°now(), current_timestamp(); -- å½“å‰æ—¥æœŸæ—¶é—´current_date(); -- å½“å‰æ—¥æœŸcurrent_time(); -- å½“å‰æ—¶é—´date(&#39;yyyy-mm-dd hh:ii:ss&#39;); -- è·å–æ—¥æœŸéƒ¨åˆ†time(&#39;yyyy-mm-dd hh:ii:ss&#39;); -- è·å–æ—¶é—´éƒ¨åˆ†date_format(&#39;yyyy-mm-dd hh:ii:ss&#39;, &#39;%d %y %a %d %m %b %j&#39;); -- æ ¼å¼åŒ–æ—¶é—´unix_timestamp(); -- è·å¾—unixæ—¶é—´æˆ³from_unixtime(); -- ä»æ—¶é—´æˆ³è·å¾—æ—¶é—´-- å­—ç¬¦ä¸²å‡½æ•°length(string) -- stringé•¿åº¦ï¼Œå­—èŠ‚char_length(string) -- stringçš„å­—ç¬¦ä¸ªæ•°substring(str, position [,length]) -- ä»strçš„positionå¼€å§‹,å–lengthä¸ªå­—ç¬¦replace(str ,search_str ,replace_str) -- åœ¨strä¸­ç”¨replace_stræ›¿æ¢search_strinstr(string ,substring) -- è¿”å›substringé¦–æ¬¡åœ¨stringä¸­å‡ºç°çš„ä½ç½®concat(string [,...]) -- è¿æ¥å­—ä¸²charset(str) -- è¿”å›å­—ä¸²å­—ç¬¦é›†lcase(string) -- è½¬æ¢æˆå°å†™left(string, length) -- ä»string2ä¸­çš„å·¦è¾¹èµ·å–lengthä¸ªå­—ç¬¦load_file(file_name) -- ä»æ–‡ä»¶è¯»å–å†…å®¹locate(substring, string [,start_position]) -- åŒinstr,ä½†å¯æŒ‡å®šå¼€å§‹ä½ç½®lpad(string, length, pad) -- é‡å¤ç”¨padåŠ åœ¨stringå¼€å¤´,ç›´åˆ°å­—ä¸²é•¿åº¦ä¸ºlengthltrim(string) -- å»é™¤å‰ç«¯ç©ºæ ¼repeat(string, count) -- é‡å¤countæ¬¡rpad(string, length, pad) --åœ¨stråç”¨padè¡¥å……,ç›´åˆ°é•¿åº¦ä¸ºlengthrtrim(string) -- å»é™¤åç«¯ç©ºæ ¼strcmp(string1 ,string2) -- é€å­—ç¬¦æ¯”è¾ƒä¸¤å­—ä¸²å¤§å°-- æµç¨‹å‡½æ•°case when [condition] then result [when [condition] then result ...] [else result] end å¤šåˆ†æ”¯if(expr1,expr2,expr3) åŒåˆ†æ”¯ã€‚-- èšåˆå‡½æ•°count()sum();max();min();avg();group_concat()-- å­—ç¬¦è¿æ¥å‡½æ•°concat(str1[, str2,...])-- å…¶ä»–å¸¸ç”¨å‡½æ•°md5();default(); è§†å›¾123456789101112131415161718192021222324252627282930313233343536&#x2F;* è§†å›¾ *&#x2F;ä»€ä¹ˆæ˜¯è§†å›¾ï¼š è§†å›¾æ˜¯ä¸€ä¸ªè™šæ‹Ÿè¡¨ï¼Œå…¶å†…å®¹ç”±æŸ¥è¯¢å®šä¹‰ã€‚åŒçœŸå®çš„è¡¨ä¸€æ ·ï¼Œè§†å›¾åŒ…å«ä¸€ç³»åˆ—å¸¦æœ‰åç§°çš„åˆ—å’Œè¡Œæ•°æ®ã€‚ä½†æ˜¯ï¼Œè§†å›¾å¹¶ä¸åœ¨æ•°æ®åº“ä¸­ä»¥å­˜å‚¨çš„æ•°æ®å€¼é›†å½¢å¼å­˜åœ¨ã€‚è¡Œå’Œåˆ—æ•°æ®æ¥è‡ªç”±å®šä¹‰è§†å›¾çš„æŸ¥è¯¢æ‰€å¼•ç”¨çš„è¡¨ï¼Œå¹¶ä¸”åœ¨å¼•ç”¨è§†å›¾æ—¶åŠ¨æ€ç”Ÿæˆã€‚ è§†å›¾å…·æœ‰è¡¨ç»“æ„æ–‡ä»¶ï¼Œä½†ä¸å­˜åœ¨æ•°æ®æ–‡ä»¶ã€‚ å¯¹å…¶ä¸­æ‰€å¼•ç”¨çš„åŸºç¡€è¡¨æ¥è¯´ï¼Œè§†å›¾çš„ä½œç”¨ç±»ä¼¼äºç­›é€‰ã€‚å®šä¹‰è§†å›¾çš„ç­›é€‰å¯ä»¥æ¥è‡ªå½“å‰æˆ–å…¶å®ƒæ•°æ®åº“çš„ä¸€ä¸ªæˆ–å¤šä¸ªè¡¨ï¼Œæˆ–è€…å…¶å®ƒè§†å›¾ã€‚é€šè¿‡è§†å›¾è¿›è¡ŒæŸ¥è¯¢æ²¡æœ‰ä»»ä½•é™åˆ¶ï¼Œé€šè¿‡å®ƒä»¬è¿›è¡Œæ•°æ®ä¿®æ”¹æ—¶çš„é™åˆ¶ä¹Ÿå¾ˆå°‘ã€‚ è§†å›¾æ˜¯å­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„æŸ¥è¯¢çš„ sql è¯­å¥ï¼Œå®ƒä¸»è¦å‡ºäºä¸¤ç§åŸå› ï¼šå®‰å…¨åŸå› ï¼Œè§†å›¾å¯ä»¥éšè—ä¸€äº›æ•°æ®ï¼Œå¦‚ï¼šç¤¾ä¼šä¿é™©åŸºé‡‘è¡¨ï¼Œå¯ä»¥ç”¨è§†å›¾åªæ˜¾ç¤ºå§“åï¼Œåœ°å€ï¼Œè€Œä¸æ˜¾ç¤ºç¤¾ä¼šä¿é™©å·å’Œå·¥èµ„æ•°ç­‰ï¼Œå¦ä¸€åŸå› æ˜¯å¯ä½¿å¤æ‚çš„æŸ¥è¯¢æ˜“äºç†è§£å’Œä½¿ç”¨ã€‚-- åˆ›å»ºè§†å›¾CREATE [OR REPLACE] [ALGORITHM &#x3D; &#123;UNDEFINED | MERGE | TEMPTABLE&#125;] VIEW view_name [(column_list)] AS select_statement - è§†å›¾åå¿…é¡»å”¯ä¸€ï¼ŒåŒæ—¶ä¸èƒ½ä¸è¡¨é‡åã€‚ - è§†å›¾å¯ä»¥ä½¿ç”¨ select è¯­å¥æŸ¥è¯¢åˆ°çš„åˆ—åï¼Œä¹Ÿå¯ä»¥è‡ªå·±æŒ‡å®šç›¸åº”çš„åˆ—åã€‚ - å¯ä»¥æŒ‡å®šè§†å›¾æ‰§è¡Œçš„ç®—æ³•ï¼Œé€šè¿‡ ALGORITHM æŒ‡å®šã€‚ - column_list å¦‚æœå­˜åœ¨ï¼Œåˆ™æ•°ç›®å¿…é¡»ç­‰äº SELECT è¯­å¥æ£€ç´¢çš„åˆ—æ•°-- æŸ¥çœ‹ç»“æ„ SHOW CREATE VIEW view_name -- åˆ é™¤è§†å›¾ - åˆ é™¤è§†å›¾åï¼Œæ•°æ®ä¾ç„¶å­˜åœ¨ã€‚ - å¯åŒæ—¶åˆ é™¤å¤šä¸ªè§†å›¾ã€‚ DROP VIEW [IF EXISTS] view_name ...-- ä¿®æ”¹è§†å›¾ç»“æ„ - ä¸€èˆ¬ä¸ä¿®æ”¹è§†å›¾ï¼Œå› ä¸ºä¸æ˜¯æ‰€æœ‰çš„æ›´æ–°è§†å›¾éƒ½ä¼šæ˜ å°„åˆ°è¡¨ä¸Šã€‚ ALTER VIEW view_name [(column_list)] AS select_statement-- è§†å›¾ä½œç”¨ 1. ç®€åŒ–ä¸šåŠ¡é€»è¾‘ 2. å¯¹å®¢æˆ·ç«¯éšè—çœŸå®çš„è¡¨ç»“æ„-- è§†å›¾ç®—æ³•(ALGORITHM) MERGE åˆå¹¶ å°†è§†å›¾çš„æŸ¥è¯¢è¯­å¥ï¼Œä¸å¤–éƒ¨æŸ¥è¯¢éœ€è¦å…ˆåˆå¹¶å†æ‰§è¡Œï¼ TEMPTABLE ä¸´æ—¶è¡¨ å°†è§†å›¾æ‰§è¡Œå®Œæ¯•åï¼Œå½¢æˆä¸´æ—¶è¡¨ï¼Œå†åšå¤–å±‚æŸ¥è¯¢ï¼ UNDEFINED æœªå®šä¹‰(é»˜è®¤)ï¼ŒæŒ‡çš„æ˜¯MySQLè‡ªä¸»å»é€‰æ‹©ç›¸åº”çš„ç®—æ³•ã€‚ äº‹åŠ¡1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950&#x2F;* äº‹åŠ¡(transaction) *&#x2F; ------------------äº‹åŠ¡æ˜¯æŒ‡é€»è¾‘ä¸Šçš„ä¸€ç»„æ“ä½œï¼Œç»„æˆè¿™ç»„æ“ä½œçš„å„ä¸ªå•å…ƒï¼Œè¦ä¸å…¨æˆåŠŸè¦ä¸å…¨å¤±è´¥ã€‚ - æ”¯æŒè¿ç»­ SQL çš„é›†ä½“æˆåŠŸæˆ–é›†ä½“æ’¤é”€ã€‚ - äº‹åŠ¡æ˜¯æ•°æ®åº“åœ¨æ•°æ®å®Œæ•´æ€§æ–¹é¢çš„ä¸€ä¸ªåŠŸèƒ½ã€‚ - éœ€è¦åˆ©ç”¨ InnoDB æˆ– BDB å­˜å‚¨å¼•æ“ï¼Œå¯¹è‡ªåŠ¨æäº¤çš„ç‰¹æ€§æ”¯æŒå®Œæˆã€‚ - InnoDB è¢«ç§°ä¸ºäº‹åŠ¡å®‰å…¨å‹å¼•æ“ã€‚-- äº‹åŠ¡å¼€å¯ å¼€å¯äº‹åŠ¡åï¼Œæ‰€æœ‰è¢«æ‰§è¡Œçš„ SQL è¯­å¥å‡è¢«è®¤ä½œå½“å‰äº‹åŠ¡å†…çš„ SQL è¯­å¥ã€‚ START TRANSACTION; &#x2F; BEGIN;-- äº‹åŠ¡æäº¤ COMMIT;-- äº‹åŠ¡å›æ»š å¦‚æœéƒ¨åˆ†æ“ä½œå‘ç”Ÿé—®é¢˜ï¼Œæ˜ å°„åˆ°äº‹åŠ¡å¼€å¯å‰ã€‚ ROLLBACK;-- äº‹åŠ¡çš„ç‰¹æ€§ ACID 1. åŸå­æ€§ï¼ˆAtomicityï¼‰ äº‹åŠ¡æ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½ï¼Œäº‹åŠ¡ä¸­çš„æ“ä½œè¦ä¹ˆéƒ½å‘ç”Ÿï¼Œè¦ä¹ˆéƒ½ä¸å‘ç”Ÿã€‚ 2. ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ äº‹åŠ¡å‰åæ•°æ®çš„å®Œæ•´æ€§å¿…é¡»ä¿æŒä¸€è‡´ã€‚ - äº‹åŠ¡å¼€å§‹å’Œç»“æŸæ—¶ï¼Œå¤–éƒ¨æ•°æ®ä¸€è‡´ - åœ¨æ•´ä¸ªäº‹åŠ¡è¿‡ç¨‹ä¸­ï¼Œæ“ä½œæ˜¯è¿ç»­çš„ 3. éš”ç¦»æ€§ï¼ˆIsolationï¼‰ å¤šä¸ªç”¨æˆ·å¹¶å‘è®¿é—®æ•°æ®åº“æ—¶ï¼Œä¸€ä¸ªç”¨æˆ·çš„äº‹åŠ¡ä¸èƒ½è¢«å…¶å®ƒç”¨æˆ·çš„äº‹ç‰©æ‰€å¹²æ‰°ï¼Œå¤šä¸ªå¹¶å‘äº‹åŠ¡ä¹‹é—´çš„æ•°æ®è¦ç›¸äº’éš”ç¦»ã€‚ 4. æŒä¹…æ€§ï¼ˆDurabilityï¼‰ ä¸€ä¸ªäº‹åŠ¡ä¸€æ—¦è¢«æäº¤ï¼Œå®ƒå¯¹æ•°æ®åº“ä¸­çš„æ•°æ®æ”¹å˜å°±æ˜¯æ°¸ä¹…æ€§çš„ã€‚-- äº‹åŠ¡çš„å®ç° 1. è¦æ±‚æ˜¯äº‹åŠ¡æ”¯æŒçš„è¡¨ç±»å‹ 2. æ‰§è¡Œä¸€ç»„ç›¸å…³çš„æ“ä½œå‰å¼€å¯äº‹åŠ¡ 3. æ•´ç»„æ“ä½œå®Œæˆåï¼Œéƒ½æˆåŠŸï¼Œåˆ™æäº¤ï¼›å¦‚æœå­˜åœ¨å¤±è´¥ï¼Œé€‰æ‹©å›æ»šï¼Œåˆ™ä¼šå›åˆ°äº‹åŠ¡å¼€å§‹çš„å¤‡ä»½ç‚¹ã€‚-- äº‹åŠ¡çš„åŸç† åˆ©ç”¨ InnoDB çš„è‡ªåŠ¨æäº¤ (autocommit) ç‰¹æ€§å®Œæˆã€‚ æ™®é€šçš„ MySQL æ‰§è¡Œè¯­å¥åï¼Œå½“å‰çš„æ•°æ®æäº¤æ“ä½œå‡å¯è¢«å…¶ä»–å®¢æˆ·ç«¯å¯è§ï¼›è€Œäº‹åŠ¡æ˜¯æš‚æ—¶å…³é—­â€œè‡ªåŠ¨æäº¤â€æœºåˆ¶ï¼Œéœ€è¦ commit æäº¤æŒä¹…åŒ–æ•°æ®æ“ä½œã€‚-- æ³¨æ„ 1. æ•°æ®å®šä¹‰è¯­è¨€ï¼ˆDDLï¼‰è¯­å¥ä¸èƒ½è¢«å›æ»šï¼Œæ¯”å¦‚åˆ›å»ºæˆ–å–æ¶ˆæ•°æ®åº“çš„è¯­å¥ï¼Œå’Œåˆ›å»ºã€å–æ¶ˆæˆ–æ›´æ”¹è¡¨æˆ–å­˜å‚¨çš„å­ç¨‹åºçš„è¯­å¥ã€‚ 2. äº‹åŠ¡ä¸èƒ½è¢«åµŒå¥—-- ä¿å­˜ç‚¹ SAVEPOINT ä¿å­˜ç‚¹åç§° -- è®¾ç½®ä¸€ä¸ªäº‹åŠ¡ä¿å­˜ç‚¹ ROLLBACK TO SAVEPOINT ä¿å­˜ç‚¹åç§° -- å›æ»šåˆ°ä¿å­˜ç‚¹ RELEASE SAVEPOINT ä¿å­˜ç‚¹åç§° -- åˆ é™¤ä¿å­˜ç‚¹-- InnoDB è‡ªåŠ¨æäº¤ç‰¹æ€§è®¾ç½® SET autocommit &#x3D; 0|1; 0 è¡¨ç¤ºå…³é—­è‡ªåŠ¨æäº¤ï¼Œ1 è¡¨ç¤ºå¼€å¯è‡ªåŠ¨æäº¤ã€‚ - å¦‚æœå…³é—­äº†ï¼Œé‚£æ™®é€šæ“ä½œçš„ç»“æœå¯¹å…¶ä»–å®¢æˆ·ç«¯ä¹Ÿä¸å¯è§ï¼Œéœ€è¦ commit æäº¤åæ‰èƒ½æŒä¹…åŒ–æ•°æ®æ“ä½œã€‚ - ä¹Ÿå¯ä»¥å…³é—­è‡ªåŠ¨æäº¤æ¥å¼€å¯äº‹åŠ¡ã€‚ä½†ä¸ START TRANSACTION ä¸åŒçš„æ˜¯ï¼Œ - SET autocommit æ˜¯æ°¸ä¹…æ”¹å˜æœåŠ¡å™¨çš„è®¾ç½®ï¼Œç›´åˆ°ä¸‹æ¬¡å†æ¬¡ä¿®æ”¹è¯¥è®¾ç½®ã€‚(é’ˆå¯¹å½“å‰è¿æ¥) - è€Œ START TRANSACTION è®°å½•å¼€å¯å‰çš„çŠ¶æ€ï¼Œè€Œä¸€æ—¦äº‹åŠ¡æäº¤æˆ–å›æ»šåå°±éœ€è¦å†æ¬¡å¼€å¯äº‹åŠ¡ã€‚(é’ˆå¯¹å½“å‰äº‹åŠ¡) è§¦å‘å™¨12345678910111213141516171819202122&#x2F;* è§¦å‘å™¨ *&#x2F;-- è§¦å‘ç¨‹åºæ˜¯ä¸è¡¨æœ‰å…³çš„å‘½åæ•°æ®åº“å¯¹è±¡ï¼Œå½“è¯¥è¡¨å‡ºç°ç‰¹å®šäº‹ä»¶æ—¶ï¼Œå°†æ¿€æ´»è¯¥å¯¹è±¡ç›‘å¬ï¼šè®°å½•çš„å¢åŠ ã€ä¿®æ”¹ã€åˆ é™¤ã€‚-- åˆ›å»ºè§¦å‘å™¨CREATE TRIGGER trigger_name trigger_time trigger_event ON tbl_name FOR EACH ROW trigger_stmt tbl_nameï¼šç›‘å¬çš„è¡¨ï¼Œå¿…é¡»æ˜¯æ°¸ä¹…æ€§çš„è¡¨ï¼Œä¸èƒ½å°†è§¦å‘ç¨‹åºä¸ TEMPORARY è¡¨æˆ–è§†å›¾å…³è”èµ·æ¥ã€‚ trigger_time æ˜¯è§¦å‘ç¨‹åºçš„åŠ¨ä½œæ—¶é—´ã€‚å®ƒå¯ä»¥æ˜¯ before æˆ– afterï¼Œä»¥æŒ‡æ˜è§¦å‘ç¨‹åºæ˜¯åœ¨æ¿€æ´»å®ƒçš„è¯­å¥ä¹‹å‰æˆ–ä¹‹åè§¦å‘ã€‚ trigger_event æŒ‡æ˜äº†æ¿€æ´»è§¦å‘ç¨‹åºçš„è¯­å¥çš„ç±»å‹ INSERTï¼šå°†æ–°è¡Œæ’å…¥è¡¨æ—¶æ¿€æ´»è§¦å‘ç¨‹åº UPDATEï¼šæ›´æ”¹æŸä¸€è¡Œæ—¶æ¿€æ´»è§¦å‘ç¨‹åº DELETEï¼šä»è¡¨ä¸­åˆ é™¤æŸä¸€è¡Œæ—¶æ¿€æ´»è§¦å‘ç¨‹åº trigger_stmtï¼šå½“è§¦å‘ç¨‹åºæ¿€æ´»æ—¶æ‰§è¡Œçš„è¯­å¥ã€‚æ‰§è¡Œå¤šä¸ªè¯­å¥ï¼Œå¯ä½¿ç”¨ BEGIN...END å¤åˆè¯­å¥ç»“æ„-- åˆ é™¤DROP TRIGGER [schema_name.]trigger_name-- è§¦å‘å™¨å¯ä»¥ä½¿ç”¨ old å’Œ new ä»£æ›¿æ—§çš„å’Œæ–°çš„æ•°æ®ã€‚ æ›´æ–°æ“ä½œï¼Œæ›´æ–°å‰æ˜¯ oldï¼Œæ›´æ–°åæ˜¯ newã€‚ åˆ é™¤æ“ä½œï¼Œåªæœ‰ oldã€‚ å¢åŠ æ“ä½œï¼Œåªæœ‰ newã€‚-- æ³¨æ„ï¼šå¯¹äºå…·æœ‰ç›¸åŒè§¦å‘ç¨‹åºåŠ¨ä½œæ—¶é—´å’Œäº‹ä»¶çš„ç»™å®šè¡¨ï¼Œä¸èƒ½æœ‰ä¸¤ä¸ªè§¦å‘ç¨‹åºã€‚ ç¼–ç¨‹123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115&#x2F;* SQLç¼–ç¨‹ *&#x2F;-- å±€éƒ¨å˜é‡ ------------ å˜é‡å£°æ˜ declare var_name[,...] type [default value] è¿™ä¸ªè¯­å¥è¢«ç”¨æ¥å£°æ˜å±€éƒ¨å˜é‡ã€‚è¦ç»™å˜é‡æä¾›ä¸€ä¸ªé»˜è®¤å€¼ï¼Œè¯·åŒ…å«ä¸€ä¸ª default å­å¥ã€‚å€¼å¯ä»¥è¢«æŒ‡å®šä¸ºä¸€ä¸ªè¡¨è¾¾å¼ï¼Œä¸éœ€è¦ä¸ºä¸€ä¸ªå¸¸æ•°ã€‚å¦‚æœæ²¡æœ‰ default å­å¥ï¼Œåˆå§‹å€¼ä¸º nullã€‚ -- èµ‹å€¼ ä½¿ç”¨ set å’Œ select into è¯­å¥ä¸ºå˜é‡èµ‹å€¼ã€‚ æ³¨æ„ï¼šåœ¨å‡½æ•°å†…æ˜¯å¯ä»¥ä½¿ç”¨å…¨å±€å˜é‡ï¼ˆç”¨æˆ·è‡ªå®šä¹‰çš„å˜é‡ï¼‰-- å…¨å±€å˜é‡ ------------ å®šä¹‰ã€èµ‹å€¼set è¯­å¥å¯ä»¥å®šä¹‰å¹¶ä¸ºå˜é‡èµ‹å€¼ã€‚set @var &#x3D; value;ä¹Ÿå¯ä»¥ä½¿ç”¨ select into è¯­å¥ä¸ºå˜é‡åˆå§‹åŒ–å¹¶èµ‹å€¼ã€‚è¿™æ ·è¦æ±‚ select è¯­å¥åªèƒ½è¿”å›ä¸€è¡Œï¼Œä½†æ˜¯å¯ä»¥æ˜¯å¤šä¸ªå­—æ®µï¼Œå°±æ„å‘³ç€åŒæ—¶ä¸ºå¤šä¸ªå˜é‡è¿›è¡Œèµ‹å€¼ï¼Œå˜é‡çš„æ•°é‡éœ€è¦ä¸æŸ¥è¯¢çš„åˆ—æ•°ä¸€è‡´ã€‚è¿˜å¯ä»¥æŠŠèµ‹å€¼è¯­å¥çœ‹ä½œä¸€ä¸ªè¡¨è¾¾å¼ï¼Œé€šè¿‡ select æ‰§è¡Œå®Œæˆã€‚æ­¤æ—¶ä¸ºäº†é¿å… &#x3D; è¢«å½“ä½œå…³ç³»è¿ç®—ç¬¦çœ‹å¾…ï¼Œä½¿ç”¨ :&#x3D; ä»£æ›¿ã€‚ï¼ˆset è¯­å¥å¯ä»¥ä½¿ç”¨ &#x3D; å’Œ :&#x3D;ï¼‰ã€‚select @var:&#x3D;20;select @v1:&#x3D;id, @v2&#x3D;name from t1 limit 1;select * from tbl_name where @var:&#x3D;30;select into -- å¯ä»¥å°†è¡¨ä¸­æŸ¥è¯¢è·å¾—çš„æ•°æ®èµ‹ç»™å˜é‡ã€‚select max(height) into @max_height from tb;-- è‡ªå®šä¹‰å˜é‡åä¸ºäº†é¿å… select è¯­å¥ä¸­ï¼Œç”¨æˆ·è‡ªå®šä¹‰çš„å˜é‡ä¸ç³»ç»Ÿæ ‡è¯†ç¬¦ï¼ˆé€šå¸¸æ˜¯å­—æ®µåï¼‰å†²çªï¼Œç”¨æˆ·è‡ªå®šä¹‰å˜é‡åœ¨å˜é‡åå‰ä½¿ç”¨@ä½œä¸ºå¼€å§‹ç¬¦å·ã€‚@var&#x3D;10;-- å˜é‡è¢«å®šä¹‰åï¼Œåœ¨æ•´ä¸ªä¼šè¯å‘¨æœŸéƒ½æœ‰æ•ˆï¼ˆç™»å½•åˆ°é€€å‡ºï¼‰-- æ§åˆ¶ç»“æ„ ------------ ifè¯­å¥if search_condition then statement_list [elseif search_condition then statement_list]...[else statement_list]end if;-- caseè¯­å¥CASE value WHEN [compare-value] THEN result[WHEN [compare-value] THEN result ...][ELSE result]END-- whileå¾ªç¯[begin_label:] while search_condition do statement_listend while [end_label];-- å¦‚æœéœ€è¦åœ¨å¾ªç¯å†…æå‰ç»ˆæ­¢ while å¾ªç¯ï¼Œåˆ™éœ€è¦ä½¿ç”¨æ ‡ç­¾ï¼›æ ‡ç­¾éœ€è¦æˆå¯¹å‡ºç°ã€‚-- é€€å‡ºå¾ªç¯ é€€å‡ºæ•´ä¸ªå¾ªç¯ leave é€€å‡ºå½“å‰å¾ªç¯ iterate é€šè¿‡é€€å‡ºçš„æ ‡ç­¾å†³å®šé€€å‡ºå“ªä¸ªå¾ªç¯ -- å­˜å‚¨å‡½æ•°ï¼Œè‡ªå®šä¹‰å‡½æ•° ------------ æ–°å»º CREATE FUNCTION function_name (å‚æ•°åˆ—è¡¨) RETURNS è¿”å›å€¼ç±»å‹ å‡½æ•°ä½“ - å‡½æ•°åï¼Œåº”è¯¥åˆæ³•çš„æ ‡è¯†ç¬¦ï¼Œå¹¶ä¸”ä¸åº”è¯¥ä¸å·²æœ‰çš„å…³é”®å­—å†²çªã€‚ - ä¸€ä¸ªå‡½æ•°åº”è¯¥å±äºæŸä¸ªæ•°æ®åº“ï¼Œå¯ä»¥ä½¿ç”¨ db_name.funciton_name çš„å½¢å¼æ‰§è¡Œå½“å‰å‡½æ•°æ‰€å±æ•°æ®åº“ï¼Œå¦åˆ™ä¸ºå½“å‰æ•°æ®åº“ã€‚ - å‚æ•°éƒ¨åˆ†ï¼Œç”±&quot;å‚æ•°å&quot;å’Œ&quot;å‚æ•°ç±»å‹&quot;ç»„æˆã€‚å¤šä¸ªå‚æ•°ç”¨é€—å·éš”å¼€ã€‚ - å‡½æ•°ä½“ç”±å¤šæ¡å¯ç”¨çš„ mysql è¯­å¥ï¼Œæµç¨‹æ§åˆ¶ï¼Œå˜é‡å£°æ˜ç­‰è¯­å¥æ„æˆã€‚ - å¤šæ¡è¯­å¥åº”è¯¥ä½¿ç”¨ begin...end è¯­å¥å—åŒ…å«ã€‚ - ä¸€å®šè¦æœ‰ return è¿”å›å€¼è¯­å¥ã€‚-- åˆ é™¤ DROP FUNCTION [IF EXISTS] function_name;-- æŸ¥çœ‹ SHOW FUNCTION STATUS LIKE &#39;partten&#39; SHOW CREATE FUNCTION function_name;-- ä¿®æ”¹ ALTER FUNCTION function_name å‡½æ•°é€‰é¡¹--&#x2F;&#x2F; å­˜å‚¨è¿‡ç¨‹ï¼Œè‡ªå®šä¹‰åŠŸèƒ½ ------------ å®šä¹‰å­˜å‚¨å­˜å‚¨è¿‡ç¨‹ æ˜¯ä¸€æ®µä»£ç ï¼ˆè¿‡ç¨‹ï¼‰ï¼Œå­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„sqlç»„æˆã€‚ä¸€ä¸ªå­˜å‚¨è¿‡ç¨‹é€šå¸¸ç”¨äºå®Œæˆä¸€æ®µä¸šåŠ¡é€»è¾‘ï¼Œä¾‹å¦‚æŠ¥åï¼Œäº¤ç­è´¹ï¼Œè®¢å•å…¥åº“ç­‰ã€‚è€Œä¸€ä¸ªå‡½æ•°é€šå¸¸ä¸“æ³¨ä¸æŸä¸ªåŠŸèƒ½ï¼Œè§†ä¸ºå…¶ä»–ç¨‹åºæœåŠ¡çš„ï¼Œéœ€è¦åœ¨å…¶ä»–è¯­å¥ä¸­è°ƒç”¨å‡½æ•°æ‰å¯ä»¥ï¼Œè€Œå­˜å‚¨è¿‡ç¨‹ä¸èƒ½è¢«å…¶ä»–è°ƒç”¨ï¼Œæ˜¯è‡ªå·±æ‰§è¡Œ é€šè¿‡callæ‰§è¡Œã€‚-- åˆ›å»ºCREATE PROCEDURE sp_name (å‚æ•°åˆ—è¡¨) è¿‡ç¨‹ä½“å‚æ•°åˆ—è¡¨ï¼šä¸åŒäºå‡½æ•°çš„å‚æ•°åˆ—è¡¨ï¼Œéœ€è¦æŒ‡æ˜å‚æ•°ç±»å‹INï¼Œè¡¨ç¤ºè¾“å…¥å‹OUTï¼Œè¡¨ç¤ºè¾“å‡ºå‹INOUTï¼Œè¡¨ç¤ºæ··åˆå‹æ³¨æ„ï¼Œæ²¡æœ‰è¿”å›å€¼ã€‚&#x2F;* å­˜å‚¨è¿‡ç¨‹ *&#x2F;å­˜å‚¨è¿‡ç¨‹æ˜¯ä¸€æ®µå¯æ‰§è¡Œæ€§ä»£ç çš„é›†åˆã€‚ç›¸æ¯”å‡½æ•°ï¼Œæ›´åå‘äºä¸šåŠ¡é€»è¾‘ã€‚è°ƒç”¨ï¼šCALL è¿‡ç¨‹å-- æ³¨æ„ - æ²¡æœ‰è¿”å›å€¼ã€‚ - åªèƒ½å•ç‹¬è°ƒç”¨ï¼Œä¸å¯å¤¹æ‚åœ¨å…¶ä»–è¯­å¥ä¸­ã€‚-- å‚æ•°IN|OUT|INOUT å‚æ•°å æ•°æ®ç±»å‹IN è¾“å…¥ï¼šåœ¨è°ƒç”¨è¿‡ç¨‹ä¸­ï¼Œå°†æ•°æ®è¾“å…¥åˆ°è¿‡ç¨‹ä½“å†…éƒ¨çš„å‚æ•°OUT è¾“å‡ºï¼šåœ¨è°ƒç”¨è¿‡ç¨‹ä¸­ï¼Œå°†è¿‡ç¨‹ä½“å¤„ç†å®Œçš„ç»“æœè¿”å›åˆ°å®¢æˆ·ç«¯INOUT è¾“å…¥è¾“å‡ºï¼šæ—¢å¯è¾“å…¥ï¼Œä¹Ÿå¯è¾“å‡º-- è¯­æ³•CREATE PROCEDURE è¿‡ç¨‹å (å‚æ•°åˆ—è¡¨)BEGIN è¿‡ç¨‹ä½“END æ‚é¡¹12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152/* é”è¡¨ */è¡¨é”å®šåªç”¨äºé˜²æ­¢å…¶å®ƒå®¢æˆ·ç«¯è¿›è¡Œä¸æ­£å½“åœ°è¯»å–å’Œå†™å…¥MyISAM æ”¯æŒè¡¨é”ï¼ŒInnoDB æ”¯æŒè¡Œé”-- é”å®š LOCK TABLES tbl_name [AS alias]-- è§£é” UNLOCK TABLES-- åˆ†æ”¯è¯­å¥if æ¡ä»¶ then æ‰§è¡Œè¯­å¥elseif æ¡ä»¶ then æ‰§è¡Œè¯­å¥else æ‰§è¡Œè¯­å¥end if;-- ä¿®æ”¹æœ€å¤–å±‚è¯­å¥ç»“æŸç¬¦delimiter è‡ªå®šä¹‰ç»“æŸç¬¦å· SQLè¯­å¥è‡ªå®šä¹‰ç»“æŸç¬¦å·delimiter ; -- ä¿®æ”¹å›åŸæ¥çš„åˆ†å·-- è¯­å¥å—åŒ…è£¹begin è¯­å¥å—end-- ç‰¹æ®Šçš„æ‰§è¡Œ1. åªè¦æ·»åŠ è®°å½•ï¼Œå°±ä¼šè§¦å‘ç¨‹åºã€‚2. Insert into on duplicate key update è¯­æ³•ä¼šè§¦å‘ï¼š å¦‚æœæ²¡æœ‰é‡å¤è®°å½•ï¼Œä¼šè§¦å‘ before insert, after insert; å¦‚æœæœ‰é‡å¤è®°å½•å¹¶æ›´æ–°ï¼Œä¼šè§¦å‘ before insert, before update, after update; å¦‚æœæœ‰é‡å¤è®°å½•ä½†æ˜¯æ²¡æœ‰å‘ç”Ÿæ›´æ–°ï¼Œåˆ™è§¦å‘ before insert, before update3. Replace è¯­æ³• å¦‚æœæœ‰è®°å½•ï¼Œåˆ™æ‰§è¡Œ before insert, before delete, after delete, after insert/* æ‚é¡¹ */ ------------------1. å¯ç”¨åå¼•å·ï¼ˆ`ï¼‰ä¸ºæ ‡è¯†ç¬¦ï¼ˆåº“åã€è¡¨åã€å­—æ®µåã€ç´¢å¼•ã€åˆ«åï¼‰åŒ…è£¹ï¼Œä»¥é¿å…ä¸å…³é”®å­—é‡åï¼ä¸­æ–‡ä¹Ÿå¯ä»¥ä½œä¸ºæ ‡è¯†ç¬¦ï¼2. æ¯ä¸ªåº“ç›®å½•å­˜åœ¨ä¸€ä¸ªä¿å­˜å½“å‰æ•°æ®åº“çš„é€‰é¡¹æ–‡ä»¶db.optã€‚3. æ³¨é‡Šï¼š å•è¡Œæ³¨é‡Š # æ³¨é‡Šå†…å®¹ å¤šè¡Œæ³¨é‡Š /* æ³¨é‡Šå†…å®¹ */ å•è¡Œæ³¨é‡Š -- æ³¨é‡Šå†…å®¹ (æ ‡å‡†SQLæ³¨é‡Šé£æ ¼ï¼Œè¦æ±‚åŒç ´æŠ˜å·ååŠ ä¸€ç©ºæ ¼ç¬¦ï¼ˆç©ºæ ¼ã€TABã€æ¢è¡Œç­‰ï¼‰)4. æ¨¡å¼é€šé…ç¬¦ï¼š _ ä»»æ„å•ä¸ªå­—ç¬¦ % ä»»æ„å¤šä¸ªå­—ç¬¦ï¼Œç”šè‡³åŒ…æ‹¬é›¶å­—ç¬¦ å•å¼•å·éœ€è¦è¿›è¡Œè½¬ä¹‰ \\'5. CMDå‘½ä»¤è¡Œå†…çš„è¯­å¥ç»“æŸç¬¦å¯ä»¥ä¸º \";\", \"\\G\", \"\\g\"ï¼Œä»…å½±å“æ˜¾ç¤ºç»“æœã€‚å…¶ä»–åœ°æ–¹è¿˜æ˜¯ç”¨åˆ†å·ç»“æŸã€‚delimiter å¯ä¿®æ”¹å½“å‰å¯¹è¯çš„è¯­å¥ç»“æŸç¬¦ã€‚6. SQLå¯¹å¤§å°å†™ä¸æ•æ„Ÿ7. æ¸…é™¤å·²æœ‰è¯­å¥ï¼š\\c","categories":[{"name":"å¼€å‘æ‚é¡¹","slug":"å¼€å‘æ‚é¡¹","permalink":"http://yoursite.com/categories/%E5%BC%80%E5%8F%91%E6%9D%82%E9%A1%B9/"}],"tags":[{"name":"MySQL","slug":"MySQL","permalink":"http://yoursite.com/tags/MySQL/"}]},{"title":"Hive","slug":"å¤§æ•°æ®/Hive","date":"2020-04-28T03:27:12.000Z","updated":"2020-07-10T03:39:21.927Z","comments":true,"path":"2020/04/28/å¤§æ•°æ®/Hive/","link":"","permalink":"http://yoursite.com/2020/04/28/%E5%A4%A7%E6%95%B0%E6%8D%AE/Hive/","excerpt":"Hive åŸºæœ¬ä»‹ç»åŠç®€å•ä½¿ç”¨ã€‚","text":"Hive åŸºæœ¬ä»‹ç»åŠç®€å•ä½¿ç”¨ã€‚ åŸºæœ¬æ¦‚å¿µHive æ˜¯åŸºäº Hadoop çš„ä¸€ä¸ªæ•°æ®ä»“åº“å·¥å…·ï¼Œå¯ä»¥å°†ç»“æ„åŒ–çš„æ•°æ®æ–‡ä»¶æ˜ å°„ä¸ºä¸€å¼ è¡¨ï¼Œå¹¶æä¾›ç±» SQL æŸ¥è¯¢åŠŸèƒ½ã€‚ æœ¬è´¨ä¸Šæ˜¯å°† HQL è½¬åŒ–ä¸º MapReduce ç¨‹åºã€‚ Hive å¤„ç†çš„æ•°æ®å­˜å‚¨åœ¨ HDFSï¼›Hive åˆ†ææ•°æ®åº•å±‚çš„å®ç°æ˜¯ MapReduceï¼›æ‰§è¡Œç¨‹åºè¿è¡Œåœ¨ Yarn ä¸Š HQL VS SQL Hive RDBMS æŸ¥è¯¢è¯­è¨€ HQL SQL æ•°æ®å­˜å‚¨ HDFS LOCAL FS æ‰§è¡Œ MapReduce Executor æ‰§è¡Œå»¶è¿Ÿ é«˜ ä½ å¤„ç†æ•°æ®è§„æ¨¡ å¤§ å° ç´¢å¼• ä½å›¾ç´¢å¼• å¤æ‚ç´¢å¼• ç”¨æˆ·æ¥å£ Clientï¼šCLIï¼ˆhive shellï¼‰ã€JDBC / ODBCï¼ˆjava è®¿é—® hiveï¼‰ã€WEBUIï¼ˆæµè§ˆå™¨è®¿é—® hiveï¼‰ã€‚ å…ƒæ•°æ® Metastoreï¼šå…ƒæ•°æ®åŒ…æ‹¬è¡¨åã€è¡¨æ‰€å±çš„æ•°æ®ï¼ˆé»˜è®¤æ˜¯ defaultï¼‰ã€è¡¨çš„æ‹¥æœ‰è€…ã€åˆ— / åˆ†åŒºå­—æ®µã€è¡¨çš„ç±»å‹ï¼ˆæ˜¯å¦æ˜¯å¤–éƒ¨è¡¨ï¼‰ã€è¡¨çš„æ•°æ®æ‰€åœ¨ç›®å½•ç­‰ï¼›é»˜è®¤å­˜å‚¨åœ¨è‡ªå¸¦çš„ derby æ•°æ®åº“ä¸­ï¼Œæ¨èä½¿ç”¨ MySQL å­˜å‚¨ Metastoreã€‚ Hadoopä½¿ç”¨ HDFS è¿›è¡Œå­˜å‚¨ï¼Œä½¿ç”¨ MapReduce è¿›è¡Œè®¡ç®—ã€‚ é©±åŠ¨å™¨ Driverè§£æå™¨ SQL Parserï¼šå°† SQL å­—ç¬¦ä¸²è½¬æ¢æˆæŠ½è±¡è¯­æ³•æ ‘ ASTï¼›ç¼–è¯‘å™¨ Physical Planï¼š å°† AST ç¼–è¯‘ç”Ÿæˆé€»è¾‘æ‰§è¡Œè®¡åˆ’ï¼›ä¼˜åŒ–å™¨ Query Optimizerï¼šå¯¹é€»è¾‘æ‰§è¡Œè®¡åˆ’è¿›è¡Œä¼˜åŒ–ï¼›æ‰§è¡Œå™¨ Executionï¼šæŠŠé€»è¾‘æ‰§è¡Œè®¡åˆ’è½¬æ¢æˆå¯ä»¥è¿è¡Œçš„ç‰©ç†è®¡åˆ’ã€‚å¯¹äº Hive æ¥ è¯´ï¼Œå°±æ˜¯ MR / Sparkã€‚ Hive é€šè¿‡ç»™ç”¨æˆ·æä¾›çš„ä¸€ç³»åˆ—äº¤äº’æ¥å£ï¼Œæ¥æ”¶åˆ°ç”¨æˆ·çš„æŒ‡ä»¤ï¼ˆSQLï¼‰ï¼Œä½¿ç”¨è‡ªå·±çš„ Driverï¼Œ ç»“åˆå…ƒæ•°æ®ï¼ˆMetaStoreï¼‰ï¼Œå°†è¿™äº›æŒ‡ä»¤ç¿»è¯‘æˆ MapReduceï¼Œæäº¤åˆ° Hadoop ä¸­æ‰§è¡Œï¼Œæœ€åï¼Œå°†æ‰§è¡Œè¿”å›çš„ç»“æœè¾“å‡ºåˆ°ç”¨æˆ·äº¤äº’æ¥å£ã€‚ å®‰è£…é…ç½®1234567891011121314# hive å®‰è£…tar -zxvf apache-hive-1.2.1-bin.tar.gz -C /opt/module/mv apache-hive-1.2.1-bin/ hivemv hive-env.sh.template hive-env.shvi hive-env.sh # export HADOOP_HOME=/opt/module/hadoop-2.7.2 # export HIVE_CONF_DIR=/opt/module/hive/conf# å¯åŠ¨ hive å‰å¿…é¡»å¯åŠ¨é›†ç¾¤sbin/start-dfs.shsbin/start-yarn.sh# åˆ›å»ºç›®å½•bin/hadoop fs -mkdir -p /user/hive/warehousebin/hadoop fs -chmod g+w /user/hive/warehouse# æˆ–è€…ç›´æ¥åœ¨é…ç½®æ–‡ä»¶ä¸­å…³é—­æƒé™æ£€æŸ¥ 123456&lt;!-- hdfs-site.xml --&gt;&lt;property&gt; &lt;name&gt;dfs.permissions.enable&lt;/name&gt; &lt;value&gt;false&lt;/value&gt;&lt;/property&gt; åŸºæœ¬æ“ä½œ1234567891011bin/hive# è¿›å…¥ hive shellhive&gt; show databases;hive&gt; use default;hive&gt; show tables;hive&gt; create table student(id int, name string);hive&gt; show tables;hive&gt; desc student;hive&gt; insert into student values(1000,\"ss\");hive&gt; select * from student;hive&gt; quit; æ–‡ä»¶å¯¼å…¥1234# å°† /opt/module/datas/student.txt æ–‡ä»¶å¯¼å…¥ hive çš„ student(id int, name string) è¡¨ä¸­hive&gt; create table student(id int, name string) ROW FORMAT DELIMITED FIELDS TERMINATED BY '\\t';hive&gt; load data local inpath '/opt/module/datas/student.txt' into table student; å†æ‰“å¼€ä¸€ä¸ªå®¢æˆ·ç«¯çª—å£å¯åŠ¨ hiveï¼Œä¼šäº§ç”Ÿ java.sql.SQLException å¼‚å¸¸ã€‚åŸå› æ˜¯ï¼ŒMetastore é»˜è®¤å­˜å‚¨åœ¨è‡ªå¸¦çš„ derby æ•°æ®åº“ä¸­ï¼Œæ¨èä½¿ç”¨ MySQL å­˜å‚¨ Metastoreã€‚ MySQL å®‰è£…1234567891011121314151617181920212223242526272829303132# æ£€æŸ¥ç¯å¢ƒrpm -qa|grep mysqlrpm -e --nodepsunzip mysql-libs.zip # MySQL-client-5.6.24-1.el6.x86_64.rpm # mysql-connector-java-5.1.27.tar.gz é©±åŠ¨åŒ… # MySQL-server-5.6.24-1.el6.x86_64.rpm# å®‰è£…æœåŠ¡rpm -ivh MySQL-server-5.6.24-1.el6.x86_64.rpm# è·å–éšæœºå¯†ç cat /root/.mysql_secret# æ£€æŸ¥æœåŠ¡çŠ¶æ€service mysql statusservice mysql start# å®‰è£…å®¢æˆ·ç«¯rpm -ivh MySQL-client-5.6.24-1.el6.x86_64.rpm# åˆ©ç”¨å¥½éšæœºå¯†ç è¿›è¡Œç™»å½•mysql -uroot -pOEXaQuS8IWkG19Xs# ä¿®æ”¹å¯†ç mysql&gt;SET PASSWORD=PASSWORD('000000');# ä¿®æ”¹ user è¡¨ä¸­çš„ä¸»æœºé…ç½®mysql&gt;show databases;mysql&gt;use mysql;mysql&gt;show tables;mysql&gt;desc user;mysql&gt;select User, Host, Password from user;mysql&gt;update user set host='%' where host='localhost';mysql&gt;delete from user where Host='127.0.0.1';mysql&gt;delete from user where Host='::1';# é…ç½®ç”Ÿæ•ˆmysql&gt;flush privileges;mysql&gt;quit; å…ƒæ•°æ®é…ç½®12# æ‹·è´æ‰€éœ€é©±åŠ¨cp mysql-connector-java-5.1.27-bin.jar /opt/module/hive/lib/ 123456789101112131415161718192021222324252627&lt;!-- åœ¨ /opt/module/hive/conf ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª hive-site.xml --&gt;&lt;!-- æ‹·è´å®˜æ–¹æ–‡æ¡£çš„é…ç½®å‚æ•° --&gt;&lt;?xml version=\"1.0\"?&gt;&lt;?xml-stylesheet type=\"text/xsl\" href=\"configuration.xsl\"?&gt;&lt;configuration&gt; &lt;property&gt; &lt;name&gt;javax.jdo.option.ConnectionURL&lt;/name&gt; &lt;value&gt;jdbc:mysql://[ip_address]:3306/metastore?createDatabaseIfNotExist=true&lt;/value&gt; &lt;description&gt;JDBC connect string for a JDBC metastore&lt;/description&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;javax.jdo.option.ConnectionDriverName&lt;/name&gt; &lt;value&gt;com.mysql.jdbc.Driver&lt;/value&gt; &lt;description&gt;Driver class name for a JDBC metastore&lt;/description&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;javax.jdo.option.ConnectionUserName&lt;/name&gt; &lt;value&gt;root&lt;/value&gt; &lt;description&gt;username to use against metastore database&lt;/description&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;javax.jdo.option.ConnectionPassword&lt;/name&gt; &lt;value&gt;000000&lt;/value&gt; &lt;description&gt;password to use against metastore database&lt;/description&gt; &lt;/property&gt;&lt;/configuration&gt; æŸ¥çœ‹ MySQL æ•°æ®åº“ï¼Œæ˜¾ç¤ºå¢åŠ äº† metastore æ•°æ®åº“ã€‚ äº¤äº’å‘½ä»¤1234567891011121314# æŸ¥çœ‹å¸®åŠ©bin/hive -help# ä¸è¿›å…¥ hive çš„äº¤äº’çª—å£æ‰§è¡Œ sql è¯­å¥bin/hive -e \"select id from student;\"# æ‰§è¡Œè„šæœ¬ä¸­ sql è¯­å¥bin/hive -f /opt/module/datas/hivef.sql# æ‰§è¡Œè„šæœ¬ï¼Œå¹¶å†™å‡ºç»“æœbin/hive -f /opt/module/datas/hivef.sql &gt; /opt/module/datas/hive_result.txt# åœ¨ hive cli å‘½ä»¤çª—å£ä¸­æŸ¥çœ‹ hdfs æ–‡ä»¶ç³»ç»Ÿhive(default)&gt;dfs -ls /;# åœ¨ hive cli å‘½ä»¤çª—å£ä¸­æŸ¥çœ‹æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿhive(default)&gt;! ls /opt/module/datas;# æŸ¥çœ‹åœ¨ hive ä¸­è¾“å…¥çš„æ‰€æœ‰å†å²å‘½ä»¤ï¼Œç”¨æˆ·å®¶ç›®å½•ä¸‹cat .hivehistory å±æ€§é…ç½®ä»“åº“è·¯å¾„Default æ•°æ®ä»“åº“çš„æœ€åŸå§‹ä½ç½®æ˜¯åœ¨ hdfs ä¸Šçš„ï¼š/user/hive/warehouse è·¯å¾„ä¸‹ï¼› åœ¨ä»“åº“ç›®å½•ä¸‹ï¼Œæ²¡æœ‰å¯¹é»˜è®¤çš„æ•°æ®åº“ default åˆ›å»ºæ–‡ä»¶å¤¹ã€‚å¦‚æœæŸå¼ è¡¨å±äº default æ•°æ®åº“ï¼Œç›´æ¥åœ¨æ•°æ®ä»“åº“ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ã€‚ æ”¹ default æ•°æ®ä»“åº“åŸå§‹ä½ç½®ï¼ˆå°† hive-default.xml.template å¦‚ä¸‹é…ç½®ä¿¡æ¯æ‹·è´åˆ° hive-site.xml æ–‡ä»¶ä¸­ï¼‰ 12345678910111213141516&lt;property&gt; &lt;name&gt;hive.metastore.warehouse.dir&lt;/name&gt; &lt;value&gt;/user/hive/warehouse&lt;/value&gt; &lt;description&gt;location of default database for the warehouse&lt;/description&gt;&lt;/property&gt;&lt;!-- æ˜¾ç¤ºæ•°æ®è¡¨å¤´ä¿¡æ¯ --&gt;&lt;property&gt; &lt;name&gt;hive.cli.print.header&lt;/name&gt; &lt;value&gt;true&lt;/value&gt;&lt;/property&gt;&lt;!-- æ˜¾ç¤ºå½“å‰æ•°æ®åº“åç§°ä¿¡æ¯ --&gt;&lt;property&gt; &lt;name&gt;hive.cli.print.current.db&lt;/name&gt; &lt;value&gt;true&lt;/value&gt;&lt;/property&gt; 12# é…ç½®åŒç»„ç”¨æˆ·æœ‰æ‰§è¡Œæƒé™bin/hdfs dfs -chmod g+w /user/hive/warehouse æ—¥å¿—ä¿¡æ¯12345678910# æ–¹å¼ä¸€mv hive-log4j.properties.template hive-log4j.propertiesvi hive-log4j.properties # hive.log.dir=/opt/module/hive/logs# æ–¹å¼äºŒï¼Œä»…å¯¹æœ¬æ¬¡ hive å¯åŠ¨æœ‰æ•ˆbin/hive -hiveconf hive.log.dir=/opt/module/hive/logs# æ–¹å¼ä¸‰ï¼Œä»…å¯¹æœ¬æ¬¡ hive å¯åŠ¨æœ‰æ•ˆhive (default)&gt; set hive.log.dir=/opt/module/hive/logs;# æŸ¥çœ‹æ‰€æœ‰å‚æ•°é…ç½®hive (default)&gt; set [æŸä¸€å‚æ•°] æ•°æ®ç±»å‹ç®€å•ç±»å‹ ç±»å‹ æè¿° ç¤ºä¾‹ boolean true / false TRUE tinyint 1 å­—èŠ‚çš„æœ‰ç¬¦å·æ•´æ•° -128~127 1Y smallint 2 ä¸ªå­—èŠ‚çš„æœ‰ç¬¦å·æ•´æ•°ï¼Œ-32768~32767 1S int 4 ä¸ªå­—èŠ‚çš„å¸¦ç¬¦å·æ•´æ•° 1 bigint 8 å­—èŠ‚å¸¦ç¬¦å·æ•´æ•° 1L float 4 å­—èŠ‚å•ç²¾åº¦æµ®ç‚¹æ•° 1.0 double 8 å­—èŠ‚åŒç²¾åº¦æµ®ç‚¹æ•° 1.0 deicimal ä»»æ„ç²¾åº¦çš„å¸¦ç¬¦å·å°æ•° 1.0 String å­—ç¬¦ä¸²ï¼Œå˜é•¿ â€œaâ€,â€™bâ€™ varchar å˜é•¿å­—ç¬¦ä¸² â€œaâ€,â€™bâ€™ char å›ºå®šé•¿åº¦å­—ç¬¦ä¸² â€œaâ€,â€™bâ€™ binary å­—èŠ‚æ•°ç»„ æ— æ³•è¡¨ç¤º timestamp æ—¶é—´æˆ³ï¼Œçº³ç§’ç²¾åº¦ 122327493795 date æ—¥æœŸ â€˜2018-04-07â€™ å¤æ‚ç±»å‹ ç±»å‹ æè¿° ç¤ºä¾‹ array æœ‰åºçš„çš„åŒç±»å‹çš„é›†åˆ array(1,2) map key-valueï¼Œkey å¿…é¡»ä¸ºåŸå§‹ç±»å‹ï¼Œvalue å¯ä»¥ä»»æ„ç±»å‹ map(â€˜aâ€™,1,â€™bâ€™,2) struct å­—æ®µé›†åˆ,ç±»å‹å¯ä»¥ä¸åŒ struct(â€˜1â€™,1,1.0), named_stract(â€˜col1â€™,â€™1â€™,â€™col2â€™,1,â€™clo3â€™,1.0) å®ä¾‹æ“ä½œ123456789101112&#123; \"name\": \"songsong\", \"friends\": [\"bingbing\" , \"lili\"] , // åˆ—è¡¨ Array \"children\": &#123; // é”®å€¼ Map \"xiao song\": 18 , \"xiaoxiao song\": 19 &#125; \"address\": &#123; // ç»“æ„ Struct, \"street\": \"hui long guan\" , \"city\": \"beijing\"&#125;&#125; åŸºäºä¸Šè¿°æ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬åœ¨ Hive é‡Œåˆ›å»ºå¯¹åº”çš„è¡¨ï¼Œå¹¶å¯¼å…¥æ•°æ®ã€‚ 12songsong,bingbing_lili,xiao song:18_xiaoxiao song:19,hui long guan_beijing &#x2F;&#x2F; ç¬¬ä¸€æ¡ JSONyangyang,caicai_susu,xiao yang:18_xiaoxiao yang:19,chao yang_beijing &#x2F;&#x2F; ç¬¬äºŒæ¡ JSON MAPï¼ŒSTRUCT å’Œ ARRAY é‡Œçš„å…ƒç´ é—´å…³ç³»éƒ½å¯ä»¥ç”¨åŒä¸€ä¸ªå­—ç¬¦è¡¨ç¤ºï¼Œè¿™é‡Œç”¨ â€œ_â€ã€‚ 1234567891011create table test( name string, friends array&lt;string&gt;, children map&lt;string, int&gt;, address struct&lt;street:string, city:string&gt;)row format delimitedfields terminated by ','collection items terminated by '_'map keys terminated by ':'lines terminated by '\\n'; 12345678# å¯¼å…¥æ•°æ®hive (default)&gt; load data local inpath â€˜/opt/module/datas/test.txtâ€™ into table test# è®¿é—®ä¸‰ç§é›†åˆåˆ—é‡Œçš„æ•°æ®ï¼Œä»¥ä¸‹åˆ†åˆ«æ˜¯ ARRAYï¼ŒMAPï¼ŒSTRUCT çš„è®¿é—®æ–¹å¼select friends[1],children['xiao song'],address.city from test where name=\"songsong\";OK_c0 _c1 citylili 18 beijingTime taken: 0.076 seconds, Fetched: 1 row(s) ç±»å‹è½¬åŒ–Hive çš„åŸå­æ•°æ®ç±»å‹æ˜¯å¯ä»¥è¿›è¡Œéšå¼è½¬æ¢çš„ï¼Œç±»ä¼¼äº Java çš„ç±»å‹è½¬æ¢ï¼Œä¾‹å¦‚æŸè¡¨è¾¾å¼ ä½¿ç”¨ INT ç±»å‹ï¼ŒTINYINT ä¼šè‡ªåŠ¨è½¬æ¢ä¸º INT ç±»å‹ï¼Œä½†æ˜¯ Hive ä¸ä¼šè¿›è¡Œåå‘è½¬åŒ–ï¼Œä¾‹å¦‚ï¼Œ æŸè¡¨è¾¾å¼ä½¿ç”¨ TINYINT ç±»å‹ï¼ŒINT ä¸ä¼šè‡ªåŠ¨è½¬æ¢ä¸º TINYINT ç±»å‹ï¼Œå®ƒä¼šè¿”å›é”™è¯¯ï¼Œé™¤éä½¿ç”¨ CAST æ“ä½œã€‚ éšå¼ç±»å‹è½¬æ¢è§„åˆ™ï¼š ä»»ä½•æ•´æ•°ç±»å‹éƒ½å¯ä»¥éšå¼åœ°è½¬æ¢ä¸ºä¸€ä¸ªèŒƒå›´æ›´å¹¿çš„ç±»å‹ï¼Œå¦‚ TINYINT å¯ä»¥è½¬æ¢æˆ INTï¼ŒINT å¯ä»¥è½¬æ¢æˆ BIGINTï¼›æ‰€æœ‰æ•´æ•°ç±»å‹ã€FLOAT å’Œ STRING ç±»å‹éƒ½å¯ä»¥éšå¼åœ°è½¬æ¢æˆ DOUBLEï¼›TINYINTã€SMALLINTã€INT éƒ½å¯ä»¥è½¬æ¢ä¸º FLOATï¼›BOOLEAN ç±»å‹ä¸å¯ä»¥è½¬æ¢ä¸ºä»»ä½•å…¶å®ƒçš„ç±»å‹ã€‚ å¯ä»¥ä½¿ç”¨ CAST æ“ä½œæ˜¾ç¤ºè¿›è¡Œæ•°æ®ç±»å‹è½¬æ¢ ä¾‹å¦‚ CAST(â€˜1â€™ AS INT) å°†æŠŠå­—ç¬¦ä¸² â€˜1â€™ è½¬æ¢æˆæ•´æ•° 1ï¼›å¦‚æœå¼ºåˆ¶ç±»å‹è½¬æ¢å¤±è´¥ï¼Œå¦‚æ‰§è¡Œ CAST(â€˜Xâ€™ AS INT)ï¼Œè¡¨è¾¾å¼è¿”å›ç©ºå€¼ NULLã€‚ DDL Data Definition Language æ•°æ®å®šä¹‰ã€‚ åº“æ“ä½œåˆ›å»º åˆ›å»ºä¸€ä¸ªæ•°æ®åº“ï¼Œæ•°æ®åº“åœ¨ HDFS ä¸Šçš„é»˜è®¤å­˜å‚¨è·¯å¾„æ˜¯ /user/hive/warehouse/*.db 123create database if not exists db_hive;# æŒ‡å®šåº“å­˜å‚¨è·¯å¾„create database db_hive location '/db_hive.db'; æ˜¾ç¤º123456# æ˜¾ç¤ºæ•°æ®åº“ä¿¡æ¯desc database db_hive;# æ˜¾ç¤ºæ•°æ®åº“è¯¦ç»†ä¿¡æ¯ extendeddesc database extended db_hive;# åˆ‡æ¢å½“å‰æ•°æ®åº“use db_hive; ä¿®æ”¹ç”¨æˆ·å¯ä»¥ä½¿ç”¨ ALTER DATABASE å‘½ä»¤ä¸ºæŸä¸ªæ•°æ®åº“çš„ DBPROPERTIES è®¾ç½®é”®-å€¼å¯¹å±æ€§å€¼ï¼Œæ¥æè¿°è¿™ä¸ªæ•°æ®åº“çš„å±æ€§ä¿¡æ¯ã€‚ æ•°æ®åº“çš„å…¶ä»–å…ƒæ•°æ®ä¿¡æ¯éƒ½æ˜¯ä¸å¯æ›´æ”¹çš„ï¼ŒåŒ…æ‹¬æ•°æ®åº“åå’Œæ•°æ®åº“æ‰€åœ¨çš„ç›®å½•ä½ç½®ã€‚ä¿®æ”¹å½“å‰æ­£åœ¨ä½¿ç”¨çš„æ•°æ®åº“ï¼Œè¦å…ˆé€€å‡ºä½¿ç”¨. 1alter database db_hive set dbproperties(&#39;createtime&#39;&#x3D;&#39;20170830&#39;); åˆ é™¤1234# é‡‡ç”¨ if exists åˆ¤æ–­æ•°æ®åº“æ˜¯å¦å­˜åœ¨drop database if exists [db_name];# å¦‚æœæ•°æ®åº“ä¸ä¸ºç©ºï¼Œå¯ä»¥é‡‡ç”¨ cascade å‘½ä»¤å¼ºåˆ¶åˆ é™¤drop database [db_name] cascade; è¡¨æ“ä½œè¡¨ç±»å‹123456789101112CREATE [EXTERNAL] TABLE [IF NOT EXISTS] table_name [(col_name data_type [COMMENT col_comment], ...)] [COMMENT table_comment] [PARTITIONED BY (col_name data_type [COMMENT col_comment], ...)] [CLUSTERED BY (col_name, col_name, ...) [SORTED BY (col_name [ASC|DESC], ...)] INTO num_buckets BUCKETS] [ROW FORMAT row_format] [STORED AS file_format] [LOCATION hdfs_path]# é‡å‘½åALTER TABLE table_name RENAME TO new_table_name EXTERNAL å…³é”®å­—å¯ä»¥è®©ç”¨æˆ·åˆ›å»ºä¸€ä¸ªå¤–éƒ¨è¡¨ï¼Œåœ¨å»ºè¡¨çš„åŒæ—¶æŒ‡å®šä¸€ä¸ªæŒ‡å‘å®é™…æ•°æ®çš„è·¯å¾„ï¼ˆLOCATIONï¼‰ã€‚ Hive åˆ›å»ºå†…éƒ¨è¡¨æ—¶ï¼Œä¼šå°†æ•°æ®ç§»åŠ¨åˆ°æ•°æ®ä»“åº“æŒ‡å‘çš„è·¯å¾„ï¼›è‹¥åˆ›å»ºå¤–éƒ¨è¡¨ï¼Œä»…è®°å½•æ•°æ®æ‰€åœ¨çš„è·¯å¾„ï¼Œä¸å¯¹æ•°æ®çš„ä½ç½®åšä»»ä½•æ”¹å˜ã€‚åœ¨åˆ é™¤è¡¨çš„æ—¶å€™ï¼Œå†…éƒ¨è¡¨çš„å…ƒæ•°æ®å’Œæ•°æ®ä¼šè¢«ä¸€èµ·åˆ é™¤ï¼Œè€Œå¤–éƒ¨è¡¨åªåˆ é™¤å…ƒæ•°æ®ï¼Œä¸åˆ é™¤æ•°æ®ã€‚ PARTITIONED è¡¨ç¤ºæ ¹æ®æŸä¸€ä¸ª key ï¼ˆä¸åœ¨ create table é‡Œé¢ï¼‰å¯¹æ•°æ®è¿›è¡Œåˆ†åŒºï¼Œä½“ç°åœ¨ HDFS ä¸Šå°±æ˜¯ table ç›®å½•ä¸‹æœ‰ n ä¸ªä¸åŒçš„åˆ†åŒºæ–‡ä»¶å¤¹ï¼ˆcountry=China,country=USAï¼‰ã€‚ CLUSTERED å¯¹äºæ¯ä¸€ä¸ªè¡¨ï¼ˆtableï¼‰æˆ–è€…åˆ†åŒºï¼Œ Hive å¯ä»¥è¿›ä¸€æ­¥ç»„ç»‡æˆæ¡¶ï¼Œä¹Ÿå°±æ˜¯è¯´æ¡¶æ˜¯æ›´ä¸ºç»†ç²’åº¦çš„æ•°æ®èŒƒå›´åˆ’åˆ†ã€‚Hive ä¹Ÿæ˜¯é’ˆå¯¹æŸä¸€åˆ—è¿›è¡Œæ¡¶çš„ç»„ç»‡ã€‚Hive é‡‡ç”¨å¯¹åˆ—å€¼å“ˆå¸Œï¼Œç„¶åé™¤ä»¥æ¡¶çš„ä¸ªæ•°æ±‚ä½™çš„æ–¹å¼å†³å®šè¯¥æ¡è®°å½•å­˜æ”¾åœ¨å“ªä¸ªæ¡¶å½“ä¸­ã€‚ è·å¾—æ›´é«˜çš„æŸ¥è¯¢å¤„ç†æ•ˆç‡ã€‚æ¡¶ä¸ºè¡¨åŠ ä¸Šäº†é¢å¤–çš„ç»“æ„ï¼ŒHive åœ¨å¤„ç†æœ‰äº›æŸ¥è¯¢æ—¶èƒ½åˆ©ç”¨è¿™ä¸ªç»“æ„ã€‚ä½¿å–æ ·ï¼ˆsamplingï¼‰æ›´é«˜æ•ˆã€‚ ROW FORMAT ç”¨æˆ·åœ¨å»ºè¡¨çš„æ—¶å€™å¯ä»¥è‡ªå®šä¹‰ SerDe æˆ–è€…ä½¿ç”¨è‡ªå¸¦çš„ SerDeã€‚SerDe æ˜¯ Serialize / Deserilize çš„ç®€ç§°ï¼Œç›®çš„æ˜¯ç”¨äºåºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚ STORED AS æŒ‡å®šå­˜å‚¨æ–‡ä»¶ç±»å‹ã€‚å¸¸ç”¨çš„å­˜å‚¨æ–‡ä»¶ç±»å‹ï¼šSEQUENCEFILEï¼ˆäºŒè¿›åˆ¶åºåˆ—æ–‡ä»¶ï¼‰ã€TEXTFILEï¼ˆæ–‡æœ¬ï¼‰ã€ RCFILEï¼ˆåˆ—å¼å­˜å‚¨æ ¼å¼æ–‡ä»¶ï¼‰ å¦‚æœæ–‡ä»¶æ•°æ®æ˜¯çº¯æ–‡æœ¬ï¼Œå¯ä»¥ä½¿ç”¨ STORED AS TEXTFILEã€‚å¦‚æœæ•°æ®éœ€è¦å‹ç¼©ï¼Œ ä½¿ç”¨ STORED AS SEQUENCEFILEã€‚ LOCATION æŒ‡å®šè¡¨åœ¨ HDFS ä¸Šçš„å­˜å‚¨ä½ç½®ã€‚ LIKE å…è®¸ç”¨æˆ·å¤åˆ¶ç°æœ‰çš„è¡¨ç»“æ„ï¼Œä½†æ˜¯ä¸å¤åˆ¶æ•°æ®ã€‚ å†…éƒ¨è¡¨ é»˜è®¤åˆ›å»ºçš„è¡¨éƒ½æ˜¯æ‰€è°“çš„ç®¡ç†è¡¨ï¼Œæœ‰æ—¶ä¹Ÿè¢«ç§°ä¸ºå†…éƒ¨è¡¨ã€‚å› ä¸ºè¿™ç§è¡¨ï¼ŒHive ä¼šï¼ˆæˆ–å¤šæˆ–å°‘åœ°ï¼‰æ§åˆ¶ç€æ•°æ®çš„ç”Ÿå‘½å‘¨æœŸã€‚Hive é»˜è®¤æƒ…å†µä¸‹ä¼šå°†è¿™äº›è¡¨çš„æ•°æ®å­˜å‚¨åœ¨ç”±é…ç½®é¡¹ hive.metastore.warehouse.dirï¼ˆä¾‹å¦‚ï¼Œ/user/hive/warehouseï¼‰æ‰€å®šä¹‰çš„ç›®å½•çš„å­ç›®å½•ä¸‹ã€‚å½“åˆ é™¤ä¸€ä¸ªç®¡ç†è¡¨æ—¶ï¼ŒHive ä¹Ÿä¼šåˆ é™¤è¿™ä¸ªè¡¨ä¸­æ•°æ®ã€‚å†…éƒ¨è¡¨ä¸é€‚åˆå’Œå…¶ä»–å·¥å…·å…±äº«æ•°æ®ã€‚ 12345678910111213# åˆ›å»ºå†…éƒ¨è¡¨create table if not exists student(id int, name string)row format delimited fields terminated by '\\t'stored as textfilelocation '/user/hive/warehouse/student';# æ ¹æ®æŸ¥è¯¢ç»“æœåˆ›å»ºè¡¨ï¼ˆæŸ¥è¯¢çš„ç»“æœä¼šæ·»åŠ åˆ°æ–°åˆ›å»ºçš„è¡¨ä¸­ï¼‰create table if not exists student01 as select id, name from student;# æ ¹æ®å·²ç»å­˜åœ¨çš„è¡¨ç»“æ„åˆ›å»ºè¡¨create table if not exists student02 like student;# æŸ¥è¯¢è¡¨çš„ç±»å‹desc formatted student01 å¤–éƒ¨è¡¨ å› ä¸ºè¡¨æ˜¯å¤–éƒ¨è¡¨ï¼Œæ‰€ä»¥ Hive å¹¶éè®¤ä¸ºå…¶å®Œå…¨æ‹¥æœ‰è¿™ä»½æ•°æ®ã€‚åˆ é™¤è¯¥è¡¨å¹¶ä¸ä¼šåˆ é™¤æ‰è¿™ ä»½æ•°æ®ï¼Œä¸è¿‡æè¿°è¡¨çš„å…ƒæ•°æ®ä¿¡æ¯ä¼šè¢«åˆ é™¤æ‰ã€‚ æ¯å¤©å°†æ”¶é›†åˆ°çš„ç½‘ç«™æ—¥å¿—å®šæœŸæµå…¥ HDFS æ–‡æœ¬æ–‡ä»¶ã€‚åœ¨å¤–éƒ¨è¡¨ï¼ˆåŸå§‹æ—¥å¿—è¡¨ï¼‰çš„åŸºç¡€ ä¸Šåšå¤§é‡çš„ç»Ÿè®¡åˆ†æï¼Œç”¨åˆ°çš„ä¸­é—´è¡¨ã€ç»“æœè¡¨ä½¿ç”¨å†…éƒ¨è¡¨å­˜å‚¨ï¼Œæ•°æ®é€šè¿‡ SELECT+INSERT è¿›å…¥å†…éƒ¨è¡¨ã€‚ 12345678910111213141516171819202122232425262728293031323334# åˆ›å»ºå¤–éƒ¨è¡¨éƒ¨é—¨è¡¨create external table if not exists default.dept( deptno int, dname string, loc int)row format delimited fields terminated by '\\t';# åˆ›å»ºå¤–éƒ¨è¡¨å‘˜å·¥è¡¨create external table if not exists default.emp( empno int, ename string, job string, mgr int, hiredate string, sal double, comm double, deptno int)row format delimited fields terminated by '\\t';# æŸ¥è¯¢è¡¨ç»“æ„hive (default)&gt; show tables;OKtab_namedeptemp# å‘å¤–éƒ¨è¡¨ä¸­å¯¼å…¥æ•°æ®hive (default)&gt; load data local inpath '/opt/module/datas/dept.txt' into table default.dept;hive (default)&gt; load data local inpath '/opt/module/datas/emp.txt' into table default.emp;# æŸ¥è¯¢ç»“æœhive (default)&gt; select * from emp;hive (default)&gt; select * from dept;# æŸ¥çœ‹è¡¨çš„ç±»å‹hive (default)&gt; desc formatted dept;Table Type: EXTERNAL_TABLE è¡¨è½¬æ¢ åªèƒ½ç”¨å•å¼•å·ï¼Œä¸¥æ ¼åŒºåˆ†å¤§å°å†™ï¼Œå¦‚æœä¸æ˜¯å®Œå…¨ç¬¦åˆï¼Œé‚£ä¹ˆåªä¼šæ·»åŠ  K V è€Œä¸ç”Ÿæ•ˆã€‚ 1234567891011# æŸ¥è¯¢è¡¨çš„ç±»å‹hive (default)&gt; desc formatted student;Table Type: MANAGED_TABLE# ä¿®æ”¹å†…éƒ¨è¡¨ student ä¸ºå¤–éƒ¨è¡¨alter table student set tblproperties('EXTERNAL'='TRUE');hive (default)&gt; desc formatted student;Table Type: EXTERNAL_TABLE# ä¿®æ”¹å¤–éƒ¨è¡¨ student ä¸ºå†…éƒ¨è¡¨alter table student set tblproperties('EXTERNAL'='FALSE');hive (default)&gt; desc formatted student;Table Type: MANAGED_TABLE åˆ†åŒºè¡¨ åˆ†åŒºè¡¨å®é™…ä¸Šå°±æ˜¯å¯¹åº”ä¸€ä¸ª HDFS æ–‡ä»¶ç³»ç»Ÿä¸Šçš„ç‹¬ç«‹çš„æ–‡ä»¶å¤¹ï¼Œè¯¥æ–‡ä»¶å¤¹ä¸‹æ˜¯è¯¥åˆ†åŒºæ‰€æœ‰çš„æ•°æ®æ–‡ä»¶ã€‚Hive ä¸­çš„åˆ†åŒºå°±æ˜¯åˆ†ç›®å½•ï¼ŒæŠŠä¸€ä¸ªå¤§çš„æ•°æ®é›†æ ¹æ®ä¸šåŠ¡éœ€è¦åˆ†å‰²æˆå°çš„æ•°æ®é›†ã€‚åœ¨æŸ¥è¯¢æ—¶é€šè¿‡ WHERE å­å¥ä¸­çš„è¡¨è¾¾å¼é€‰æ‹©æŸ¥è¯¢æ‰€éœ€è¦çš„æŒ‡å®šçš„åˆ†åŒºï¼Œè¿™æ ·çš„æŸ¥è¯¢æ•ˆç‡ä¼šæé«˜å¾ˆå¤šã€‚ ä¸€çº§åˆ†åŒº 12345678910111213141516171819202122232425262728293031323334353637383940# å¼•å…¥åˆ†åŒºè¡¨ï¼ˆéœ€è¦æ ¹æ®æ—¥æœŸå¯¹æ—¥å¿—è¿›è¡Œç®¡ç†ï¼‰/user/hive/warehouse/log_partition/20170702/20170702.log/user/hive/warehouse/log_partition/20170703/20170703.log/user/hive/warehouse/log_partition/20170704/20170704.log# åˆ›å»ºåˆ†åŒºè¡¨è¯­æ³•hive (default)&gt; create table dept_partition( deptno int, dname string, loc string)partitioned by (month string)row format delimited fields terminated by '\\t';# åˆ†åŒºåŸŸå¯¼å…¥æ•°æ®hive (default)&gt; load data local inpath '/opt/module/datas/dept.txt' into tabledefault.dept_partition partition(month='201709');hive (default)&gt; load data local inpath '/opt/module/datas/dept.txt' into tabledefault.dept_partition partition(month='201708');hive (default)&gt; load data local inpath '/opt/module/datas/dept.txt' into tabledefault.dept_partition partition(month='201707â€™);# å•åˆ†åŒºæŸ¥è¯¢hive (default)&gt; select * from dept_partition where month='201709';# å¤šåˆ†åŒºè”åˆæŸ¥è¯¢ unionï¼ˆæ’åºï¼‰ or in ä¸‰ç§æ–¹å¼hive (default)&gt; select * from dept_partition where month='201709'unionselect * from dept_partition where month='201708'unionselect * from dept_partition where month='201707';# å¢åŠ åˆ†åŒºhive (default)&gt; alter table dept_partition add partition(month='201706') ;# åŒæ—¶åˆ›å»ºå¤šä¸ªåˆ†åŒº ç”¨ç©ºæ ¼åˆ†å¼€hive (default)&gt; alter table dept_partition add partition(month='201705') partition(month='201704');# åˆ é™¤å•ä¸ªåˆ†åŒºhive (default)&gt; alter table dept_partition drop partition (month='201704');# åŒæ—¶åˆ é™¤å¤šä¸ªåˆ†åŒº ç”¨é€—å·åˆ†å¼€hive (default)&gt; alter table dept_partition drop partition (month='201705'), partition (month='201706');# æŸ¥çœ‹åˆ†åŒºè¡¨æœ‰å¤šå°‘åˆ†åŒºhive&gt; show partitions dept_partition;# æŸ¥çœ‹åˆ†åŒºè¡¨ç»“æ„hive&gt; desc formatted dept_partition; # Partition Information # col_name data_type # comment month string äºŒçº§åˆ†åŒº 1234567891011121314151617181920212223242526272829303132333435# åˆ›å»ºäºŒçº§åˆ†åŒºè¡¨hive (default)&gt; create table dept_partition2( deptno int, dname string, loc string)partitioned by (month string, day string)row format delimited fields terminated by '\\t';# åŠ è½½æ•°æ®åˆ°äºŒçº§åˆ†åŒºè¡¨ä¸­hive (default)&gt; load data local inpath '/opt/module/datas/dept.txt' into table default.dept_partition2 partition(month='201709', day='13');hive (default)&gt; select * from dept_partition2 where month='201709' and day='13';# æŠŠæ•°æ®ç›´æ¥ä¸Šä¼ åˆ°åˆ†åŒºç›®å½•ä¸Šï¼Œè®©åˆ†åŒºè¡¨å’Œæ•°æ®äº§ç”Ÿå…³è”çš„ä¸‰ç§æ–¹å¼# æ–¹å¼ä¸€ï¼šä¸Šä¼ æ•°æ®åä¿®å¤# ä¸Šä¼ æ•°æ®hive (default)&gt; dfs -mkdir -p /user/hive/warehouse/dept_partition2/month=201709/day=12;hive (default)&gt; dfs -put /opt/module/datas/dept.txt /user/hive/warehouse/dept_partition2/month=201709/day=12; # æŸ¥è¯¢æ•°æ®ï¼ˆæŸ¥è¯¢ä¸åˆ°åˆšä¸Šä¼ çš„æ•°æ®ï¼‰hive (default)&gt; select * from dept_partition2 where month='201709' and day='12'; # æ‰§è¡Œä¿®å¤å‘½ä»¤hive&gt; msck repair table dept_partition2; # å†æ¬¡æŸ¥è¯¢æ•°æ®hive (default)&gt; select * from dept_partition2 where month='201709' and day='12';# æ–¹å¼äºŒï¼šä¸Šä¼ æ•°æ®åæ·»åŠ åˆ†åŒº# ä¸Šä¼ æ•°æ®hive (default)&gt; dfs -mkdir -p /user/hive/warehouse/dept_partition2/month=201709/day=11;hive (default)&gt; dfs -put /opt/module/datas/dept.txt /user/hive/warehouse/dept_partition2/month=201709/day=11; # æ‰§è¡Œæ·»åŠ åˆ†åŒºhive (default)&gt; alter table dept_partition2 add partition(month='201709',day='11'); # æŸ¥è¯¢æ•°æ®hive (default)&gt; select * from dept_partition2 where month='201709' and day='11';# æ–¹å¼ä¸‰ï¼šä¸Šä¼ æ•°æ®å load æ•°æ®åˆ°åˆ†åŒº# åˆ›å»ºç›®å½•hive (default)&gt; dfs -mkdir -p /user/hive/warehouse/dept_partition2/month=201709/day=10; # ä¸Šä¼ æ•°æ®hive (default)&gt; load data local inpath '/opt/module/datas/dept.txt' into table dept_partition2 partition(month='201709',day='10');# æŸ¥è¯¢æ•°æ®hive (default)&gt; select * from dept_partition2 where month='201709' and day='10'; åˆ—ä¿¡æ¯1234# æ›´æ–°åˆ—ALTER TABLE table_name CHANGE [COLUMN] col_old_name col_new_name column_type [COMMENT col_comment] [FIRST|AFTER column_name]ALTER TABLE table_name ADD|REPLACE COLUMNS (col_name data_type [COMMENT col_comment], ...)# ADD æ˜¯ä»£è¡¨æ–°å¢ä¸€å­—æ®µï¼Œå­—æ®µä½ç½®åœ¨æ‰€æœ‰åˆ—åé¢ï¼ˆpartition åˆ—å‰ï¼‰ï¼ŒREPLACE åˆ™æ˜¯è¡¨ç¤ºæ›¿æ¢è¡¨ä¸­æ‰€æœ‰å­—æ®µ åˆ é™¤è¡¨1hive (default)&gt; drop table [table_name]; DMLæ•°æ®å¯¼å…¥123456789# åˆ›å»ºä¸€å¼ è¡¨hive (default)&gt; create table student(id string, name string) row format delimited fields terminated by '\\t';# åŠ è½½æœ¬åœ°æ–‡ä»¶åˆ° hivehive (default)&gt; load data local inpath '/opt/module/datas/student.txt' into table default.student;# åŠ è½½ HDFS æ–‡ä»¶åˆ° hive ä¸­# ä¸Šä¼ æ–‡ä»¶åˆ° HDFShive (default)&gt; dfs -put /opt/module/datas/student.txt /user/atguigu/hive;# åŠ è½½ HDFS ä¸Šçš„æ•°æ®hive (default)&gt; load data inpath '/user/atguigu/hive/student.txt' into table default.student; åŠ è½½æ•°æ®è¦†ç›–è¡¨ä¸­å·²æœ‰çš„æ•°æ®ã€‚ 1234# ä¸Šä¼ æ–‡ä»¶åˆ° HDFShive (default)&gt; dfs -put /opt/module/datas/student.txt /user/atguigu/hive;# åŠ è½½æ•°æ®è¦†ç›–è¡¨ä¸­å·²æœ‰çš„æ•°æ®hive (default)&gt; load data inpath '/user/atguigu/hive/student.txt' overwrite into table default.student; é€šè¿‡æŸ¥è¯¢è¯­å¥å‘è¡¨ä¸­æ’å…¥æ•°æ®ï¼ˆInsertï¼‰ã€‚ 12345678910111213# åˆ›å»ºä¸€å¼ åˆ†åŒºè¡¨hive (default)&gt; create table student(id int, name string) partitioned by (month string) row format delimited fields terminated by '\\t';# åŸºæœ¬æ’å…¥æ•°æ®hive (default)&gt; insert into table student partition(month='201709') values(1,'wangwu');# åŸºæœ¬æ¨¡å¼æ’å…¥ï¼ˆæ ¹æ®å•å¼ è¡¨æŸ¥è¯¢ç»“æœï¼‰hive (default)&gt; insert overwrite table student partition(month='201708') select id, name from student where month='201709';# å¤šæ’å…¥æ¨¡å¼ï¼ˆæ ¹æ®å¤šå¼ è¡¨æŸ¥è¯¢ç»“æœï¼‰hive (default)&gt; from student insert overwrite table student partition(month='201707') select id, name where month='201709' insert overwrite table student partition(month='201706') select id, name where month='201709'; æŸ¥è¯¢è¯­å¥ä¸­åˆ›å»ºè¡¨å¹¶åŠ è½½æ•°æ®ï¼ˆAs Selectï¼‰ã€‚ 12# æ ¹æ®æŸ¥è¯¢ç»“æœåˆ›å»ºè¡¨ï¼ˆæŸ¥è¯¢çš„ç»“æœä¼šæ·»åŠ åˆ°æ–°åˆ›å»ºçš„è¡¨ä¸­ï¼‰create table if not exists student_new as select id, name from student; åˆ›å»ºè¡¨æ—¶é€šè¿‡ Location æŒ‡å®šåŠ è½½æ•°æ®è·¯å¾„. 12345678910# åˆ›å»ºè¡¨ï¼Œå¹¶æŒ‡å®šåœ¨ hdfs ä¸Šçš„ä½ç½®hive (default)&gt; create table if not exists student( id int, name string)row format delimited fields terminated by '\\t'location '/user/hive/warehouse/student';# ä¸Šä¼ æ•°æ®åˆ° hdfs ä¸Šhive (default)&gt; dfs -put /opt/module/datas/student.txt /user/hive/warehouse/student;# æŸ¥è¯¢æ•°æ®hive (default)&gt; select * from student; Import æ•°æ®ï¼ˆexport åˆ°å¤„çš„æ•°æ®ï¼‰åˆ°æŒ‡å®š Hive è¡¨ä¸­ã€‚ 1hive (default)&gt; import table student partition(month='201709') from '/user/hive/warehouse/export/student'; æ•°æ®å¯¼å‡º Insert å¯¼å‡ºã€‚ 123456# å°†æŸ¥è¯¢çš„ç»“æœå¯¼å‡ºåˆ°æœ¬åœ°hive (default)&gt; insert overwrite local directory '/opt/module/datas/export/student' select * from student;# å°†æŸ¥è¯¢çš„ç»“æœæ ¼å¼åŒ–å¯¼å‡ºåˆ°æœ¬åœ°hive (default)&gt; insert overwrite local directory '/opt/module/datas/export/student' ROW FORMAT DELIMITED FIELDS TERMINATED BY '\\t' select * from student;# å°†æŸ¥è¯¢çš„ç»“æœå¯¼å‡ºåˆ° HDFS ä¸Šï¼ˆæ²¡æœ‰ localï¼‰hive (default)&gt; insert overwrite directory '/user/wingo/student' ROW FORMAT DELIMITED FIELDS TERMINATED BY '\\t' select * from student; Hadoop å‘½ä»¤å¯¼å‡ºåˆ°æœ¬åœ°ã€‚ 1hive (default)&gt; dfs -get /user/hive/warehouse/student/month=201709/000000_0 /opt/module/datas/export/student.txt; Hive Shell å‘½ä»¤å¯¼å‡ºã€‚ 1bin/hive -e 'select * from default.student;' &gt; /opt/module/datas/export/student.txt; Export å¯¼å‡ºåˆ° HDFS ä¸Šã€‚ 1hive (default) &gt;export table default.student to '/user/hive/warehouse/export/student'; æ¸…é™¤è¡¨ Truncate åªèƒ½åˆ é™¤ç®¡ç†è¡¨ï¼Œä¸èƒ½åˆ é™¤å¤–éƒ¨è¡¨ä¸­æ•°æ®ã€‚ 1hive (default)&gt; truncate table student; æŸ¥è¯¢ åŸºæœ¬æŸ¥è¯¢ 123456# å…¨è¡¨æŸ¥è¯¢hive (default)&gt; select * from emp;# é€‰æ‹©ç‰¹å®šåˆ—æŸ¥è¯¢hive (default)&gt; select empno, ename from emp;# åˆ—åˆ«åhive (default)&gt; select ename AS name, deptno dn from emp; è¿ç®—ç¬¦æŸ¥è¯¢ 12# ç®—æœ¯è¿ç®—ç¬¦ï¼šæŸ¥è¯¢å‡ºæ‰€æœ‰å‘˜å·¥çš„è–ªæ°´ååŠ  1 æ˜¾ç¤ºhive (default)&gt; select sal+1 from emp; å‡½æ•°æŸ¥è¯¢ 12345678910# æ±‚æ€»è¡Œæ•°ï¼ˆcountï¼‰hive (default)&gt; select count(*) cnt from emp;# æ±‚å·¥èµ„çš„æœ€å¤§å€¼ï¼ˆmaxï¼‰hive (default)&gt; select max(sal) max_sal from emp;# æ±‚å·¥èµ„çš„æœ€å°å€¼ï¼ˆminï¼‰hive (default)&gt; select min(sal) min_sal from emp;# æ±‚å·¥èµ„çš„æ€»å’Œï¼ˆsumï¼‰hive (default)&gt; select sum(sal) sum_sal from emp;# æ±‚å·¥èµ„çš„å¹³å‡å€¼ï¼ˆavgï¼‰hive (default)&gt; select avg(sal) avg_sal from emp; Limit è¯­å¥ å…¸å‹çš„æŸ¥è¯¢ä¼šè¿”å›å¤šè¡Œæ•°æ®ã€‚LIMIT å­å¥ç”¨äºé™åˆ¶è¿”å›çš„è¡Œæ•°ã€‚ 1hive (default)&gt; select * from emp limit 5; Where12# æŸ¥è¯¢å‡ºè–ªæ°´å¤§äº 1000 çš„æ‰€æœ‰å‘˜å·¥hive (default)&gt; select * from emp where sal &gt;1000; æ¯”è¾ƒè¿ç®—ç¬¦ï¼ˆBetween/In/ Is Nullï¼‰ï¼Œè¿™äº›æ“ä½œç¬¦åŒæ ·å¯ä»¥ç”¨äº JOINâ€¦ON å’Œ HAVING è¯­å¥ä¸­ã€‚ 12345678# æŸ¥è¯¢å‡ºè–ªæ°´ç­‰äº 5000 çš„æ‰€æœ‰å‘˜å·¥hive (default)&gt; select * from emp where sal =5000;# æŸ¥è¯¢å·¥èµ„åœ¨ 500 åˆ° 1000 çš„å‘˜å·¥ä¿¡æ¯hive (default)&gt; select * from emp where sal between 500 and 1000;# æŸ¥è¯¢ comm ä¸ºç©ºçš„æ‰€æœ‰å‘˜å·¥ä¿¡æ¯hive (default)&gt; select * from emp where comm is null;# æŸ¥è¯¢å·¥èµ„æ˜¯ 1500 å’Œ 5000 çš„å‘˜å·¥ä¿¡æ¯hive (default)&gt; select * from emp where sal IN (1500, 5000); Like å’Œ RLike % ä»£è¡¨é›¶ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ï¼ˆä»»æ„ä¸ªå­—ç¬¦ï¼‰ï¼›_ ä»£è¡¨ä¸€ä¸ªå­—ç¬¦RLIKE å­å¥æ˜¯ Hive ä¸­è¿™ä¸ªåŠŸèƒ½çš„ä¸€ä¸ªæ‰©å±•ï¼Œå…¶å¯ä»¥é€šè¿‡ Java çš„æ­£åˆ™è¡¨è¾¾å¼è¿™ä¸ªæ›´å¼ºå¤§çš„è¯­è¨€æ¥æŒ‡å®šåŒ¹é…æ¡ä»¶ã€‚ 123456# æŸ¥æ‰¾ä»¥ 2 å¼€å¤´è–ªæ°´çš„å‘˜å·¥ä¿¡æ¯hive (default)&gt; select * from emp where sal LIKE '2%';# æŸ¥æ‰¾ç¬¬äºŒä¸ªæ•°å€¼ä¸º 2 çš„è–ªæ°´çš„å‘˜å·¥ä¿¡æ¯hive (default)&gt; select * from emp where sal LIKE '_2%';# æŸ¥æ‰¾è–ªæ°´ä¸­å«æœ‰ 2 çš„å‘˜å·¥ä¿¡æ¯hive (default)&gt; select * from emp where sal RLIKE '[2]'; é€»è¾‘è¿ç®—ç¬¦ï¼ˆAnd/Or/Notï¼‰ 123456# æŸ¥è¯¢è–ªæ°´å¤§äº 1000ï¼Œéƒ¨é—¨æ˜¯ 30hive (default)&gt; select * from emp where sal&gt;1000 and deptno=30;# æŸ¥è¯¢è–ªæ°´å¤§äº 1000ï¼Œæˆ–è€…éƒ¨é—¨æ˜¯ 30hive (default)&gt; select * from emp where sal&gt;1000 or deptno=30;# æŸ¥è¯¢é™¤äº† 20 éƒ¨é—¨å’Œ 30 éƒ¨é—¨ä»¥å¤–çš„å‘˜å·¥ä¿¡æ¯hive (default)&gt; select * from emp where deptno not IN(30, 20); åˆ†ç»„ GROUP BY è¯­å¥é€šå¸¸ä¼šå’Œèšåˆå‡½æ•°ä¸€èµ·ä½¿ç”¨ï¼ŒæŒ‰ç…§ä¸€ä¸ªæˆ–è€…å¤šä¸ªåˆ—é˜Ÿç»“æœè¿›è¡Œåˆ†ç»„ï¼Œç„¶åå¯¹æ¯ä¸ªç»„æ‰§è¡Œèšåˆæ“ä½œã€‚ 1234# è®¡ç®— emp è¡¨æ¯ä¸ªéƒ¨é—¨çš„å¹³å‡å·¥èµ„hive (default)&gt; select t.deptno, avg(t.sal) avg_sal from emp t group by t.deptno;# è®¡ç®— emp æ¯ä¸ªéƒ¨é—¨ä¸­æ¯ä¸ªå²—ä½çš„æœ€é«˜è–ªæ°´hive (default)&gt; select t.deptno, t.job, max(t.sal) max_sal from emp t group by t.deptno, t.job; Having è¯­å¥ where é’ˆå¯¹è¡¨ä¸­çš„åˆ—å‘æŒ¥ä½œç”¨ï¼ŒæŸ¥è¯¢æ•°æ®ï¼›Having é’ˆå¯¹æŸ¥è¯¢ç»“æœä¸­çš„åˆ—å‘æŒ¥ä½œç”¨ï¼Œ ç­›é€‰æ•°æ®ã€‚ 12# æ±‚æ¯ä¸ªéƒ¨é—¨çš„å¹³å‡è–ªæ°´å¤§äº 2000 çš„éƒ¨é—¨hive (default)&gt; select deptno, avg(sal) avg_sal from emp group by deptno having avg_sal &gt; 2000; Join æ˜¯åªæ”¯æŒç­‰å€¼è¿æ¥ï¼Œä¸æ”¯æŒéç­‰å€¼è¿æ¥ 123456789101112# æ ¹æ®å‘˜å·¥è¡¨å’Œéƒ¨é—¨è¡¨ä¸­çš„éƒ¨é—¨ç¼–å·ç›¸ç­‰ï¼ŒæŸ¥è¯¢å‘˜å·¥ç¼–å·ã€å‘˜å·¥åç§°å’Œéƒ¨é—¨ç¼–å·ï¼›hive (default)&gt; select e.empno, e.ename, d.deptno, d.dname from emp e join dept d on e.deptno = d.deptno;# åˆå¹¶å‘˜å·¥è¡¨å’Œéƒ¨é—¨è¡¨hive (default)&gt; select e.empno, e.ename, d.deptno from emp e join dept d on e.deptno = d.deptno;# å†…è¿æ¥ï¼šåªæœ‰è¿›è¡Œè¿æ¥çš„ä¸¤ä¸ªè¡¨ä¸­éƒ½å­˜åœ¨ä¸è¿æ¥æ¡ä»¶ç›¸åŒ¹é…çš„æ•°æ®æ‰ä¼šè¢«ä¿ç•™ä¸‹æ¥ã€‚hive (default)&gt; select e.empno, e.ename, d.deptno from emp e join dept d on e.deptno = d.deptno;# å·¦å¤–è¿æ¥ï¼šJOIN æ“ä½œç¬¦å·¦è¾¹è¡¨ä¸­ç¬¦åˆ WHERE å­å¥çš„æ‰€æœ‰è®°å½•å°†ä¼šè¢«è¿”å›ã€‚hive (default)&gt; select e.empno, e.ename, d.deptno from emp e left join dept d on e.deptno = d.deptno;# å³å¤–è¿æ¥ï¼šJOIN æ“ä½œç¬¦å³è¾¹è¡¨ä¸­ç¬¦åˆ WHERE å­å¥çš„æ‰€æœ‰è®°å½•å°†ä¼šè¢«è¿”å›ã€‚hive (default)&gt; select e.empno, e.ename, d.deptno from emp e right join dept d on e.deptno = d.deptno;# æ»¡å¤–è¿æ¥ï¼šå°†ä¼šè¿”å›æ‰€æœ‰è¡¨ä¸­ç¬¦åˆ WHERE è¯­å¥æ¡ä»¶çš„æ‰€æœ‰è®°å½•ã€‚å¦‚æœä»»ä¸€è¡¨çš„æŒ‡å®šå­—æ®µæ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„å€¼çš„è¯ï¼Œé‚£ä¹ˆå°±ä½¿ç”¨ NULL å€¼æ›¿ä»£ã€‚hive (default)&gt; select e.empno, e.ename, d.deptno from emp e full join dept d on e.deptno = d.deptno; å¤šè¡¨è¿æ¥ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒHive ä¼šå¯¹æ¯å¯¹ JOIN è¿æ¥å¯¹è±¡å¯åŠ¨ä¸€ä¸ª MapReduce ä»»åŠ¡ã€‚Hive æ€»æ˜¯æŒ‰ç…§ä»å·¦åˆ°å³çš„ é¡ºåºæ‰§è¡Œçš„ã€‚ æ’åºå…¨å±€æ’åº Order Byï¼šå…¨å±€æ’åºï¼Œä¸€ä¸ª MapReduceã€‚ ASCï¼ˆascendï¼‰: å‡åºï¼ˆé»˜è®¤ï¼‰ï¼›DESCï¼ˆdescendï¼‰: é™åºã€‚ 12345678# æŸ¥è¯¢å‘˜å·¥ä¿¡æ¯æŒ‰å·¥èµ„å‡åºæ’åˆ—hive (default)&gt; select * from emp order by sal;# æŸ¥è¯¢å‘˜å·¥ä¿¡æ¯æŒ‰å·¥èµ„é™åºæ’åˆ—hive (default)&gt; select * from emp order by sal desc;# æŒ‰ç…§åˆ«åæ’åºï¼ŒæŒ‰ç…§å‘˜å·¥è–ªæ°´çš„ 2 å€æ’åºhive (default)&gt; select ename, sal*2 twosal from emp order by twosal;# æŒ‰ç…§éƒ¨é—¨å’Œå·¥èµ„å‡åºæ’åºhive (default)&gt; select ename, deptno, sal from emp order by deptno, sal ; å†…éƒ¨æ’åº æ¯ä¸ª MapReduce å†…éƒ¨æ’åºï¼ˆSort Byï¼‰ã€‚ Sort Byï¼šæ¯ä¸ª MapReduce å†…éƒ¨è¿›è¡Œæ’åºï¼Œå¯¹å…¨å±€ç»“æœé›†æ¥è¯´ä¸æ˜¯æ’åºã€‚ 1234567# è®¾ç½® reduce ä¸ªæ•°hive (default)&gt; set mapreduce.job.reduces=3;# æŸ¥çœ‹è®¾ç½® reduce ä¸ªæ•°hive (default)&gt; set mapreduce.job.reduces;# æ ¹æ®éƒ¨é—¨ç¼–å·é™åºæŸ¥çœ‹å‘˜å·¥ä¿¡æ¯hive (default)&gt; select * from emp sort by empno desc;hive (default)&gt; insert overwrite local directory '/opt/module/datas/sortby-result' select * from emp sort by deptno desc; åˆ†åŒºæ’åº Distribute Byï¼šç±»ä¼¼ MR ä¸­ partitionï¼Œè¿›è¡Œåˆ†åŒºï¼Œç»“åˆ sort by ä½¿ç”¨ã€‚ Hive è¦æ±‚ DISTRIBUTE BY è¯­å¥è¦å†™åœ¨ SORT BY è¯­å¥ä¹‹å‰ 1234# å…ˆæŒ‰ç…§éƒ¨é—¨ç¼–å·åˆ†åŒºï¼Œå†æŒ‰ç…§å‘˜å·¥ç¼–å·é™åºæ’åºã€‚hive (default)&gt; set mapreduce.job.reduces=3;hive (default)&gt; insert overwrite local directory '/opt/module/datas/distribute-result' select * from emp distribute by deptno sort by empno desc; Cluster By é™¤äº†å…·æœ‰ Distribute By çš„åŠŸèƒ½å¤–è¿˜å…¼å…· Sort By çš„åŠŸèƒ½ã€‚ä½†æ˜¯æ’åºåªèƒ½æ˜¯å€’åºæ’åºï¼Œä¸èƒ½æŒ‡å®šæ’åºè§„åˆ™ä¸º ASC æˆ–è€… DESCã€‚ 123hive (default)&gt; select * from emp cluster by deptno;# ç­‰ä»·äºhive (default)&gt; select * from emp distribute by deptno sort by deptno; æ¡¶ åˆ†åŒºé’ˆå¯¹çš„æ˜¯æ•°æ®çš„å­˜å‚¨è·¯å¾„ï¼›åˆ†æ¡¶é’ˆå¯¹çš„æ˜¯æ•°æ®æ–‡ä»¶ã€‚ 123456789101112131415161718192021222324252627282930# ç¬¬ä¸€æ¬¡å°è¯•# åˆ›å»ºåˆ†æ¡¶è¡¨ï¼ŒæŒ‰ id å–æ¨¡create table stu_buck(id int, name string) clustered by(id) into 4 buckets row format delimited fields terminated by '\\t';# æŸ¥çœ‹è¡¨ç»“æ„hive (default)&gt; desc formatted stu_buck; # Num Buckets: 4# å¯¼å…¥æ•°æ®åˆ°åˆ†æ¡¶è¡¨ä¸­ï¼Œç›´æ¥ load ä¸ä¼šè¿›è¡Œåˆ†æ¡¶ï¼Œè¿˜æ˜¯ä¸€æ•´ä¸ªæ–‡ä»¶ï¼Œé‚£ä¹ˆé€šè¿‡ MR å¯¼å…¥å‘¢ï¼Ÿhive (default)&gt; load data local inpath '/opt/module/datas/student.txt' into table stu_buck;# ç¬¬äºŒæ¬¡å°è¯•ï¼Œåˆ›å»ºåˆ†æ¡¶è¡¨æ—¶ï¼Œæ•°æ®é€šè¿‡å­æŸ¥è¯¢çš„æ–¹å¼å¯¼å…¥# åˆ›å»ºç”¨äºå­æŸ¥è¯¢çš„è¡¨create table stu(id int, name string) row format delimited fields terminated by '\\t';# å‘æ™®é€šçš„ stu è¡¨ä¸­å¯¼å…¥æ•°æ®load data local inpath '/opt/module/datas/student.txt' into table stu;# æ¸…ç©º stu_buck è¡¨ä¸­æ•°æ®truncate table stu_buck;select * from stu_buck;# å¯¼å…¥æ•°æ®åˆ°åˆ†æ¡¶è¡¨ï¼Œé€šè¿‡å­æŸ¥è¯¢çš„æ–¹å¼insert into table stu_buck select id, name from stu;# å‘ç°è¿˜æ˜¯åªæœ‰ä¸€ä¸ªåˆ†æ¡¶# éœ€è¦è®¾ç½®ä¸€ä¸ªå±æ€§hive (default)&gt; set hive.enforce.bucketing=true;hive (default)&gt; set mapreduce.job.reduces=-1;hive (default)&gt; insert into table stu_buck select id, name from stu;# æŸ¥è¯¢åˆ†æ¡¶çš„æ•°æ®ï¼Œåˆ†æ¡¶æˆåŠŸhive (default)&gt; select * from stu_buck; åˆ†æ¡¶æŠ½æ ·æŸ¥è¯¢ å¯¹äºéå¸¸å¤§çš„æ•°æ®é›†ï¼Œæœ‰æ—¶ç”¨æˆ·éœ€è¦ä½¿ç”¨çš„æ˜¯ä¸€ä¸ªå…·æœ‰ä»£è¡¨æ€§çš„æŸ¥è¯¢ç»“æœè€Œä¸æ˜¯å…¨éƒ¨ç»“ æœã€‚Hive å¯ä»¥é€šè¿‡å¯¹è¡¨è¿›è¡ŒæŠ½æ ·æ¥æ»¡è¶³è¿™ä¸ªéœ€æ±‚ã€‚ 12# æŸ¥è¯¢è¡¨ stu_buck ä¸­çš„æ•°æ®hive (default)&gt; select * from stu_buck tablesample (bucket 1 out of 4 on id); TABLESAMPLE(BUCKET x OUT OF y) y å¿…é¡»æ˜¯ table æ€» bucket æ•°çš„å€æ•°æˆ–è€…å› å­ã€‚hive æ ¹æ® y çš„å¤§å°ï¼Œå†³å®šæŠ½æ ·çš„æ¯”ä¾‹ã€‚table æ€» bucket æ•°ä¸º 4ï¼Œtablesample(bucket 1 out of 2)ï¼Œè¡¨ç¤ºæ€»å…±æŠ½å–ï¼ˆ4/2=ï¼‰2 ä¸ª bucket çš„æ•°æ®ï¼ŒæŠ½å–ç¬¬ 1(x) ä¸ªå’Œç¬¬ 4(x+y) ä¸ª bucket çš„æ•°æ®ã€‚ å…¶å®ƒç©ºå­—æ®µèµ‹å€¼12# å¦‚æœå‘˜å·¥çš„ comm ä¸º NULLï¼Œåˆ™ç”¨-1 ä»£æ›¿hive (default)&gt; select nvl(comm,-1) from emp; CASE WHEN 12345678910111213141516171819202122232425262728# æ±‚å‡ºä¸åŒéƒ¨é—¨ç”·å¥³å„å¤šå°‘äººvi emp_sex.txt # æ‚Ÿç©º A ç”· # å¤§æµ· A ç”· # å®‹å®‹ B ç”· # å‡¤å§ A å¥³ # å©·å§ B å¥³ # å©·å©· B å¥³# åˆ›å»º hive è¡¨å¹¶å¯¼å…¥æ•°æ®create table emp_sex( name string, dept_id int, sex string)row format delimited fields terminated by \"\\t\";load data local inpath '/opt/module/datas/emp_sex.txt' into table emp_sex;# æŒ‰éœ€æ±‚æŸ¥è¯¢æ•°æ®select dept_id, sum(case sex when 'ç”·' then 1 else 0 end) male_count, sum(case sex when 'å¥³' then 1 else 0 end) female_countfrom emp_sexgroup by dept_id;# ç»“æœ # A 2 1 # B 1 2 è¡Œè½¬åˆ— CONCAT(string A/col, string B/colâ€¦)ï¼šè¿”å›è¾“å…¥å­—ç¬¦ä¸²è¿æ¥åçš„ç»“æœï¼Œæ”¯æŒä»»æ„ä¸ªè¾“å…¥ å­—ç¬¦ä¸²ï¼› CONCAT_WS(separator, str1, str2,â€¦)ï¼šå®ƒæ˜¯ä¸€ä¸ªç‰¹æ®Šå½¢å¼çš„ CONCAT()ã€‚ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºå‚æ•°é—´çš„åˆ†éš”ç¬¦ã€‚åˆ†éš”ç¬¦å¯ä»¥æ˜¯ä¸å‰©ä½™å‚æ•°ä¸€æ ·çš„å­—ç¬¦ä¸²ã€‚å¦‚æœåˆ†éš”ç¬¦æ˜¯ NULLï¼Œ è¿”å›å€¼ä¹Ÿå°†ä¸º NULLã€‚è¿™ä¸ªå‡½æ•°ä¼šè·³è¿‡åˆ†éš”ç¬¦å‚æ•°åçš„ä»»ä½• NULL å’Œç©ºå­—ç¬¦ä¸²ã€‚åˆ†éš”ç¬¦å°†è¢«åŠ åˆ°è¢«è¿æ¥çš„å­—ç¬¦ä¸²ä¹‹é—´ï¼› COLLECT_SET(col)ï¼šå‡½æ•°åªæ¥å—åŸºæœ¬æ•°æ®ç±»å‹ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯å°†æŸå­—æ®µçš„å€¼è¿›è¡Œå»é‡æ±‡æ€»ï¼Œäº§ç”Ÿ array ç±»å‹å­—æ®µã€‚ 1234567891011121314151617181920212223242526272829vi constellation.txt # å­™æ‚Ÿç©º ç™½ç¾Šåº§ A # å¤§æµ· å°„æ‰‹åº§ A # å®‹å®‹ ç™½ç¾Šåº§ B # çŒªå…«æˆ’ ç™½ç¾Šåº§ A # å‡¤å§ å°„æ‰‹åº§ A# æŒ‰æ•°æ®æ ¼å¼åˆ›å»ºè¡¨create table person_info( name string, constellation string, blood_type string)row format delimited fields terminated by \"\\t\";load data local inpath â€œ/opt/module/datas/person_info.txtâ€ into table person_info;# æŒ‰éœ€æ±‚æŸ¥è¯¢æ•°æ®select t1.base, concat_ws('|', collect_set(t1.name)) namefrom (select name,concat(constellation, \",\", blood_type) base # æ˜Ÿåº§,è¡€å‹ from person_info ) t1group by t1.base;# ç»“æœ # å°„æ‰‹åº§,A å¤§æµ·|å‡¤å§ # ç™½ç¾Šåº§,A å­™æ‚Ÿç©º|çŒªå…«æˆ’ # ç™½ç¾Šåº§,B å®‹å®‹ åˆ—è½¬è¡Œ EXPLODE(col)ï¼šå°† hive ä¸€åˆ—ä¸­å¤æ‚çš„ array æˆ–è€… map ç»“æ„æ‹†åˆ†æˆå¤šè¡Œã€‚ LATERAL VIEW ç”¨æ³•ï¼šLATERAL VIEW udtf(expression) tableAlias AS columnAliasè§£é‡Šï¼šä¸ split, explode ç­‰ UDTF ä¸€èµ·ä½¿ç”¨ï¼Œå®ƒèƒ½å¤Ÿå°†ä¸€åˆ—æ•°æ®æ‹†æˆå¤šè¡Œæ•°æ®ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šå¯ä»¥å¯¹æ‹†åˆ†åçš„æ•°æ®è¿›è¡Œèšåˆã€‚ 1234567891011121314151617181920212223242526272829303132# åˆ›å»ºæœ¬åœ° movie.txtï¼Œå¯¼å…¥æ•°æ®vi movie.txt # ã€Šç–‘çŠ¯è¿½è¸ªã€‹ æ‚¬ç–‘,åŠ¨ä½œ,ç§‘å¹»,å‰§æƒ… # ã€ŠLie to meã€‹ æ‚¬ç–‘,è­¦åŒª,åŠ¨ä½œ,å¿ƒç†,å‰§æƒ… # ã€Šæˆ˜ç‹¼ 2ã€‹ æˆ˜äº‰,åŠ¨ä½œ,ç¾éš¾create table movie_info( movie string, category array&lt;string&gt;)row format delimited fields terminated by \"\\t\"collection items terminated by \",\";load data local inpath \"/opt/module/datas/movie.txt\" into table movie_info;# æŒ‰éœ€æ±‚æŸ¥è¯¢æ•°æ®select movie,category_namefrom movie_info lateral view explode(category) table_tmp as category_name;# ç»“æœ # ã€Šç–‘çŠ¯è¿½è¸ªã€‹ æ‚¬ç–‘ # ã€Šç–‘çŠ¯è¿½è¸ªã€‹ åŠ¨ä½œ # ã€Šç–‘çŠ¯è¿½è¸ªã€‹ ç§‘å¹» # ã€Šç–‘çŠ¯è¿½è¸ªã€‹ å‰§æƒ… # ã€ŠLie to meã€‹ æ‚¬ç–‘ # ã€ŠLie to meã€‹ è­¦åŒª # ã€ŠLie to meã€‹ åŠ¨ä½œ # ã€ŠLie to meã€‹ å¿ƒç† # ã€ŠLie to meã€‹ å‰§æƒ… # ã€Šæˆ˜ç‹¼ 2ã€‹ æˆ˜äº‰ # ã€Šæˆ˜ç‹¼ 2ã€‹ åŠ¨ä½œ # ã€Šæˆ˜ç‹¼ 2ã€‹ ç¾éš¾ çª—å£å‡½æ•° OVER()ï¼šæŒ‡å®šåˆ†æå‡½æ•°å·¥ä½œçš„æ•°æ®çª—å£å¤§å°ï¼Œè¿™ä¸ªæ•°æ®çª—å£å¤§å°å¯èƒ½ä¼šéšç€è¡Œçš„å˜è€Œå˜åŒ–ï¼›CURRENT ROWï¼šå½“å‰è¡Œï¼›n PRECEDINGï¼šå¾€å‰ n è¡Œæ•°æ®ï¼›n FOLLOWINGï¼šå¾€å n è¡Œæ•°æ®ï¼›UNBOUNDEDï¼šèµ·ç‚¹ï¼ŒUNBOUNDED PRECEDING è¡¨ç¤ºä»å‰é¢çš„èµ·ç‚¹ï¼ŒUNBOUNDED FOLLOWING è¡¨ç¤ºåˆ°åé¢çš„ç»ˆç‚¹ï¼›LAG(col,n)ï¼šå¾€å‰ç¬¬ n è¡Œæ•°æ®LEAD(col,n)ï¼šå¾€åç¬¬ n è¡Œæ•°æ®NTILE(n)ï¼šæŠŠæœ‰åºåˆ†åŒºä¸­çš„è¡Œåˆ†å‘åˆ°æŒ‡å®šæ•°æ®çš„ç»„ä¸­ï¼Œå„ä¸ªç»„æœ‰ç¼–å·ï¼Œç¼–å·ä» 1 å¼€å§‹ï¼Œ å¯¹äºæ¯ä¸€è¡Œï¼ŒNTILE è¿”å›æ­¤è¡Œæ‰€å±çš„ç»„çš„ç¼–å·ã€‚æ³¨æ„ï¼šn å¿…é¡»ä¸º int ç±»å‹ã€‚ 12345678910111213141516# æ•°æ®å‡†å¤‡name,orderdate,costjack,2017-01-01,10tony,2017-01-02,15jack,2017-02-03,23tony,2017-01-04,29jack,2017-01-05,46jack,2017-04-06,42tony,2017-01-07,50jack,2017-01-08,55mart,2017-04-08,62mart,2017-04-09,68neil,2017-05-10,12mart,2017-04-11,75neil,2017-06-12,80mart,2017-04-13,94 1234567891011121314151617181920212223242526272829303132333435363738394041# åˆ›å»ºæœ¬åœ° business.txtï¼Œå¯¼å…¥æ•°æ®vi business.txt# åˆ›å»º hive è¡¨å¹¶å¯¼å…¥æ•°æ®create table business( name string, orderdate string,cost int) ROW FORMAT DELIMITED FIELDS TERMINATED BY ',';load data local inpath \"/opt/module/datas/business.txt\" into table business;# æŸ¥è¯¢åœ¨ 2017 å¹´ 4 æœˆä»½è´­ä¹°è¿‡çš„é¡¾å®¢åŠæ€»äººæ•°select name,count(*) over() # group by ç»Ÿè®¡æ¯ä¸€æ¬¡æ¡ä»¶ä¸‹çš„æ•°æ®ï¼›over() å¼€çª—æŠŠæ•´ä¸ªæ•°æ®å³å¼€ç»™ä½ ç”¨from businesswhere substring(orderdate,1,7) = '2017-04'group by name;# æŸ¥è¯¢é¡¾å®¢çš„è´­ä¹°æ˜ç»†åŠæœˆè´­ä¹°æ€»é¢select name,orderdate,cost,sum(cost) over(partition by month(orderdate)) from business;# ä¸Šè¿°çš„åœºæ™¯,è¦å°† cost æŒ‰ç…§æ—¥æœŸè¿›è¡Œç´¯åŠ select name,orderdate,cost,sum(cost) over() as sample1,-- æ‰€æœ‰è¡Œç›¸åŠ sum(cost) over(partition by name) as sample2,-- æŒ‰ name åˆ†ç»„ï¼Œç»„å†…æ•°æ®ç›¸åŠ sum(cost) over(partition by name order by orderdate) as sample3,-- æŒ‰ name åˆ†ç»„ï¼Œç»„å†…æ•°æ®ç´¯åŠ sum(cost) over(partition by name order by orderdate rows between UNBOUNDED PRECEDINGand current row ) as sample4 ,-- å’Œ sample3 ä¸€æ ·,ç”±èµ·ç‚¹åˆ°å½“å‰è¡Œçš„èšåˆsum(cost) over(partition by name order by orderdate rows between 1 PRECEDING and currentrow) as sample5, -- å½“å‰è¡Œå’Œå‰é¢ä¸€è¡Œåšèšåˆsum(cost) over(partition by name order by orderdate rows between 1 PRECEDING AND 1FOLLOWING ) as sample6,-- å½“å‰è¡Œå’Œå‰è¾¹ä¸€è¡ŒåŠåé¢ä¸€è¡Œsum(cost) over(partition by name order by orderdate rows between current row andUNBOUNDED FOLLOWING ) as sample7 -- å½“å‰è¡ŒåŠåé¢æ‰€æœ‰è¡Œfrom business;# æŸ¥çœ‹é¡¾å®¢ä¸Šæ¬¡çš„è´­ä¹°æ—¶é—´select name,orderdate,cost,lag(orderdate,1,'1900-01-01') over(partition by name order by orderdate ) as time1,lag(orderdate,2) over (partition by name order by orderdate) as time2from business;# æŸ¥è¯¢å‰ 20% æ—¶é—´çš„è®¢å•ä¿¡æ¯select * from (select name,orderdate,cost, ntile(5) over(order by orderdate) sorted from business) twhere sorted = 1; Rank RANK() æ’åºç›¸åŒæ—¶ä¼šé‡å¤ï¼Œæ€»æ•°ä¸ä¼šå˜ï¼›DENSE_RANK()æ’åºç›¸åŒæ—¶ä¼šé‡å¤ï¼Œæ€»æ•°ä¼šå‡å°‘ï¼›ROW_NUMBER() ä¼šæ ¹æ®é¡ºåºè®¡ç®—ã€‚ 12345678910111213select name, subject, score,rank() over(partition by subject order by score desc) rp,dense_rank() over(partition by subject order by score desc) drp,row_number() over(partition by subject order by score desc) rmpfrom score;# ç»“æœname subject score rp drp rmpå®‹å®‹ è‹±è¯­ 84 1 1 1å¤§æµ· è‹±è¯­ 84 1 1 2å©·å©· è‹±è¯­ 78 3 2 3 å‡½æ•°123456# æŸ¥çœ‹ç³»ç»Ÿè‡ªå¸¦çš„å‡½æ•°hive&gt; show functions;# æ˜¾ç¤ºè‡ªå¸¦çš„å‡½æ•°çš„ç”¨æ³•hive&gt; desc function upper;# è¯¦ç»†æ˜¾ç¤ºè‡ªå¸¦çš„å‡½æ•°çš„ç”¨æ³•hive&gt; desc function extended upper; è‡ªå®šä¹‰å‡½æ•°å®˜æ–¹æ–‡æ¡£åœ°å€","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://yoursite.com/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"Hive","slug":"Hive","permalink":"http://yoursite.com/tags/Hive/"}]},{"title":"Linux åŸºç¡€","slug":"å¼€å‘æ‚é¡¹/Linux åŸºç¡€","date":"2020-04-26T01:15:17.000Z","updated":"2020-07-10T03:06:38.440Z","comments":true,"path":"2020/04/26/å¼€å‘æ‚é¡¹/Linux åŸºç¡€/","link":"","permalink":"http://yoursite.com/2020/04/26/%E5%BC%80%E5%8F%91%E6%9D%82%E9%A1%B9/Linux%20%E5%9F%BA%E7%A1%80/","excerpt":"æ±‡æ€» Linux ä¸­å¸¸ç”¨çš„æ“ä½œå‘½ä»¤ã€‚","text":"æ±‡æ€» Linux ä¸­å¸¸ç”¨çš„æ“ä½œå‘½ä»¤ã€‚ ç³»ç»Ÿå®‰è£…å®‰è£…VMware ğŸ‘‰ æ–°å»ºè™šæ‹Ÿæœº ğŸ‘‰ å®‰è£…Linux ğŸ‘‰ åˆæ­¥é…ç½® ğŸ‘‰ å…‹éš† ğŸ‘‰ å®Œå–„é…ç½® æ–°å»ºè™šæ‹Ÿæœºè‡ªå®šä¹‰ç±»å‹é…ç½® ğŸ‘‰ ç¨åå®‰è£…æ“ä½œç³»ç»Ÿ ğŸ‘‰ å®¢æˆ·æœºæ“ä½œç³»ç»Ÿï¼šLinuxï¼ˆç‰ˆæœ¬ï¼šCentOS 64ä½ï¼‰ ğŸ‘‰ ä½¿ç”¨ç½‘ç»œåœ°å€è½¬æ¢ï¼ˆNATï¼‰ğŸ‘‰ å°†è™šæ‹Ÿç£ç›˜æ‹†åˆ†æˆå¤šä¸ªæ–‡ä»¶ å®‰è£… Linuxé€‰ä¸­æ–°å»ºè™šæ‹Ÿæœºä½¿ç”¨ IOS æ˜ åƒæ–‡ä»¶ ğŸ‘‰ Create Custom Layout ğŸ‘‰ Add Partition ğŸ‘‰ /boot â€“ ext4 â€“ 200 â€“ Fixed sizenullï¼ˆä¾›ç³»ç»Ÿä½¿ç”¨ï¼‰ â€“ swap â€“ 2048 â€“ Fixed size/ â€“ ext4 â€“ 200 â€“ Fill to maximum allowable size Install boot loader on /dev/sad. ğŸ‘‰ Boot loader operating system list ğŸ‘‰ CentOS /dev/sda3 åˆæ­¥é…ç½®è®¾ç½®IPï¼šVMï¼šç¼–è¾‘ -&gt; è™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨ å­ç½‘å­ç½‘æ©ç NATè®¾ç½®ç½‘å…³ vi /etc/sysconfig/network-scripts/ifcfg-eth0 1234567# åˆ é™¤ UUID å’Œ MAC åœ°å€ONBOOT=yesBOOTPROTO=staticIPADDR=NETMASK=GATEWAY=DNS1=114.114.114.114 rm -fr /etc/udev/rules.d/70-persistent-net.rules æ¥å£ä¸ç¡¬ä»¶åœ°å€å…³è”è§„åˆ™ï¼Œä¸åˆ é™¤å…‹éš†å enth0 æ¥å£å¤±æ•ˆã€‚ VMï¼šé»˜è®¤ç»´æŠ¤æ¯ä¸€å°è™šæ‹Ÿæœºçš„ MAC åœ°å€ï¼Œäº’ä¸é‡å¤ å…³é—­é˜²ç«å¢™ &amp; Selinux 1234service iptables stopchkconfig iptables offvi /etc/selinux/config # SELINUX=disabled å…³æœº ğŸ‘‰ æ‹æ‘„å¿«ç…§ï¼ï¼ï¼ å…‹éš†è™šæ‹Ÿæœºå‡†å¤‡å››å°è™šæ‹Ÿæœº ğŸ‘‰ é…ç½®IP ğŸ‘‰ é…ç½®ä¸»æœºå 12vi /etc/sysconfig/network # HOSTNAME= é…ç½® hosts Linuxï¼švi /etc/hostsWindowï¼š/windows/system32/drivers/etc/hosts å…³æœº ğŸ‘‰ æ‹æ‘„å¿«ç…§ï¼ˆå…‹éš†ï¼‰ ç³»ç»Ÿç›®å½• /bootï¼šç³»ç»Ÿå¯åŠ¨ç›¸å…³æ–‡ä»¶ /devï¼šè®¾å¤‡æ–‡ä»¶ /etcï¼šé…ç½® /homeï¼šç”¨æˆ·çš„å®¶ç›®å½• /rootï¼šç®¡ç†å‘˜å®¶ç›®å½• /libï¼šåº“æ–‡ä»¶ /optï¼šè‡ªå®šä¹‰ç¨‹åºå®‰è£…ç›®å½• /binï¼šå¯æ‰§è¡Œæ–‡ä»¶ï¼ˆç”¨æˆ·å‘½ä»¤ï¼‰ /sbinï¼šç®¡ç†å‘½ä»¤ ç”¨æˆ·ç®¡ç†12345678910111213groupaddgroupdeluseradduserdelusermodidpasswdsudosu# æƒé™chmodchownugo -&gt; rwx -&gt; 111/000 -&gt; 7/0 exampleï¼ˆåˆ›å»ºæŒ‡å®šç”¨æˆ·çš„æ•°æ®å…±äº«åŒºåŸŸï¼‰ 1234567891011121314151617181920# åˆ›å»ºç”¨æˆ·useradd user01passwd user01useradd user02passwd user02# åˆ›å»ºå…±äº«ç›®å½•mkdir /var/swapdata# ä¿®æ­£æƒé™chmod 770 swapdata == chmod o-rwx g+rwx swapdata# ä¿®æ­£æ‰€å±ç»„groupadd swapareausermod -a -G swaparea user01usermod -a -G swaparea user02chown root:swaparea swapdata# ä¿®æ­£æ–‡ä»¶æƒé™chown root:swaparea share.filechmod 770 share.file# æŸ¥çœ‹ç”¨æˆ·å…ƒç´ æ®id user01id user02 è½¯ä»¶å®‰è£…12345yum clean allyum makecacheyum search man-pagesyum install man man-pages man-pages-zh-CNman bash(é‡ç‚¹å­¦ä¹ ) å¸¸ç”¨å‘½ä»¤123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566# shell bashtypeï¼šå‘½ä»¤ç±»å‹ å†…éƒ¨å‘½ä»¤ å¤–éƒ¨å‘½ä»¤helpï¼šå†…éƒ¨å‘½ä»¤å¸®åŠ©manï¼šå¸®åŠ©æ‰‹å†Œyum install man man-pages -ywhereisï¼šå®šä½å‘½ä»¤ä½ç½®fileï¼šæ–‡ä»¶ç±»å‹echoï¼šæ‰“å°åˆ°æ ‡å‡†è¾“å‡º $PATHï¼šç¯å¢ƒå˜é‡ï¼šè·¯å¾„ $LANG echo $$ï¼šå½“å‰shellçš„PIDhash -rï¼šæ¸…é™¤ç¼“å­˜# æ–‡ä»¶ç³»ç»Ÿå‘½ä»¤ls -l æ–‡ä»¶ç±»å‹ -ï¼šæ™®é€šæ–‡ä»¶ dï¼šç›®å½•æ–‡ä»¶ bï¼šå—è®¾å¤‡æ–‡ä»¶ cï¼šå­—ç¬¦è®¾å¤‡æ–‡ä»¶ lï¼šç¬¦å·é“¾æ¥æ–‡ä»¶ pï¼šå‘½ä»¤ç®¡é“æ–‡ä»¶ sï¼šå¥—æ¥å­—æ–‡ä»¶# æ–‡ä»¶æƒé™ï¼šä¸‰ä½ä¸€ç»„ï¼ˆrwxï¼‰ Uï¼ˆUSerï¼‰ Gï¼ˆGroupï¼‰ Oï¼ˆOtherï¼‰# æ–‡ä»¶ç¡¬é“¾æ¥æ¬¡æ•°ï¼ˆè½¯è¿æ¥å¯¹æ¯”ï¼‰ownergroupsizetimestamp accsee modify changedfï¼šæ˜¾ç¤ºç£ç›˜ä½¿ç”¨æƒ…å†µ -hduï¼šæ˜¾ç¤ºæ–‡ä»¶ç³»ç»Ÿä½¿ç”¨æƒ…å†µlsï¼šæ˜¾ç¤ºç›®å½•cdï¼šåˆ‡æ¢å·¥ä½œç›®å½•pwdï¼šæ˜¾ç¤ºå½“å‰å·¥ä½œç›®å½•mkdirï¼šåˆ›å»ºç›®å½• mkdir -p ./a/b/c mkdir a/&#123;1,2,3&#125;dirrmï¼šåˆ é™¤ rm -f rm -rfcpï¼šæ‹·è´ cp -r ./a ./new cp -lmvï¼šç§»åŠ¨lnï¼šé“¾æ¥ -sï¼ˆè½¯è¿æ¥ï¼‰statï¼šå…ƒæ•°æ®touch# æ–‡æœ¬æ“ä½œcat more less head -num tail -num| cat b.txt | head -3 å·¦è¾¹è¾“å‡ºä¸ºå³è¾¹çš„è¾“å…¥ æ–‡æœ¬å¤„ç†1234567891011121314151617181920212223242526cutï¼šæ˜¾ç¤ºåˆ‡å‰²çš„è¡Œæ•°æ® fï¼šé€‰æ‹©æ˜¾ç¤ºçš„åˆ— sï¼šä¸æ˜¾ç¤ºæ²¡æœ‰åˆ†éš”ç¬¦çš„è¡Œ dï¼šè‡ªå®šä¹‰åˆ†éš”ç¬¦sortï¼šæ’åºæ–‡ä»¶çš„è¡Œ nï¼šæŒ‰æ•°å€¼æ’åº rï¼šå€’åº tï¼šè‡ªå®šä¹‰åˆ†éš”ç¬¦ kï¼šé€‰æ‹©æ’åºåˆ— uï¼šåˆå¹¶ç›¸åŒè¡Œ fï¼šå¿½ç•¥å¤§å°å†™sedï¼šè¡Œç¼–è¾‘å™¨sed [options] '' filename options nï¼šé™é»˜æ¨¡å¼ iï¼šç›´æ¥ä¿®æ”¹åŸæ–‡ä»¶ 'Command' dï¼šåˆ é™¤ç¬¦åˆæ¡ä»¶çš„è¡Œ pï¼šæ˜¾ç¤ºç¬¦åˆæ¡ä»¶çš„è¡Œ a\\stringï¼šæŒ‡å®šè¡Œåæ·»åŠ æ–°è¡Œ i\\stringï¼šæŒ‡å®šè¡Œå‰æ·»åŠ æ–°è¡Œ s/pattern/string/ï¼šæŸ¥æ‰¾å¹¶æ›¿æ¢ \\(\\),\\(\\)--&gt;\\1,\\2awkï¼šå¼ºå¤§çš„æ–‡æœ¬åˆ†æå·¥å…· å°†æ–‡ä»¶é€è¡Œè¯»å…¥ï¼Œç”¨é»˜è®¤åˆ†éš”ç¬¦å°†æ¯è¡Œåˆ‡ç‰‡ï¼Œåˆ‡å¼€éƒ¨åˆ†å†è¿›è¡Œå„ç§åˆ†æå¤„ç† awk -F'' '&#123;pattern+action&#125;' filename æ­£åˆ™è¡¨è¾¾å¼1234567891011121314151617181920grepï¼šæ˜¾ç¤ºåŒ¹é…è¡Œ vï¼šåæ˜¾ç¤º eï¼šä½¿ç”¨æ‰©å±•æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æ“ä½œç¬¦ \\ï¼šè½¬ä¹‰å­—ç¬¦ .ï¼šåŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦ [0-9],[a-z]ï¼šå­—ç¬¦åºåˆ—å•å­—ç¬¦å ä½ ^ï¼šè¡Œé¦– $ï¼šè¡Œå°¾ &lt;,&gt;ï¼šå•è¯é¦–å°¾è¾¹ç•Œ |ï¼šè¿æ¥æ“ä½œç¬¦ (,)ï¼šé€‰æ‹©æ“ä½œç¬¦ \\nï¼šåå‘å¼•ç”¨é‡å¤æ“ä½œç¬¦ ?ï¼šåŒ¹é…0-1æ¬¡ *ï¼š0-å¤šæ¬¡ +ï¼š1-å¤šæ¬¡ &#123;n&#125;ï¼šnæ¬¡ &#123;n,&#125;ï¼šn-å¤šæ¬¡ &#123;n,m&#125;ï¼šn-mæ¬¡ VI12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152# æ‰“å¼€æ–‡ä»¶ vi /path :num :/PATTERN# å…³é—­æ–‡ä»¶ :q :wq :q! :w :w! :x == :wq zz# ç¼–è¾‘ iï¼šåœ¨å­—ç¬¦å‰è½¬ä¸ºè¾“å…¥æ¨¡å¼ aï¼šåœ¨å­—ç¬¦åè½¬ä¸ºè¾“å…¥æ¨¡å¼ oï¼šåœ¨ä¸‹ä¸€è¡Œè½¬ä¸ºè¾“å…¥æ¨¡å¼ Oï¼šåœ¨ä¸Šä¸€è¡Œè½¬ä¸ºè¾“å…¥æ¨¡å¼ lï¼šåœ¨è¡Œé¦–è½¬ä¸ºè¾“å…¥æ¨¡å¼ Aï¼šåœ¨è¡Œå°¾è½¬ä¸ºè¾“å…¥æ¨¡å¼# å•è¯ wï¼šåˆ°ä¸‹ä¸€ä¸ªå•è¯çš„è¯é¦– eï¼šåˆ°å½“å‰æˆ–ä¸‹ä¸€å•è¯è¯å°¾# è¡Œå†… 0ï¼šç»å¯¹è¡Œé¦– ^ï¼šè¡Œé¦–çš„ç¬¬ä¸€ä¸ªéç©ºç™½å­—ç¬¦ $ï¼šç»å¯¹è¡Œå°¾# è¡Œé—´ Gï¼šæ–‡ç« æœ«å°¾ 3Gï¼šç¬¬ä¸‰è¡Œ ggï¼šæ–‡ç« å¼€å¤´# ç¿»å± ctrlï¼šf,b# å•ä¸ªå­—ç¬¦ xï¼šåˆ é™¤å…‰æ ‡ä½ç½®å­—ç¬¦ 3xï¼šåˆ é™¤å…‰æ ‡å¼€å§‹ç¬¬ä¸‰ä¸ªå­—ç¬¦ rï¼šæ›¿æ¢å…‰æ ‡ä½ç½®å­—ç¬¦å¤åˆ¶ï¼šyw,yyç²˜è´´ï¼šp,Pæ’¤é”€ï¼šué‡åšæ’¤é”€ï¼šctrl+ré‡å¤ä¸Šä¸€æ­¥æ“ä½œï¼š.# è®¾ç½® set number set nonumber set readonly# æŸ¥æ‰¾ï¼š /PATTERNï¼ˆå‘ä¸‹ï¼‰,N ?PATTERNï¼ˆå‘ä¸Šï¼‰,n# æŸ¥æ‰¾å¹¶æ›¿æ¢ s/str1/str2/gi gï¼šä¸€è¡Œå†…å…¨éƒ¨æ›¿æ¢ iï¼šå¿½ç•¥å¤§å°å†™","categories":[{"name":"å¼€å‘æ‚é¡¹","slug":"å¼€å‘æ‚é¡¹","permalink":"http://yoursite.com/categories/%E5%BC%80%E5%8F%91%E6%9D%82%E9%A1%B9/"}],"tags":[{"name":"Linux","slug":"Linux","permalink":"http://yoursite.com/tags/Linux/"}]},{"title":"Hadoop","slug":"å¤§æ•°æ®/Hadoop","date":"2020-04-25T02:09:27.000Z","updated":"2020-07-10T03:39:05.616Z","comments":true,"path":"2020/04/25/å¤§æ•°æ®/Hadoop/","link":"","permalink":"http://yoursite.com/2020/04/25/%E5%A4%A7%E6%95%B0%E6%8D%AE/Hadoop/","excerpt":"å¤§æ•°æ®æŠ€æœ¯ Hadoop çš„æ•´ä½“å…¥é—¨ä»‹ç»ã€‚","text":"å¤§æ•°æ®æŠ€æœ¯ Hadoop çš„æ•´ä½“å…¥é—¨ä»‹ç»ã€‚ åŸºæœ¬æ¦‚å¿µ ä¸»è¦è§£å†³ï¼šæµ·é‡æ•°æ®çš„å­˜å‚¨å’Œæµ·é‡æ•°æ®çš„åˆ†æè®¡ç®—é—®é¢˜ã€‚ ä¸€èˆ¬å½¢å¼çš„å¤§æ•°æ®éƒ¨é—¨ç»„æˆç»“æ„ã€‚ Hadoop ä¸‰å¤§å‘è¡Œç‰ˆæœ¬ï¼š Apache ç‰ˆæœ¬æœ€åŸå§‹ï¼ˆæœ€åŸºç¡€ï¼‰çš„ç‰ˆæœ¬ï¼Œå¯¹äºå…¥é—¨å­¦ä¹ æœ€å¥½ï¼›Cloudera åœ¨å¤§å‹äº’è”ç½‘ä¼ä¸šä¸­ç”¨çš„è¾ƒå¤šï¼›Hortonworks æ–‡æ¡£è¾ƒå¥½ã€‚ Hadoop ä¼˜åŠ¿ï¼š é«˜å¯é æ€§ï¼šHadoop åº•å±‚ç»´æŠ¤å¤šä¸ªæ•°æ®å‰¯æœ¬ï¼Œæ‰€ä»¥å³ä½¿ Hadoop æŸä¸ªè®¡ç®—å…ƒç´ æˆ–å­˜å‚¨å‡ºç°æ•…éšœï¼Œä¹Ÿä¸ä¼šå¯¼è‡´æ•°æ®çš„ä¸¢å¤±ï¼›é«˜æ‰©å±•æ€§ï¼šåœ¨é›†ç¾¤é—´åˆ†é…ä»¼åŠ¡æ•°æ®ï¼Œå¯æ–¹ä¾¿çš„æ‰©å±•æ•°ä»¥å¹²è®¡çš„èŠ‚ç‚¹ï¼›é«˜æ•ˆæ€§ï¼šåœ¨ MapReduce çš„æ€æƒ³ä¸‹,ï¼ŒHadoop æ˜¯å¹¶è¡Œå·¥ä½œçš„ï¼Œä»¥åŠ å¿«ä»»åŠ¡å¤„ç†é€Ÿåº¦ï¼›é«˜å®¹é”™æ€§ï¼šèƒ½å¤Ÿè‡ªåŠ¨å°†å¤±è´¥çš„ä»»åŠ¡é‡æ–°åˆ†é…ã€‚ 1.x VS 2.x HDFSNameNodeï¼ˆnnï¼‰ï¼šå­˜å‚¨æ–‡ä»¶çš„å…ƒæ•°æ®ï¼Œå¦‚æ–‡ä»¶åã€æ–‡ä»¶ç›®å½•ç»“æ„ã€æ–‡ä»¶å±æ€§ï¼ˆç”Ÿæˆæ—¶é—´ã€å‰¯æœ¬æ•°æ–‡ä»¶æƒé™ï¼‰ï¼Œä»¥åŠæ¯ä¸ªæ–‡ä»¶çš„å—åˆ—è¡¨å’Œå—æ‰€åœ¨çš„ DataNode ç­‰ï¼› DataNodeï¼ˆdnï¼‰ï¼šåœ¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿå­˜å‚¨æ–‡ä»¶å—æ•°æ®,ä»¥åŠå—æ•°æ®çš„æ ¡éªŒå’Œã€‚ Secondary NameNodeï¼ˆ2nnï¼‰ï¼šç”¨æ¥ç›‘æ§ HDFS çŠ¶æ€çš„è¾…åŠ©åå°ç¨‹åºï¼Œæ¯éš”ä¸€æ®µæ—¶é—´è·å– HDFS å…ƒæ•°æ®çš„å¿«ç…§ã€‚ YARN ResourceManager ç”±ä¸¤ä¸ªå…³é”®ç»„ä»¶ Scheduler å’Œ ApplicationsManager ç»„æˆã€‚ Scheduler åœ¨å®¹é‡å’Œé˜Ÿåˆ—é™åˆ¶èŒƒå›´å†…è´Ÿè´£ä¸ºè¿è¡Œçš„å®¹å™¨åˆ†é…èµ„æºã€‚Scheduler æ˜¯ä¸€ä¸ªçº¯è°ƒåº¦å™¨ï¼ˆpure schedulerï¼‰ï¼Œåªè´Ÿè´£è°ƒåº¦ï¼Œå®ƒä¸ä¼šç›‘è§†æˆ–è·Ÿè¸ªåº”ç”¨ç¨‹åºçš„çŠ¶æ€ï¼Œä¹Ÿä¸è´Ÿè´£é‡å¯å¤±è´¥ä»»åŠ¡ï¼Œè¿™äº›å…¨éƒ½äº¤ç»™ ApplicationMaster å®Œæˆã€‚Scheduler æ ¹æ®å„ä¸ªåº”ç”¨ç¨‹åºçš„èµ„æºéœ€æ±‚è¿›è¡Œèµ„æºåˆ†é…ã€‚ ApplicationManager è´Ÿè´£æ¥æ”¶ä½œä¸šçš„æäº¤ï¼Œç„¶åå¯åŠ¨ä¸€ä¸ª ApplicationMaster å®¹å™¨è´Ÿè´£è¯¥åº”ç”¨ã€‚å®ƒä¹Ÿä¼šåœ¨ApplicationMaster å®¹å™¨å¤±è´¥æ—¶ï¼Œé‡æ–°å¯åŠ¨ ApplicationMaster å®¹å™¨ã€‚ Hadoop 2.X é›†ç¾¤ä¸­çš„æ¯ä¸ª DataNode éƒ½ä¼šè¿è¡Œä¸€ä¸ªNodeManager æ¥æ‰§è¡Œ Yarn çš„åŠŸèƒ½ã€‚æ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„ NodeManager æ‰§è¡Œä»¥ä¸‹åŠŸèƒ½ï¼š å®šæ—¶å‘ ResourceManager æ±‡æŠ¥æœ¬èŠ‚ç‚¹èµ„æºä½¿ç”¨æƒ…å†µå’Œå„ä¸ª Container çš„è¿è¡ŒçŠ¶å†µ ç›‘ç£åº”ç”¨ç¨‹åºå®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸ ï¼ˆç›‘æ§èµ„æºï¼‰ç›‘æ§ã€ç®¡ç†å’Œæä¾›å®¹å™¨æ¶ˆè€—çš„æœ‰å…³èµ„æºï¼ˆCPU / å†…å­˜ï¼‰çš„ä¿¡æ¯ ï¼ˆç›‘æ§èµ„æºä½¿ç”¨æƒ…å†µï¼‰ ï¼ˆç›‘æ§å®¹å™¨ï¼‰ç›‘æ§å®¹å™¨çš„èµ„æºä½¿ç”¨æƒ…å†µï¼Œæ€æ­»å¤±å»æ§åˆ¶çš„ç¨‹åº ï¼ˆå¯åŠ¨/åœæ­¢å®¹å™¨ï¼‰æ¥å—å¹¶å¤„ç†æ¥è‡ª ApplicationMaster çš„ Container å¯åŠ¨/åœæ­¢ç­‰å„ç§è¯·æ±‚ã€‚ æäº¤åˆ° YARN ä¸Šçš„æ¯ä¸€ä¸ªåº”ç”¨éƒ½æœ‰ä¸€ä¸ªä¸“ç”¨çš„ ApplicationMasterï¼ˆæ³¨æ„ï¼ŒApplicationMaster éœ€è¦å’Œ ApplicationManager åŒºåˆ†ï¼‰ã€‚ApplicationMaster è¿è¡Œåœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶çš„ç¬¬ä¸€ä¸ªå®¹å™¨å†…ã€‚ApplicationMaster ä¼šä¸ ResourceManager åå•†è·å–å®¹å™¨æ¥æ‰§è¡Œåº”ç”¨ä¸­çš„ mappers å’Œ reducersï¼Œä¹‹åä¼šå°† ResourceManager åˆ†é…çš„å®¹å™¨èµ„æºå‘ˆç°ç»™è¿è¡Œåœ¨æ¯ä¸ª DataNode ä¸Šçš„ NodeManagerã€‚ApplicationMaster è¯·æ±‚çš„èµ„æºæ˜¯å…·ä½“çš„ã€‚åŒ…æ‹¬ï¼š å¤„ç†ä½œä¸šéœ€è¦çš„æ–‡ä»¶å— ä¸ºåº”ç”¨ç¨‹åºåˆ›å»ºçš„ä»¥å®¹å™¨ä¸ºå•ä½çš„èµ„æº å®¹å™¨å¤§å°ï¼ˆä¾‹å¦‚ï¼Œ1GB å†…å­˜å’Œä¸€ä¸ªè™šæ‹Ÿæ ¸å¿ƒï¼‰ èµ„æºåœ¨ä½•å¤„åˆ†é…ï¼Œè¿™ä¸ªä¾æ®ä» NameNode è·å–çš„å—å­˜å‚¨ä½ç½®ä¿¡æ¯ï¼ˆå¦‚æœºå™¨1çš„èŠ‚ç‚¹10ä¸Šåˆ†é…4ä¸ªå®¹å™¨ï¼Œæœºå™¨2çš„èŠ‚ç‚¹20ä¸Šåˆ†é…8ä¸ªå®¹å™¨ï¼‰ èµ„æºè¯·æ±‚çš„ä¼˜å…ˆçº§ ApplicationMaster æ˜¯ä¸€ä¸ªç‰¹å®šçš„æ¡†æ¶ã€‚ä¾‹å¦‚ï¼ŒMapReduce ç¨‹åºæ˜¯ MRAppMasterï¼Œspark æ˜¯ SparkAppMasterã€‚ Container æ˜¯å¯¹äºèµ„æºçš„æŠ½è±¡, å®ƒå°è£…äº†æŸä¸ªèŠ‚ç‚¹ä¸Šçš„å¤šç»´åº¦èµ„æºï¼Œå¦‚å†…å­˜ã€CPU ç­‰ã€‚ MapReduce Map é˜¶æ®µå¹¶è¡Œå¤„ç†è¾“å…¥æ•°æ®ï¼› Reduce é˜¶æ®µå¯¹ Map ç»“æœè¿›è¡Œæ±‡æ€»ã€‚ ç”Ÿæ€ä½“ç³» Sqoop æ˜¯ä¸€æ¬¾å¼€æºçš„å·¥å…·ï¼Œä¸»è¦ç”¨äºåœ¨ Hadoopã€Hive ä¸ä¼ ç»Ÿçš„æ•°æ®åº“ï¼ˆMySqlï¼‰é—´è¿›è¡Œæ•°æ®çš„ä¼ é€’ï¼Œå¯ä»¥å°†ä¸€ä¸ªå…³ç³»å‹æ•°æ®åº“ï¼ˆä¾‹å¦‚ ï¼šMySQLï¼ŒOracle ç­‰ï¼‰ä¸­çš„æ•°æ®å¯¼è¿›åˆ° Hadoop çš„ HDFS ä¸­ï¼Œä¹Ÿå¯ä»¥å°† HDFS çš„æ•°æ®å¯¼è¿›åˆ°å…³ç³»å‹æ•°æ®åº“ä¸­ã€‚ Kafka æ˜¯ä¸€ç§é«˜ååé‡çš„åˆ†å¸ƒå¼å‘å¸ƒè®¢é˜…æ¶ˆæ¯ç³»ç»Ÿã€‚ Storm ç”¨äºè¿ç»­è®¡ç®—ï¼Œå¯¹æ•°æ®æµåšè¿ç»­æŸ¥è¯¢ï¼Œåœ¨è®¡ç®—æ—¶å°±å°†ç»“æœä»¥æµçš„å½¢å¼è¾“å‡ºç»™ç”¨æˆ·ã€‚ Spark æ˜¯å½“å‰æœ€æµè¡Œçš„å¼€æºå¤§æ•°æ®å†…å­˜è®¡ç®—æ¡†æ¶ã€‚å¯ä»¥åŸºäº Hadoop ä¸Šå­˜å‚¨çš„å¤§æ•°æ®è¿›è¡Œè®¡ç®—ã€‚ Oozie æ˜¯ä¸€ä¸ªç®¡ç† Hdoop ä½œä¸šï¼ˆjobï¼‰çš„å·¥ä½œæµç¨‹è°ƒåº¦ç®¡ç†ç³»ç»Ÿã€‚ HBase æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„ã€é¢å‘åˆ—çš„å¼€æºæ•°æ®åº“ã€‚HBase ä¸åŒäºä¸€èˆ¬çš„å…³ç³»æ•°æ®åº“ï¼Œå®ƒæ˜¯ä¸€ä¸ªé€‚åˆäºéç»“æ„åŒ–æ•°æ®å­˜å‚¨çš„æ•°æ®åº“ã€‚ Hive æ˜¯åŸºäº Hadoop çš„ä¸€ä¸ªæ•°æ®ä»“åº“å·¥å…·ï¼Œå¯ä»¥å°†ç»“æ„åŒ–çš„æ•°æ®æ–‡ä»¶æ˜ å°„ä¸ºä¸€å¼ æ•°æ®åº“è¡¨ï¼Œå¹¶æä¾›ç®€å•çš„ SQL æŸ¥è¯¢åŠŸèƒ½ï¼Œå¯ä»¥å°† SQL è¯­å¥è½¬æ¢ä¸º MapReduce ä»»åŠ¡è¿›è¡Œè¿è¡Œã€‚ å…¶ä¼˜ç‚¹æ˜¯å­¦ä¹ æˆæœ¬ä½ï¼Œå¯ä»¥é€šè¿‡ç±» SQL è¯­å¥å¿«é€Ÿå®ç°ç®€å•çš„ MapReduce ç»Ÿè®¡ï¼Œä¸å¿…å¼€å‘ä¸“é—¨çš„ MapReduce åº”ç”¨ï¼Œååˆ†é€‚åˆæ•°æ®ä»“åº“çš„ç»Ÿè®¡åˆ†æã€‚ R è¯­è¨€æ˜¯ç”¨äºç»Ÿè®¡åˆ†æã€ç»˜å›¾çš„è¯­è¨€å’Œæ“ä½œç¯å¢ƒã€‚R æ˜¯å±äº GNU ç³»ç»Ÿçš„ä¸€ä¸ªè‡ªç”±ã€å…è´¹ã€æºä»£ç å¼€æ”¾çš„è½¯ä»¶ï¼Œå®ƒæ˜¯ä¸€ä¸ªç”¨äºç»Ÿè®¡è®¡ç®—å’Œç»Ÿè®¡åˆ¶å›¾çš„ä¼˜ç§€å·¥å…·ã€‚ Apache Mahout æ˜¯ä¸ªå¯æ‰©å±•çš„æœºå™¨å­¦ä¹ å’Œæ•°æ®æŒ–æ˜åº“ã€‚ Zookeeper æ˜¯ Google çš„ Chubby ä¸€ä¸ªå¼€æºçš„å®ç°ã€‚å®ƒæ˜¯ä¸€ä¸ªé’ˆå¯¹å¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿçš„å¯é åè°ƒç³»ç»Ÿï¼Œæä¾›çš„åŠŸèƒ½åŒ…æ‹¬ï¼šé…ç½®ç»´æŠ¤ã€åå­—æœåŠ¡ã€ åˆ†å¸ƒå¼åŒæ­¥ã€ç»„æœåŠ¡ç­‰ã€‚ZooKeeper çš„ç›®æ ‡å°±æ˜¯å°è£…å¥½å¤æ‚æ˜“å‡ºé”™çš„å…³é”®æœåŠ¡ï¼Œå°†ç®€å•æ˜“ç”¨çš„æ¥å£å’Œæ€§èƒ½é«˜æ•ˆã€åŠŸèƒ½ç¨³å®šçš„ç³»ç»Ÿæä¾›ç»™ç”¨æˆ·ã€‚ ç¯å¢ƒæ­å»ºè½¯ä»¶å®‰è£…123456789101112131415161718192021222324252627282930313233# åœ¨ /opt ç›®å½•ä¸‹åˆ›å»º moduleã€software æ–‡ä»¶å¤¹mkdir modulemkdir software# ä¿®æ”¹ moduleã€software æ–‡ä»¶å¤¹çš„æ‰€æœ‰è€…chown [group]:[user] module/ software/# å®‰è£… JDK# æ£€æŸ¥æ˜¯å¦å®‰è£… Java è½¯ä»¶rpm -qa | grep javarpm -e [software]# æŸ¥çœ‹ JDK å®‰è£…è·¯å¾„which java# è§£å‹ JDK åˆ° /opt/module ç›®å½•ä¸‹tar -zxvf jdk-8u144-linux-x64.tar.gz -C /opt/module/# é…ç½® JDK ç¯å¢ƒå˜é‡pwd /opt/module/jdk1.8.0_144vi /etc/profile # æ–‡ä»¶æœ«å°¾æ·»åŠ  JDK è·¯å¾„ # export JAVA_HOME=/opt/module/jdk1.8.0_144 # export PATH=$PATH:$JAVA_HOME/bin# é…ç½®ç”Ÿæ•ˆsource /etc/profile# æµ‹è¯•ç¯å¢ƒjava -version# å®‰è£… Hadooptar -zxvf hadoop-2.7.2.tar.gz -C /opt/module/# æ·»åŠ  Hadoop ç¯å¢ƒå˜é‡pwd /opt/module/hadoop-2.7.2vi /etc/profile # export HADOOP_HOME=/opt/module/hadoop-2.7.2 # export PATH=$PATH:$HADOOP_HOME/bin # export PATH=$PATH:$HADOOP_HOME/sbinsource /etc/profilehadoop version Hadoop ç›®å½•ç»“æ„bin ç›®å½•ï¼šå­˜æ”¾å¯¹ Hadoop ç›¸å…³æœåŠ¡ï¼ˆHDFSï¼ŒYARNï¼‰è¿›è¡Œæ“ä½œçš„è„šæœ¬ï¼› etc ç›®å½•ï¼šHadoop çš„é…ç½®æ–‡ä»¶ç›®å½•ï¼Œå­˜æ”¾ Hadoop çš„é…ç½®æ–‡ä»¶ï¼› lib ç›®å½•ï¼šå­˜æ”¾ Hadoop çš„æœ¬åœ°åº“ï¼ˆå¯¹æ•°æ®è¿›è¡Œå‹ç¼©è§£å‹ç¼©åŠŸèƒ½ï¼‰ï¼› sbin ç›®å½•ï¼šå­˜æ”¾å¯åŠ¨æˆ–åœæ­¢ Hadoop ç›¸å…³æœåŠ¡çš„è„šæœ¬ï¼› share ç›®å½•ï¼šå­˜æ”¾ Hadoop çš„ä¾èµ– jar åŒ…ã€æ–‡æ¡£ã€å’Œå®˜æ–¹æ¡ˆä¾‹ã€‚ é…ç½®æ–‡ä»¶è¯´æ˜ Hadoop é…ç½®æ–‡ä»¶åˆ†ä¸¤ç±»ï¼šé»˜è®¤é…ç½®æ–‡ä»¶å’Œè‡ªå®šä¹‰é…ç½®æ–‡ä»¶ï¼Œåªæœ‰ç”¨æˆ·æƒ³ä¿®æ”¹æŸä¸€é»˜è®¤é…ç½®å€¼æ—¶ï¼Œæ‰éœ€è¦ä¿®æ”¹è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ï¼Œæ›´æ”¹ç›¸åº”å±æ€§å€¼ã€‚ è¦è·å–çš„é»˜è®¤æ–‡ä»¶ æ–‡ä»¶å­˜æ”¾åœ¨ Hadoop çš„ jar åŒ…ä¸­çš„ä½ç½® [core-default.xml] hadoop-common-2.7.2.jar/ core-default.xml [hdfs-default.xml] hadoop-hdfs-2.7.2.jar/ hdfs-default.xml [yarn-default.xml] hadoop-yarn-common-2.7.2.jar/ yarn-default.xml [mapred-default.xml] hadoop-mapreduce-client-core-2.7.2.jar/ mapred-default.xml è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ï¼š â€‹ core-site.xmlã€hdfs-site.xmlã€yarn-site.xmlã€mapred-site.xml å››ä¸ªé…ç½®æ–‡ä»¶å­˜æ”¾åœ¨ $HADOOP_HOME/etc/hadoop è¿™ä¸ªè·¯å¾„ä¸Šï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®é¡¹ç›®éœ€æ±‚é‡æ–°è¿›è¡Œä¿®æ”¹é…ç½®ã€‚ è¿è¡Œæ¨¡å¼æœ¬åœ°æ¨¡å¼12345678910# hadoop-2.7.2 ç›®å½•ä¸‹mkdir wcinputcd wcinputtouch wc.input# ç¼–å†™åˆ†ææ–‡æœ¬vi wc.input# hadoop-2.7.2 ç›®å½•ä¸‹æ‰§è¡Œhadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-2.7.2.jar wordcount wcinput wcoutput# æŸ¥çœ‹ç»“æœcat wcoutput/part-r-00000 ä¼ªåˆ†å¸ƒå¼123# é…ç½®é›†ç¾¤# é…ç½® hadoop-env.shï¼Œä¿®æ”¹ JAVA_HOME è·¯å¾„ # export JAVA_HOME=/opt/module/jdk1.8.0_144 12345678910111213&lt;!-- é…ç½® core-site.xml --&gt;&lt;!-- æŒ‡å®š HDFS ä¸­ NameNode çš„åœ°å€ --&gt;&lt;property&gt;&lt;name&gt;fs.defaultFS&lt;/name&gt; &lt;value&gt;hdfs://hadoop101:9000&lt;/value&gt;&lt;/property&gt;&lt;!-- æŒ‡å®š Hadoop è¿è¡Œæ—¶äº§ç”Ÿæ–‡ä»¶çš„å­˜å‚¨ç›®å½• --&gt;&lt;property&gt; &lt;name&gt;hadoop.tmp.dir&lt;/name&gt; &lt;value&gt;/opt/module/hadoop-2.7.2/data/tmp&lt;/value&gt;&lt;/property&gt; 1234567&lt;!-- é…ç½® hdfs-site.xml --&gt;&lt;!-- æŒ‡å®š HDFS å‰¯æœ¬çš„æ•°é‡ --&gt;&lt;property&gt; &lt;name&gt;dfs.replication&lt;/name&gt; &lt;value&gt;1&lt;/value&gt;&lt;/property&gt; 1234567891011# å¯åŠ¨é›†ç¾¤# æ ¼å¼åŒ– NameNodeï¼ˆç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶éœ€è¦æ ¼å¼åŒ–ï¼‰bin/hdfs namenode -format# å¯åŠ¨ NameNodesbin/hadoop-daemon.sh start namenode# å¯åŠ¨ DataNodesbin/hadoop-daemon.sh start datanode# æŸ¥çœ‹é›†ç¾¤æ˜¯å¦å¯åŠ¨æˆåŠŸjps# æŸ¥çœ‹äº§ç”Ÿçš„ Log æ—¥å¿—cd /opt/module/hadoop-2.7.2/logs æ ¼å¼åŒ– NameNode åä¼šäº§ç”Ÿæ–°çš„é›†ç¾¤ idï¼Œå¯¼è‡´ NameNode å’Œ DataNode çš„é›†ç¾¤ id ä¸ä¸€è‡´ï¼Œå¯¼è‡´é›†ç¾¤æ‰¾ä¸åˆ°ä¹‹å‰æ•°æ®ã€‚æ‰€ä»¥ï¼Œæ ¼å¼ NameNode å‰ä¸€å®šè¦å…ˆåˆ é™¤ data æ•°æ®å’Œ log æ—¥å¿—ï¼Œç„¶åæ‰èƒ½æ ¼å¼åŒ– NameNodeã€‚ å¯åŠ¨ YARN12# é…ç½® yarn-env.sh # export JAVA_HOME=/opt/module/jdk1.8.0_144 12345678910111213&lt;!-- é…ç½®yarn-site.xml --&gt;&lt;!-- Reducer è·å–æ•°æ®çš„æ–¹å¼ --&gt;&lt;property&gt; &lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt; &lt;value&gt;mapreduce_shuffle&lt;/value&gt;&lt;/property&gt;&lt;!-- æŒ‡å®š YARN çš„ ResourceManager çš„åœ°å€ --&gt;&lt;property&gt; &lt;name&gt;yarn.resourcemanager.hostname&lt;/name&gt; &lt;value&gt;hadoop101&lt;/value&gt;&lt;/property&gt; 1234# é…ç½® mapred-env.sh # export JAVA_HOME=/opt/module/jdk1.8.0_144# é…ç½® mapred-site.xmlmv mapred-site.xml.template mapred-site.xml 12345&lt;!-- æŒ‡å®š MR è¿è¡Œåœ¨ YARN ä¸Š --&gt;&lt;property&gt; &lt;name&gt;mapreduce.framework.name&lt;/name&gt; &lt;value&gt;yarn&lt;/value&gt;&lt;/property&gt; 1234# å¯åŠ¨é›†ç¾¤ï¼Œå¯åŠ¨å‰å¿…é¡»ä¿è¯ NameNode å’Œ DataNode å·²ç»å¯åŠ¨sbin/yarn-daemon.sh start resourcemanagersbin/yarn-daemon.sh start nodemanager# 8088 ç«¯å£æŸ¥çœ‹ web é¡µé¢ å†å²æœåŠ¡å™¨ ç”¨äºæŸ¥çœ‹ç¨‹åºçš„å†å²è¿è¡Œæƒ…å†µã€‚ 123456789101112&lt;!-- é…ç½® mapred-site.xml --&gt;&lt;!-- å†å²æœåŠ¡å™¨ç«¯åœ°å€ --&gt;&lt;property&gt;&lt;name&gt;mapreduce.jobhistory.address&lt;/name&gt;&lt;value&gt;hadoop101:10020&lt;/value&gt;&lt;/property&gt;&lt;!-- å†å²æœåŠ¡å™¨ web ç«¯åœ°å€ --&gt;&lt;property&gt; &lt;name&gt;mapreduce.jobhistory.webapp.address&lt;/name&gt; &lt;value&gt;hadoop101:19888&lt;/value&gt;&lt;/property&gt; 123# å¯åŠ¨å†å²æœåŠ¡å™¨sbin/mr-jobhistory-daemon.sh start historyserver# 19888 ç«¯å£æŸ¥çœ‹ web é¡µé¢ æ—¥å¿—èšé›† åº”ç”¨è¿è¡Œå®Œæˆä»¥åï¼Œå°†ç¨‹åºè¿è¡Œæ—¥å¿—ä¿¡æ¯ä¸Šä¼ åˆ° HDFS ç³»ç»Ÿä¸Šï¼Œæ–¹ä¾¿çš„æŸ¥çœ‹åˆ°ç¨‹åºè¿è¡Œè¯¦æƒ…å’Œå¼€å‘è°ƒè¯•ã€‚ 12345678910111213&lt;!-- yarn-site.xml --&gt;&lt;!-- å¼€å¯æ—¥å¿—èšé›†åŠŸèƒ½ --&gt;&lt;property&gt;&lt;name&gt;yarn.log-aggregation-enable&lt;/name&gt;&lt;value&gt;true&lt;/value&gt;&lt;/property&gt;&lt;!-- æ—¥å¿—ä¿ç•™æ—¶é—´è®¾ç½®7å¤© --&gt;&lt;property&gt;&lt;name&gt;yarn.log-aggregation.retain-seconds&lt;/name&gt;&lt;value&gt;604800&lt;/value&gt;&lt;/property&gt; 1234567# é‡å¯åæ—¥å¿—èšé›†æ‰ç”Ÿæ•ˆsbin/yarn-daemon.sh stop resourcemanagersbin/yarn-daemon.sh stop nodemanagersbin/mr-jobhistory-daemon.sh stop historyserversbin/yarn-daemon.sh start resourcemanagersbin/yarn-daemon.sh start nodemanagersbin/mr-jobhistory-daemon.sh start historyserver å®Œå…¨åˆ†å¸ƒå¼ ä¸‰å°è™šæ‹Ÿæœºä¹‹é—´çš„ç›¸äº’é€šè®¯ï¼Œåè°ƒå·¥ä½œã€‚ é›†ç¾¤åˆ†å‘ scpï¼ˆsecure copyï¼‰å¯ä»¥å®ç°æœåŠ¡å™¨ä¸æœåŠ¡å™¨ä¹‹é—´çš„æ•°æ®æ‹·è´ã€‚ 1234567# åœ¨ hadoop101 ä¸Šå°† hadoop101 ä¸­ /opt/module ç›®å½•ä¸‹çš„è½¯ä»¶æ‹·è´åˆ° hadoop102 ä¸Š# -r è¡¨ç¤ºé€’å½’ï¼Œå³å…¨éƒ¨éƒ½æ‹·è´è¿‡å»scp -r /opt/module root@hadoop102:/opt/module# å°† hadoop101 ä¸­ /etc/profile æ–‡ä»¶æ‹·è´åˆ° hadoop102 çš„ /etc/profile ä¸Šscp /etc/profile root@hadoop102:/etc/profile# é…ç½®ç”Ÿæ•ˆsource /etc/profile rsync ä¸»è¦ç”¨äºå¤‡ä»½å’Œé•œåƒã€‚å…·æœ‰é€Ÿåº¦å¿«ã€é¿å…å¤åˆ¶ç›¸åŒå†…å®¹å’Œæ”¯æŒç¬¦å·é“¾æ¥çš„ä¼˜ç‚¹ã€‚ rsync å’Œ scp åŒºåˆ«ï¼šç”¨ rsync åšæ–‡ä»¶çš„å¤åˆ¶è¦æ¯” scp çš„é€Ÿåº¦å¿«ï¼Œrsync åªå¯¹å·®å¼‚æ–‡ä»¶åšæ›´æ–°ã€‚scp æ˜¯æŠŠæ‰€æœ‰æ–‡ä»¶éƒ½å¤åˆ¶è¿‡å»ã€‚ é€‰é¡¹ åŠŸèƒ½ -r é€’å½’ -v æ˜¾ç¤ºå¤åˆ¶è¿‡ç¨‹ -l æ‹·è´ç¬¦å·è¿æ¥ 12# æŠŠ hadoop101 æœºå™¨ä¸Šçš„ /opt/software ç›®å½•åŒæ­¥åˆ° hadoop102 æœåŠ¡å™¨çš„ root ç”¨æˆ·ä¸‹çš„ /opt/ ç›®å½•rsync -rvl /opt/software/ root@hadoop102:/opt/software 12345# ç¼–å†™é›†ç¾¤åˆ†å‘è„šæœ¬# /usr/local/bin ç›®å½•ä¸‹çš„è„šæœ¬å…¨å±€å¯ç”¨# /home/wingo/bin è¿™ä¸ªç›®å½•ä¸‹å­˜æ”¾çš„è„šæœ¬ï¼Œwingo ç”¨æˆ·å¯ä»¥åœ¨ç³»ç»Ÿä»»ä½•åœ°æ–¹ç›´æ¥æ‰§è¡Œtouch xsyncvi xsync 12345678910111213141516171819202122232425#!/bin/bash# è·å–è¾“å…¥å‚æ•°ä¸ªæ•°ï¼Œå¦‚æœæ²¡æœ‰å‚æ•°ï¼Œç›´æ¥é€€å‡ºpcount=$#if((pcount==0)); thenecho no args;exit;fi# è·å–æ–‡ä»¶åç§°ï¼Œbasename è·å–è·¯åŠ²æœ€åé‚£ä¸ªåç§°p1=$1fname=`basename $p1`echo fname=$fname# è·å–ä¸Šçº§ç›®å½•åˆ°ç»å¯¹è·¯å¾„pdir=`cd -P $(dirname $p1); pwd`echo pdir=$pdir# è·å–å½“å‰ç”¨æˆ·åç§°user=`whoami`# å¾ªç¯ï¼Œè¿™é‡Œæ ¹æ®éœ€æ±‚ä¿®æ”¹å¾ªç¯for((host=103; host&lt;105; host++)); do echo ------------------- hadoop$host -------------- rsync -rvl $pdir/$fname $user@hadoop$host:$pdirdone é›†ç¾¤é…ç½® å…ˆåœ¨ hadoop102 ä¸­è¿›è¡Œé…ç½®ï¼Œç„¶åå°†é…ç½®åˆ†å‘åˆ°å…¶ä½™çš„èŠ‚ç‚¹ã€‚ hadoop102 hadoop103 hadoop104 HDFS NameNodeã€DataNode DataNode SecondaryNameNodeã€DataNode YARN NodeManager ResourceManagerã€NodeManager NodeManager 12345678910111213&lt;!-- é…ç½® core-site.xml --&gt;&lt;!-- æŒ‡å®š HDFS ä¸­ NameNode çš„åœ°å€ --&gt;&lt;property&gt; &lt;name&gt;fs.defaultFS&lt;/name&gt; &lt;value&gt;hdfs://hadoop102:9000&lt;/value&gt;&lt;/property&gt;&lt;!-- æŒ‡å®š Hadoop è¿è¡Œæ—¶äº§ç”Ÿæ–‡ä»¶çš„å­˜å‚¨ç›®å½• --&gt;&lt;property&gt; &lt;name&gt;hadoop.tmp.dir&lt;/name&gt; &lt;value&gt;/opt/module/hadoop-2.7.2/data/tmp&lt;/value&gt;&lt;/property&gt; 123# é…ç½®é›†ç¾¤# é…ç½® hadoop-env.shï¼Œä¿®æ”¹ JAVA_HOME è·¯å¾„ # export JAVA_HOME=/opt/module/jdk1.8.0_144 12345678910111213&lt;!-- é…ç½® hdfs-site.xml --&gt;&lt;property&gt; &lt;name&gt;dfs.replication&lt;/name&gt; &lt;!-- åˆ†ç‰‡æ•°å¿…é¡»è¦å°äºèŠ‚ç‚¹æ•° --&gt; &lt;value&gt;3&lt;/value&gt;&lt;/property&gt;&lt;!-- æŒ‡å®š Hadoop è¾…åŠ©åç§°èŠ‚ç‚¹ä¸»æœºé…ç½® --&gt;&lt;property&gt; &lt;name&gt;dfs.namenode.secondary.http-address&lt;/name&gt; &lt;value&gt;hadoop104:50090&lt;/value&gt;&lt;/property&gt; 12# é…ç½® yarn-env.sh # export JAVA_HOME=/opt/module/jdk1.8.0_144 12345678910111213&lt;!-- é…ç½®yarn-site.xml --&gt;&lt;!-- Reducer è·å–æ•°æ®çš„æ–¹å¼ --&gt;&lt;property&gt; &lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt; &lt;value&gt;mapreduce_shuffle&lt;/value&gt;&lt;/property&gt;&lt;!-- æŒ‡å®š YARN çš„ ResourceManager çš„åœ°å€ --&gt;&lt;property&gt; &lt;name&gt;yarn.resourcemanager.hostname&lt;/name&gt; &lt;value&gt;hadoop103&lt;/value&gt;&lt;/property&gt; 1234# é…ç½® mapred-env.sh # export JAVA_HOME=/opt/module/jdk1.8.0_144# é…ç½® mapred-site.xmlmv mapred-site.xml.template mapred-site.xml 12345&lt;!-- æŒ‡å®š MR è¿è¡Œåœ¨ YARN ä¸Š --&gt;&lt;property&gt; &lt;name&gt;mapreduce.framework.name&lt;/name&gt; &lt;value&gt;yarn&lt;/value&gt;&lt;/property&gt; 12# åœ¨é›†ç¾¤ä¸Šåˆ†å‘é…ç½®å¥½çš„Hadoopé…ç½®æ–‡ä»¶xsync /opt/module/hadoop-2.7.2/ å•ç‚¹å¯åŠ¨12345# NameNode ç¬¬ä¸€æ¬¡å¯åŠ¨åˆå§‹åŒ–hadoop namenode -formathadoop-daemon.sh start namenode# åˆ†åˆ«åœ¨ä¸‰ä¸ªèŠ‚ç‚¹ä¸Šå¯åŠ¨ DataNodehadoop-daemon.sh start datanode é›†ç¾¤å¯åŠ¨1234567891011vi /opt/module/hadoop-2.7.2/etc/hadoop/slaves # hadoop102 # hadoop103 # hadoop104# åŒæ­¥é…ç½®xsync slaves# NameNode èŠ‚ç‚¹bin/hdfs namenode -formatsbin/start-dfs.sh# ResourceManage èŠ‚ç‚¹sbin/start-yarn.sh SSH é…ç½®1234567# ~/.ssh ç”Ÿæˆå¯†é’¥ssh-keygen -t rsa# æ¯ä¸ªèŠ‚ç‚¹éƒ½éœ€è¦è¿›è¡Œæ­¤æ“ä½œ# å°†å…¬é’¥æ‹·è´åˆ°è¦å…å¯†ç™»å½•çš„ç›®æ ‡æœºå™¨ä¸Šssh-copy-id hadoop102ssh-copy-id hadoop103ssh-copy-id hadoop104 æ–‡ä»¶å åŠŸèƒ½ known_hosts è®°å½•sshè®¿é—®è¿‡è®¡ç®—æœºçš„å…¬é’¥(public key) id_rsa ç”Ÿæˆçš„ç§é’¥ id_rsa.pub ç”Ÿæˆçš„å…¬é’¥ authorized_keys å­˜æ”¾æˆæƒè¿‡å¾—æ— å¯†ç™»å½•æœåŠ¡å™¨å…¬é’¥ æ—¶é—´åŒæ­¥ NPTï¼ˆNetwork Time Protocolï¼‰ æ—¶é—´åŒæ­¥çš„æ–¹å¼ï¼šæ‰¾ä¸€ä¸ªèŠ‚ç‚¹ä½œä¸ºæ—¶é—´æœåŠ¡å™¨ï¼Œæ‰€æœ‰çš„æœºå™¨ä¸è¿™å°é›†ç¾¤æ—¶é—´è¿›è¡Œå®šæ—¶çš„åŒæ­¥ï¼Œæ¯”å¦‚ï¼Œæ¯éš”ååˆ†é’Ÿï¼ŒåŒæ­¥ä¸€æ¬¡æ—¶é—´ã€‚ 12345678910111213141516171819202122232425262728# æ£€æŸ¥å®‰è£…rpm -qa | grep ntpvi /etc/ntp.confyum install -y ntp# ä¿®æ”¹é…ç½®vi /etc/ntp.conf # æˆæƒ192.168.1.0-192.168.1.255ç½‘æ®µä¸Šçš„æ‰€æœ‰æœºå™¨å¯ä»¥ä»è¿™å°æœºå™¨ä¸ŠæŸ¥è¯¢å’ŒåŒæ­¥æ—¶é—´ # restrict 192.168.1.0 mask 255.255.255.0 nomodify notrap # é›†ç¾¤åœ¨å±€åŸŸç½‘ä¸­ï¼Œä¸ä½¿ç”¨å…¶ä»–äº’è”ç½‘ä¸Šçš„æ—¶é—´ # #server 0.centos.pool.ntp.org iburst # #server 1.centos.pool.ntp.org iburst # #server 2.centos.pool.ntp.org iburst # #server 3.centos.pool.ntp.org iburst # å½“è¯¥èŠ‚ç‚¹ä¸¢å¤±ç½‘ç»œè¿æ¥ï¼Œä¾ç„¶å¯ä»¥é‡‡ç”¨æœ¬åœ°æ—¶é—´ä½œä¸ºæ—¶é—´æœåŠ¡å™¨ä¸ºé›†ç¾¤ä¸­çš„å…¶ä»–èŠ‚ç‚¹æä¾›æ—¶é—´åŒæ­¥ # server 127.127.1.0 # fudge 127.127.1.0 stratum 10vim /etc/sysconfig/ntpd # SYNC_HWCLOCK=yesservice ntpd restart# å¼€æœºå¯åŠ¨æ­¤æœåŠ¡chkconfig ntpd on# å…¶å®ƒèŠ‚ç‚¹é…ç½®crontab -e # */10 * * * * /usr/sbin/ntpdate hadoop102# ä¿®æ”¹æ—¶é—´date -s \"2017-9-11 11:11:11\"# ä¸€æ®µæ—¶é—´åæŸ¥çœ‹æ˜¯å¦åŒæ­¥date æ“ä½œé›†ç¾¤123456789101112131415161718# åœ¨ HDFS æ–‡ä»¶ç³»ç»Ÿä¸Šåˆ›å»ºä¸€ä¸ª input æ–‡ä»¶å¤¹bin/hdfs dfs -mkdir -p /user/wingo/input# å°†æµ‹è¯•æ–‡ä»¶å†…å®¹ä¸Šä¼ åˆ°æ–‡ä»¶ç³»ç»Ÿä¸Šbin/hdfs dfs -put wcinput/wc.input /user/wingo/input/# æŸ¥çœ‹ä¸Šä¼ çš„æ–‡ä»¶bin/hdfs dfs -ls /user/wingo/input/bin/hdfs dfs -cat /user/wingo/input/# è¿è¡Œ MapReduce ç¨‹åºbin/hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-2.7.2.jar wordcount /user/wingo/input/ /user/wingo/output# æŸ¥çœ‹è¾“å‡ºç»“æœï¼Œå¯åœ¨ 50070 ç«¯å£ Web æŸ¥çœ‹bin/hdfs dfs -cat /user/wingo/output/*# ä¸‹è½½æ–‡ä»¶åˆ°æœ¬åœ°bin/hdfs dfs -get /user/wingo/output/part-r-00000 ./wcoutput/# åˆ é™¤è¾“å‡ºç»“æœbin/hdfs dfs -rm -r /user/wingo/output å¯åŠ¨åœæ­¢æ“ä½œ123456789# åˆ†åˆ«å¯åŠ¨ / åœæ­¢ HDFS ç»„ä»¶hadoop-daemon.sh start / stop namenode / datanode / secondarynamenode# å¯åŠ¨ / åœæ­¢ YARNyarn-daemon.sh start / stop resourcemanager / nodemanager# é…ç½®äº† ssh åå¯ä¸€æ¬¡æ€§å¯åŠ¨é›†ç¾¤# æ•´ä½“å¯åŠ¨ / åœæ­¢ HDFSstart-dfs.sh / stop-dfs.sh# æ•´ä½“å¯åŠ¨/åœæ­¢ YARNstart-yarn.sh / stop-yarn.sh HDFSHDFS( Hadoop Distributed File Systemï¼‰å®ƒæ˜¯ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œç”¨äºå­˜å‚¨æ–‡ä»¶ï¼Œé€šè¿‡ç›®å½•æ ‘æ¥å®šä½æ–‡ä»¶ï¼›å…¶æ¬¡ï¼Œå®ƒæ˜¯åˆ†å¸ƒå¼çš„ï¼Œç”±å¾ˆå¤šæœåŠ¡å™¨è”åˆèµ·æ¥å®ç°å…¶åŠŸèƒ½ï¼Œé›†ç¾¤ä¸­çš„æœåŠ¡å™¨æœ‰å„è‡ªçš„è§’è‰²ã€‚ HDFSçš„ä½¿ç”¨åœºæ™¯ï¼šé€‚åˆä¸€æ¬¡å†™å…¥ï¼Œå¤šæ¬¡è¯»å‡ºçš„åœºæ™¯ï¼Œä¸”ä¸æ”¯æŒæ–‡ä»¶çš„ä¿®æ”¹ã€‚é€‚åˆç”¨æ¥åšæ•°æ®åˆ†æï¼Œå¹¶ä¸é€‚åˆç”¨æ¥åšç½‘ç›˜åº”ç”¨ã€‚ å…·æœ‰é«˜å®¹é”™æ€§ï¼Œå¤„ç†å¤§æ•°æ®ï¼Œå¯æ„å»ºåœ¨å»‰ä»·æœºå™¨ä¸Šç­‰ä¼˜ç‚¹ï¼›å…·æœ‰å»¶è¿Ÿè¾ƒé«˜ï¼Œæ— æ³•é«˜æ•ˆå­˜å‚¨å¤§é‡å°æ•°æ®ï¼Œä¸æ”¯æŒå¹¶å‘å†™å…¥åŠæ–‡ä»¶éšæœºä¿®æ”¹ç­‰ç¼ºé™·ã€‚ æ¶æ„ NameNode å°±æ˜¯ Masterï¼Œå®ƒæ˜¯ä¸€ä¸ªä¸»ç®¡ã€ç®¡ç†è€…ã€‚ ç®¡ç†HDFSçš„åç§°ç©ºé—´ï¼›é…ç½®å‰¯æœ¬ç­–ç•¥;ç®¡ç†æ•°æ®å—( Blockï¼‰æ˜ å°„ä¿¡æ¯;å¤„ç†å®¢æˆ·ç«¯è¯»å†™è¯·æ±‚ã€‚ DataNodeï¼šå°±æ˜¯ Slaveã€‚ NameNode ä¸‹è¾¾å‘½ä»¤, DataNode æ‰§è¡Œå®é™…çš„æ“ä½œã€‚ å­˜å‚¨å®é™…çš„æ•°æ®å—;æ‰§è¡Œæ•°æ®å—çš„è¯»å†™æ“ä½œã€‚ Clientï¼šå®¢æˆ·ç«¯ã€‚ æ–‡ä»¶åˆ‡åˆ†ã€‚æ–‡ä»¶ä¸Šä¼  HDFS çš„æ—¶å€™ï¼ŒClient å°†æ–‡ä»¶åˆ‡åˆ†æˆä¸€ä¸ªä¸€ä¸ªçš„ Block ç„¶åè¿›è¡Œä¸Šä¼ ï¼›ä¸ NameNode äº¤äº’ï¼Œè·å–æ–‡ä»¶çš„ä½ç½®ä¿¡æ¯ï¼›ä¸ DataNode äº¤äº’ï¼Œè¯»å–æˆ–è€…å†™å…¥æ•°æ®ï¼›Client æä¾›ä¸€äº›å‘½ä»¤æ¥ç®¡ç† HDFS,æ¯”å¦‚ NameNode æ ¼å¼åŒ–ï¼›Client å¯ä»¥é€šè¿‡ä¸€äº›å‘½ä»¤æ¥è®¿é—® HDFSï¼Œæ¯”å¦‚å¯¹ HDFS å¢åˆ æŸ¥æ”¹æ“ä½œã€‚ Secondary NameNodeï¼šå¹¶é NameNode çš„çƒ­å¤‡ã€‚ è¾…åŠ© NameNodeï¼Œåˆ†æ‹…å…¶å·¥ä½œé‡ï¼Œæ¯”å¦‚å®šæœŸåˆå¹¶ Silage å’Œ Editsï¼Œå¹¶æ¨é€ç»™ NameNodeï¼›åœ¨ç´§æ€¥æƒ…å†µä¸‹,å¯è¾…åŠ©æ¢å¤ NameNodeã€‚ æ–‡ä»¶å¿«å¤§å°HDFS ä¸­çš„æ–‡ä»¶åœ¨ç‰©ç†ä¸Šæ˜¯åˆ†å—å­˜å‚¨ï¼ˆBlockï¼‰ï¼Œå—çš„å¤§å°å¯ä»¥é€šè¿‡é…ç½®å‚æ•°ï¼ˆdfs.blocksizeï¼‰æ¥è§„å®š,é»˜è®¤å¤§å°åœ¨ Hadoop2x ç‰ˆæœ¬ä¸­æ˜¯ 128Mï¼Œè€ç‰ˆæœ¬ä¸­æ˜¯ 64Mã€‚ HDFS çš„å—è®¾ç½®å¤ªå°ï¼Œä¼šå¢åŠ å¯»å€æ—¶é—´ï¼Œç¨‹åºä¸€ç›´åœ¨æ‰¾å—çš„å¼€å§‹ä½ç½®ï¼›å¦‚æœå—è®¾ç½®çš„å¤ªå¤§ï¼Œä»ç£ç›˜ä¼ è¾“æ•°æ®çš„æ—¶é—´ä¼šæ˜æ˜¾å¤§äºå®šä½è¿™ä¸ªå—å¼€å§‹ä½ç½®æ‰€éœ€çš„æ—¶é—´ã€‚å¯¼è‡´ç¨‹åºåœ¨å¤„ç†è¿™å—æ•°æ®æ—¶ï¼Œä¼šéå¸¸æ…¢ã€‚æ€»ç»“ï¼šHDFS å—çš„å¤§å°è®¾ç½®ä¸»è¦å–å†³äºç£ç›˜ä¼ è¾“é€Ÿç‡ã€‚ï¼ˆå¯»å€æ—¶é—´ä¸ºä¼ è¾“æ—¶é—´çš„ 1% æ—¶æœ€åˆé€‚ï¼‰ Shell æ“ä½œ hfs æ˜¯ fs çš„å…·ä½“å®ç°ç±»ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738# å‘½ä»¤å¤§å…¨bin/hadoop fs# è¾“å‡ºè¿™ä¸ªå‘½ä»¤å‚æ•°hadoop fs -help rm# æ˜¾ç¤ºç›®å½•ä¿¡æ¯hadoop fs -ls /# åœ¨ HDFS ä¸Šåˆ›å»ºç›®å½•hadoop fs -mkdir -p /win/go# ä»æœ¬åœ°å‰ªåˆ‡ç²˜è´´åˆ° HDFShadoop fs -moveFromLocal ./win.txt /win/go# è¿½åŠ ä¸€ä¸ªæ–‡ä»¶åˆ°å·²ç»å­˜åœ¨çš„æ–‡ä»¶æœ«å°¾hadoop fs -appendToFile go.txt /win/go/win.txt# æ˜¾ç¤ºæ–‡ä»¶å†…å®¹hadoop fs -cat /win/go/win.txt# ä¿®æ”¹æ–‡ä»¶æ‰€å±æƒé™ï¼ŒHDFS æ“ä½œçš„ç”¨æˆ·åŠç”¨æˆ·ç»„å¿…é¡»æ˜¯ç³»ç»Ÿä¸­å­˜åœ¨çš„hadoop fs -chmod 666 /win/go/win.txthadoop fs -chown win:go /win/go/win.txt# ä» HDFS æ‹·è´åˆ°æœ¬åœ°hadoop fs -copyToLocal /win/go/win.txt ./# ä» HDFS çš„ä¸€ä¸ªè·¯å¾„æ‹·è´åˆ° HDFS çš„å¦ä¸€ä¸ªè·¯å¾„hadoop fs -cp /win/go/win.txt /other.txt# åœ¨ HDFS ç›®å½•ä¸­ç§»åŠ¨æ–‡ä»¶hadoop fs -mv /other.txt /win/go/# ä» HDFS ä¸‹è½½æ–‡ä»¶åˆ°æœ¬åœ°hadoop fs -get /win/go/win.txt ./# åˆå¹¶ä¸‹è½½å¤šä¸ª HDFS æ–‡ä»¶hadoop fs -getmerge /user/wingo/test/* ./together.txt# ç­‰åŒäº copyFromLocalhadoop fs -put ./local.txt /user/wingo/test/# æ˜¾ç¤ºä¸€ä¸ªæ–‡ä»¶çš„æœ«å°¾hadoop fs -tail /win/go/win.txt# åˆ é™¤æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹hadoop fs -rm /user/wingo/test/delete.txthadoop fs -rmdir /test# ç»Ÿè®¡æ–‡ä»¶å¤¹çš„å¤§å°ä¿¡æ¯hadoop fs -du -h /user/wingo/test# è®¾ç½® HDFS ä¸­æ–‡ä»¶çš„å‰¯æœ¬æ•°é‡ï¼šè‹¥æ¡ä»¶å…è®¸çš„è¯æ‰ä¼šè¾¾åˆ°hadoop fs -setrep 10 /win/go/win.txt å†™æµç¨‹ å‘ HDFS å†™æ•°æ®æ—¶ï¼Œå®¢æˆ·ç«¯ä¸ NameNodeã€DataNode é€šä¿¡è¿‡ç¨‹ã€‚ ç½‘ç»œæ‹“æ‰‘ åœ¨ HDFS å†™æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼ŒNameNode ä¼šé€‰æ‹©è·ç¦»å¾…ä¸Šä¼ æ•°æ®æœ€è¿‘è·ç¦»çš„ DataNode æ¥æ”¶æ•°æ®ã€‚ èŠ‚ç‚¹è·ç¦»ï¼šä¸¤ä¸ªèŠ‚ç‚¹åˆ°è¾¾æœ€è¿‘çš„å…±åŒç¥–å…ˆçš„è·ç¦»æ€»å’Œã€‚ æœºæ¶æ„ŸçŸ¥ å‰¯æœ¬èŠ‚ç‚¹é€‰æ‹©ã€‚ è¯»æµç¨‹ åœ¨ HDFS è¯»æ•°æ®æ—¶ï¼Œå®¢æˆ·ç«¯ä¸ NameNodeã€DataNode é€šä¿¡è¿‡ç¨‹ã€‚ 2NNå¦‚æœå­˜å‚¨åœ¨ NameNode èŠ‚ç‚¹çš„ç£ç›˜ä¸­ï¼Œå› ä¸ºç»å¸¸éœ€è¦è¿›è¡Œéšæœºè®¿é—®ï¼Œè¿˜æœ‰å“åº”å®¢æˆ·è¯·æ±‚ï¼Œå¿…ç„¶æ˜¯æ•ˆç‡è¿‡ä½ã€‚å› æ­¤ï¼Œå…ƒæ•°æ®éœ€è¦å­˜æ”¾åœ¨å†…å­˜ä¸­ã€‚ä½†å¦‚æœåªå­˜åœ¨å†…å­˜ä¸­ï¼Œä¸€æ—¦æ–­ç”µï¼Œå…ƒæ•°æ®ä¸¢å¤±ï¼Œæ•´ä¸ªé›†ç¾¤å°±æ— æ³•å·¥ä½œäº†ã€‚å› æ­¤äº§ç”Ÿåœ¨ç£ç›˜ä¸­å¤‡ä»½å…ƒæ•°æ®çš„ FsImageã€‚ è¿™æ ·åˆä¼šå¸¦æ¥æ–°çš„é—®é¢˜ï¼Œå½“åœ¨å†…å­˜ä¸­çš„å…ƒæ•°æ®æ›´æ–°æ—¶ï¼Œå¦‚æœåŒæ—¶æ›´æ–° FsImageï¼Œå°±ä¼šå¯¼è‡´æ•ˆç‡è¿‡ä½ï¼Œä½†å¦‚æœä¸æ›´æ–°ï¼Œå°±ä¼šå‘ç”Ÿä¸€è‡´æ€§é—®é¢˜ï¼Œä¸€æ—¦ NameNode èŠ‚ç‚¹æ–­ç”µï¼Œå°±ä¼šäº§ç”Ÿæ•°æ®ä¸¢å¤±ã€‚å› æ­¤ï¼Œå¼•å…¥ Edits æ–‡ä»¶ï¼ˆåªè¿›è¡Œè¿½åŠ æ“ä½œï¼Œæ•ˆç‡å¾ˆé«˜ï¼‰ã€‚æ¯å½“å…ƒæ•°æ®æœ‰æ›´æ–°æˆ–è€…æ·»åŠ å…ƒæ•°æ®æ—¶ï¼Œä¿®æ”¹å†…å­˜ä¸­çš„å…ƒæ•°æ®å¹¶è¿½åŠ åˆ° Edits ä¸­ã€‚è¿™æ ·ï¼Œä¸€æ—¦ NameNode èŠ‚ç‚¹æ–­ç”µï¼Œå¯ä»¥é€šè¿‡ FsImage å’Œ Edits çš„åˆå¹¶ï¼Œåˆæˆå…ƒæ•°æ®ã€‚ ä½†æ˜¯ï¼Œå¦‚æœé•¿æ—¶é—´æ·»åŠ æ•°æ®åˆ° Edits ä¸­ï¼Œä¼šå¯¼è‡´è¯¥æ–‡ä»¶æ•°æ®è¿‡å¤§ï¼Œæ•ˆç‡é™ä½ï¼Œè€Œä¸”ä¸€æ—¦æ–­ç”µï¼Œæ¢å¤å…ƒæ•°æ®éœ€è¦çš„æ—¶é—´è¿‡é•¿ã€‚å› æ­¤ï¼Œéœ€è¦å®šæœŸè¿›è¡Œ FsImage å’Œ Edits çš„åˆå¹¶ï¼Œå¦‚æœè¿™ä¸ªæ“ä½œç”± NameNode èŠ‚ç‚¹å®Œæˆï¼Œåˆä¼šæ•ˆç‡è¿‡ä½ã€‚å› æ­¤ï¼Œå¼•å…¥ä¸€ä¸ªæ–°çš„èŠ‚ç‚¹ SecondaryNamenodeï¼Œä¸“é—¨ç”¨äº FsImage å’Œ Edits çš„åˆå¹¶ã€‚ Fsimage å’Œ Edits12345# oiv æŸ¥çœ‹ Fsimage æ–‡ä»¶pwd # /opt/module/hadoop-2.7.2/data/tmp/dfs/name/currenthdfs oiv -p XML -i fsimage_0000000000000000025 -o /opt/module/hadoop-2.7.2/fsimage.xmlcat /opt/module/hadoop-2.7.2/fsimage.xml 12345678910&lt;!-- è®°å½•äº† NameNode çš„ä¿¡æ¯ï¼ŒDataNode ä¿¡æ¯å®šæ—¶åŒæ­¥åˆ° NameNode --&gt;&lt;inode&gt; &lt;id&gt;16386&lt;/id&gt; &lt;type&gt;DIRECTORY&lt;/type&gt; &lt;name&gt;user&lt;/name&gt; &lt;mtime&gt;1512722284477&lt;/mtime&gt; &lt;permission&gt;wingo:supergroup:rwxr-xr-x&lt;/permission&gt; &lt;nsquota&gt;-1&lt;/nsquota&gt; &lt;dsquota&gt;-1&lt;/dsquota&gt;&lt;/inode&gt; 123# oev æŸ¥çœ‹ Edits æ–‡ä»¶hdfs oev -p XML -i edits_0000000000000000012-0000000000000000013 -o /opt/module/hadoop-2.7.2/edits.xmlcat /opt/module/hadoop-2.7.2/edits.xml 12345678910&lt;!-- è®°å½•äº†æ“ä½œä¿¡æ¯ --&gt;&lt;EDITS&gt; &lt;EDITS_VERSION&gt;-63&lt;/EDITS_VERSION&gt; &lt;RECORD&gt; &lt;OPCODE&gt;OP_START_LOG_SEGMENT&lt;/OPCODE&gt; &lt;DATA&gt; &lt;TXID&gt;129&lt;/TXID&gt; &lt;/DATA&gt; &lt;/RECORD&gt;&lt;/EDITS &gt; CheckPoint12345678910111213141516171819&lt;!-- é»˜è®¤é…ç½® hdfs-default.xml --&gt;&lt;property&gt; &lt;name&gt;dfs.namenode.checkpoint.period&lt;/name&gt; &lt;!-- ä¸€å°æ—¶æ‰§è¡Œä¸€æ¬¡ --&gt; &lt;value&gt;3600&lt;/value&gt;&lt;/property&gt;&lt;property&gt; &lt;name&gt;dfs.namenode.checkpoint.txns&lt;/name&gt; &lt;value&gt;1000000&lt;/value&gt; &lt;description&gt;æ“ä½œæ¬¡æ•°è¾¾ä¸€ç™¾ä¸‡æ¬¡&lt;/description&gt;&lt;/property&gt;&lt;property&gt; &lt;name&gt;dfs.namenode.checkpoint.check.period&lt;/name&gt; &lt;value&gt;60&lt;/value&gt; &lt;description&gt;ä¸€åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡æ“ä½œæ¬¡æ•°&lt;/description&gt;&lt;/property &gt; æ•…éšœå¤„ç† NameNode æ•…éšœåï¼Œå¯ä»¥é‡‡ç”¨å¦‚ä¸‹ä¸¤ç§æ–¹æ³•æ¢å¤æ•°æ®ã€‚ 123456789# æ–¹æ³•ä¸€ å°† SecondaryNameNode ä¸­æ•°æ®æ‹·è´åˆ° NameNode å­˜å‚¨æ•°æ®çš„ç›®å½•# æ€æ‰ NameNode ç›¸å…³è¿›ç¨‹kill -9 [pid]# åˆ é™¤ NameNode å­˜å‚¨çš„æ•°æ®rm -rf /opt/module/hadoop-2.7.2/data/tmp/dfs/name/*# æ‹·è´ SecondaryNameNode ä¸­æ•°æ®åˆ°åŸ NameNode å­˜å‚¨æ•°æ®ç›®å½•scp -r root@hadoop104:/opt/module/hadoop-2.7.2/data/tmp/dfs/namesecondary/* ./name/# é‡æ–°å¯åŠ¨ NameNodesbin/hadoop-daemon.sh start namenode 1# æ–¹æ³•äºŒ ä½¿ç”¨ -importCheckpoint é€‰é¡¹å¯åŠ¨ NameNode å®ˆæŠ¤è¿›ç¨‹ï¼Œä»è€Œå°† Secondary NameNode ä¸­æ•°æ®æ‹·è´åˆ° NameNode ç›®å½•ä¸­ã€‚ 1234567891011&lt;!-- ä¿®æ”¹hdfs-site.xml --&gt;&lt;property&gt; &lt;name&gt;dfs.namenode.checkpoint.period&lt;/name&gt; &lt;value&gt;120&lt;/value&gt;&lt;/property&gt;&lt;property&gt; &lt;name&gt;dfs.namenode.name.dir&lt;/name&gt; &lt;value&gt;/opt/module/hadoop-2.7.2/data/tmp/dfs/name&lt;/value&gt;&lt;/property&gt; 123456789101112# æ€æ‰ NameNode ç›¸å…³è¿›ç¨‹kill -9 [pid]# åˆ é™¤ NameNode å­˜å‚¨çš„æ•°æ®rm -rf /opt/module/hadoop-2.7.2/data/tmp/dfs/name/*# å¦‚æœ SecondaryNameNode ä¸å’Œ NameNode åœ¨ä¸€ä¸ªä¸»æœºèŠ‚ç‚¹ä¸Šï¼Œ# éœ€è¦å°† SecondaryNameNode å­˜å‚¨æ•°æ®çš„ç›®å½•æ‹·è´åˆ° NameNode å­˜å‚¨æ•°æ®çš„å¹³çº§ç›®å½•ï¼Œå¹¶åˆ é™¤ in_use.lock æ–‡ä»¶scp -r root@hadoop104:/opt/module/hadoop-2.7.2/data/tmp/dfs/namesecondary ./rm -rf in_use.lock# å¯¼å…¥æ£€æŸ¥ç‚¹æ•°æ®ï¼ˆç­‰å¾…ä¸€ä¼š ctrl+c ç»“æŸæ‰ï¼‰bin/hdfs namenode -importCheckpoint# å¯åŠ¨ NameNodesbin/hadoop-daemon.sh start namenode å®‰å…¨æ¨¡å¼NameNode å¯åŠ¨æ—¶ï¼Œé¦–å…ˆå°†é•œåƒæ–‡ä»¶(ï¼ˆFsimageï¼‰è½½å…¥å…§å­˜ï¼Œå¹¶æ‰§è¡Œç¼–è¾‘æ—¥å¿—(ï¼ˆEditsï¼‰ä¸­çš„å„é¡¹æ“ä½œï¼Œä¸€æ—¦åœ¨å†…å­˜ä¸­æˆåŠŸå»ºç«‹æ–‡ä»¶ç³»ç»Ÿå…ƒæ•°æ®çš„æ˜ åƒï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„ Silageæ–‡ä»¶å’Œä¸€ä¸ªç©ºçš„ç¼–è¾‘æ—¥å¿—ã€‚æ­¤æ—¶ï¼ŒNameNode å¼€å§‹ç›‘å¬ DataNode è¯·æ±‚ã€‚è¿™ä¸ªè¿‡ç¨‹æœŸé—´ï¼ŒNamenode ä¸€ç›´è¿è¡Œåœ¨å®‰å…¨æ¨¡å¼ï¼Œå³ NameNode çš„æ–‡ä»¶ç³»ç»Ÿå¯¹äºå®¢æˆ·ç«¯æ¥è¯´æ˜¯åªè¯»çš„ã€‚ ç³»ç»Ÿä¸­çš„æ•°æ®å—çš„ä½ç½®å¹¶ä¸æ˜¯ç”± NameNode ç»´æŠ¤çš„ï¼Œè€Œæ˜¯ä»¥å—åˆ—è¡¨çš„å½¢å¼å­˜å‚¨åœ¨ DataNode ä¸­ã€‚åœ¨ç³»ç»Ÿçš„æ­£å¸¸æ“ä½œæœŸé—´, NameNodeä¼šåœ¨å†…å­˜ä¸­ä¿ç•™æ‰€æœ‰å—ä½ç½®çš„æ˜ å°„ä¿¡æ¯ã€‚åœ¨å®‰å…¨æ¨¡å¼ä¸‹ï¼Œå„ä¸ª Datanode ä¼šå‘ NameNode å‘é€æœ€æ–°çš„å—åˆ—è¡¨ä¿¡æ¯,ï¼ŒNameNode äº†è§£åˆ°è¶³å¤Ÿå¤šçš„å—ä½ç½®ä¿¡æ¯ä¹‹åï¼Œå³å¯é«˜æ•ˆè¿è¡Œæ–‡ä»¶ç³»ç»Ÿã€‚ å¦‚æœæ»¡è¶³â€œæœ€å°å‰¯æœ¬æ¡ä»¶â€,ï¼ŒNameNode ä¼šåœ¨ 30 ç§’é’Ÿä¹‹åå°±é€€å‡ºå®‰å…¨æ¨¡å¼ã€‚æ‰€è°“çš„æœ€å°å‰¯æœ¬æ¡ä»¶æŒ‡çš„æ˜¯åœ¨æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿä¸­ 99.9% çš„å—æ»¡è¶³æœ€å°å‰¯æœ¬çº§åˆ«ï¼ˆé»˜è®¤å€¼ï¼šdfs.replication.min=1ï¼‰ã€‚åœ¨å¯åŠ¨ä¸€ä¸ªåˆšåˆšæ ¼å¼åŒ–çš„ HDFS é›†ç¾¤æ—¶ï¼Œå› ä¸ºç³»ç»Ÿä¸­è¿˜æ²¡æœ‰ä»»ä½•å—ï¼Œæ‰€ä»¥ NameNode ä¸ä¼šè¿›å…¥å®‰å…¨æ¨¡å¼ã€‚ 12345bin/hdfs dfsadmin -safemode get # æŸ¥çœ‹å®‰å…¨æ¨¡å¼çŠ¶æ€bin/hdfs dfsadmin -safemode enter # åŠŸèƒ½æè¿°ï¼šè¿›å…¥å®‰å…¨æ¨¡å¼çŠ¶æ€bin/hdfs dfsadmin -safemode leave # ç¦»å¼€å®‰å…¨æ¨¡å¼çŠ¶æ€bin/hdfs dfsadmin -safemode wait # ç­‰å¾…å®‰å…¨æ¨¡å¼ç»“æŸçŠ¶æ€# å¯ä»¥ç¼–å†™è„šæœ¬ï¼Œåœ¨å®‰å…¨æ¨¡å¼ä¸‹å µå¡ç­‰å¾…å®‰å…¨æ¨¡å¼ç»“æŸè¿è¡Œæ¥ä¸‹æ¥çš„å‘½ä»¤ å¤šç›®å½• NameNode çš„æœ¬åœ°ç›®å½•å¯ä»¥é…ç½®æˆå¤šä¸ªï¼Œä¸”æ¯ä¸ªç›®å½•å­˜æ”¾å†…å®¹ç›¸åŒï¼Œå¢åŠ äº†å¯é æ€§ã€‚ 1234567891011&lt;!-- hdfs-site.xml é…ç½® --&gt;&lt;property&gt; &lt;name&gt;hadoop.tmp.dir&lt;/name&gt; &lt;value&gt;/opt/module/hadoop-2.7.2/data/tmp&lt;/value&gt;&lt;/property&gt;&lt;property&gt; &lt;name&gt;dfs.namenode.name.dir&lt;/name&gt; &lt;value&gt;file:///$&#123;hadoop.tmp.dir&#125;/dfs/name1,file:///$&#123;hadoop.tmp.dir&#125;/dfs/name2&lt;/value&gt;&lt;/property&gt; DataNode ä¹Ÿå¯ä»¥é…ç½®æˆå¤šä¸ªç›®å½•ï¼Œæ¯ä¸ªç›®å½•å­˜å‚¨çš„æ•°æ®ä¸ä¸€æ ·ã€‚å³ï¼šæ•°æ®ä¸æ˜¯å‰¯æœ¬ã€‚ 123456&lt;!-- hdfs-site.xml é…ç½® --&gt;&lt;property&gt; &lt;name&gt;dfs.datanode.data.dir&lt;/name&gt; &lt;value&gt;file:///$&#123;hadoop.tmp.dir&#125;/dfs/data1,file:///$&#123;hadoop.tmp.dir&#125;/dfs/data2&lt;/value&gt;&lt;/property&gt; DataNode DataNode æ‰çº¿æ—¶é™å‚æ•°è®¾ç½® 12345678910111213&lt;!-- Timeout = 2*dfs.namenode.heartbeat.recheck-interval + 10*dfs.heartbeat.interval --&gt;&lt;!-- hdfs-default.xml é»˜è®¤é…ç½® --&gt;&lt;property&gt; &lt;name&gt;dfs.namenode.heartbeat.recheck-interval&lt;/name&gt; &lt;value&gt;300000&lt;/value&gt; &lt;!-- å•ä½ ms --&gt;&lt;/property&gt;&lt;property&gt; &lt;name&gt;dfs.heartbeat.interval&lt;/name&gt; &lt;value&gt;3&lt;/value&gt; &lt;!-- å•ä½ s --&gt;&lt;/property&gt; æ•°æ®å®Œæ•´æ€§ æ£€æµ‹ DataNode èŠ‚ç‚¹ä¸Šçš„æ•°æ®æ˜¯å¦å®Œæ•´ï¼Ÿ å½“ DataNode è¯»å– Block çš„æ—¶å€™ï¼Œå®ƒä¼šè®¡ç®— CheckSumï¼Œå¦‚æœè®¡ç®—åçš„ CheckSumï¼Œä¸ Block åˆ›å»ºæ—¶å€¼ä¸ä¸€æ ·ï¼Œè¯´æ˜ Block å·²ç»æŸåã€‚ Client è¯»å–å…¶ä»– DataNode ä¸Šçš„ Blockï¼ŒDataNode åœ¨å…¶æ–‡ä»¶åˆ›å»ºåå‘¨æœŸéªŒè¯ CheckSumã€‚ é»‘ç™½åå• æ·»åŠ åˆ°ç™½åå•çš„ä¸»æœºèŠ‚ç‚¹ï¼Œéƒ½å…è®¸è®¿é—® NameNodeï¼Œä¸åœ¨ç™½åå•çš„ä¸»æœºèŠ‚ç‚¹ï¼Œéƒ½ä¼šè¢«é€€å‡ºã€‚ 1234# ç™½åå•# åœ¨ NameNode çš„ /opt/module/hadoop-2.7.2/etc/hadoop ç›®å½•ä¸‹åˆ›å»º dfs.hosts æ–‡ä»¶vi dfs.hosts # æ·»åŠ å…è®¸çš„ä¸»æœºå 123456&lt;!-- hdfs-site.xml --&gt;&lt;property&gt; &lt;name&gt;dfs.hosts&lt;/name&gt; &lt;value&gt;/opt/module/hadoop-2.7.2/etc/hadoop/dfs.hosts&lt;/value&gt;&lt;/property&gt; 1234567# åˆ†å‘é…ç½®æ–‡ä»¶xsync hdfs-site.xml# æ›´æ–°èŠ‚ç‚¹ä¿¡æ¯hdfs dfsadmin -refreshNodesyarn rmadmin -refreshNodes# å¦‚æœæ•°æ®ä¸å‡è¡¡ï¼Œå¯ä»¥ç”¨å‘½ä»¤å®ç°é›†ç¾¤çš„å†å¹³è¡¡./start-balancer.sh åœ¨é»‘åå•ä¸Šé¢çš„ä¸»æœºéƒ½ä¼šè¢«å¼ºåˆ¶é€€å‡ºã€‚ 123# é»‘åå•vi dfs.hosts.exclude # æ·»åŠ ä¸å…è®¸çš„ä¸»æœºå 123456&lt;!-- hdfs-site.xml --&gt;&lt;property&gt; &lt;name&gt;dfs.hosts.exclude&lt;/name&gt; &lt;value&gt;/opt/module/hadoop-2.7.2/etc/hadoop/dfs.hosts.exclude&lt;/value&gt;&lt;/property&gt; 1234567# æ›´æ–°èŠ‚ç‚¹ä¿¡æ¯hdfs dfsadmin -refreshNodesyarn rmadmin -refreshNodes# å¦‚æœæ•°æ®ä¸å‡è¡¡ï¼Œå¯ä»¥ç”¨å‘½ä»¤å®ç°é›†ç¾¤çš„å†å¹³è¡¡./start-balancer.sh# æ£€æŸ¥ Web æµè§ˆå™¨ï¼Œé€€å½¹èŠ‚ç‚¹çš„çŠ¶æ€ä¸º decommission in progressï¼ˆé€€å½¹ä¸­ï¼‰ï¼Œè¯´æ˜æ•°æ®èŠ‚ç‚¹æ­£åœ¨å¤åˆ¶å—åˆ°å…¶ä»–èŠ‚ç‚¹# ç­‰å¾…é€€å½¹èŠ‚ç‚¹çŠ¶æ€ä¸º decommissionedï¼ˆæ‰€æœ‰å—å·²ç»å¤åˆ¶å®Œæˆï¼‰ï¼Œåœæ­¢è¯¥èŠ‚ç‚¹åŠèŠ‚ç‚¹èµ„æºç®¡ç†å™¨ å›æ”¶ç«™ å¼€å¯å›æ”¶ç«™åŠŸèƒ½ï¼Œå¯ä»¥å°†åˆ é™¤çš„æ–‡ä»¶åœ¨ä¸è¶…æ—¶çš„æƒ…å†µä¸‹ï¼Œæ¢å¤åŸæ•°æ®ï¼Œèµ·åˆ°é˜²æ­¢è¯¯åˆ é™¤ã€å¤‡ä»½ç­‰ä½œç”¨ã€‚ 1234# 0 è¡¨ç¦ç”¨ï¼Œå…¶ä»–å€¼è¡¨ç¤ºè®¾ç½®æ–‡ä»¶çš„å­˜æ´»æ—¶é—´# fs.trash.interval=0# æ£€æŸ¥å›æ”¶ç«™çš„é—´éš”æ—¶é—´ã€‚å¦‚æœè¯¥å€¼ä¸º 0ï¼Œåˆ™è¯¥å€¼è®¾ç½®å’Œ fs.trash.interval çš„å‚æ•°å€¼ç›¸ç­‰ã€‚# fs.trash.checkpoint.interval=0 12345678910111213&lt;!-- core-site.xml --&gt;&lt;property&gt; &lt;name&gt;fs.trash.interval&lt;/name&gt; &lt;value&gt;1&lt;/value&gt; &lt;!-- min --&gt;&lt;/property&gt;&lt;property&gt; &lt;name&gt;hadoop.http.staticuser.user&lt;/name&gt; &lt;value&gt;wingo&lt;/value&gt; &lt;!-- è¿›å…¥å›æ”¶ç«™çš„åç§° --&gt;&lt;/property&gt; 123456789# å›æ”¶ç«™åœ¨é›†ç¾¤ä¸­çš„è·¯å¾„/user/wingo/.Trash/...# é€šè¿‡ç¨‹åºåˆ é™¤çš„æ–‡ä»¶ä¸ä¼šç»è¿‡å›æ”¶ç«™ï¼Œéœ€è¦è°ƒç”¨ moveToTrash() æ‰è¿›å…¥å›æ”¶ç«™# Trash trash = New Trash(conf);# trash.moveToTrash(path);# å›å¤å›æ”¶ç«™æ•°æ®hadoop fs -mv /user/wingo/.Trash/Current/user/wingo/input /user/wingo/input# æ¸…ç©ºå›æ”¶ç«™hadoop fs -expunge å¿«ç…§ç®¡ç†12345678hdfs dfsadmin -allowSnapshot [è·¯å¾„] # å¼€å¯æŒ‡å®šç›®å½•çš„å¿«ç…§åŠŸèƒ½hdfs dfsadmin -disallowSnapshot [è·¯å¾„] # ç¦ç”¨æŒ‡å®šç›®å½•çš„å¿«ç…§åŠŸèƒ½ï¼Œé»˜è®¤æ˜¯ç¦ç”¨hdfs dts -createSnapshot [è·¯å¾„] # å¯¹ç›®å½•åˆ›å»ºå¿«ç…§hdfs dts -createSnapshot [è·¯å¾„] [åç§°] # æŒ‡å®šåç§°åˆ›å»ºå¿«ç…§hdts dfs -renameSnapshot [è·¯å¾„] [æ—§åç§°] [æ–°åç§°] # é‡å‘½åå¿«ç…§hdfs lsSnapshottableDir # åˆ—å‡ºå½“å‰ç”¨æˆ·æ‰€æœ‰å¯å¿«ç…§ç›®å½•hdfs snapshotDiff [è·¯å¾„] [è·¯å¾„] # æ¯”è¾ƒä¸¤ä¸ªå¿«ç…§ç›®å½•çš„ä¸åŒä¹‹å¤„hdfs dfs -deleteSnapshot &lt;path&gt; &lt;snapshotname&gt; # åˆ é™¤å¿«ç…§ MapReduceMapReduce æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼è¿ç®—ç¨‹åºçš„ç¼–ç¨‹æ¡†æ¶,æ˜¯ç”¨æˆ·å¼€å‘â€œåŸºäº Hadoop çš„æ•°æ®åˆ†æåº”ç”¨â€çš„æ ¸å¿ƒæ¡†æ¶ã€‚ MapReduce æ ¸å¿ƒåŠŸèƒ½æ˜¯å°†ç”¨æˆ·ç¼–å†™çš„ä¸šåŠ¡é€»è¾‘ä»£ç å’Œè‡ªå¸¦é»˜è®¤ç»„ä»¶æ•´åˆæˆä¸€ä¸ªå®Œæ•´çš„åˆ†å¸ƒå¼è¿ç®—ç¨‹åºï¼Œå¹¶å‘è¿è¡Œåœ¨ä¸€ä¸ª Hadoop é›†ç¾¤ä¸Šã€‚ å…·æœ‰æ˜“äºç¼–ç¨‹ã€æ‰©å±•æ€§è‰¯å¥½ã€é«˜å®¹é”™æ€§ã€PB çº§åˆ«æµ·é‡æ•°æ®å¤„ç†èƒ½åŠ›ç­‰ä¼˜ç‚¹ï¼›å…·æœ‰ä¸æ“…é•¿å®æ—¶è®¡ç®—ã€ä¸æ“…é•¿æµå¼è®¡ç®—ã€ä¸æ“…é•¿ DAG ï¼ˆæœ‰å‘å›¾ï¼‰è®¡ç®—ï¼Œå³éœ€è¦è¿­ä»£çš„è®¡ç®—ç­‰ç¼ºé™·ã€‚ å®ä¾‹è¿›ç¨‹ MrAppMasterï¼šè´Ÿè´£æ•´ä¸ªç¨‹åºçš„è¿‡ç¨‹è°ƒåº¦åŠçŠ¶æ€åè°ƒï¼›MapTaskï¼šè´Ÿè´£ Map é˜¶æ®µçš„æ•´ä¸ªæ•°æ®å¤„ç†æµç¨‹ï¼›ReduceTaskï¼šè´Ÿè´£ Reduce é˜¶æ®µçš„æ•´ä¸ªæ•°æ®å¤„ç†æµç¨‹ã€‚ åºåˆ—åŒ–ç±»å‹ Javaç±»å‹ Hadoop Writableç±»å‹ boolean BooleanWritable byte ByteWritable int IntWritable float FloatWritable long LongWritable double DoubleWritable String Text map MapWritable array ArrayWritable ç¼–ç¨‹è§„èŒƒ ç”¨æˆ·ç¼–å†™çš„ç¨‹åºåˆ†æˆä¸‰ä¸ªéƒ¨åˆ†ï¼šMapperã€Reducer å’Œ Driverã€‚ Mapper é˜¶æ®µ ç”¨æˆ·è‡ªå®šä¹‰çš„ Mapper è¦ç»§æ‰¿æŒ‡å®šçš„çˆ¶ç±»ï¼›Mapper çš„è¾“å…¥æ•°æ®æ˜¯ K V å¯¹çš„å¼€å¼ï¼ˆK V çš„ç±»å‹å¯è‡ªå®šä¹‰ï¼‰ï¼›Mapper ä¸­çš„ä¸šåŠ¡é€»è¾‘å†™åœ¨ map() æ–¹æ³•ä¸­ï¼›Mapper çš„è¾“å‡ºæ•°æ®æ˜¯ K â…¤ å¯¹çš„å½¢å¼ï¼ˆK V çš„ç±»å‹å¯è‡ªå®šä¹‰ï¼‰ï¼›map() æ–¹æ³•( MapTask è¿›ç¨‹ï¼‰å¯¹æ¯ä¸€ä¸ª K V&gt;è°ƒç”¨ä¸€æ¬¡ã€‚ 123456789101112131415161718192021222324// Key åç§»é‡ è¾“å…¥æ•°æ® Value ç±»å‹ è¾“å‡ºæ•°æ®ç±»å‹çš„ K V ğŸ‘‰ å¯¹åº” Reduce çš„è¾“å…¥public class WordcountMapper extends Mapper&lt;LongWritable, Text, Text, IntWritable&gt;&#123; Text k = new Text(); IntWritable v = new IntWritable(1); // æ­¤æ–¹æ³•æ¯æ¬¡åªè·å–ä¸€è¡Œ @Override protected void map(LongWritable key, Text value, Context context) throws IOException, InterruptedException &#123; // è·å–ä¸€è¡Œ String line = value.toString(); // åˆ‡å‰² String[] words = line.split(\" \"); // è¾“å‡º for (String word : words) &#123; k.set(word); // (word, 1) context.write(k, v); &#125; &#125;&#125; Reduce é˜¶æ®µ ç”¨æˆ·è‡ªå®šä¹‰çš„ Reducer è¦ç»§æ‰¿è‡ªå·±çš„çˆ¶ç±»ï¼›Reducer çš„è¾“å…¥æ•°æ®ç±»å‹å¯¹åº” Mapper çš„è¾“å‡ºæ•°æ®ç±»å‹ï¼Œä¹Ÿæ˜¯ K V å¯¹çš„å½¢å¼Reducer çš„ä¸šåŠ¡é€»è¾‘å†™åœ¨ reduce() æ–¹æ³•ä¸­ReduceTask è¿›ç¨‹å¯¹æ¯ä¸€ç»„ç›¸åŒ K çš„ K V ç»„è°ƒç”¨ä¸€æ¬¡ reduce() æ–¹æ³• 12345678910111213141516171819public class WordcountReducer extends Reducer&lt;Text, IntWritable, Text, IntWritable&gt;&#123; int sum; IntWritable v = new IntWritable(); // è¿™é‡Œç›´æ¥ç©¿å…¥ä¸€ä¸ªè¿­ä»£å™¨äº†ï¼Œç›´æ¥å¾ªç¯å–å€¼å³å¯ @Override protected void reduce(Text key, Iterable&lt;IntWritable&gt; values,Context context) throws IOException, InterruptedException &#123; // ç´¯åŠ æ±‚å’Œ sum = 0; for (IntWritable count : values) &#123; sum += count.get(); &#125; // è¾“å‡º v.set(sum); context.write(key,v); &#125;&#125; Driver é˜¶æ®µ ç›¸å½“äº YARN é›†ç¾¤çš„å®¢æˆ·ç«¯ï¼Œç”¨äºæäº¤æˆ‘ä»¬æ•´ä¸ªç¨‹åºåˆ° YARN é›†ç¾¤,æäº¤çš„æ˜¯å°è£…äº† MapReduce ç¨‹åºç›¸å…³è¿è¡Œå‚æ•°çš„ job å¯¹è±¡ã€‚ 123456789101112131415161718192021222324252627282930313233public class WordcountDriver &#123; public static void main(String[] args) throws IOException, ClassNotFoundException, InterruptedException &#123; // è·å–é…ç½®ä¿¡æ¯ä»¥åŠå°è£…ä»»åŠ¡ Configuration configuration = new Configuration(); Job job = Job.getInstance(configuration); // è®¾ç½® jar åŠ è½½è·¯å¾„ job.setJarByClass(WordcountDriver.class); // è®¾ç½® map å’Œ reduce ç±» job.setMapperClass(WordcountMapper.class); job.setReducerClass(WordcountReducer.class); // è®¾ç½® map è¾“å‡º job.setMapOutputKeyClass(Text.class); job.setMapOutputValueClass(IntWritable.class); // è®¾ç½®æœ€ç»ˆè¾“å‡º K V ç±»å‹ job.setOutputKeyClass(Text.class); job.setOutputValueClass(IntWritable.class); // è®¾ç½®è¾“å…¥å’Œè¾“å‡ºè·¯å¾„ FileInputFormat.setInputPaths(job, new Path(args[0])); FileOutputFormat.setOutputPath(job, new Path(args[1])); // æäº¤ boolean result = job.waitForCompletion(true); System.exit(result ? 0 : 1); &#125;&#125; Shuffle Map æ–¹æ³•ä¹‹åï¼ŒReduce æ–¹æ³•ä¹‹å‰çš„æ•°æ®å¤„ç†è¿‡ç¨‹ç§°ä¹‹ä¸º Shuffleï¼ŒåŒ…å«äº†ä¸¤ç«¯çš„ Combiner å’Œ Partitionã€‚ Partition è¦æ±‚å°†ç»Ÿè®¡ç»“æœæŒ‰ç…§æ¡ä»¶è¾“å‡ºåˆ°ä¸åŒæ–‡ä»¶ä¸­ï¼ˆåˆ†åŒºï¼‰ã€‚ 1234567// é»˜è®¤ Partition åˆ†åŒºæœºåˆ¶ï¼Œç”¨æˆ·æ— æ³•æ§åˆ¶ Key çš„å­˜å‚¨åˆ†åŒºpublic class HashPartironer&lt;K, V&gt; extends Partitioner&lt;K, V&gt; &#123; public int getPartition(K key, V vlaue, int numReduceTasks) &#123; return (key.hashCode() &amp; Integer.MAX_VALUE) % numberReduceTasks; &#125;&#125; è‡ªå®šä¹‰12345678910111213141516171819202122232425262728293031323334// éœ€æ±‚ï¼šå°†ç»Ÿè®¡ç»“æœæŒ‰ç…§æ‰‹æœºå½’å±åœ°ä¸åŒçœä»½è¾“å‡ºåˆ°ä¸åŒæ–‡ä»¶ä¸­ï¼ˆåˆ†åŒºï¼‰public class ProvincePartitioner extends Partitioner&lt;Text, FlowBean&gt; &#123; @Override public int getPartition(Text key, FlowBean value, int numPartitions) &#123; // è·å–ç”µè¯å·ç çš„å‰ä¸‰ä½ String preNum = key.toString().substring(0, 3); int partition = 4; // åˆ¤æ–­æ˜¯å“ªä¸ªçœ if (\"136\".equals(preNum)) &#123; partition = 0; &#125;else if (\"137\".equals(preNum)) &#123; partition = 1; &#125;else if (\"138\".equals(preNum)) &#123; partition = 2; &#125;else if (\"139\".equals(preNum)) &#123; partition = 3; &#125; return partition; &#125;&#125;// Driver// æŒ‡å®šè‡ªå®šä¹‰æ•°æ®åˆ†åŒºjob.setPartitionerClass(ProvincePartitioner.class);// åŒæ—¶æŒ‡å®šç›¸åº”æ•°é‡çš„ reduce taskjob.setNumReduceTasks(5);// job.setNumReduceTasks(1) ä¼šæ­£å¸¸è¿è¡Œ,åªä¸è¿‡ä¼šäº§ç”Ÿä¸€ä¸ªè¾“å‡ºæ–‡ä»¶// job.setNumReduceTasks(2) ä¼šæŠ¥é”™// job.setNumReduceTasks(6) å¤§äº 5 ç¨‹åºæ­£å¸¸è¿è¡Œï¼Œä¼šäº§ç”Ÿç©ºæ–‡ä»¶ æ’åºMapTask å’Œ ReduceTask å‡ä¼šå¯¹æ•°æ®æŒ‰ç…§ key è¿›è¡Œæ’åºï¼Œè¯¥æ“ä½œå± Hadoop çš„é»˜è®¤è¡Œä¸ºã€‚ä»»ä½•åº”ç”¨ç¨‹åºä¸­çš„æ•°æ®å‡ä¼šè¢«æ’åºï¼Œè€Œä¸ç®¡é€»è¾‘ä¸Šå¦éœ€è¦ã€‚ é»˜è®¤æ’åºæ˜¯æŒ‰ç…§å­—æ›²é¡ºåºæ’åºï¼Œä¸”å®ç°è¯¥æ’åºçš„æ–¹æ³•æ˜¯å¿«é€Ÿæ’åºã€‚ å¯¹äº MapTaskï¼Œå®ƒä¼šå°†å¤„ç†çš„ç»“æœæš‚æ—¶æ”¾åˆ°ç¯å½¢ç¼“å†²åŒºä¸­ï¼Œå½“ç¯å½¢ç¼“å†²åŒºä½¿ç”¨ç‡è¾¾åˆ°ä¸€å®šé˜ˆå€¼åï¼Œå†å¯¹ç¼“å†²åŒºä¸­çš„æ•°æ®è¿›è¡Œä¸€æ¬¡å¿«é€Ÿæ’åºï¼Œå¹¶å°†è¿™äº›æœ‰åºæ•°æ®æº¢å†™åˆ°ç£ç›˜ä¸Šï¼Œè€Œå½“æ•°æ®å¤„ç†å®Œæ¯•åï¼Œå®ƒä¼šå¯¹ç£ç›˜ä¸Šæ‰€æœ‰æ–‡ä»¶è¿›è¡Œå½’å¹¶æ’åºã€‚ å¯¹äº ReduceTaskï¼Œå®ƒä»æ¯ä¸ª MapTask ä¸Šè¿œç¨‹æ‹·è´ç›¸åº”çš„æ•°æ®æ–‡ä»¶ï¼Œå¦‚æœæ–‡ä»¶å¤§å°è¶…è¿‡ä¸€å®šé˜ˆå€¼ï¼Œåˆ™æº¢å†™ç£ç›˜ä¸Šï¼Œå¦åˆ™å­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚å¦‚æœç£ç›˜ä¸Šæ–‡ä»¶æ•°ç›®è¾¾åˆ°ä¸€å®šé˜ˆå€¼ï¼Œåˆ™è¿›è¡Œä¸€æ¬¡å½’å¹¶æ’åºä»¥ç”Ÿæˆä¸€ä¸ªæ›´å¤§æ–‡ä»¶ï¼›å¦‚æœå†…å­˜ä¸­æ–‡ä»¶å¤§å°æˆ–è€…æ•°ç›®è¶…è¿‡ä¸€å®šé˜ˆå€¼ï¼Œåˆ™è¿›è¡Œä¸€æ¬¡åˆå¹¶åå°†æ•°æ®æº¢å†™åˆ°ç£ç›˜ä¸Šã€‚å½“æ‰€æœ‰æ•°æ®æ‹·è´å®Œæ¯•å, ReduceTask ç»Ÿä¸€å¯¹å†…å­˜å’Œç£ç›˜ä¸Šçš„æ‰€æœ‰æ•°æ®è¿›è¡Œä¸€æ¬¡å½’å¹¶æ’åºã€‚ è‡ªå®šä¹‰123456789101112131415161718// bean å¯¹è±¡åšä¸º key ä¼ è¾“ï¼Œéœ€è¦å®ç° WritableComparable æ¥å£é‡å†™ compareTo æ–¹æ³•ï¼Œå°±å¯ä»¥å®ç°æ’åº@Overridepublic int compareTo(FlowBean o) &#123; int result; // æŒ‰ç…§æ€»æµé‡å¤§å°ï¼Œå€’åºæ’åˆ— if (sumFlow &gt; bean.getSumFlow()) &#123; result = -1; &#125;else if (sumFlow &lt; bean.getSumFlow()) &#123; result = 1; &#125;else &#123; result = 0; &#125; return result;&#125; åˆå¹¶ Combiner ç»„ä»¶çš„çˆ¶ç±»å°±æ˜¯ Reducerã€‚Combiner æ˜¯åœ¨æ¯ä¸€ä¸ª MapTask æ‰€åœ¨çš„èŠ‚ç‚¹è¿è¡Œï¼Œè¿›è¡Œå±€éƒ¨æ±‡æ€»ï¼Œå‡å°‘ç½‘ç»œä¼ è¾“é‡ï¼›Reducer æ˜¯æ¥æ”¶å…¨å±€æ‰€æœ‰ Mapper çš„è¾“å‡ºç»“æœã€‚ 123456789101112131415161718192021// è‡ªå®šä¹‰ä¸€ä¸ª Combiner ç»§æ‰¿ Reducerï¼Œé‡å†™ Reduce æ–¹æ³•// Combiner K V å¯¹åº” Reducer K Vpublic class WordcountCombiner extends Reducer&lt;Text, IntWritable, Text , IntWritable&gt;&#123; @Override protected void reduce(Text key, Iterable&lt;IntWritable&gt; values,Context context) throws IOException, InterruptedException &#123; // æ±‡æ€»æ“ä½œ int count = 0; for(IntWritable v : values)&#123; count += v.get(); &#125; // å†™å‡º context.write(key, new IntWritable(count)); &#125;&#125;// Driverjob.setCombinerClass(WordcountCombiner.class); åˆ†ç»„ å¯¹ Reduce é˜¶æ®µçš„æ•°æ®æ ¹æ®æŸä¸€ä¸ªæˆ–å‡ ä¸ªå­—æ®µè¿›è¡Œåˆ†ç»„ã€‚ è‡ªå®šä¹‰ç±»ç»§æ‰¿ WritableComparatorï¼›é‡å†™ compare() æ–¹æ³•ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354// OrderBeanpublic class OrderBean implements WritableComparable&lt;OrderBean&gt; &#123; private int order_id; // è®¢å•idå· private double price; // ä»·æ ¼ public OrderBean() &#123; super(); &#125; public OrderBean(int order_id, double price) &#123; super(); this.order_id = order_id; this.price = price; &#125; // åºåˆ—åŒ– @Override public void write(DataOutput out) throws IOException &#123; out.writeInt(order_id); out.writeDouble(price); &#125; // ååºåˆ—åŒ– @Override public void readFields(DataInput in) throws IOException &#123; order_id = in.readInt(); price = in.readDouble(); &#125; @Override public String toString() &#123; return order_id + \"\\t\" + price; &#125; // Getter / Setter // äºŒæ¬¡æ’åºï¼Œå³ map ç»“æŸä¹‹å‰çš„ä¸€æ¬¡æ’åºï¼Œæ’åºåè¾“å‡ºåˆ° reduce @Override public int compareTo(OrderBean o) &#123; int result; if (order_id &gt; o.getOrder_id()) &#123; result = 1; &#125; else if (order_id &lt; o.getOrder_id()) &#123; result = -1; &#125; else &#123; // ä»·æ ¼å€’åºæ’åº result = price &gt; o.getPrice() ? -1 : 1; &#125; return result; &#125;&#125; 123456789101112131415161718192021222324// ç¼–å†™ OrderSortMapper ç±»// 0000001 Pdt_01 222.8public class OrderMapper extends Mapper&lt;LongWritable, Text, OrderBean, NullWritable&gt; &#123; OrderBean k = new OrderBean(); @Override protected void map(LongWritable key, Text value, Context context) throws IOException, InterruptedException &#123; // è·å–ä¸€è¡Œ String line = value.toString(); // æˆªå– String[] fields = line.split(\"\\t\"); // å°è£…å¯¹è±¡ k.setOrder_id(Integer.parseInt(fields[0])); k.setPrice(Double.parseDouble(fields[2])); // å†™å‡º context.write(k, NullWritable.get()); &#125;&#125; 12345678910111213141516171819202122232425262728// ç¼–å†™ OrderSortGroupingComparator ç±»// åœ¨ reduce å‰é€šè¿‡æ­¤æ’åºè¿›è¡Œåˆ†ç»„public class OrderGroupingComparator extends WritableComparator &#123; // åˆ›å»ºä¸€ä¸ªæ„é€ å°†æ¯”è¾ƒå¯¹è±¡çš„ç±»ä¼ ç»™çˆ¶ç±» protected OrderGroupingComparator() &#123; super(OrderBean.class, true); &#125; @Override public int compare(WritableComparable a, WritableComparable b) &#123; OrderBean aBean = (OrderBean) a; OrderBean bBean = (OrderBean) b; int result; if (aBean.getOrder_id() &gt; bBean.getOrder_id()) &#123; result = 1; &#125; else if (aBean.getOrder_id() &lt; bBean.getOrder_id()) &#123; result = -1; &#125; else &#123; result = 0; &#125; return result; &#125;&#125; 123456789101112131415// ç¼–å†™ OrderSortReducer ç±»public class OrderReducer extends Reducer&lt;OrderBean, NullWritable, OrderBean, NullWritable&gt; &#123; @Override protected void reduce(OrderBean key, Iterable&lt;NullWritable&gt; values, Context context) throws IOException, InterruptedException &#123; // åªèƒ½é€šè¿‡ NullWritable.get() è·å–ç©ºå€¼ context.write(key, NullWritable.get()); &#125;&#125;// Driver// è®¾ç½® reduce ç«¯çš„åˆ†ç»„job.setGroupingComparatorClass(OrderGroupingComparator.class); MapTaskRead é˜¶æ®µï¼šMapTask é€šè¿‡ç”¨æˆ·ç¼–å†™çš„ RecordReaderï¼Œä»è¾“å…¥ InputSplit ä¸­è§£æå‡ºä¸€ä¸ªä¸ª key / valueï¼› Map é˜¶æ®µï¼šè¯¥é˜¶æ®µä¸»è¦æ˜¯å°†è§£æå‡ºçš„ key / value äº¤ç»™ç”¨æˆ·ç¼–å†™ map() å‡½æ•°å¤„ç†ï¼Œå¹¶äº§ç”Ÿä¸€ç³»åˆ—æ–°çš„ key / valueï¼› Collect æ”¶é›†é˜¶æ®µï¼šåœ¨ç”¨æˆ·ç¼–å†™ map() å‡½æ•°ä¸­ï¼Œå½“æ•°æ®å¤„ç†å®Œæˆåï¼Œä¸€èˆ¬ä¼šè°ƒç”¨ OutputCollector.collect() è¾“å‡ºç»“æœã€‚åœ¨è¯¥å‡½æ•°å†…éƒ¨ï¼Œå®ƒä¼šå°†ç”Ÿæˆçš„ key / value åˆ†åŒºï¼ˆè°ƒç”¨ Partitionerï¼‰ï¼Œå¹¶å†™å…¥ä¸€ä¸ªç¯å½¢å†…å­˜ç¼“å†²åŒºä¸­ï¼› Spill é˜¶æ®µï¼šå³â€œæº¢å†™â€ï¼Œå½“ç¯å½¢ç¼“å†²åŒºæ»¡åï¼ŒMapReduce ä¼šå°†æ•°æ®å†™åˆ°æœ¬åœ°ç£ç›˜ä¸Šï¼Œç”Ÿæˆä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå°†æ•°æ®å†™å…¥æœ¬åœ°ç£ç›˜ä¹‹å‰ï¼Œå…ˆè¦å¯¹æ•°æ®è¿›è¡Œä¸€æ¬¡æœ¬åœ°æ’åºï¼Œå¹¶åœ¨å¿…è¦æ—¶å¯¹æ•°æ®è¿›è¡Œåˆå¹¶ã€å‹ç¼©ç­‰æ“ä½œã€‚ æº¢å†™é˜¶æ®µè¯¦æƒ…ï¼š åˆ©ç”¨å¿«é€Ÿæ’åºç®—æ³•å¯¹ç¼“å­˜åŒºå†…çš„æ•°æ®è¿›è¡Œæ’åºï¼Œæ’åºæ–¹å¼æ˜¯ï¼Œå…ˆæŒ‰ç…§åˆ†åŒºç¼–å· Partition è¿›è¡Œæ’åºï¼Œç„¶åæŒ‰ç…§ key è¿›è¡Œæ’åºã€‚è¿™æ ·ï¼Œç»è¿‡æ’åºåï¼Œæ•°æ®ä»¥åˆ†åŒºä¸ºå•ä½èšé›†åœ¨ä¸€èµ·ï¼Œä¸”åŒä¸€åˆ†åŒºå†…æ‰€æœ‰æ•°æ®æŒ‰ç…§ key æœ‰åºã€‚ æŒ‰ç…§åˆ†åŒºç¼–å·ç”±å°åˆ°å¤§ä¾æ¬¡å°†æ¯ä¸ªåˆ†åŒºä¸­çš„æ•°æ®å†™å…¥ä»»åŠ¡å·¥ä½œç›®å½•ä¸‹çš„ä¸´æ—¶æ–‡ä»¶ output/spillN.outï¼ˆNè¡¨ç¤ºå½“å‰æº¢å†™æ¬¡æ•°ï¼‰ä¸­ã€‚å¦‚æœç”¨æˆ·è®¾ç½®äº† Combinerï¼Œåˆ™å†™å…¥æ–‡ä»¶ä¹‹å‰ï¼Œå¯¹æ¯ä¸ªåˆ†åŒºä¸­çš„æ•°æ®è¿›è¡Œä¸€æ¬¡èšé›†æ“ä½œã€‚ å°†åˆ†åŒºæ•°æ®çš„å…ƒä¿¡æ¯å†™åˆ°å†…å­˜ç´¢å¼•æ•°æ®ç»“æ„ SpillRecord ä¸­ï¼Œå…¶ä¸­æ¯ä¸ªåˆ†åŒºçš„å…ƒä¿¡æ¯åŒ…æ‹¬åœ¨ä¸´æ—¶æ–‡ä»¶ä¸­çš„åç§»é‡ã€å‹ç¼©å‰æ•°æ®å¤§å°å’Œå‹ç¼©åæ•°æ®å¤§å°ã€‚å¦‚æœå½“å‰å†…å­˜ç´¢å¼•å¤§å°è¶…è¿‡ 1MBï¼Œåˆ™å°†å†…å­˜ç´¢å¼•å†™åˆ°æ–‡ä»¶output/spillN.out.index ä¸­ã€‚ Combineé˜¶æ®µï¼šå½“æ‰€æœ‰æ•°æ®å¤„ç†å®Œæˆåï¼ŒMapTask å¯¹æ‰€æœ‰ä¸´æ—¶æ–‡ä»¶è¿›è¡Œä¸€æ¬¡åˆå¹¶ï¼Œä»¥ç¡®ä¿æœ€ç»ˆåªä¼šç”Ÿæˆä¸€ä¸ªæ•°æ®æ–‡ä»¶ã€‚ å½“æ‰€æœ‰æ•°æ®å¤„ç†å®Œåï¼ŒMapTask ä¼šå°†æ‰€æœ‰ä¸´æ—¶æ–‡ä»¶åˆå¹¶æˆä¸€ä¸ªå¤§æ–‡ä»¶ï¼Œå¹¶ä¿å­˜åˆ°æ–‡ä»¶ output/file.out ä¸­ï¼ŒåŒæ—¶ç”Ÿæˆç›¸åº”çš„ç´¢å¼•æ–‡ä»¶ output/file.out.indexã€‚ åœ¨è¿›è¡Œæ–‡ä»¶åˆå¹¶è¿‡ç¨‹ä¸­ï¼ŒMapTask ä»¥åˆ†åŒºä¸ºå•ä½è¿›è¡Œåˆå¹¶ã€‚å¯¹äºæŸä¸ªåˆ†åŒºï¼Œå®ƒå°†é‡‡ç”¨å¤šè½®é€’å½’åˆå¹¶çš„æ–¹å¼ã€‚æ¯è½®åˆå¹¶ io.sort.factorï¼ˆé»˜è®¤10ï¼‰ä¸ªæ–‡ä»¶ï¼Œå¹¶å°†äº§ç”Ÿçš„æ–‡ä»¶é‡æ–°åŠ å…¥å¾…åˆå¹¶åˆ—è¡¨ä¸­ï¼Œå¯¹æ–‡ä»¶æ’åºåï¼Œé‡å¤ä»¥ä¸Šè¿‡ç¨‹ï¼Œç›´åˆ°æœ€ç»ˆå¾—åˆ°ä¸€ä¸ªå¤§æ–‡ä»¶ã€‚ è®©æ¯ä¸ªMapTaskæœ€ç»ˆåªç”Ÿæˆä¸€ä¸ªæ•°æ®æ–‡ä»¶ï¼Œå¯é¿å…åŒæ—¶æ‰“å¼€å¤§é‡æ–‡ä»¶å’ŒåŒæ—¶è¯»å–å¤§é‡å°æ–‡ä»¶äº§ç”Ÿçš„éšæœºè¯»å–å¸¦æ¥çš„å¼€é”€ã€‚ ReduceTaskCopy é˜¶æ®µï¼šReduceTask ä»å„ä¸ª MapTask ä¸Šè¿œç¨‹æ‹·è´ä¸€ç‰‡æ•°æ®ï¼Œå¹¶é’ˆå¯¹æŸä¸€ç‰‡æ•°æ®ï¼Œå¦‚æœå…¶å¤§å°è¶…è¿‡ä¸€å®šé˜ˆå€¼ï¼Œåˆ™å†™åˆ°ç£ç›˜ä¸Šï¼Œå¦åˆ™ç›´æ¥æ”¾åˆ°å†…å­˜ä¸­ã€‚ Merge é˜¶æ®µï¼šåœ¨è¿œç¨‹æ‹·è´æ•°æ®çš„åŒæ—¶ï¼ŒReduceTask å¯åŠ¨äº†ä¸¤ä¸ªåå°çº¿ç¨‹å¯¹å†…å­˜å’Œç£ç›˜ä¸Šçš„æ–‡ä»¶è¿›è¡Œåˆå¹¶ï¼Œä»¥é˜²æ­¢å†…å­˜ä½¿ç”¨è¿‡å¤šæˆ–ç£ç›˜ä¸Šæ–‡ä»¶è¿‡å¤šã€‚ Sort é˜¶æ®µï¼šæŒ‰ç…§ MapReduce è¯­ä¹‰ï¼Œç”¨æˆ·ç¼–å†™ reduce() å‡½æ•°è¾“å…¥æ•°æ®æ˜¯æŒ‰ key è¿›è¡Œèšé›†çš„ä¸€ç»„æ•°æ®ã€‚ä¸ºäº†å°† key ç›¸åŒçš„æ•°æ®èšåœ¨ä¸€èµ·ï¼ŒHadoop é‡‡ç”¨äº†åŸºäºæ’åºçš„ç­–ç•¥ã€‚ç”±äºå„ä¸ª MapTask å·²ç»å®ç°å¯¹è‡ªå·±çš„å¤„ç†ç»“æœè¿›è¡Œäº†å±€éƒ¨æ’åºï¼Œå› æ­¤ï¼ŒReduceTask åªéœ€å¯¹æ‰€æœ‰æ•°æ®è¿›è¡Œä¸€æ¬¡å½’å¹¶æ’åºå³å¯ã€‚ Reduce é˜¶æ®µï¼šreduce() å‡½æ•°å°†è®¡ç®—ç»“æœå†™åˆ° HDFSä¸Šã€‚ ReduceTask çš„å¹¶è¡Œåº¦åŒæ ·å½±å“æ•´ä¸ª Job çš„æ‰§è¡Œå¹¶å‘åº¦å’Œæ‰§è¡Œæ•ˆç‡ï¼Œä½†ä¸ MapTask çš„å¹¶å‘æ•°ç”±åˆ‡ç‰‡æ•°å†³å®šä¸åŒï¼ŒReduceTask æ•°é‡çš„å†³å®šæ˜¯å¯ä»¥ç›´æ¥æ‰‹åŠ¨è®¾ç½®ã€‚ 12// é»˜è®¤å€¼æ˜¯ 1ï¼Œæ‰‹åŠ¨è®¾ç½®ä¸º 4job.setNumReduceTasks(4); å·¥ä½œæµç¨‹ Hadoop åºåˆ—åŒ–åºåˆ—åŒ–å°±æ˜¯æŠŠå†…å­˜ä¸­çš„å¯¹è±¡ï¼Œè½¬æ¢æˆå­—èŠ‚åºåˆ—ï¼ˆæˆ–å…¶ä»–æ•°æ®ä¼ è¾“åè®®ï¼‰ä»¥ä¾¿äºå­˜å‚¨åˆ°ç£ç›˜ï¼ˆæŒä¹…åŒ–ï¼‰å’Œç½‘ç»œä¼ è¾“ã€‚ååºåˆ—åŒ–å°±æ˜¯åºåˆ—åŒ–çš„é€†è¿‡ç¨‹ã€‚ Java çš„åºåˆ—åŒ–æ˜¯ä¸€ä¸ªé‡é‡çº§åºåˆ—åŒ–æ¡†æ¶ï¼ˆSerializableï¼‰ï¼Œä¸€ä¸ªå¯¹è±¡è¢«åºåˆ—åŒ–åä¼šé™„å¸¦å¾ˆå¤šé¢å¤–çš„ä¿¡æ¯ï¼ˆå„ç§æ ¡éªŒä¿¡æ¯ã€Headerã€ç»§æ‰¿ä½“ç³»ç­‰ï¼‰ä¸ä¾¿äºåœ¨ç½‘ç»œä¸­é«˜ä¼ è¾“ã€‚ æ‰€ä»¥ Hadoop è‡ªå·±å¼€å‘äº†ä¸€å¥—åºåˆ—åŒ–æœºåˆ¶ï¼ˆWritableï¼‰ã€‚ ç´§å‡‘ï¼šé«˜æ•ˆä½¿ç”¨å­˜å‚¨ç©ºé—´ï¼› å¿«é€Ÿï¼šè¯»å†™æ•°æ®çš„é¢å¤–å¼€é”€å°ï¼› å¯æ‰©å±•ï¼šéšç€é€šä¿¡åè®®çš„å‡çº§è€Œå¯å‡çº§ï¼› äº’æ“ä½œï¼šæ”¯æŒå¤šè¯­è¨€çš„äº¤äº’ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445// è‡ªå®šä¹‰ bean å¯¹è±¡å®ç°åºåˆ—åŒ–æ¥å£// å®ç° writable æ¥å£public class FlowBean implements Writable&#123; private long upFlow; private long downFlow; private long sumFlow; // ååºåˆ—åŒ–æ—¶ï¼Œéœ€è¦åå°„è°ƒç”¨ç©ºå‚æ„é€ å‡½æ•°ï¼Œæ‰€ä»¥å¿…é¡»æœ‰ public FlowBean() &#123; super(); &#125; public FlowBean(long upFlow, long downFlow) &#123; super(); this.upFlow = upFlow; this.downFlow = downFlow; this.sumFlow = upFlow + downFlow; &#125; // å†™åºåˆ—åŒ–æ–¹æ³• @Override public void write(DataOutput out) throws IOException &#123; out.writeLong(upFlow); out.writeLong(downFlow); out.writeLong(sumFlow); &#125; // ååºåˆ—åŒ–æ–¹æ³• // ååºåˆ—åŒ–æ–¹æ³•è¯»é¡ºåºå¿…é¡»å’Œå†™åºåˆ—åŒ–æ–¹æ³•çš„å†™é¡ºåºå¿…é¡»ä¸€è‡´ @Override public void readFields(DataInput in) throws IOException &#123; this.upFlow = in.readLong(); this.downFlow = in.readLong(); this.sumFlow = in.readLong(); &#125; // ç¼–å†™toStringæ–¹æ³•ï¼Œæ–¹ä¾¿åç»­æ‰“å°åˆ°æ–‡æœ¬ @Override public String toString() &#123; return upFlow + \"\\t\" + downFlow + \"\\t\" + sumFlow; &#125; // Getter / Setter&#125; InputFormatMapTask å¹¶è¡Œåº¦å†³å®šæœºåˆ¶ï¼š æ•°æ®å—ï¼šBlock æ˜¯ HDFS ç‰©ç†ä¸ŠæŠŠæ•°æ®åˆ†æˆä¸€å—ä¸€å—ã€‚ æ•°æ®åˆ‡ç‰‡ï¼šæ•°æ®åˆ‡ç‰‡åªæ˜¯åœ¨é€»è¾‘ä¸Šå¯¹è¾“å…¥è¿›è¡Œåˆ†ç‰‡ï¼Œå¹¶ä¸ä¼šåœ¨ç£ç›˜ä¸Šå°†å…¶åˆ‡åˆ†æˆç‰‡è¿›è¡Œå­˜å‚¨ã€‚åˆ‡ç‰‡æ—¶ä¸è€ƒè™‘æ•°æ®é›†æ•´ä½“ï¼Œè€Œæ˜¯é€ä¸ªé’ˆå¯¹æ¯ä¸€ä¸ªæ–‡ä»¶å•ç‹¬åˆ‡ç‰‡ã€‚ Block çš„å¤§å°ï¼šlocal 32 1.x 64 2.x 128 FileInputFormatTextInputFormat æ˜¯é»˜è®¤çš„ FilelnputFormat å®ç°ç±»ã€‚æŒ‰è¡Œè¯»å–æ¯æ¡è®°å½•ã€‚é”®æ˜¯å­˜å‚¨è¯¥è¡Œåœ¨æ•´ä¸ªæ–‡ä»¶ä¸­çš„èµ·å§‹å­—èŠ‚åç§»é‡ï¼ŒLong writableç±»å‹ã€‚å€¼æ˜¯è¿™è¡Œçš„å†…å®¹ï¼Œä¸åŒ…æ‹¬ä»»ä½•è¡Œç»ˆæ­¢ç¬¦ï¼ˆæ¢è¡Œç¬¦å’Œå›è½¦ç¬¦ï¼‰Text ç±»å‹ã€‚ 123456789101112131415161718192021222324252627282930313233343536// æºç  Debug ä¸»è¦æµç¨‹waitForCompletion()submit(); // å»ºç«‹è¿æ¥ connect(); // åˆ›å»ºæäº¤ Job çš„ä»£ç† new Cluster(getConfiguration()); // åˆ¤æ–­æ˜¯ LocalJobRunner è¿˜æ˜¯ YarnRunner initialize(jobTrackAddr, conf); // æäº¤ job submitter.submitJobInternal(Job.this, cluster) // åˆ›å»ºç»™é›†ç¾¤æäº¤æ•°æ®çš„ Stag è·¯å¾„ Path jobStagingArea = JobSubmissionFiles.getStagingDir(cluster, conf); // è·å– jobid ï¼Œå¹¶åˆ›å»º Job è·¯å¾„ JobID jobId = submitClient.getNewJobID(); // æ‹·è´ jar åŒ…åˆ°é›†ç¾¤ copyAndConfigureFiles(job, submitJobDir); rUploader.uploadFiles(job, jobSubmitDir); // è®¡ç®—åˆ‡ç‰‡ï¼Œç”Ÿæˆåˆ‡ç‰‡è§„åˆ’æ–‡ä»¶ writeSplits(job, submitJobDir); maps = writeNewSplits(job, jobSubmitDir); input.getSplits(job); // å‘ Stag è·¯å¾„å†™ XML é…ç½®æ–‡ä»¶ writeConf(conf, submitJobFile); conf.writeXml(out); // æäº¤ Jobï¼Œè¿”å›æäº¤çŠ¶æ€ status = submitClient.submitJob(jobId, submitJobDir.toString(), job.getCredentials()); 12345// è·å–åˆ‡ç‰‡ä¿¡æ¯ API// è·å–åˆ‡ç‰‡æ–‡ä»¶åç§°String name = inputSplit.getPath().getName();// æ ¹æ®æ–‡ä»¶ç±»å‹è·å–åˆ‡ç‰‡ä¿¡æ¯FileSplit inputSpli = (FileSplit)context. getInputSplit() CombineTextæ¡†æ¶é»˜è®¤çš„ TextInputFormat åˆ‡ç‰‡æœºåˆ¶æ˜¯å¯¹ä»»åŠ¡æŒ‰æ–‡ä»¶è§„åˆ’åˆ‡ç‰‡ï¼Œä¸ç®¡æ–‡ä»¶å¤šå°ï¼Œéƒ½ä¼šæ˜¯ä¸€ä¸ªå•ç‹¬çš„åˆ‡ç‰‡ï¼Œéƒ½ä¼šäº¤ç»™ä¸€ä¸ª MapTaskï¼Œè¿™æ ·å¦‚æœæœ‰å¤§é‡å°æ–‡ä»¶ï¼Œå°±ä¼šäº§ç”Ÿå¤§é‡çš„ MapTaskï¼Œå¤„ç†æ•ˆç‡æå…¶ä½ä¸‹ã€‚ CombineTextInputFormat ç”¨äºå°æ–‡ä»¶è¿‡å¤šçš„åœºæ™¯ï¼Œå®ƒå¯ä»¥å°†å¤šä¸ªå°æ–‡ä»¶ä»é€»è¾‘ä¸Šè§„åˆ’åˆ°ä¸€ä¸ªåˆ‡ç‰‡ä¸­ï¼Œè¿™æ ·ï¼Œå¤šä¸ªå°æ–‡ä»¶å°±å¯ä»¥äº¤ç»™ä¸€ä¸ª MapTask å¤„ç†ã€‚ 12345// å¦‚æœä¸è®¾ç½® InputFormatï¼Œå®ƒé»˜è®¤ç”¨çš„æ˜¯ TextInputFormat.classjob.setInputFormatClass(CombineTextInputFormat.class);// è™šæ‹Ÿå­˜å‚¨åˆ‡ç‰‡æœ€å¤§å€¼è®¾ç½®CombineTextInputFormat.setMaxInputSplitSize(job, 4194304); // 4m å°†è¾“å…¥ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶å¤§å°ï¼Œä¾æ¬¡å’Œè®¾ç½®çš„ setMaxInputSplitSize å€¼æ¯”è¾ƒï¼Œå¦‚æœä¸å¤§äºè®¾ç½®çš„æœ€å¤§å€¼ï¼Œé€»è¾‘ä¸Šåˆ’åˆ†ä¸€ä¸ªå—ã€‚å¦‚æœè¾“å…¥æ–‡ä»¶å¤§äºè®¾ç½®çš„æœ€å¤§å€¼ä¸”å¤§äºä¸¤å€ï¼Œé‚£ä¹ˆä»¥æœ€å¤§å€¼åˆ‡å‰²ä¸€å—ï¼›å½“å‰©ä½™æ•°æ®å¤§å°è¶…è¿‡è®¾ç½®çš„æœ€å¤§å€¼ä¸”ä¸å¤§äºæœ€å¤§å€¼ 2 å€ï¼Œæ­¤æ—¶å°†æ–‡ä»¶å‡åˆ†æˆ 2 ä¸ªè™šæ‹Ÿå­˜å‚¨å—ï¼ˆé˜²æ­¢å‡ºç°å¤ªå°åˆ‡ç‰‡ï¼‰ã€‚ KeyValueText KeyValueTextInputFormat æ¯ä¸€è¡Œå‡ä¸ºä¸€æ¡è®°å½•è¢«åˆ†éš”ç¬¦åˆ†å‰²ä¸º K Vã€‚å¯ä»¥é€šè¿‡åœ¨é©±åŠ¨ç±»ä¸­è®¾å®šåˆ†éš”ç¬¦ã€‚é»˜è®¤åˆ†éš”ç¬¦æ˜¯ tabï¼ˆ\\tï¼‰ã€‚ 1conf.set(KeyValueLineRecordReader.KEY_VALUE_SEPERATOR,\"\\t\") 1234567891011121314// éœ€æ±‚ï¼šç»Ÿè®¡è¾“å…¥æ–‡ä»¶ä¸­æ¯ä¸€è¡Œçš„ç¬¬ä¸€ä¸ªå•è¯ç›¸åŒçš„è¡Œæ•°// Mapper ç¼–å†™public class KVTextMapper extends Mapper&lt;Text, Text, Text, LongWritable&gt;&#123; // è®¾ç½® value LongWritable v = new LongWritable(1); @Override protected void map(Text key, Text value, Context context) throws IOException, InterruptedException &#123; // å†™å‡º (ç¬¬ä¸€ä¸ªå•è¯, 1) context.write(key, v); &#125;&#125; 123456789101112131415161718192021public class KVTextReducer extends Reducer&lt;Text, LongWritable, Text, LongWritable&gt;&#123; LongWritable v = new LongWritable(); @Override protected void reduce(Text key, Iterable&lt;LongWritable&gt; values, Context context) throws IOException, InterruptedException &#123; long sum = 0L; // æ±‡æ€»ç»Ÿè®¡ for (LongWritable value : values) &#123; sum += value.get(); &#125; v.set(sum); // è¾“å‡º context.write(key, v); &#125;&#125; 123456789101112131415161718192021222324252627282930313233343536public class KVTextDriver &#123; public static void main(String[] args) throws IOException, ClassNotFoundException, InterruptedException &#123; Configuration conf = new Configuration(); // è®¾ç½®åˆ‡å‰²ç¬¦ conf.set(KeyValueLineRecordReader.KEY_VALUE_SEPERATOR, \" \"); // è·å– job å¯¹è±¡ Job job = Job.getInstance(conf); // è®¾ç½® jar åŒ…ä½ç½®ï¼Œå…³è” mapper å’Œ reducer job.setJarByClass(KVTextDriver.class); job.setMapperClass(KVTextMapper.class); job.setReducerClass(KVTextReducer.class); // è®¾ç½® map è¾“å‡º k v ç±»å‹ job.setMapOutputKeyClass(Text.class); job.setMapOutputValueClass(LongWritable.class); // è®¾ç½®æœ€ç»ˆè¾“å‡º k v ç±»å‹ job.setOutputKeyClass(Text.class); job.setOutputValueClass(LongWritable.class); // è®¾ç½®è¾“å…¥æ•°æ®è·¯å¾„ FileInputFormat.setInputPaths(job, new Path(args[0])); // è®¾ç½®è¾“å…¥æ ¼å¼ job.setInputFormatClass(KeyValueTextInputFormat.class); // è®¾ç½®è¾“å‡ºæ•°æ®è·¯å¾„ FileOutputFormat.setOutputPath(job, new Path(args[1])); // æäº¤ job job.waitForCompletion(true); &#125;&#125; NLine NLineInputFormat ä»£è¡¨æ¯ä¸ª map è¿›ç¨‹å¤„ç†çš„ InputSplit ä¸å†æŒ‰ Blockå—å»åˆ’åˆ†,è€Œæ˜¯æŒ‰ NLineInputFormat æŒ‡å®šçš„è¡Œæ•°æ¥åˆ’åˆ†ã€‚å³è¾“å…¥æ–‡ä»¶çš„æ€»è¡Œæ•° N = åˆ‡ç‰‡æ•°ï¼Œå¦‚æœä¸æ•´é™¤åˆ™åˆ‡ç‰‡æ•° = å•† + 1ã€‚ 1234567// å¯¹æ¯ä¸ªå•è¯è¿›è¡Œä¸ªæ•°ç»Ÿè®¡,è¦æ±‚æ ¹æ®æ¯ä¸ªè¾“å…¥æ–‡ä»¶çš„è¡Œæ•°æ¥è§„å®šè¾“å‡ºå¤šå°‘ä¸ªåˆ‡ç‰‡ã€‚æ­¤æ¡ˆä¾‹è¦æ±‚æ¯ä¸‰è¡Œæ”¾å…¥ä¸€ä¸ªåˆ‡ç‰‡ä¸­// è®¾ç½®æ¯ä¸ªåˆ‡ç‰‡ InputSplit ä¸­åˆ’åˆ†ä¸‰æ¡è®°å½•NLineInputFormat.setNumLinesPerSplit(job, 3);// ä½¿ç”¨ NLineInputFormat å¤„ç†è®°å½•æ•° job.setInputFormatClass(NLineInputFormat.class); è‡ªå®šä¹‰ æ— è®º HDFS è¿˜æ˜¯ MapReduceï¼Œåœ¨å¤„ç†å°æ–‡ä»¶æ—¶æ•ˆç‡éƒ½éå¸¸ä½ï¼Œä½†åˆéš¾å…é¢ä¸´å¤„ç†å¤§é‡å°æ–‡ä»¶çš„åœºæ™¯ï¼Œæ­¤æ—¶ï¼Œå°±éœ€è¦æœ‰ç›¸åº”è§£å†³æ–¹æ¡ˆã€‚å¯ä»¥è‡ªå®šä¹‰ InputFormat å®ç°å°æ–‡ä»¶çš„åˆå¹¶ã€‚ 123456789101112131415161718192021222324252627/** * å°†å¤šä¸ªå°æ–‡ä»¶åˆå¹¶æˆä¸€ä¸ª SequenceFile æ–‡ä»¶ * SequenceFile æ–‡ä»¶æ˜¯ Hadoop ç”¨æ¥å­˜å‚¨äºŒè¿›åˆ¶å½¢å¼çš„ key-value å¯¹çš„æ–‡ä»¶æ ¼å¼ * SequenceFile é‡Œé¢å­˜å‚¨ç€å¤šä¸ªæ–‡ä»¶ï¼Œå­˜å‚¨çš„å½¢å¼ä¸ºï¼ˆæ–‡ä»¶è·¯å¾„ + åç§°ï¼‰keyï¼Œæ–‡ä»¶å†…å®¹ value*/// è‡ªå®šä¹‰ InputFormat// å®šä¹‰ç±»ç»§æ‰¿ FileInputFormatpublic class WholeFileInputformat extends FileInputFormat&lt;Text, BytesWritable&gt;&#123; // å®šä¹‰æ˜¯å¦å¯åˆ‡å‰²ï¼Œæ­¤ç¨‹åºä¸å¯åˆ‡ç‰‡ï¼Œæœ€ç»ˆæŠŠæ‰€æœ‰æ–‡ä»¶å°è£…åˆ°äº† value ä¸­ @Override protected boolean isSplitable(JobContext context, Path filename) &#123; return false; &#125; // å®ç°ä¸€æ¬¡è¯»å–ä¸€ä¸ªå®Œæ•´æ–‡ä»¶å°è£…ä¸º K V @Override public RecordReader&lt;Text, BytesWritable&gt; createRecordReader( InputSplit split, TaskAttemptContext context) throws IOException, InterruptedException &#123; WholeRecordReader recordReader = new WholeRecordReader(); recordReader.initialize(split, context); return recordReader; &#125;&#125; 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182// è‡ªå®šä¹‰ RecordReader ç±»public class WholeRecordReader extends RecordReader&lt;Text, BytesWritable&gt;&#123; private Configuration configuration; private FileSplit split; private boolean isProgress = true; private BytesWritable value = new BytesWritable(); private Text k = new Text(); @Override public void initialize(InputSplit split, TaskAttemptContext context) throws IOException, InterruptedException &#123; // åˆå§‹åŒ–æ•°æ®ä»¥åŠé…ç½® this.split = (FileSplit)split; configuration = context.getConfiguration(); &#125; // æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œå³æ‹¼æ¥è‡ªå®šä¹‰çš„ K @Override public boolean nextKeyValue() throws IOException, InterruptedException &#123; if (isProgress) &#123; // å®šä¹‰ç¼“å­˜åŒºï¼Œè·å–åˆ‡ç‰‡é•¿åº¦ byte[] contents = new byte[(int)split.getLength()]; FileSystem fs = null; FSDataInputStream fis = null; try &#123; // è·å–æ–‡ä»¶ç³»ç»Ÿï¼Œé€šè¿‡è·¯å¾„è·å–æ–‡ä»¶ç³»ç»Ÿï¼Œä¸€æ³¢åå‘æ“ä½œ Path path = split.getPath(); fs = path.getFileSystem(configuration); // è¯»å–æ•°æ® fis = fs.open(path); // è¯»å–æ–‡ä»¶å†…å®¹ IOUtils.readFully(fis, contents, 0, contents.length); // è¾“å‡ºæ–‡ä»¶å†…å®¹ value.set(contents, 0, contents.length); // è·å–æ–‡ä»¶è·¯å¾„åŠåç§° String name = split.getPath().toString(); // è®¾ç½®è¾“å‡ºçš„ key å€¼ k.set(name); &#125; catch (Exception e) &#123; &#125;finally &#123; IOUtils.closeStream(fis); &#125; // æœ¬åˆ‡ç‰‡å·²å¤„ç†å®Œï¼Œæ¸…æ ‡è®°ä½ isProgress = false; // è¿›è¡Œå…¶å®ƒåˆ‡ç‰‡çš„å¤„ç† return true; &#125; return false; &#125; @Override public Text getCurrentKey() throws IOException, InterruptedException &#123; return k; &#125; @Override public BytesWritable getCurrentValue() throws IOException, InterruptedException &#123; return value; &#125; @Override public float getProgress() throws IOException, InterruptedException &#123; return 0; &#125; @Override public void close() throws IOException &#123; &#125;&#125; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263// ç¼–å†™ SequenceFileMapper ç±»å¤„ç†æµç¨‹public class SequenceFileMapper extends Mapper&lt;Text, BytesWritable, Text, BytesWritable&gt;&#123; @Override protected void map(Text key, BytesWritable value, Context context) throws IOException, InterruptedException &#123; context.write(key, value); &#125;&#125;// ç¼–å†™ SequenceFileReducer ç±»å¤„ç†æµç¨‹public class SequenceFileReducer extends Reducer&lt;Text, BytesWritable, Text, BytesWritable&gt; &#123; @Override protected void reduce(Text key, Iterable&lt;BytesWritable&gt; values, Context context) throws IOException, InterruptedException &#123; context.write(key, values.iterator().next()); &#125;&#125;// ç¼–å†™SequenceFileDriverç±»å¤„ç†æµç¨‹public class SequenceFileDriver &#123; public static void main(String[] args) throws IOException, ClassNotFoundException, InterruptedException &#123; // è¾“å…¥è¾“å‡ºè·¯å¾„éœ€è¦æ ¹æ®è‡ªå·±ç”µè„‘ä¸Šå®é™…çš„è¾“å…¥è¾“å‡ºè·¯å¾„è®¾ç½® args = new String[] &#123; \"e:/input/inputinputformat\", \"e:/output1\" &#125;; // è·å– job å¯¹è±¡ Configuration conf = new Configuration(); Job job = Job.getInstance(conf); // è®¾ç½® jar åŒ…å­˜å‚¨ä½ç½®ã€å…³è”è‡ªå®šä¹‰çš„ mapper å’Œ reducer job.setJarByClass(SequenceFileDriver.class); job.setMapperClass(SequenceFileMapper.class); job.setReducerClass(SequenceFileReducer.class); // è®¾ç½®è¾“å…¥çš„ inputFormat job.setInputFormatClass(WholeFileInputformat.class); // è®¾ç½®è¾“å‡ºçš„ outputFormat job.setOutputFormatClass(SequenceFileOutputFormat.class); // è®¾ç½® map è¾“å‡ºç«¯çš„ K V ç±»å‹ job.setMapOutputKeyClass(Text.class); job.setMapOutputValueClass(BytesWritable.class); // è®¾ç½®æœ€ç»ˆè¾“å‡ºç«¯çš„ K V ç±»å‹ job.setOutputKeyClass(Text.class); job.setOutputValueClass(BytesWritable.class); // è®¾ç½®è¾“å…¥è¾“å‡ºè·¯å¾„ FileInputFormat.setInputPaths(job, new Path(args[0])); FileOutputFormat.setOutputPath(job, new Path(args[1])); // æäº¤ job boolean result = job.waitForCompletion(true); System.exit(result ? 0 : 1); &#125;&#125; OutputFormaté»˜è®¤çš„è¾“å‡ºæ ¼å¼æ˜¯ TextOutputFormat ï¼Œå®ƒæŠŠæ¯æ¡è®°å½•å†™ä¸ºæ–‡æœ¬è¡Œï¼Œå®ƒçš„é”®å’Œå€¼å¯ä»¥æ˜¯ä»»æ„ç±»å‹ï¼Œå› ä¸º TextOutputFormatè°ƒç”¨ toString() æ–¹æ³•æŠŠå®ƒä»¬è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚ å°† SequenceFileOutputFormat è¾“å‡ºä½œä¸ºåç»­ MapReduce ä»»åŠ¡çš„è¾“å…¥ï¼Œå› ä¸ºå…¶æ ¼å¼ç´§å‡‘ï¼Œå¾ˆå®¹æ˜“è¢«å‹ç¼©ã€‚ è‡ªå®šä¹‰ ä¸ºäº†å®ç°æ§åˆ¶æœ€ç»ˆæ–‡ä»¶çš„è¾“å²€è·¯å¾„å’Œè¾“å‡ºæ ¼å¼ï¼Œå¯è¿›è¡Œè‡ªå®šä¹‰ã€‚ è‡ªå®šä¹‰ä¸€ä¸ªç±»ç»§æ‰¿ FileOutputFormatï¼›æ”¹å†™ RecordWriterï¼Œå…·ä½“æ”¹å†™è¾“å‡ºæ•°æ®çš„æ–¹æ³• write()ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162// ç»§æ‰¿ FileOutputFormatpublic class FilterOutputFormat extends FileOutputFormat&lt;Text, NullWritable&gt;&#123; @Override public RecordWriter&lt;Text, NullWritable&gt; getRecordWriter(TaskAttemptContext job) throws IOException, InterruptedException &#123; // åˆ›å»ºä¸€ä¸ªRecordWriter return new FilterRecordWriter(job); &#125;&#125;// é‡å†™ write()public class FilterRecordWriter extends RecordWriter&lt;Text, NullWritable&gt; &#123; FSDataOutputStream wingoOut = null; FSDataOutputStream otherOut = null; public FilterRecordWriter(TaskAttemptContext job) &#123; FileSystem fs; try &#123; // è·å–æ–‡ä»¶ç³»ç»Ÿ fs = FileSystem.get(job.getConfiguration()); // åˆ›å»ºè¾“å‡ºæ–‡ä»¶è·¯å¾„ Path wingoPath = new Path(\"e:/wingo.log\"); Path otherPath = new Path(\"e:/other.log\"); // åˆ›å»ºè¾“å‡ºæµ atguiguOut = fs.create(wingoPath); otherOut = fs.create(otherPath); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; @Override public void write(Text key, NullWritable value) throws IOException, InterruptedException &#123; // åˆ¤æ–­æ˜¯å¦åŒ…å« wingo è¾“å‡ºåˆ°ä¸åŒæ–‡ä»¶ if (key.toString().contains(\"wingo\")) &#123; wingoOut.write(key.toString().getBytes()); &#125; else &#123; otherOut.write(key.toString().getBytes()); &#125; &#125; @Override public void close(TaskAttemptContext context) throws IOException, InterruptedException &#123; // å…³é—­èµ„æº IOUtils.closeStream(wingoOut); IOUtils.closeStream(otherOut); &#125;&#125;// å°†è‡ªå®šä¹‰çš„è¾“å‡ºæ ¼å¼ç»„ä»¶è®¾ç½®åˆ° job ä¸­job.setOutputFormatClass(FilterOutputFormat.class);// è™½ç„¶æˆ‘ä»¬è‡ªå®šä¹‰äº† outputformatï¼Œä½†æ˜¯å› ä¸ºæˆ‘ä»¬çš„ outputformat ç»§æ‰¿è‡ª fileoutputformat// è€Œ fileoutputformat è¦è¾“å‡ºä¸€ä¸ª _SUCCESS æ–‡ä»¶ï¼Œæ‰€ä»¥ï¼Œåœ¨è¿™è¿˜å¾—æŒ‡å®šä¸€ä¸ªè¾“å‡ºç›®å½• Reduce Join order(1001 01 1) join pd(01 å°ç±³) ğŸ‘‰ result(001 å°ç±³ 1) Bean1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950// åˆå¹¶åçš„ Bean ç±»public class TableBean implements Writable &#123; private String order_id; // è®¢å• id private String p_id; // äº§å“ id private int amount; // äº§å“æ•°é‡ private String pname; // äº§å“åç§° private String flag; // è¡¨çš„æ ‡è®° public TableBean() &#123; super(); &#125; public TableBean(String order_id, String p_id, int amount, String pname, String flag) &#123; super(); this.order_id = order_id; this.p_id = p_id; this.amount = amount; this.pname = pname; this.flag = flag; &#125; // Getter / Setter @Override public void write(DataOutput out) throws IOException &#123; out.writeUTF(order_id); out.writeUTF(p_id); out.writeInt(amount); out.writeUTF(pname); out.writeUTF(flag); &#125; @Override public void readFields(DataInput in) throws IOException &#123; this.order_id = in.readUTF(); this.p_id = in.readUTF(); this.amount = in.readInt(); this.pname = in.readUTF(); this.flag = in.readUTF(); &#125; @Override public String toString() &#123; return order_id + \"\\t\" + pname + \"\\t\" + amount + \"\\t\" ; &#125;&#125; Mapper12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849public class TableMapper extends Mapper&lt;LongWritable, Text, Text, TableBean&gt;&#123; String name; TableBean bean = new TableBean(); Text k = new Text(); @Override protected void setup(Context context) throws IOException, InterruptedException &#123; // è·å–è¾“å…¥æ–‡ä»¶åˆ‡ç‰‡ FileSplit split = (FileSplit) context.getInputSplit(); // è·å–è¾“å…¥æ–‡ä»¶åç§° name = split.getPath().getName(); &#125; @Override protected void map(LongWritable key, Text value, Context context) throws IOException, InterruptedException &#123; // è·å–è¾“å…¥æ•°æ® String line = value.toString(); // ä¸åŒæ–‡ä»¶åˆ†åˆ«å¤„ç† if (name.startsWith(\"order\")) &#123;// è®¢å•è¡¨å¤„ç† // åˆ‡å‰² String[] fields = line.split(\"\\t\"); // å°è£…beanå¯¹è±¡ bean.setOrder_id(fields[0]); bean.setP_id(fields[1]); bean.setAmount(Integer.parseInt(fields[2])); bean.setPname(\"\"); bean.setFlag(\"order\"); k.set(fields[1]); &#125;else &#123; // äº§å“è¡¨å¤„ç† // åˆ‡å‰² String[] fields = line.split(\"\\t\"); // å°è£…beanå¯¹è±¡ bean.setP_id(fields[0]); bean.setPname(fields[1]); bean.setFlag(\"pd\"); bean.setAmount(0); bean.setOrder_id(\"\"); k.set(fields[0]); &#125; // å†™å‡º context.write(k, bean); &#125;&#125; Reduce å¤„ç†å‹åŠ›å¤§ï¼Œå¹¶ä¸”ææ˜“äº§ç”Ÿæ•°æ®å€¾æ–œã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940public class TableReducer extends Reducer&lt;Text, TableBean, TableBean, NullWritable&gt; &#123; @Override protected void reduce(Text key, Iterable&lt;TableBean&gt; values, Context context) throws IOException, InterruptedException &#123; // å‡†å¤‡å­˜å‚¨è®¢å•çš„é›†åˆ ArrayList&lt;TableBean&gt; orderBeans = new ArrayList&lt;&gt;(); // å‡†å¤‡ bean å¯¹è±¡ TableBean pdBean = new TableBean(); // ä¾¿åˆ© key = 1 çš„é›†åˆ for (TableBean bean : values) &#123; if (\"order\".equals(bean.getFlag())) &#123; // è®¢å•è¡¨ // æ‹·è´ä¼ é€’è¿‡æ¥çš„æ¯æ¡è®¢å•æ•°æ®åˆ°é›†åˆä¸­ TableBean orderBean = new TableBean(); try &#123; BeanUtils.copyProperties(orderBean, bean); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; orderBeans.add(orderBean); &#125; else &#123; // äº§å“è¡¨ try &#123; // æ­¤å¤„å·²åœ¨ Map åšå¥½æŒ‰ p_id æ’åºå·¥ä½œï¼Œæœ€åä¸€å®šæ˜¯ä¸€ä¸ª pd è¡¨ä¿¡æ¯ // æ‹·è´ä¼ é€’è¿‡æ¥çš„äº§å“è¡¨åˆ°å†…å­˜ä¸­ BeanUtils.copyProperties(pdBean, bean); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125; &#125; // è¡¨çš„æ‹¼æ¥ for(TableBean bean : orderBeans)&#123; bean.setPname (pdBean.getPname()); // æ•°æ®å†™å‡ºå» context.write(bean, NullWritable.get()); &#125; &#125;&#125; Driver1234567891011121314151617181920212223242526272829303132333435public class TableDriver &#123; public static void main(String[] args) throws Exception &#123; // è·¯å¾„ args = new String[]&#123;\"e:/input/inputtable\",\"e:/output1\"&#125;; // è·å–é…ç½®ä¿¡æ¯ï¼Œæˆ–è€… job å¯¹è±¡å®ä¾‹ Configuration configuration = new Configuration(); Job job = Job.getInstance(configuration); // æŒ‡å®šæœ¬ç¨‹åºçš„ jar åŒ…æ‰€åœ¨çš„æœ¬åœ°è·¯å¾„ job.setJarByClass(TableDriver.class); // æŒ‡å®šæœ¬ä¸šåŠ¡ job è¦ä½¿ç”¨çš„ Mapper / Reducer ä¸šåŠ¡ç±» job.setMapperClass(TableMapper.class); job.setReducerClass(TableReducer.class); // æŒ‡å®š Mapper è¾“å‡ºæ•°æ®çš„ k v ç±»å‹ job.setMapOutputKeyClass(Text.class); job.setMapOutputValueClass(TableBean.class); // æŒ‡å®šæœ€ç»ˆè¾“å‡ºçš„æ•°æ®çš„ k v ç±»å‹ job.setOutputKeyClass(TableBean.class); job.setOutputValueClass(NullWritable.class); // æŒ‡å®š job çš„è¾“å…¥åŸå§‹æ–‡ä»¶æ‰€åœ¨ç›®å½• FileInputFormat.setInputPaths(job, new Path(args[0])); FileOutputFormat.setOutputPath(job, new Path(args[1])); // å°† job ä¸­é…ç½®çš„ç›¸å…³å‚æ•°ï¼Œä»¥åŠ job æ‰€ç”¨çš„ java ç±»æ‰€åœ¨çš„ jar åŒ…ï¼Œ æäº¤ç»™ yarn å»è¿è¡Œ boolean result = job.waitForCompletion(true); System.exit(result ? 0 : 1); &#125;&#125; Map Join é€‚ç”¨äºä¸€å¼ è¡¨ååˆ†å°ã€ä¸€å¼ è¡¨å¾ˆå¤§çš„åœºæ™¯ã€‚ é‡‡ç”¨ Distributed cacheï¼šåœ¨ Mapper çš„ setup é˜¶æ®µï¼Œå°†æ–‡ä»¶è¯»å–åˆ°ç¼“å­˜é›†åˆä¸­ã€‚ job.addCacheFile(new URI(â€œfile://e:/cache/pd.txtâ€)); Driver æ·»åŠ ç¼“å­˜æ–‡ä»¶ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041public class TableDriver &#123; public static void main(String[] args) throws Exception &#123; // è·¯å¾„ args = new String[]&#123;\"e:/input/inputtable\",\"e:/output1\"&#125;; // è·å–é…ç½®ä¿¡æ¯ï¼Œæˆ–è€… job å¯¹è±¡å®ä¾‹ Configuration configuration = new Configuration(); Job job = Job.getInstance(configuration); // æŒ‡å®šæœ¬ç¨‹åºçš„ jar åŒ…æ‰€åœ¨çš„æœ¬åœ°è·¯å¾„ job.setJarByClass(TableDriver.class); // æŒ‡å®šæœ¬ä¸šåŠ¡ job è¦ä½¿ç”¨çš„ Mapper / Reducer ä¸šåŠ¡ç±» job.setMapperClass(TableMapper.class); job.setReducerClass(TableReducer.class); // æŒ‡å®š Mapper è¾“å‡ºæ•°æ®çš„ k v ç±»å‹ job.setMapOutputKeyClass(Text.class); job.setMapOutputValueClass(TableBean.class); // æŒ‡å®šæœ€ç»ˆè¾“å‡ºçš„æ•°æ®çš„ k v ç±»å‹ job.setOutputKeyClass(TableBean.class); job.setOutputValueClass(NullWritable.class); // æŒ‡å®š job çš„è¾“å…¥åŸå§‹æ–‡ä»¶æ‰€åœ¨ç›®å½• FileInputFormat.setInputPaths(job, new Path(args[0])); FileOutputFormat.setOutputPath(job, new Path(args[1])); // åŠ è½½ç¼“å­˜æ•°æ® job.addCacheFile(new URI(\"file:///e:/input/inputcache/pd.txt\")); // Map ç«¯ Join çš„é€»è¾‘ä¸éœ€è¦ Reduce é˜¶æ®µï¼Œè®¾ç½® reduceTask æ•°é‡ä¸º 0 job.setNumReduceTasks(0); // å°† job ä¸­é…ç½®çš„ç›¸å…³å‚æ•°ï¼Œä»¥åŠ job æ‰€ç”¨çš„ java ç±»æ‰€åœ¨çš„ jar åŒ…ï¼Œ æäº¤ç»™ yarn å»è¿è¡Œ boolean result = job.waitForCompletion(true); System.exit(result ? 0 : 1); &#125;&#125; Map1234567891011121314151617181920212223242526272829303132333435363738394041424344public class DistributedCacheMapper extends Mapper&lt;LongWritable, Text, Text, NullWritable&gt;&#123; Map&lt;String, String&gt; pdMap = new HashMap&lt;&gt;(); Text k = new Text(); @Override protected void setup(Mapper&lt;LongWritable, Text, Text, NullWritable&gt;.Context context) throws IOException, InterruptedException &#123; // è·å–ç¼“å­˜çš„æ–‡ä»¶ URI[] cacheFiles = context.getCacheFiles(); String path = cacheFiles[0].getPath().toString(); BufferedReader reader = new BufferedReader (new InputStreamReader(new FileInputStream(path), \"UTF-8\")); String line; while(StringUtils.isNotEmpty(line = reader.readLine()))&#123; // åˆ‡å‰² String[] fields = line.split(\"\\t\"); // ç¼“å­˜æ•°æ®åˆ°é›†åˆ (01 å°ç±³) pdMap.put(fields[0], fields[1]); &#125; // å…³æµ reader.close(); &#125; @Override protected void map(LongWritable key, Text value, Context context) throws IOException, InterruptedException &#123; // è·å–ä¸€è¡Œ String line = value.toString(); // æˆªå– String[] fields = line.split(\"\\t\"); // è·å–äº§å“ id String pId = fields[1]; // è·å–å•†å“åç§° String pdName = pdMap.get(pId); // æ‹¼æ¥ k.set(line + \"\\t\"+ pdName); // å†™å‡º context.write(k, NullWritable.get()); &#125;&#125; æ•°æ®æ¸…æ´— ETL Hadoop ä¸ºæ¯ä¸ªä½œä¸šç»´æŠ¤è‹¥å¹²å†…ç½®è®¡æ•°å™¨ï¼Œä»¥æè¿°å¤šé¡¹æŒ‡æ ‡ã€‚ä¾‹å¦‚ï¼ŒæŸäº›è®¡æ•°å™¨è®°å½•å·²å¤„ç†çš„å­—èŠ‚æ•°å’Œè®°å½•æ•°ï¼Œä½¿ç”¨æˆ·å¯ç›‘æ§å·²å¤„ç†çš„è¾“å…¥æ•°æ®é‡å’Œå·²äº§ç”Ÿçš„è¾“å‡ºæ•°æ®é‡ã€‚ Map12345678910111213141516171819202122232425262728293031323334353637383940414243public class LogMapper extends Mapper&lt;LongWritable, Text, Text, NullWritable&gt;&#123; Text k = new Text(); @Override protected void map(LongWritable key, Text value, Context context) throws IOException, InterruptedException &#123; // è·å– 1 è¡Œæ•°æ® String line = value.toString(); // è§£ææ—¥å¿—ï¼Œå³æ­¤æ¡æ—¥å¿—æ˜¯å¦æœ‰æ„ä¹‰ boolean result = parseLog(line,context); // æ—¥å¿—ä¸åˆæ³•é€€å‡º if (!result) &#123; return; &#125; // è®¾ç½® key k.set(line); // å†™å‡ºæ•°æ® context.write(k, NullWritable.get()); &#125; // è§£ææ—¥å¿— private boolean parseLog(String line, Context context) &#123; // æˆªå– String[] fields = line.split(\" \"); // æ—¥å¿—é•¿åº¦å¤§äº 11 çš„ä¸ºåˆæ³• if (fields.length &gt; 11) &#123; // ç³»ç»Ÿè®¡æ•°å™¨ï¼Œè®°å½•ä¸€æ¡åˆæ³•çš„æ—¥å¿— context.getCounter(\"map\", \"true\").increment(1); return true; &#125;else &#123; // è®°å½•ä¸€æ¡ä¸åˆæ³•çš„æ—¥å¿— context.getCounter(\"map\", \"false\").increment(1); return false; &#125; &#125;&#125; Driver1234567891011121314151617181920212223242526272829303132333435363738394041public class TableDriver &#123; public static void main(String[] args) throws Exception &#123; // è·¯å¾„ args = new String[]&#123;\"e:/input/inputlog\", \"e:/output1\"&#125;; // è·å–é…ç½®ä¿¡æ¯ï¼Œæˆ–è€… job å¯¹è±¡å®ä¾‹ Configuration configuration = new Configuration(); Job job = Job.getInstance(configuration); // æŒ‡å®šæœ¬ç¨‹åºçš„ jar åŒ…æ‰€åœ¨çš„æœ¬åœ°è·¯å¾„ job.setJarByClass(TableDriver.class); // æŒ‡å®šæœ¬ä¸šåŠ¡ job è¦ä½¿ç”¨çš„ Mapper / Reducer ä¸šåŠ¡ç±» job.setMapperClass(TableMapper.class); job.setReducerClass(TableReducer.class); // æŒ‡å®š Mapper è¾“å‡ºæ•°æ®çš„ k v ç±»å‹ job.setMapOutputKeyClass(Text.class); job.setMapOutputValueClass(TableBean.class); // æŒ‡å®šæœ€ç»ˆè¾“å‡ºçš„æ•°æ®çš„ k v ç±»å‹ job.setOutputKeyClass(TableBean.class); job.setOutputValueClass(NullWritable.class); // æŒ‡å®š job çš„è¾“å…¥åŸå§‹æ–‡ä»¶æ‰€åœ¨ç›®å½• FileInputFormat.setInputPaths(job, new Path(args[0])); FileOutputFormat.setOutputPath(job, new Path(args[1])); // åŠ è½½ç¼“å­˜æ•°æ® job.addCacheFile(new URI(\"file:///e:/input/inputcache/pd.txt\")); // Map ç«¯ Join çš„é€»è¾‘ä¸éœ€è¦ Reduce é˜¶æ®µï¼Œè®¾ç½® reduceTask æ•°é‡ä¸º 0 job.setNumReduceTasks(0); // å°† job ä¸­é…ç½®çš„ç›¸å…³å‚æ•°ï¼Œä»¥åŠ job æ‰€ç”¨çš„ java ç±»æ‰€åœ¨çš„ jar åŒ…ï¼Œ æäº¤ç»™ yarn å»è¿è¡Œ boolean result = job.waitForCompletion(true); System.exit(result ? 0 : 1); &#125;&#125; æ•°æ®å‹ç¼© é€‚å½“å‹ç¼©æ˜¯æé«˜ Hadoop è¿è¡Œæ•ˆç‡çš„ä¸€ç§ä¼˜åŒ–ç­–ç•¥ã€‚ å‹ç¼©æ ¼å¼ hadoopè‡ªå¸¦ï¼Ÿ ç®—æ³• æ–‡ä»¶æ‰©å±•å æ˜¯å¦å¯åˆ‡åˆ† æ¢æˆå‹ç¼©æ ¼å¼åï¼ŒåŸæ¥çš„ç¨‹åºæ˜¯å¦éœ€è¦ä¿®æ”¹ DEFLATE æ˜¯ï¼Œç›´æ¥ä½¿ç”¨ DEFLATE .deflate å¦ å’Œæ–‡æœ¬å¤„ç†ä¸€æ ·ï¼Œä¸éœ€è¦ä¿®æ”¹ Gzip æ˜¯ï¼Œç›´æ¥ä½¿ç”¨ DEFLATE .gz å¦ å’Œæ–‡æœ¬å¤„ç†ä¸€æ ·ï¼Œä¸éœ€è¦ä¿®æ”¹ bzip2 æ˜¯ï¼Œç›´æ¥ä½¿ç”¨ bzip2 .bz2 æ˜¯ å’Œæ–‡æœ¬å¤„ç†ä¸€æ ·ï¼Œä¸éœ€è¦ä¿®æ”¹ LZO å¦ï¼Œéœ€è¦å®‰è£… LZO .lzo æ˜¯ éœ€è¦å»ºç´¢å¼•ï¼Œè¿˜éœ€è¦æŒ‡å®šè¾“å…¥æ ¼å¼ Snappy å¦ï¼Œéœ€è¦å®‰è£… Snappy .snappy å¦ å’Œæ–‡æœ¬å¤„ç†ä¸€æ ·ï¼Œä¸éœ€è¦ä¿®æ”¹ ä¸ºäº†æ”¯æŒå¤šç§å‹ç¼© / è§£å‹ç¼©ç®—æ³•ï¼ŒHadoop å¼•å…¥äº†ç¼–ç  / è§£ç å™¨ å‹ç¼©æ ¼å¼ å¯¹åº”çš„ç¼–ç /è§£ç å™¨ DEFLATE org.apache.hadoop.io.compress.DefaultCodec gzip org.apache.hadoop.io.compress.GzipCodec bzip2 org.apache.hadoop.io.compress.BZip2Codec LZO com.hadoop.compression.lzo.LzopCodec Snappy org.apache.hadoop.io.compress.SnappyCodec å¯åŠ¨å‹ç¼©åŠŸèƒ½çš„å‚æ•°é…ç½®ã€‚ å‚æ•° é˜¶æ®µ å»ºè®® io.compression.codecs è¾“å…¥å‹ç¼© æ–‡ä»¶æ‰©å±•ååˆ¤æ–­æ˜¯å¦æ”¯æŒæŸç§ç¼–è§£ç å™¨ mapreduce.map.output.compress mapper è¾“å‡º è¿™ä¸ªå‚æ•°è®¾ä¸º true å¯ç”¨å‹ç¼© mapreduce.map.output.compress.codec mapper è¾“å‡º ä¼ä¸šå¤šä½¿ç”¨ LZO æˆ– Snappy ç¼–è§£ç å™¨åœ¨æ­¤é˜¶æ®µå‹ç¼©æ•°æ® mapreduce.output.fileoutputformat.compress reducer è¾“å‡º è¿™ä¸ªå‚æ•°è®¾ä¸º true å¯ç”¨å‹ç¼© mapreduce.output.fileoutputformat.compress.codec reducer è¾“å‡º ä½¿ç”¨æ ‡å‡†å·¥å…·æˆ–è€…ç¼–è§£ç å™¨ï¼Œå¦‚ gzip å’Œ bzip2 mapreduce.output.fileoutputformat.compress.type reducer è¾“å‡º SequenceFile å‹ç¼©ç±»å‹ï¼š NONE å’Œ BLOCK Driver å®šä¹‰å‹ç¼©123456789101112131415161718192021// Map è¾“å‡ºç«¯é‡‡ç”¨å‹ç¼©public class WordCountDriver &#123; public static void main(String[] args) throws IOException, ClassNotFoundException, InterruptedException &#123; Configuration configuration = new Configuration(); // å¼€å¯ map ç«¯è¾“å‡ºå‹ç¼© configuration.setBoolean(\"mapreduce.map.output.compress\", true); // è®¾ç½® map ç«¯è¾“å‡ºå‹ç¼©æ–¹å¼ configuration.setClass(\"mapreduce.map.output.compress.codec\", BZip2Codec.class, CompressionCodec.class); // ... &#125;&#125;// Reduce è¾“å‡ºç«¯é‡‡ç”¨å‹ç¼©// è®¾ç½®reduceç«¯è¾“å‡ºå‹ç¼©å¼€å¯FileOutputFormat.setCompressOutput(job, true);// è®¾ç½®å‹ç¼©çš„æ–¹å¼FileOutputFormat.setOutputCompressorClass(job, BZip2Codec.class); YARN èµ„æºè°ƒåº¦å™¨ Hadoop ä½œä¸šè°ƒåº¦å™¨ä¸»è¦æœ‰ä¸‰ç§ï¼š FIFO å…ˆåˆ°å…ˆæœåŠ¡ã€Capacity Scheduler å’Œ Fair Scheduleã€‚ 1234567&lt;!-- yarn-default.xml --&gt;&lt;property&gt; &lt;description&gt;The class to use as the resource scheduler.&lt;/description&gt; &lt;name&gt;yarn.resourcemanager.scheduler.class&lt;/name&gt; &lt;value&gt;org.apache.hadoop.yarn.server.resourcemanager.scheduler.capacity.CapacityScheduler&lt;/value&gt;&lt;/property&gt; Capacity Schedulerï¼Œå®¹é‡è°ƒåº¦å™¨ã€‚ æ”¯æŒå¤šé˜Ÿåˆ—ï¼Œæ¯ä¸ªé˜Ÿåˆ—é…ç½®ä¸€å®šçš„èµ„æºé‡ï¼Œæ¯ä¸ªé˜Ÿåˆ—é‡‡ç”¨ FIFO è°ƒåº¦ç­–ç•¥ï¼›ä¸ºé˜²æ­¢åŒä¸€ç”¨æˆ·çš„ä½œä¸šç‹¬å é˜Ÿåˆ—ä¸­çš„èµ„æºï¼Œè¯¥è°ƒåº¦å™¨ä¼šå¯¹åŒä¸€ç”¨æˆ·æäº¤çš„ä½œä¸šæ‰€å èµ„æºé‡è¿›è¡Œé™å®šï¼›è¿è¡Œä»»åŠ¡æ•° / è®¡ç®—èµ„æº ğŸ‘‰ ç‹æœ€é—²çš„é˜Ÿåˆ—é‡Œäº¤ä»»åŠ¡ã€‚ Fair Schedulerï¼Œå…¬å¹³è°ƒåº¦å™¨ã€‚ æ”¯æŒå¤šé˜Ÿåˆ—å¤šç”¨æˆ·ï¼Œæ¯ä¸ªé˜Ÿåˆ—ä¸­çš„èµ„æºé‡å¯ä»¥é…ç½®ï¼ŒåŒé˜Ÿåˆ—ä¸­çš„ä½œä¸šå…¬å¹³å…±äº«é˜Ÿåˆ—ä¸­æ‰€æœ‰èµ„æºï¼›æ¯ä¸ªé˜Ÿåˆ—ä¸­çš„ job æŒ‰ç…§ä¼˜å…ˆçº§åˆ†é…èµ„æºï¼Œä¼˜å…ˆçº§è¶Šé«˜åˆ†é…çš„èµ„æºè¶Šå¤šï¼Œä½†æ˜¯æ¯ä¸ª job éƒ½ä¼šåˆ†é…åˆ°èµ„æºä»¥ç¡®ä¿å…¬å¹³ï¼›ï¼ˆå·®é¢ï¼šjob éœ€è¦çš„èµ„æº - job å®é™…è·å–çš„èµ„æºï¼‰åœ¨åŒä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œjob æ—³èµ„æºç¼ºé¢è¶Šå¤§ï¼Œè¶Šå…ˆè·å¾—èµ„æºä¼˜å…ˆæ‰§è¡Œã€‚ æ¨æµ‹æ‰§è¡Œ æŸäº›ä»»åŠ¡è¿‡æ…¢ï¼Œåˆ™ä¸ºå…¶å¯åŠ¨å¤šä¸ªå¤‡ä»½ä»»åŠ¡ï¼ŒåŒæ—¶è¿è¡Œï¼Œè°å…ˆè¿è¡Œå®Œæˆç”¨è°çš„ç»“æœã€‚ æ¯ä¸ª Task åªèƒ½æœ‰ä¸€ä¸ªå¤‡ä»½ä»»åŠ¡ï¼›å½“å‰ Job å·²å®Œæˆçš„ Task å¿…é¡»ä¸å°äº0.05ï¼ˆ5%ï¼‰ï¼›å¼€å¯æ¨æµ‹æ‰§è¡Œå‚æ•°è®¾ç½®ã€‚mapred-site.xml æ–‡ä»¶ä¸­é»˜è®¤æ˜¯æ‰“å¼€çš„ã€‚","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://yoursite.com/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"Hadoop","slug":"Hadoop","permalink":"http://yoursite.com/tags/Hadoop/"}]},{"title":"sklearn","slug":"æœºå™¨å­¦ä¹ /sklearn","date":"2020-04-23T03:07:44.000Z","updated":"2020-08-02T08:18:31.525Z","comments":true,"path":"2020/04/23/æœºå™¨å­¦ä¹ /sklearn/","link":"","permalink":"http://yoursite.com/2020/04/23/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/sklearn/","excerpt":"ç®€å•äº†è§£æœºå™¨å­¦ä¹ çš„åŸºæœ¬æ¦‚å¿µä»¥åŠå¸¸è§„æµç¨‹ï¼Œå¹¶ç®€å•ä»‹ç» Python çš„æœºå™¨å­¦ä¹ åº“ sklearn çš„ä½¿ç”¨ã€‚","text":"ç®€å•äº†è§£æœºå™¨å­¦ä¹ çš„åŸºæœ¬æ¦‚å¿µä»¥åŠå¸¸è§„æµç¨‹ï¼Œå¹¶ç®€å•ä»‹ç» Python çš„æœºå™¨å­¦ä¹ åº“ sklearn çš„ä½¿ç”¨ã€‚ Jupyter å®‰è£…é…ç½®123456pip3 install jupyter -i https://pypi.tuna.tsinghua.edu.cn/simple/ # å›½å†…é•œåƒä¸‹è½½ jupyterjupyter notebook --generate-config # ç”Ÿæˆé»˜è®¤çš„é…ç½®æ–‡ä»¶## Writing default config to: C:\\Users\\wingo\\.jupyter\\jupyter_notebook_config.py## C.NotebookApp.notebook_dir='' ä¿®æ”¹æ­¤é¡¹é…ç½®jupyter notebook # å¯åŠ¨ Jupyter notebookpip3 install -U scikit-learn -i https://pypi.tuna.tsinghua.edu.cn/simple/ # ä¸‹è½½åº“ æœºå™¨å­¦ä¹ æ¦‚è¿°æ•°æ® ğŸ‘‰ æ¨¡å‹ ğŸ‘‰ é¢„æµ‹ï¼Œå³ä»å†å²æ•°æ®ä¸­è·å¾—è§„å¾‹ã€‚ æ•°æ®é›†çš„æ„æˆï¼šç‰¹å¾å€¼ + ç›®æ ‡å€¼ã€‚ æ ¹æ®æ˜¯å¦æœ‰ç›®æ ‡å€¼ï¼Œå¯ä»¥åˆ†ä¸ºæ— ç›‘ç£å­¦ä¹ ï¼ˆæ— ç›®æ ‡å€¼ï¼‰ã€ç›‘ç£å­¦ä¹ ï¼ˆæœ‰ç›®æ ‡å€¼ï¼‰ã€‚ æ ¹æ®æ•°æ®çš„å½¢å¼ï¼Œå¯ä»¥åˆ†ä¸ºåˆ†ç±»é—®é¢˜ï¼ˆç±»åˆ«ï¼‰ã€å›å½’é—®é¢˜ï¼ˆè¿ç»­æ€§æ•°æ®ï¼‰ã€‚ æœºå™¨å­¦ä¹ çš„æ™®éå¼€å‘æµç¨‹ï¼š 1ï¼‰è·å–æ•°æ®ï¼›2ï¼‰æ•°æ®å¤„ç†ï¼›3ï¼‰ç‰¹å¾å·¥ç¨‹ï¼›4ï¼‰æ¨¡å‹è®­ç»ƒï¼›5ï¼‰æ¨¡å‹è¯„ä¼°ï¼›6ï¼‰å®é™…åº”ç”¨ã€‚ æ•°æ®è·å–sklearn è‡ªå¸¦äº†è®¸å¤šæ•°æ®ï¼Œä¾›å¼€å‘è€…è¿›è¡Œæµ‹è¯•ä½¿ç”¨ã€‚ 123456789# å¯¼å…¥æ»¡æ»¡çš„æ•°æ®åº“from sklearn import datasets# åˆ†å‰²æ•°æ®çš„æ¨¡å—ï¼ŒæŠŠæ•°æ®é›†åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†from sklearn.model_selection import train_test_split# è½½å…¥æ•°æ®ï¼Œç»å…¸é¸¢å°¾èŠ±æ•°æ®iris = datasets.load_iris()# random_state ä¸ºäº†ä¿è¯ç¨‹åºæ¯æ¬¡è¿è¡Œéƒ½åˆ†å‰²ä¸€æ ·çš„è®­ç»ƒé›†åˆæµ‹è¯•é›†ã€‚å¦åˆ™ï¼ŒåŒæ ·çš„ç®—æ³•æ¨¡å‹åœ¨ä¸åŒçš„è®­ç»ƒé›†å’Œæµ‹è¯•é›†ä¸Šçš„æ•ˆæœä¸ä¸€æ ·ã€‚x_train, x_test, y_train, y_test = train_test_split(iris.data, iris.target, test_size=0.2, random_state=0) æŸ¥çœ‹æ­¤æ•°æ®é›†çš„è¯¦ç»†æè¿°ï¼š æ•°æ®é›†çš„åˆ’åˆ†ï¼š è®­ç»ƒæ•°æ®ï¼Œç”¨äºè®­ç»ƒï¼Œæ„å»ºæ¨¡å‹ï¼›æµ‹è¯•æ•°æ®ï¼Œåœ¨æ¨¡å‹æ£€éªŒæ—¶ä½¿ç”¨ï¼Œç”¨äºè¯„ä¼°æ¨¡å‹æ˜¯å¦æœ‰æ•ˆã€‚ ç‰¹å¾å·¥ç¨‹ Feature Engineeringï¼šç‰¹å¾å·¥ç¨‹å°±æ˜¯å¯¹ç‰¹å¾å€¼è¿›è¡Œå¤„ç†ï¼Œé€‰æ‹©æœ‰æ„ä¹‰çš„ç‰¹å¾è¾“å…¥æœºå™¨å­¦ä¹ çš„ç®—æ³•å’Œæ¨¡å‹è¿›è¡Œè®­ç»ƒã€‚ å­—å…¸ç‰¹å¾æå–12345678910111213141516171819202122232425262728from sklearn.feature_extraction import DictVectorizer# list:[dict&#123;&#125;, dict&#123;&#125;, dict&#123;&#125;]data = [&#123;'city': 'åŒ—äº¬','temperature':100&#125;, &#123;'city': 'ä¸Šæµ·','temperature':60&#125;, &#123;'city': 'æ·±åœ³','temperature':30&#125;]# å®ä¾‹åŒ–ä¸€ä¸ªè½¬æ¢å™¨ç±»ï¼Œæ­¤å¤„ sparse=True è®¾ç½®ç»“æœä¸ºç¨€ç–çŸ©é˜µæ–¹ä¾¿æŸ¥çœ‹transfer = DictVectorizer(sparse=True)# è°ƒç”¨ fit_transform() è¿›è¡Œç‰¹å¾æå–data_new = transfer.fit_transform(data)# æ‰“å°ç‰¹å¾æå–ç»“æœprint(\"data_new_sparse:\\n\", data_new, \"\\n\", type(data_new))print(\"data_new:\\n\", data_new.toarray())print(\"ç‰¹å¾åå­—:\\n\", transfer.get_feature_names())\"\"\" æ‰“å°ç»“æœdata_new_sparse: (0, 1) 1.0 (0, 3) 100.0 (1, 0) 1.0 (1, 3) 60.0 (2, 2) 1.0 (2, 3) 30.0 &lt;class 'scipy.sparse.csr.csr_matrix'&gt;data_new: [[ 0. 1. 0. 100.] [ 1. 0. 0. 60.] [ 0. 0. 1. 30.]]ç‰¹å¾åå­—: ['city=ä¸Šæµ·', 'city=åŒ—äº¬', 'city=æ·±åœ³', 'temperature']\"\"\" ç”±ä¸Šé¢çš„ä¾‹å­å¯ä»¥çœ‹å‡ºï¼Œç»è¿‡ sklearn çš„å­—å…¸ç‰¹å¾è½¬æ¢åï¼Œå…¶ç±»å‹è½¬æ¢ä¸º matrixï¼Œå³ä¸€ä¸ªçŸ©é˜µç±»å‹ã€‚ åŸå§‹æ•°æ®ä¸­çš„ç‰¹å¾å€¼åªæœ‰ 2 ä¸ªï¼šcityã€temperatureï¼›ä½†è½¬æ¢å‡ºæ¥çš„ç‰¹å¾çŸ©é˜µå´æœ‰ 4 åˆ—ï¼Œè¿™æ˜¯ä¸ºäº†å°†ç‰¹å¾å€¼å˜é‡è½¬æ¢ä¸ºæœºå™¨å­¦ä¹ ç®—æ³•æ˜“äºåˆ©ç”¨çš„ä¸€ç§å½¢å¼ï¼Œæ­¤è½¬æ¢è¿‡ç¨‹ç§°ä¸º one hot ç¼–ç ã€‚ æ–‡æœ¬ç‰¹å¾æå–CountVectorizer123456789101112131415from sklearn.feature_extraction.text import CountVectorizerdata = [\"How to shift your mindset and choose your future\", \"I like python, Do you like python?\"]# å®ä¾‹åŒ–ä¸€ä¸ªè½¬æ¢å™¨ç±»ï¼Œå¯ä»¥å±è”½ä¸€äº›æ²¡æœ‰æ„ä¹‰çš„è¯è¯­transfer = CountVectorizer(stop_words=[\"and\", \"to\"])# è°ƒç”¨ fit_transformdata_new = transfer.fit_transform(data)print(\"data_new:\\n\", data_new.toarray())print(\"ç‰¹å¾åå­—ï¼š\\n\", transfer.get_feature_names())\"\"\" æ‰“å°ç»“æœdata_new: [[1 0 1 1 0 1 0 1 0 2] [0 1 0 0 2 0 2 0 1 0]]ç‰¹å¾åå­—ï¼š ['choose', 'do', 'future', 'how', 'like', 'mindset', 'python', 'shift', 'you', 'your']\"\"\" æ€è€ƒï¼šè‹¥æ˜¯å¯¹ä¸€å¥ä¸­æ–‡æ–‡æœ¬è¿›è¡Œæ–‡æœ¬ç‰¹å¾æå–ï¼Œé‚£ä¼šå‡ºç°ä»€ä¹ˆç»“æœï¼Ÿ å¯¹äºä¸­æ–‡æ–‡æœ¬ï¼Œå› ä¸ºè¯è¯­ä¹‹é—´ä¸å­˜åœ¨ç©ºæ ¼ï¼Œæ‰€ä»¥éœ€è¦åˆ†è¯åº“å…ˆè¿›è¡Œåˆ†è¯ï¼š&quot; &quot;.join(list(jieba.cut(text))) TfidfVectorizer Term Frequency - Inverse Document Frequencyï¼Œå³è¯é¢‘ - é€†æ–‡æœ¬é¢‘ç‡ï¼Œç”± TF å’Œ IDF ç»„æˆã€‚ TFï¼Œå³æ™®é€šçš„è¯é¢‘ç»Ÿè®¡ï¼Œè¿™ä¸ªæ¯”è¾ƒå¥½ç†è§£ï¼ŒIDFï¼Œç”¨äºååº”ä¸€ä¸ªè¯çš„é‡è¦æ€§ï¼Œè¿›è€Œä¿®æ­£ä»…ä»…ç”¨è¯é¢‘è¡¨ç¤ºçš„è¯ç‰¹å¾å€¼ã€‚æ¯”å¦‚ï¼Œâ€toâ€ è¿™ä¸ªè¯çš„è¯é¢‘éå¸¸é«˜ï¼Œä½†å®ƒåœ¨æ¯ä¸€ç¯‡æ–‡ç« ä¸­éƒ½å‡ºç°äº†ï¼Œé‚£ä¹ˆå®ƒè¿™ä¸ªé«˜è¯é¢‘å°±æ²¡æœ‰ä»€ä¹ˆå¤ªå¤§çš„æ„ä¹‰ã€‚ 1234567891011121314151617181920212223242526272829303132333435from sklearn.feature_extraction.text import TfidfVectorizerfrom sklearn.feature_extraction.text import CountVectorizerimport jiebadata = [\"ä»Šå¤©æ˜¯æ˜ŸæœŸä¸€ï¼Œæœ‰ç‚¹å¿«ä¹\", \"ä»Šå¤©æ˜¯æ˜ŸæœŸäºŒï¼Œæ— æ•Œå¿«ä¹\", \"ä»Šå¤©æ˜¯æ˜ŸæœŸä¸‰ï¼Œè¶…çº§å¿«ä¹\"]data_new = []for sent in data: data_new.append(\" \".join(list(jieba.cut(sent))))\"\"\"data_new['ä»Šå¤© æ˜¯ æ˜ŸæœŸä¸€ ï¼Œ æœ‰ç‚¹ å¿«ä¹', 'ä»Šå¤© æ˜¯ æ˜ŸæœŸäºŒ ï¼Œ æ— æ•Œ å¿«ä¹', 'ä»Šå¤© æ˜¯ æ˜ŸæœŸä¸‰ ï¼Œ è¶…çº§ å¿«ä¹']\"\"\"# è½¬æ¢å™¨transfer = TfidfVectorizer()transfer_normal = CountVectorizer()# ç‰¹å¾æå–data_final = transfer.fit_transform(data_new)data_normal = transfer_normal.fit_transform(data_new)print(\"data_new:\\n\", data_final.toarray())print(\"data_new_normal:\\n\", data_normal.toarray())print(\"ç‰¹å¾åå­—ï¼š\\n\", transfer.get_feature_names())\"\"\"æ‰“å°ç»“æœdata_new: [[0.35959372 0.35959372 0. 0.6088451 0. 0. 0.6088451 0. ] [0.35959372 0.35959372 0.6088451 0. 0. 0.6088451 0. 0. ] [0.35959372 0.35959372 0. 0. 0.6088451 0. 0. 0.6088451 ]]data_new_normal: [[1 1 0 1 0 0 1 0] [1 1 1 0 0 1 0 0] [1 1 0 0 1 0 0 1]]ç‰¹å¾åå­—ï¼š ['ä»Šå¤©', 'å¿«ä¹', 'æ— æ•Œ', 'æ˜ŸæœŸä¸€', 'æ˜ŸæœŸä¸‰', 'æ˜ŸæœŸäºŒ', 'æœ‰ç‚¹', 'è¶…çº§']\"\"\" åˆ†æä¸Šè¿°ç»“æœï¼Œæ™®é€šçš„è¯é¢‘åˆ†æå¾—å‡ºçš„ç»“æœæ˜¯è¯é¢‘ç›¸åŒï¼Œè€Œ tf-idf åˆ†æï¼Œå¯¹äºæ¯ä¸ªå¥å­ä¸­éƒ½å‡ºç°çš„è¯çš„é‡è¦æ€§ä¼šæœ‰æ‰€é™ä½ã€‚ ç‰¹å¾é¢„å¤„ç† æ— é‡çº²åŒ–ï¼šè¿›è¡Œæ— é‡çº²åŒ–åè¡¨å¾ä¸åŒå±æ€§ï¼ˆå•ä½ä¸åŒï¼‰çš„å„ç‰¹å¾ä¹‹é—´æ‰æœ‰å¯æ¯”æ€§ï¼Œå¦‚ 1cm ä¸ 0.1kg å¦‚ä½•æ¯”è¾ƒï¼Ÿ å½’ä¸€åŒ– æ— æ³•å¤„ç†å¼‚å¸¸å€¼ï¼ˆæœ€å¤§å€¼ï¼Œæœ€å°å€¼ï¼‰ï¼› 123456789from sklearn.preprocessing import MinMaxScalerx_mm = [[1,-1,2],[2,0,0],[0,1,-1]]x_mm_new = MinMaxScaler().fit_transform(x_mm)\"\"\"x_mm_newarray([[0.5 , 0. , 1. ], [1. , 0.5 , 0.33333333], [0. , 1. , 0. ]])\"\"\" æ ‡å‡†åŒ– æ ‡å‡†å·®ï¼ˆæè¿°æ ·æœ¬é›†ä¸­ç¨‹åº¦ï¼Œå¼‚å¸¸å€¼å¯¹æ€»æ ·æœ¬çš„é›†ä¸­ç¨‹åº¦çš„å½±å“ä¸å¤§ï¼‰ï¼Œåœ¨å·²æœ‰æ ·æœ¬è¶³å¤Ÿå¤šçš„æƒ…å†µä¸‹æ¯”è¾ƒç¨³å®šï¼Œé€‚åˆç°ä»£å˜ˆæ‚å¤§æ•°æ®åœºæ™¯ã€‚ 12345678from sklearn.preprocessing import StandardScalerx = [[1,2,3],[4,5,6],[1,2,1]]x_new = StandardScaler().fit_transform(x)\"\"\"x_newarray([[-0.70710678, -0.70710678, -0.16222142], [ 1.41421356, 1.41421356, 1.29777137], [-0.70710678, -0.70710678, -1.13554995]])\"\"\" ç‰¹å¾é™ç»´ è¿™é‡Œçš„é™ç»´çš„ç»´åº¦ï¼Œä¸æ˜¯æŒ‡çŸ©é˜µã€å‘é‡ã€æ ‡é‡ç­‰ï¼Œè€Œæ˜¯æŒ‡é™ä½ç‰¹å¾çš„ä¸ªæ•°ï¼Œè®©æœ€ç»ˆå¾—åˆ°çš„æ•°æ®ä¸­çš„æ¯ä¸ªç‰¹å¾ä¹‹é—´äº’ä¸ç›¸å…³ã€‚ æ€è€ƒï¼šç‰¹å¾ä¹‹é—´ç›¸å…³åº¦è¿‡é«˜ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿï¼Ÿï¼Ÿè‹¥ mã€n éƒ½å¯ä»¥å¾—å‡º rï¼Œé‚£ä¹ˆå»æ‰ m ã€n ä¸­çš„ä»»æ„ä¸€ä¸ªç‰¹å¾å¯¹ç»“æœéƒ½ä¸ä¼šå½±å“ï¼Œåœ¨ä¸€ä¸ªåºå¤§çš„æ•°æ®ä¸­ï¼Œå»æ‰æŸäº›ç›¸å…³æ€§ç‰¹åˆ«é«˜çš„ç‰¹å¾å¯ä»¥èŠ‚çœå¾ˆå¤šç®—åŠ›ä¸å†…å­˜ç©ºé—´ï¼Œæ¨¡å‹æ›´åŠ é«˜æ•ˆã€‚ Filter æ–¹å·®é€‰æ‹©æ³•ï¼šä½æ–¹å·®ç‰¹å¾è¿‡æ»¤ï¼Œå³è¿‡æ»¤å·®åˆ«ä¸å¤§çš„ç‰¹å¾ã€‚ 12345678910111213141516171819202122232425262728293031323334from sklearn.feature_selection import VarianceThresholdimport pandas as pdfrom scipy.stats import pearsonr# è·å–æ•°æ®data = pd.read_csv(\"factor_returns.csv\")# ä¿ç•™æ¯ä¸€è¡Œï¼Œä¿ç•™ä»[ç¬¬äºŒåˆ—åˆ°å€’æ•°ç¬¬äºŒåˆ—)data = data.iloc[:, 1:-2]data_v = data.valuesprint(\"data:\\n\", data_v.shape)# å®ä¾‹åŒ–ä¸€ä¸ªè½¬æ¢å™¨ç±»transfer = VarianceThreshold(threshold=10)# è°ƒç”¨ fit_transformdata_new = transfer.fit_transform(data)print(\"data_new:\\n\",data_new.shape)# è®¡ç®—æŸä¸¤ä¸ªå˜é‡ä¹‹é—´çš„ç›¸å…³ç³»æ•°r1 = pearsonr(data[\"pe_ratio\"], data[\"pb_ratio\"])print(\"pe_ratio ä¸ pb_ratio ä¹‹é—´çš„ç›¸å…³æ€§ï¼š\\n\", r1)r2 = pearsonr(data['revenue'], data['total_expense'])print(\"revenue ä¸ total_expense ä¹‹é—´çš„ç›¸å…³æ€§ï¼š\\n\", r2)\"\"\"æ‰“å°ç»“æœdata: (2318, 9)data_new: (2318, 7)pe_ratio ä¸ pb_ratio ä¹‹é—´çš„ç›¸å…³æ€§ï¼š (-0.0043893227799362685, 0.8327205496564927)revenue ä¸ total_expense ä¹‹é—´çš„ç›¸å…³æ€§ï¼š (0.9958450413136116, 0.0)\"\"\" pearsonrï¼šçš®å°”é€Šç›¸å…³ç³»æ•°ï¼Œå–å€¼èŒƒå›´ï¼šâ€“1â‰¤ r â‰¤+1ã€‚ è‹¥ç‰¹å¾ä¸ç‰¹å¾ä¹‹é—´ç›¸å…³æ€§å¾ˆé«˜ï¼š é€‰å–å…¶ä¸­ä¸€ä¸ªï¼›åŠ æƒæ±‚å’Œï¼›ä¸»æˆåˆ†åˆ†æï¼› ä¸»æˆåˆ†åˆ†æ PCAï¼ŒPrincipal components analysisã€‚ 1transfer = PCA(n_components=0.95) # è¿›è¡Œ PCA é™ç»´ï¼Œå¹¶ä¿å­˜ 95% çš„ä¿¡æ¯ã€‚ æ¡ˆä¾‹åˆ†æï¼šè´­ç‰©è½¦ é¢„æµ‹æŸä¸ª user_id ä¸‹æ¬¡ä¼šè´­ä¹° aisleã€‚ 123456789101112131415161718192021222324252627282930313233343536import pandas as pd# è·å–æ•°æ®# è®¢å•ä¸å•†å“ä¿¡æ¯order_products = pd.read_csv(\"./instacart/order_products__prior.csv\")# å•†å“è¯¦ç»†ä¿¡æ¯products = pd.read_csv(\"./instacart/products.csv\")# è®¢å•è¯¦ç»†ä¿¡æ¯orders = pd.read_csv(\"./instacart/orders.csv\")# å•†å“æ‰€å±ç±»åˆ«ä¿¡æ¯aisles = pd.read_csv(\"./instacart/aisles.csv\")# æ‰“å°ç‰¹å¾å€¼æ‰¾è§„å¾‹ï¼Œå°†æ‰€æœ‰çš„ç‰¹å¾å€¼åˆå¹¶åˆ°ä¸€å¼ è¡¨ä¸­ç„¶åè¿›è¡Œ PCA é™ç»´print(order_products.columns.values.tolist(),\"\\n\", products.columns.values.tolist(), \"\\n\", orders.columns.values.tolist(),\"\\n\", aisles.columns.values.tolist())\"\"\"æ‰“å°ç»“æœ['order_id', 'product_id', 'add_to_cart_order', 'reordered'] ['product_id', 'product_name', 'aisle_id', 'department_id'] ['order_id', 'user_id', 'eval_set', 'order_number', 'order_dow', 'order_hour_of_day', 'days_since_prior_order'] ['aisle_id', 'aisle']\"\"\"tab1 = pd.merge(aisles, products, on=[\"aisle_id\", \"aisle_id\"])tab2 = pd.merge(tab1, order_products, on=[\"product_id\", \"product_id\"])tab3 = pd.merge(tab2, orders, on=[\"order_id\", \"order_id\"])tab3.columns.values.tolist()\"\"\"æ‰“å°ç»“æœ['aisle_id', 'aisle', 'product_id', 'product_name', 'department_id', 'order_id', 'add_to_cart_order', 'reordered', 'user_id', 'eval_set', 'order_number', 'order_dow', 'order_hour_of_day', 'days_since_prior_order']\"\"\"# è™½ç„¶æ‰€æœ‰çš„æ•°æ®ç‰¹å¾éƒ½åœ¨ä¸€ä¸ªè¡¨ä¸­ï¼Œä½†è¡¨çš„å½¢å¼ä¸æ˜¯éœ€è¦çš„ user_id ä¸ aisle çš„å…³ç³»# åˆ©ç”¨äº¤å‰è¡¨åæ˜ çš„ user_id å’Œ aisle ä¹‹é—´çš„å…³ç³»table = pd.crosstab(tab3[\"user_id\"], tab3[\"aisle\"]) 123456789101112# æœ‰å¤§é‡çš„ç‰¹å¾å€¼ï¼Œå¯¹æ•°æ®è¿›è¡Œé™ç»´å¤„ç†from sklearn.decomposition import PCAdata = table[:10000]data.shape# (10000, 134)from sklearn.decomposition import PCA# å®ä¾‹åŒ–ä¸€ä¸ªè½¬æ¢å™¨ç±»transfer = PCA(n_components=0.95)# è°ƒç”¨ fit_transformdata_new = transfer.fit_transform(data)data_new.shape# (10000, 42) åœ¨ä¸Šè¿°æ¡ˆä¾‹ä¸­ï¼Œé€šè¿‡ PCA é™ç»´ï¼Œå°† 134 ä¸ªç‰¹å¾å€¼é™åˆ°äº† 42 ä¸ªï¼Œå¹¶ä¸”è¿˜ä¿ç•™äº†åŸæœ¬æ•°æ® 95% çš„ä¿¡æ¯ï¼Œå¯è§ PCA é™ç»´è¿˜æ˜¯æŒºå¥½ç”¨çš„ã€‚ åˆ†ç±»ç®—æ³•sklearn çš„è½¬æ¢å™¨å’Œä¼°è®¡å™¨ã€‚ è½¬æ¢å™¨ï¼ˆtransformerï¼‰ï¼Œç‰¹å¾å·¥ç¨‹çš„çˆ¶ç±»ï¼› fit_transform() å…¶å®æ˜¯ä¸¤ä¸ªè¿‡ç¨‹ï¼šfit() è®¡ç®—æ¯ä¸€åˆ—çš„å¹³å‡å€¼ã€æ ‡å‡†å·®ï¼›transform() å®ç°æœ€ç»ˆçš„è½¬æ¢ã€‚ ä¼°è®¡å™¨ï¼ˆestimatorï¼‰ï¼Œæœºå™¨å­¦ä¹ ç®—æ³•çš„å®ç°ã€‚ 1234estimator.fit(x_train, y_train) # è®¡ç®—ç”Ÿæˆæ¨¡å‹y_predict = estimator.predict(x_test) # å¯¹æµ‹è¯•æ•°æ®è¿›è¡Œæµ‹è¯•y_test == y_predict # æµ‹è¯•ç»“æœä¸åŸæœ‰ç»“æœè¿›è¡Œå¯¹æ¯”accuracy = estimator.score(x_test, y_test) # è®¡ç®—å‡†ç¡®ç‡ K - è¿‘é‚»ç®—æ³• å³ï¼Œæ ¹æ®é‚»è¿‘çš„ç±»å‹æ¥æ¨æµ‹å‡ºè‡ªèº«ç±»å‹ã€‚é‚»è¿‘æŒ‡çš„æ˜¯è·ç¦»ï¼š æ¬§æ°è·ç¦»ï¼›æ›¼å“ˆé¡¿è·ç¦»ï¼ˆç»å¯¹å€¼è·ç¦»ï¼‰ï¼Œæ˜å¯å¤«æ–¯åŸºè·ç¦»ã€‚ é¸¢å°¾èŠ±åˆ†ç±»æ¡ˆä¾‹12345678910111213141516171819202122232425262728293031323334353637383940414243from sklearn.datasets import load_irisfrom sklearn.model_selection import train_test_splitfrom sklearn.preprocessing import StandardScalerfrom sklearn.neighbors import KNeighborsClassifier# è·å–æ•°æ®iris = load_iris()# åˆ’åˆ†æ•°æ®é›†x_train, x_test, y_train, y_test = train_test_split(iris.data, iris.target, random_state=0)# ç‰¹å¾å·¥ç¨‹transfer = StandardScaler()# è®­ç»ƒé›†å’Œæµ‹è¯•é›†éƒ½è¦åšä¸€æ ·çš„å¤„ç†x_train = transfer.fit_transform(x_train)# æµ‹è¯•åŸºä½¿ç”¨æµ‹è¯•æœºçš„ fit() è¿›è¡Œè®¡ç®—x_test = transfer.transform(x_test)# KNN ç®—æ³•é¢„ä¼°å™¨ï¼Œè‡ªå®šä¹‰è·ç¦»ï¼ˆä¸æ–­å°è¯•å‡ºä¸€ä¸ªå‡†ç¡®ç‡è¾ƒé«˜çš„è·ç¦»ï¼‰estimator = KNeighborsClassifier(n_neighbors=3)estimator.fit(x_train, y_train)# æ¨¡å‹è¯„ä¼°y_predict = estimator.predict(x_test)print(\"y_predict:\\n\", y_predict)print(\"ç›´æ¥æ¯”å¯¹çœŸå®å€¼å’Œé¢„æµ‹å€¼:\\n\", y_test == y_predict)\"\"\"ç»“æœæ‰“å°y_predict: [2 1 0 2 0 2 0 1 1 1 2 1 1 1 1 0 1 1 0 0 2 1 0 0 2 0 0 1 1 0 2 1 0 2 2 1 0 2]ç›´æ¥æ¯”å¯¹çœŸå®å€¼å’Œé¢„æµ‹å€¼: [ True True True True True True True True True True True True True True True True True True True True True True True True True True True True True True True True True True True True True False]\"\"\"# è®¡ç®—å‡†ç¡®ç‡score = estimator.score(x_test, y_test)print(\"å‡†ç¡®ç‡ä¸ºï¼š\\n\", score)\"\"\"ç»“æœæ‰“å°å‡†ç¡®ç‡ä¸ºï¼š 0.9736842105263158\"\"\" ä¼˜ç‚¹ï¼šç®€å•ï¼Œæ˜“äºç†è§£ï¼Œæ˜“äºå®ç°ï¼Œæ— éœ€è®­ç»ƒ;ç¼ºç‚¹ï¼šå¿…é¡»æŒ‡å®š K å€¼ï¼ŒK å€¼é€‰æ‹©ä¸å½“åˆ™åˆ†ç±»ç²¾åº¦ä¸èƒ½ä¿è¯ï¼›æ‡’æƒ°ç®—æ³•ï¼Œå¯¹æµ‹è¯•æ ·æœ¬åˆ†ç±»æ—¶çš„è®¡ç®—é‡å¤§ï¼Œå†…å­˜å¼€é”€å¤§ï¼›ä½¿ç”¨åœºæ™¯ï¼šå°æ•°æ®åœºæ™¯ï¼Œå‡ åƒï½å‡ ä¸‡æ ·æœ¬ï¼Œå…·ä½“åœºæ™¯å…·ä½“ä¸šåŠ¡å»æµ‹è¯•ã€‚ æ¨¡å‹é€‰æ‹©ä¸è°ƒä¼˜ æœ‰æ—¶å€™å¾—åˆ°çš„æ¨¡å‹çš„å‡†ç¡®ç‡ä¸å°½äººæ„ï¼Œè¿™æ—¶å°±éœ€è¦ä½¿ç”¨æŸäº›ç®—æ³•å¯¹æ¨¡å‹è¿›è¡Œé€‰æ‹©å’Œè°ƒä¼˜äº†ã€‚ äº¤å‰éªŒè¯ éªŒè¯é›†çš„æ•°é‡ä¸å¤Ÿï¼Œé‚£ä¹ˆæœ€å¥½è¿˜æ˜¯ç”¨äº¤å‰éªŒè¯å§ã€‚è‡³äºåˆ†æˆå‡ ä»½æ¯”è¾ƒå¥½ï¼Œä¸€èˆ¬éƒ½æ˜¯åˆ†æˆ 3ã€5 å’Œ 10 ä»½ã€‚ ç½‘æ ¼æœç´¢ åˆç§°ä¸ºè¶…å‚æ•°æœç´¢ã€‚å¯¹ KNN çš„ K å€¼è¿›è¡Œå‚æ•°è°ƒä¼˜ï¼ŒæŠŠä¸€ç»„ K å€¼ä¼ å…¥ç½‘æ ¼æœç´¢ä¸­ï¼Œæ‰¾å‡ºæœ€ä¼˜å€¼ã€‚ é¸¢å°¾èŠ± K å€¼è°ƒä¼˜1234567891011121314151617181920212223estimator = KNeighborsClassifier()# åŠ å…¥ç½‘æ ¼æœç´¢ä¸äº¤å‰éªŒè¯# å‚æ•°å‡†å¤‡param_dict = &#123;\"n_neighbors\": [1, 3, 5, 7, 9, 11]&#125;# cv=10ï¼Œè¿›è¡Œ10æŠ˜äº¤å‰éªŒè¯estimator = GridSearchCV(estimator, param_grid=param_dict, cv=10)estimator.fit(x_train, y_train)y_predict = estimator.predict(x_test)print(\"y_predict:\\n\", y_predict)print(\"ç›´æ¥æ¯”å¯¹çœŸå®å€¼å’Œé¢„æµ‹å€¼:\\n\", y_test == y_predict)score = estimator.score(x_test, y_test)print(\"å‡†ç¡®ç‡ä¸ºï¼š\\n\", score)# æœ€ä½³å‚æ•°ï¼šbest_params_print(\"æœ€ä½³å‚æ•°ï¼š\\n\", estimator.best_params_)# æœ€ä½³ç»“æœï¼šbest_score_print(\"æœ€ä½³ç»“æœï¼š\\n\", estimator.best_score_)# æœ€ä½³ä¼°è®¡å™¨ï¼šbest_estimator_print(\"æœ€ä½³ä¼°è®¡å™¨:\\n\", estimator.best_estimator_)# äº¤å‰éªŒè¯ç»“æœï¼šcv_results_print(\"äº¤å‰éªŒè¯ç»“æœ:\\n\", estimator.cv_results_) æœ´ç´ è´å¶æ–¯ Naive Bayesianã€‚æœ´ç´ ï¼Ÿå³ï¼Œå‡è®¾ç‰¹å¾ä¸ç‰¹å¾ä¹‹é—´æ˜¯ç›¸äº’ç‹¬ç«‹ã€‚ åº”ç”¨åœºæ™¯ï¼šæ–‡æœ¬åˆ†ç±»ï¼Œå•è¯ä½œä¸ºç‰¹å¾ã€‚ å†³ç­–æ ‘å“ªä¸ªç‰¹å¾å€¼çš„ä¿¡æ¯å¢ç›Šå¤§ï¼Œé‚£å°±åº”è¯¥å…ˆç”¨è¿™ä¸ªç‰¹å¾å€¼åšè¿‡æ»¤ã€‚ ç¼ºç‚¹ï¼šå®¹æ˜“äº§ç”Ÿè¿‡æ‹Ÿåˆï¼Œå³ä¸€ä¸ª overfitted æ¨¡å‹è®°ä½å¤ªå¤š training data çš„ç»†èŠ‚ä»è€Œé™ä½äº† generalization çš„èƒ½åŠ›ã€‚ æ¬ æ‹Ÿåˆï¼šå…‰çœ‹ä¹¦ä¸åšé¢˜è§‰å¾—è‡ªå·±ä¼šäº†ï¼Œä¸Šäº†è€ƒåœºå•¥éƒ½ä¸ä¼šï¼›è¿‡æ‹Ÿåˆ: åšè¯¾åé¢˜å…¨éƒ½èƒ½åšå¯¹ï¼Œä¸Šäº†è€ƒåœºè¿˜æ˜¯å•¥éƒ½ä¸ä¼šã€‚ 123456789101112131415161718192021222324252627282930313233343536373839from sklearn.datasets import load_irisfrom sklearn.model_selection import train_test_splitfrom sklearn.tree import DecisionTreeClassifier, export_graphviz# è·å–æ•°æ®é›†iris = load_iris()# åˆ’åˆ†æ•°æ®é›†x_train, x_test, y_train, y_test = train_test_split(iris.data, iris.target, random_state=0)# å†³ç­–æ ‘é¢„ä¼°å™¨estimator = DecisionTreeClassifier(criterion=\"entropy\")estimator.fit(x_train, y_train)# æ¨¡å‹è¯„ä¼°# ç›´æ¥æ¯”å¯¹çœŸå®å€¼å’Œé¢„æµ‹å€¼y_predict = estimator.predict(x_test)print(\"y_predict:\\n\", y_predict)print(\"ç›´æ¥æ¯”å¯¹çœŸå®å€¼å’Œé¢„æµ‹å€¼:\\n\", y_test == y_predict)# è®¡ç®—å‡†ç¡®ç‡score = estimator.score(x_test, y_test)print(\"å‡†ç¡®ç‡ä¸ºï¼š\\n\", score)\"\"\"ç»“æœæ‰“å°y_predict: [0 2 1 2 1 1 1 1 1 0 2 1 2 2 0 2 1 1 1 1 0 2 0 1 2 0 2 2 2 1 0 0 1 1 1 0 0 0]ç›´æ¥æ¯”å¯¹çœŸå®å€¼å’Œé¢„æµ‹å€¼: [ True True True True True True True False True True True True True True True True True True False True True True True True True True True True True False True True True True True True True True]å‡†ç¡®ç‡ä¸ºï¼š 0.9210526315789473\"\"\"# å¯è§†åŒ–å†³ç­–æ ‘export_graphviz(estimator, out_file=\"iris_tree.dot\", feature_names=iris.feature_names) åœ¨çº¿å¯è§†åŒ– éšæœºæ£®æ— æ£®æ—ï¼šåŒ…å«å¤šä¸ªå†³ç­–æ ‘çš„åˆ†ç±»å™¨ã€‚ 12345678# æ•°æ®åŒå†³ç­–æ ‘from sklearn.ensemble import RandomForestClassifier# ä½¿ç”¨éšæœºæ£®æ—estimator = RandomForestClassifier()estimator.fit(x_train, y_train)y_predict = estimator.predict(x_test)print(estimator.score(x_test, y_test)) æ¡ˆä¾‹åˆ†æï¼šç­¾åˆ°é¢„æµ‹ æ ¹æ®ç»™å®šçš„æ•°æ®ï¼Œé¢„æµ‹äººä»¬æœ€å¯èƒ½åœ¨åœ°å›¾ä¸Šçš„å“ªä¸ªä½ç½®è¿›è¡Œç­¾åˆ°ã€‚ 12345import pandas as pd# è·å–æ•°æ®data = pd.read_csv(\"./FBlocation/train.csv\")data.head() 123456789101112131415161718192021# ç¼©å°èŒƒå›´ï¼Œæ–¹ä¾¿å®éªŒdata = data.query(\"x &lt; 2.5 &amp; x &gt; 2 &amp; y &lt; 1.5 &amp; y &gt; 1.0\")# å¯¹æ•°æ®è¿›è¡Œå¤„ç†ï¼Œè¿™ä¸ªæ—¶é—´çœ‹çš„å¾ˆéš¾å—# æ—¶é—´å¤„ç†æˆä¾¿äºè§‚å¯Ÿçš„å½¢å¼time_value = pd.to_datetime(data[\"time\"], unit=\"s\")time_value.head()# å¹´æœˆçš„å·®åˆ«ä¸å¤§ï¼Œå¯ä¸è€ƒè™‘\"\"\"ç»“æœæ‰“å°112 1970-01-08 05:06:14180 1970-01-08 01:29:55367 1970-01-07 17:01:07874 1970-01-02 15:52:461022 1970-01-03 09:46:33Name: time, dtype: datetime64[ns]\"\"\"# å¾—åˆ°æ—¶é—´åˆ—date = pd.DatetimeIndex(time_value)# ç»™æ•°æ®å¢åŠ æ—¥æœŸï¼Œæ˜ŸæœŸï¼Œæ—¶é—´è¿™äº›ç‰¹å¾å€¼data[\"day\"] = date.daydata[\"weekday\"] = date.weekdaydata[\"hour\"] = date.hour 12# æ ¹æ® place_id æˆç»„ï¼Œè¿‡æ»¤ç­¾åˆ°æ¬¡æ•°æ¯”è¾ƒå°‘çš„åœ°ç‚¹place_count = data.groupby(\"place_id\").count()[\"row_id\"] 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748# è¿‡æ»¤place_count[place_count &gt; 3].head()# æ ¹æ®å¾—åˆ°çš„ place_id å¯¹æ•°æ®è¿›è¡Œè¿‡æ»¤data_final = data[data[\"place_id\"].isin(place_count[place_count &gt; 3].index.values)]# ç­›é€‰ç‰¹å¾å€¼å’Œç›®æ ‡å€¼x = data_final[[\"x\", \"y\", \"accuracy\", \"day\", \"weekday\", \"hour\"]]y = data_final[\"place_id\"]from sklearn.model_selection import train_test_splitfrom sklearn.preprocessing import StandardScalerfrom sklearn.neighbors import KNeighborsClassifierfrom sklearn.model_selection import GridSearchCV# æ•°æ®é›†åˆ’åˆ†x_train, x_test, y_train, y_test = train_test_split(x, y)# ç‰¹å¾å·¥ç¨‹ï¼šæ ‡å‡†åŒ–transfer = StandardScaler()x_train = transfer.fit_transform(x_train)x_test = transfer.transform(x_test)# KNN ç®—æ³•é¢„ä¼°å™¨estimator = KNeighborsClassifier()# åŠ å…¥ç½‘æ ¼æœç´¢ä¸äº¤å‰éªŒè¯# å‚æ•°å‡†å¤‡param_dict = &#123;\"n_neighbors\": [3, 5, 7, 9]&#125;estimator = GridSearchCV(estimator, param_grid=param_dict, cv=3)estimator.fit(x_train, y_train)# æ¨¡å‹è¯„ä¼°# ç›´æ¥æ¯”å¯¹çœŸå®å€¼å’Œé¢„æµ‹å€¼y_predict = estimator.predict(x_test)print(\"y_predict:\\n\", y_predict)print(\"ç›´æ¥æ¯”å¯¹çœŸå®å€¼å’Œé¢„æµ‹å€¼:\\n\", y_test == y_predict)# è®¡ç®—å‡†ç¡®ç‡score = estimator.score(x_test, y_test)print(\"å‡†ç¡®ç‡ä¸ºï¼š\\n\", score)# æœ€ä½³å‚æ•°ï¼šbest_params_print(\"æœ€ä½³å‚æ•°ï¼š\\n\", estimator.best_params_)# æœ€ä½³ç»“æœï¼šbest_score_print(\"æœ€ä½³ç»“æœï¼š\\n\", estimator.best_score_)# æœ€ä½³ä¼°è®¡å™¨ï¼šbest_estimator_print(\"æœ€ä½³ä¼°è®¡å™¨:\\n\", estimator.best_estimator_)# äº¤å‰éªŒè¯ç»“æœï¼šcv_results_print(\"äº¤å‰éªŒè¯ç»“æœ:\\n\", estimator.cv_results_) æ¡ˆä¾‹åˆ†æï¼šç”Ÿå­˜é¢„æµ‹ æ ¹æ®äººçš„ä¿¡æ¯é¢„æµ‹æ­¤äººåœ¨æ­¤ç¾éš¾ä¸­å­˜æ´»ä¸‹æ¥çš„æ¦‚ç‡ã€‚ 123456789101112131415161718192021222324252627282930313233343536import pandas as pdtitanic = pd.read_csv(\"titanic.csv\")# ç­›é€‰ç‰¹å¾å€¼å’Œç›®æ ‡å€¼x = titanic[[\"pclass\", \"age\", \"sex\"]]y = titanic[\"survived\"]# ç¼ºå¤±å€¼å¤„ç†x[\"age\"].fillna(x[\"age\"].mean(), inplace=True)# è½¬æ¢æˆå­—å…¸ï¼Œæ–¹ä¾¿å¤„ç†x = x.to_dict(orient=\"records\")from sklearn.model_selection import train_test_split# æ•°æ®é›†åˆ’åˆ†x_train, x_test, y_train, y_test = train_test_split(x, y, random_state=0)# å­—å…¸ç‰¹å¾æŠ½å–from sklearn.feature_extraction import DictVectorizerfrom sklearn.tree import DecisionTreeClassifiertransfer = DictVectorizer()x_train = transfer.fit_transform(x_train)x_test = transfer.transform(x_test)# é¢„ä¼°å™¨estimator = DecisionTreeClassifier(criterion=\"entropy\", max_depth=3)estimator.fit(x_train, y_train)y_predict = estimator.predict(x_test)print(\"y_predict:\\n\", y_predict)print(\"ç›´æ¥æ¯”å¯¹çœŸå®å€¼å’Œé¢„æµ‹å€¼:\\n\", y_test == y_predict)score = estimator.score(x_test, y_test)print(\"å‡†ç¡®ç‡ä¸ºï¼š\\n\", score) å›å½’ç®—æ³•çº¿æ€§å›å½’ ç›®æ ‡å€¼ä¸ºè¿ç»­æ€§çš„æ•°æ®ã€‚ æ­£è§„æ–¹ç¨‹12345678910111213141516171819202122232425262728293031from sklearn.datasets import load_bostonfrom sklearn.model_selection import train_test_splitfrom sklearn.preprocessing import StandardScalerfrom sklearn.linear_model import LinearRegressionfrom sklearn.metrics import mean_squared_error# æ­£è§„æ–¹ç¨‹çš„ä¼˜åŒ–æ–¹æ³•å¯¹æ³¢å£«é¡¿æˆ¿ä»·è¿›è¡Œé¢„æµ‹# è·å–æ•°æ®boston = load_boston()# åˆ’åˆ†æ•°æ®é›†x_train, x_test, y_train, y_test = train_test_split(boston.data, boston.target, random_state=22)# æ ‡å‡†åŒ–transfer = StandardScaler()x_train = transfer.fit_transform(x_train)x_test = transfer.transform(x_test)# é¢„ä¼°å™¨estimator = LinearRegression()estimator.fit(x_train, y_train)# å¾—å‡ºæ¨¡å‹print(\"æ­£è§„æ–¹ç¨‹-æƒé‡ç³»æ•°ä¸ºï¼š\\n\", estimator.coef_)print(\"æ­£è§„æ–¹ç¨‹-åç½®ä¸ºï¼š\\n\", estimator.intercept_)# æ¨¡å‹è¯„ä¼°y_predict = estimator.predict(x_test)print(\"é¢„æµ‹æˆ¿ä»·ï¼š\\n\", y_predict)error = mean_squared_error(y_test, y_predict)print(\"æ­£è§„æ–¹ç¨‹-å‡æ–¹è¯¯å·®ä¸ºï¼š\\n\", error) æ¢¯åº¦ä¸‹é™ ä¸€ä¸ªä¸æ–­é€¼è¿‘çš„ï¼Œå‹¤å¥‹åŠªåŠ›çš„ç®—æ³•ã€‚ 12345678910111213141516171819202122232425262728293031from sklearn.datasets import load_bostonfrom sklearn.model_selection import train_test_splitfrom sklearn.preprocessing import StandardScalerfrom sklearn.linear_model import SGDRegressorfrom sklearn.metrics import mean_squared_error# æ¢¯åº¦ä¸‹é™çš„ä¼˜åŒ–æ–¹æ³•å¯¹æ³¢å£«é¡¿æˆ¿ä»·è¿›è¡Œé¢„æµ‹# è·å–æ•°æ®boston = load_boston()# åˆ’åˆ†æ•°æ®é›†x_train, x_test, y_train, y_test = train_test_split(boston.data, boston.target, random_state=22)# æ ‡å‡†åŒ–transfer = StandardScaler()x_train = transfer.fit_transform(x_train)x_test = transfer.transform(x_test)# é¢„ä¼°å™¨estimator = SGDRegressor(learning_rate=\"constant\", eta0=0.01, max_iter=10000, penalty=\"l1\")estimator.fit(x_train, y_train)# å¾—å‡ºæ¨¡å‹print(\"æ¢¯åº¦ä¸‹é™-æƒé‡ç³»æ•°ä¸ºï¼š\\n\", estimator.coef_)print(\"æ¢¯åº¦ä¸‹é™-åç½®ä¸ºï¼š\\n\", estimator.intercept_)# æ¨¡å‹è¯„ä¼°y_predict = estimator.predict(x_test)print(\"é¢„æµ‹æˆ¿ä»·ï¼š\\n\", y_predict)error = mean_squared_error(y_test, y_predict)print(\"æ¢¯åº¦ä¸‹é™-å‡æ–¹è¯¯å·®ä¸ºï¼š\\n\", error) å²­å›å½’ å¸¦æœ‰ L2 æ­£åˆ™åŒ–çš„çº¿æ€§å›å½’ï¼šå²­å›å½’ 12345678910111213141516171819202122232425262728293031from sklearn.datasets import load_bostonfrom sklearn.model_selection import train_test_splitfrom sklearn.preprocessing import StandardScalerfrom sklearn.linear_model import Ridgefrom sklearn.metrics import mean_squared_error# æ¢¯åº¦ä¸‹é™çš„ä¼˜åŒ–æ–¹æ³•å¯¹æ³¢å£«é¡¿æˆ¿ä»·è¿›è¡Œé¢„æµ‹# è·å–æ•°æ®boston = load_boston()# åˆ’åˆ†æ•°æ®é›†x_train, x_test, y_train, y_test = train_test_split(boston.data, boston.target, random_state=22)# æ ‡å‡†åŒ–transfer = StandardScaler()x_train = transfer.fit_transform(x_train)x_test = transfer.transform(x_test)# é¢„ä¼°å™¨estimator = Ridge(alpha=0.5, max_iter=10000)estimator.fit(x_train, y_train)# å¾—å‡ºæ¨¡å‹print(\"å²­å›å½’-æƒé‡ç³»æ•°ä¸ºï¼š\\n\", estimator.coef_)print(\"å²­å›å½’-åç½®ä¸ºï¼š\\n\", estimator.intercept_)# æ¨¡å‹è¯„ä¼°y_predict = estimator.predict(x_test)print(\"é¢„æµ‹æˆ¿ä»·ï¼š\\n\", y_predict)error = mean_squared_error(y_test, y_predict)print(\"å²­å›å½’-å‡æ–¹è¯¯å·®ä¸ºï¼š\\n\", error) é€»è¾‘å›å½’ é€»è¾‘å›å½’ï¼ˆLogistic Regressionï¼‰æ˜¯ä¸€ç§ç”¨äºè§£å†³äºŒåˆ†ç±»ï¼ˆ0 or 1ï¼‰é—®é¢˜çš„æœºå™¨å­¦ä¹ æ–¹æ³•ï¼Œç”¨äºä¼°è®¡æŸç§äº‹ç‰©çš„å¯èƒ½æ€§ã€‚ ç²¾ç¡®ç‡ Precision å³ï¼ŒæŸ¥çš„å‡†ä¸å‡†ã€‚ å¬å›ç‡ Recall å³ï¼ŒæŸ¥çš„å…¨ä¸å…¨ã€‚ F1-score æ¨¡å‹çš„ç¨³å¥æ€§ã€‚ æ¡ˆä¾‹åˆ†æï¼šè‚¿ç˜¤é¢„æµ‹12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455import pandas as pdimport numpy as np# è¯»å–æ•°æ®path = \"https://archive.ics.uci.edu/ml/machine-learning-databases/breast-cancer-wisconsin/breast-cancer-wisconsin.data\"column_name = ['Sample code number', 'Clump Thickness', 'Uniformity of Cell Size', 'Uniformity of Cell Shape', 'Marginal Adhesion', 'Single Epithelial Cell Size', 'Bare Nuclei', 'Bland Chromatin', 'Normal Nucleoli', 'Mitoses', 'Class']data = pd.read_csv(path, names=column_name)# ç¼ºå¤±å€¼å¤„ç†# æ›¿æ¢ ã€‹ np.nandata = data.replace(to_replace=\"?\", value=np.nan)# åˆ é™¤ç¼ºå¤±æ ·æœ¬data.dropna(inplace=True)# æ£€æŸ¥æ˜¯å¦è¿˜å­˜åœ¨ç¼ºå¤±å€¼data.isnull().any()# åˆ’åˆ†æ•°æ®é›†from sklearn.model_selection import train_test_split# ç­›é€‰ç‰¹å¾å€¼å’Œç›®æ ‡å€¼x = data.iloc[:, 1:-1]y = data[\"Class\"]x_train, x_test, y_train, y_test = train_test_split(x, y, random_state=0)# æ ‡å‡†åŒ–from sklearn.preprocessing import StandardScalertransfer = StandardScaler()x_train = transfer.fit_transform(x_train)x_test = transfer.transform(x_test)# é€»è¾‘å›å½’é¢„æµ‹from sklearn.linear_model import LogisticRegressionestimator = LogisticRegression()estimator.fit(x_train, y_train)# é€»è¾‘å›å½’çš„æ¨¡å‹å‚æ•°ï¼šå›å½’ç³»æ•°å’Œåç½®print(\"é€»è¾‘å›å½’-å›å½’ç³»æ•°ï¼š\", estimator.coef_, \"é€»è¾‘å›å½’-åç½®ï¼š\" , estimator.intercept_)y_predict = estimator.predict(x_test)print(\"y_predict:\\n\", y_predict)print(\"ç›´æ¥æ¯”å¯¹çœŸå®å€¼å’Œé¢„æµ‹å€¼:\\n\", y_test == y_predict)score = estimator.score(x_test, y_test)print(\"å‡†ç¡®ç‡ä¸ºï¼š\\n\", score)# æŸ¥çœ‹ç²¾ç¡®ç‡ã€å¬å›ç‡ã€F1-scorefrom sklearn.metrics import classification_reportreport = classification_report(y_test, y_predict, target_names=[\"è‰¯æ€§\", \"æ¶æ€§\"])# y_trueï¼šæ¯ä¸ªæ ·æœ¬çš„çœŸå®ç±»åˆ«ï¼Œå¿…é¡»ä¸º 0 åï¼Œ1 æ­£æ ‡è®°# å°† y_test è½¬æ¢æˆ 0 1y_true = np.where(y_test &gt; 3, 1, 0)from sklearn.metrics import roc_auc_scoreroc_auc_score(y_true, y_predict) K-means æ— ç›‘ç£ç®—æ³•ã€‚ è´­ç‰©è½¦æ¡ˆä¾‹123456789101112# é¢„ä¼°å™¨æµç¨‹from sklearn.cluster import KMeansestimator &#x3D; KMeans(n_clusters&#x3D;3)estimator.fit(data_new)y_predict &#x3D; estimator.predict(data_new)y_predict[:300]# æ¨¡å‹è¯„ä¼°-è½®å»“ç³»æ•°from sklearn.metrics import silhouette_scoresilhouette_score(data_new, y_predict)","categories":[{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","permalink":"http://yoursite.com/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"}],"tags":[{"name":"sklearn","slug":"sklearn","permalink":"http://yoursite.com/tags/sklearn/"}]},{"title":"RabbitMQ åˆæ­¥ä½¿ç”¨","slug":"åå°æŠ€æœ¯/RabbitMQ åˆæ­¥ä½¿ç”¨","date":"2020-04-20T06:02:25.000Z","updated":"2020-07-10T04:15:16.053Z","comments":true,"path":"2020/04/20/åå°æŠ€æœ¯/RabbitMQ åˆæ­¥ä½¿ç”¨/","link":"","permalink":"http://yoursite.com/2020/04/20/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/RabbitMQ%20%E5%88%9D%E6%AD%A5%E4%BD%BF%E7%94%A8/","excerpt":"RabbitMQ çš„ç®€å•ä»‹ç»åŠé¡¹ç›®ä½¿ç”¨ã€‚","text":"RabbitMQ çš„ç®€å•ä»‹ç»åŠé¡¹ç›®ä½¿ç”¨ã€‚ åœ¨è™šæ‹Ÿæœºä¸­åŸºäº Docker å®‰è£… RabbitMQ é•œåƒï¼Œå¯åŠ¨é•œåƒå¹¶æš´éœ²å…¶ç«¯å£ã€‚ 1docker run -d -p 5672:5672 -p 15672:15672 --hostname my_rabbitmq --name rabbitmq rabbitmq:management è®¿é—® [è™šæ‹Ÿæœº IP]:15672 è¿›å…¥ RabbitMQ çš„æ§åˆ¶å°é¡µé¢ï¼Œé»˜è®¤è´¦å·å¯†ç çš†ä¸º guestã€‚ åŸºæœ¬æ¦‚å¿µ é«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼Œå³ Advanced Message Queuing Protocolï¼ˆAMQPï¼‰æ˜¯é¢å‘æ¶ˆæ¯ä¸­é—´ä»¶æä¾›çš„å¼€æ”¾çš„åº”ç”¨å±‚åè®®ï¼Œå…¶è®¾è®¡ç›®æ ‡æ˜¯å¯¹äºæ¶ˆæ¯çš„æ’åºã€è·¯ç”±ï¼ˆåŒ…æ‹¬ç‚¹å¯¹ç‚¹å’Œè®¢é˜…-å‘å¸ƒï¼‰ã€ä¿æŒå¯é æ€§ã€ä¿è¯å®‰å…¨æ€§ã€‚ RabbitMQ å®ç°äº† AMQPã€‚ RabbitMQ çš„åŸºæœ¬ä½¿ç”¨æµç¨‹ï¼š å®¢æˆ·ç«¯è¿æ¥åˆ°æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡å™¨ï¼Œæ‰“å¼€ä¸€ä¸ª channelï¼›å®¢æˆ·ç«¯å£°æ˜ä¸€ä¸ª exchangeï¼Œå¹¶è®¾ç½®ç›¸å…³å±æ€§ï¼›å®¢æˆ·ç«¯å£°æ˜ä¸€ä¸ª queueï¼Œå¹¶è®¾ç½®ç›¸å…³å±æ€§ï¼›å®¢æˆ·ç«¯ä½¿ç”¨ routing keyï¼Œåœ¨ exchange å’Œ queue ä¹‹é—´å»ºç«‹å¥½ç»‘å®šå…³ç³»ï¼›å®¢æˆ·ç«¯æŠ•é€’æ¶ˆæ¯åˆ° exchangeã€‚ Brokerï¼šç®€å•æ¥è¯´å°±æ˜¯æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡å™¨å®ä½“ã€‚Exchangeï¼šæ¶ˆæ¯äº¤æ¢æœºï¼Œå®ƒæŒ‡å®šæ¶ˆæ¯æŒ‰ä»€ä¹ˆè§„åˆ™ï¼Œè·¯ç”±åˆ°å“ªä¸ªé˜Ÿåˆ—ã€‚Queueï¼šæ¶ˆæ¯é˜Ÿåˆ—è½½ä½“ï¼Œæ¯ä¸ªæ¶ˆæ¯éƒ½ä¼šè¢«æŠ•å…¥åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªé˜Ÿåˆ—ã€‚Bindingï¼šç»‘å®šï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯æŠŠ exchange å’Œ queue æŒ‰ç…§è·¯ç”±è§„åˆ™ç»‘å®šèµ·æ¥ã€‚Routing Keyï¼šè·¯ç”±å…³é”®å­—ï¼Œexchange æ ¹æ®è¿™ä¸ªå…³é”®å­—è¿›è¡Œæ¶ˆæ¯æŠ•é€’ã€‚vhostï¼šè™šæ‹Ÿä¸»æœºï¼Œä¸€ä¸ª broker é‡Œå¯ä»¥å¼€è®¾å¤šä¸ª vhostï¼Œç”¨ä½œä¸åŒç”¨æˆ·çš„æƒé™åˆ†ç¦»ã€‚producerï¼šæ¶ˆæ¯ç”Ÿäº§è€…ï¼Œå°±æ˜¯æŠ•é€’æ¶ˆæ¯çš„ç¨‹åºã€‚consumerï¼šæ¶ˆæ¯æ¶ˆè´¹è€…ï¼Œå°±æ˜¯æ¥å—æ¶ˆæ¯çš„ç¨‹åºã€‚channelï¼šæ¶ˆæ¯é€šé“ï¼Œåœ¨å®¢æˆ·ç«¯çš„æ¯ä¸ªè¿æ¥é‡Œï¼Œå¯å»ºç«‹å¤šä¸ª channelï¼Œæ¯ä¸ª channel ä»£è¡¨ä¸€ä¸ªä¼šè¯ä»»åŠ¡ã€‚ ç®€å•ç¤ºä¾‹ ç¼–å†™ä¸€ä¸ªåŸºæœ¬çš„ consumer ä»¥åŠ provider è¿›è¡Œæ¶ˆæ¯çš„æ¥å—ä¸æŠ•é€’ã€‚ simple-consumer ç¼–å†™ä¸€ä¸ªç®€å•çš„æ¶ˆè´¹è€…è¿æ¥åˆ° RabbitMQï¼Œå¹¶ä¸”åˆå§‹åŒ–æ‰€éœ€çš„ Exchangeã€Queueã€Routing Keyã€Binding ç­‰ã€‚ 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-amqp&lt;/artifactId&gt;&lt;/dependency&gt; 123456789spring.rabbitmq.addresses=192.168.31.100:5672spring.rabbitmq.username=guestspring.rabbitmq.password=guestspring.rabbitmq.virtual-host=/spring.rabbitmq.connection-timeout=15000spring.rabbitmq.listener.simple.acknowledge-mode=manualspring.rabbitmq.listener.simple.concurrency=5spring.rabbitmq.listener.simple.max-concurrency=10 Receiver é€šè¿‡ @RabbitListenerè¿›è¡Œåˆå§‹åŒ–å¹¶ç»‘å®šï¼šå¯åœ¨é…ç½®æ–‡ä»¶ä¸­ç¼–å†™åé€šè¿‡${xxx.xxx...}è¿›è¡Œå–å€¼ã€‚ ï¼ï¼ï¼æ³¨æ„ï¼ï¼ï¼æ­¤å¤„çš„ Order ç±»ä¾èµ–äº provider æ¨¡å—çš„ Order ç±»ã€‚ 12345678910111213141516171819202122@Componentpublic class RabbitReceiver &#123; @RabbitListener( bindings = @QueueBinding( value = @Queue(value = \"queue-1\", durable=\"true\"), exchange = @Exchange(value = \"exchange-1\", durable = \"true\", type = \"topic\", ignoreDeclarationExceptions = \"true\"), key = \"springboot.*\" ) ) @RabbitHandler public void onOrderMessage(@Payload Order order, Channel channel, @Headers Map&lt;String, Object&gt; headers) throws Exception &#123; System.err.println(\"--------------------------------------\"); System.err.println(\"æ¶ˆè´¹ç«¯ Order: \" + order.getId()); Long deliveryTag = (Long)headers.get(AmqpHeaders.DELIVERY_TAG); //æ‰‹å·¥ACK channel.basicAck(deliveryTag, false); &#125;&#125; è¿è¡Œé¡¹ç›®ã€‚ æç¤ºï¼šè¿æ¥æˆåŠŸã€‚æ‰“å¼€ RabbitMQ æ§åˆ¶å°ã€‚ å¯ä»¥çœ‹åˆ°æœ‰ä¸€æ¡æ¥è‡ªæœ¬åœ°ç«¯å£ 9371 çš„è¿æ¥ã€‚ æŸ¥çœ‹ Exchange å¯ä»¥çœ‹åˆ°å®¢æˆ·ç«¯æ‰€ç»‘å®šçš„è§„åˆ™å·²ç»è¢«è‡ªåŠ¨åˆå§‹åŒ–ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥é€‰æ‹©æ‰‹å·¥ç»‘å®šï¼‰ simple-provider ç¼–å†™ä¸€ä¸ªç®€å•çš„æä¾›è€…è¿æ¥åˆ° RabbitMQï¼Œå¹¶å‘é€æ¶ˆæ¯åˆ°å¯¹åº”çš„é˜Ÿåˆ—ä¸­ã€‚ 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-amqp&lt;/artifactId&gt;&lt;/dependency&gt; 12345678910spring.rabbitmq.addresses=192.168.31.100:5672spring.rabbitmq.username=guestspring.rabbitmq.password=guestspring.rabbitmq.virtual-host=/spring.rabbitmq.connection-timeout=15000# å¯ç”¨å›è°ƒspring.rabbitmq.publisher-confirm-type=correlatedspring.rabbitmq.publisher-returns=truespring.rabbitmq.template.mandatory=true æ–°å»ºä¸€ä¸ªå®ä½“å¯¹è±¡ç”¨äºå‘é€ã€‚ 12345678910public class Order implements Serializable &#123; private static final long serialVersionUID = -3603050220195298978L; private String id; private String name; // ...&#125; Sender ç¼–å†™å‘é€æ–¹æ³•ï¼Œå¹¶è‡ªå®šä¹‰å›è°ƒå½¢å¼ã€‚ 12345678910111213141516171819202122232425262728293031323334353637@Componentpublic class RabbitSender &#123; @Autowired private RabbitTemplate rabbitTemplate; // å›è°ƒå‡½æ•°: confirm ç¡®è®¤ final RabbitTemplate.ConfirmCallback confirmCallback = new RabbitTemplate.ConfirmCallback() &#123; @Override public void confirm(CorrelationData correlationData, boolean ack, String cause) &#123; System.err.println(\"correlationData: \" + correlationData); System.err.println(\"ack: \" + ack); if(!ack)&#123; System.err.println(\"å¼‚å¸¸å¤„ç†....\"); &#125; &#125; &#125;; // å›è°ƒå‡½æ•°: return è¿”å› final RabbitTemplate.ReturnCallback returnCallback = new RabbitTemplate.ReturnCallback() &#123; @Override public void returnedMessage(org.springframework.amqp.core.Message message, int replyCode, String replyText, String exchange, String routingKey) &#123; System.err.println(\"return exchange: \" + exchange + \", routingKey: \" + routingKey + \", replyCode: \" + replyCode + \", replyText: \" + replyText); &#125; &#125;; // å‘é€æ¶ˆæ¯æ–¹æ³•è°ƒç”¨: æ„å»ºè‡ªå®šä¹‰å¯¹è±¡æ¶ˆæ¯ public void sendOrder(Order order) throws Exception &#123; rabbitTemplate.setConfirmCallback(confirmCallback); rabbitTemplate.setReturnCallback(returnCallback); // id + æ—¶é—´æˆ³ å…¨å±€å”¯ä¸€ CorrelationData correlationData = new CorrelationData(\"987654321\"); rabbitTemplate.convertAndSend(\"exchange-1\", \"springboot.order\", order, correlationData); &#125;&#125; ç¼–å†™æµ‹è¯•æ–¹æ³•è¿›è¡Œæµ‹è¯•ã€‚ 12345678910111213@RunWith(SpringRunner.class)@SpringBootTestclass SimpleProviderApplicationTests &#123; @Autowired private RabbitSender rabbitSender; @Test public void testSender() throws Exception &#123; Order order = new Order(\"001\", \"ç¬¬ä¸€ä¸ªè®¢å•\"); rabbitSender.sendOrder(order); &#125;&#125; æ§åˆ¶å°æ‰“å°äº†äº†è‡ªå®šä¹‰å›è°ƒçš„ç¡®è®¤ä¿¡æ¯ã€‚ RabbitMQ æ§åˆ¶å°å¯ä»¥æŸ¥çœ‹åˆ°å‘é€çš„æ¶ˆæ¯çš„è¯¦ç»†ä¿¡æ¯ã€‚ å¯åŠ¨æ¶ˆè´¹è€…åï¼Œæ¶ˆè´¹è€…ç›‘å¬åˆ°é˜Ÿåˆ—ä¸­æœ‰æ¶ˆæ¯å¹¶äº†è¿›è¡Œæ¶ˆè´¹ã€‚ å¯é äº¤ä»˜ å¯é äº¤ä»˜å³å°† RabbitMQ å¤„ç†è®¢å•çš„çŠ¶æ€æŒä¹…åŒ–åˆ°æ•°æ®åº“ä¸­ï¼Œå¹¶æ ¹æ®æ­¤çŠ¶æ€è¡¨å¯¹ä¸åŒçŠ¶æ€çš„äº¤ä»˜ä»»åŠ¡è¿›è¡Œå¤„ç†ï¼š 1ï¼‰åœ¨è¾¾åˆ°è§„å®šçš„æœ€å¤§é‡è¯•æ¬¡æ•°ä¹‹å‰ï¼Œå®šæ—¶ä»»åŠ¡åœ¨è§„å®šçš„æ—¶é—´é—´éš”è‡ªåŠ¨è¿›è¡Œä»»åŠ¡çš„é‡æ–°äº¤ä»˜ï¼›2ï¼‰ä»»åŠ¡è¾¾åˆ°äº†æœ€å¤§çš„é‡è¯•æ¬¡æ•°åï¼Œä¸ºé¿å…æµªè´¹èµ„æºå°†å…¶çŠ¶æ€æ›´æ–°ä¸ºå¤±è´¥ï¼Œä¹‹åäººå·¥å¤„ç†ã€‚ 12345678910111213141516171819-- è¡¨ my_order è®¢å•ç»“æ„CREATE TABLE IF NOT EXISTS `my_order` ( `id` varchar(128) NOT NULL, -- è®¢å• ID `name` varchar(128), -- è®¢å•åç§° å…¶ä»–ä¸šåŠ¡ç†Ÿæ‚‰å¿½ç•¥ `message_id` varchar(128) NOT NULL, -- æ¶ˆæ¯å”¯ä¸€ ID PRIMARY KEY (`id`)) ENGINE=InnoDB DEFAULT CHARSET=utf8;-- è¡¨ log æ¶ˆæ¯è®°å½•ç»“æ„CREATE TABLE IF NOT EXISTS `log` ( `message_id` varchar(128) NOT NULL, -- æ¶ˆæ¯å”¯ä¸€ ID `message` varchar(4000) DEFAULT NULL, -- æ¶ˆæ¯å†…å®¹ `try_count` int(4) DEFAULT '0', -- é‡è¯•æ¬¡æ•° `status` varchar(10) DEFAULT '', -- æ¶ˆæ¯æŠ•é€’çŠ¶æ€ï¼š0 æŠ•é€’ä¸­ 1 æŠ•é€’æˆåŠŸ 2 æŠ•é€’å¤±è´¥ `next_retry` timestamp NOT NULL DEFAULT '0000-00-00 00:00:00', -- ä¸‹ä¸€æ¬¡é‡è¯•æ—¶é—´ `create_time` timestamp NOT NULL DEFAULT '0000-00-00 00:00:00', -- åˆ›å»ºæ—¶é—´ `update_time` timestamp NOT NULL DEFAULT '0000-00-00 00:00:00', -- æ›´æ–°æ—¶é—´ PRIMARY KEY (`message_id`)) ENGINE=InnoDB DEFAULT CHARSET=utf8; é¡¹ç›®ä¾èµ–1234567891011121314151617181920212223242526272829303132333435363738394041424344&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;&lt;/dependency&gt;&lt;!-- RabbitMQ --&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-amqp&lt;/artifactId&gt;&lt;/dependency&gt;&lt;!-- mybatis-plus --&gt;&lt;dependency&gt; &lt;groupId&gt;com.baomidou&lt;/groupId&gt; &lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt; &lt;version&gt;3.2.0&lt;/version&gt;&lt;/dependency&gt;&lt;!-- mysqlé©±åŠ¨ --&gt;&lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;!-- å¯åŠ¨å™¨ä¸­é»˜è®¤çš„ç‰ˆæœ¬è¾ƒé«˜ --&gt; &lt;version&gt;5.1.47&lt;/version&gt; &lt;scope&gt;runtime&lt;/scope&gt;&lt;/dependency&gt;&lt;!-- å¸¸ç”¨å·¥å…·ç±» --&gt;&lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;fastjson&lt;/artifactId&gt; &lt;version&gt;1.1.26&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.commons&lt;/groupId&gt; &lt;artifactId&gt;commons-lang3&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;commons-io&lt;/groupId&gt; &lt;artifactId&gt;commons-io&lt;/artifactId&gt; &lt;version&gt;2.4&lt;/version&gt;&lt;/dependency&gt;&lt;!-- Lombok --&gt;&lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;version&gt;1.18.12&lt;/version&gt;&lt;/dependency&gt; 12345678910111213141516171819## é…ç½®æ•°æ®æºspring.datasource.username=rootspring.datasource.password=123456spring.datasource.url=jdbc:mysql://localhost:3306/rabbitmq_test?useSSL=falsespring.datasource.driver-class-name=com.mysql.jdbc.Driver# æ‰“å° SQL è¯­å¥#mybatis-plus.configuration.log-impl=org.apache.ibatis.logging.stdout.StdOutImplmybatis-plus.mapper-locations=classpath:/mapper/*.xml## RabbitMQspring.rabbitmq.addresses=192.168.31.100:5672spring.rabbitmq.username=guestspring.rabbitmq.password=guestspring.rabbitmq.virtual-host=/spring.rabbitmq.connection-timeout=15000# å›è°ƒé…ç½®spring.rabbitmq.publisher-confirm-type=correlatedspring.rabbitmq.publisher-returns=truespring.rabbitmq.template.mandatory=true æ–°å»ºä¸€ä¸ª rabbitmq-entity æ¨¡å—ï¼Œç¼–å†™ä¼ è¾“å®ä½“ç±»ã€‚ 12345678910public class Order implements Serializable &#123; private static final long serialVersionUID = 2584584237793643231L; private String id; private String name; private String messageId; //...&#125; æ–°å»ºä¸€ä¸ª stable-provider æ¨¡å—ï¼Œç¼–å†™å¯é çš„äº¤ä»˜è€…ã€‚ ç¼–å†™çŠ¶æ€çš„å®ä½“ç±»ï¼Œä»¥åŠå¸¸é‡ç±» 12345678910111213@Datapublic class Log implements Serializable &#123; private static final long serialVersionUID = -8716210355448974538L; private String messageId; private String message; private Integer tryCount = 0; private String status; private Date nextRetry; private Date createTime; private Date updateTime;&#125; 1234567891011121314151617public class Constant &#123; private Constant() &#123; throw new IllegalStateException(\"Utility class\"); &#125; /** è®¢å•çŠ¶æ€ 0 è¡¨ç¤ºå¾…å‘é€ */ public static final String ORDER_SENDING = \"0\"; /** è®¢å•çŠ¶æ€ 1 è¡¨ç¤ºå‘é€æˆåŠŸ */ public static final String ORDER_SEND_SUCCESS = \"1\"; /** è®¢å•çŠ¶æ€ 2 è¡¨ç¤ºå‘é€å¤±è´¥ */ public static final String ORDER_SEND_FAILURE = \"2\"; /** è®¢å•è¶…æ—¶æ—¶é—´ï¼Œå³ä¸€åˆ†é’Ÿåè®¢å•è¿›è¡Œäº¤ä»˜é‡è¯• */ public static final Integer ORDER_TIMEOUT = 1; /** è®¢å•æœ€å¤§é‡è¯•æ¬¡æ•° */ public static final Integer ORDER_RETRY_MAX_TIMES = 3;&#125; ç¼–å†™ Mapperã€‚ 1234567891011121314151617181920212223242526@Componentpublic interface LogMapper extends BaseMapper&lt;Log&gt; &#123; /** * æ›´æ–°æœ€ç»ˆæ¶ˆæ¯å‘é€ç»“æœ æˆåŠŸ or å¤±è´¥ * @param messageId æ¶ˆæ¯çš„å”¯ä¸€ ID * @param status è®¢å•çŠ¶æ€ * @param updateTime è®¢å•çŠ¶æ€æ›´æ–°æ—¶é—´ */ void changeBrokerMessageLogStatus(@Param(\"messageId\") String messageId , @Param(\"status\") String status , @Param(\"updateTime\") Date updateTime ); /** * æŸ¥è¯¢æ¶ˆæ¯çŠ¶æ€ä¸º 0 ä¸”å·²ç»è¶…æ—¶çš„æ¶ˆæ¯é›†åˆ * @return ç¬¦åˆæ¡ä»¶çš„è®¢å•é›†åˆ */ List&lt;Log&gt; query4StatusAndTimeoutMessage(); /** * @param messageId æ¶ˆæ¯çš„å”¯ä¸€ ID * @param date æ—¶é—´ */ void update4ReSend(@Param(\"messageId\") String messageId, @Param(\"updateTime\") Date date);&#125; 12345678910// Order ä¸º SQL å…³é”®å­—ï¼Œå¹¶ä¸”åªæœ‰ä¸€ä¸ªæ’å…¥æ–¹æ³•ï¼Œæ•…å®Œå…¨ä½¿ç”¨è‡ªå®šä¹‰æ–¹æ³•ä¸ç»§æ‰¿@Componentpublic interface OrderMapper&#123; /** * @param order è®¢å• */ void insert(Order order);&#125; 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;!DOCTYPE mapper PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"&gt;&lt;mapper namespace=\"com.wingo.stableprovider.mapper.LogMapper\"&gt; &lt;!-- é€šç”¨æŸ¥è¯¢æ˜ å°„ç»“æœ --&gt; &lt;resultMap id=\"BaseResultMap\" type=\"com.wingo.stableprovider.entity.Log\"&gt; &lt;id column=\"message_id\" property=\"messageId\" jdbcType=\"VARCHAR\" /&gt; &lt;result column=\"message\" property=\"message\" jdbcType=\"VARCHAR\" /&gt; &lt;result column=\"try_count\" property=\"tryCount\" jdbcType=\"INTEGER\" /&gt; &lt;result column=\"status\" property=\"status\" jdbcType=\"VARCHAR\" /&gt; &lt;result column=\"next_retry\" property=\"nextRetry\" jdbcType=\"TIMESTAMP\" /&gt; &lt;result column=\"create_time\" property=\"createTime\" jdbcType=\"TIMESTAMP\" /&gt; &lt;result column=\"update_time\" property=\"updateTime\" jdbcType=\"TIMESTAMP\" /&gt; &lt;/resultMap&gt; &lt;!-- é€šç”¨æŸ¥è¯¢ç»“æœåˆ— --&gt; &lt;sql id=\"Base_Column_List\"&gt; message_id, message, try_count, status, next_retry, create_time, update_time &lt;/sql&gt; &lt;update id=\"changeBrokerMessageLogStatus\" &gt; UPDATE log SET status = #&#123;status&#125;, update_time = #&#123;updateTime&#125; WHERE message_id = #&#123;messageId&#125; &lt;/update&gt; &lt;select id=\"query4StatusAndTimeoutMessage\" resultMap=\"BaseResultMap\"&gt; SELECT &lt;include refid=\"Base_Column_List\" /&gt; FROM log WHERE status = '0' AND next_retry &lt;![CDATA[ &lt;= ]]&gt; sysdate() &lt;/select&gt; &lt;update id=\"update4ReSend\" &gt; UPDATE log SET try_count = try_count + 1, update_time = #&#123;updateTime&#125; WHERE message_id = #&#123;messageId&#125; &lt;/update&gt;&lt;/mapper&gt; 1234567891011121314151617181920212223&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;!DOCTYPE mapper PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"&gt;&lt;mapper namespace=\"com.wingo.stableprovider.mapper.OrderMapper\"&gt; &lt;!-- é€šç”¨æŸ¥è¯¢æ˜ å°„ç»“æœ --&gt; &lt;resultMap id=\"BaseResultMap\" type=\"com.wingo.entity.Order\"&gt; &lt;id column=\"id\" property=\"id\" jdbcType=\"VARCHAR\" /&gt; &lt;result column=\"name\" property=\"name\" jdbcType=\"VARCHAR\" /&gt; &lt;result column=\"message_id\" property=\"messageId\" jdbcType=\"VARCHAR\" /&gt; &lt;/resultMap&gt; &lt;!-- é€šç”¨æŸ¥è¯¢ç»“æœåˆ— --&gt; &lt;sql id=\"Base_Column_List\"&gt; id, name, message_id &lt;/sql&gt; &lt;insert id=\"insert\" parameterType=\"com.wingo.entity.Order\" &gt; INSERT INTO my_order (id, name, message_id) VALUES (#&#123;id&#125;, #&#123;name&#125;, #&#123;messageId&#125;) &lt;/insert&gt;&lt;/mapper&gt; ç¼–å†™ä¸€ä¸ªæœåŠ¡ç”¨äºå‘æ•°æ®åº“åˆå§‹åŒ–è®¢å•æ•°æ®ä»¥åŠæ¶ˆæ¯çŠ¶æ€ä¿¡æ¯ã€‚ 123456789101112131415161718192021222324252627282930313233@Servicepublic class OrderService &#123; @Autowired private OrderMapper orderMapper; @Autowired private LogMapper logMapper; @Autowired private OrderSender orderSender; public void createOrder(Order order) throws Exception &#123; // æ•°æ®åº“æ’å…¥è®¢å•ä¿¡æ¯ orderMapper.insert(order); // åˆå§‹åŒ–æ—¥å¿—ä¿¡æ¯ Log log = new Log(); Date orderTime = new Date(); log.setMessageId(order.getMessageId()); // å°†è®¢å•è½¬ä¸º JSON å­—ç¬¦ä¸²åœ¨é‡æ–°å‘é€æ—¶ä½¿ç”¨ String jOrder = JSON.toJSONString(order); log.setMessage(jOrder); log.setStatus(\"0\"); log.setNextRetry(DateUtils.addMinutes(orderTime, Constant.ORDER_TIMEOUT)); log.setCreateTime(new Date()); log.setUpdateTime(new Date()); // æ•°æ®åº“æ’å…¥æ—¥å¿—ä¿¡æ¯ logMapper.insert(log); // order message sender orderSender.sendOrder(order); &#125;&#125; Sender ç¼–å†™ RabbitMQ çš„äº¤ä»˜ç±»ã€‚ 12345678910111213141516171819202122232425262728293031323334@Componentpublic class OrderSender &#123; @Autowired private RabbitTemplate rabbitTemplate; @Autowired private LogMapper logMapper; // å›è°ƒå‡½æ•°: confirm ç¡®è®¤ final RabbitTemplate.ConfirmCallback confirmCallback = new RabbitTemplate.ConfirmCallback() &#123; @Override public void confirm(CorrelationData correlationData, boolean ack, String cause) &#123; System.err.println(\"correlationData: \" + correlationData); String messageId = correlationData.getId(); if(ack)&#123; // å¦‚æœ confirm è¿”å›æˆåŠŸï¼Œåˆ™å¯¹ Order è¡¨ä¸­å¯¹åº”çš„è®¢å•çŠ¶æ€è¿›è¡Œæ›´æ–° logMapper.changeBrokerMessageLogStatus(messageId, Constant.ORDER_SEND_SUCCESS, new Date()); &#125; else &#123; // å¤±è´¥åˆ™è¿›è¡Œå…·ä½“çš„åç»­æ“ä½œï¼šé‡è¯•æˆ–è€…è¡¥å¿ç­‰æ‰‹æ®µ System.err.println(\"å¼‚å¸¸å¤„ç†...\"); &#125; &#125; &#125;; // å‘é€æ¶ˆæ¯æ–¹æ³•è°ƒç”¨: æ„å»ºè‡ªå®šä¹‰å¯¹è±¡æ¶ˆæ¯ public void sendOrder(Order order) throws Exception &#123; // è®¾ç½®è‡ªå®šä¹‰å›è°ƒæ–¹æ³• rabbitTemplate.setConfirmCallback(confirmCallback); // æ¶ˆæ¯å”¯ä¸€ ID CorrelationData correlationData = new CorrelationData(order.getMessageId()); rabbitTemplate.convertAndSend(\"order-exchange\", \"order.stable\", order, correlationData); &#125;&#125; Task ç¼–å†™å®šæ—¶ä»»åŠ¡ï¼Œå®šæœŸå¯¹æ•°æ®åº“ä¸­çš„ä»»åŠ¡çŠ¶æ€è¿›è¡Œè¯»å–ï¼Œå¯¹é‡è¯•æ»¡è¶³æ¡ä»¶çš„äº¤ä»˜ä»»åŠ¡è¿›è¡Œé‡æ–°å‘é€ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738@Componentpublic class RetryMessage &#123; @Autowired private OrderSender orderSender; @Autowired private LogMapper logMapper; // 3 ç§’åæ‰§è¡Œï¼Œä¹‹åæ¯ 10 ç§’æ‰§è¡Œä¸€æ¬¡ @Scheduled(initialDelay = 3000, fixedDelay = 10000) public void reSend()&#123; System.err.println(\"---------------å®šæ—¶ä»»åŠ¡å¼€å§‹---------------\"); // å–æ•°æ®åº“ä¸­æ‰€æœ‰çš„çŠ¶æ€ä¸º 0 å¹¶ä¸”å·²ç»è¶…æ—¶çš„è®¢å• List&lt;Log&gt; list = logMapper.query4StatusAndTimeoutMessage(); if(list.isEmpty())&#123; System.out.println(\"æ— äº¤ä»˜å¤±è´¥è®¢å•\"); &#125; list.forEach(messageLog -&gt; &#123; if(messageLog.getTryCount() &gt;= Constant.ORDER_RETRY_MAX_TIMES)&#123; // å¦‚æœé‡è¯•æ¬¡æ•°è¶…è¿‡è§„å®šçš„æœ€å¤§æ¬¡æ•°åˆ™è¡¨ç¤ºäº¤ä»˜å¤±è´¥ logMapper.changeBrokerMessageLogStatus(messageLog.getMessageId(), Constant.ORDER_SEND_FAILURE, new Date()); System.out.println(\"æœ‰æ–°çš„äº¤ä»˜å¤±è´¥è®¢å•\"); &#125; else &#123; // å¢åŠ é‡è¯•æ¬¡æ•° logMapper.update4ReSend(messageLog.getMessageId(), new Date()); Order reSendOrder = JSON.parseObject(messageLog.getMessage(), Order.class); try &#123; orderSender.sendOrder(reSendOrder); System.out.println(\"é‡è¯•è®¢å•äº¤ä»˜\"); &#125; catch (Exception e) &#123; e.printStackTrace(); System.err.println(\"-----------å¼‚å¸¸å¤„ç†-----------\"); &#125; &#125; &#125;); // forEach ç»“æŸ &#125;&#125; ä¸»ç±»ä¸Šè¿˜éœ€è¦åŠ ä¸Šå‡ ä¸ªæ³¨è§£ã€‚ 123@MapperScan(\"com.wingo.stableprovider.mapper\")@EnableScheduling@SpringBootApplication äº¤ä»˜å¤±è´¥æ—¶çš„æ§åˆ¶å°æ‰“å°ä¿¡æ¯ã€‚ åºåˆ—åŒ–é”™è¯¯åœºæ™¯ï¼š consumer å’Œ provider æ¨¡å—å„è‡ªæœ‰ä¸€ä¸ªå¯åºåˆ—åŒ–çš„ entity.Order ç±»ï¼› åºåˆ—åŒ–ä¸ååºåˆ—åŒ–æ—¶ï¼Œä¸¤ä¸ª Order è™½ç„¶ä»£ç ç›¸åŒï¼Œä½†åº•å±‚åºåˆ—åŒ–åçš„æ ‡è®°ä¸åŒï¼Œè™šæ‹Ÿæœºä¸ä¼šè®¤ä¸ºå®ƒä»¬æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œå‡ºç°ååºåˆ—åŒ–é”™è¯¯ã€‚ 1Caused by: org.springframework.messaging.converter.MessageConversionException: Cannot convert from è§£å†³æ–¹æ¡ˆï¼š 1ï¼‰consumer å’Œ provider å¼•ç”¨åŒä¸€ä¸ª entity.Order ç±»ï¼› 2ï¼‰åˆ©ç”¨ jackson å·¥å…·è¿›è¡Œè½¬åŒ–ï¼Œä¼ é€’ Json ä¸²ã€‚","categories":[{"name":"åå°æŠ€æœ¯","slug":"åå°æŠ€æœ¯","permalink":"http://yoursite.com/categories/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"RabbitMQ","slug":"RabbitMQ","permalink":"http://yoursite.com/tags/RabbitMQ/"}]},{"title":"Dubbo","slug":"åå°æŠ€æœ¯/Dubbo åˆæ­¥ä½¿ç”¨","date":"2020-04-17T01:50:34.000Z","updated":"2020-07-10T03:04:40.992Z","comments":true,"path":"2020/04/17/åå°æŠ€æœ¯/Dubbo åˆæ­¥ä½¿ç”¨/","link":"","permalink":"http://yoursite.com/2020/04/17/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/Dubbo%20%E5%88%9D%E6%AD%A5%E4%BD%BF%E7%94%A8/","excerpt":"Dubbo + Zookeeper çš„ç®€å•ä»‹ç»ï¼Œä»¥åŠæ•´åˆä½¿ç”¨ã€‚","text":"Dubbo + Zookeeper çš„ç®€å•ä»‹ç»ï¼Œä»¥åŠæ•´åˆä½¿ç”¨ã€‚ Dubbo åˆæ­¥ä½¿ç”¨åŸºç¡€ç†è®ºåº”ç”¨çš„å‘å±•ä¸æ¼”å˜ï¼š å½“ç½‘ç«™æµé‡å¾ˆå°æ—¶ï¼Œåªéœ€ä¸€ä¸ªåº”ç”¨ï¼Œå°†æ‰€æœ‰åŠŸèƒ½éƒ½éƒ¨ç½²åœ¨ä¸€èµ·ï¼Œä»¥å‡å°‘éƒ¨ç½²èŠ‚ç‚¹å’Œæˆæœ¬ã€‚æ­¤æ—¶ï¼Œç”¨äºç®€åŒ–å¢åˆ æ”¹æŸ¥å·¥ä½œé‡çš„æ•°æ®è®¿é—®æ¡†æ¶ï¼ˆORMï¼‰æ˜¯å…³é”®ï¼› å½“è®¿é—®é‡é€æ¸å¢å¤§ï¼Œå•ä¸€åº”ç”¨å¢åŠ æœºå™¨å¸¦æ¥çš„åŠ é€Ÿåº¦è¶Šæ¥è¶Šå°ï¼Œå°†åº”ç”¨æ‹†æˆäº’ä¸ç›¸å¹²çš„å‡ ä¸ªåº”ç”¨ï¼Œä»¥æå‡æ•ˆç‡ã€‚æ­¤æ—¶ï¼Œç”¨äºåŠ é€Ÿå‰ç«¯é¡µé¢å¼€å‘çš„ Web æ¡†æ¶ï¼ˆMVCï¼‰æ˜¯å…³é”®ï¼› å½“å‚ç›´åº”ç”¨è¶Šæ¥è¶Šå¤šï¼Œåº”ç”¨ä¹‹é—´äº¤äº’ä¸å¯é¿å…ï¼Œå°†æ ¸å¿ƒä¸šåŠ¡æŠ½å–å‡ºæ¥ï¼Œä½œä¸ºç‹¬ç«‹çš„æœåŠ¡ï¼Œé€æ¸å½¢æˆç¨³å®šçš„æœåŠ¡ä¸­å¿ƒï¼Œä½¿å‰ç«¯åº”ç”¨èƒ½æ›´å¿«é€Ÿçš„å“åº”å¤šå˜çš„å¸‚åœºéœ€æ±‚ã€‚æ­¤æ—¶ï¼Œç”¨äºæé«˜ä¸šåŠ¡å¤ç”¨åŠæ•´åˆçš„åˆ†å¸ƒå¼æœåŠ¡æ¡†æ¶ï¼ˆRPCï¼‰æ˜¯å…³é”®ï¼› Dubbo æ˜¯ä¸€æ¬¾é«˜æ€§èƒ½ã€è½»é‡çº§çš„å¼€æº Java RPC æ¡†æ¶ï¼Œå®ƒæä¾›äº†ä¸‰å¤§æ ¸å¿ƒèƒ½åŠ›ï¼šé¢å‘æ¥å£çš„è¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼Œæ™ºèƒ½å®¹é”™å’Œè´Ÿè½½å‡è¡¡ï¼Œä»¥åŠæœåŠ¡è‡ªåŠ¨æ³¨å†Œå’Œå‘ç°ã€‚ å½“æœåŠ¡è¶Šæ¥è¶Šå¤šï¼Œå®¹é‡çš„è¯„ä¼°ï¼Œå°æœåŠ¡èµ„æºçš„æµªè´¹ç­‰é—®é¢˜é€æ¸æ˜¾ç°ï¼Œæ­¤æ—¶éœ€å¢åŠ ä¸€ä¸ªè°ƒåº¦ä¸­å¿ƒåŸºäºè®¿é—®å‹åŠ›å®æ—¶ç®¡ç†é›†ç¾¤å®¹é‡ï¼Œæé«˜é›†ç¾¤åˆ©ç”¨ç‡ã€‚æ­¤æ—¶ï¼Œç”¨äºæé«˜æœºå™¨åˆ©ç”¨ç‡çš„èµ„æºè°ƒåº¦å’Œæ²»ç†ä¸­å¿ƒï¼ˆSOAï¼‰å³ Service Oriented Architecture æ˜¯å…³é”®ã€‚ ç¯å¢ƒæ­å»ºJavayum search java-1.8 ï¼ï¼ï¼æ³¨æ„ï¼Œéœ€è¦ä¸‹è½½ä¸¤ä¸ª java-1.8.0-openjdk.x86_64 / java-1.8.0-openjdk-devel.x86_64 yum install ... whereis javaæŸ¥çœ‹ java è·¯å¾„ï¼ˆ/usr/lib/jvm/ï¼‰ ä¿®æ”¹ç¯å¢ƒå˜é‡ï¼švim /etc/profile 123export JAVA_HOME&#x3D;&#x2F;usr&#x2F;lib&#x2F;jvm&#x2F;java-1.8.0-openjdk-...export PATH&#x3D;$JAVA_HOME&#x2F;bin:$PATHexport CLASSPATH&#x3D;.:$JAVA_HOME&#x2F;lib&#x2F;dt.jar:$JAVA_HOME&#x2F;lib&#x2F;tools.jar javacç¯å¢ƒå˜é‡æ˜¯å¦é…ç½®æ­£ç¡® Zookeeperä¸‹è½½ zookeeper ï¼šæ¸…åå¤§å­¦å¼€æºè½¯ä»¶é•œåƒç«™ wget [ä¸‹è½½è¿æ¥]ä¸‹è½½å‹ç¼©åŒ… tar -zxvf zookeeper-x.x.x.tar.gz åœ¨ /usr/local/ ä¸‹æ–°å»º zookeeper ç›®å½•è¿›è¡Œè§£å‹ ä¿®æ”¹ zookeeper é…ç½®æ–‡ä»¶åï¼šzoo_sample.cfg æ”¹ä¸º zoo.cfg é…ç½®ç¯å¢ƒå˜é‡ï¼švi ~/.bash_profile 123export PATHexport ZOOKEEPER_HOME&#x3D;&#x2F;usr&#x2F;local&#x2F;zookeeper&#x2F;zookeeper-3.4.11&#x2F;export PATH&#x3D;$ZOOKEEPER_HOME&#x2F;bin:$PATH å¸¸ç”¨æ“ä½œ 123zkServer.sh start # å¼€å¯ zookeeperjps # æ˜¾ç¤ºå½“å‰æ‰€æœ‰ java è¿›ç¨‹ pidzkServer.sh stop # åœæ­¢ zookeeper dubbo-admin netstat -aon|findstr â€œport-numâ€ æŸ¥çœ‹å ç”¨ç«¯å£çš„ç¨‹åºçš„ PID Dubbo å®˜æ–¹é¡¹ç›®ä¸‹è½½ ä¿®æ”¹ dubbo-admin é¡¹ç›®çš„é…ç½®ï¼ˆï¼ï¼ï¼zookeeper çš„åœ°å€ä¿®æ”¹ä¸ºè‡ªå·±é…ç½®çš„åœ°å€ï¼‰ åœ¨ pom.xml ç›®å½•ä¸‹ï¼šcmd è¾“å…¥å‘½ä»¤mvn clean packageå¯¹é¡¹ç›®è¿›è¡Œæ‰“åŒ… æ‰“åŒ…æˆåŠŸåç”Ÿæˆ target æ–‡ä»¶å¤¹ï¼Œtarget ç›®å½•ä¸‹æœ‰ä¸€ä¸ªå¯æ‰§è¡Œ jar åŒ… java -jar [jara_name]è¿è¡Œé¡¹ç›®ï¼Œè¿è¡ŒæˆåŠŸåæ ¹æ®é…ç½®çš„è·¯å¾„è¿›è¡Œè®¿é—® dubbo-monitorç”Ÿæˆçš„ target æ–‡ä»¶ä¸­æœ‰ä¸€ä¸ªå‹ç¼©åŒ…ï¼Œè§£å‹åçš„ assembly.bin ç›®å½•ä¸­è¿è¡Œ start.bat è„šæœ¬è¿›è¡Œé¡¹ç›®è¿è¡Œ é¡¹ç›®æ¶æ„å…ˆæ¥çœ‹ä¸€å¼ å®˜ç½‘ç»™çš„æ¶æ„å›¾ï¼š èŠ‚ç‚¹ è§’è‰²è¯´æ˜ Provider æš´éœ²æœåŠ¡çš„æœåŠ¡æä¾›æ–¹ Consumer è°ƒç”¨è¿œç¨‹æœåŠ¡çš„æœåŠ¡æ¶ˆè´¹æ–¹ Registry æœåŠ¡æ³¨å†Œä¸å‘ç°çš„æ³¨å†Œä¸­å¿ƒ Monitor ç»Ÿè®¡æœåŠ¡çš„è°ƒç”¨æ¬¡æ•°å’Œè°ƒç”¨æ—¶é—´çš„ç›‘æ§ä¸­å¿ƒ Container æœåŠ¡è¿è¡Œå®¹å™¨ å„èŠ‚ç‚¹é—´çš„è°ƒç”¨å…³ç³»è¯´æ˜ï¼š â€‹ æœåŠ¡å®¹å™¨è´Ÿè´£å¯åŠ¨ï¼ŒåŠ è½½ï¼Œè¿è¡ŒæœåŠ¡æä¾›è€…ã€‚â€‹ æœåŠ¡æä¾›è€…åœ¨å¯åŠ¨æ—¶ï¼Œå‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±æä¾›çš„æœåŠ¡ã€‚â€‹ æœåŠ¡æ¶ˆè´¹è€…åœ¨å¯åŠ¨æ—¶ï¼Œå‘æ³¨å†Œä¸­å¿ƒè®¢é˜…è‡ªå·±æ‰€éœ€çš„æœåŠ¡ã€‚â€‹ æ³¨å†Œä¸­å¿ƒè¿”å›æœåŠ¡æä¾›è€…åœ°å€åˆ—è¡¨ç»™æ¶ˆè´¹è€…ï¼Œå¦‚æœæœ‰å˜æ›´ï¼Œæ³¨å†Œä¸­å¿ƒå°†åŸºäºé•¿è¿æ¥æ¨é€å˜æ›´æ•°æ®ç»™æ¶ˆè´¹è€…ã€‚â€‹ æœåŠ¡æ¶ˆè´¹è€…ï¼Œä»æä¾›è€…åœ°å€åˆ—è¡¨ä¸­ï¼ŒåŸºäºè½¯è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œé€‰ä¸€å°æä¾›è€…è¿›è¡Œè°ƒç”¨ï¼Œå¦‚æœè°ƒç”¨å¤±è´¥ï¼Œå†é€‰å¦ä¸€å°è°ƒç”¨ã€‚â€‹ æœåŠ¡æ¶ˆè´¹è€…å’Œæä¾›è€…ï¼Œåœ¨å†…å­˜ä¸­ç´¯è®¡è°ƒç”¨æ¬¡æ•°å’Œè°ƒç”¨æ—¶é—´ï¼Œå®šæ—¶æ¯åˆ†é’Ÿå‘é€ä¸€æ¬¡ç»Ÿè®¡æ•°æ®åˆ°ç›‘æ§ä¸­å¿ƒã€‚ é¡¹ç›®åˆ›å»ºåŸºäºå¯¹å®˜ç½‘ç»™å‡ºçš„æ¶æ„åˆ†æå¾—çŸ¥æˆ‘ä»¬éœ€è¦ä¸¤ä¸ªè§’è‰²ï¼šæœåŠ¡çš„æä¾›è€…ï¼›æœåŠ¡çš„æ¶ˆè´¹è€…ã€‚ æ¶ˆè´¹è€…åœ¨è‡ªèº«çš„é¡¹ç›®ä¸­å¯ä»¥å¦‚åŒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€èˆ¬è°ƒç”¨æä¾›è€…çš„æ–¹æ³•ï¼›é‚£ä¹ˆæ¶ˆè´¹è€…å’Œæä¾›è€…å¿…é¡»éƒ½å—åˆ°åŒä¸€å¥—æ¥å£çš„è§„èŒƒï¼Œåœ¨ä¸¤ä¸ªé¡¹ç›®ä¸­éƒ½ç¼–å†™æ¥å£æ˜¾å¾—æœ‰äº›ç¹çï¼Œæ‰€ä»¥å¯ä»¥æ–°å»ºä¸€ä¸ª Maven é¡¹ç›®ä¸“é—¨ç”¨äºå®šä¹‰æ¥å£ã€‚ æœ€å¤–å±‚å¥—ä¸€å±‚å£³ï¼Œæ·»åŠ ä¸‰ä¸ª moduleï¼Œå…¶ä¸­å¤–å£³é¡¹ç›®å’Œæä¾›æ¥å£çš„é¡¹ç›®ä¸º Maven é¡¹ç›®å³å¯ã€‚ dubbo-api æ­¤é¡¹ç›®ç”¨äºæä¾›æ¥å£è§„èŒƒï¼Œä¸éœ€è¦æ·»åŠ ä»»ä½•ä¾èµ–ã€‚ç¼–å†™ä¸€ä¸ªå®ä½“ç±»å’Œä¸€ä¸ªæœåŠ¡ç±»æ¥å£å³å¯ã€‚ 1234567891011public class User implements Serializable &#123; private static final long serialVersionUID = 5433406871746033298L; private Integer userId; private String username; private String password; // ...&#125; å®šä¹‰æ¥å£ï¼š 123456789public interface UserService &#123; /** * è·å–ç”¨æˆ·åˆ—è¡¨çš„æ–¹æ³• * * @return ç”¨æˆ·çš„ä¿¡æ¯åˆ—è¡¨ */ List&lt;User&gt; getUserList();&#125; è¦è®© dubbo-consumer ä»¥åŠ dubbo-provider è·å–æ­¤æ¥å£ï¼Œéœ€è¦ç»™è¿™ä¸¤ä¸ªé¡¹ç›®æ·»åŠ  dubbo-api é¡¹ç›®çš„ä¾èµ–ã€‚ 123456&lt;!-- æ·»åŠ è‡ªå®šä¹‰æ¥å£ä¾èµ– --&gt;&lt;dependency&gt; &lt;groupId&gt;com.wingo&lt;/groupId&gt; &lt;artifactId&gt;dubbo-api&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;&lt;/dependency&gt; dubbo-provideræœåŠ¡æä¾›è€…ç¼–å†™äº†æ¥å£çš„å…·ä½“å®ç°æ–¹æ³•ï¼Œå¹¶ä¸”è¦æŠŠå®ç°çš„æ–¹æ³•é€šè¿‡ Dubbo æš´éœ²å‡ºå»ã€‚ 123456&lt;!-- æ·»åŠ  Dubbo ä¾èµ– --&gt;&lt;dependency&gt; &lt;groupId&gt;com.alibaba.boot&lt;/groupId&gt; &lt;artifactId&gt;dubbo-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;0.2.0&lt;/version&gt;&lt;/dependency&gt; Spring ä»¥åŠ Dubbo éƒ½è¦ç®¡ç†è¿™ä¸ªç±»ã€‚ 12345678910@com.alibaba.dubbo.config.annotation.Service@Servicepublic class UserServiceImpl implements UserService &#123; @Override public List&lt;User&gt; getUserList() &#123; User user1 = new User(1,\"wingo\",\"123456\"); User user2 = new User(2,\"admin\",\"654321\"); return Arrays.asList(user1, user2); &#125;&#125; åœ¨ä¸»ç±»ä¸Šæ ‡æ³¨ @EnableDubbo(scanBasePackages = â€œcom.wingo.dubboprovider.serviceâ€)ï¼Œå¹¶æ·»åŠ é…ç½®ã€‚ 12345678910# æ­¤æœåŠ¡çš„åç§°dubbo.application.name=user-service-provider# æ³¨å†Œä¸­å¿ƒçš„åè®®åŠåœ°å€dubbo.registry.address=127.0.0.1:2181dubbo.registry.protocol=zookeeper# æš´éœ²çš„åè®®åŠç«¯å£dubbo.protocol.name=dubbodubbo.protocol.port=20881## æ³¨å†Œä¸­å¿ƒè·å–ç›‘æ§ä¸­å¿ƒçš„ä¿¡æ¯dubbo.monitor.protocol=registry å¯åŠ¨é¡¹ç›®ï¼Œæ¥åˆ° dubbo-admin çš„é¡µé¢æŸ¥çœ‹æœåŠ¡ã€‚ åœ¨ dubbo-admin å¤šäº†ä¸€ä¸ªæˆ‘ä»¬åˆšåˆšæš´éœ²å‡ºæ¥çš„æœåŠ¡ï¼Œç”±åç§°å¯ä»¥å¾—çŸ¥å…¶æš´éœ²çš„æ˜¯ä¸€ä¸ªæ¥å£ã€‚ ç‚¹å‡»æŸ¥çœ‹å…¶å¯¹åº”çš„ IP åœ°å€ä»¥åŠåŸŸåï¼Œæ­£æ˜¯æœ¬æœºçš„ IP ä»¥åŠè‡ªå®šä¹‰çš„æ¥å£ 20881ã€‚ dubbo-monitor ä¸­å¯ä»¥çœ‹åˆ°è¿™ä¸ªåº”ç”¨çš„åç§°æ­£æ˜¯é…ç½®æ–‡ä»¶ä¸­çš„ user-service-providerã€‚ dubbo-consumeræ¶ˆè´¹è€…å‘ dubbo è¯·æ±‚æ‰€éœ€è¦çš„æœåŠ¡ã€‚ 1234567891011@RestControllerpublic class UserController &#123; @Reference UserService userService; @GetMapping(\"/users\") public List&lt;User&gt; userList ()&#123; return userService.getUserList(); &#125;&#125; 12345server.port=8082dubbo.application.name=dubbo-user-consumerdubbo.registry.address=zookeeper://127.0.0.1:2181dubbo.monitor.protocol=registry å¯åŠ¨æ¶ˆè´¹è€…ã€‚ å¯ä»¥çœ‹å‡ºï¼Œæä¾›è€…ä¸æ¶ˆè´¹è€…ç¡®å®æ˜¯é€šè¿‡æ¥å£é€šè®¯çš„ã€‚ æˆåŠŸè¯·æ±‚æ•°æ®ã€‚ Dubbo ç‰¹æ€§ä»‹ç»ä¸€äº› Dubbo çš„ä½¿ç”¨ç‰¹æ€§ã€‚ é«˜å¯ç”¨Zookeeper å®•æœºä¸ Dubbo ç›´è¿ï¼šæ³¨å†Œä¸­å¿ƒå…¨éƒ¨å®•æ‰åï¼ŒæœåŠ¡æä¾›è€…å’ŒæœåŠ¡æ¶ˆè´¹è€…ä»èƒ½é€šè¿‡æœ¬åœ°ç¼“å­˜é€šè®¯ã€‚ é›†ç¾¤è´Ÿè½½å‡è¡¡Random LoadBalanceï¼š éšæœºï¼ŒæŒ‰æƒé‡è®¾ç½®éšæœºæ¦‚ç‡ã€‚åœ¨ä¸€ä¸ªæˆªé¢ä¸Šç¢°æ’çš„æ¦‚ç‡é«˜ï¼Œä½†è°ƒç”¨é‡è¶Šå¤§åˆ†å¸ƒè¶Šå‡åŒ€ï¼Œè€Œä¸”æŒ‰æ¦‚ç‡ä½¿ç”¨æƒé‡åä¹Ÿæ¯”è¾ƒå‡åŒ€ï¼Œæœ‰åˆ©äºåŠ¨æ€è°ƒæ•´æä¾›è€…æƒé‡ã€‚ RoundRobin LoadBalanceï¼š è½®å¾ªï¼ŒæŒ‰å…¬çº¦åçš„æƒé‡è®¾ç½®è½®å¾ªæ¯”ç‡ã€‚å­˜åœ¨æ…¢çš„æä¾›è€…ç´¯ç§¯è¯·æ±‚çš„é—®é¢˜ï¼Œæ¯”å¦‚ï¼šç¬¬äºŒå°æœºå™¨å¾ˆæ…¢ï¼Œä½†æ²¡æŒ‚ï¼Œå½“è¯·æ±‚è°ƒåˆ°ç¬¬äºŒå°æ—¶å°±å¡åœ¨é‚£ï¼Œä¹…è€Œä¹…ä¹‹ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½å¡åœ¨è°ƒåˆ°ç¬¬äºŒå°ä¸Šã€‚ LeastActive LoadBalanceï¼š æœ€å°‘æ´»è·ƒè°ƒç”¨æ•°ï¼Œç›¸åŒæ´»è·ƒæ•°çš„éšæœºï¼Œæ´»è·ƒæ•°æŒ‡è°ƒç”¨å‰åè®¡æ•°å·®ã€‚ä½¿æ…¢çš„æä¾›è€…æ”¶åˆ°æ›´å°‘è¯·æ±‚ï¼Œå› ä¸ºè¶Šæ…¢çš„æä¾›è€…çš„è°ƒç”¨å‰åè®¡æ•°å·®ä¼šè¶Šå¤§ã€‚ ConsistentHash LoadBalanceï¼š ä¸€è‡´æ€§ Hashï¼Œç›¸åŒå‚æ•°çš„è¯·æ±‚æ€»æ˜¯å‘åˆ°åŒä¸€æä¾›è€…ã€‚å½“æŸä¸€å°æä¾›è€…æŒ‚æ—¶ï¼ŒåŸæœ¬å‘å¾€è¯¥æä¾›è€…çš„è¯·æ±‚ï¼ŒåŸºäºè™šæ‹ŸèŠ‚ç‚¹ï¼Œå¹³æ‘Šåˆ°å…¶å®ƒæä¾›è€…ï¼Œä¸ä¼šå¼•èµ·å‰§çƒˆå˜åŠ¨ã€‚ æœåŠ¡é™çº§å½“æœåŠ¡å™¨å‹åŠ›å‰§å¢çš„æƒ…å†µä¸‹ï¼Œæ ¹æ®å®é™…ä¸šåŠ¡æƒ…å†µåŠæµé‡ï¼Œå¯¹ä¸€äº›æœåŠ¡å’Œé¡µé¢æœ‰ç­–ç•¥çš„ä¸å¤„ç†æˆ–æ¢ç§ç®€å•çš„æ–¹å¼å¤„ç†ï¼Œä»è€Œé‡Šæ”¾æœåŠ¡å™¨èµ„æºä»¥ä¿è¯æ ¸å¿ƒäº¤æ˜“æ­£å¸¸è¿ä½œæˆ–é«˜æ•ˆè¿ä½œã€‚ mock=force:return+null è¡¨ç¤ºæ¶ˆè´¹æ–¹å¯¹è¯¥æœåŠ¡çš„æ–¹æ³•è°ƒç”¨éƒ½ç›´æ¥è¿”å› null å€¼ï¼Œä¸å‘èµ·è¿œç¨‹è°ƒç”¨ã€‚ç”¨æ¥å±è”½ä¸é‡è¦æœåŠ¡ä¸å¯ç”¨æ—¶å¯¹è°ƒç”¨æ–¹çš„å½±å“ã€‚ mock=fail:return+null è¡¨ç¤ºæ¶ˆè´¹æ–¹å¯¹è¯¥æœåŠ¡çš„æ–¹æ³•è°ƒç”¨åœ¨å¤±è´¥åï¼Œå†è¿”å› null å€¼ï¼Œä¸æŠ›å¼‚å¸¸ã€‚ç”¨æ¥å®¹å¿ä¸é‡è¦æœåŠ¡ä¸ç¨³å®šæ—¶å¯¹è°ƒç”¨æ–¹çš„å½±å“ã€‚ é›†ç¾¤å®¹é”™Failfast Clusterï¼šå¿«é€Ÿå¤±è´¥ï¼Œåªå‘èµ·ä¸€æ¬¡è°ƒç”¨ï¼Œå¤±è´¥ç«‹å³æŠ¥é”™ã€‚é€šå¸¸ç”¨äºéå¹‚ç­‰æ€§çš„å†™æ“ä½œï¼Œæ¯”å¦‚æ–°å¢è®°å½•ï¼› Failsafe Clusterï¼šå¤±è´¥å®‰å…¨ï¼Œå‡ºç°å¼‚å¸¸æ—¶ï¼Œç›´æ¥å¿½ç•¥ã€‚é€šå¸¸ç”¨äºå†™å…¥å®¡è®¡æ—¥å¿—ç­‰æ“ä½œï¼› Failback Clusterï¼šå¤±è´¥è‡ªåŠ¨æ¢å¤ï¼Œåå°è®°å½•å¤±è´¥è¯·æ±‚ï¼Œå®šæ—¶é‡å‘ã€‚é€šå¸¸ç”¨äºæ¶ˆæ¯é€šçŸ¥æ“ä½œï¼› Forking Clusterï¼šå¹¶è¡Œè°ƒç”¨å¤šä¸ªæœåŠ¡å™¨ï¼Œåªè¦ä¸€ä¸ªæˆåŠŸå³è¿”å›ã€‚é€šå¸¸ç”¨äºå®æ—¶æ€§è¦æ±‚è¾ƒé«˜çš„è¯»æ“ä½œï¼Œä½†éœ€è¦æµªè´¹æ›´å¤šæœåŠ¡èµ„æºã€‚å¯é€šè¿‡ forks=â€2â€ æ¥è®¾ç½®æœ€å¤§å¹¶è¡Œæ•°ï¼› Broadcast Clusterï¼šå¹¿æ’­è°ƒç”¨æ‰€æœ‰æä¾›è€…ï¼Œé€ä¸ªè°ƒç”¨ï¼Œä»»æ„ä¸€å°æŠ¥é”™åˆ™æŠ¥é”™ [2]ã€‚é€šå¸¸ç”¨äºé€šçŸ¥æ‰€æœ‰æä¾›è€…æ›´æ–°ç¼“å­˜æˆ–æ—¥å¿—ç­‰æœ¬åœ°èµ„æºä¿¡æ¯ã€‚","categories":[{"name":"åå°æŠ€æœ¯","slug":"åå°æŠ€æœ¯","permalink":"http://yoursite.com/categories/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"Dubbo","slug":"Dubbo","permalink":"http://yoursite.com/tags/Dubbo/"}]},{"title":"Redis ç‚¹èµ","slug":"é¡¹ç›®å¼€å‘/Redis ç‚¹èµ","date":"2020-04-09T06:29:14.000Z","updated":"2020-07-10T03:58:30.537Z","comments":true,"path":"2020/04/09/é¡¹ç›®å¼€å‘/Redis ç‚¹èµ/","link":"","permalink":"http://yoursite.com/2020/04/09/%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91/Redis%20%E7%82%B9%E8%B5%9E/","excerpt":"Redis å®ç°ç‚¹èµåŠŸèƒ½ã€‚","text":"Redis å®ç°ç‚¹èµåŠŸèƒ½ã€‚ ç¯å¢ƒæ­å»º12345678910111213141516171819202122232425262728293031323334353637383940&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;&lt;/dependency&gt;&lt;!-- Redis --&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt;&lt;/dependency&gt;&lt;!-- Jackson --&gt;&lt;dependency&gt; &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt; &lt;artifactId&gt;jackson-core&lt;/artifactId&gt; &lt;version&gt;2.9.8&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt; &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt; &lt;version&gt;2.9.8&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt; &lt;artifactId&gt;jackson-annotations&lt;/artifactId&gt; &lt;version&gt;2.9.8&lt;/version&gt;&lt;/dependency&gt;&lt;!-- spring-jsonä¾èµ– --&gt; Redis é…ç½®123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354package com.wingo.springbootredis01.config;import com.fasterxml.jackson.annotation.JsonAutoDetect;import com.fasterxml.jackson.annotation.PropertyAccessor;import com.fasterxml.jackson.databind.ObjectMapper;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;import org.springframework.data.redis.connection.RedisConnectionFactory;import org.springframework.data.redis.core.RedisTemplate;import org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;import org.springframework.data.redis.serializer.StringRedisSerializer;/** * @Author Wingo * @Date 2020-04-11 12:13 * @Description */@Configurationpublic class RedisConfig &#123; @Bean public StringRedisSerializer stringRedisSerializer() &#123; return new StringRedisSerializer(); &#125; @Bean public ObjectMapper objectMapper() &#123; ObjectMapper objectMapper = new ObjectMapper(); // æ”¯æŒä»»æ„å¯¹è±¡çš„ json åºåˆ—åŒ–å’Œååºåˆ—åŒ– objectMapper.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY); objectMapper.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL); return objectMapper; &#125; @Bean public Jackson2JsonRedisSerializer jackson2JsonRedisSerializer() &#123; Jackson2JsonRedisSerializer jackson2JsonRedisSerializer = new Jackson2JsonRedisSerializer&lt;&gt;(Object.class); jackson2JsonRedisSerializer.setObjectMapper(objectMapper()); return jackson2JsonRedisSerializer; &#125; @Bean public RedisTemplate redisTemplate(@Autowired RedisConnectionFactory redisConnectionFactory)&#123; RedisTemplate&lt;String,Object&gt; redisTemplate= new RedisTemplate&lt;&gt;(); redisTemplate.setConnectionFactory(redisConnectionFactory); // è®¾ç½®äº†é»˜è®¤çš„åºåˆ—åŒ–å™¨ redisTemplate.setDefaultSerializer(jackson2JsonRedisSerializer()); // å¼€å¯äº‹åŠ¡æ”¯æŒ redisTemplate.setEnableTransactionSupport(true); return redisTemplate; &#125;&#125; properties123456789101112131415161718# Redisæ•°æ®åº“ç´¢å¼•(é»˜è®¤ä¸ºÎ¸)spring.redis.database=0# RedisæœåŠ¡å™¨åœ°å€spring.redis.host=192.168.31.100# RedisæœåŠ¡å™¨è¿æ¥ç«¯å£spring.redis.port=6379# RedisæœåŠ¡å™¨è¿æ¥å¯†ç (é»˜è®¤ä¸ºç©º)spring.redis.password=# è¿æ¥æ± æœ€å¤§è¿æ¥æ•°(ä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶)spring.redis.jedis.pool.max-active=10# è¿æ¥æ± æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´(ä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶)spring.redis.jedis.pool.max-wait=-1# è¿æ¥æ± ä¸­çš„æœ€å¤§ç©ºé—²è¿æ¥spring.redis.jedis.pool.max-idle=5# è¿æ¥æ± ä¸­çš„æœ€å°ç©ºé—²è¿æ¥spring.redis.jedis.pool.min-idle=0# è¿æ¥è¶…æ—¶æ—¶é—´(æ¯«ç§’)spring.redis.timeout=1000 å•å…ƒæµ‹è¯•123456789101112131415@RunWith(SpringRunner.class)@Slf4j@SpringBootTestclass SpringBootRedis01ApplicationTests &#123; @Autowired private RedisTemplate redisTemplate; @Test void simpleAdd() &#123; redisTemplate.opsForValue().set(\"test01\",\"è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•01\"); log.info(redisTemplate.opsForValue().get(\"test01\").toString()); &#125;&#125; Redis å®¢æˆ·ç«¯å­˜å‚¨æ­£å¸¸ï¼Œæ§åˆ¶å°æ­£å¸¸è¾“å‡ºï¼Œé¡¹ç›®ç¯å¢ƒæ­å»ºå®Œæˆã€‚ ç‚¹èµç±»å‹æšä¸¾ç±» LIKED ARTICLE æ–‡ç« ç‚¹èµï¼›LIKED â…¥DEO è§†é¢‘ç‚¹èµï¼› ä»£ç å®ç° 12345678910111213141516171819public enum MyType &#123; /** LIKED_ARTICLE */ LIKED_ARTICLE (\"æ–‡ç« ç‚¹èµ\"), /** LIKED_VIDEO */ LIKED_VIDEO (\"è§†é¢‘ç‚¹èµ\"), /** LIKED_VIDEO */ UNKONW_TYPE (\"æœªçŸ¥ç±»å‹\"); private String myType; /** * æ„é€ å™¨ç±» * @param myType */ MyType(String myType) &#123; this.myType = myType; &#125;&#125; ç‚¹èµå·¥å…·ç±»1234567891011121314151617181920public class LikedUtil &#123; /** ç”Ÿæˆ Key */ public static String getKey(MyType myType, String subjectId) &#123; return myType + \":\" + subjectId; &#125; public static String getReportKey(MyType myType) &#123; MyType type; switch (myType) &#123; case LIKED_ARTICLE: type = MyType.LIKED_ARTICLE; break; case LIKED_VIDEO: type = MyType.LIKED_VIDEO; break; default: type = MyType.UNKONW_TYPE; &#125; return type + \"\"; &#125;&#125; å•å…ƒæµ‹è¯•123456@Testvoid keyTest()&#123; MyType type = MyType.LIKED_ARTICLE; String result = LikedUtil.getKey(type, â€œ1â€); log.info(result);&#125; è‡ªå®šä¹‰çš„ Key æ ¼å¼ï¼šç±»å‹ + ç±»å‹å®ä½“çš„ id ç®€å•å®ç°è¯¥æ–¹æ¡ˆ Redis æ•°æ®åº“åªå­˜å‚¨ç‚¹èµä¸»ä½“å’Œè¢«ç‚¹èµä¸»ä½“çš„IDä¿¡æ¯ï¼Œæ•°æ®ç±»å‹é‡‡ç”¨ Hash ç±»å‹ã€‚ key ï¼šLIKED_TYPE + subject_idï¼Œå³ä½¿ç”¨æ–‡ç« çš„ id ä½œä¸º key ã€‚field ï¼š post_id ç‚¹èµäººçš„id ï¼› value å›ºå®šå€¼ 1 ï¼šè¡¨ç¤ºä¸€ä¸ªç‚¹èµä¸»ä½“å¯¹è¢«ç‚¹èµä¸»ä½“ç‚¹äº†ä¸€æ¬¡èµã€‚ è‡ªå®šä¹‰æ¥å£1234567891011121314151617181920212223242526/** * @Author Wingo * @Date 2020-04-11 14:41 * @Description */public interface LikedSimpleService &#123; /** * ç‚¹èµ / å–æ¶ˆç‚¹èµåŠŸèƒ½ * * @param myType ç‚¹èµçš„ç±»å‹ * @param subjectId è¢«ç‚¹èµçš„ä¸»ä½“çš„ id * @param postId ç‚¹èµä¸»ä½“çš„ id */ void liked(MyType myType, String subjectId, String postId); /** * å¾—åˆ°ä¸»ä½“çš„æ€»ç‚¹èµæ•° * * @param myType ç‚¹èµçš„ç±»å‹ * @param subjectId è¢«ç‚¹èµçš„ä¸»ä½“çš„ id * @return æ€»ç‚¹èµæ•° */ Long count(MyType myType, String subjectId);&#125; æ¥å£å®ç°12345678910111213141516171819202122232425262728293031/** * @Author Wingo * @Date 2020-04-11 15:09 * @Description */@Servicepublic class LikedSimpleServiceImpl implements LikedSimpleService &#123; @Autowired private StringRedisTemplate redisTemplate; @Override public void liked(MyType myType, String subjectId, String postId) &#123; String key = LikedUtil.getKey(myType, subjectId); // åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å·²ç»ç‚¹èµï¼Œå¦‚æœç‚¹è¿‡èµï¼Œå–æ¶ˆç‚¹èµï¼Œå¦‚æœæ²¡æœ‰ç‚¹è¿‡ç‚¹èµ Boolean liked = redisTemplate.opsForHash().hasKey(key, postId); if (Boolean.TRUE.equals(liked)) &#123; // å–æ¶ˆç‚¹èµ redisTemplate.opsForHash().delete(key, postId); &#125; else &#123; // ç‚¹èµ redisTemplate.opsForHash().put(key, postId, \"1\"); &#125; &#125; @Override public Long count(MyType myType, String subjectId) &#123; String key = LikedUtil.getKey(myType, subjectId); return redisTemplate.opsForHash().size(key); &#125;&#125; å•å…ƒæµ‹è¯•12345678910111213141516171819202122232425262728293031@RunWith(SpringRunner.class)@Slf4j@SpringBootTestclass SpringBootRedis01ApplicationTests &#123; @Autowired private LikedSimpleService likedSimpleService; @Autowired private RedisTemplate redisTemplate; @Test void keyTest()&#123; MyType myType = MyType.LIKED_ARTICLE; for (int j = 1; j &lt;= 100; j++) &#123; for (int i = 1; i &lt;= j; i++) &#123; likedSimpleService.liked(myType, j+\"\", i+\"\"); &#125; &#125; &#125; @Test void countTest()&#123; MyType myType = MyType.LIKED_ARTICLE; int num = 0; while(num &lt;= 10)&#123; int subjectId = new Random().nextInt(100) + 1; long count = likedSimpleService.count(myType, Integer.toString(subjectId)); log.info(\"ID ä¸º\" + subjectId + \"çš„æ–‡ç« ç‚¹èµæ•°ä¸º\" + count); num++; &#125;&#125; åˆå§‹åŒ– 100 ç¯‡æ–‡ç« çš„ç‚¹èµä¿¡æ¯ï¼Œå¹¶ä¸” id = num çš„æ–‡ç« å…¶ç‚¹èµæ•°ä¸º num å¤æ‚å®ç° å‰é¢çš„ç®€å•å®ç°åªç¼“å­˜äº† ID çš„æ•°æ®ï¼Œè€Œå®é™…çš„åº”ç”¨åœºæ™¯ä¸­å¸¸å¸¸è¿˜éœ€è¦æ›´å¤šçš„ä¿¡æ¯ï¼Œæ¯”å¦‚æ–‡ç« æ ‡é¢˜ã€æ–‡ç« å†…å®¹ç®€ä»‹ã€ç”¨æˆ·æ˜µç§°ã€ç”¨æˆ·å¤´åƒã€ç‚¹èµæ’è¡Œç­‰ä¿¡æ¯ã€‚æ ¹æ®éœ€æ±‚ç»§ç»­å®Œå–„é¡¹ç›®ã€‚ æ–¹æ¡ˆè®¾è®¡ ç‚¹èµæ•°é‡ç»Ÿè®¡ï¼šHash key ï¼šLIKED_TYPE + subject_idã€‚ field ï¼š post_idï¼› value { json } ç‚¹èµçš„äººçš„ä¿¡æ¯ã€‚ ç‚¹èµæ’åç»Ÿè®¡ï¼š zSet key ï¼šLIKED_TYPE_TOPã€‚ field ï¼š value { json } è¢«ç‚¹èµä¸»ä½“çš„å†…å®¹ï¼› score è®°å½•è¢«ç‚¹èµä¸»ä½“çš„æ€»èµæ•°ã€‚ ç±»å‹æ·»åŠ 123456789101112131415161718192021222324252627public enum MyType &#123; /** LIKED_ARTICLE */ LIKED_ARTICLE (\"æ–‡ç« ç‚¹èµ\"), /** LIKED_VIDEO */ LIKED_VIDEO (\"è§†é¢‘ç‚¹èµ\"), /** LIKED_ARTICLE_TOP */ LIKED_ARTICLE_TOP (\"æ–‡ç« ç‚¹èµæ’è¡Œ\"), /** LIKED_VIDEO_TOP */ LIKED_VIDEO_TOP (\"è§†é¢‘ç‚¹èµæ’è¡Œ\"), /** LIKED_VIDEO */ UNKONW_TYPE (\"æœªçŸ¥ç±»å‹\"); private String myType; /** * æ„é€ å™¨ç±» * @param myType */ MyType(String myType) &#123; this.myType = myType; &#125; public String getMyType()&#123; return this.myType; &#125;&#125; 1234567891011121314151617181920212223242526public class LikedUtil &#123; LikedUtil()&#123; throw new IllegalStateException(\"Utility class\"); &#125; /** ç”Ÿæˆ Key */ public static String getKey(MyType myType, String subjectId) &#123; return myType + \":\" + subjectId; &#125; /** ç”Ÿæˆæ’è¡Œæ¦œ Key */ public static String getTopKey(MyType myType) &#123; MyType type; switch (myType) &#123; case LIKED_ARTICLE: type = MyType.LIKED_ARTICLE_TOP; break; case LIKED_VIDEO: type = MyType.LIKED_VIDEO_TOP; break; default: type = MyType.UNKONW_TYPE; &#125; return type.toString(); &#125;&#125; 12345678@Datapublic class Article &#123; private Integer articleId; private String title; private String summary; private String img;&#125; 1234567@Datapublic class User &#123; private Integer userId; private String username; private String avatar;&#125; è‡ªå®šä¹‰æ¥å£1234567891011121314151617181920212223242526272829303132333435363738394041424344/** * @Author Wingo * @Date 2020-04-12 12:45 * @Description */public interface LikedService &#123; /** * ç‚¹èµ/å–æ¶ˆç‚¹èµ * * @param type ç±»å‹ * @param subjectId è¢«ç‚¹èµä¸»ä½“ ID * @param postId ç‚¹èµä¸»ä½“ ID * @param postUser ç‚¹èµä¸»ä½“çš„æ¦‚è¦ä¿¡æ¯ * @param subject è¢«ç‚¹èµä¸»ä½“æ¦‚è¦ä¿¡æ¯ */ void liked(MyType type, String subjectId, String postId, Object subject, Object postUser); /** * è·å–ä¸»ä½“ç‚¹èµæ•°é‡ * * @param type ç±»å‹ * @param subjectId è¢«ç‚¹èµä¸»ä½“ ID * @return ç‚¹èµæ•°é‡ */ Long count(MyType type, String subjectId); /** * è·å–ç‚¹èµä¸»ä½“çš„è¯¦æƒ…åˆ—è¡¨ * * @param type ç±»å‹ * @param subjectId è¢«ç‚¹èµä¸»ä½“ ID * @return ç‚¹èµä¸»ä½“çš„è¯¦æƒ…åˆ—è¡¨ */ List&lt;Object&gt; getPostUserSet(MyType type, String subjectId); /** * æ’è¡ŒæŸ¥è¯¢ * * @param type ä¸šåŠ¡ç±»å‹ * @param top å‰ top å * @return æ’è¡Œåˆ—è¡¨ */ Set&lt;Object&gt; getSubjectTopN(MyType type, Long top);&#125; æ¥å£å®ç°123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172package com.wingo.springbootredis01.service.impl;import com.wingo.springbootredis01.constant.Common;import com.wingo.springbootredis01.constant.MyType;import com.wingo.springbootredis01.service.LikedService;import com.wingo.springbootredis01.util.LikedUtil;import lombok.extern.slf4j.Slf4j;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.data.redis.core.RedisTemplate;import org.springframework.stereotype.Service;import java.util.List;import java.util.Set;/** * @Author Wingo * @Date 2020-04-12 12:50 * @Description */@Slf4j@Servicepublic class LikedServiceImpl implements LikedService &#123; @Autowired private RedisTemplate&lt;String,Object&gt; redisTemplate; @Override public void liked(MyType type, String subjectId, String postId, Object subject, Object postUser) &#123; String key = LikedUtil.getKey(type, subjectId); Boolean liked = redisTemplate.opsForHash().hasKey(key, postId); if (Boolean.TRUE.equals(liked)) &#123; // å–æ¶ˆèµ redisTemplate.opsForHash().delete(key, postId); &#125; else &#123; // ç‚¹èµ redisTemplate.opsForHash().put(key, postId, postUser); &#125; String reportKey = LikedUtil.getTopKey(type); if (Boolean.TRUE.equals(liked)) &#123; redisTemplate.opsForZSet().incrementScore(reportKey, subject, Common.DECLINE); &#125; else &#123; Double score = redisTemplate.opsForZSet().score(reportKey, subject); if (score == null) &#123; redisTemplate.opsForZSet().add(reportKey, subject, Common.INCREASE); &#125; else &#123; redisTemplate.opsForZSet().incrementScore(reportKey, subject, Common.INCREASE); &#125; &#125; &#125; @Override public Long count(MyType type, String subjectId) &#123; String key = LikedUtil.getKey(type, subjectId); return redisTemplate.opsForHash().size(key); &#125; @Override public List&lt;Object&gt; getPostUserSet(MyType type, String subjectId) &#123; String key = LikedUtil.getKey(type, subjectId); return redisTemplate.opsForHash().values(key); &#125; @Override public Set&lt;Object&gt; getSubjectTopN(MyType type, Long top) &#123; String key = LikedUtil.getTopKey(type); return redisTemplate.opsForZSet().reverseRange(key, 0, top); &#125;&#125; å•å…ƒæµ‹è¯•12345678910111213141516171819202122232425@Testvoid keyTest()&#123; MyType myType = MyType.LIKED_ARTICLE; for (int j = 1; j &lt;= 100; j++) &#123; Article article= new Article(); article.setArticleId(j); article.setTitle(\"æ–‡ç« æ ‡é¢˜\"+j); article.setImg(\"æ–‡ç« å›¾ç‰‡\"+j); article.setSummary(\"æ–‡ç« æ‘˜è¦\"+j); for (int i = 1; i &lt;= j; i++) &#123; User user = new User(); user.setUserId (i); user.setUsername(\"user\"+ i); user.setAvatar(\"avatar\"+ i); likedService.liked(myType, j+\"\", i+\"\", article, user); &#125; &#125;&#125;@Testvoid countTest()&#123; MyType myType = MyType.LIKED_ARTICLE; log.info(likedService.getSubjectTopN(myType, (long) 10).toString());&#125; ç”¨æˆ·ä¿¡æ¯è¢«å†™å…¥ç¼“å­˜ã€‚ å–å¾—æ’åå‰åçš„æ–‡ç« ä¿¡æ¯ã€‚","categories":[{"name":"é¡¹ç›®å¼€å‘","slug":"é¡¹ç›®å¼€å‘","permalink":"http://yoursite.com/categories/%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91/"}],"tags":[{"name":"ç‚¹èµ","slug":"ç‚¹èµ","permalink":"http://yoursite.com/tags/%E7%82%B9%E8%B5%9E/"}]},{"title":"H2 é…ç½®","slug":"ç¯å¢ƒæ­å»º/H2 é…ç½®","date":"2020-04-06T09:33:57.000Z","updated":"2020-07-10T03:01:03.506Z","comments":true,"path":"2020/04/06/ç¯å¢ƒæ­å»º/H2 é…ç½®/","link":"","permalink":"http://yoursite.com/2020/04/06/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/H2%20%E9%85%8D%E7%BD%AE/","excerpt":"Spring Boot æ•´åˆ H2 æ•°æ®åº“.","text":"Spring Boot æ•´åˆ H2 æ•°æ®åº“. æ·»åŠ ä¾èµ–12345678910111213&lt;dependency&gt; &lt;groupId&gt;com.h2database&lt;/groupId&gt; &lt;artifactId&gt;h2&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;&lt;/dependency&gt; å¸¸ç”¨é…ç½®12345678910111213141516171819202122# è‹¥ä½¿ç”¨å†…å­˜æ•°æ®åº“ spring.datasource.url=jdbc:h2:mem:test# ./ è¡¨ç¤ºæ ¹ç›®å½•ä¸‹ç”Ÿæˆæ•°æ®åº“æ–‡ä»¶ ~/ è¡¨ç¤ºç”¨æˆ·æ ¹ç›®å½• spring.datasource.url=jdbc:h2:./db/testspring.datasource.driverClassName=org.h2.Driverspring.datasource.username=saspring.datasource.password=# ä½¿ç”¨ H2 æ•°æ®å¹³å°spring.datasource.platform=h2# å†…å­˜æ¨¡å¼çš„æ•°æ®åº“ä¿¡æ¯è¯»å–# spring.datasource.schema=classpath:db/schema.sql# spring.datasource.data=classpath:db/data.sqlspring.h2.console.settings.web-allow-others=true# æµè§ˆå™¨è®¿é—®è·¯å¾„ &#123;path&#125;/h2spring.h2.console.path=/h2# ç¨‹åºå¯åŠ¨æ—¶å¯åŠ¨ H2spring.h2.console.enabled=truespring.jpa.database-platform=org.hibernate.dialect.H2Dialectspring.jpa.generate-ddl=truespring.jpa.show-sql=truespring.jpa.hibernate.ddl-auto=update","categories":[{"name":"ç¯å¢ƒæ­å»º","slug":"ç¯å¢ƒæ­å»º","permalink":"http://yoursite.com/categories/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"}],"tags":[{"name":"H2","slug":"H2","permalink":"http://yoursite.com/tags/H2/"}]},{"title":"Mybatis-Plus","slug":"ç¯å¢ƒæ­å»º/Mybatis-Plus","date":"2020-04-06T03:44:35.000Z","updated":"2020-07-10T04:16:55.688Z","comments":true,"path":"2020/04/06/ç¯å¢ƒæ­å»º/Mybatis-Plus/","link":"","permalink":"http://yoursite.com/2020/04/06/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/Mybatis-Plus/","excerpt":"Mybatis-Plus æ•´åˆ H2 æ•°æ®åº“å°æ¡ˆä¾‹ã€‚","text":"Mybatis-Plus æ•´åˆ H2 æ•°æ®åº“å°æ¡ˆä¾‹ã€‚ Mybatis-Plus å®˜æ–¹æ–‡æ¡£ SQL è¯­å¥ 12345678910111213141516-- å»ºè¡¨è¯­å¥CREATE TABLE user( id BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID', name VARCHAR(30) NULL DEFAULT NULL COMMENT 'å§“å', age INT(11) NULL DEFAULT NULL COMMENT 'å¹´é¾„', email VARCHAR(50) NULL DEFAULT NULL COMMENT 'é‚®ç®±', PRIMARY KEY (id));-- æ’å…¥æ•°æ®INSERT INTO user (name, age, email) VALUES('Jone', 18, 'test1@baomidou.com'),('Jack', 20, 'test2@baomidou.com'),('Tom', 28, 'test3@baomidou.com'),('Sandy', 21, 'test4@baomidou.com'),('Billie', 24, 'test5@baomidou.com'); ç¯å¢ƒæ­å»ºçƒ­éƒ¨ç½² ctrl + shift + alt + /å‹¾é€‰ 1234567891011121314151617181920212223242526272829303132333435363738394041424344&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;!-- mybatis-plus --&gt; &lt;dependency&gt; &lt;groupId&gt;com.baomidou&lt;/groupId&gt; &lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt; &lt;version&gt;3.3.1.tmp&lt;/version&gt; &lt;/dependency&gt; &lt;!-- H2 æ•°æ®åº“ --&gt; &lt;dependency&gt; &lt;groupId&gt;com.h2database&lt;/groupId&gt; &lt;artifactId&gt;h2&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- ç”¨äºè¿”å› JSON --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;fastjson&lt;/artifactId&gt; &lt;version&gt;1.2.6&lt;/version&gt; &lt;/dependency&gt; &lt;!-- çƒ­éƒ¨ç½² --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;scope&gt;true&lt;/scope&gt; &lt;/dependency&gt; 1234567891011121314151617181920# è‹¥ä½¿ç”¨å†…å­˜æ•°æ®åº“ spring.datasource.url=jdbc:h2:mem:test# ./ è¡¨ç¤ºæ ¹ç›®å½•ä¸‹ç”Ÿæˆæ•°æ®åº“æ–‡ä»¶ ~/ è¡¨ç¤ºç”¨æˆ·æ ¹ç›®å½•spring.datasource.url=jdbc:h2:./db/testspring.datasource.driverClassName=org.h2.Driverspring.datasource.username=saspring.datasource.password=# ä½¿ç”¨ H2 æ•°æ®å¹³å°spring.datasource.platform=h2# å†…å­˜æ¨¡å¼çš„æ•°æ®åº“ä¿¡æ¯è¯»å–# spring.datasource.schema=classpath:db/schema.sql# spring.datasource.data=classpath:db/data.sqlspring.h2.console.settings.web-allow-others=true# æµè§ˆå™¨è®¿é—®è·¯å¾„ &#123;path&#125;/h2spring.h2.console.path=/h2# ç¨‹åºå¯åŠ¨æ—¶å¯åŠ¨ H2spring.h2.console.enabled=true# æ‰“å° SQL è¯­å¥mybatis-plus.configuration.log-impl=org.apache.ibatis.logging.stdout.StdOutImpl é¡¹ç›®æ­å»ºVO12345678910111213141516171819202122232425262728293031323334353637383940public class ResponseVO extends HashMap&lt;String, Object&gt; &#123; private static final Integer SUCCESS_STATUS = 200; private static final Integer ERROR_STATUS = -1; private static final String SUCCESS_MSG = \"ä¸€åˆ‡æ­£å¸¸\"; private static final String ERROR_MSG = \"å‡ºç°é”™è¯¯\"; private static final long serialVersionUID = 1L; public ResponseVO success(String msg) &#123; put(\"msg\", SUCCESS_MSG); put(\"status\", SUCCESS_STATUS); return this; &#125; public ResponseVO error(String msg) &#123; put(\"msg\", ERROR_MSG); put(\"status\", ERROR_STATUS); return this; &#125; public ResponseVO setData(String key, Object obj) &#123; @SuppressWarnings(\"unchecked\") HashMap&lt;String, Object&gt; data = (HashMap&lt;String, Object&gt;) get(\"data\"); if (data == null) &#123; data = new HashMap&lt;&gt;(16); put(\"data\", data); &#125; data.put(key, obj); return this; &#125; /** * è¿”å›JSONå­—ç¬¦ä¸² */ @Override public String toString() &#123; return JSONObject.toJSONString(this); // com.alibaba.fastjson &#125;&#125; Entity12345678910@Datapublic class User &#123; @TableId(type=IdType.AUTO) // è‡ªå¢ private Long id; private String name; private Integer age; private String email;&#125; Mapper1234@Component // å¯ä¸åŠ ï¼šé˜²æ­¢ç¼–è¯‘å™¨æŠ¥é”™public interface UserMapper extends BaseMapper&lt;User&gt; &#123;&#125; Controller1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253@Controllerpublic class UserController &#123; @Autowired private UserMapper userMapper; @GetMapping(value = \"/selectList\") @ResponseBody public ResponseVO selectList()&#123; ResponseVO responseVO = new ResponseVO(); List&lt;User&gt; userList = userMapper.selectList(new QueryWrapper&lt;User&gt;().orderByDesc(\"id\")); responseVO.setData(\"userList\",userList); return responseVO; &#125; @GetMapping(value = \"/insert/&#123;name&#125;/&#123;age&#125;\") public String insert(@PathVariable(\"name\") String name, @PathVariable(\"age\") Integer age)&#123; User user = new User(); user.setName(name); user.setAge(age); user.setEmail(name + age +\"@wingo-email.com\"); userMapper.insert(user); return \"redirect:/selectList\"; &#125; @GetMapping(value = \"/delete/&#123;id&#125;\") public String delete(@PathVariable(\"id\") Integer id)&#123; userMapper.deleteById(id); return \"redirect:/selectList\"; &#125; @GetMapping(value = \"/age-eq/&#123;age&#125;\") public ResponseVO ageEqual(@PathVariable(\"age\") Integer age)&#123; ResponseVO responseVO = new ResponseVO(); QueryWrapper&lt;User&gt; queryWrapper = new QueryWrapper&lt;&gt;(); queryWrapper.eq(\"age\",age); List&lt;User&gt; userList = userMapper.selectList(queryWrapper); responseVO.setData(\"userList\",userList); return responseVO; &#125; @GetMapping(value = \"/age/&#123;gt&#125;/&#123;lt&#125;\") @ResponseBody public ResponseVO age(@PathVariable(\"gt\") Integer gt, @PathVariable(\"lt\") Integer lt)&#123; ResponseVO responseVO = new ResponseVO(); QueryWrapper&lt;User&gt; queryWrapper = new QueryWrapper&lt;&gt;(); queryWrapper.gt(\"age\",gt); queryWrapper.lt(\"age\",lt); List&lt;User&gt; userList = userMapper.selectList(queryWrapper); responseVO.setData(\"userList\",userList); return responseVO; &#125;&#125; æ¥å£æµ‹è¯• åˆ†é¡µé…ç½®1234567891011121314151617@Configurationpublic class MyBatisConfig &#123; /** * MyBatis-puls åˆ†é¡µæ’ä»¶é…ç½® * @return */ @Bean public PaginationInterceptor paginationInterceptor() &#123; PaginationInterceptor paginationInterceptor = new PaginationInterceptor(); // è®¾ç½®è¯·æ±‚çš„é¡µé¢å¤§äºæœ€å¤§é¡µåæ“ä½œï¼Œ true è°ƒå›åˆ°é¦–é¡µï¼Œfalse ç»§ç»­è¯·æ±‚ é»˜è®¤ false paginationInterceptor.setOverflow(false); // è®¾ç½®æœ€å¤§å•é¡µé™åˆ¶æ•°é‡ï¼Œé»˜è®¤ 500 æ¡ï¼Œ-1 ä¸å—é™åˆ¶ paginationInterceptor.setLimit(500); return paginationInterceptor; &#125;&#125; ä»£ç ç”Ÿæˆå™¨1234567891011&lt;dependency&gt; &lt;groupId&gt;com.baomidou&lt;/groupId&gt; &lt;artifactId&gt;mybatis-plus-generator&lt;/artifactId&gt; &lt;version&gt;3.2.0&lt;/version&gt;&lt;/dependency&gt;&lt;!-- å®˜æ–¹æ–‡æ¡£æŸ¥çœ‹æ”¯æŒçš„å…¶å®ƒå¼•æ“ --&gt;&lt;dependency&gt; &lt;groupId&gt;org.freemarker&lt;/groupId&gt; &lt;artifactId&gt;freemarker&lt;/artifactId&gt; &lt;version&gt;2.3.29&lt;/version&gt;&lt;/dependency&gt; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687/*** ä»£ç ç”Ÿæˆå™¨*/public class Generator &#123; /** * è¯»å–æ§åˆ¶å°å†…å®¹ */ public static String scanner(String tip) &#123; Scanner scanner = new Scanner(System.in); StringBuilder help = new StringBuilder(); help.append(\"è¯·è¾“å…¥\" + tip + \"ï¼š\"); System.out.println(help.toString()); if (scanner.hasNext()) &#123; String ipt = scanner.next(); if (StringUtils.isNotEmpty(ipt)) &#123; return ipt; &#125; &#125; throw new MybatisPlusException(\"è¯·è¾“å…¥æ­£ç¡®çš„\" + tip + \"ï¼\"); &#125; public static void main(String[] args) &#123; // ä»£ç ç”Ÿæˆå™¨ AutoGenerator mpg = new AutoGenerator(); // å…¨å±€é…ç½® GlobalConfig gc = new GlobalConfig(); String projectPath = System.getProperty(\"user.dir\"); gc.setOutputDir(projectPath + \"/src/main/java\"); gc.setAuthor(\"wingo\"); gc.setOpen(false); // gc.setSwagger2(true); // å®ä½“å±æ€§ Swagger2 æ³¨è§£ gc.setBaseResultMap(true); gc.setBaseColumnList(true); mpg.setGlobalConfig(gc); // æ•°æ®æºé…ç½® DataSourceConfig dsc = new DataSourceConfig(); dsc.setUrl(\"jdbc:mysql://localhost:3306/[db-name]?useSSL=false\"); dsc.setDriverName(\"com.mysql.jdbc.Driver\"); dsc.setUsername(\"root\"); dsc.setPassword(\"123456\"); mpg.setDataSource(dsc); // åŒ…é…ç½® PackageConfig pc = new PackageConfig(); pc.setModuleName(scanner(\"æ¨¡å—å\")); pc.setParent(\"com.wingo.mybatisplus\"); mpg.setPackageInfo(pc); // è‡ªå®šä¹‰é…ç½® InjectionConfig cfg = new InjectionConfig() &#123; @Override public void initMap() &#123; // to do nothing &#125; &#125;; List&lt;FileOutConfig&gt; focList = new ArrayList&lt;&gt;(); // æ¨¡æ¿å¼•æ“æ˜¯ freemarker focList.add(new FileOutConfig(\"/templates/mapper.xml.ftl\") &#123; @Override public String outputFile(TableInfo tableInfo) &#123; // è‡ªå®šä¹‰è¾“å…¥æ–‡ä»¶åç§° return projectPath + \"/src/main/resources/mapper/\" + pc.getModuleName() + \"/\" + tableInfo.getEntityName() + \"Mapper\" + StringPool.DOT_XML; &#125; &#125;); cfg.setFileOutConfigList(focList); mpg.setCfg(cfg); mpg.setTemplate(new TemplateConfig().setXml(null)); // ç­–ç•¥é…ç½® StrategyConfig strategy = new StrategyConfig(); strategy.setNaming(NamingStrategy.underline_to_camel); strategy.setColumnNaming(NamingStrategy.underline_to_camel); strategy.setEntityLombokModel(true); // ä½¿ç”¨ Lombok æ’ä»¶ strategy.setInclude(scanner(\"è¡¨å\")); // è‡ªå®šä¹‰ç»§æ‰¿ç±»ï¼Œå¯ç›´æ¥ä½¿ç”¨å®˜æ–¹çš„é¡¶çº§å®ç° // strategy.setSuperServiceClass(\"com.wingo.common.service.IService\"); // strategy.setSuperServiceImplClass(\"com.wingo.common.service.impl.ServiceImpl\"); // Controlleré…ç½® strategy.setSkipView(false); strategy.setControllerMappingHyphenStyle(true); strategy.setRestControllerStyle(false); // @Controller @RestController strategy.setTablePrefix(pc.getModuleName() + \"_\"); mpg.setStrategy(strategy); // é€‰æ‹© freemarker å¼•æ“éœ€è¦æŒ‡å®šå¦‚ä¸‹åŠ ï¼Œæ³¨æ„ pom ä¾èµ–å¿…é¡»æœ‰ï¼ mpg.setTemplateEngine(new FreemarkerTemplateEngine()); mpg.execute(); &#125;&#125; Service é¡¶çº§å®ç°","categories":[{"name":"ç¯å¢ƒæ­å»º","slug":"ç¯å¢ƒæ­å»º","permalink":"http://yoursite.com/categories/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"}],"tags":[{"name":"Mybatis","slug":"Mybatis","permalink":"http://yoursite.com/tags/Mybatis/"}]},{"title":"Spring Boot ä»»åŠ¡","slug":"åå°æŠ€æœ¯/Spring Boot/Spring Boot ä»»åŠ¡","date":"2020-04-01T02:50:45.000Z","updated":"2020-07-10T04:13:25.645Z","comments":true,"path":"2020/04/01/åå°æŠ€æœ¯/Spring Boot/Spring Boot ä»»åŠ¡/","link":"","permalink":"http://yoursite.com/2020/04/01/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/Spring%20Boot/Spring%20Boot%20%E4%BB%BB%E5%8A%A1/","excerpt":"Spring Boot ä¸­çš„å¼‚æ­¥ä»»åŠ¡ï¼Œå®šæ—¶ä»»åŠ¡ï¼Œé‚®ä»¶ä»»åŠ¡çš„ä½¿ç”¨ã€‚","text":"Spring Boot ä¸­çš„å¼‚æ­¥ä»»åŠ¡ï¼Œå®šæ—¶ä»»åŠ¡ï¼Œé‚®ä»¶ä»»åŠ¡çš„ä½¿ç”¨ã€‚ å¼‚æ­¥ä»»åŠ¡ åœ¨ Java åº”ç”¨ä¸­ï¼Œç»å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½æ˜¯é€šè¿‡åŒæ­¥çš„æ–¹å¼æ¥å®ç°äº¤äº’å¤„ç†çš„ã€‚ä½†æ˜¯åœ¨å¤„ç†ä¸ç¬¬ä¸‰æ–¹ç³»ç»Ÿäº¤äº’çš„æ—¶å€™ï¼Œå®¹æ˜“é€ æˆå“åº”è¿Ÿç¼“çš„æƒ…å†µï¼Œä¹‹å‰å¤§éƒ¨åˆ†éƒ½æ˜¯ä½¿ç”¨å¤šçº¿ç¨‹æ¥å®Œæˆæ­¤ç±»ä»»åŠ¡ã€‚å…¶å®ï¼Œåœ¨Spring 3.x ä¹‹åï¼Œå°±å·²ç»å†…ç½®äº†@Asyncã€@EnableAysncæ¥å®Œç¾è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ åœ¨ Spring ä¸­è¿ç”¨ Async æ³¨è§£éœ€è¦æ³¨æ„å‡ ç‚¹ï¼š æ–¹æ³•åå¿…é¡»æ˜¯ public è¿›è¡Œä¿®é¥°çš„ï¼Œä¸”ä¸èƒ½æ˜¯ static æ–¹æ³•ï¼› ä¸èƒ½ä¸è°ƒç”¨çš„æ–¹æ³•åœ¨åŒä¸€ä¸ªç±»ä¸­ï¼› éœ€è¦æŠŠè¯¥æ–¹æ³•æ³¨å…¥åˆ° Spring å®¹å™¨ä¸­ï¼Œå°±æ˜¯åœ¨ä¸€ä¸ªç±»ä¸­æ·»åŠ å¼‚æ­¥æ–¹æ³•ï¼Œå¹¶åœ¨æ­¤ç±»ä¸Šä½¿ç”¨@Componentä¹‹ç±»çš„æ³¨è§£ã€‚ æµ‹è¯•å®ä¾‹å®šä¹‰ Task ç±»ï¼Œåˆ›å»ºä¸‰ä¸ªå¤„ç†å‡½æ•°åˆ†åˆ«æ¨¡æ‹Ÿä¸‰ä¸ªæ‰§è¡Œä»»åŠ¡çš„æ“ä½œï¼Œæ“ä½œæ¶ˆè€—æ—¶é—´éšæœºå–ï¼ˆ10 ç§’å†…ï¼‰ã€‚ 12345678910111213141516171819202122232425262728293031323334353637@Componentpublic class Task &#123; public static Random random =new Random(); @Async // æ³¨é‡Šä¸ºå¼‚æ­¥ä»»åŠ¡ï¼Œ public Future&lt;String&gt; doTaskOne() throws Exception &#123; System.out.println(\"Doing Task One\"); long start = System.currentTimeMillis(); Thread.sleep(random.nextInt(10000)); long end = System.currentTimeMillis(); System.out.println(\"Task One Finishedï¼šSpend \" + (end - start) + \" Millisecond\"); // è‹¥ä¸ç”¨ Future è¿›è¡Œå›è°ƒï¼Œæ— æ³•ç¡®å®šä»»åŠ¡å·²ç»å®Œæˆ return new AsyncResult&lt;&gt;(\"Task One Finished\"); // è¿”å›å¼‚æ­¥è°ƒç”¨ç»“æœ &#125; @Async public Future&lt;String&gt; doTaskTwo() throws Exception &#123; System.out.println(\"Doing Task Two\"); long start = System.currentTimeMillis(); Thread.sleep(random.nextInt(10000)); long end = System.currentTimeMillis(); System.out.println(\"Task Two Finishedï¼šSpend \" + (end - start) + \" Millisecond\"); return new AsyncResult&lt;&gt;(\"Task Two Finished\"); &#125; @Async public Future&lt;String&gt; doTaskThree() throws Exception &#123; System.out.println(\"Doing Task Three\"); long start = System.currentTimeMillis(); Thread.sleep(random.nextInt(10000)); long end = System.currentTimeMillis(); System.out.println(\"Task Three Finishedï¼šSpend \" + (end - start) + \" Millisecond\"); return new AsyncResult&lt;&gt;(\"Task Three Finished\"); &#125;&#125; 12345678@SpringBootApplication@EnableAsync // å¼‚æ­¥ä»»åŠ¡ç”Ÿæ•ˆpublic class Application &#123; public static void main(String[] args) &#123; SpringApplication.run(Application.class, args); &#125;&#125; 123456789101112131415161718192021@Testpublic void test() throws Exception &#123; long start = System.currentTimeMillis(); Future&lt;String&gt; taskOne = task.doTaskOne(); Future&lt;String&gt; taskTwo = task.doTaskTwo(); Future&lt;String&gt; taskThree = task.doTaskThree(); while(true) &#123; if(taskOne.isDone() &amp;&amp; taskTwo.isDone() &amp;&amp; taskThree.isDone()) &#123; // ä¸‰ä¸ªä»»åŠ¡éƒ½è°ƒç”¨å®Œæˆï¼Œé€€å‡ºå¾ªç¯ç­‰å¾… break; &#125; Thread.sleep(1000); &#125; long end = System.currentTimeMillis(); System.out.println(\"All Finishedï¼Œæ€»è€—æ—¶ï¼š\" + (end - start) + \"æ¯«ç§’\");&#125; å®šæ—¶ä»»åŠ¡ é¡¹ç›®å¼€å‘ä¸­ç»å¸¸éœ€è¦æ‰§è¡Œä¸€äº›å®šæ—¶ä»»åŠ¡ï¼Œæ¯”å¦‚éœ€è¦åœ¨æ¯å¤©å‡Œæ™¨æ—¶å€™ï¼Œåˆ†æä¸€æ¬¡å‰ä¸€å¤©çš„æ—¥å¿—ä¿¡æ¯ã€‚Spring ä¸ºæˆ‘ä»¬æä¾›äº†å¼‚æ­¥æ‰§è¡Œä»»åŠ¡è°ƒåº¦çš„æ–¹å¼ï¼Œæä¾› TaskExecutor ã€TaskScheduler æ¥å£ã€‚ æ³¨è§£ï¼š@EnableSchedulingã€@Scheduled corn è¡¨è¾¾å¼ *******ä»å·¦åˆ°å³åˆ†åˆ«ä»£è¡¨ï¼šç§’ åˆ† æ—¶ æ—¥ æœˆ æ˜ŸæœŸ å¹´ä»½ï¼Œè¿™é‡Œ * æŒ‡æ‰€æœ‰å¯èƒ½çš„å€¼ã€‚ åœ¨çº¿ Cron è¡¨è¾¾å¼ç”Ÿæˆå™¨ æµ‹è¯•1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-mail&lt;/artifactId&gt;&lt;/dependency&gt; 1234567891011121314151617@Servicepublic class TaskService &#123; /** * secondï¼ˆç§’ï¼‰, minuteï¼ˆåˆ†ï¼‰, hourï¼ˆæ—¶ï¼‰, day of monthï¼ˆæ—¥ï¼‰, monthï¼ˆæœˆï¼‰, day of weekï¼ˆå‘¨å‡ ï¼‰. * ä¾‹å­ï¼š * 0 0/5 14,18 * * ? æ¯å¤©14ç‚¹æ•´ï¼Œå’Œ18ç‚¹æ•´ï¼Œæ¯éš”5åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ * 0 15 10 ? * 1-6 æ¯ä¸ªæœˆçš„å‘¨ä¸€è‡³å‘¨å…­10:15åˆ†æ‰§è¡Œä¸€æ¬¡ * 0 0 2 ? * 6L æ¯ä¸ªæœˆçš„æœ€åä¸€ä¸ªå‘¨å…­å‡Œæ™¨2ç‚¹æ‰§è¡Œä¸€æ¬¡ * 0 0 2 LW * ? æ¯ä¸ªæœˆçš„æœ€åä¸€ä¸ªå·¥ä½œæ—¥å‡Œæ™¨2ç‚¹æ‰§è¡Œä¸€æ¬¡ * 0 0 2-4 ? * 1#1 æ¯ä¸ªæœˆçš„ç¬¬ä¸€ä¸ªå‘¨ä¸€å‡Œæ™¨2ç‚¹åˆ°4ç‚¹æœŸé—´ï¼Œæ¯ä¸ªæ•´ç‚¹éƒ½æ‰§è¡Œä¸€æ¬¡ï¼› */ @Scheduled(cron = \"0,1,2,3,4 * * * * MON-SAT\") public void runTask()&#123; System.out.println(new Date()+\"Doing Schedule Task\"); &#125;&#125; é‚®ä»¶ä»»åŠ¡ æœ€æ—©æœŸçš„æ—¶å€™ä½¿ç”¨ JavaMail ç›¸å…³ API æ¥å¼€å‘ï¼Œéœ€è¦è‡ªå·±å»å°è£…æ¶ˆæ¯ä½“ï¼Œä»£ç é‡æ¯”è¾ƒåºå¤§ï¼›åæ¥ Spring æ¨å‡ºäº† JavaMailSender ç®€åŒ–äº†é‚®ä»¶å‘é€è¿‡ç¨‹ï¼ŒJavaMailSender æä¾›äº†å¼ºå¤§çš„é‚®ä»¶å‘é€åŠŸèƒ½ï¼Œå¯æ”¯æŒå„ç§ç±»å‹çš„é‚®ä»¶å‘é€ã€‚ç°åœ¨ Spring Boot åœ¨ JavaMailSender çš„åŸºç¡€ä¸Šåˆè¿›è¡Œäº†å°è£…ï¼Œå°±æœ‰äº†ç°åœ¨çš„ spring-boot-starter-mailï¼Œè®©é‚®ä»¶å‘é€æµç¨‹æ›´åŠ ç®€æ´å’Œå®Œå–„ã€‚ æµ‹è¯•1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-mail&lt;/artifactId&gt;&lt;/dependency&gt; 123456spring.mail.username=é‚®ç®±è´¦å·# åœ¨é‚®ä»¶ç«™ç‚¹çš„ä¸ªäººä¸­å¿ƒä¸­è·å–spring.mail.password=xxxxxspring.mail.host=smtp.163.com // é‚®ä»¶åè®®å¯¹åº”çš„æœåŠ¡å™¨spring.mail.protocol=smtp // é‚®ä»¶åè®®spring.mail.properties.mail.smtp.ssl.enable=true 12345678910111213141516@AutowiredJavaMailSenderImpl mailSender;@Testpublic void testSimpleMessage()&#123; SimpleMailMessage message = new SimpleMailMessage(); message.setSubject(\"ç¬¬ä¸€å°æµ‹è¯•é‚®ä»¶\"); message.setText(\"é‚®ä»¶æµ‹è¯•...\"); message.setFrom(\"ä½ çš„é‚®ç®±è´¦å·\"); message.setTo(\"å‘é€å¯¹è±¡çš„é‚®ç®±è´¦å·\"); mailSender.send(message);&#125; 123456789101112131415161718@Testpublic void testMimeMessage() throws Exception&#123; // åˆ›å»ºå¤æ‚æ¶ˆæ¯ MimeMessage mimeMessage = mailSender.createMimeMessage(); MimeMessageHelper helper = new MimeMessageHelper(mimeMessage, true); helper.setSubject(\"ç¬¬äºŒå°é‚®ä»¶\"); helper.setText(\"&lt;b style='color:red'&gt;é‚®ä»¶æµ‹è¯•....&lt;/b&gt;\",true); helper.setFrom(\"ä½ çš„é‚®ç®±è´¦å·\"); helper.setTo(\"å‘é€å¯¹è±¡çš„é‚®ç®±è´¦å·\"); // å‘é€é‚®ä»¶ helper.addAttachment(\"1.jpg\",new File(\"C:\\\\Users\\\\12746\\\\Pictures\\\\22\\\\1.jpg\")); helper.addAttachment(\"2.jpg\",new File(\"C:\\\\Users\\\\12746\\\\Pictures\\\\22\\\\2.jpg\")); mailSender.send(mimeMessage);&#125;","categories":[{"name":"åå°æŠ€æœ¯","slug":"åå°æŠ€æœ¯","permalink":"http://yoursite.com/categories/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"Aysnc","slug":"Aysnc","permalink":"http://yoursite.com/tags/Aysnc/"},{"name":"Scheduled","slug":"Scheduled","permalink":"http://yoursite.com/tags/Scheduled/"},{"name":"Email","slug":"Email","permalink":"http://yoursite.com/tags/Email/"},{"name":"Spring Boot","slug":"Spring-Boot","permalink":"http://yoursite.com/tags/Spring-Boot/"}]},{"title":"Spring Boot å®‰å…¨","slug":"åå°æŠ€æœ¯/Spring Boot/Spring Boot å®‰å…¨","date":"2020-04-01T02:50:45.000Z","updated":"2020-07-10T04:13:18.238Z","comments":true,"path":"2020/04/01/åå°æŠ€æœ¯/Spring Boot/Spring Boot å®‰å…¨/","link":"","permalink":"http://yoursite.com/2020/04/01/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/Spring%20Boot/Spring%20Boot%20%E5%AE%89%E5%85%A8/","excerpt":"Shiro è½»é‡çº§å®‰å…¨æ¡†æ¶çš„ä»‹ç»åŠä½¿ç”¨ï¼›Sping å®‰å…¨æ¡†æ¶ Spring Security çš„ä»‹ç»åŠä½¿ç”¨ã€‚","text":"Shiro è½»é‡çº§å®‰å…¨æ¡†æ¶çš„ä»‹ç»åŠä½¿ç”¨ï¼›Sping å®‰å…¨æ¡†æ¶ Spring Security çš„ä»‹ç»åŠä½¿ç”¨ã€‚ Spring Securityç®€ä»‹ Spring Security æ˜¯é’ˆå¯¹ Spring é¡¹ç›®çš„å®‰å…¨æ¡†æ¶ï¼Œä¹Ÿæ˜¯ Spring Boot åº•å±‚å®‰å…¨æ¨¡å—é»˜è®¤çš„æŠ€æœ¯é€‰å‹ã€‚å¯ä»¥å®ç°å¼ºå¤§çš„ web å®‰å…¨æ§åˆ¶ã€‚å¯¹äºå®‰å…¨æ§åˆ¶ï¼Œæˆ‘ä»¬ä»…éœ€å¼•å…¥ spring-boot-starter-security æ¨¡å—ï¼Œè¿›è¡Œå°‘é‡çš„é…ç½®ï¼Œå³å¯å®ç°å¼ºå¤§çš„å®‰å…¨ç®¡ç†ã€‚ WebSecurityConfigurerAdapterï¼šè‡ªå®šä¹‰ Security ç­–ç•¥ï¼› AuthenticationManagerBuilderï¼šè‡ªå®šä¹‰è®¤è¯ç­–ç•¥ï¼› @EnableWebSecurityï¼šå¼€å¯ WebSecurityã€‚ åº”ç”¨ç¨‹åºçš„ä¸¤ä¸ªä¸»è¦åŒºåŸŸæ˜¯â€œè®¤è¯â€å’Œâ€œæˆæƒâ€ï¼ˆæˆ–è€…è®¿é—®æ§åˆ¶ï¼‰ã€‚è¿™ä¸¤ä¸ªä¸»è¦åŒºåŸŸæ˜¯ Spring Security çš„ä¸¤ä¸ªç›®æ ‡ã€‚ â€œè®¤è¯â€ï¼ˆAuthenticationï¼‰ï¼Œæ˜¯å»ºç«‹ä¸€ä¸ªç»è¿‡å£°æ˜çš„ä¸»ä½“çš„è¿‡ç¨‹ï¼Œå³ä½ æ˜¯è°ï¼› â€œæˆæƒâ€ï¼ˆAuthorizationï¼‰æŒ‡ç¡®å®šä¸€ä¸ªä¸»ä½“æ˜¯å¦å…è®¸åœ¨ä½ çš„åº”ç”¨ç¨‹åºæ‰§è¡Œä¸€ä¸ªåŠ¨ä½œçš„è¿‡ç¨‹ï¼Œå³ä½ èƒ½å¹²ä»€ä¹ˆã€‚ å…¥é—¨å®ä¾‹å¼•å…¥ä¾èµ–ï¼š 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;&lt;/dependency&gt; å»ºç«‹ä¸€ä¸ª Web å±‚çš„è¯·æ±‚æ¥å£ï¼š 12345678@RestController@RequestMapping(\"/user\")public class UserController &#123; @GetMapping public String getUsers() &#123; return \"Hello Spring Security\"; &#125;&#125; è‡ªå®šä¹‰ç”¨æˆ·è®¤è¯é€»è¾‘ ç³»ç»Ÿä¸€èˆ¬éƒ½æœ‰è‡ªå®šä¹‰çš„ç”¨æˆ·ä½“ç³»ï¼ŒSpring Security æä¾›äº†æ¥å£å¯ä»¥è‡ªå®šä¹‰è®¤è¯é€»è¾‘ä»¥åŠç™»å½•ç•Œé¢ã€‚ 1234567// å¯†ç åŠ å¯†æ¥å£public interface PasswordEncoder &#123; // å¯¹å¯†ç è¿›è¡ŒåŠ å¯† String encode(CharSequence var1); // å¯¹å¯†ç è¿›è¡Œåˆ¤æ–­åŒ¹é… boolean matches(CharSequence var1, String var2);&#125; 12345// å®ç° Spring Security ä¸­çš„ PasswordEncoder æ¥ï¼Œè¿™é‡Œç”¨æä¾›çš„é»˜è®¤å®ç°@Beanpublic PasswordEncoder passwordEncoder() &#123; return new BCryptPasswordEncoder(); &#125; é…ç½®ç”¨æˆ·è®¤è¯é€»è¾‘ï¼š UserDetails å°±æ˜¯å°è£…äº†ç”¨æˆ·ä¿¡æ¯çš„å¯¹è±¡ï¼Œè¿”å› UserDetails çš„å®ç°ç±» User çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡ User çš„æ„é€ æ–¹æ³•ï¼Œè®¾ç½®å¯¹åº”çš„å‚æ•°ã€‚ 12345678910111213141516171819@Componentpublic class MyUserDetailsService implements UserDetailsService &#123; private Logger logger = LoggerFactory.getLogger(getClass()); @Override public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException &#123; logger.info(\"ç”¨æˆ·çš„ç”¨æˆ·å: &#123;&#125;\", username); // TODO æ ¹æ®ç”¨æˆ·åï¼ŒæŸ¥æ‰¾åˆ°å¯¹åº”çš„å¯†ç ï¼Œä¸æƒé™ // å°è£…ç”¨æˆ·ä¿¡æ¯ï¼Œå¹¶è¿”å›ã€‚å‚æ•°åˆ†åˆ«æ˜¯ï¼šç”¨æˆ·åï¼Œå¯†ç ï¼Œç”¨æˆ·æƒé™ String password = passwordEncoder.encode(\"123456\"); logger.info(\"password: &#123;&#125;\", password); // æ¯æ¬¡æ‰“å°çš„å¯†ç éƒ½ä¸ä¸€æ ·ï¼Œå› ä¸ºç»è¿‡äº†åŠ å¯† // å‚æ•°åˆ†åˆ«æ˜¯ï¼šç”¨æˆ·åï¼Œå¯†ç ï¼Œç”¨æˆ·æƒé™ User user = new User(username, password, AuthorityUtils.commaSeparatedStringToAuthorityList(\"admin\")); return user; &#125;&#125; è‡ªå®šä¹‰ç™»å½•é¡µé¢ï¼š 12345678910111213141516171819202122232425&lt;!DOCTYPE html&gt;&lt;html lang=\"en\"&gt;&lt;head&gt; &lt;meta charset=\"UTF-8\"&gt; &lt;title&gt;ç™»å½•é¡µé¢&lt;/title&gt;&lt;/head&gt;&lt;body&gt; &lt;h2&gt;è‡ªå®šä¹‰ç™»å½•é¡µé¢&lt;/h2&gt; &lt;form action=\"/user/login\" method=\"post\"&gt; &lt;table&gt; &lt;tr&gt; &lt;td&gt;ç”¨æˆ·åï¼š&lt;/td&gt; &lt;td&gt;&lt;input type=\"text\" name=\"username\"&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;å¯†ç ï¼š&lt;/td&gt; &lt;td&gt;&lt;input type=\"password\" name=\"password\"&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td colspan=\"2\"&gt;&lt;button type=\"submit\"&gt;ç™»å½•&lt;/button&gt;&lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; &lt;/form&gt;&lt;/body&gt;&lt;/html&gt; é…ç½®æ¨¡å—12345678910111213141516@Configurationpublic class BrowerSecurityConfig extends WebSecurityConfigurerAdapter &#123; protected void configure(HttpSecurity http) throws Exception &#123; http.formLogin() // å®šä¹‰å½“éœ€è¦ç”¨æˆ·ç™»å½•æ—¶å€™ï¼Œè½¬åˆ°çš„ç™»å½•é¡µé¢ã€‚ .loginPage(\"/login.html\") // è®¾ç½®ç™»å½•é¡µé¢ .loginProcessingUrl(\"/user/login\") // è‡ªå®šä¹‰çš„ç™»å½•æ¥å£ .and() .authorizeRequests() // å®šä¹‰å“ªäº› URL éœ€è¦è¢«ä¿æŠ¤ï¼Œå“ªäº›ä¸éœ€è¦è¢«ä¿æŠ¤ .antMatchers(\"/login.html\").permitAll() // è®¾ç½®æ‰€æœ‰äººéƒ½å¯ä»¥è®¿é—®ç™»å½•é¡µé¢ .anyRequest() // ä»»ä½•è¯·æ±‚ï¼Œç™»å½•åå¯ä»¥è®¿é—® .authenticated() .and() .csrf().disable(); // å…³é—­ csrf é˜²æŠ¤ &#125;&#125; Shiro Apache Shiroæ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ä¸”æ˜“äºä½¿ç”¨çš„ Javaå®‰ å…¨æ¡†æ¶ï¼Œå®ƒä¸ºå¼€å‘äººå‘˜æä¾›äº†ä¸€ç§ç›´è§‚ï¼Œå…¨é¢çš„èº«ä»½éªŒè¯ï¼Œæˆæƒï¼ŒåŠ å¯†å’Œä¼šè¯ç®¡ç†è§£å†³æ–¹æ¡ˆã€‚ æ ¸å¿ƒ API Subjectï¼š ç”¨æˆ·ä¸»ä½“ï¼ˆæŠŠæ“ä½œäº¤ç»™SecurityManagerï¼‰ï¼›SecurityManagerï¼šå®‰å…¨ç®¡ç†å™¨ï¼ˆå…³è”Realmï¼‰ï¼›Realmï¼šShiro è¿æ¥æ•°æ®çš„æ¡¥æ¢ã€‚ å…¥é—¨å®ä¾‹SQL å»ºè¡¨è¯­å¥ï¼š 1234567CREATE TABLE `user` ( `id` int(11) NOT NULL AUTO_INCREMENT, `username` varbinary(64) DEFAULT NULL, `password` varchar(64) DEFAULT NULL, `perms` varchar(64) DEFAULT NULL, PRIMARY KEY (`id`)) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8 å¯¼å…¥ä¾èµ–ï¼š 12345678910111213141516&lt;!-- shiro --&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.shiro&lt;/groupId&gt; &lt;artifactId&gt;shiro-web&lt;/artifactId&gt; &lt;version&gt;1.4.0&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.shiro&lt;/groupId&gt; &lt;artifactId&gt;shiro-spring&lt;/artifactId&gt; &lt;version&gt;1.4.0&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;com.github.theborakompanioni&lt;/groupId&gt; &lt;artifactId&gt;thymeleaf-extras-shiro&lt;/artifactId&gt; &lt;version&gt;2.0.0&lt;/version&gt;&lt;/dependency&gt; è‡ªå®šä¹‰ Realm ç±»123456789101112131415161718192021222324252627282930313233343536373839@Slf4jpublic class UserRealm extends AuthorizingRealm &#123; @Autowired private UserRepository userRepository; @Override protected AuthorizationInfo doGetAuthorizationInfo(PrincipalCollection arg0) &#123; log.info(\"æ‰§è¡Œæˆæƒé€»è¾‘\"); Subject subject = SecurityUtils.getSubject(); User user = userRepository.findUserByUsername((String) subject.getSession().getAttribute(\"username\")); // ç»™ç”¨æˆ·è¿›è¡Œæˆæƒ SimpleAuthorizationInfo info = new SimpleAuthorizationInfo(); info.addStringPermission(user.getPerms()); return info; &#125; @Override protected AuthenticationInfo doGetAuthenticationInfo(AuthenticationToken arg0) throws AuthenticationException &#123; log.info(\"æ‰§è¡Œè®¤è¯é€»è¾‘\"); Subject subject = SecurityUtils.getSubject(); Session session = subject.getSession(); UsernamePasswordToken token = (UsernamePasswordToken)arg0; User user = userRepository.findUserByUsername(token.getUsername()); session.setAttribute(\"username\", token.getUsername()); if(user==null)&#123; // shiro åº•å±‚ä¼šæŠ›å‡ºUnKnowAccountException return null; &#125; // åˆ¤æ–­å¯†ç  return new SimpleAuthenticationInfo(user,user.getPassword(),getName()); &#125;&#125; Shiro é…ç½®ç±»1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162@Slf4j@Configurationpublic class ShiroConfig &#123; @Autowired @Qualifier(\"shiroCacheManager\") private ShiroCacheManager shiroCacheManager; @Bean public ShiroFilterFactoryBean getShiroFilterFactoryBean(@Autowired DefaultWebSecurityManager securityManager)&#123; ShiroFilterFactoryBean shiroFilterFactoryBean = new ShiroFilterFactoryBean(); // è®¾ç½®å®‰å…¨ç®¡ç†å™¨ shiroFilterFactoryBean.setSecurityManager(securityManager); // æ³¨å…¥ç¼“å­˜ç®¡ç†å™¨ securityManager.setCacheManager(shiroCacheManager); // è®¾ç½®è¿‡æ»¤å™¨é“¾ Map&lt;String,String&gt; filterMap = new LinkedHashMap&lt;&gt;(16); filterMap.put(\"/index\", \"anon\"); filterMap.put(\"/favicon.ico\", \"anon\"); // æ·»åŠ è®¿é—®æƒé™ filterMap.put(\"/toAdd\", \"perms[user:add]\"); filterMap.put(\"/toUpdate\", \"perms[user:update]\"); // æ³¨æ„ï¼šè¦æ”¾åœ¨å…è®¸è®¿é—®çš„é¡µé¢åé¢ï¼Œå¦åˆ™å…è®¸è®¿é—®æ— æ•ˆ filterMap.put(\"/**\", \"authc\"); // å¦‚æœæ²¡æœ‰è®¤è¯é€šè¿‡ è·³è½¬åˆ°çš„ url åœ°å€ shiroFilterFactoryBean.setLoginUrl(\"/login\"); shiroFilterFactoryBean.setSuccessUrl(\"/index\"); // æœªæˆæƒè·³è½¬é¡µé¢ shiroFilterFactoryBean.setUnauthorizedUrl(\"/error\"); shiroFilterFactoryBean.setFilterChainDefinitionMap(filterMap); return shiroFilterFactoryBean; &#125; // å®‰å…¨ç®¡ç†å™¨ @Bean public DefaultWebSecurityManager getDefaultWebSecurityManager(@Autowired UserRealm userRealm)&#123; DefaultWebSecurityManager securityManager = new DefaultWebSecurityManager(); // å…³è” realm securityManager.setRealm(userRealm); return securityManager; &#125; @Bean public UserRealm getRealm()&#123; return new UserRealm(); &#125; /** é…ç½® ShiroDialectï¼Œç”¨äº Thymeleaf å’Œ Shiro æ ‡ç­¾é…åˆä½¿ç”¨ */ // æ·»åŠ  xmlns:shiro=\"http://www.pollix.at/thymeleaf/shiro\" æ ‡ç­¾æ ¡éªŒè§„èŒƒ @Bean public ShiroDialect getShiroDialect()&#123; return new ShiroDialect(); &#125;&#125; æ§åˆ¶å™¨ç±»1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950@Controllerpublic class UserController &#123; @GetMapping(\"/login\") public String login()&#123; return \"login\"; &#125; @GetMapping(\"/index\") public String hello(Model model)&#123; Subject subject = SecurityUtils.getSubject(); model.addAttribute(\"username\", subject.getSession().getAttribute(\"username\")); return \"index\"; &#125; @GetMapping(\"/toAdd\") public String add()&#123; return \"/user/add\"; &#125; @GetMapping(\"/toUpdate\") public String update()&#123; return \"/user/update\"; &#125; @GetMapping(\"/toExit\") public String exit()&#123; Subject subject = SecurityUtils.getSubject(); subject.logout(); return \"redirect:/login\"; &#125; @PostMapping(\"/login\") public String login(String username, String password, Model model)&#123; Subject subject = SecurityUtils.getSubject(); UsernamePasswordToken token = new UsernamePasswordToken(username,password); try &#123; Session session = subject.getSession(); session.setAttribute(\"username\", username); subject.login(token); return \"redirect:/index\"; &#125; catch (UnknownAccountException e) &#123; model.addAttribute(\"msg\", \"ç”¨æˆ·åä¸å­˜åœ¨\"); return \"login\"; &#125;catch (IncorrectCredentialsException e) &#123; model.addAttribute(\"msg\", \"å¯†ç é”™è¯¯\"); return \"login\"; &#125; &#125;&#125; é«˜çº§è‡ªå®šä¹‰ç¼“å­˜ç®¡ç†å™¨ï¼šSpring æ¥ç®¡ Shiro çš„ç¼“å­˜ç®¡ç†ã€‚ å®ç° Shiro æä¾›çš„ Cache å’Œ CacheManager æ¥å£ ğŸ‘‰ å®ç° Cache ç¼“å­˜æ¥å£åº•å±‚ä½¿ç”¨ SpringCache å®ç°ã€‚ ShiroCache12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879/*** è‡ªå®šä¹‰ Shiro ç¼“å­˜ï¼Œå®ç° ShiroCache æ¥å£** @param &lt;K&gt;* @param &lt;V&gt;*/public class ShiroCache&lt;K,V&gt; implements org.apache.shiro.cache.Cache&lt;K,V&gt; &#123; // Spring çš„ç¼“å­˜ç®¡ç†å™¨ private CacheManager springCacheManager; // Spring çš„ç¼“å­˜å¯¹è±¡ private Cache springCache; // æ„é€ å™¨ public ShiroCache(org.springframework.cache.CacheManager springCacheManager, String cacheName) &#123; this.springCacheManager = springCacheManager; this.springCache = springCacheManager.getCache(cacheName); &#125; // è‡ªå®šä¹‰å®ç°ï¼Œéƒ½ç”± Spring çš„ç¼“å­˜å¯¹è±¡è¿›è¡Œæ“ä½œ @Override public V get(K key) throws CacheException &#123; Cache.ValueWrapper valueWrapper = springCache.get(key); if (valueWrapper == null) &#123; return null; &#125; return (V) valueWrapper.get(); &#125; @Override public V put(K key, V value) throws CacheException &#123; springCache.put(key, value); return value; &#125; @Override public V remove(K key) throws CacheException &#123; V value = this.get(key); springCache.evict(key); return value; &#125; /** * æ¸…ç©ºç¼“å­˜ * @throws CacheException */ @Override public void clear() throws CacheException &#123; springCache.clear(); &#125; /** * è·å–æ‰€æœ‰ç¼“å­˜keyçš„é›†åˆ * * @return */ @Override public Set&lt;K&gt; keys() &#123; return (Set&lt;K&gt;) springCacheManager.getCacheNames(); &#125; /** * è·å–æ‰€æœ‰ç¼“å­˜valueå€¼çš„é›†åˆ * * @return */ @Override public Collection&lt;V&gt; values() &#123; List&lt;V&gt; list = new ArrayList&lt;&gt;(); Set&lt;K&gt; keys = keys(); for (K k : keys) &#123; list.add(this.get(k)); &#125; return list; &#125; /** * è·å–ç¼“å­˜å¯¹è±¡çš„æ•°é‡ * * @return */ @Override public int size() &#123; int size = keys().size(); return size; &#125;&#125; ShiroCacheManager12345678910111213public class ShiroCacheManager&lt;K, V&gt; implements CacheManager &#123; // Spring çš„ç¼“å­˜ç®¡ç†å™¨ private org.springframework.cache.CacheManager springCacheManager; public ShiroCacheManager(org.springframework.cache.CacheManager springCacheManager) &#123; this.springCacheManager = springCacheManager; &#125; @Override public &lt;K, V&gt; Cache&lt;K, V&gt; getCache(String cacheName) throws CacheException &#123; // é€šè¿‡ç¼“å­˜ååœ¨ç¼“å­˜ç®¡ç†å™¨ä¸­è·å–å¯¹åº”çš„ç¼“å­˜ return new ShiroCache&lt;&gt;(springCacheManager, cacheName); &#125;&#125; 1234567891011121314151617/*** shiro çš„ç¼“å­˜ç®¡ç†å™¨* @return*/@Bean(name = \"shiroCacheManager\")public ShiroCacheManager shiroCacheManager()&#123; // åˆ›å»ºä¸€ä¸ª Redis ç¼“å­˜çš„é»˜è®¤é…ç½® RedisCacheConfiguration conf = RedisCacheConfiguration.defaultCacheConfig(); // è®¾ç½®ä¼šè¯çš„æœ‰æ•ˆæœŸ conf = conf.entryTtl(Duration.ofSeconds(30)); RedisCacheManager cacheManager = RedisCacheManager .builder(redisConnectionFactory) .cacheDefaults(conf) .build(); // ä¸ç”¨ ShiroCacheManager è¿”å›çš„å…¶å®æ˜¯ä¸€ä¸ª RedisCacheManager return new ShiroCacheManager(cacheManager);&#125; æ³¨å…¥è‡ªå®šä¹‰çš„ç¼“å­˜ç®¡ç†å™¨ 12345678910111213141516@Slf4j@Configurationpublic class ShiroConfig &#123; @Autowired @Qualifier(\"shiroCacheManager\") private ShiroCacheManager shiroCacheManager; @Bean public ShiroFilterFactoryBean getShiroFilterFactoryBean(@Autowired DefaultWebSecurityManager securityManager)&#123; // ... // æ³¨å…¥ç¼“å­˜ç®¡ç†å™¨ securityManager.setCacheManager(shiroCacheManager); // ... &#125;&#125; ShiroSessionDAO1234567891011121314151617181920212223242526272829303132333435363738394041424344454647@Repositorypublic class ShiroSessionDAO extends AbstractSessionDAO &#123; @Autowired private RedisTemplate&lt;Serializable, Session&gt; redisTemplate; private String name = \"shiro-session:\"; private long timeout = 30; @Override protected Serializable doCreate(Session session) &#123; // ç”Ÿæˆä¼šè¯çš„å”¯ä¸€id Serializable sessionId = generateSessionId(session); super.create(session); redisTemplate.opsForValue().set(name + sessionId, session); return sessionId; &#125; @Override protected Session doReadSession(Serializable sessionId) &#123; super.readSession(sessionId); // æ›´æ–°ç¼“å­˜ redisTemplate.expire(sessionId, timeout, TimeUnit.MINUTES); return redisTemplate.opsForValue().get(sessionId); &#125; @Override public void update(Session session) throws UnknownSessionException &#123; redisTemplate.opsForValue().set(name + session.getId(), session); &#125; @Override public void delete(Session session) &#123; redisTemplate.delete(name + session.getId()); &#125; @Override public Collection&lt;Session&gt; getActiveSessions() &#123; Set&lt;Serializable&gt; set = redisTemplate.keys(name + \"*\"); List&lt;Session&gt; sessionList = new ArrayList&lt;&gt;(); for (Serializable sessionId : set) &#123; sessionList.add(redisTemplate.opsForValue().get(name + sessionId)); &#125; return sessionList; &#125;&#125; é…ç½®ç±»123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100@Configurationpublic class ShiroConfig &#123; @Autowired @Qualifier(\"shiroCacheManager\") private ShiroCacheManager shiroCacheManager; /** * é…ç½®è‡ªå®šä¹‰SessionDAO * @return */ @Bean public SessionDAO sessionDAO() &#123; SessionDAO sessionDAO = new ShiroSessionDAO(shiroCacheManager); return sessionDAO; &#125; /** * é…ç½®ä¼šè¯ç®¡ç†å™¨ * @return */ @Bean public SessionManager sessionManager()&#123; // WEB ç¯å¢ƒé HttpSession ä¼šè¯ç®¡ç†å™¨ DefaultWebSessionManager sessionManager = new DefaultWebSessionManager(); // æ³¨å…¥è‡ªå®šä¹‰çš„ SessionDao sessionManager.setSessionDAO(sessionDAO()); return sessionManager; &#125; /** * é…ç½®å®‰å…¨ç®¡ç†å™¨ * * @return */ @Bean public SecurityManager securityManager() &#123; DefaultWebSecurityManager securityManager = new DefaultWebSecurityManager(); // æ³¨å…¥è‡ªå®šä¹‰Realm securityManager.setRealm(shiroRealm()); // æ³¨å…¥ç¼“å­˜ç®¡ç†å™¨ securityManager.setCacheManager(shiroCacheManager); // æ³¨å…¥ä¼šè¯ç®¡ç†å™¨ securityManager.setSessionManager(sessionManager()); return securityManager; &#125; /** * è£…é… è‡ªå®šä¹‰Realm * * @return */ @Bean public ShiroRealm shiroRealm() &#123; return new ShiroRealm(); &#125; /** * é…ç½®æƒé™æƒé™è¿‡æ»¤å™¨ * @return */ @Bean public ShiroFilterFactoryBean shiroFilterFactoryBean() &#123; ShiroFilterFactoryBean filter = new ShiroFilterFactoryBean(); // æ³¨å…¥å®‰å…¨ç®¡ç†å™¨ filter.setSecurityManager(securityManager()); // æœªè®¤è¯çš„è·³è½¬åœ°å€ filter.setLoginUrl(\"/login\"); Map&lt;String, String&gt; chain = new LinkedHashMap&lt;&gt;(); chain.put(\"/login\", \"anon\"); // ç™»å½•é“¾æ¥ä¸æ‹¦æˆª chain.put(\"/css/**\", \"anon\"); chain.put(\"/img/**\", \"anon\"); chain.put(\"/js/**\", \"anon\"); chain.put(\"/lib/**\", \"anon\"); chain.put(\"/**\", \"user\"); filter.setFilterChainDefinitionMap(chain); return filter; &#125; /** * å¯ç”¨ Shiro æ³¨è§£ * @return */ @Bean public AuthorizationAttributeSourceAdvisor authorizationAttributeSourceAdvisor() &#123; AuthorizationAttributeSourceAdvisor advisor = new AuthorizationAttributeSourceAdvisor(); // æ³¨å…¥å®‰å…¨ç®¡ç†å™¨ advisor.setSecurityManager(securityManager()); return advisor; &#125; /** * å¯ç”¨ Shiro Thymeleaf æ ‡ç­¾æ”¯æŒ * @return */ @Bean public ShiroDialect shiroDialect() &#123; return new ShiroDialect(); &#125;&#125;","categories":[{"name":"åå°æŠ€æœ¯","slug":"åå°æŠ€æœ¯","permalink":"http://yoursite.com/categories/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"Spring Boot","slug":"Spring-Boot","permalink":"http://yoursite.com/tags/Spring-Boot/"},{"name":"Security","slug":"Security","permalink":"http://yoursite.com/tags/Security/"},{"name":"Shiro","slug":"Shiro","permalink":"http://yoursite.com/tags/Shiro/"}]},{"title":"Spring Boot æ£€ç´¢","slug":"åå°æŠ€æœ¯/Spring Boot/Spring Boot æ£€ç´¢","date":"2020-03-31T06:50:45.000Z","updated":"2020-07-10T04:13:23.189Z","comments":true,"path":"2020/03/31/åå°æŠ€æœ¯/Spring Boot/Spring Boot æ£€ç´¢/","link":"","permalink":"http://yoursite.com/2020/03/31/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/Spring%20Boot/Spring%20Boot%20%E6%A3%80%E7%B4%A2/","excerpt":"ElasticSearch åŸºæœ¬ä»‹ç»ä»¥åŠåœ¨ Spring Boot ä¸­çš„æ•´åˆä½¿ç”¨ã€‚","text":"ElasticSearch åŸºæœ¬ä»‹ç»ä»¥åŠåœ¨ Spring Boot ä¸­çš„æ•´åˆä½¿ç”¨ã€‚ ElasticSearchå¦‚ä»Šçš„åº”ç”¨ç»å¸¸éœ€è¦æ·»åŠ æ£€ç´¢åŠŸèƒ½ï¼Œå¼€æºçš„ ElasticSearch æ˜¯ç›®å‰å…¨æ–‡æœç´¢å¼•æ“çš„é¦–é€‰ã€‚ä»–å¯ä»¥å¿«é€Ÿçš„å­˜å‚¨ã€æœç´¢å’Œåˆ†ææµ·é‡æ•°æ®ã€‚Spring Boot é€šè¿‡æ•´åˆ Spring Data ElasticSearch ä¸ºæˆ‘ä»¬æä¾›äº†éå¸¸ä¾¿æ·çš„æ£€ç´¢åŠŸèƒ½æ”¯æŒã€‚ Elasticsearch æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æœç´¢æœåŠ¡ï¼Œæä¾› Restful APIï¼Œåº•å±‚åŸºäº Luceneï¼Œé‡‡ç”¨å¤š shardï¼ˆåˆ†ç‰‡ï¼‰çš„æ–¹å¼ä¿è¯æ•°æ®å®‰å…¨ï¼Œå¹¶ä¸”æä¾›è‡ªåŠ¨ resharding çš„åŠŸèƒ½ï¼Œgithub ç­‰å¤§å‹çš„ç«™ç‚¹ä¹Ÿæ˜¯é‡‡ç”¨äº† ElasticSearch ä½œä¸ºå…¶æœç´¢æœåŠ¡ã€‚ Elasticsearch æœ¬èº«å°±æ˜¯åˆ†å¸ƒå¼çš„ï¼Œå³ä¾¿åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼ŒElasticsearch é»˜è®¤ä¹Ÿä¼šå¯¹çš„æ•°æ®è¿›è¡Œåˆ†ç‰‡å’Œå‰¯æœ¬æ“ä½œï¼Œå‘é›†ç¾¤æ·»åŠ æ–°æ•°æ®æ—¶ï¼Œæ•°æ®ä¹Ÿä¼šåœ¨æ–°åŠ å…¥çš„èŠ‚ç‚¹ä¸­è¿›è¡Œå¹³è¡¡ ç›¸å…³æ¦‚å¿µä¸€ä¸ª ElasticSearch é›†ç¾¤å¯ä»¥åŒ…å«å¤šä¸ªç´¢å¼• ï¼Œç›¸åº”çš„æ¯ä¸ªç´¢å¼•å¯ä»¥åŒ…å«å¤šä¸ªç±»å‹ ã€‚è¿™äº›ä¸åŒçš„ç±»å‹å­˜å‚¨ç€å¤šä¸ªæ–‡æ¡£ ï¼Œæ¯ä¸ªæ–‡æ¡£åˆæœ‰å¤šä¸ªå±æ€§ ã€‚ Elasticsearch ä¹Ÿæ˜¯åŸºäº Lucene çš„å…¨æ–‡æ£€ç´¢åº“ï¼Œæœ¬è´¨ä¹Ÿæ˜¯å­˜å‚¨æ•°æ®ï¼Œå¾ˆå¤šæ¦‚å¿µä¸å…³ç³»å‹æ•°æ®åº“æ˜¯ä¸€è‡´çš„ï¼Œå¦‚ä¸‹å¯¹ç…§ï¼š ç´¢å¼•åº“ å…³ç³»å‹æ•°æ®åº“ ç±»å‹ï¼ˆtypeï¼‰ Table æ•°æ®è¡¨ æ–‡æ¡£ï¼ˆDocumentï¼‰ Row è¡Œ å­—æ®µï¼ˆFieldï¼‰ Columns åˆ— å¦å¤–ï¼Œåœ¨ Elasticsearch æœ‰ä¸€äº›é›†ç¾¤ç›¸å…³çš„æ¦‚å¿µï¼š ç´¢å¼•é›†ï¼ˆIndicesï¼Œindex çš„å¤æ•°ï¼‰ï¼šé€»è¾‘ä¸Šçš„å®Œæ•´ç´¢å¼•ï¼› åˆ†ç‰‡ï¼ˆshardï¼‰ï¼šæ•°æ®æ‹†åˆ†åçš„å„ä¸ªéƒ¨åˆ†ï¼› å‰¯æœ¬ï¼ˆreplicaï¼‰ï¼šæ¯ä¸ªåˆ†ç‰‡çš„å¤åˆ¶ã€‚ æ•´åˆ Spring Boot æä¾›äº†ä¸¤ç§æ–¹å¼æ“ä½œ Elasticsearchï¼ŒJest å’Œ SpringDataã€‚ Docker å®‰è£…éƒ¨ç½² ElasticSearch 12345# ä¸‹è½½é•œåƒdocker pull elasticsearch# Elasticsearch å¯åŠ¨æ˜¯ä¼šé»˜è®¤åˆ†é… 2G çš„å†…å­˜ ï¼Œæˆ‘ä»¬å¯åŠ¨æ˜¯è®¾ç½®å°ä¸€ç‚¹ï¼Œé˜²æ­¢æˆ‘ä»¬å†…å­˜ä¸å¤Ÿå¯åŠ¨å¤±è´¥# 9200 æ˜¯ Elasticsearch é»˜è®¤çš„ web é€šä¿¡æ¥å£ï¼Œ9300 æ˜¯åˆ†å¸ƒå¼æƒ…å†µä¸‹ï¼ŒElasticsearch å„ä¸ªèŠ‚ç‚¹çš„é€šä¿¡ç«¯å£docker run -e ES_JAVA_OPTS=\"-Xms256m -Xmx256m\" -d -p 9200:9200 -p 9300:9300 --name es01 5c1e1ecfe33a Jest ElasticSearch already has a Java API which is also used by ElasticSearch internally, but Jest fills a gap, it is the missing client for ElasticSearch Http Rest interface. æ·»åŠ ä¾èµ–ï¼š 12345&lt;dependency&gt; &lt;groupId&gt;io.searchbox&lt;/groupId&gt; &lt;artifactId&gt;jest&lt;/artifactId&gt; &lt;version&gt;5.3.3&lt;/version&gt;&lt;/dependency&gt; é…ç½®æœåŠ¡å™¨ï¼š 1spring.elasticsearch.jest.uris=http://127.0.0.1:9200 ## Elasticsearch æœåŠ¡å™¨ ç¼–å†™å®ä½“ç±»ï¼š 12345678910111213141516171819202122232425public class Article &#123; // If @JestId value is null, it will be set the value of ElasticSearch generated \"_id\". @JestId // @JestId annotation can be used to mark a property of a bean as id private Integer id; private String author; private String title; private String content; // Getter / Setter @Override public String toString() &#123; final StringBuilder sb = new StringBuilder( \"&#123;\\\"Article\\\":&#123;\" ); sb.append( \"\\\"id\\\":\" ) .append( id ); sb.append( \",\\\"author\\\":\\\"\" ) .append( author ).append( '\\\"' ); sb.append( \",\\\"title\\\":\\\"\" ) .append( title ).append( '\\\"' ); sb.append( \",\\\"content\\\":\\\"\" ) .append( content ).append( '\\\"' ); sb.append( \"&#125;&#125;\" ); return sb.toString(); &#125;&#125; æµ‹è¯•12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849@RunWith(SpringRunner.class)@SpringBootTestpublic class SpringbootElasticsearchApplicationTests &#123; @Autowired JestClient jestClient; @Test public void createIndex() &#123; // åˆå§‹åŒ–ä¸€ä¸ªæ–‡æ¡£ Article article = new Article(); article.setId( 1 ); article.setTitle( \"å¥½æ¶ˆæ¯\" ); article.setAuthor( \"å¼ ä¸‰\" ); article.setContent( \"Hello World\" ); // æ„å»ºä¸€ä¸ªç´¢å¼• Index index = new Index.Builder(article).index(\"shekou\").type(\"news\").build(); try &#123; // æ‰§è¡Œ jestClient.execute(index); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; @Test public void search() &#123; // æŸ¥è¯¢è¡¨è¾¾å¼ String query = \"&#123;\\n\" + \" \\\"query\\\" : &#123;\\n\" + \" \\\"match\\\" : &#123;\\n\" + \" \\\"content\\\" : \\\"hello\\\"\\n\" + \" &#125;\\n\" + \" &#125;\\n\" + \"&#125;\"; // æ„å»ºæœç´¢åŠŸèƒ½ Search search = new Search.Builder(query).addIndex(\"shekou\").addType(\"news\").build(); try &#123; // æ‰§è¡Œ SearchResult result = jestClient.execute(search); System.out.println(result.getJsonString()); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125;&#125; æœç´¢è¡¨è¾¾å¼æŸ¥è¯¢ï¼š Searching Document Spring Dataspring-data-elasticsearch ä½¿ç”¨ä¹‹å‰å¿…é¡»å…ˆç¡®å®š Elasticsearch ç‰ˆæœ¬ï¼šç‚¹å‡»æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ Spring Data é€šè¿‡æ³¨è§£æ¥å£°æ˜å­—æ®µçš„æ˜ å°„å±æ€§ï¼Œæ³¨è§£çš„è¯¦ç»†ç”¨æ³•ï¼š @Document ä½œç”¨åœ¨ç±»ï¼Œæ ‡è®°å®ä½“ç±»ä¸ºæ–‡æ¡£å¯¹è±¡ï¼Œä¸€èˆ¬æœ‰ä¸¤ä¸ªå±æ€§ï¼š indexNameï¼šå¯¹åº”ç´¢å¼•åº“åç§°ï¼› typeï¼šå¯¹åº”åœ¨ç´¢å¼•åº“ä¸­çš„ç±»å‹ï¼› shardsï¼šåˆ†ç‰‡æ•°é‡ï¼Œé»˜è®¤5ï¼› replicasï¼šå‰¯æœ¬æ•°é‡ï¼Œé»˜è®¤1ã€‚ @Idä½œç”¨åœ¨æˆå‘˜å˜é‡ï¼Œæ ‡è®°ä¸€ä¸ªå­—æ®µä½œä¸º id ä¸»é”®ã€‚ @Fieldä½œç”¨åœ¨æˆå‘˜å˜é‡ï¼Œæ ‡è®°ä¸ºæ–‡æ¡£çš„å­—æ®µï¼Œå¹¶æŒ‡å®šå­—æ®µæ˜ å°„å±æ€§ï¼š typeï¼šå­—æ®µç±»å‹ï¼Œæ˜¯æšä¸¾ï¼šFieldTypeï¼Œå¯ä»¥æ˜¯ textã€longã€shortã€dateã€integerã€object ç­‰ï¼š Textï¼šå­˜å‚¨æ•°æ®æ—¶å€™ï¼Œä¼šè‡ªåŠ¨åˆ†è¯ï¼Œå¹¶ç”Ÿæˆç´¢å¼•ï¼› Keywordï¼šå­˜å‚¨æ•°æ®æ—¶å€™ï¼Œä¸ä¼šåˆ†è¯å»ºç«‹ç´¢å¼•ï¼› Numericalï¼šæ•°å€¼ç±»å‹ï¼Œåˆ†ä¸¤ç±»ï¼š åŸºæœ¬æ•°æ®ç±»å‹ï¼šlongã€intergerã€shortã€byteã€doubleã€floatã€half_floatï¼› æµ®ç‚¹æ•°çš„é«˜ç²¾åº¦ç±»å‹ï¼šscaled_float éœ€è¦æŒ‡å®šä¸€ä¸ªç²¾åº¦å› å­ï¼Œæ¯”å¦‚ 10 æˆ– 100ã€‚Elasticsearch ä¼šæŠŠçœŸå®å€¼ä¹˜ä»¥è¿™ä¸ªå› å­åå­˜å‚¨ï¼Œå–å‡ºæ—¶å†è¿˜åŸã€‚ Dateï¼šæ—¥æœŸç±»å‹ Elasticsearch å¯ä»¥å¯¹æ—¥æœŸæ ¼å¼åŒ–ä¸ºå­—ç¬¦ä¸²å­˜å‚¨ï¼Œä½†æ˜¯å»ºè®®æˆ‘ä»¬å­˜å‚¨ä¸ºæ¯«ç§’å€¼ï¼Œå­˜å‚¨ä¸º longï¼ŒèŠ‚çœç©ºé—´ã€‚ indexï¼šæ˜¯å¦ç´¢å¼•ï¼Œå¸ƒå°”ç±»å‹ï¼Œé»˜è®¤æ˜¯trueï¼› storeï¼šæ˜¯å¦å­˜å‚¨ï¼Œå¸ƒå°”ç±»å‹ï¼Œé»˜è®¤æ˜¯falseï¼› analyzerï¼šåˆ†è¯å™¨åç§°ã€‚ CRUD Spring Data çš„å¼ºå¤§ä¹‹å¤„ï¼Œå°±åœ¨äºä½ ä¸ç”¨å†™ä»»ä½• DAO å¤„ç†ï¼Œè‡ªåŠ¨æ ¹æ®æ–¹æ³•åæˆ–ç±»çš„ä¿¡æ¯è¿›è¡Œ CRUD æ“ä½œã€‚åªè¦ä½ å®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œç„¶åç»§æ‰¿ Repository æä¾›çš„ä¸€äº›å­æ¥å£ï¼Œå°±èƒ½å…·å¤‡å„ç§åŸºæœ¬çš„ CRUD åŠŸèƒ½ã€‚ 123public interface ItemRepository extends ElasticsearchRepository&lt;Item,Long&gt; &#123;&#125; æµ‹è¯•12345678910111213141516171819202122// åˆ›å»ºä¸€ä¸ªå®ä½“ç±»å¹¶æ ‡æ³¨ä¸ºæ–‡æ¡£@Document(indexName = \"item\", type = \"docs\", shards = 1, replicas = 0)public class Item &#123; @Id private Long id; @Field(type = FieldType.Text) private String title; @Field(type = FieldType.Keyword) private String category; @Field(type = FieldType.Keyword) private String brand; @Field(type = FieldType.Double) private Double price; @Field(index = false, type = FieldType.Keyword) private String images;&#125; è°ƒç”¨ elasticsearchTemplate åˆ›å»ºç´¢å¼•å¹¶æ˜ å°„ï¼š 1234567891011121314151617181920@RunWith(SpringRunner.class)@SpringBootTest(classes = EsDemoApplication.class)public class EsDemoApplicationTests &#123; @Autowired private ElasticsearchTemplate elasticsearchTemplate; @Test public void testCreateIndex() &#123; // æ ¹æ® Item ç±»çš„ @Document æ³¨è§£ä¿¡æ¯æ¥åˆ›å»º elasticsearchTemplate.createIndex(Item.class); &#125; @Test public void insert() &#123; Item item = new Item(1L, \"Redmi\", \" æ‰‹æœº\", \"å°ç±³\", 1499.00, \"RedmiImage.jpg\"); itemRepository.save(item); &#125;&#125;","categories":[{"name":"åå°æŠ€æœ¯","slug":"åå°æŠ€æœ¯","permalink":"http://yoursite.com/categories/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"Spring Boot","slug":"Spring-Boot","permalink":"http://yoursite.com/tags/Spring-Boot/"},{"name":"ElasticSearch","slug":"ElasticSearch","permalink":"http://yoursite.com/tags/ElasticSearch/"}]},{"title":"Spring Boot æ¶ˆæ¯ä¸­é—´ä»¶","slug":"åå°æŠ€æœ¯/Spring Boot/Spring Boot æ¶ˆæ¯é˜Ÿåˆ—","date":"2020-03-31T03:50:45.000Z","updated":"2020-07-10T04:13:46.155Z","comments":true,"path":"2020/03/31/åå°æŠ€æœ¯/Spring Boot/Spring Boot æ¶ˆæ¯é˜Ÿåˆ—/","link":"","permalink":"http://yoursite.com/2020/03/31/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/Spring%20Boot/Spring%20Boot%20%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/","excerpt":"MQ åŸºæœ¬ä»‹ç»ä»¥åŠä¸ Spring Boot çš„æ•´åˆä½¿ç”¨ã€‚","text":"MQ åŸºæœ¬ä»‹ç»ä»¥åŠä¸ Spring Boot çš„æ•´åˆä½¿ç”¨ã€‚ æ¦‚è¿°åœ¨å¤§å¤šæ•°åº”ç”¨ç¨‹åºä¸­ï¼Œå¯é€šè¿‡æ¶ˆæ¯æœåŠ¡ä¸­é—´ä»¶æ¥æå‡ç³»ç»Ÿå¼‚æ­¥é€šä¿¡ã€æ‰©å±•è§£è€¦èƒ½åŠ›ã€‚ æ¶ˆæ¯ä»£ç†ï¼ˆmessage brokerï¼‰ï¼›ç›®çš„åœ°ï¼ˆdestinationï¼‰ã€‚ å½“æ¶ˆæ¯å‘é€è€…å‘é€æ¶ˆæ¯ä»¥åï¼Œå°†ç”±æ¶ˆæ¯ä»£ç†æ¥ç®¡ï¼Œæ¶ˆæ¯ä»£ç†ä¿è¯æ¶ˆæ¯ä¼ é€’åˆ°æŒ‡å®šç›®çš„åœ°ã€‚æ¶ˆæ¯é˜Ÿåˆ—ä¸»è¦æœ‰ä¸¤ç§å½¢å¼çš„ç›®çš„åœ°ã€‚ é˜Ÿåˆ—ï¼ˆqueueï¼‰ï¼šç‚¹å¯¹ç‚¹æ¶ˆæ¯é€šä¿¡ï¼ˆpoint-to-pointï¼‰ï¼›ä¸»é¢˜ï¼ˆtopicï¼‰ï¼šå‘å¸ƒï¼ˆpublishï¼‰/ è®¢é˜…ï¼ˆsubscribeï¼‰æ¶ˆæ¯é€šä¿¡ã€‚ åº”ç”¨åœºæ™¯ï¼šå¼‚æ­¥å¤„ç†ï¼ˆé‚®ä»¶ï¼‰ã€åº”ç”¨è§£è€¦ã€æµé‡å‰Šå³°ï¼ˆç§’æ€ï¼‰ã€‚ JMSï¼šJava æ¶ˆæ¯æœåŠ¡ï¼ˆJava Message Serviceï¼‰åº”ç”¨ç¨‹åºæ¥å£æ˜¯ä¸€ä¸ª Java å¹³å°ä¸­å…³äºé¢å‘æ¶ˆæ¯ä¸­é—´ä»¶ï¼ˆMOMï¼‰çš„ APIï¼Œç”¨äºåœ¨ä¸¤ä¸ªåº”ç”¨ç¨‹åºä¹‹é—´ï¼Œæˆ–åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å‘é€æ¶ˆæ¯ï¼Œè¿›è¡Œå¼‚æ­¥é€šä¿¡ã€‚Java æ¶ˆæ¯æœåŠ¡æ˜¯ä¸€ä¸ªä¸å…·ä½“å¹³å°æ— å…³çš„APIï¼Œç»å¤§å¤šæ•° MOM æä¾›å•†éƒ½å¯¹ JMS æä¾›æ”¯æŒã€‚ AMQPï¼šé«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼ˆAdvanced Message Queuing Protocolï¼‰, å¯¹äºé¢å‘æ¶ˆæ¯ä¸­é—´ä»¶çš„åº”ç”¨å±‚åè®®ã€‚ å¸¸è§æ¶ˆæ¯ä¸­é—´ä»¶ActiveMQ Apache ActiveMQ æ˜¯ Apache è½¯ä»¶åŸºé‡‘ä¼šæ‰€ç ”å‘çš„å¼€æ”¾æºä»£ç æ¶ˆæ¯ä¸­é—´ä»¶ã€‚ RabbitMQ RabbitMQ æ˜¯å®ç°äº†é«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼ˆAMQPï¼‰çš„å¼€æºæ¶ˆæ¯ä»£ç†è½¯ä»¶ï¼ˆäº¦ç§°é¢å‘æ¶ˆæ¯çš„ä¸­é—´ä»¶ï¼‰ã€‚RabbitMQ æœåŠ¡å™¨æ˜¯ç”¨ Erlang è¯­è¨€ç¼–å†™çš„ï¼Œ Kafka å‘å¸ƒè®¢é˜…æ¶ˆæ¯ç³»ç»Ÿã€åˆ†å¸ƒå¼æ—¥å¿—æœåŠ¡ã€‚æœ¬èº«æ˜¯åšæ—¥å¿—å‚¨å­˜çš„ï¼Œæ‰€ä»¥å¯¹æ¶ˆæ¯çš„é¡ºåºæœ‰ä¸¥æ ¼çš„è¦æ±‚ã€‚å¼€æºæµå¤„ç†å¹³å°ï¼Œç”± Scala å’Œ java ç¼–å†™ï¼Œç›®æ ‡æ˜¯ä¸ºå¤„ç†å®æ—¶æ•°æ®æä¾›ä¸€ä¸ªç»Ÿä¸€ã€é«˜ååã€ä½å»¶è¿Ÿçš„å¹³å°ã€‚å…¶æŒä¹…åŒ–å±‚æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæŒ‰ç…§åˆ†å¸ƒå¼äº‹åŠ¡æ—¥å¿—æ¶æ„çš„å¤§è§„æ¨¡å‘å¸ƒ / è®¢é˜…æ¶ˆæ¯é˜Ÿåˆ—ã€‚ ç¼–ç æ¥å£JMS ç¼–ç æ¥å£ï¼š ConnectionFactoryï¼šåˆ›å»ºè¿æ¥åˆ°æ¶ˆæ¯ä¸­é—´ä»¶çš„è¿æ¥å·¥å‚ï¼› Connectionï¼šé€šä¿¡é“¾è·¯ï¼› Destinationï¼šæ¶ˆæ¯å‘å¸ƒå’Œæ¥æ”¶çš„åœ°ç‚¹ï¼ŒåŒ…æ‹¬é˜Ÿåˆ—å’Œä¸»é¢˜ï¼› Sessionï¼šä¼šè¯ï¼Œè¡¨ç¤ºä¸€ä¸ªå•çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ï¼› MessageConsumerï¼šä¼šè¯åˆ›å»ºï¼Œç”¨äºæ¥æ”¶æ¶ˆæ¯ï¼› MessageProducerï¼šä¼šè¯åˆ›å»ºï¼Œç”¨äºå‘é€æ¶ˆæ¯ï¼› Messageï¼šæ¶ˆæ¯å¯¹è±¡ï¼ŒåŒ…æ‹¬æ¶ˆæ¯å¤´ï¼Œæ¶ˆæ¯å±æ€§ï¼Œæ¶ˆæ¯ä½“ã€‚ ä¸€ä¸ª Connection å¯ä»¥åˆ›å»ºå¤šä¸ªä¼šè¯ï¼Œå³ä¸€ä¸ªè¿æ¥å¯ä»¥ä¾›å¤šä¸ªçº¿ç¨‹ä½¿ç”¨ã€‚ Spring æ”¯æŒ spring-jms æä¾›äº†å¯¹ JMS çš„æ”¯æŒï¼›spring-rabbit æä¾›äº†å¯¹ AMQP çš„æ”¯æŒã€‚ éœ€è¦ ConnectionFactory çš„å®ç°æ¥è¿æ¥æ¶ˆæ¯ä»£ç†ï¼› æä¾› JmsTemplateã€RabbitTemplate æ¥å‘é€æ¶ˆæ¯ï¼› @JmsListenerï¼ˆJMSï¼‰ã€@RabbitListenerï¼ˆAMQPï¼‰æ³¨è§£åœ¨æ–¹æ³•ä¸Šç›‘å¬æ¶ˆæ¯ä»£ç†å‘å¸ƒçš„æ¶ˆæ¯ï¼› @EnableJmsã€@EnableRabbit å¼€å¯æ”¯æŒã€‚ Spring Boot è‡ªåŠ¨é…ç½® JmsAutoConfigurationã€RabbitAutoConfiguration RabbitMQæ ¸å¿ƒæ¦‚å¿µMessage æ¶ˆæ¯ï¼šæ¶ˆæ¯æ˜¯ä¸å…·åçš„ï¼Œå®ƒç”±æ¶ˆæ¯å¤´å’Œæ¶ˆæ¯ä½“ç»„æˆã€‚æ¶ˆæ¯ä½“æ˜¯ä¸é€æ˜çš„ï¼Œè€Œæ¶ˆæ¯å¤´åˆ™ç”±ä¸€ç³»åˆ—çš„å¯é€‰å±æ€§ç»„æˆï¼Œè¿™äº›å±æ€§åŒ…æ‹¬ routing-keyï¼ˆè·¯ç”±é”®ï¼‰ã€priorityï¼ˆç›¸å¯¹äºå…¶ä»–æ¶ˆæ¯çš„ä¼˜å…ˆæƒï¼‰ã€delivery-modeï¼ˆæŒ‡å‡ºè¯¥æ¶ˆæ¯å¯èƒ½éœ€è¦æŒä¹…æ€§å­˜å‚¨ï¼‰ç­‰ã€‚ Publisher æ¶ˆæ¯çš„ç”Ÿäº§è€…ï¼šæ˜¯ä¸€ä¸ªå‘äº¤æ¢å™¨å‘å¸ƒæ¶ˆæ¯çš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºã€‚ Exchange äº¤æ¢å™¨ï¼šç”¨æ¥æ¥æ”¶ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯å¹¶å°†è¿™äº›æ¶ˆæ¯è·¯ç”±ç»™æœåŠ¡å™¨ä¸­çš„é˜Ÿåˆ—ã€‚Exchange æœ‰ 4 ç§ç±»å‹ï¼šdirectï¼ˆé»˜è®¤ï¼šrouting key = binding keyï¼‰ã€fanoutï¼ˆå¹¿æ’­ï¼‰ã€ topic,ã€å’Œ headersï¼ˆåŒ¹é…æ¶ˆæ¯çš„ Header è€Œä¸æ˜¯è·¯ç”±é”®ï¼‰ï¼Œä¸åŒç±»å‹çš„ Exchange è½¬å‘æ¶ˆæ¯çš„ç­–ç•¥æœ‰æ‰€åŒºåˆ«ã€‚ topic äº¤æ¢å™¨é€šè¿‡æ¨¡å¼åŒ¹é…åˆ†é…æ¶ˆæ¯çš„è·¯ç”±é”®å±æ€§ï¼Œå°†è·¯ç”±é”®å’ŒæŸä¸ªæ¨¡å¼è¿›è¡ŒåŒ¹é…ï¼Œæ­¤æ—¶é˜Ÿåˆ—éœ€è¦ç»‘å®šåˆ°ä¸€ä¸ªæ¨¡å¼ä¸Šã€‚å®ƒå°†è·¯ç”±é”®å’Œç»‘å®šé”®çš„å­—ç¬¦ä¸²åˆ‡åˆ†æˆå•è¯ï¼Œè¿™äº›å•è¯ä¹‹é—´ç”¨ç‚¹éš”å¼€ã€‚å®ƒåŒæ ·ä¹Ÿä¼šè¯†åˆ«ä¸¤ä¸ªé€šé…ç¬¦ï¼š # åŒ¹é… 0 ä¸ªæˆ–å¤šä¸ªå•è¯ï¼›*åŒ¹é…ä¸€ä¸ªå•è¯ã€‚ Queue æ¶ˆæ¯é˜Ÿåˆ—ï¼šç”¨æ¥ä¿å­˜æ¶ˆæ¯ç›´åˆ°å‘é€ç»™æ¶ˆè´¹è€…ã€‚å®ƒæ˜¯æ¶ˆæ¯çš„å®¹å™¨ï¼Œä¹Ÿæ˜¯æ¶ˆæ¯çš„ç»ˆç‚¹ã€‚ä¸€ä¸ªæ¶ˆæ¯å¯æŠ•å…¥ä¸€ä¸ªæˆ–å¤šä¸ªé˜Ÿåˆ—ã€‚æ¶ˆæ¯ä¸€ç›´åœ¨é˜Ÿåˆ—é‡Œé¢ï¼Œç­‰å¾…æ¶ˆè´¹è€…è¿æ¥åˆ°è¿™ä¸ªé˜Ÿåˆ—å°†å…¶å–èµ°ã€‚ Binding ç»‘å®šï¼šç”¨äºæ¶ˆæ¯é˜Ÿåˆ—å’Œäº¤æ¢å™¨ä¹‹é—´çš„å…³è”ã€‚ä¸€ä¸ªç»‘å®šå°±æ˜¯åŸºäºè·¯ç”±é”®å°†äº¤æ¢å™¨å’Œæ¶ˆæ¯é˜Ÿåˆ—è¿æ¥èµ·æ¥çš„è·¯ç”±è§„åˆ™ï¼Œæ‰€ä»¥å¯ä»¥å°†äº¤æ¢å™¨ç†è§£æˆä¸€ä¸ªç”±ç»‘å®šæ„æˆçš„è·¯ç”±è¡¨ã€‚ Exchange å’Œ Queue çš„ç»‘å®šå¯ä»¥æ˜¯å¤šå¯¹å¤šçš„å…³ç³»ã€‚ Connection ç½‘ç»œè¿æ¥ï¼šæ¯”å¦‚ä¸€ä¸ªTCPè¿æ¥ã€‚ Channel ä¿¡é“ï¼šå¤šè·¯å¤ç”¨è¿æ¥ä¸­çš„ä¸€æ¡ç‹¬ç«‹çš„åŒå‘æ•°æ®æµé€šé“ã€‚ä¿¡é“æ˜¯å»ºç«‹åœ¨çœŸå®çš„ TCP è¿æ¥å†…çš„è™šæ‹Ÿè¿æ¥ï¼ŒAMQP å‘½ä»¤éƒ½æ˜¯é€šè¿‡ä¿¡é“å‘å‡ºå»çš„ï¼Œä¸ç®¡æ˜¯å‘å¸ƒæ¶ˆæ¯ã€è®¢é˜…é˜Ÿåˆ—è¿˜æ˜¯æ¥æ”¶æ¶ˆæ¯ï¼Œè¿™äº›åŠ¨ä½œéƒ½æ˜¯é€šè¿‡ä¿¡é“å®Œæˆã€‚å› ä¸ºå¯¹äºæ“ä½œç³»ç»Ÿæ¥è¯´å»ºç«‹å’Œé”€æ¯ TCP éƒ½æ˜¯éå¸¸æ˜‚è´µçš„å¼€é”€ï¼Œæ‰€ä»¥å¼•å…¥äº†ä¿¡é“çš„æ¦‚å¿µï¼Œä»¥å¤ç”¨ä¸€æ¡ TCP è¿æ¥ã€‚ Consumeræ¶ˆæ¯çš„æ¶ˆè´¹è€…ï¼šè¡¨ç¤ºä¸€ä¸ªä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­å–å¾—æ¶ˆæ¯çš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºã€‚ Virtual Host è™šæ‹Ÿä¸»æœºï¼Œè¡¨ç¤ºä¸€æ‰¹äº¤æ¢å™¨ã€æ¶ˆæ¯é˜Ÿåˆ—å’Œç›¸å…³å¯¹è±¡ã€‚è™šæ‹Ÿä¸»æœºæ˜¯å…±äº«ç›¸åŒçš„èº«ä»½è®¤è¯å’ŒåŠ å¯†ç¯å¢ƒçš„ç‹¬ç«‹æœåŠ¡å™¨åŸŸã€‚æ¯ä¸ª vhost æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ª mini ç‰ˆçš„ RabbitMQ æœåŠ¡å™¨ï¼Œæ‹¥æœ‰è‡ªå·±çš„é˜Ÿåˆ—ã€äº¤æ¢å™¨ã€ç»‘å®šå’Œæƒé™æœºåˆ¶ã€‚vhost æ˜¯ AMQP æ¦‚å¿µçš„åŸºç¡€ï¼Œå¿…é¡»åœ¨è¿æ¥æ—¶æŒ‡å®šï¼ŒRabbitMQ é»˜è®¤çš„ vhost æ˜¯ / ã€‚ Broker è¡¨ç¤ºæ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡å™¨å®ä½“ã€‚ RabbitMQ æ•´åˆå¯¼å…¥æ¨¡å—ä¾èµ–çš„ starterï¼š 12345678&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-amqp&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;&lt;/dependency&gt; Spring Boot é…ç½®ï¼š 123456## é…ç½® rabbitMq æœåŠ¡å™¨rabbitmq: host: 127.0.0.1 port: 5672 username: root password: root é…ç½®ä¸€ä¸ªç›´è¿å‹çš„äº¤æ¢æœºï¼š 123456789101112131415161718192021@Configurationpublic class DirectRabbitConfig &#123; // åˆå§‹åŒ–é˜Ÿåˆ—åï¼šTestDirectQueue @Bean public Queue TestDirectQueue() &#123; return new Queue(\"TestDirectQueue\",true); // true æŒä¹…åŒ– &#125; // åˆå§‹åŒ– Direct äº¤æ¢æœºï¼šTestDirectExchange @Bean DirectExchange TestDirectExchange() &#123; return new DirectExchange(\"TestDirectExchange\"); &#125; // å®šä¹‰é˜Ÿåˆ—å’Œäº¤æ¢æœºç»‘å®š, å¹¶è®¾ç½®ç”¨äºåŒ¹é…é”®ï¼šTestDirectRouting @Bean Binding bindingDirect() &#123; return BindingBuilder.bind(TestDirectQueue()).to(TestDirectExchange()).with(\"TestDirectRouting\"); &#125;&#125; å†™ä¸ªç®€å•çš„æ¥å£è¿›è¡Œæ¶ˆæ¯æ¨é€ï¼ˆæ ¹æ®éœ€æ±‚ä¹Ÿå¯ä»¥æ”¹ä¸ºå®šæ—¶ä»»åŠ¡ç­‰ç­‰ï¼Œå…·ä½“çœ‹éœ€æ±‚ï¼‰ï¼š 1234567891011121314151617181920@RestControllerpublic class SendMessageController &#123; @Autowired RabbitTemplate rabbitTemplate; // ä½¿ç”¨ RabbitTemplateï¼šæä¾›äº†æ¥æ”¶ / å‘é€ç­‰æ–¹æ³• @GetMapping(\"/sendDirectMessage\") public String sendDirectMessage() &#123; String messageId = String.valueOf(UUID.randomUUID()); String messageData = \"test message, hello!\"; String createTime = LocalDateTime.now().format(DateTimeFormatter.ofPattern(\"yyyy-MM-dd HH:mm:ss\")); Map&lt;String,Object&gt; map = new HashMap&lt;&gt;(); map.put(\"messageId\",messageId); map.put(\"messageData\",messageData); map.put(\"createTime\",createTime); // å°†æ¶ˆæ¯æºå¸¦ç»‘å®šé”®å€¼ TestDirectRouting å‘é€åˆ°äº¤æ¢æœº TestDirectExchange rabbitTemplate.convertAndSend(\"TestDirectExchange\", \"TestDirectRouting\", map); return \"ok\"; &#125;&#125; consumer åˆ›å»ºä¸€ä¸ªæ¶ˆè´¹è€…é¡¹ç›®ï¼Œæ¶ˆè´¹è€…è¿›è¡Œæ¶ˆæ¯ç›‘å¬ï¼Œéœ€è¦æ‰‹åŠ¨åˆ›å»ºæ¶ˆæ¯æ¥æ”¶çš„ç›‘å¬ç±»ã€‚ 123456789@Component@RabbitListener(queues = \"TestDirectQueue\") // ç›‘å¬çš„é˜Ÿåˆ—åç§° TestDirectQueuepublic class DirectReceiver &#123; @RabbitHandler public void process(Map testMessage) &#123; System.out.println(\"DirectReceiver æ¶ˆè´¹è€…æ”¶åˆ°æ¶ˆæ¯: \" + testMessage.toString()); &#125;&#125; å›è°ƒå‡½æ•°12345678910111213141516171819202122232425262728293031323334@Configurationpublic class RabbitConfig &#123; @Bean public RabbitTemplate createRabbitTemplate(ConnectionFactory connectionFactory)&#123; RabbitTemplate rabbitTemplate = new RabbitTemplate(); rabbitTemplate.setConnectionFactory(connectionFactory); // è®¾ç½®å¼€å¯ Mandatory æ‰èƒ½è§¦å‘å›è°ƒå‡½æ•°ï¼Œæ— è®ºæ¶ˆæ¯æ¨é€ç»“æœæ€ä¹ˆæ ·éƒ½å¼ºåˆ¶è°ƒç”¨å›è°ƒå‡½æ•° rabbitTemplate.setMandatory(true); // äº¤æ¢æœºç›¸å…³ä¿¡æ¯ rabbitTemplate.setConfirmCallback(new RabbitTemplate.ConfirmCallback() &#123; @Override public void confirm(CorrelationData correlationData, boolean ack, String cause) &#123; System.out.println(\"ConfirmCallback: \"+\"ç›¸å…³æ•°æ®ï¼š\"+correlationData); System.out.println(\"ConfirmCallback: \"+\"ç¡®è®¤æƒ…å†µï¼š\"+ack); System.out.println(\"ConfirmCallback: \"+\"åŸå› ï¼š\"+cause); &#125; &#125;); // é˜Ÿåˆ—ç›¸å…³ä¿¡æ¯ rabbitTemplate.setReturnCallback(new RabbitTemplate.ReturnCallback() &#123; @Override public void returnedMessage(Message message, int replyCode, String replyText, String exchange, String routingKey) &#123; System.out.println(\"ReturnCallback: \"+\"æ¶ˆæ¯ï¼š\"+message); System.out.println(\"ReturnCallback: \"+\"å›åº”ç ï¼š\"+replyCode); System.out.println(\"ReturnCallback: \"+\"å›åº”ä¿¡æ¯ï¼š\"+replyText); System.out.println(\"ReturnCallback: \"+\"äº¤æ¢æœºï¼š\"+exchange); System.out.println(\"ReturnCallback: \"+\"è·¯ç”±é”®ï¼š\"+routingKey); &#125; &#125;); return rabbitTemplate; &#125;&#125;","categories":[{"name":"åå°æŠ€æœ¯","slug":"åå°æŠ€æœ¯","permalink":"http://yoursite.com/categories/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"MQ","slug":"MQ","permalink":"http://yoursite.com/tags/MQ/"},{"name":"Springboot","slug":"Springboot","permalink":"http://yoursite.com/tags/Springboot/"}]},{"title":"Spring Boot ç¼“å­˜","slug":"åå°æŠ€æœ¯/Spring Boot/Spring Boot ç¼“å­˜","date":"2020-03-31T01:59:45.000Z","updated":"2020-07-10T04:13:20.856Z","comments":true,"path":"2020/03/31/åå°æŠ€æœ¯/Spring Boot/Spring Boot ç¼“å­˜/","link":"","permalink":"http://yoursite.com/2020/03/31/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/Spring%20Boot/Spring%20Boot%20%E7%BC%93%E5%AD%98/","excerpt":"JSR107ã€Spring ç¼“å­˜æŠ½è±¡ã€‚","text":"JSR107ã€Spring ç¼“å­˜æŠ½è±¡ã€‚ JRS107 Java Caching å®šä¹‰äº† 5 ä¸ªæ ¸å¿ƒæ¥å£ï¼Œåˆ†åˆ«æ˜¯ CachingProvider, CacheManager, Cache, Entry å’Œ Expiryã€‚ â€¢ CachingProviderï¼šå®šä¹‰äº†åˆ›å»ºã€é…ç½®ã€è·å–ã€ç®¡ç†å’Œæ§åˆ¶å¤šä¸ª CacheManagerã€‚ä¸€ä¸ªåº”ç”¨å¯ä»¥åœ¨è¿è¡ŒæœŸè®¿é—®å¤šä¸ª CachingProviderï¼› â€¢ CacheManagerï¼šå®šä¹‰äº†åˆ›å»ºã€é…ç½®ã€è·å–ã€ç®¡ç†å’Œæ§åˆ¶å¤šä¸ªå”¯ä¸€å‘½åçš„ Cacheï¼Œè¿™äº› Cacheå­˜åœ¨äº CacheManager çš„ä¸Šä¸‹æ–‡ä¸­ã€‚ä¸€ä¸ª CacheManager ä»…è¢«ä¸€ä¸ª CachingProvider æ‰€æ‹¥æœ‰ï¼› â€¢ Cacheï¼šæ˜¯ä¸€ä¸ªç±»ä¼¼ Map çš„æ•°æ®ç»“æ„å¹¶ä¸´æ—¶å­˜å‚¨ä»¥ Key ä¸ºç´¢å¼•çš„å€¼ã€‚ä¸€ä¸ª Cache ä»…è¢«ä¸€ä¸ª CacheManager æ‰€æ‹¥æœ‰ï¼› â€¢ Entryï¼šæ˜¯ä¸€ä¸ªå­˜å‚¨åœ¨ Cache ä¸­çš„ key-value å¯¹ï¼› â€¢ Expiryï¼šæ¯ä¸€ä¸ªå­˜å‚¨åœ¨ Cache ä¸­çš„æ¡ç›®æœ‰ä¸€ä¸ªå®šä¹‰çš„æœ‰æ•ˆæœŸã€‚ä¸€æ—¦è¶…è¿‡è¿™ä¸ªæ—¶é—´ï¼Œæ¡ç›®ä¸ºè¿‡æœŸçš„çŠ¶æ€ã€‚ä¸€æ—¦è¿‡æœŸï¼Œæ¡ç›®å°†ä¸å¯è®¿é—®ã€æ›´æ–°å’Œåˆ é™¤ã€‚ç¼“å­˜æœ‰æ•ˆæœŸå¯ä»¥é€šè¿‡ExpiryPolicyè®¾ç½®ã€‚ Spring ç¼“å­˜æŠ½è±¡Spring 3.1 ä»¥ä¸Šç‰ˆæœ¬å®šä¹‰äº† org.springframework.cache.Cache å’Œ org.springframework.cache.CacheManager æ¥å£æ¥ç»Ÿä¸€ä¸åŒçš„ç¼“å­˜æŠ€æœ¯ï¼›å¹¶æ”¯æŒä½¿ç”¨ JCacheï¼ˆJSR-107ï¼‰æ³¨è§£ç®€åŒ–æˆ‘ä»¬å¼€å‘ã€‚ Cache æ¥å£ä¸ºç¼“å­˜çš„ç»„ä»¶è§„èŒƒå®šä¹‰ï¼ŒåŒ…å«ç¼“å­˜çš„å„ç§æ“ä½œé›†åˆï¼›Cache æ¥å£ä¸‹ Spring æä¾›äº†å„ç§ xxxCache çš„å®ç°ï¼›å¦‚ RedisCacheã€EhCacheCache ã€ConcurrentMapCacheç­‰ã€‚ æ¯æ¬¡è°ƒç”¨éœ€è¦ç¼“å­˜åŠŸèƒ½çš„æ–¹æ³•æ—¶ï¼ŒSpring ä¼šæ£€æŸ¥æ£€æŸ¥æŒ‡å®šå‚æ•°çš„æŒ‡å®šçš„ç›®æ ‡æ–¹æ³•æ˜¯å¦å·²ç»è¢«è°ƒç”¨è¿‡ï¼šå¦‚æœæœ‰å°±ç›´æ¥ä»ç¼“å­˜ä¸­è·å–æ–¹æ³•è°ƒç”¨åçš„ç»“æœï¼Œå¦‚æœæ²¡æœ‰å°±è°ƒç”¨æ–¹æ³•å¹¶ç¼“å­˜ç»“æœåè¿”å›ç»™ç”¨æˆ·ã€‚ä¸‹æ¬¡è°ƒç”¨ç›´æ¥ä»ç¼“å­˜ä¸­è·å–ã€‚ ç¡®å®šæ–¹æ³•éœ€è¦è¢«ç¼“å­˜ä»¥åŠä»–ä»¬çš„ç¼“å­˜ç­–ç•¥ï¼›ä»ç¼“å­˜ä¸­è¯»å–ä¹‹å‰ç¼“å­˜å­˜å‚¨çš„æ•°æ®ã€‚ æ³¨è§£åŸºæœ¬æµç¨‹æ·»åŠ ç¼“å­˜æ¨¡å—çš„ staterï¼š 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-cache&lt;/artifactId&gt;&lt;/dependency&gt; å¼•å…¥ Redis çš„ starterï¼Œå®¹å™¨ä¸­é»˜è®¤ä¿å­˜çš„æ˜¯ RedisCacheManagerã€‚RedisCacheManager è´Ÿè´£åˆ›å»ºRedisCacheï¼ŒRedisCache è´Ÿè´£æ“ä½œ Redis ç¼“å­˜æ•°æ®ã€‚é»˜è®¤ä¿å­˜æ•°æ® Key / Value éƒ½æ˜¯ Objectï¼Œé»˜è®¤ä½¿ç”¨çš„æ˜¯ JDK åºåˆ—åŒ–å™¨ã€‚ åœ¨ Spring Boot ä¸»ç±»ä¸­æ·»åŠ  EnableCaching æ³¨è§£å¼€å¯ç¼“å­˜åŠŸèƒ½ï¼š 1234567@SpringBootApplication@EnableCachingpublic class Application &#123; public static void main(String[] args) &#123; SpringApplication.run(Application.class, args); &#125;&#125; åœ¨ç±»ä¸Šæ·»åŠ CacheConfigè¿›è¡Œç¼“å­˜é…ç½®ï¼›åœ¨æ–¹æ³•ä¸Šæ·»åŠ @Cacheableï¼Œæ ‡æ³¨æ­¤æ–¹æ³•è¿”å›å€¼éœ€è¦è¢«ç¼“å­˜ã€‚ 12345@CacheConfig(cacheNames = \"users\")public interface UserRepository extends JpaRepository&lt;User, Long&gt; &#123; @Cacheable User findByName(String name);&#125; æ³¨è§£è¯¦è§£@CacheConfigï¼šä¸»è¦ç”¨äºé…ç½®è¯¥ç±»ä¸­ä¼šç”¨åˆ°çš„ä¸€äº›å…±ç”¨çš„ç¼“å­˜é…ç½®ã€‚åœ¨è¿™é‡Œ@CacheConfig(cacheNames = &quot;users&quot;)ï¼šé…ç½®äº†è¯¥æ•°æ®è®¿é—®å¯¹è±¡ä¸­è¿”å›çš„å†…å®¹å°†å­˜å‚¨äºåä¸º users çš„ç¼“å­˜å¯¹è±¡ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸ä½¿ç”¨è¯¥æ³¨è§£ï¼Œç›´æ¥é€šè¿‡@Cacheableè‡ªå·±é…ç½®ç¼“å­˜é›†çš„åå­—æ¥å®šä¹‰ã€‚ @Cacheableï¼šé…ç½®äº† findByName å‡½æ•°çš„è¿”å›å€¼å°†è¢«åŠ å…¥ç¼“å­˜ã€‚åŒæ—¶åœ¨æŸ¥è¯¢æ—¶ï¼Œä¼šå…ˆä»ç¼“å­˜ä¸­è·å–ï¼Œè‹¥ä¸å­˜åœ¨æ‰å†å‘èµ·å¯¹æ•°æ®åº“çš„è®¿é—®ã€‚è¯¥æ³¨è§£ä¸»è¦æœ‰ä¸‹é¢å‡ ä¸ªå‚æ•°ï¼š valueã€cacheNamesï¼šä¸¤ä¸ªç­‰åŒçš„å‚æ•°ï¼ˆcacheNamesä¸º Spring 4 æ–°å¢ï¼Œä½œä¸ºvalueçš„åˆ«åï¼‰ï¼Œç”¨äºæŒ‡å®šç¼“å­˜å­˜å‚¨çš„é›†åˆåã€‚ç”±äº Spring 4 ä¸­æ–°å¢äº†@CacheConfigï¼Œå› æ­¤åœ¨ Spring 3 ä¸­åŸæœ¬å¿…é¡»æœ‰çš„valueå±æ€§ï¼Œä¹Ÿæˆä¸ºéå¿…éœ€é¡¹äº†ï¼› keyï¼šç¼“å­˜å¯¹è±¡å­˜å‚¨åœ¨ Map é›†åˆä¸­çš„ key å€¼ï¼Œéå¿…éœ€ï¼Œç¼ºçœæŒ‰ç…§å‡½æ•°çš„æ‰€æœ‰å‚æ•°ç»„åˆä½œä¸º key å€¼ï¼Œè‹¥è‡ªå·±é…ç½®éœ€ä½¿ç”¨ SpEL è¡¨è¾¾å¼ï¼Œæ¯”å¦‚ï¼š@Cacheable(key = &quot;#p0&quot;)ï¼šä½¿ç”¨å‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºç¼“å­˜çš„ key å€¼ï¼Œæ›´å¤šå…³äº SpEL è¡¨è¾¾å¼çš„è¯¦ç»†å†…å®¹å¯å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼› conditionï¼šç¼“å­˜å¯¹è±¡çš„æ¡ä»¶ï¼Œéå¿…éœ€ï¼Œä¹Ÿéœ€ä½¿ç”¨ SpEL è¡¨è¾¾å¼ï¼Œåªæœ‰æ»¡è¶³è¡¨è¾¾å¼æ¡ä»¶çš„å†…å®¹æ‰ä¼šè¢«ç¼“å­˜ï¼Œæ¯”å¦‚ï¼š@Cacheable(key = &quot;#p0&quot;, condition = &quot;#p0.length() &lt; 3&quot;)ï¼Œè¡¨ç¤ºåªæœ‰å½“ç¬¬ä¸€ä¸ªå‚æ•°çš„é•¿åº¦å°äº3çš„æ—¶å€™æ‰ä¼šè¢«ç¼“å­˜ï¼› unlessï¼šå¦å¤–ä¸€ä¸ªç¼“å­˜æ¡ä»¶å‚æ•°ï¼Œéå¿…éœ€ï¼Œéœ€ä½¿ç”¨ SpEL è¡¨è¾¾å¼ã€‚å®ƒä¸åŒäºconditionå‚æ•°çš„åœ°æ–¹åœ¨äºå®ƒçš„åˆ¤æ–­æ—¶æœºï¼Œè¯¥æ¡ä»¶æ˜¯åœ¨å‡½æ•°è¢«è°ƒç”¨ä¹‹åæ‰åšåˆ¤æ–­çš„ï¼Œæ‰€ä»¥å®ƒå¯ä»¥é€šè¿‡å¯¹ result è¿›è¡Œåˆ¤æ–­ï¼› keyGeneratorï¼šç”¨äºæŒ‡å®š key ç”Ÿæˆå™¨ï¼Œéå¿…éœ€ã€‚è‹¥éœ€è¦æŒ‡å®šä¸€ä¸ªè‡ªå®šä¹‰çš„ key ç”Ÿæˆå™¨ï¼Œéœ€è¦å¼€å‘è€…å®ç°org.springframework.cache.interceptor.KeyGeneratoræ¥å£ï¼Œå¹¶ä½¿ç”¨è¯¥å‚æ•°æ¥æŒ‡å®šã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼šè¯¥å‚æ•°ä¸keyæ˜¯äº’æ–¥çš„ï¼› cacheManagerï¼šç”¨äºæŒ‡å®šä½¿ç”¨å“ªä¸ªç¼“å­˜ç®¡ç†å™¨ï¼Œéå¿…éœ€ã€‚åªæœ‰å½“æœ‰å¤šä¸ªæ—¶æ‰éœ€è¦ä½¿ç”¨ï¼› cacheResolverï¼šç”¨äºæŒ‡å®šä½¿ç”¨é‚£ä¸ªç¼“å­˜è§£æå™¨ï¼Œéå¿…éœ€ã€‚éœ€é€šè¿‡org.springframework.cache.interceptor.CacheResolveræ¥å£æ¥å®ç°è‡ªå·±çš„ç¼“å­˜è§£æå™¨ï¼Œå¹¶ç”¨è¯¥å‚æ•°æŒ‡å®šã€‚ @CachePutï¼šé…ç½®äºå‡½æ•°ä¸Šï¼Œèƒ½å¤Ÿæ ¹æ®å‚æ•°å®šä¹‰æ¡ä»¶æ¥è¿›è¡Œç¼“å­˜ï¼Œå®ƒä¸@Cacheableä¸åŒçš„æ˜¯ï¼Œå®ƒæ¯æ¬¡éƒ½ä¼šçœŸå®è°ƒç”¨å‡½æ•°ï¼Œæ‰€ä»¥ä¸»è¦ç”¨äºæ•°æ®æ–°å¢å’Œä¿®æ”¹æ“ä½œä¸Šã€‚å®ƒçš„å‚æ•°ä¸@Cacheableç±»ä¼¼ï¼Œå…·ä½“åŠŸèƒ½å¯å‚è€ƒä¸Šé¢å¯¹@Cacheableå‚æ•°çš„è§£æã€‚ @CacheEvictï¼šé…ç½®äºå‡½æ•°ä¸Šï¼Œé€šå¸¸ç”¨åœ¨åˆ é™¤æ–¹æ³•ä¸Šï¼Œç”¨æ¥ä»ç¼“å­˜ä¸­ç§»é™¤ç›¸åº”æ•°æ®ã€‚é™¤äº†åŒ@Cacheableä¸€æ ·çš„å‚æ•°ä¹‹å¤–ï¼Œå®ƒè¿˜æœ‰ä¸‹é¢ä¸¤ä¸ªå‚æ•°ï¼š allEntriesï¼šéå¿…éœ€ï¼Œé»˜è®¤ä¸º falseã€‚å½“ä¸º true æ—¶ï¼Œä¼šç§»é™¤æ‰€æœ‰æ•°æ®ï¼› beforeInvocationï¼šéå¿…éœ€ï¼Œé»˜è®¤ä¸º falseï¼Œä¼šåœ¨è°ƒç”¨æ–¹æ³•ä¹‹åç§»é™¤æ•°æ®ã€‚å½“ä¸º true æ—¶ï¼Œä¼šåœ¨è°ƒç”¨æ–¹æ³•ä¹‹å‰ç§»é™¤æ•°æ®ã€‚ TemplateSpring Boot æä¾›äº†å¸®åŠ©æ“ä½œ Redis çš„ Helper ç±» RedisTemplateï¼šRedisTemplateçš„ K:V å‡ä¸º Objectï¼›StringRedisTemplate ç»§æ‰¿è‡ª RedisTemplateï¼Œæ˜¯ä¸“ä¸º String:String ç±»å‹çš„ K:V æä¾›æœåŠ¡ã€‚ åœ¨ RedisAutoConfiguration ä¸­ Spring Boot è‡ªåŠ¨æ³¨å†Œäº† RedisTemplate å’Œ StringRedisTemplateã€‚ æ•°æ®æ“ä½œ Redis ä¸­å¸¸è§çš„äº”å¤§ç±»æ•°æ®ç±»å‹ï¼šStringï¼ŒListï¼ŒSetï¼ŒHash å’Œ ZSetã€‚ RedisTemplate å°è£…äº†å¯¹äº”å¤§ç±»æ•°æ®è¿›è¡Œæ“ä½œçš„æ–¹æ³•ï¼Œæ¯ä¸€ä¸ªæ–¹æ³•éƒ½ä¼šè¿”å›ä¸€ä¸ª Operations å¯¹è±¡ã€‚ 123456789RedisTemplate.opsForValue(); // StringRedisTemplate.opsForList();RedisTemplate.opsForSet();RedisTemplate.opsForHash();RedisTemplate.opsForZSet(); Redis å®ç°ç¼“å­˜å…¥é—¨åŸºç¡€ String æœ€åŸºç¡€çš„æ•°æ®ç±»å‹ï¼›List å…ƒç´ ä¸å…·æœ‰å”¯ä¸€æ€§ï¼›æœ‰åºï¼›æ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼›æ—¢å¯ä»¥æ˜¯æ ˆï¼Œä¹Ÿå¯ä»¥æ˜¯é˜Ÿåˆ—ï¼›Set å…ƒç´ å…·æœ‰å”¯ä¸€æ€§ï¼›æ— åºï¼›Hash å­˜å‚¨çš„æ˜¯key-valueç»“æ„ï¼Œkeyå¿…é¡»æ˜¯stringï¼›ç±»ä¼¼äº MySQL ä¸­çš„ä¸€æ¡è®°å½•ã€‚ Redis å‘½ä»¤æ¥å£ Redis æä¾›äº†è®¸å¤šå‘½ä»¤ä¾›æˆ‘ä»¬ä½¿ç”¨ï¼ŒåŒæ ·åœ¨ Spring Boot ä¸­ä¹Ÿå°è£…äº†å¯¹åº”ç±»å‹çš„å‘½ä»¤æ¥å£ä¾›å¼€å‘è€…ä½¿ç”¨ã€‚ 123456789101112131415161718192021/** * Interface for the commands supported by Redis. * * @author Costin Leau * @author Christoph Strobl */public interface RedisCommands extends RedisKeyCommands, RedisStringCommands, RedisListCommands, RedisSetCommands, RedisZSetCommands, RedisHashCommands, RedisTxCommands, RedisPubSubCommands, RedisConnectionCommands, RedisServerCommands, RedisScriptingCommands, RedisGeoCommands, HyperLogLogCommands &#123; /** * 'Native' or 'raw' execution of the given command along-side the given arguments. The command is executed as is, * with as little 'interpretation' as possible - it is up to the caller to take care of any processing of arguments or * the result. * * @param command Command to execute * @param args Possible command arguments (may be null) * @return execution result. */ Object execute(String command, byte[]... args);&#125; åœ¨ Spring Boot é…ç½®æ–‡ä»¶ä¸­æ·»åŠ  Redis é…ç½®ï¼š 1234567891011121314151617## é»˜è®¤å¯†ç ä¸ºç©ºredis: host: 127.0.0.1 # RedisæœåŠ¡å™¨è¿æ¥ç«¯å£ port: 6379 jedis: pool: # è¿æ¥æ± æœ€å¤§è¿æ¥æ•°ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰ max-active: 100 # è¿æ¥æ± ä¸­çš„æœ€å°ç©ºé—²è¿æ¥ max-idle: 10 # è¿æ¥æ± æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰ max-wait: 100000 # è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ timeout: 5000 # é»˜è®¤æ˜¯ç´¢å¼•ä¸º 0 çš„æ•°æ®åº“ database: 0 ä»£ç ç¤ºä¾‹1234567891011121314151617181920@RunWith(SpringRunner.class)@SpringBootTestpublic class SpringBootCacheApplicationTests &#123; @Autowired EmployeeMapper employeeMapper; @Autowired StringRedisTemplate stringRedisTemplate; @Autowired RedisTemplate redisTemplate; // å‘ Redis ä¸­ä¿å­˜ä¸€ä¸ªå¯¹è±¡å¹¶å–å‡ºæ‰“å° @Test public void test() &#123; Employee employee = employeeMapper.getEmpById(1); redisTemplate.opsForValue().set(\"emp01\",employee); Object emp01 = redisTemplate.opsForValue().get(\"emp01\"); System.out.println(emp01); &#125;&#125; æ³¨æ„ï¼ŒRedis ä¸­å¯¹è±¡çš„ä¿å­˜æ˜¯éœ€è¦è¿›è¡Œåºåˆ—åŒ–çš„ï¼Œé»˜è®¤ä½¿ç”¨ JdkSerializationRedisSerializer åºåˆ—åŒ–å™¨ï¼Œæ‰€ä»¥åœ¨ Redis ä¸­æŸ¥çœ‹ä¿å­˜çš„å¯¹è±¡æ˜¯åºåˆ—åŒ–åçš„äºŒè¿›åˆ¶ç¼–ç ï¼Œæ­£å¸¸ä½¿ç”¨æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼ŒæŸ¥è¯¢å‡ºæ¥çš„æ—¶å€™ä¼šè‡ªåŠ¨ååºåˆ—åŒ–ã€‚ å¦‚æœä¹ æƒ¯äºä½¿ç”¨ Stringï¼Œé‚£ä¹ˆå¯ä»¥å°†å…¶ JSON åŒ–ï¼Œä¸¤ç§æ–¹å¼ï¼šä½¿ç”¨ç¬¬ä¸‰æ–¹ JSON æˆ–è€…å‘å®¹å™¨ä¸­æ·»åŠ è‡ªå®šä¹‰ RedisTemplate æ”¹å˜å…¶é»˜è®¤åºåˆ—åŒ–å™¨ã€‚ æ·»åŠ è‡ªå®šä¹‰ RedisTemplateï¼š 123456789101112@Configurationpublic class MyRedisConfig &#123; @Bean public RedisTemplate&lt;Object,Employee&gt; empRedisTemplate(RedisConnectionFactory connectionFactory)&#123; RedisTemplate&lt;Object,Employee&gt; template = new RedisTemplate&lt;Object, Employee&gt;(); template.setConnectionFactory(connectionFactory); Jackson2JsonRedisSerializer&lt;Employee&gt; serializer = new Jackson2JsonRedisSerializer&lt;Employee&gt;(Employee.class); template.setDefaultSerializer(serializer); return template; &#125;&#125; Lettuce Jedis åœ¨å®ç°ä¸Šæ˜¯ç›´æ¥è¿æ¥ Redis æœåŠ¡å™¨ï¼Œåœ¨å¤šä¸ªçº¿ç¨‹é—´å…±äº«ä¸€ä¸ª Jedis å®ä¾‹æ—¶æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œå¦‚æœæƒ³è¦åœ¨å¤šçº¿ç¨‹åœºæ™¯ä¸‹ä½¿ç”¨ Jedis ï¼Œéœ€è¦ä½¿ç”¨è¿æ¥æ± ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½ä½¿ç”¨è‡ªå·±çš„ Jedis å®ä¾‹ï¼Œå½“è¿æ¥æ•°é‡å¢å¤šæ—¶ï¼Œä¼šæ¶ˆè€—è¾ƒå¤šçš„ç‰©ç†èµ„æºã€‚ ä¸ Jedis ç›¸æ¯”ï¼Œ Lettuce åˆ™å®Œå…¨å…‹æœäº†å…¶çº¿ç¨‹ä¸å®‰å…¨çš„ç¼ºç‚¹ï¼š Lettuce æ˜¯ä¸€ä¸ªå¯ä¼¸ç¼©çš„çº¿ç¨‹å®‰å…¨çš„ Redis å®¢æˆ·ç«¯ï¼Œæ”¯æŒåŒæ­¥ã€å¼‚æ­¥å’Œå“åº”å¼æ¨¡å¼ã€‚å¤šä¸ªçº¿ç¨‹å¯ä»¥å…±äº«ä¸€ä¸ªè¿æ¥å®ä¾‹ï¼Œè€Œ ä¸å¿…æ‹…å¿ƒå¤šçº¿ç¨‹å¹¶å‘é—®é¢˜ã€‚å®ƒåŸºäºä¼˜ç§€ Netty NIO æ¡†æ¶æ„å»ºï¼Œæ”¯æŒ Redis çš„æ›´å¤šé«˜çº§åŠŸèƒ½ã€‚ 12345678910&lt;!-- redis è®¿é—®å¯åŠ¨å™¨ --&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;&lt;/dependency&gt;&lt;!-- redis å®¢æˆ·ç«¯ Lettuce æ•°æ®åº“è¿æ¥æ± ä¾èµ– --&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.commons&lt;/groupId&gt; &lt;artifactId&gt;commons-pool2&lt;/artifactId&gt;&lt;/dependency&gt; 123456789101112131415161718# Redisæ•°æ®åº“ç´¢å¼•ï¼ˆé»˜è®¤ä¸º0ï¼‰spring.redis.database=0# RedisæœåŠ¡å™¨åœ°å€ ï¼ˆé»˜è®¤localhostï¼‰spring.redis.host=localhost# RedisæœåŠ¡å™¨è¿æ¥ç«¯å£ ï¼ˆé»˜è®¤6379ï¼‰spring.redis.port=6379# RedisæœåŠ¡å™¨è¿æ¥å¯†ç ï¼ˆé»˜è®¤ä¸ºç©ºï¼‰spring.redis.password=123456# è¿æ¥è¶…æ—¶æ—¶é—´spring.redis.timeout=10000ms# æœ€å¤§è¿æ¥æ•°ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰ é»˜è®¤ 8spring.redis.lettuce.pool.max-active=8# æœ€å°ç©ºé—²è¿æ¥ é»˜è®¤ 0spring.redis.lettuce.pool.min-idle=0# æœ€å¤§ç©ºé—²è¿æ¥ é»˜è®¤ 8spring.redis.lettuce.pool.max-idle=8# æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰ é»˜è®¤ -1msspring.redis.lettuce.pool.max-wait=-1ms ç¼“å­˜åŸç† è¦ä½¿ç”¨ Spring Boot çš„ç¼“å­˜åŠŸèƒ½ï¼Œè¿˜éœ€è¦æä¾›ä¸€ä¸ªç¼“å­˜çš„å…·ä½“å®ç°ã€‚ Spring Boot ä¸€å®šçš„é¡ºåºå»ä¾¦æµ‹ç¼“å­˜å®ç°ã€‚ Spring æä¾›äº†ä¸€ä¸ªç»Ÿä¸€è®¿é—®ç¼“å­˜çš„æ¥å£ï¼šCacheManager ctrl + alt + b å¯æŸ¥çœ‹è¿™ä¸ªæ¥å£çš„å®ç° åœ¨ RedisCacheManager ä¸­æŸ¥çœ‹ Redis ç¼“å­˜çš„é»˜è®¤é…ç½®ç±»ï¼šRedisCacheConfigurationï¼š ä»æºç äº†è§£åˆ° Sping Boot çš„ Reids ç¼“å­˜å¯¹ Key å’Œ Value é»˜è®¤çš„åºåˆ—åŒ–å™¨åˆ†åˆ«æ˜¯ String ç±»å‹å’Œ JDK åºåˆ—å™¨ã€‚ åœ¨ RedisCacheManager ä¸­å¯ä»¥çœ‹åˆ°å¦‚ä½•å®ä¾‹åŒ–è¿™ä¸ªç±»ï¼š å®ä¾‹åŒ–è¿™ä¸ªç±»å¿…é¡»ä¼ å…¥ä¸€ä¸ª connectionFactoryï¼Œç”¨ redis ç¼“å­˜æ‰€ä»¥ä¼ å…¥ä¸€ä¸ª redisConnectionFactoryã€‚ 1234567891011121314@Configurationpublic class CacheConfig &#123; @Autowired private RedisConnectionFactory redisConnectionFactory; /** * SpringCacheManager ç¼“å­˜ç®¡ç†å™¨ï¼šä½¿ç”¨çš„ç¼“å­˜äº§å“æ˜¯Redis * @return */ @Bean(name = \"springCacheManager\") public RedisCacheManager springCacheManager()&#123; RedisCacheManager cacheManager = RedisCacheManager.create(redisConnectionFactory); return cacheManager; &#125;&#125; Redis é…ç½®123456789101112131415161718192021222324252627282930313233@Configurationpublic class RedisConfig &#123; @Autowired private RedisConnectionFactory redisConnectionFactory; @Bean public StringRedisSerializer stringRedisSerializer() &#123; StringRedisSerializer stringRedisSerializer = new StringRedisSerializer(); return stringRedisSerializer; &#125; @Bean public StringRedisTemplate stringRedisTemplate() &#123; StringRedisTemplate stringRedisTemplate =new StringRedisTemplate(); stringRedisTemplate.setConnectionFactory(redisConnectionFactory); // å¼€å¯äº‹åŠ¡æ”¯æŒ stringRedisTemplate.setEnableTransactionSupport(true); return stringRedisTemplate; &#125; @Bean public RedisTemplate redisTemplate()&#123; RedisTemplate&lt;Object,Object&gt; redisTemplate= new RedisTemplate&lt;&gt;(); // åºåˆ—åŒ–å™¨ redisTemplate.setConnectionFactory(redisConnectionFactory); redisTemplate.setKeySerializer(stringRedisSerializer()); //redisTemplate.setHashKeySerializer(stringRedisSerializer()); // å¼€å¯äº‹åŠ¡æ”¯æŒ redisTemplate.setEnableTransactionSupport(true); return redisTemplate; &#125;&#125;","categories":[{"name":"åå°æŠ€æœ¯","slug":"åå°æŠ€æœ¯","permalink":"http://yoursite.com/categories/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"Springboot","slug":"Springboot","permalink":"http://yoursite.com/tags/Springboot/"},{"name":"Cache","slug":"Cache","permalink":"http://yoursite.com/tags/Cache/"}]},{"title":"MyBatis æ’ä»¶ä¹‹æ‹¦æˆªå™¨","slug":"å¼€å‘æ‚é¡¹/Mybatis æ’ä»¶ä¹‹æ‹¦æˆªå™¨","date":"2020-03-29T08:18:40.000Z","updated":"2020-07-10T04:16:03.620Z","comments":true,"path":"2020/03/29/å¼€å‘æ‚é¡¹/Mybatis æ’ä»¶ä¹‹æ‹¦æˆªå™¨/","link":"","permalink":"http://yoursite.com/2020/03/29/%E5%BC%80%E5%8F%91%E6%9D%82%E9%A1%B9/Mybatis%20%E6%8F%92%E4%BB%B6%E4%B9%8B%E6%8B%A6%E6%88%AA%E5%99%A8/","excerpt":"MyBatis æ‹¦æˆªå™¨çš„è¯¦ç»†ç”¨æ³•ä»‹ç»ã€‚","text":"MyBatis æ‹¦æˆªå™¨çš„è¯¦ç»†ç”¨æ³•ä»‹ç»ã€‚ åœ¨å¾ˆå¤šä¸šåŠ¡åœºæ™¯ä¸‹æˆ‘ä»¬éœ€è¦å»æ‹¦æˆª SQLï¼Œè¾¾åˆ°ä¸å…¥ä¾µåŸæœ‰ä»£ç ä¸šåŠ¡å¤„ç†ä¸€äº›ä¸œè¥¿ï¼Œæ¯”å¦‚ï¼šåˆ†é¡µæ“ä½œï¼Œæ•°æ®æƒé™è¿‡æ»¤æ“ä½œï¼Œ SQL æ‰§è¡Œæ—¶é—´æ€§èƒ½ç›‘æ§ç­‰ç­‰ã€‚åœ¨æŸäº›åº”ç”¨åœºæ™¯ä¸‹å°±éœ€è¦ä½¿ç”¨åˆ° MyBatis çš„æ‹¦æˆªå™¨ã€‚ Mybatis æ ¸å¿ƒå¯¹è±¡Configuration åˆå§‹åŒ–åŸºç¡€é…ç½®ï¼šæ¯”å¦‚ MyBatis çš„åˆ«åç­‰ï¼Œä¸€äº›é‡è¦çš„ç±»å‹å¯¹è±¡ï¼Œå¦‚ï¼šæ’ä»¶ï¼Œæ˜ å°„å™¨ï¼ŒObjectFactory å’Œ typeHandler å¯¹è±¡ç­‰ï¼ŒMyBatis æ‰€æœ‰çš„é…ç½®ä¿¡æ¯éƒ½ä¿å­˜åœ¨ Configuration å¯¹è±¡ä¹‹ä¸­ï¼› SqlSessionFactory SqlSession å·¥å‚ï¼šSqlSession ä½œä¸º MyBatiså·¥ä½œçš„ä¸»è¦é¡¶å±‚ APIï¼Œè¡¨ç¤ºä¸æ•°æ®åº“äº¤äº’çš„ä¼šè¯ï¼Œå®Œæˆå¿…è¦æ•°æ®åº“å¢åˆ æ”¹æŸ¥åŠŸèƒ½ï¼› Executor MyBatis æ‰§è¡Œå™¨ï¼šæ˜¯ MyBatis è°ƒåº¦çš„æ ¸å¿ƒï¼Œè´Ÿè´£ SQL è¯­å¥çš„ç”Ÿæˆå’ŒæŸ¥è¯¢ç¼“å­˜çš„ç»´æŠ¤ï¼› ParameterHandlerï¼šè´Ÿè´£å¯¹ç”¨æˆ·ä¼ é€’çš„å‚æ•°è½¬æ¢æˆ JDBC Statement æ‰€éœ€è¦çš„å‚æ•°ï¼› ResultSetHandlerï¼š è´Ÿè´£å°† JDBC è¿”å›çš„ ResultSet ç»“æœé›†å¯¹è±¡è½¬æ¢æˆ List ç±»å‹çš„é›†åˆï¼› TypeHandlerï¼šè´Ÿè´£ Java æ•°æ®ç±»å‹å’Œ JDBC æ•°æ®ç±»å‹ä¹‹é—´çš„æ˜ å°„å’Œè½¬æ¢ï¼› MappedStatementï¼šç»´æŠ¤äº†ä¸€æ¡ &lt;select | update | delete | insert&gt; èŠ‚ç‚¹çš„å°è£…ï¼› SqlSourceï¼šè´Ÿè´£æ ¹æ®ç”¨æˆ·ä¼ é€’çš„ parameterObjectï¼ŒåŠ¨æ€åœ°ç”Ÿæˆ SQL è¯­å¥ï¼Œå°†ä¿¡æ¯å°è£…åˆ° BoundSql å¯¹è±¡ä¸­ï¼Œå¹¶è¿”å›ï¼› BoundSqlï¼šè¡¨ç¤ºåŠ¨æ€ç”Ÿæˆçš„ SQL è¯­å¥ä»¥åŠç›¸åº”çš„å‚æ•°ä¿¡æ¯ã€‚ æ‹¦æˆªå™¨åŸç†å®ç°Mybatis æ”¯æŒå¯¹ Executorã€StatementHandlerã€PameterHandler å’Œ ResultSetHandler æ¥å£è¿›è¡Œæ‹¦æˆªï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥å¯¹è¿™ä¸ªå››ç§ç±»å‹çš„å¯¹è±¡è¿›è¡Œä»£ç†ã€‚ æ³¨è§£@Interceptsåœ¨å®ç° Interceptor æ¥å£çš„ç±»å£°æ˜ï¼Œä½¿è¯¥ç±»æ³¨å†Œæˆä¸ºæ‹¦æˆªå™¨ã€‚ @Signature(type = Executor.class,method = &quot;&quot;, args = {) typeï¼šè¡¨ç¤ºæ‹¦æˆªçš„ç±»ï¼Œè¿™é‡Œæ˜¯ Executor çš„å®ç°ç±»ï¼› methodï¼šè¡¨ç¤ºæ‹¦æˆªçš„æ–¹æ³•ï¼Œè¿™é‡Œæ˜¯æ‹¦æˆª Executor çš„ query æ–¹æ³•ï¼› argsï¼šè¡¨ç¤ºæ–¹æ³•å‚æ•°ã€‚ 123456789@Slf4j@Component@Intercepts(&#123;@Signature(type = Executor.class, method = \"update\", args = &#123;MappedStatement.class, Object.class&#125;), @Signature(type = Executor.class, method = \"query\", args = &#123;MappedStatement.class, Object.class, RowBounds.class, ResultHandler.class&#125;)&#125;)public class SqlInterceptor implements Interceptor &#123; private Properties properties; // ...åé¢ç»™å‡ºè¯¦ç»†æ–¹æ³•&#125; intercept æ–¹æ³• è¦æƒ³æ‹¦æˆªç›®æ ‡å¯¹è±¡çš„ç›®æ ‡æ–¹æ³•çš„æ‰§è¡Œï¼Œå¯ä»¥é€šè¿‡ invocation æ¥è·å–æ‹¦æˆªçš„ç›®æ ‡æ–¹æ³•åŠå‚æ•°ï¼Œä»¥åŠæ‰§è¡Œç›®æ ‡æ–¹æ³•ï¼ŒåŒ…å«ä»£ç†çš„å‡ ä¸ªé‡è¦å…ƒç´  methodã€targetã€argsã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124// é€šè¿‡ invocation æ‹¦æˆªç›®æ ‡å¯¹è±¡çš„ç›®æ ‡æ–¹æ³•æ‰§è¡Œä¸­éœ€è¦è¢«æ‰“å°è¾“å‡ºçš„ä¿¡æ¯@Overridepublic Object intercept(Invocation invocation) throws Throwable &#123; // MappedStatement ç»´æŠ¤äº†ä¸€æ¡ mapper.xml æ–‡ä»¶é‡Œé¢ select ã€updateã€deleteã€insert èŠ‚ç‚¹çš„å°è£… MappedStatement mappedStatement = (MappedStatement) invocation.getArgs()[0]; Object parameter = null; if (invocation.getArgs().length &gt; 1) &#123; parameter = invocation.getArgs()[1]; &#125; // å–å¾— SQL æ ‡è¯†ç¬¦ String sqlId = mappedStatement.getId(); // å–å¾—åŠ¨æ€ç”Ÿæˆçš„ SQL è¯­å¥ä»¥åŠç›¸åº”çš„å‚æ•°ä¿¡æ¯å¯¹è±¡ BoundSql boundSql = mappedStatement.getBoundSql(parameter); // å–å¾— Mybatis çš„é…ç½®ä¿¡æ¯ Configuration configuration = mappedStatement.getConfiguration(); Object returnValue = null; long start = System.currentTimeMillis(); // ç»§ç»­æ‰§è¡ŒåŸç›®æ ‡æ–¹æ³• returnValue = invocation.proceed(); // è·å–å®ä½“ç±» Class&lt;?&gt; parameterType = getParameterType(mappedStatement); // åˆ¤æ–­æ˜¯å¦åŒ…å« SQL è¯­å¥æ‰“å°æ³¨è§£ if (!hasSqlPrintAnnotation(parameterType)) &#123; return returnValue; &#125; long end = System.currentTimeMillis(); long time = (end - start); // ç­›é€‰å‡ºæ‰§è¡Œæ—¶é—´è¾ƒé•¿çš„ SQL è¯­å¥ä»¥ä¾¿ä¼˜åŒ– if (time &gt; 1) &#123; // è‡ªå®šä¹‰è¾“å‡ºçš„ SQL è¯­å¥ String sql = getSql(configuration, boundSql, sqlId, time); log.info(sql); &#125; // è¿”å›æ‰§è¡Œåçš„ç»“æœ return returnValue;&#125;// è·å–å®ä½“å¯¹è±¡ç±»private Class&lt;?&gt; getParameterType(MappedStatement statement) &#123; if (statement.getParameterMap() == null || statement.getParameterMap().getType() == null) &#123; return null; &#125; return statement.getParameterMap().getType();&#125;// åˆ¤æ–­å®ä½“ç±»ä¸Šæ˜¯å¦åŒ…å«è‡ªå®šä¹‰çš„ SQl æ‰“å°çš„æ³¨è§£ @SqlPrintprivate static boolean hasSqlPrintAnnotation(Class&lt;?&gt; classType) &#123; return classType == null ? Boolean.FALSE : classType.isAnnotationPresent(SqlPrint.class);&#125;private static String getSql(Configuration configuration, BoundSql boundSql, String sqlId, long time) &#123; String sql = showSql(configuration, boundSql); StringBuilder str = new StringBuilder(100); str.append(sqlId); str.append(\" : \"); // å…·ä½“æ‰§è¡Œçš„ SQL è¯­å¥ str.append(sql); str.append(\" &gt;&gt;&gt;&gt;&gt;&gt; \"); // SQL æ‰§è¡Œçš„æ—¶é—´ str.append(\"SQLæ‰§è¡Œè€—æ—¶: \"); str.append(time); str.append(\"ms\"); return str.toString();&#125;// ç»„è£…éœ€è¦æ‰“å°çš„ SQLprivate static String showSql(Configuration configuration, BoundSql boundSql) &#123; // å–å¾—å‚æ•°çš„å¯¹è±¡ï¼Œå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªå¤šä¸ªå‚æ•°çš„ map ç»“æ„ Object parameterObject = boundSql.getParameterObject(); // æŸ¥è¯¢ SQL ä¸­çš„å‚æ•° List&lt;ParameterMapping&gt; parameterMappings = boundSql.getParameterMappings(); // å°† SQL ä¸­ä¸€ä¸ªæˆ–å¤šä¸ªå›è½¦æ¢è¡Œç¬¦å·æ›¿æ¢æˆä¸€ä¸ªç©ºæ ¼ String sql = boundSql.getSql().replaceAll(\"[\\\\s]+\", \" \"); if (!parameterMappings.isEmpty() &amp;&amp; parameterObject != null) &#123; // Mybatis åœ¨å¯åŠ¨æ—¶å°±ä¼šé€šè¿‡ TypeHandlerRegistry è¿›è¡Œæ³¨å†Œï¼Œå³å»ºç«‹ JdbcType, JavaType, TypeHandler ä¸‰è€…ä¹‹é—´çš„å…³ç³»ã€‚ // å› æ­¤ï¼Œè¿™æ„å‘³ç€åœ¨ Mybatis å¯åŠ¨æ—¶æˆ‘ä»¬ä¹Ÿéœ€è¦é€šè¿‡ TypeHandlerRegistry å°†æˆ‘ä»¬çš„æ‰€æœ‰çš„æšä¸¾ç±»å‹ï¼ˆJavaTypeï¼‰ä¸è‡ªå®šä¹‰çš„æšä¸¾ // TypeHandlerï¼ˆEnumTypeHandlerï¼‰å»ºç«‹è”ç³» TypeHandlerRegistry typeHandlerRegistry = configuration.getTypeHandlerRegistry(); // è‡ªå®šä¹‰ TypeHandler æ—¶ä¼šèµ°è¿™ä¸ªé€»è¾‘ï¼Œå»ºç«‹ JavaType å’Œ JdbcType ä¹‹é—´çš„è”ç³» if (typeHandlerRegistry.hasTypeHandler(parameterObject.getClass())) &#123; // æ›¿æ¢ SQL ä¸­çš„å ä½ç¬¦ â€œ?â€ ä¸ºå…·ä½“çš„å‚æ•°ï¼ŒreplaceFirst ä½œä¸ºæ˜¯æ›¿æ¢åŒ¹é…åˆ°çš„ç¬¬ä¸€ä¸ªå ä½ç¬¦ â€œ?â€ sql = sql.replaceFirst(\"\\\\?\", getFormatParameterValue(parameterObject)); &#125; // æ²¡æœ‰è‡ªå®šä¹‰çš„ TypeHandlerï¼Œèµ°é€šç”¨é€»è¾‘ else &#123; // æ‹¿åˆ° targetï¼ˆæ‹¦æˆªå¯¹è±¡ï¼‰çš„å…ƒæ•°æ® MetaObject metaObject = configuration.newMetaObject(parameterObject); // å‚æ•°æ˜¯æŒ‰é¡ºåºå­˜å‚¨çš„ï¼Œä¸‹é¢é€»è¾‘æŒ‰é¡ºåºæ¥æ›¿æ¢ for (ParameterMapping parameterMapping : parameterMappings) &#123; // è·å–å‚æ•°çš„åç§° String propertyName = parameterMapping.getProperty(); // å¦‚æœå…ƒæ•°æ®å¯¹è±¡ä¸­å­˜åœ¨è¯¥å‚æ•°ï¼Œåˆ™æ›¿æ¢ç›¸åº”çš„å ä½ç¬¦ â€œ?â€ if (metaObject.hasGetter(propertyName)) &#123; Object obj = metaObject.getValue(propertyName); sql = sql.replaceFirst(\"\\\\?\", getFormatParameterValue(obj)); &#125; // å¦‚æœæœ‰é¢å¤–çš„å‚æ•°ï¼Œèµ°ä¸‹é¢çš„é€»è¾‘ else if (boundSql.hasAdditionalParameter(propertyName)) &#123; Object obj = boundSql.getAdditionalParameter(propertyName); sql = sql.replaceFirst(\"\\\\?\", getFormatParameterValue(obj)); &#125; &#125; &#125; &#125; // è¿”å›ç»„è£…å¥½çš„ SQL return sql;&#125;// æŒ‰ç±»å‹æ ¼å¼åŒ– SQL é‡Œçš„å‚æ•°private static String getFormatParameterValue(Object obj) &#123; String value = null; if (obj instanceof String) &#123; value = \"'\" + obj.toString() + \"'\"; &#125; else if (obj instanceof Date) &#123; DateFormat formatter = DateFormat.getDateTimeInstance(DateFormat.DEFAULT, DateFormat.DEFAULT, Locale.CHINA); value = \"'\" + formatter.format(new Date()) + \"'\"; &#125; else &#123; if (obj != null) &#123; value = obj.toString(); &#125; else &#123; value = \"\"; &#125; &#125;&#125; plugin æ–¹æ³• åŒ…è£…ç›®æ ‡å¯¹è±¡ï¼ŒåŒ…è£…çš„æ„æ€å°±æ˜¯ä¸ºç›®æ ‡å¯¹è±¡åˆ›å»ºä¸€ä¸ªä»£ç†ã€‚ 1234567891011@Overridepublic Object plugin(Object target) &#123; // åˆ¤æ–­ç›®æ ‡å¯¹è±¡ç±»å‹æ˜¯å¦ä¸ºæ‰€éœ€ç±»å‹ if (target instanceof Executor) &#123; // ä¸º target åˆ›å»ºä¸€ä¸ªåŠ¨æ€ä»£ç†ï¼Œä»¥æ­¤æ¥å®ç°æ–¹æ³•æ‹¦æˆªå’Œå¢å¼ºåŠŸèƒ½ï¼šå›è°ƒ intercept æ–¹æ³• return Plugin.wrap(target, this); &#125; else &#123; // æ— éœ€æ‹¦æˆªåˆ™ç›´æ¥è¿”å›ç›®æ ‡å¯¹è±¡æœ¬èº« return target; &#125;&#125;","categories":[{"name":"å¼€å‘æ‚é¡¹","slug":"å¼€å‘æ‚é¡¹","permalink":"http://yoursite.com/categories/%E5%BC%80%E5%8F%91%E6%9D%82%E9%A1%B9/"}],"tags":[{"name":"MyBatis","slug":"MyBatis","permalink":"http://yoursite.com/tags/MyBatis/"}]},{"title":"çº¿ç¨‹ä¸è¿›ç¨‹","slug":"åŸºç¡€çŸ¥è¯†/çº¿ç¨‹ä¸è¿›ç¨‹","date":"2020-03-28T06:25:21.000Z","updated":"2020-07-10T02:47:57.922Z","comments":true,"path":"2020/03/28/åŸºç¡€çŸ¥è¯†/çº¿ç¨‹ä¸è¿›ç¨‹/","link":"","permalink":"http://yoursite.com/2020/03/28/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E7%BA%BF%E7%A8%8B%E4%B8%8E%E8%BF%9B%E7%A8%8B/","excerpt":"è¿›ç¨‹ã€çº¿ç¨‹ã€é”ã€åŒæ­¥ç­‰ã€‚ ã€‚","text":"è¿›ç¨‹ã€çº¿ç¨‹ã€é”ã€åŒæ­¥ç­‰ã€‚ ã€‚ çº¿ç¨‹ä¸è¿›ç¨‹åœ¨ Java ä¸­ï¼Œä¸€ä¸ªåº”ç”¨ç¨‹åºå¯¹åº”ç€ä¸€ä¸ª JVM å®ä¾‹ã€‚Javaé‡‡ç”¨çš„æ˜¯å•çº¿ç¨‹ç¼–ç¨‹æ¨¡å‹ï¼Œå³åœ¨ç¨‹åºä¸­å¦‚æœæ²¡æœ‰ä¸»åŠ¨åˆ›å»ºçº¿ç¨‹çš„è¯ï¼Œåªä¼šåˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œé€šå¸¸ç§°ä¸ºä¸»çº¿ç¨‹ã€‚ä½†æ˜¯è¦æ³¨æ„ï¼Œè™½ç„¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œä¸ä»£è¡¨ JVM ä¸­åªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼ŒJVM å®ä¾‹åœ¨åˆ›å»ºçš„æ—¶å€™ï¼ŒåŒæ—¶ä¼šåˆ›å»ºå¾ˆå¤šå…¶ä»–çš„çº¿ç¨‹ï¼ˆæ¯”å¦‚åƒåœ¾æ”¶é›†å™¨çº¿ç¨‹ï¼‰ã€‚ ç”±äº Java é‡‡ç”¨çš„æ˜¯å•çº¿ç¨‹ç¼–ç¨‹æ¨¡å‹ï¼Œå› æ­¤åœ¨è¿›è¡Œ UI ç¼–ç¨‹æ—¶è¦æ³¨æ„å°†è€—æ—¶çš„æ“ä½œæ”¾åœ¨å­çº¿ç¨‹ä¸­è¿›è¡Œï¼Œä»¥é¿å…é˜»å¡ä¸»çº¿ç¨‹ï¼ˆåœ¨UIç¼–ç¨‹æ—¶ï¼Œä¸»çº¿ç¨‹å³UIçº¿ç¨‹ï¼Œç”¨æ¥å¤„ç†ç”¨æˆ·çš„äº¤äº’äº‹ä»¶ï¼‰ã€‚ çº¿ç¨‹çš„åˆ›å»º 1ï¼‰ç»§æ‰¿ Thread ç±»ï¼› 2ï¼‰å®ç° Runnable æ¥å£ã€‚ ç»§æ‰¿ Thread ç±»12345678910111213class MyThread extends Thread&#123; private static int num = 0; public MyThread()&#123; num++; &#125; @Override public void run() &#123; System.out.println(\"ä¸»åŠ¨åˆ›å»ºçš„ç¬¬\"+num+\"ä¸ªçº¿ç¨‹\"); &#125;&#125; åˆ›å»ºå¥½äº†è‡ªå·±çš„çº¿ç¨‹ç±»ä¹‹åï¼Œå°±å¯ä»¥åˆ›å»ºçº¿ç¨‹å¯¹è±¡äº†ï¼Œç„¶åé€šè¿‡start()æ–¹æ³•å»å¯åŠ¨çº¿ç¨‹ã€‚ 123456public class Test &#123; public static void main(String[] args) &#123; MyThread thread = new MyThread(); // åˆ›å»ºä¸€ä¸ªå­çº¿ç¨‹å¯¹è±¡ thread.start(); // è¿è¡Œå­çº¿ç¨‹çš„ run() æ–¹æ³• &#125;&#125; æ³¨æ„ï¼Œä¸æ˜¯è°ƒç”¨run()æ–¹æ³•å¯åŠ¨çº¿ç¨‹ï¼Œrun()æ–¹æ³•ä¸­åªæ˜¯å®šä¹‰éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¦‚æœè°ƒç”¨run()æ–¹æ³•ï¼Œå³ç›¸å½“äºåœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œrun()æ–¹æ³•ï¼Œè·Ÿæ™®é€šçš„æ–¹æ³•è°ƒç”¨æ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼Œæ­¤æ—¶å¹¶ä¸ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹æ¥æ‰§è¡Œå®šä¹‰çš„ä»»åŠ¡ã€‚ 123456789101112131415161718192021222324// é”™è¯¯æ¡ˆä¾‹public class Test &#123; public static void main(String[] args) &#123; System.out.println(\"ä¸»çº¿ç¨‹ID:\"+Thread.currentThread().getId()); // è·å–ä¸»çº¿ç¨‹çš„ ID MyThread thread01 = new MyThread(\"Thread01\"); thread01.start(); // æ­£ç¡®è°ƒç”¨ï¼Œå¼€å¯å­çº¿ç¨‹è¿è¡Œ run() æ–¹æ³• MyThread thread02 = new MyThread(\"Thread02\"); thread02.run(); // é”™è¯¯è°ƒç”¨ï¼Œè¿è¡Œä¸»ç¨‹åºçš„ run() æ–¹æ³• &#125;&#125; class MyThread extends Thread&#123; private String name; public MyThread(String name)&#123; this.name = name; &#125; @Override public void run() &#123; System.out.println(\"name:\"+name+\" å­çº¿ç¨‹ID:\"+Thread.currentThread().getId()); &#125;&#125; å®ç° Runnable æ¥å£Runnable çš„ä¸­æ–‡æ„æ€æ˜¯â€ä»»åŠ¡â€œï¼Œé¡¾åæ€ä¹‰ï¼Œé€šè¿‡å®ç° Runnable æ¥å£ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå­ä»»åŠ¡ï¼Œç„¶åå°†å­ä»»åŠ¡äº¤ç”± Thread å»æ‰§è¡Œã€‚æ³¨æ„ï¼Œè¿™ç§æ–¹å¼å¿…é¡»å°† Runnable ä½œä¸º Thread ç±»çš„å‚æ•°ï¼Œç„¶åé€šè¿‡ Thread çš„start()æ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹æ¥æ‰§è¡Œè¯¥å­ä»»åŠ¡ã€‚å¦‚æœè°ƒç”¨ Runnable çš„run()æ–¹æ³•çš„è¯ï¼Œæ˜¯ä¸ä¼šåˆ›å»ºæ–°çº¿ç¨‹çš„ï¼Œè¿™æ ¹æ™®é€šçš„æ–¹æ³•è°ƒç”¨æ²¡æœ‰ä»»ä½•åŒºåˆ«ã€‚ 123456789101112131415161718192021public class Test &#123; public static void main(String[] args) &#123; System.out.println(\"ä¸»çº¿ç¨‹IDï¼š\"+Thread.currentThread().getId()); MyRunnable runnable = new MyRunnable(); Thread thread = new Thread(runnable); // å°†ä»»åŠ¡ Runnable äº¤ç”± Thread å¤„ç† thread.start(); &#125;&#125; class MyRunnable implements Runnable&#123; public MyRunnable() &#123; &#125; @Override public void run() &#123; System.out.println(\"å­çº¿ç¨‹IDï¼š\"+Thread.currentThread().getId()); &#125;&#125; Thread VS. Runnable äº‹å®ä¸Šï¼ŒæŸ¥çœ‹ Thread ç±»çš„å®ç°æºä»£ç ä¼šå‘ç° Thread ç±»æ˜¯å®ç°äº† Runnable æ¥å£çš„ã€‚ åœ¨ Java ä¸­ï¼Œè¿™ä¸¤ç§æ–¹å¼éƒ½å¯ä»¥ç”¨æ¥åˆ›å»ºçº¿ç¨‹å»æ‰§è¡Œå­ä»»åŠ¡ï¼Œå…·ä½“é€‰æ‹©å“ªä¸€ç§æ–¹å¼è¦çœ‹è‡ªå·±çš„éœ€æ±‚ã€‚ç›´æ¥ç»§æ‰¿ Thread ç±»çš„è¯ï¼Œå¯èƒ½æ¯”å®ç° Runnable æ¥å£çœ‹èµ·æ¥æ›´åŠ ç®€æ´ï¼Œä½†æ˜¯ç”±äº Java åªå…è®¸å•ç»§æ‰¿ï¼Œæ‰€ä»¥å¦‚æœè‡ªå®šä¹‰ç±»éœ€è¦ç»§æ‰¿å…¶ä»–ç±»ï¼Œåˆ™åªèƒ½é€‰æ‹©å®ç° Runnable æ¥å£ã€‚ çº¿ç¨‹è®²è§£çº¿ç¨‹çš„çŠ¶æ€NEW (æ–°å»º)ï¼šä¸€ä¸ªå°šæœªå¯åŠ¨çš„çº¿ç¨‹å¤„äºè¿™ä¸€çŠ¶æ€ã€‚ RUNNABLE (å¯è¿è¡Œ) ï¼šä¸€ä¸ªæ­£åœ¨ Java è™šæ‹Ÿæœºä¸­æ‰§è¡Œçš„çº¿ç¨‹å¤„äºè¿™ä¸€çŠ¶æ€ã€‚ å¤„äº runnable çŠ¶æ€ä¸‹çš„çº¿ç¨‹æ­£åœ¨ Java è™šæ‹Ÿæœºä¸­æ‰§è¡Œï¼Œä½†å®ƒå¯èƒ½æ­£åœ¨ç­‰å¾…æ¥è‡ªäºæ“ä½œç³»ç»Ÿçš„å…¶å®ƒèµ„æºï¼Œæ¯”å¦‚å¤„ç†å™¨ã€‚å½“è¿›è¡Œé˜»å¡å¼çš„ IO æ“ä½œæ—¶ï¼Œæˆ–è®¸åº•å±‚çš„æ“ä½œç³»ç»Ÿçº¿ç¨‹ç¡®å®å¤„åœ¨é˜»å¡çŠ¶æ€ï¼Œä½†æˆ‘ä»¬å…³å¿ƒçš„æ˜¯ JVM çš„çº¿ç¨‹çŠ¶æ€ã€‚JVM æŠŠé‚£äº›éƒ½è§†ä½œèµ„æºï¼ŒCPU ä¹Ÿå¥½ï¼Œç¡¬ç›˜ï¼Œç½‘å¡ä¹Ÿç½¢ï¼Œæœ‰ä¸œè¥¿åœ¨ä¸ºçº¿ç¨‹æœåŠ¡ï¼Œå®ƒå°±è®¤ä¸ºçº¿ç¨‹åœ¨â€œæ‰§è¡Œâ€ã€‚å¦‚æœ JVM ä¸­çš„çº¿ç¨‹çŠ¶æ€å‘ç”Ÿæ”¹å˜äº†ï¼Œé€šå¸¸æ˜¯è‡ªèº«æœºåˆ¶å¼•å‘çš„ã€‚ BLOCKED (é˜»å¡) ï¼šä¸€ä¸ªæ­£åœ¨é˜»å¡ç­‰å¾…ä¸€ä¸ªç›‘è§†å™¨é”çš„çº¿ç¨‹å¤„äºè¿™ä¸€çŠ¶æ€ã€‚ synchronize æœºåˆ¶æœ‰å¯èƒ½è®©çº¿ç¨‹è¿›å…¥ BLOCKED çŠ¶æ€ã€‚å½“å› ä¸ºè·å–ä¸åˆ°é”è€Œæ— æ³•è¿›å…¥åŒæ­¥å—æ—¶ï¼Œçº¿ç¨‹å¤„äº BLOCKED çŠ¶æ€ã€‚å¦‚æœæœ‰çº¿ç¨‹é•¿æ—¶é—´å¤„äº BLOCKED çŠ¶æ€ï¼Œè¦è€ƒè™‘æ˜¯å¦å‘ç”Ÿäº†æ­»é”ï¼ˆdeadlockï¼‰çš„çŠ¶å†µã€‚BLOCKED çŠ¶æ€å¯ä»¥è§†ä½œä¸ºä¸€ç§ç‰¹æ®Šçš„ waitingï¼Œæ˜¯ä¼ ç»Ÿ waiting çŠ¶æ€çš„ä¸€ä¸ªç»†åˆ†ã€‚ WAITING (ç­‰å¾…) ï¼šä¸€ä¸ªæ­£åœ¨æ— é™æœŸç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œä¸€ä¸ªç‰¹åˆ«çš„åŠ¨ä½œçš„çº¿ç¨‹å¤„äºè¿™ä¸€çŠ¶æ€ã€‚ wait / notifyï¼Œjoin æ–¹æ³•è¿›å…¥ WATING çŠ¶æ€ã€‚å…¶ä¸­ wait / notify å¯ç”¨äºåä½œå…³ç³»ï¼šå½“æ¡ä»¶ä¸æ»¡è¶³æ—¶è°ƒç”¨ wait é‡Šæ”¾é”ï¼Œè®©è¡¥å……æ¡ä»¶çš„çº¿ç¨‹è¿è¡Œï¼Œä½†æ¡ä»¶æ»¡è¶³åç”±æ­¤è¡¥å……çº¿ç¨‹å”¤é†’ï¼Œå”¤é†’ååŸæœ‰çº¿ç¨‹å¤„äºé˜»å¡é˜Ÿåˆ—ç­‰å¾…å–é”ã€‚wait(0)ï¼šæ— é™ç­‰å¾…ã€‚ TIMED_WAITING (è®¡æ—¶ç­‰å¾…) ï¼šä¸€ä¸ªæ­£åœ¨é™æ—¶ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œä¸€ä¸ªåŠ¨ä½œçš„çº¿ç¨‹å¤„äºè¿™ä¸€çŠ¶æ€ã€‚ åŒä¿é™©ï¼šå³ä½¿æ¡ä»¶æ°¸è¿œå¾—ä¸åˆ°æ»¡è¶³ï¼Œçº¿ç¨‹ä¹Ÿä¼šåœ¨è§„å®šæ—¶é—´åè‡ªæˆ‘å”¤é†’ã€‚è°ƒç”¨ sleep æ–¹æ³•è¿›å…¥ TIMED_WAITING çŠ¶æ€ï¼Œæ­¤çŠ¶æ€ä¸é‡Šæ”¾é”ï¼ˆä¸é”æ— å…³ï¼‰ï¼Œåªèƒ½ç­‰å…¶è‡ªæˆ‘å”¤é†’ã€‚sleep(0)ï¼šå‡ ä¹ä¸ç­‰å¾…ã€‚ TERMINATED (ç»ˆæ­¢) ï¼šä¸€ä¸ªå·²ç»é€€å‡ºçš„çº¿ç¨‹å¤„äºè¿™ä¸€çŠ¶æ€ã€‚ å¸¸ç”¨æ–¹æ³•start æ–¹æ³• start() ç”¨æ¥å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ï¼Œå½“è°ƒç”¨ start æ–¹æ³•åï¼Œç³»ç»Ÿæ‰ä¼šå¼€å¯ä¸€ä¸ªæ–°çš„çº¿ç¨‹æ¥æ‰§è¡Œç”¨æˆ·å®šä¹‰çš„å­ä»»åŠ¡ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¼šä¸ºç›¸åº”çš„çº¿ç¨‹åˆ†é…éœ€è¦çš„èµ„æºã€‚ run æ–¹æ³• run() æ–¹æ³•æ˜¯ä¸éœ€è¦ç”¨æˆ·æ¥è°ƒç”¨çš„ï¼Œå½“é€šè¿‡ start æ–¹æ³•å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ä¹‹åï¼Œå½“çº¿ç¨‹è·å¾—äº† CPU æ‰§è¡Œæ—¶é—´ï¼Œä¾¿è¿›å…¥ run æ–¹æ³•ä½“å»æ‰§è¡Œå…·ä½“çš„ä»»åŠ¡ã€‚æ³¨æ„ï¼Œç»§æ‰¿ Thread ç±»å¿…é¡»é‡å†™ run æ–¹æ³•ï¼Œåœ¨ run æ–¹æ³•ä¸­å®šä¹‰å…·ä½“è¦æ‰§è¡Œçš„ä»»åŠ¡ã€‚ sleep æ–¹æ³• sleep æ–¹æ³•ç›¸å½“äºè®©çº¿ç¨‹ç¡çœ ï¼Œäº¤å‡º CPUï¼Œè®© CPU å»æ‰§è¡Œå…¶ä»–çš„ä»»åŠ¡ã€‚æ³¨æ„ sleep æ–¹æ³•ä¸é”æ— å…³ã€‚ 123456789101112131415161718192021222324252627282930313233public class Test &#123; private int i = 10; private Object object = new Object(); public static void main(String[] args) throws IOException &#123; Test test = new Test(); MyThread thread1 = test.new MyThread(); MyThread thread2 = test.new MyThread(); thread1.start(); thread2.start(); // ç­‰å¾…ä¸Šä¸€ä¸ªçº¿ç¨‹è¿è¡Œå®ŒåŒæ­¥ä»£ç å—æ‰å¯è¿è¡Œ &#125; class MyThread extends Thread&#123; @Override public void run() &#123; synchronized (object) &#123; i++; System.out.println(\"i:\"+i); try &#123; System.out.println(\"çº¿ç¨‹\"+Thread.currentThread().getName()+\"è¿›å…¥ç¡çœ çŠ¶æ€\"); Thread.currentThread().sleep(10000); &#125; catch (InterruptedException e) &#123; // TODO: handle exception &#125; System.out.println(\"çº¿ç¨‹\"+Thread.currentThread().getName()+\"ç¡çœ ç»“æŸ\"); i++; System.out.println(\"i:\"+i); &#125; &#125; &#125;&#125; yield æ–¹æ³• è°ƒç”¨ yield æ–¹æ³•ä¼šè®©å½“å‰çº¿ç¨‹äº¤å‡º CPU æƒé™ï¼Œè®© CPU å»æ‰§è¡Œå…¶ä»–çš„çº¿ç¨‹ã€‚å®ƒè·Ÿ sleep æ–¹æ³•ç±»ä¼¼ï¼ŒåŒæ ·ä¸ä¼šé‡Šæ”¾é”ã€‚ä½†æ˜¯ yield ä¸èƒ½æ§åˆ¶å…·ä½“çš„äº¤å‡º CPU çš„æ—¶é—´ï¼Œå¦å¤–ï¼Œyield æ–¹æ³•åªèƒ½è®©æ‹¥æœ‰ç›¸åŒä¼˜å…ˆçº§çš„çº¿ç¨‹æœ‰è·å– CPU æ‰§è¡Œæ—¶é—´çš„æœºä¼šã€‚ æ³¨æ„ï¼Œè°ƒç”¨ yield æ–¹æ³•å¹¶ä¸ä¼šè®©çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œè€Œæ˜¯è®©çº¿ç¨‹é‡å›å°±ç»ªçŠ¶æ€ï¼Œå®ƒåªéœ€è¦ç­‰å¾…é‡æ–°è·å– CPU æ‰§è¡Œæ—¶é—´ï¼Œè¿™ä¸€ç‚¹æ˜¯å’Œ sleep æ–¹æ³•ä¸ä¸€æ ·çš„ã€‚ join æ–¹æ³• å‡å¦‚åœ¨ main çº¿ç¨‹ä¸­ï¼Œè°ƒç”¨ thread.join æ–¹æ³•ï¼Œåˆ™ main æ–¹æ³•ä¼šç­‰å¾… thread çº¿ç¨‹æ‰§è¡Œå®Œæ¯•æˆ–è€…ç­‰å¾…ä¸€å®šçš„æ—¶é—´ã€‚å¦‚æœè°ƒç”¨çš„æ˜¯æ— å‚ join æ–¹æ³•ï¼Œåˆ™ç­‰å¾… thread æ‰§è¡Œå®Œæ¯•ï¼Œå¦‚æœè°ƒç”¨çš„æ˜¯æŒ‡å®šäº†æ—¶é—´å‚æ•°çš„ join æ–¹æ³•ï¼Œåˆ™ç­‰å¾…ä¸€å®šçš„æ—¶é—´ã€‚ 123456789101112131415161718192021222324252627282930public class Test &#123; public static void main(String[] args) throws IOException &#123; System.out.println(\"è¿›å…¥çº¿ç¨‹\"+Thread.currentThread().getName()); Test test = new Test(); MyThread thread1 = test.new MyThread(); thread1.start(); try &#123; System.out.println(\"çº¿ç¨‹\"+Thread.currentThread().getName()+\"ç­‰å¾…\"); thread1.join(); System.out.println(\"çº¿ç¨‹\"+Thread.currentThread().getName()+\"ç»§ç»­æ‰§è¡Œ\"); &#125; catch (InterruptedException e) &#123; // TODO Auto-generated catch block e.printStackTrace(); &#125; &#125; class MyThread extends Thread&#123; @Override public void run() &#123; System.out.println(\"è¿›å…¥çº¿ç¨‹\"+Thread.currentThread().getName()); try &#123; Thread.currentThread().sleep(5000); &#125; catch (InterruptedException e) &#123; // TODO: handle exception &#125; System.out.println(\"çº¿ç¨‹\"+Thread.currentThread().getName()+\"æ‰§è¡Œå®Œæ¯•\"); &#125; &#125;&#125; interrupt æ–¹æ³• å•ç‹¬è°ƒç”¨ interrupt æ–¹æ³•å¯ä»¥ä½¿å¾—å¤„äºé˜»å¡çŠ¶æ€çš„çº¿ç¨‹æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œä¹Ÿå°±è¯´ï¼Œå®ƒå¯ä»¥ç”¨æ¥ä¸­æ–­ä¸€ä¸ªæ­£å¤„äºé˜»å¡çŠ¶æ€çš„çº¿ç¨‹ï¼›å¦å¤–ï¼Œé€šè¿‡å¯ä»¥é€šè¿‡ interrupt æ–¹æ³•å’Œ isInterrupted æ–¹æ³•æ¥åœæ­¢æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ã€‚ 12345678910111213141516171819202122232425262728public class Test &#123; public static void main(String[] args) throws IOException &#123; Test test = new Test(); MyThread thread = test.new MyThread(); thread.start(); try &#123; Thread.currentThread().sleep(2000); // æ­¤çº¿ç¨‹ç¡çœ  2s &#125; catch (InterruptedException e) &#123; &#125; thread.interrupt(); // é˜»å¡çŠ¶æ€ä¸­è¢«æ‰“æ–­ï¼ŒæŠ›å‡ºå¼‚å¸¸ InterruptedException &#125; class MyThread extends Thread&#123; @Override public void run() &#123; try &#123; System.out.println(\"è¿›å…¥ç¡çœ çŠ¶æ€\"); Thread.currentThread().sleep(10000); System.out.println(\"ç¡çœ å®Œæ¯•\"); &#125; catch (InterruptedException e) &#123; System.out.println(\"å¾—åˆ°ä¸­æ–­å¼‚å¸¸\"); &#125; System.out.println(\"runæ–¹æ³•æ‰§è¡Œå®Œæ¯•\"); &#125; &#125;&#125; ä¸Šé¢çš„ä¾‹å­è¡¨æ˜äº† interrupt æ–¹æ³•å¯ä»¥ä¸­æ–­å¤„äºé˜»å¡çŠ¶æ€çš„çº¿ç¨‹ï¼Œé‚£ä¹ˆèƒ½ä¸èƒ½ä¸­æ–­å¤„äºéé˜»å¡çŠ¶æ€çš„çº¿ç¨‹å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ä¸èƒ½ã€‚ä½†æ˜¯å¦‚æœé…åˆ isInterrupted æ–¹æ³•èƒ½å¤Ÿä¸­æ–­æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ï¼Œå› ä¸ºè°ƒç”¨ interrupt æ–¹æ³•ç›¸å½“äºå°†ä¸­æ–­æ ‡å¿—ä½ç½®ä¸º trueï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡è°ƒç”¨ isInterrupted æ–¹æ³•åˆ¤æ–­ä¸­æ–­æ ‡å¿—æ˜¯å¦è¢«ç½®ä½æ¥ä¸­æ–­çº¿ç¨‹çš„æ‰§è¡Œã€‚ 1234567891011121314151617181920212223242526public class Test &#123; public static void main(String[] args) throws IOException &#123; Test test = new Test(); MyThread thread = test.new MyThread(); thread.start(); try &#123; Thread.currentThread().sleep(2000); &#125; catch (InterruptedException e) &#123; &#125; thread.interrupt(); &#125; class MyThread extends Thread&#123; @Override public void run() &#123; int i = 0; // ä¸æ¨èè¿™ä¹ˆç”¨ï¼Œå¯è‡ªå®šä¹‰ä¸€ä¸ªæ ‡è¯†ç¬¦ç”¨äºé€€å‡ºå¾ªç¯ while(!isInterrupted() &amp;&amp; i&lt;Integer.MAX_VALUE)&#123; System.out.println(i+\" whileå¾ªç¯\"); i++; &#125; &#125; &#125;&#125; çº¿ç¨‹å±æ€§getId()ï¼šè·å–çº¿ç¨‹ IDï¼›getName()ã€setName()ï¼šè®¾ç½®ã€è·å–çº¿ç¨‹åç§°ï¼›getPriority()ã€setPriority()ï¼šè®¾ç½®ã€è·å–ä¼˜å…ˆçº§ï¼›setDaemon()ã€isDaemon()ï¼šè®¾ç½®ã€åˆ¤æ–­å®ˆæŠ¤è¿›ç¨‹ï¼›Thread ç±»æœ‰ä¸€ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„é™æ€æ–¹æ³• currentThread() ç”¨æ¥è·å–å½“å‰çº¿ç¨‹ã€‚ å®ˆæŠ¤çº¿ç¨‹å’Œç”¨æˆ·çº¿ç¨‹çš„åŒºåˆ«åœ¨äºï¼šå®ˆæŠ¤çº¿ç¨‹ä¾èµ–äºåˆ›å»ºå®ƒçš„çº¿ç¨‹ï¼Œè€Œç”¨æˆ·çº¿ç¨‹åˆ™ä¸ä¾èµ–ã€‚ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼šå¦‚æœåœ¨ main çº¿ç¨‹ä¸­åˆ›å»ºäº†ä¸€ä¸ªå®ˆæŠ¤çº¿ç¨‹ï¼Œå½“ main æ–¹æ³•è¿è¡Œå®Œæ¯•ä¹‹åï¼Œå®ˆæŠ¤çº¿ç¨‹ä¹Ÿä¼šéšç€æ¶ˆäº¡ã€‚è€Œç”¨æˆ·çº¿ç¨‹åˆ™ä¸ä¼šï¼Œç”¨æˆ·çº¿ç¨‹ä¼šä¸€ç›´è¿è¡Œç›´åˆ°å…¶è¿è¡Œå®Œæ¯•ã€‚åœ¨ JVM ä¸­ï¼Œåƒåƒåœ¾æ”¶é›†å™¨çº¿ç¨‹å°±æ˜¯å®ˆæŠ¤çº¿ç¨‹ã€‚ è¿›ç¨‹çš„åˆ›å»º é€šè¿‡ Runtime.exec() æ–¹æ³•æ¥ï¼› é€šè¿‡ ProcessBuilder çš„ start() æ–¹æ³•ã€‚ é¦–å…ˆè¦è®²çš„æ˜¯ Process ç±»ï¼ŒProcess ç±»æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œåœ¨å®ƒé‡Œé¢ä¸»è¦æœ‰å‡ ä¸ªæŠ½è±¡çš„æ–¹æ³•ã€‚ 12345678910// java.lang.Processpublic abstract class Process &#123; abstract public OutputStream getOutputStream(); // è·å–è¿›ç¨‹çš„è¾“å‡ºæµ abstract public InputStream getInputStream(); // è·å–è¿›ç¨‹çš„è¾“å…¥æµ abstract public InputStream getErrorStream(); // è·å–è¿›ç¨‹çš„é”™è¯¯æµ abstract public int waitFor() throws InterruptedException; // è®©è¿›ç¨‹ç­‰å¾… abstract public int exitValue(); // è·å–è¿›ç¨‹çš„é€€å‡ºæ ‡å¿— abstract public void destroy(); // æ‘§æ¯è¿›ç¨‹&#125; ProcessBuilderProcessBuilder æ˜¯ä¸€ä¸ª final ç±»ï¼Œå®ƒæœ‰ä¸¤ä¸ªæ„é€ å™¨ã€‚ 123456789101112131415161718192021public final class ProcessBuilder &#123; private List&lt;String&gt; command; private File directory; private Map&lt;String,String&gt; environment; private boolean redirectErrorStream; // ä¼ é€’åˆ›å»ºè¿›ç¨‹éœ€è¦çš„å‘½ä»¤å‚æ•° public ProcessBuilder(List&lt;String&gt; command) &#123; if (command == null) throw new NullPointerException(); this.command = command; &#125; // ä¸å®šé•¿å­—ç¬¦ä¸²çš„å½¢å¼ public ProcessBuilder(String... command) &#123; this.command = new ArrayList&lt;String&gt;(command.length); for (String arg : command) this.command.add(arg); &#125; // ....&#125; é€šè¿‡ ProcessBuilder æ¥å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹æ‰“å¼€ cmdï¼Œå¹¶è·å– ip åœ°å€ä¿¡æ¯ã€‚ 123456789101112public class Test &#123; public static void main(String[] args) throws IOException &#123; ProcessBuilder pb = new ProcessBuilder(\"cmd\",\"/c\",\"ipconfig/all\"); // ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ª List Process process = pb.start(); Scanner scanner = new Scanner(process.getInputStream()); while(scanner.hasNextLine())&#123; System.out.println(scanner.nextLine()); &#125; scanner.close(); &#125;&#125; Runtime.exec()ç”±äºä»»ä½•è¿›ç¨‹åªä¼šè¿è¡Œäºä¸€ä¸ªè™šæ‹Ÿæœºå®ä¾‹å½“ä¸­ï¼Œæ‰€ä»¥åœ¨Runtimeä¸­é‡‡ç”¨äº†å•ä¾‹æ¨¡å¼ï¼Œå³åªä¼šäº§ç”Ÿä¸€ä¸ªè™šæ‹Ÿæœºå®ä¾‹. 12345678910111213141516171819public class Runtime &#123; private static Runtime currentRuntime = new Runtime(); public static Runtime getRuntime() &#123; return currentRuntime; &#125; private Runtime() &#123;&#125; // ... public Process exec(String[] cmdarray, String[] envp, File dir) // æ‰€æœ‰å®ç°çš„æœ€ç»ˆå®ç° throws IOException &#123; return new ProcessBuilder(cmdarray) // è°ƒç”¨ ProcessBuilder è¿›è¡Œå®ç° .environment(envp) .directory(dir) .start(); &#125;&#125; é€šè¿‡ Runtime.exec() æ¥å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹æ‰“å¼€ cmdï¼Œå¹¶è·å– ip åœ°å€ä¿¡æ¯ã€‚ 123456789101112public class Test &#123; public static void main(String[] args) throws IOException &#123; String cmd = \"cmd \"+\"/c \"+\"ipconfig/all\"; // ä¸æ”¯æŒä¸å®šé•¿å‚æ•°ï¼Œå¿…é¡»è¿›è¡Œæ‹¼æ¥ Process process = Runtime.getRuntime().exec(cmd); Scanner scanner = new Scanner(process.getInputStream()); while(scanner.hasNextLine())&#123; System.out.println(scanner.nextLine()); &#125; scanner.close(); &#125;&#125; synchronized &amp; Lockå¦‚æœå¯¹ä¸´ç•Œèµ„æºåŠ ä¸Šäº’æ–¥é”ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹åœ¨è®¿é—®è¯¥ä¸´ç•Œèµ„æºæ—¶ï¼Œå…¶ä»–çº¿ç¨‹ä¾¿åªèƒ½ç­‰å¾…ã€‚ åœ¨ Java ä¸­ï¼Œæ¯ä¸€ä¸ªå¯¹è±¡éƒ½æ‹¥æœ‰ä¸€ä¸ªé”æ ‡è®°ï¼ˆmonitorï¼‰ï¼Œä¹Ÿç§°ä¸ºç›‘è§†å™¨ï¼Œå¤šçº¿ç¨‹åŒæ—¶è®¿é—®æŸä¸ªå¯¹è±¡æ—¶ï¼Œçº¿ç¨‹åªæœ‰è·å–äº†è¯¥å¯¹è±¡çš„é”æ‰èƒ½è®¿é—®ã€‚ synchronizedåœ¨ Java ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ synchronized å…³é”®å­—æ¥æ ‡è®°ä¸€ä¸ªæ–¹æ³•æˆ–è€…ä»£ç å—ï¼Œå½“æŸä¸ªçº¿ç¨‹è°ƒç”¨è¯¥å¯¹è±¡çš„ synchronized æ–¹æ³•æˆ–è€…è®¿é—® synchronized ä»£ç å—æ—¶ï¼Œè¿™ä¸ªçº¿ç¨‹ä¾¿è·å¾—äº†è¯¥å¯¹è±¡çš„é”ï¼Œå…¶ä»–çº¿ç¨‹æš‚æ—¶æ— æ³•è®¿é—®è¿™ä¸ªæ–¹æ³•ï¼Œåªæœ‰ç­‰å¾…è¿™ä¸ªæ–¹æ³•æ‰§è¡Œå®Œæ¯•æˆ–è€…ä»£ç å—æ‰§è¡Œå®Œæ¯•ï¼Œè¿™ä¸ªçº¿ç¨‹æ‰ä¼šé‡Šæ”¾è¯¥å¯¹è±¡çš„é”ï¼Œå…¶ä»–çº¿ç¨‹æ‰èƒ½æ‰§è¡Œè¿™ä¸ªæ–¹æ³•æˆ–è€…ä»£ç å—ã€‚ synchronized æ–¹æ³•ä¸¤ä¸ªçº¿ç¨‹åˆ†åˆ«è°ƒç”¨ insertData() å¯¹è±¡æ’å…¥æ•°æ®ã€‚ï¼ˆéåŒæ­¥ï¼‰ 1234567891011121314151617181920212223242526272829public class Test &#123; public static void main(String[] args) &#123; final InsertData insertData = new InsertData(); // åŒ¿åå†…éƒ¨ç±» new Thread() &#123; public void run() &#123; insertData.insert(Thread.currentThread()); &#125;; &#125;.start(); new Thread() &#123; public void run() &#123; insertData.insert(Thread.currentThread()); &#125;; &#125;.start(); &#125; &#125;class InsertData &#123; private ArrayList&lt;Integer&gt; arrayList = new ArrayList&lt;Integer&gt;(); public void insert(Thread thread)&#123; for(int i=0;i&lt;5;i++)&#123; System.out.println(thread.getName()+\"åœ¨æ’å…¥æ•°æ®\"+i); arrayList.add(i); &#125; &#125;&#125; è¾“å‡ºç»“æœè¡¨æ˜ä¸¤ä¸ªçº¿ç¨‹åœ¨åŒæ—¶æ‰§è¡Œinsertæ–¹æ³•ã€‚è€Œå¦‚æœåœ¨insertæ–¹æ³•å‰é¢åŠ ä¸Šå…³é”®å­— synchronizedã€‚ 12345678910class InsertData &#123; private ArrayList&lt;Integer&gt; arrayList = new ArrayList&lt;Integer&gt;(); // åŒæ­¥æ–¹æ³• public synchronized void insert(Thread thread)&#123; for(int i=0;i&lt;5;i++)&#123; System.out.println(thread.getName()+\"åœ¨æ’å…¥æ•°æ®\"+i); arrayList.add(i); &#125; &#125;&#125; è¾“å‡ºç»“æœè¡¨æ˜ä¸¤çº¿ç¨‹é¡ºåºæ‰§è¡Œã€‚ synchronized ä»£ç å—123456789101112131415class InsertData &#123; private ArrayList&lt;Integer&gt; arrayList = new ArrayList&lt;Integer&gt;(); // private Object object = new Object(); public void insert(Thread thread)&#123; // åŒæ­¥ä»£ç å— // this ä»£è¡¨è·å–å½“å‰å¯¹è±¡çš„é”ï¼Œä¹Ÿå¯ä»¥æ˜¯ç±»ä¸­çš„ä¸€ä¸ªå±æ€§ï¼Œä»£è¡¨è·å–è¯¥å±æ€§çš„é”ã€‚ // synchronized (object) &#123; synchronized (this) &#123; for(int i=0;i&lt;100;i++)&#123; System.out.println(thread.getName()+\"åœ¨æ’å…¥æ•°æ®\"+i); arrayList.add(i); &#125; &#125; &#125;&#125; ç±»é” VS. å¯¹è±¡é” å¦å¤–ï¼Œæ¯ä¸ªç±»ä¹Ÿä¼šæœ‰ä¸€ä¸ªé”ï¼Œå®ƒå¯ä»¥ç”¨æ¥æ§åˆ¶å¯¹ static æ•°æ®æˆå‘˜çš„å¹¶å‘è®¿é—®ã€‚å¹¶ä¸”å¦‚æœä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œä¸€ä¸ªå¯¹è±¡çš„é static synchronized æ–¹æ³•ï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹éœ€è¦æ‰§è¡Œè¿™ä¸ªå¯¹è±¡æ‰€å±ç±»çš„ static synchronized æ–¹æ³•ï¼Œæ­¤æ—¶ä¸ä¼šå‘ç”Ÿäº’æ–¥ç°è±¡ï¼Œå› ä¸ºè®¿é—® static synchronized æ–¹æ³•å ç”¨çš„æ˜¯ç±»é”ï¼Œè€Œè®¿é—®é static synchronized æ–¹æ³•å ç”¨çš„æ˜¯å¯¹è±¡é”ï¼Œæ‰€ä»¥ä¸å­˜åœ¨äº’æ–¥ç°è±¡ã€‚ Lock æ¥å£Lock ä¸æ˜¯ Java è¯­è¨€å†…ç½®çš„ï¼Œsynchronized æ˜¯ Java è¯­è¨€çš„å…³é”®å­—ï¼Œå› æ­¤æ˜¯å†…ç½®ç‰¹æ€§ã€‚Lock æ˜¯ä¸€ä¸ªç±»ï¼Œé€šè¿‡è¿™ä¸ªç±»å¯ä»¥å®ç°åŒæ­¥è®¿é—®ï¼› Lock å’Œ synchronized æœ‰ä¸€ç‚¹éå¸¸å¤§çš„ä¸åŒï¼Œé‡‡ç”¨ synchronized ä¸éœ€è¦ç”¨æˆ·å»æ‰‹åŠ¨é‡Šæ”¾é”ï¼Œå½“ synchronized æ–¹æ³•æˆ–è€… synchronized ä»£ç å—æ‰§è¡Œå®Œä¹‹åï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è®©çº¿ç¨‹é‡Šæ”¾å¯¹é”çš„å ç”¨ï¼›è€Œ Lock åˆ™å¿…é¡»è¦ç”¨æˆ·å»æ‰‹åŠ¨é‡Šæ”¾é”ï¼Œå¦‚æœæ²¡æœ‰ä¸»åŠ¨é‡Šæ”¾é”ï¼Œå°±æœ‰å¯èƒ½å¯¼è‡´å‡ºç°æ­»é”ç°è±¡ã€‚ 12345678public interface Lock &#123; void lock(); void lockInterruptibly() throws InterruptedException; boolean tryLock(); boolean tryLock(long time, TimeUnit unit) throws InterruptedException; void unlock(); Condition newCondition();&#125; é‡‡ç”¨ Lockï¼Œå¿…é¡»ä¸»åŠ¨å»é‡Šæ”¾é”ï¼Œå¹¶ä¸”åœ¨å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œä¸ä¼šè‡ªåŠ¨é‡Šæ”¾é”ã€‚å› æ­¤ä¸€èˆ¬æ¥è¯´ï¼Œä½¿ç”¨ Lock å¿…é¡»åœ¨ try catch å—ä¸­è¿›è¡Œï¼Œå¹¶ä¸”å°†é‡Šæ”¾é”çš„æ“ä½œæ”¾åœ¨ finally å—ä¸­è¿›è¡Œï¼Œä»¥ä¿è¯é”ä¸€å®šè¢«è¢«é‡Šæ”¾ï¼Œé˜²æ­¢æ­»é”çš„å‘ç”Ÿã€‚ 123456789Lock lock = ...;lock.lock();try&#123; // å¤„ç†ä»»åŠ¡&#125;catch(Exception ex)&#123; &#125;finally&#123; lock.unlock(); // é‡Šæ”¾é”&#125; tryLock æ–¹æ³•æ˜¯æœ‰è¿”å›å€¼çš„ï¼Œå®ƒè¡¨ç¤ºç”¨æ¥å°è¯•è·å–é”ï¼Œå¦‚æœè·å–æˆåŠŸï¼Œåˆ™è¿”å› trueï¼Œå¦‚æœè·å–å¤±è´¥ï¼ˆå³é”å·²è¢«å…¶ä»–çº¿ç¨‹è·å–ï¼‰ï¼Œåˆ™è¿”å› falseï¼Œä¹Ÿå°±è¯´è¿™ä¸ªæ–¹æ³•æ— è®ºå¦‚ä½•éƒ½ä¼šç«‹å³è¿”å›ã€‚åœ¨æ‹¿ä¸åˆ°é”æ—¶ä¸ä¼šä¸€ç›´åœ¨é‚£ç­‰å¾…ã€‚ tryLock(long time, TimeUnit unit) å’Œ tryLock æ–¹æ³•æ˜¯ç±»ä¼¼çš„ï¼Œåªä¸è¿‡åŒºåˆ«åœ¨äºè¿™ä¸ªæ–¹æ³•åœ¨æ‹¿ä¸åˆ°é”æ—¶ä¼šç­‰å¾…ä¸€å®šçš„æ—¶é—´ï¼Œåœ¨æ—¶é—´æœŸé™ä¹‹å†…å¦‚æœè¿˜æ‹¿ä¸åˆ°é”ï¼Œå°±è¿”å› falseã€‚å¦‚æœå¦‚æœä¸€å¼€å§‹æ‹¿åˆ°é”æˆ–è€…åœ¨ç­‰å¾…æœŸé—´å†…æ‹¿åˆ°äº†é”ï¼Œåˆ™è¿”å› trueã€‚ 123456789101112Lock lock = ...;if(lock.tryLock()) &#123; try&#123; // å¤„ç†ä»»åŠ¡ &#125;catch(Exception ex)&#123; &#125;finally&#123; lock.unlock(); // é‡Šæ”¾é” &#125; &#125; else &#123; // å¦‚æœä¸èƒ½è·å–é”ï¼Œåˆ™ç›´æ¥åšå…¶ä»–äº‹æƒ…&#125; lockInterruptibly æ–¹æ³•æ¯”è¾ƒç‰¹æ®Šï¼Œå½“é€šè¿‡è¿™ä¸ªæ–¹æ³•å»è·å–é”æ—¶ï¼Œå¦‚æœçº¿ç¨‹æ­£åœ¨ç­‰å¾…è·å–é”ï¼Œåˆ™è¿™ä¸ªçº¿ç¨‹èƒ½å¤Ÿå“åº”ä¸­æ–­ï¼Œå³ä¸­æ–­çº¿ç¨‹çš„ç­‰å¾…çŠ¶æ€ã€‚ä¹Ÿå°±ä½¿è¯´ï¼Œå½“ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶é€šè¿‡ lock.lockInterruptibly() æƒ³è·å–æŸä¸ªé”æ—¶ï¼Œå‡è‹¥æ­¤æ—¶çº¿ç¨‹ A è·å–åˆ°äº†é”ï¼Œè€Œçº¿ç¨‹Båªæœ‰ç»§ç»­ç­‰å¾…ï¼Œé‚£ä¹ˆå¯¹çº¿ç¨‹ B è°ƒç”¨ threadB.interrupt() èƒ½å¤Ÿä¸­æ–­çº¿ç¨‹ Bçš„ç­‰å¾…è¿‡ç¨‹ã€‚ 123456789public void method() throws InterruptedException &#123; lock.lockInterruptibly(); try &#123; // ... &#125; finally &#123; lock.unlock(); &#125; &#125; ReentrantLockå¯é‡å…¥é”çš„ä¸€ç§ï¼Œåé¢è¯¦ç»†ä»‹ç»ï¼Œå…ˆæ¥çœ‹ä¸€ä¸‹å¸¸ç”¨ç”¨æ³•ã€‚ 123456789101112131415161718192021222324252627282930313233// é”™è¯¯æ¡ˆä¾‹public class Test &#123; public static void main(String[] args) &#123; final Test test = new Test(); new Thread()&#123; public void run() &#123; test.insert(Thread.currentThread()); &#125;; &#125;.start(); new Thread()&#123; public void run() &#123; test.insert(Thread.currentThread()); &#125;; &#125;.start(); &#125; public void insert(Thread thread) &#123; // æ³¨æ„ï¼ï¼ï¼è¿™æ˜¯ä¸€ä¸ªå±€éƒ¨å˜é‡ Lock lock = new ReentrantLock(); // å®ä¾‹åŒ–ä¸€ä¸ª ReentrantLock ç±»å‹å¯¹è±¡ // æ¯ä¸ªçº¿ç¨‹æ‰§è¡Œåˆ° lock.lock() å¤„è·å–çš„æ˜¯ä¸åŒçš„é”ï¼Œæ­¤é”æ— æ•ˆ lock.lock(); try &#123; System.out.println(thread.getName()+\"å¾—åˆ°äº†é”\"); &#125; catch (Exception e) &#123; &#125;finally &#123; System.out.println(thread.getName()+\"é‡Šæ”¾äº†é”\"); lock.unlock(); &#125; &#125;&#125; å°† lock å£°æ˜ä¸ºç±»çš„å±æ€§ï¼Œå³å…¨å±€å˜é‡ã€‚ 12345public class Test &#123; private Lock lock = new ReentrantLock(); // å…¨å±€å˜é‡ //...&#125; lockInterruptibly() å“åº”ä¸­æ–­çš„ä½¿ç”¨æ–¹æ³• 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152public class Test &#123; // å…¨å±€å˜é‡ private Lock lock = new ReentrantLock(); public static void main(String[] args) &#123; Test test = new Test(); MyThread thread1 = new MyThread(test); MyThread thread2 = new MyThread(test); thread1.start(); thread2.start(); try &#123; Thread.sleep(2000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; thread2.interrupt(); &#125; public void insert(Thread thread) throws InterruptedException&#123; lock.lockInterruptibly(); // çº¿ç¨‹ 1 è·å¾—é” çº¿ç¨‹ 2 å¤„äºç­‰å¾…ï¼Œå¹¶ä¸”å°†è¢«æ‰“æ–­ç­‰å¾… try &#123; System.out.println(thread.getName()+\"å¾—åˆ°äº†é”\"); long startTime = System.currentTimeMillis(); for( ; ;) &#123; if(System.currentTimeMillis() - startTime &gt;= 10000) break; // æ’å…¥æ•°æ® &#125; &#125; finally &#123; System.out.println(Thread.currentThread().getName()+\"æ‰§è¡Œfinally\"); lock.unlock(); System.out.println(thread.getName()+\"é‡Šæ”¾äº†é”\"); &#125; &#125;&#125;class MyThread extends Thread &#123; private Test test = null; public MyThread(Test test) &#123; this.test = test; &#125; @Override public void run() &#123; try &#123; test.insert(Thread.currentThread()); &#125; catch (InterruptedException e) &#123; System.out.println(Thread.currentThread().getName()+\"è¢«ä¸­æ–­\"); &#125; &#125;&#125; ReadWriteLock æ¥å£å°†æ–‡ä»¶çš„è¯»å†™æ“ä½œåˆ†å¼€ï¼Œåˆ†æˆ 2 ä¸ªé”æ¥åˆ†é…ç»™çº¿ç¨‹ï¼Œä»è€Œä½¿å¾—å¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è¿›è¡Œè¯»æ“ä½œã€‚ 1234567public interface ReadWriteLock &#123; // è¯»é” Lock readLock(); // å†™é” Lock writeLock();&#125; ReentrantReadWriteLock å®ç°äº† ReadWriteLock æ¥å£ã€‚ 12345678910111213141516171819202122232425262728293031323334public class Test &#123; private ReentrantReadWriteLock rwl = new ReentrantReadWriteLock(); public static void main(String[] args) &#123; final Test test = new Test(); new Thread()&#123; public void run() &#123; test.get(Thread.currentThread()); &#125;; &#125;.start(); new Thread()&#123; public void run() &#123; test.get(Thread.currentThread()); &#125;; &#125;.start(); &#125; public void get(Thread thread) &#123; rwl.readLock().lock(); try &#123; long start = System.currentTimeMillis(); while(System.currentTimeMillis() - start &lt;= 1) &#123; System.out.println(thread.getName()+\"æ­£åœ¨è¿›è¡Œè¯»æ“ä½œ\"); &#125; System.out.println(thread.getName()+\"è¯»æ“ä½œå®Œæ¯•\"); &#125; finally &#123; rwl.readLock().unlock(); &#125; &#125;&#125; ä¸¤çº¿ç¨‹åŒæ—¶è¿›è¡Œè¯»æ“ä½œã€‚ é”çš„ç§ç±»ä»‹ç»ä¸é”ç›¸å…³çš„å‡ ä¸ªæ¦‚å¿µã€‚ å¯é‡å…¥é”å¦‚æœè¯´é”å…·å¤‡å¯é‡å…¥æ€§ï¼Œé‚£è¿™ä¸ªé”ä¸ºå¯é‡å…¥é”å³åŸºäºçº¿ç¨‹çš„åˆ†é…ï¼Œè€Œä¸æ˜¯åŸºäºæ–¹æ³•è°ƒç”¨çš„åˆ†é…ã€‚åƒ synchronized å’Œ ReentrantLock éƒ½æ˜¯å¯é‡å…¥é”ã€‚ å½“ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œåˆ°æŸä¸ª synchronized æ–¹æ³•æ—¶ï¼Œæ¯”å¦‚è¯´ methodAï¼Œè€Œåœ¨ methodA ä¸­ä¼šè°ƒç”¨å¦å¤–ä¸€ä¸ª synchronized æ–¹æ³• methodBï¼Œæ­¤æ—¶çº¿ç¨‹ä¸å¿…é‡æ–°å»ç”³è¯·é”ï¼Œè€Œæ˜¯å¯ä»¥ç›´æ¥æ‰§è¡Œæ–¹æ³• methodBã€‚å› ä¸ºå¯é‡å…¥é”çš„åˆ†é…æ˜¯åŸºäºçº¿ç¨‹çš„ï¼ŒåŒä¸€çº¿ç¨‹ä¸å¿…é‡æ–°ç”³è¯·é”ã€‚ å¯ä¸­æ–­é”åœ¨ Java ä¸­ï¼Œsynchronized å°±ä¸æ˜¯å¯ä¸­æ–­é”ï¼Œè€Œ Lock æ˜¯å¯ä¸­æ–­é”ã€‚ å…¬å¹³é”å…¬å¹³é”å³å°½é‡ä»¥è¯·æ±‚é”çš„é¡ºåºæ¥è·å–é”ã€‚æ¯”å¦‚åŒæ˜¯æœ‰å¤šä¸ªçº¿ç¨‹åœ¨ç­‰å¾…ä¸€ä¸ªé”ï¼Œå½“è¿™ä¸ªé”è¢«é‡Šæ”¾æ—¶ï¼Œç­‰å¾…æ—¶é—´æœ€ä¹…çš„çº¿ç¨‹ï¼ˆæœ€å…ˆè¯·æ±‚çš„çº¿ç¨‹ï¼‰ä¼šè·å¾—è¯¥æ‰€ï¼Œè¿™ç§å°±æ˜¯å…¬å¹³é”ã€‚ éå…¬å¹³é”å³æ— æ³•ä¿è¯é”çš„è·å–æ˜¯æŒ‰ç…§è¯·æ±‚é”çš„é¡ºåºè¿›è¡Œçš„ã€‚è¿™æ ·å°±å¯èƒ½å¯¼è‡´æŸä¸ªæˆ–è€…ä¸€äº›çº¿ç¨‹æ°¸è¿œè·å–ä¸åˆ°é”ã€‚ åœ¨ Java ä¸­ï¼Œsynchronized å°±æ˜¯éå…¬å¹³é”ï¼Œå®ƒæ— æ³•ä¿è¯ç­‰å¾…çš„çº¿ç¨‹è·å–é”çš„é¡ºåºã€‚è€Œå¯¹äº ReentrantLock å’Œ ReentrantReadWriteLockï¼Œå®ƒé»˜è®¤æƒ…å†µä¸‹æ˜¯éå…¬å¹³é”ï¼Œä½†æ˜¯å¯ä»¥è®¾ç½®ä¸ºå…¬å¹³é”ã€‚ è¯»å†™é”è¯»å†™é”å°†å¯¹ä¸€ä¸ªèµ„æºï¼ˆæ¯”å¦‚æ–‡ä»¶ï¼‰çš„è®¿é—®åˆ†æˆäº† 2 ä¸ªé”ï¼Œä¸€ä¸ªè¯»é”å’Œä¸€ä¸ªå†™é”ã€‚æ­£å› ä¸ºæœ‰äº†è¯»å†™é”ï¼Œæ‰ä½¿å¾—å¤šä¸ªçº¿ç¨‹ä¹‹é—´çš„è¯»æ“ä½œä¸ä¼šå‘ç”Ÿå†²çªã€‚","categories":[{"name":"åŸºç¡€çŸ¥è¯†","slug":"åŸºç¡€çŸ¥è¯†","permalink":"http://yoursite.com/categories/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"}],"tags":[{"name":"é«˜å¹¶å‘ç¼–ç¨‹","slug":"é«˜å¹¶å‘ç¼–ç¨‹","permalink":"http://yoursite.com/tags/%E9%AB%98%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"}]},{"title":"è®¾è®¡æ¨¡å¼","slug":"æŠ€æœ¯åŸç†/è®¾è®¡æ¨¡å¼","date":"2020-03-20T02:21:09.000Z","updated":"2020-07-10T02:54:14.246Z","comments":true,"path":"2020/03/20/æŠ€æœ¯åŸç†/è®¾è®¡æ¨¡å¼/","link":"","permalink":"http://yoursite.com/2020/03/20/%E6%8A%80%E6%9C%AF%E5%8E%9F%E7%90%86/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/","excerpt":"Java è®¾è®¡æ¨¡å¼ã€‚","text":"Java è®¾è®¡æ¨¡å¼ã€‚ è®¾è®¡æ¨¡å¼è®¾è®¡æ¨¡å¼çš„ä½œç”¨ï¼Ÿ æ‰¾å‡ºåº”ç”¨ä¸­å¯èƒ½éœ€è¦å˜åŒ–ä¹‹å¤„ï¼ŒæŠŠå®ƒä»¬ç‹¬ç«‹å‡ºæ¥ï¼Œä¸è¦å’Œé‚£äº›ä¸éœ€è¦å˜åŒ–çš„ä»£ç æ··åœ¨ä¸€èµ·ï¼› é’ˆå¯¹æ¥å£ç¼–ç¨‹ï¼Œè€Œä¸æ˜¯é’ˆå¯¹å®ç°ç¼–ç¨‹ï¼› è§£è€¦ã€‚ ä¸ƒå¤§åŸåˆ™ å•ä¸€èŒè´£åŸåˆ™ æ¥å£éš”ç¦»åŸåˆ™ ä¾èµ–å€’è½¬ï¼ˆå€’ç½®ï¼‰åŸåˆ™ é‡Œæ°æ›¿æ¢åŸåˆ™ å¼€é—­åŸåˆ™ è¿ªç±³ç‰¹æ³•åˆ™ åˆæˆå¤ç”¨åŸåˆ™ å•ä¸€èŒè´£æ­¤åŸåˆ™æ˜¯å¯¹äºç±»æ¥è¯´çš„ï¼Œå³ä¸€ä¸ªç±»åº”è¯¥åªè´Ÿè´£ä¸€é¡¹èŒè´£ã€‚ 123456789101112131415class RoadVehicle &#123; public void run(String vehicle) &#123; System.out.println(vehicle + \"å…¬è·¯è¿è¡Œ\"); &#125;&#125;class AirVehicle &#123; public void run(String vehicle) &#123; System.out.println(vehicle + \"å¤©ç©ºè¿è¡Œ\"); &#125;&#125;class WaterVehicle &#123; public void run(String vehicle) &#123; System.out.println(vehicle + \"æ°´ä¸­è¿è¡Œ\"); &#125;&#125; åœ¨æ–¹æ³•çº§åˆ«ä¸Šéµå®ˆå•ä¸€èŒè´£ 12345678910class Vehicle &#123; public void runRoad(String vehicle) &#123; System.out.println(vehicle + \" åœ¨å…¬è·¯ä¸Šè¿è¡Œ...\"); &#125; public void runAir(String vehicle) &#123; System.out.println(vehicle + \" åœ¨å¤©ç©ºä¸Šè¿è¡Œ...\"); &#125; public void runWater(String vehicle) &#123; System.out.println(vehicle + \" åœ¨æ°´ä¸­è¡Œ...\"); &#125; é™ä½ç±»çš„å¤æ‚åº¦ï¼Œä¸€ä¸ªç±»åªè´Ÿè´£ä¸€é¡¹èŒè´£ï¼› æé«˜ç±»çš„å¯è¯»æ€§ï¼Œå¯ç»´æŠ¤æ€§ï¼› é™ä½å˜æ›´å¼•èµ·çš„é£é™©ã€‚ é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åº”å½“éµå®ˆå•ä¸€èŒè´£åŸåˆ™ï¼Œåªæœ‰é€»è¾‘è¶³å¤Ÿç®€å•ï¼Œæ‰å¯ä»¥åœ¨ä»£ç çº§è¿åå•ä¸€èŒè´£åŸåˆ™ï¼›åªæœ‰ç±»ä¸­æ–¹æ³•æ•°é‡è¶³å¤Ÿå°‘ï¼Œå¯ä»¥åœ¨æ–¹æ³•çº§åˆ«ä¿æŒå•ä¸€èŒè´£åŸåˆ™ã€‚ æ¥å£éš”ç¦»å³ä¸€ä¸ªç±»å¯¹å¦ä¸€ä¸ªç±»çš„ä¾èµ–åº”è¯¥å»ºç«‹åœ¨æœ€å°çš„æ¥å£ä¸Šã€‚å…ˆçœ‹çœ‹ä¸ç¬¦åˆæ¥å£éš”ç¦»åŸåˆ™çš„è®¾è®¡æ˜¯æ€ä¹ˆæ ·çš„ã€‚ 123456789101112131415161718192021222324252627282930313233// æ¥å£æœ‰ 5 ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œåˆ™æ¯ä¸ªå®ç°äº†æ­¤æ¥å£çš„ç±»éƒ½éœ€è¦å®ç°è¿™ 5 ä¸ªæŠ½è±¡æ–¹æ³•interface Interface1 &#123; void operation1(); void operation2(); void operation3(); void operation4(); void operation5();&#125;// Class Bã€D çœç•¥class A &#123; //A ç±»é€šè¿‡æ¥å£ Interface1 ä¾èµ–(ä½¿ç”¨) B ç±»ï¼Œä½†æ˜¯åªä¼šç”¨åˆ° 1,2,3 æ–¹æ³• public void depend1(Interface1 i) &#123; i.operation1(); &#125; public void depend2(Interface1 i) &#123; i.operation2(); &#125; public void depend3(Interface1 i) &#123; i.operation3(); &#125;&#125;class C &#123; //C ç±»é€šè¿‡æ¥å£ Interface1 ä¾èµ–(ä½¿ç”¨) D ç±»ï¼Œä½†æ˜¯åªä¼šç”¨åˆ° 1,4,5 æ–¹æ³• public void depend1(Interface1 i) &#123; i.operation1(); &#125; public void depend4(Interface1 i) &#123; i.operation4(); &#125; public void depend5(Interface1 i) &#123; i.operation5(); &#125;&#125; ä»ä¸Šé¢çš„ä¾‹å­ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæ¥å£ä¸­çš„ 5 ä¸ªæŠ½è±¡æ–¹æ³• Bã€D ä¸ç®¡æ˜¯å¦ä½¿ç”¨éƒ½è¦å¯¹å…¶è¿›è¡Œå®ç°ï¼Œè¿™å°±é€ æˆäº†ä¸€å®šç¨‹åº¦ä¸Šçš„ä»£ç å†—æ‚ã€‚æ¥ä¸‹æ¥çœ‹çœ‹ç¬¦åˆæ¥å£éš”ç¦»åŸåˆ™çš„è®¾è®¡æ˜¯æ€ä¹ˆæ ·çš„ã€‚ 1234567891011121314151617181920212223interface Interface1 &#123; void operation1();&#125;interface Interface2 &#123; void operation2(); void operation3();&#125;interface Interface3 &#123; void operation4(); void operation5();&#125;// æµ‹è¯•public static void main(String[] args) &#123; A a = new A(); a.depend1(new B()); // A ç±»é€šè¿‡æ¥å£å»ä¾èµ– B ç±» a.depend2(new B()); a.depend3(new B()); C c = new C(); c.depend1(new D()); // C ç±»é€šè¿‡æ¥å£å»ä¾èµ–(ä½¿ç”¨) D ç±» c.depend4(new D()); c.depend5(new D());&#125; ä¾èµ–å€’è½¬ä¾èµ–å€’è½¬åŸåˆ™æ˜¯åŸºäºè¿™æ ·çš„è®¾è®¡ç†å¿µï¼šç›¸å¯¹äºç»†èŠ‚çš„å¤šå˜æ€§ï¼ŒæŠ½è±¡çš„ä¸œè¥¿è¦ç¨³å®šçš„å¤šã€‚ä»¥æŠ½è±¡ä¸ºåŸºç¡€æ­å»ºçš„æ¶æ„æ¯”ä»¥ç»†èŠ‚ä¸ºåŸºç¡€çš„æ¶æ„è¦ç¨³å®šçš„å¤šã€‚åœ¨ Java ä¸­ï¼ŒæŠ½è±¡æŒ‡çš„æ˜¯æ¥å£æˆ–æŠ½è±¡ç±»ï¼Œç»†èŠ‚å°±æ˜¯å…·ä½“çš„å®ç°ç±»ï¼Œä½¿ç”¨æ¥å£æˆ–æŠ½è±¡ç±»çš„ç›®çš„æ˜¯åˆ¶å®šå¥½è§„èŒƒï¼Œè€Œä¸æ¶‰åŠä»»ä½•å…·ä½“çš„æ“ä½œï¼ŒæŠŠå±•ç°ç»†èŠ‚çš„ä»»åŠ¡äº¤ç»™ä»–ä»¬çš„å®ç°ç±»å»å®Œæˆï¼š é«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–ä½å±‚æ¨¡å—ï¼ŒäºŒè€…éƒ½åº”è¯¥ä¾èµ–å…¶æŠ½è±¡ï¼› æŠ½è±¡ä¸åº”è¯¥ä¾èµ–ç»†èŠ‚ï¼Œç»†èŠ‚åº”è¯¥ä¾èµ–æŠ½è±¡ï¼› ä¾èµ–å€’è½¬ï¼ˆå€’ç½®ï¼‰çš„ä¸­å¿ƒæ€æƒ³æ˜¯é¢å‘æ¥å£ç¼–ç¨‹ï¼› 123456789101112131415161718192021222324252627282930public class DependecyInversion &#123; public static void main(String[] args) &#123; // å®¢æˆ·ç«¯æ— éœ€æ”¹å˜ Person person = new Person(); person.receive(new Email()); person.receive(new WeiXin()); &#125;&#125;class Person &#123; // è¿™é‡Œæˆ‘ä»¬æ˜¯å¯¹æ¥å£çš„ä¾èµ–ï¼Œä¸éœ€è¦è€ƒè™‘æ¥å£çš„å…·ä½“å®ç° public void receive(IReceiver receiver) &#123; System.out.println(receiver.getInfo()); &#125;&#125;// å®šä¹‰æ¥å£interface IReceiver &#123; public String getInfo();&#125;// å®ç°ç±»è¿›è¡Œæ˜¯å®ç°class Email implements IReceiver &#123; public String getInfo() &#123; return \"ç”µå­é‚®ä»¶ä¿¡æ¯: hello,world\"; &#125;&#125;// å®ç°ç±»è¿›è¡Œå®ç°class WeiXin implements IReceiver &#123; public String getInfo() &#123; return \"å¾®ä¿¡ä¿¡æ¯: hello,ok\"; &#125;&#125; ä¾èµ–ä¼ é€’ æ¥å£ä¼ é€’ï¼› æ„é€ æ–¹æ³•ä¼ é€’ï¼› Setter æ–¹æ³•ä¼ é€’ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556// æ–¹å¼ä¸€ï¼šé€šè¿‡æ¥å£ä¼ é€’å®ç°ä¾èµ–interface IOpenAndClose &#123; public void open(ITV tv); // æŠ½è±¡æ–¹æ³•ï¼Œæ¥æ”¶æ¥å£å®ç°ä»¥æ¥ä¼ é€’&#125;interface ITV &#123; public void play();&#125;class OpenAndClose implements IOpenAndClose&#123; public void open(ITV tv)&#123; tv.play(); &#125;&#125;class ChangHong implements ITV &#123; @Override public void play() &#123; System.out.println(\"é•¿è™¹ç”µè§†æœºï¼Œæ‰“å¼€\"); &#125;&#125;// æ–¹å¼äºŒï¼šé€šè¿‡æ„é€ æ–¹æ³•ä¾èµ–interface IOpenAndClose &#123; public void open();&#125;interface ITV &#123; public void play();&#125;class OpenAndClose implements IOpenAndClose&#123; private ITV tv; // æˆå‘˜ public OpenAndClose(ITV tv)&#123; // æ„é€ å™¨ this.tv = tv; &#125; public void open()&#123; this.tv.play(); &#125;&#125;// æ–¹å¼ä¸‰ï¼šé€šè¿‡ Setter æ–¹æ³•ä¼ é€’interface IOpenAndClose &#123; public void open(); public void setTv(ITV tv); // Setter æ–¹æ³•&#125;interface ITV &#123; public void play();&#125;class OpenAndClose implements IOpenAndClose &#123; private ITV tv; public void setTv(ITV tv) &#123; this.tv = tv; &#125; public void open() &#123; this.tv.play(); &#125;&#125; é‡Œæ°æ›¿æ¢ç»§æ‰¿åœ¨ç»™ç¨‹åºè®¾è®¡å¸¦æ¥ä¾¿åˆ©çš„åŒæ—¶ï¼Œä¹Ÿå¸¦æ¥äº†å¼Šç«¯ã€‚æ¯”å¦‚ä½¿ç”¨ç»§æ‰¿ä¼šç»™ç¨‹åºå¸¦æ¥ä¾µå…¥æ€§ã€ç¨‹åºçš„å¯ç§»æ¤æ€§é™ä½ã€å¢åŠ å¯¹è±¡é—´çš„è€¦åˆæ€§ç­‰é—®é¢˜ã€‚å¦‚æœä¸€ä¸ªç±»è¢«å…¶ä»–çš„ç±»æ‰€ç»§æ‰¿ï¼Œåˆ™å½“è¿™ä¸ªç±»éœ€è¦ä¿®æ”¹æ—¶ï¼Œå¿…é¡»è€ƒè™‘åˆ°æ‰€æœ‰çš„å­ç±»ï¼Œå¹¶ä¸”çˆ¶ç±»ä¿®æ”¹åï¼Œæ‰€æœ‰æ¶‰åŠåˆ°å­ç±»çš„åŠŸèƒ½éƒ½æœ‰å¯èƒ½äº§ç”Ÿæ•…éšœã€‚ ç”¨äºè§£å†³å¦‚ä½•æ­£ç¡®ä½¿ç”¨ç»§æ‰¿ï¼Ÿ ğŸ‘‰ é‡Œæ°æ›¿æ¢åŸåˆ™ã€‚ æ‰€æœ‰å¼•ç”¨åŸºç±»çš„åœ°æ–¹å¿…é¡»èƒ½é€æ˜åœ°ä½¿ç”¨å…¶å­ç±»çš„å¯¹è±¡ï¼›åœ¨å­ç±»ä¸­å°½é‡ä¸è¦é‡å†™çˆ¶ç±»çš„æ–¹æ³•ï¼›ç»§æ‰¿å®é™…ä¸Šè®©ä¸¤ä¸ªç±»è€¦åˆæ€§å¢å¼ºäº†ï¼Œåœ¨é€‚å½“çš„æƒ…å†µä¸‹å¯ä»¥é€šè¿‡èšåˆã€ç»„åˆã€ä¾èµ–æ¥è§£å†³é—®é¢˜ã€‚ 1234567891011121314151617181920212223242526272829public class Liskov &#123; public static void main(String[] args) &#123; A a = new A(); System.out.println(\"11-3=\" + a.func1(11, 3)); System.out.println(\"1-8=\" + a.func1(1, 8)); System.out.println(\"-----------------------\"); B b = new B(); System.out.println(\"11-3=\" + b.func1(11, 3)); // è¿™é‡Œæœ¬æ„æ˜¯æ±‚å‡º 11-3 System.out.println(\"1-8=\" + b.func1(1, 8)); // 1-8 System.out.println(\"11+3+9=\" + b.func2(11, 3)); &#125;&#125;class A &#123; // è¿”å›ä¸¤ä¸ªæ•°çš„å·® public int func1(int num1, int num2) &#123; return num1 - num2; &#125;&#125;// B ç±»ç»§æ‰¿äº† A å¹¶ä¸”å¢åŠ äº†ä¸€ä¸ªæ–°åŠŸèƒ½ï¼šå®Œæˆä¸¤ä¸ªæ•°ç›¸åŠ ï¼Œç„¶åå’Œ 9 æ±‚å’Œclass B extends A &#123; // è¿™é‡Œé‡å†™äº† A ç±»çš„æ–¹æ³•, é€ æˆåŸæœ‰æ–¹æ³•é”™è¯¯ public int func1(int a, int b) &#123; return a + b; &#125; public int func2(int a, int b) &#123; return func1(a, b) + 9; &#125;&#125; æ”¹è¿›æ–¹æ¡ˆï¼šåŸæ¥çš„çˆ¶ç±»å’Œå­ç±»éƒ½ç»§æ‰¿ä¸€ä¸ªæ›´é€šä¿—çš„åŸºç±»ï¼ŒåŸæœ‰çš„ç»§æ‰¿å…³ç³»å»æ‰ï¼Œé‡‡ç”¨ä¾èµ–ã€èšåˆã€ç»„åˆç­‰å…³ç³»ä»£æ›¿ã€‚ 123456789101112131415class B extends Base &#123; // å¦‚æœ B éœ€è¦ä½¿ç”¨ A ç±»çš„æ–¹æ³•ï¼Œä½¿ç”¨ç»„åˆå…³ç³» private A a = new A(); // æ­¤æ–¹æ³•ä¸å†æ˜¯é‡å†™æ–¹æ³• public int func1(int a, int b) &#123; return a + b; &#125; public int func2(int a, int b) &#123; return func1(a, b) + 9; &#125; // ä½¿ç”¨ A ç±»çš„æ–¹æ³• public int func3(int a, int b) &#123; return this.a.func1(a, b); &#125;&#125; å¼€é—­åŸåˆ™ç±»ï¼Œæ¨¡å—å’Œå‡½æ•°åº”è¯¥å¯¹æ‰©å±•å¼€æ”¾ï¼ˆå¯¹æä¾›æ–¹ï¼‰ï¼Œå¯¹ä¿®æ”¹å…³é—­ï¼ˆå¯¹ä½¿ç”¨æ–¹ï¼‰ã€‚ç”¨æŠ½è±¡æ„å»ºæ¡†æ¶ï¼Œç”¨å®ç°æ‰©å±•ç»†èŠ‚ï¼›å½“è½¯ä»¶éœ€è¦å˜åŒ–æ—¶ï¼Œå°½é‡é€šè¿‡æ‰©å±•è½¯ä»¶å®ä½“çš„è¡Œä¸ºæ¥å®ç°å˜åŒ–ï¼Œè€Œä¸æ˜¯é€šè¿‡ä¿®æ”¹å·²æœ‰çš„ä»£ç æ¥å®ç°å˜åŒ–ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546public class Ocp &#123; public static void main(String[] args) &#123; GraphicEditor graphicEditor = new GraphicEditor(); graphicEditor.drawShape(new Rectangle()); graphicEditor.drawShape(new Circle()); &#125;&#125;// æ­¤å†™æ³•å½“å‘ç”Ÿæ‰©å±•æ—¶ï¼Œæ¯”å¦‚æ·»åŠ å¯ä»¥ç»˜åˆ¶çš„å›¾å½¢ç±»å‹ï¼Œéœ€è¦ä¿®æ”¹ä½¿ç”¨æ–¹// è¿™æ˜¯ä¸€ä¸ªç”¨äºç»˜å›¾çš„ç±»ï¼Œæ­¤ç±»ä¸ºä½¿ç”¨æ–¹class GraphicEditor &#123; // æ¥æ”¶ Shape å¯¹è±¡ï¼Œç„¶åæ ¹æ® typeï¼Œæ¥ç»˜åˆ¶ä¸åŒçš„å›¾å½¢ public void drawShape(Shape s) &#123; if (s.m_type == 1) drawRectangle(); else if (s.m_type == 2) drawCircle(); else if (s.m_type == 3) drawTriangle(); &#125; // ç»˜åˆ¶çŸ©å½¢ public void drawRectangle() &#123; System.out.println(\" ç»˜åˆ¶çŸ©å½¢ \"); &#125; // ç»˜åˆ¶åœ†å½¢ public void drawCircle() &#123; System.out.println(\" ç»˜åˆ¶åœ†å½¢ \"); &#125; // ç»˜åˆ¶ä¸‰è§’å½¢ public void drawTriangle() &#123; System.out.println(\" ç»˜åˆ¶ä¸‰è§’å½¢ \"); &#125;&#125;// Shape ç±»ï¼ŒåŸºç±»class Shape &#123; int m_type;&#125;class Rectangle extends Shape &#123; Rectangle() &#123; super.m_type = 1; &#125;&#125;class Circle extends Shape &#123; Circle() &#123; super.m_type = 2; &#125;&#125; è¿™ç§ä»£ç çš„ç¼–å†™æ–¹å¼è¿åäº†è®¾è®¡æ¨¡å¼çš„ OCP åŸåˆ™ï¼Œå³å¯¹æ‰©å±•å¼€æ”¾(æä¾›æ–¹)ï¼Œå¯¹ä¿®æ”¹å…³é—­(ä½¿ç”¨æ–¹)ã€‚å³å½“æˆ‘ä»¬ç»™ç±»å¢åŠ æ–°åŠŸèƒ½çš„æ—¶å€™ï¼Œå°½é‡ä¸ä¿®æ”¹ä»£ç ï¼Œæˆ–è€…å°½å¯èƒ½å°‘ä¿®æ”¹ä»£ç ã€‚å¹¶ä¸”ï¼Œå°±å•ä¸€èŒè´£è€Œè¨€ï¼Œä½¿ç”¨æ–¹ç±»çš„èŒè´£å°±åªæœ‰ä½¿ç”¨è€Œå·²ï¼Œè‡³äºå¦‚ä½•å»è¿›è¡Œå®ç°è¿™äº›ç»†èŠ‚ä¸åº”è¯¥åœ¨æ­¤ç±»ä¸­å‡ºç°ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960public class Ocp &#123; public static void main(String[] args) &#123; GraphicEditor graphicEditor = new GraphicEditor(); graphicEditor.drawShape(new Rectangle()); graphicEditor.drawShape(new Circle()); graphicEditor.drawShape(new Triangle()); graphicEditor.drawShape(new OtherGraphic()); &#125;&#125;class GraphicEditor &#123; // ä»…ä»…æ˜¯ä½¿ç”¨ draw() æ–¹æ³• public void drawShape(Shape s) &#123; s.draw(); &#125;&#125;abstract class Shape &#123; int m_type; public abstract void draw(); //æŠ½è±¡æ–¹æ³•&#125;class Rectangle extends Shape &#123; Rectangle() &#123; super.m_type = 1; &#125; @Override public void draw() &#123; System.out.println(\" ç»˜åˆ¶çŸ©å½¢ \"); &#125;&#125;class Circle extends Shape &#123; Circle() &#123; super.m_type = 2; &#125; @Override public void draw() &#123; System.out.println(\" ç»˜åˆ¶åœ†å½¢ \"); &#125;&#125;//æ–°å¢ç”»ä¸‰è§’å½¢class Triangle extends Shape &#123; Triangle() &#123; super.m_type = 3; &#125; @Override public void draw() &#123; System.out.println(\" ç»˜åˆ¶ä¸‰è§’å½¢ \"); &#125;&#125;//æ–°å¢ä¸€ä¸ªå›¾å½¢class OtherGraphic extends Shape &#123; OtherGraphic() &#123; super.m_type = 4; &#125; @Override public void draw() &#123; System.out.println(\" ç»˜åˆ¶å…¶å®ƒå›¾å½¢ \"); &#125;&#125; è¿ªç±³ç‰¹æ³•åˆ™ä¸€ä¸ªå¯¹è±¡åº”è¯¥å¯¹å…¶ä»–å¯¹è±¡ä¿æŒæœ€å°‘çš„äº†è§£ï¼›ç±»ä¸ç±»å…³ç³»è¶Šå¯†åˆ‡ï¼Œè€¦åˆåº¦è¶Šå¤§ã€‚ è¿ªç±³ç‰¹æ³•åˆ™ï¼ˆDemeter Principleï¼‰åˆå«æœ€å°‘çŸ¥é“åŸåˆ™ï¼Œå³ä¸€ä¸ªç±»å¯¹è‡ªå·±ä¾èµ–çš„ç±»çŸ¥é“çš„è¶Šå°‘è¶Šå¥½ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºè¢«ä¾èµ–çš„ç±»ä¸ç®¡å¤šä¹ˆå¤æ‚ï¼Œéƒ½å°½é‡å°†é€»è¾‘å°è£…åœ¨ç±»çš„å†…éƒ¨ã€‚å¯¹å¤–é™¤äº†æä¾›çš„ public æ–¹æ³•ï¼Œä¸å¯¹å¤–æ³„éœ²ä»»ä½•ä¿¡æ¯ã€‚ è¿ªç±³ç‰¹æ³•åˆ™è¿˜æœ‰ä¸ªæ›´ç®€å•çš„å®šä¹‰ï¼šåªä¸ç›´æ¥çš„æœ‹å‹é€šä¿¡ã€‚ç›´æ¥çš„æœ‹å‹ï¼šæ¯ä¸ªå¯¹è±¡éƒ½ä¼šä¸å…¶ä»–å¯¹è±¡æœ‰è€¦åˆå…³ç³»ï¼Œåªè¦ä¸¤ä¸ªå¯¹è±¡ä¹‹é—´æœ‰è€¦åˆå…³ç³»ï¼Œæˆ‘ä»¬å°±è¯´è¿™ä¸¤ä¸ªå¯¹è±¡ä¹‹é—´æ˜¯æœ‹å‹å…³ç³»ã€‚è€¦åˆçš„æ–¹å¼å¾ˆå¤šï¼Œä¾èµ–ï¼Œå…³è”ï¼Œç»„åˆï¼Œèšåˆç­‰ã€‚å…¶ä¸­ï¼Œæˆ‘ä»¬ç§°å‡ºç°æˆå‘˜å˜é‡ï¼Œæ–¹æ³•å‚æ•°ï¼Œæ–¹æ³•è¿”å›å€¼ä¸­çš„ç±»ä¸ºç›´æ¥çš„æœ‹å‹ï¼Œè€Œå‡ºç°åœ¨å±€éƒ¨å˜é‡ä¸­çš„ç±»ä¸æ˜¯ç›´æ¥çš„æœ‹å‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé™Œç”Ÿçš„ç±»æœ€å¥½ä¸è¦ä»¥å±€éƒ¨å˜é‡çš„å½¢å¼å‡ºç°åœ¨ç±»çš„å†…éƒ¨ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970public class Demeter &#123; public static void main(String[] args) &#123; // åˆ›å»ºäº†ä¸€ä¸ª SchoolManager å¯¹è±¡ SchoolManager schoolManager = new SchoolManager(); // è¾“å‡ºå­¦é™¢çš„å‘˜å·¥ id å’Œå­¦æ ¡æ€»éƒ¨çš„å‘˜å·¥ä¿¡æ¯ schoolManager.printAllEmployee(new CollegeManager()); &#125;&#125;// å­¦æ ¡æ€»éƒ¨å‘˜å·¥ç±»class Employee &#123; private String id; public void setId(String id) &#123; this.id = id; &#125; public String getId() &#123; return id; &#125;&#125;// å­¦é™¢çš„å‘˜å·¥ç±»class CollegeEmployee &#123; private String id; public void setId(String id) &#123; this.id = id; &#125; public String getId() &#123; return id; &#125;&#125;// ç®¡ç†å­¦é™¢å‘˜å·¥çš„ç®¡ç†ç±»class CollegeManager &#123; // è¿”å›å­¦é™¢çš„æ‰€æœ‰å‘˜å·¥ public List&lt;CollegeEmployee&gt; getAllEmployee() &#123; List&lt;CollegeEmployee&gt; list = new ArrayList&lt;CollegeEmployee&gt;(); for (int i = 0; i &lt; 10; i++) &#123; //è¿™é‡Œæˆ‘ä»¬å¢åŠ äº† 10 ä¸ªå‘˜å·¥åˆ° list CollegeEmployee emp = new CollegeEmployee(); emp.setId(\"å­¦é™¢å‘˜å·¥ id= \" + i); list.add(emp); &#125; return list; &#125;&#125;// å­¦æ ¡ç®¡ç†ç±»// åˆ†æ SchoolManager ç±»çš„ç›´æ¥æœ‹å‹ç±»æœ‰å“ªäº› Employeeã€CollegeManagerclass SchoolManager &#123; // è¿”å›å­¦æ ¡æ€»éƒ¨çš„å‘˜å·¥ public List&lt;Employee&gt; getAllEmployee() &#123; List&lt;Employee&gt; list = new ArrayList&lt;Employee&gt;(); for (int i = 0; i &lt; 5; i++) &#123; // è¿™é‡Œæˆ‘ä»¬å¢åŠ äº† 5 ä¸ªå‘˜å·¥åˆ° list Employee emp = new Employee(); emp.setId(\"å­¦æ ¡æ€»éƒ¨å‘˜å·¥ id= \" + i); list.add(emp); &#125; return list; &#125; // è¯¥æ–¹æ³•å®Œæˆè¾“å‡ºå­¦æ ¡æ€»éƒ¨å’Œå­¦é™¢å‘˜å·¥ä¿¡æ¯(id) void printAllEmployee(CollegeManager sub) &#123; // è·å–åˆ°å­¦é™¢å‘˜å·¥ CollegeEmployee ä¸æ˜¯ç›´æ¥æœ‹å‹è€Œæ˜¯ä¸€ä¸ªé™Œç”Ÿç±»ï¼Œè¿™æ ·è¿èƒŒäº†è¿ªç±³ç‰¹æ³•åˆ™ List&lt;CollegeEmployee&gt; list1 = sub.getAllEmployee(); System.out.println(\"------------å­¦é™¢å‘˜å·¥------------\"); for (CollegeEmployee e : list1) &#123; System.out.println(e.getId()); &#125; // è·å–åˆ°å­¦æ ¡æ€»éƒ¨å‘˜å·¥ List&lt;Employee&gt; list2 = this.getAllEmployee(); System.out.println(\"------------å­¦æ ¡æ€»éƒ¨å‘˜å·¥------------\"); for (Employee e : list2) &#123; System.out.println(e.getId()); &#125; &#125;&#125; ç®€å•æ¥è®²ï¼Œä¹Ÿå°±æ˜¯å­¦æ ¡çš„æ€»éƒ¨åªç®¡ç†æ€»éƒ¨çš„å‘˜å·¥ï¼Œå…¶åˆ†éƒ¨çš„å‘˜å·¥å¯¹å®ƒè€Œè¨€æ˜¯ä¸ªâ€œé™Œç”Ÿç±»â€ï¼Œåˆ†å¸ƒå‘˜å·¥çš„ç®¡ç†å·¥ä½œï¼ˆæ‰“å°ï¼‰åº”è¯¥äº¤ç»™åˆ†éƒ¨è¿›è¡Œã€‚ 12345678910111213141516171819class CollegeManager &#123; public List&lt;CollegeEmployee&gt; getAllEmployee() &#123; List&lt;CollegeEmployee&gt; list = new ArrayList&lt;CollegeEmployee&gt;(); for (int i = 0; i &lt; 10; i++) &#123; CollegeEmployee emp = new CollegeEmployee(); emp.setId(\"å­¦é™¢å‘˜å·¥ id= \" + i); list.add(emp); &#125; return list; &#125; // å­¦é™¢çš„é›‡å‘˜ç”±å­¦é™¢è´Ÿè´£ public void printEmployee() &#123; List&lt;CollegeEmployee&gt; list1 = getAllEmployee(); System.out.println(\"------------å­¦é™¢å‘˜å·¥------------\"); for (CollegeEmployee e : list1) &#123; System.out.println(e.getId()); &#125; &#125;&#125; åˆæˆå¤ç”¨å°½é‡ä½¿ç”¨åˆæˆ / èšåˆçš„æ–¹å¼ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç»§æ‰¿ã€‚ UML ç±»å›¾ä¾èµ–å…ƒç´  A çš„å˜åŒ–ä¼šå½±å“å…ƒç´  Bï¼Œä½†åä¹‹ä¸æˆç«‹ï¼Œé‚£ä¹ˆ B å’Œ A çš„å…³ç³»æ˜¯ä¾èµ–å…³ç³»ï¼ŒB ä¾èµ– Aï¼›ç±»å±å…³ç³»å’Œå®ç°å…³ç³»åœ¨è¯­ä¹‰ä¸Šè®²ä¹Ÿæ˜¯ä¾èµ–å…³ç³»ï¼Œä½†ç”±äºå…¶æœ‰æ›´ç‰¹æ®Šçš„ç”¨é€”ï¼Œæ‰€ä»¥è¢«å•ç‹¬æè¿°ã€‚UML ä¸­ç”¨å¸¦ç®­å¤´çš„è™šçº¿è¡¨ç¤º Dependency å…³ç³»ï¼Œç®­å¤´æŒ‡å‘è¢«ä¾èµ–å…ƒç´ ã€‚ æ³›åŒ–é€šå¸¸æ‰€è¯´çš„ç»§æ‰¿ï¼ˆB is kind of Aï¼‰å…³ç³»ï¼ŒUML ä¸­ç”¨å¸¦ç©ºå¿ƒç®­å¤´çš„å®çº¿è¡¨ç¤º Generalization å…³ç³»ï¼Œç®­å¤´æŒ‡å‘ Aã€‚ å®ç°å…ƒç´  A å®šä¹‰ä¸€ä¸ªçº¦å®šï¼Œå…ƒç´  B å®ç°è¿™ä¸ªçº¦å®šï¼Œåˆ™ B å’Œ A çš„å…³ç³»æ˜¯ Realizeï¼ŒB realize Aã€‚è¿™ä¸ªå…³ç³»æœ€å¸¸ç”¨äºæ¥å£ã€‚UML ä¸­ç”¨ç©ºå¿ƒç®­å¤´å’Œè™šçº¿è¡¨ç¤º Realize å…³ç³»ï¼Œç®­å¤´æŒ‡å‘å®šä¹‰çº¦å®šçš„å…ƒç´ ã€‚ å…³è”å…ƒç´ é—´çš„ç»“æ„åŒ–å…³ç³»ï¼Œæ˜¯ä¸€ç§å¼±å…³ç³»ï¼Œè¢«å…³è”çš„å…ƒç´ é—´é€šå¸¸å¯ä»¥è¢«ç‹¬ç«‹çš„è€ƒè™‘ã€‚UML ä¸­ç”¨å¸¦ç®­å¤´å®çº¿è¡¨ç¤º Association å…³ç³»ï¼Œç®­å¤´æŒ‡å‘è¢«ä¾èµ–å…ƒç´ ã€‚ èšåˆèšåˆå…³ç³»çš„ä¸€ç§ç‰¹ä¾‹ï¼Œè¡¨ç¤ºéƒ¨åˆ†å’Œæ•´ä½“ï¼ˆAll has a Partï¼‰çš„å…³ç³»ã€‚UML ä¸­ç”¨å¸¦ç©ºå¿ƒè±å½¢å¤´çš„å®çº¿è¡¨ç¤º Aggregation å…³ç³»ï¼Œè±å½¢å¤´æŒ‡å‘æ•´ä½“ã€‚ ç»„åˆç»„åˆæ˜¯èšåˆå…³ç³»çš„å˜ç§ï¼Œè¡¨ç¤ºå…ƒç´ é—´æ›´å¼ºçš„ç»„åˆå…³ç³»ã€‚å¦‚æœæ˜¯ç»„åˆå…³ç³»ï¼Œå¦‚æœæ•´ä½“è¢«ç ´ååˆ™ä¸ªä½“ä¸€å®šä¼šè¢«ç ´åï¼Œè€Œèšåˆçš„ä¸ªä½“åˆ™å¯èƒ½æ˜¯è¢«å¤šä¸ªæ•´ä½“æ‰€å…±äº«çš„ï¼Œä¸ä¸€å®šä¼šéšç€æŸä¸ªæ•´ä½“çš„ç ´åè€Œè¢«ç ´åã€‚UML ä¸­ç”¨å¸¦å®å¿ƒè±å½¢å¤´çš„å®çº¿è¡¨ç¤º Composition å…³ç³»ï¼Œè±å½¢å¤´æŒ‡å‘æ•´ä½“ã€‚ åˆ›å»ºå‹æ¨¡å¼å•ä¾‹æ¨¡å¼é¥¿æ±‰å¼é™æ€å˜é‡123456789101112//é¥¿æ±‰å¼ï¼šé™æ€å˜é‡class Singleton &#123; // æ„é€ å™¨ç§æœ‰åŒ–, å¤–éƒ¨ä¸èƒ½ new private Singleton() &#123; &#125; // æœ¬ç±»å†…éƒ¨åˆ›å»ºå¯¹è±¡å®ä¾‹ private final static Singleton instance = new Singleton(); // æä¾›ä¸€ä¸ªå…¬æœ‰çš„é™æ€æ–¹æ³•ï¼Œè¿”å›å®ä¾‹å¯¹è±¡ public static Singleton getInstance() &#123; return instance; &#125;&#125; é™æ€ä»£ç å—1234567891011121314// é¥¿æ±‰å¼ï¼šé™æ€ä»£ç å—class Singleton &#123; private Singleton() &#123; &#125; // æœ¬ç±»å†…éƒ¨åˆ›å»ºå¯¹è±¡å®ä¾‹ private static Singleton instance; static &#123; // åœ¨é™æ€ä»£ç å—ä¸­ï¼Œåˆ›å»ºå•ä¾‹å¯¹è±¡ instance = new Singleton(); &#125; // æä¾›ä¸€ä¸ªå…¬æœ‰çš„é™æ€æ–¹æ³•ï¼Œè¿”å›å®ä¾‹å¯¹è±¡ public static Singleton getInstance() &#123; return instance; &#125;&#125; æ‡’æ±‰å¼åŒæ­¥æ–¹æ³•12345678910111213// æ‡’æ±‰å¼ï¼šçº¿ç¨‹å®‰å…¨ï¼ŒåŒæ­¥æ–¹æ³•class Singleton &#123; private static Singleton instance; private Singleton() &#123;&#125; // æä¾›ä¸€ä¸ªé™æ€çš„å…¬æœ‰æ–¹æ³•ï¼ŒåŠ å…¥åŒæ­¥å¤„ç†çš„ä»£ç ï¼Œè§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜ // æ¯ä¸€ä¸ªçº¿ç¨‹è·å–å®ä¾‹æ—¶éƒ½è¦è¿›åˆ°åŒæ­¥æ–¹æ³•ä¸­è¿›è¡Œåˆ¤è¯»ï¼Œå¤§å¤§é™ä½äº†æ•ˆç‡ public static synchronized Singleton getInstance() &#123; if(instance == null) &#123; instance = new Singleton(); &#125; return instance; &#125;&#125; åŒé‡æ£€æŸ¥12345678910111213141516// æ‡’æ±‰å¼ï¼šåŒé‡æ£€æŸ¥class Singleton &#123; private static Singleton instance; private Singleton() &#123;&#125; public static Singleton getInstance() &#123; if(instance == null) &#123; // ä¸€æ¬¡åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯è¿›å…¥æ­¤åŒæ­¥ä»£ç å—ä¸­ synchronized (Singleton.class) &#123; if(instance == null) &#123; instance = new Singleton(); &#125; &#125; &#125; return instance; &#125;&#125; é™æ€å†…éƒ¨ç±»é™æ€å†…éƒ¨ç±»æ–¹å¼åœ¨ Singleton ç±»è¢«è£…è½½æ—¶å¹¶ä¸ä¼šç«‹å³å®ä¾‹åŒ–ï¼Œè€Œæ˜¯åœ¨éœ€è¦å®ä¾‹åŒ–æ—¶ï¼Œè°ƒç”¨ getInstance æ–¹æ³•ï¼Œæ‰ä¼šè£…è½½ SingletonInstance ç±»ï¼Œä»è€Œå®Œæˆ Singleton çš„å®ä¾‹åŒ–ã€‚ ç±»çš„é™æ€å±æ€§åªä¼šåœ¨ç¬¬ä¸€æ¬¡åŠ è½½ç±»çš„æ—¶å€™åˆå§‹åŒ–ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œï¼ŒJVM å¸®åŠ©æˆ‘ä»¬ä¿è¯äº†çº¿ç¨‹çš„å®‰å…¨æ€§ï¼Œåœ¨ç±»è¿›è¡Œåˆå§‹åŒ–æ—¶ï¼Œåˆ«çš„çº¿ç¨‹æ˜¯æ— æ³•è¿›å…¥çš„ã€‚ 1234567891011121314// æ‡’æ±‰å¼ï¼šé™æ€å†…éƒ¨ç±»class Singleton &#123; private static volatile Singleton instance; // æ„é€ å™¨ç§æœ‰åŒ– private Singleton() &#123;&#125; // å†™ä¸€ä¸ªé™æ€å†…éƒ¨ç±»ï¼Œè¯¥ç±»ä¸­æœ‰ä¸€ä¸ªé™æ€å±æ€§ Singleton private static class SingletonInstance &#123; private static final Singleton INSTANCE = new Singleton(); &#125; // æä¾›ä¸€ä¸ªé™æ€çš„å…¬æœ‰æ–¹æ³•ï¼Œç›´æ¥è¿”å› SingletonInstance.INSTANCE public static synchronized Singleton getInstance() &#123; return SingletonInstance.INSTANCE; &#125;&#125; æšä¸¾12345678// æ‡’æ±‰å¼ï¼šæšä¸¾enum Singleton &#123; INSTANCE; //å±æ€§ public void sayOK() &#123; System.out.println(\"ok~\"); &#125;&#125;// ä¸ä»…èƒ½é¿å…å¤šçº¿ç¨‹åŒæ­¥é—®é¢˜ï¼Œè€Œä¸”è¿˜èƒ½é˜²æ­¢ååºåˆ—åŒ–é‡æ–°åˆ›å»ºæ–°çš„å¯¹è±¡ æ€»ç»“å•ä¾‹æ¨¡å¼ä¿è¯äº†ç³»ç»Ÿå†…å­˜ä¸­è¯¥ç±»åªå­˜åœ¨ä¸€ä¸ªå¯¹è±¡ï¼ŒèŠ‚çœäº†ç³»ç»Ÿèµ„æºï¼Œå¯¹äºä¸€äº›éœ€è¦é¢‘ç¹åˆ›å»ºé”€æ¯çš„å¯¹è±¡ï¼Œä½¿ç”¨å•ä¾‹æ¨¡å¼å¯ä»¥æé«˜ç³»ç»Ÿæ€§èƒ½ï¼›å½“æƒ³å®ä¾‹åŒ–ä¸€ä¸ªå•ä¾‹ç±»çš„æ—¶å€™ï¼Œå¿…é¡»è¦è®°ä½ä½¿ç”¨ç›¸åº”çš„è·å–å¯¹è±¡çš„æ–¹æ³•ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ newï¼› å•ä¾‹æ¨¡å¼ä½¿ç”¨çš„åœºæ™¯ï¼šéœ€è¦é¢‘ç¹çš„è¿›è¡Œåˆ›å»ºå’Œé”€æ¯çš„å¯¹è±¡ã€åˆ›å»ºå¯¹è±¡æ—¶è€—æ—¶è¿‡å¤šæˆ–è€—è´¹èµ„æºè¿‡å¤šï¼ˆå³ï¼šé‡é‡çº§å¯¹è±¡ï¼‰ï¼Œä½†åˆç»å¸¸ç”¨åˆ°çš„å¯¹è±¡ã€å·¥å…·ç±»å¯¹è±¡ã€é¢‘ç¹è®¿é—®æ•°æ®åº“æˆ–æ–‡ä»¶çš„å¯¹è±¡ï¼ˆæ¯”å¦‚æ•°æ®æºã€session å·¥å‚ç­‰ï¼‰ã€‚ å·¥å‚æ¨¡å¼ç®€å•å·¥å‚ç®€å•å·¥å‚æ¨¡å¼æ˜¯å±äºåˆ›å»ºå‹æ¨¡å¼ï¼Œæ˜¯å·¥å‚æ¨¡å¼çš„ä¸€ç§ã€‚ç®€å•å·¥å‚æ¨¡å¼æ˜¯ç”±ä¸€ä¸ªå·¥å‚å¯¹è±¡å†³å®šåˆ›å»ºå‡ºå“ªä¸€ç§äº§å“ç±»çš„å®ä¾‹ã€‚ ç®€å•å·¥å‚æ¨¡å¼æ˜¯å·¥å‚æ¨¡å¼å®¶æ—ä¸­æœ€ç®€å•å®ç”¨çš„æ¨¡å¼ã€‚åœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œå½“æˆ‘ä»¬ä¼šç”¨åˆ°å¤§é‡çš„åˆ›å»ºæŸç§ã€æŸç±»æˆ–è€…æŸæ‰¹å¯¹è±¡æ—¶ï¼Œå°±ä¼šä½¿ç”¨åˆ°å·¥å‚æ¨¡å¼ã€‚ ç®€å•å·¥å‚æ¨¡å¼ï¼šå®šä¹‰äº†ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„ç±»ï¼Œç”±è¿™ä¸ªç±»æ¥å°è£…å®ä¾‹åŒ–å¯¹è±¡çš„è¡Œä¸ºï¼ˆä»£ç ï¼‰ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738// æ­¤ç±»ä¸ºä½¿ç”¨è€…ï¼Œå½“æä¾›æ–¹è¿›è¡Œæ‰©å±•æ—¶éœ€è¦è¿›è¡Œæ¯”è¾ƒå¤§çš„ä»£ç ä¿®æ”¹ï¼Œè¿å OCP åŸåˆ™public OrderPizza() &#123; Pizza pizza = null; String orderType; // è®¢è´­æŠ«è¨çš„ç±»å‹ do &#123; orderType = getType(); if (orderType.equals(\"greek\")) &#123; pizza = new GreekPizza(); pizza.setName(\" å¸Œè…ŠæŠ«è¨ \"); &#125; else if (orderType.equals(\"cheese\")) &#123; pizza = new CheesePizza(); pizza.setName(\" å¥¶é…ªæŠ«è¨ \"); &#125; else if (orderType.equals(\"pepper\")) &#123; pizza = new PepperPizza(); pizza.setName(\"èƒ¡æ¤’æŠ«è¨\"); &#125; else &#123; break; &#125; // è¾“å‡º pizza åˆ¶ä½œè¿‡ç¨‹ pizza.prepare(); pizza.bake(); pizza.cut(); pizza.box(); &#125; while (true);&#125;// å†™ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥è·å–å®¢æˆ·å¸Œæœ›è®¢è´­çš„æŠ«è¨ç§ç±»private String getType() &#123; try &#123; BufferedReader strin = new BufferedReader(new InputStreamReader(System.in)); System.out.println(\"input pizza ç§ç±»:\"); String str = strin.readLine(); return str; &#125; catch (IOException e) &#123; e.printStackTrace(); return \"\"; &#125;&#125; å¦‚æœæˆ‘ä»¬å¢åŠ ä¸€ä¸ª Pizza ç±»ï¼Œåªè¦æ˜¯è®¢è´­ Pizza çš„ä»£ç éƒ½éœ€è¦ä¿®æ”¹ã€‚å½“ç„¶ä¿®æ”¹ä»£ç æ˜¯å¯ä»¥æ¥å—ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬åœ¨å…¶å®ƒçš„åœ°æ–¹ä¹Ÿæœ‰åˆ›å»º Pizza çš„ä»£ç ï¼Œå°±æ„å‘³ç€ï¼Œä¹Ÿéœ€è¦ä¿®æ”¹ï¼Œè€Œåˆ›å»º Pizza çš„ä»£ç ï¼Œå¾€å¾€æœ‰å¤šå¤„ã€‚ ç®€å•å·¥å‚æ¨¡å¼çš„è®¾è®¡æ–¹æ¡ˆï¼šå®šä¹‰ä¸€ä¸ªå¯ä»¥å®ä¾‹åŒ– Pizaa å¯¹è±¡çš„ç±»ï¼Œå°è£…åˆ›å»ºå¯¹è±¡çš„ä»£ç ã€‚å½“æ‰€æœ‰çš„å¯¹è±¡çš„å®ä¾‹åŒ–éƒ½ç”±ä¸€ä¸ªå·¥å‚è¿›è¡Œè´Ÿè´£æ—¶ï¼Œæ–°å¢ä¸€ä¸ª Pizza ç±»åªç”¨ä¿®æ”¹å·¥å‚ç±»å³å¯ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647// ç®€å•å·¥å‚ç±»public class SimpleFactory &#123; // æ·»åŠ  orderType è¿”å›å¯¹åº”çš„ Pizza å¯¹è±¡ public Pizza createPizza(String orderType) &#123; // æ ¹æ®éœ€æ±‚è¿˜å¯ä»¥æ˜¯é™æ€æ–¹æ³• Pizza pizza = null; System.out.println(\"ç®€å•å·¥å‚æ¨¡å¼\"); if (orderType.equals(\"greek\")) &#123; pizza = new GreekPizza(); pizza.setName(\" å¸Œè…ŠæŠ«è¨ \"); &#125; else if (orderType.equals(\"cheese\")) &#123; pizza = new CheesePizza(); pizza.setName(\" å¥¶é…ªæŠ«è¨ \"); &#125; else if (orderType.equals(\"pepper\")) &#123; pizza = new PepperPizza(); pizza.setName(\"èƒ¡æ¤’æŠ«è¨\"); &#125; return pizza; &#125;&#125;// ä½¿ç”¨è€…public OrderPizza() &#123; // å®šä¹‰ä¸€ä¸ªç®€å•å·¥å‚å¯¹è±¡ SimpleFactory simpleFactory; Pizza pizza = null; // æ„é€ å™¨ public OrderPizza(SimpleFactory simpleFactory) &#123; setFactory(simpleFactory); &#125; public void setFactory(SimpleFactory simpleFactory) &#123; String orderType = \"\"; // ç”¨æˆ·è¾“å…¥çš„ this.simpleFactory = simpleFactory; // è®¾ç½®ç®€å•å·¥å‚å¯¹è±¡ do &#123; orderType = getType(); pizza = this.simpleFactory.createPizza(orderType); // è¾“å‡º pizza if(pizza != null) &#123; pizza.prepare(); pizza.bake(); pizza.cut(); pizza.box(); &#125; else &#123; System.out.println(\" è®¢è´­æŠ«è¨å¤±è´¥ \"); break; &#125; &#125;while(true); &#125;&#125; å·¥å‚æ–¹æ³•å·¥å‚æ–¹æ³•æ¨¡å¼ï¼šå®šä¹‰äº†ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„æŠ½è±¡æ–¹æ³•ï¼Œç”±å­ç±»å†³å®šè¦å®ä¾‹åŒ–çš„å¯¹è±¡ã€‚å·¥å‚æ–¹æ³•æ¨¡å¼å°†å¯¹è±¡çš„å®ä¾‹åŒ–æ¨è¿Ÿåˆ°å­ç±»ã€‚ ç®€å•å·¥å‚æ¨¡å¼éœ€è¦ä¸€ä¸ªå·¥å‚è¿›è¡Œæ“ä½œï¼Œå½“æ›´å¤šçš„ä¸åŒçš„éœ€æ±‚æ—¶ï¼Œå¯ä»¥é€šè¿‡åˆ›å»ºå¤šä¸ªç®€å•å·¥å‚ç±»è¿›è¡Œå®ç°ï¼›å·¥å‚æ–¹æ³•æ¨¡å¼ç›´æ¥æŠŠä¼šå˜åŒ–çš„æ–¹æ³•æŠ½è±¡åˆ°å­å·¥å‚ä¸­å»å®ç°ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243public abstract class OrderPizza &#123; // å®šä¹‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼ŒcreatePizza , è®©å„ä¸ªå·¥å‚å­ç±»è‡ªå·±å®ç° abstract Pizza createPizza(String orderType); // æ„é€ å™¨ public OrderPizza() &#123; Pizza pizza = null; String orderType; // è®¢è´­æŠ«è¨çš„ç±»å‹ do &#123; orderType = getType(); pizza = createPizza(orderType); // æŠ½è±¡æ–¹æ³•ï¼Œç”±å·¥å‚å­ç±»å®Œæˆ // è¾“å‡º pizza åˆ¶ä½œè¿‡ç¨‹ pizza.prepare(); pizza.bake(); pizza.cut(); pizza.box(); &#125; while (true); &#125;&#125;// å­å·¥å‚public class BJOrderPizza extends OrderPizza &#123; @Override Pizza createPizza(String orderType) &#123; Pizza pizza = null; if(orderType.equals(\"cheese\")) &#123; pizza = new BJCheesePizza(); &#125; else if (orderType.equals(\"pepper\")) &#123; pizza = new BJPepperPizza(); &#125; return pizza; &#125;&#125;public class LDOrderPizza extends OrderPizza &#123; Pizza createPizza(String orderType) &#123; Pizza pizza = null; if(orderType.equals(\"cheese\")) &#123; pizza = new LDCheesePizza(); &#125; else if (orderType.equals(\"pepper\")) &#123; pizza = new LDPepperPizza(); &#125; return pizza; &#125;&#125; æŠ½è±¡å·¥å‚æŠ½è±¡å·¥å‚æ¨¡å¼ï¼šå®šä¹‰äº†ä¸€ä¸ª interface ç”¨äºåˆ›å»ºç›¸å…³æˆ–æœ‰ä¾èµ–å…³ç³»çš„å¯¹è±¡ç°‡ï¼Œè€Œæ— éœ€æŒ‡æ˜å…·ä½“çš„ç±»ã€‚ æŠ½è±¡å·¥å‚æ¨¡å¼å¯ä»¥å°†ç®€å•å·¥å‚æ¨¡å¼å’Œå·¥å‚æ–¹æ³•æ¨¡å¼è¿›è¡Œæ•´åˆã€‚ä»è®¾è®¡å±‚é¢çœ‹ï¼ŒæŠ½è±¡å·¥å‚æ¨¡å¼å°±æ˜¯å¯¹ç®€å•å·¥å‚æ¨¡å¼çš„æ”¹è¿›ã€‚ï¼ˆæˆ–è€…ç§°ä¸ºè¿›ä¸€æ­¥çš„æŠ½è±¡ï¼‰å°†å·¥å‚æŠ½è±¡æˆä¸¤å±‚ï¼ŒAbsFactoryï¼ˆæŠ½è±¡å·¥å‚ï¼‰å’Œå…·ä½“å®ç°çš„å·¥å‚å­ç±»ã€‚ç¨‹åºå‘˜å¯ä»¥æ ¹æ®åˆ›å»ºå¯¹è±¡ç±»å‹ä½¿ç”¨å¯¹åº”çš„å·¥å‚å­ç±»ã€‚è¿™æ ·å°†å•ä¸ªçš„ç®€å•å·¥å‚ç±»å˜æˆäº†å·¥å‚ç°‡ï¼Œæ›´åˆ©äºä»£ç çš„ç»´æŠ¤å’Œæ‰©å±•ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657// ä¸€ä¸ªæŠ½è±¡å·¥å‚æ¨¡å¼çš„æŠ½è±¡å±‚ï¼šæ¥å£public interface AbsFactory &#123; // è®©ä¸‹é¢çš„å·¥å‚å­ç±»æ¥å…·ä½“å®ç° public Pizza createPizza(String orderType);&#125;public class BJFactory implements AbsFactory &#123; @Override public Pizza createPizza(String orderType) &#123; System.out.println(\"æŠ½è±¡å·¥å‚æ¨¡å¼\"); Pizza pizza = null; if(orderType.equals(\"cheese\")) &#123; pizza = new BJCheesePizza(); &#125; else if (orderType.equals(\"pepper\"))&#123; pizza = new BJPepperPizza(); &#125; return pizza; &#125;&#125;public class LDFactory implements AbsFactory &#123; @Override public Pizza createPizza(String orderType) &#123; System.out.println(\"æŠ½è±¡å·¥å‚æ¨¡å¼\"); Pizza pizza = null; if (orderType.equals(\"cheese\")) &#123; pizza = new LDCheesePizza(); &#125; else if (orderType.equals(\"pepper\")) &#123; pizza = new LDPepperPizza(); &#125; return pizza; &#125;&#125;public class OrderPizza &#123; AbsFactory factory; public OrderPizza(AbsFactory factory) &#123; setFactory(factory); &#125; private void setFactory(AbsFactory factory) &#123; Pizza pizza = null; String orderType = \"\"; this.factory = factory; do &#123; orderType = getType(); // factory å¯èƒ½æ˜¯åŒ—äº¬çš„å·¥å‚å­ç±»ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¼¦æ•¦çš„å·¥å‚å­ç±» pizza = factory.createPizza(orderType); if (pizza != null) &#123; pizza.prepare(); pizza.bake(); pizza.cut(); pizza.box(); &#125; else &#123; System.out.println(\"è®¢è´­å¤±è´¥\"); break; &#125; &#125; while (true); &#125;&#125; æ€»ç»“å·¥å‚æ¨¡å¼çš„æ„ä¹‰ï¼šå°†å®ä¾‹åŒ–å¯¹è±¡çš„ä»£ç æå–å‡ºæ¥ï¼Œæ”¾åˆ°ä¸€ä¸ªç±»ä¸­ç»Ÿä¸€ç®¡ç†å’Œç»´æŠ¤ï¼Œè¾¾åˆ°å’Œä¸»é¡¹ç›®çš„ä¾èµ–å…³ç³»çš„è§£è€¦ã€‚ä»è€Œæé«˜é¡¹ç›®çš„æ‰©å±•å’Œç»´æŠ¤æ€§ã€‚ è®¾è®¡æ¨¡å¼çš„ä¾èµ–æŠ½è±¡åŸåˆ™ï¼š åˆ›å»ºå¯¹è±¡å®ä¾‹æ—¶ï¼Œä¸è¦ç›´æ¥ new ç±», è€Œæ˜¯æŠŠè¿™ä¸ª new ç±»çš„åŠ¨ä½œæ”¾åœ¨ä¸€ä¸ªå·¥å‚çš„æ–¹æ³•ä¸­ï¼Œå¹¶è¿”å›ï¼› ä¸è¦è®©ç±»ç»§æ‰¿å…·ä½“ç±»ï¼Œè€Œæ˜¯ç»§æ‰¿æŠ½è±¡ç±»æˆ–è€…æ˜¯å®ç° interfaceï¼› ä¸è¦è¦†ç›–åŸºç±»ä¸­å·²ç»å®ç°çš„æ–¹æ³•ã€‚ åŸå‹æ¨¡å¼åŸå‹æ¨¡å¼ï¼ˆPrototype æ¨¡å¼ï¼‰æ˜¯æŒ‡ï¼šç”¨åŸå‹å®ä¾‹æŒ‡å®šåˆ›å»ºå¯¹è±¡çš„ç§ç±»ï¼Œå¹¶ä¸”é€šè¿‡æ‹·è´è¿™äº›åŸå‹ï¼Œåˆ›å»ºæ–°çš„å¯¹è±¡ï¼› åŸå‹æ¨¡å¼æ˜¯ä¸€ç§åˆ›å»ºå‹è®¾è®¡æ¨¡å¼ï¼Œå…è®¸ä¸€ä¸ªå¯¹è±¡å†åˆ›å»ºå¦å¤–ä¸€ä¸ªå¯å®šåˆ¶çš„å¯¹è±¡ï¼Œæ— éœ€çŸ¥é“å¦‚ä½•åˆ›å»ºçš„ç»†èŠ‚ï¼› å·¥ä½œåŸç†ï¼šé€šè¿‡å°†ä¸€ä¸ªåŸå‹å¯¹è±¡ä¼ ç»™é‚£ä¸ªè¦å‘åŠ¨åˆ›å»ºçš„å¯¹è±¡ï¼Œè¿™ä¸ªè¦å‘åŠ¨åˆ›å»ºçš„å¯¹è±¡é€šè¿‡è¯·æ±‚åŸå‹å¯¹è±¡æ‹·è´å®ƒä»¬è‡ªå·±æ¥å®æ–½åˆ›å»ºï¼Œå³ Object.clone() 12345678910111213141516171819202122232425262728293031323334353637383940414243444546public class Sheep implements Cloneable &#123; private String name; private int age; private String color; private String address = \"è’™å¤ç¾Š\"; public Sheep friend; // å…‹éš†å¦‚ä½•å¤„ç†å¼•ç”¨å¯¹è±¡? é»˜è®¤æ˜¯æµ…æ‹·è´ public Sheep(String name, int age, String color) &#123; super(); this.name = name; this.age = age; this.color = color; &#125; // Getter / Setter @Override public String toString() &#123; return \"Sheep [name=\" + name + \", age=\" + age + \", color=\" + color + \", address=\" + address + \"]\"; &#125; // å…‹éš†è¯¥å®ä¾‹ï¼Œä½¿ç”¨é»˜è®¤çš„ clone æ–¹æ³•æ¥å®Œæˆ @Override protected Object clone() &#123; Sheep sheep = null; try &#123; sheep = (Sheep)super.clone(); &#125; catch (Exception e) &#123; System.out.println(e.getMessage()); &#125; return sheep; &#125;&#125;public class Client &#123; public static void main(String[] args) &#123; System.out.println(\"åŸå‹æ¨¡å¼å®Œæˆå¯¹è±¡çš„åˆ›å»º\"); Sheep sheep = new Sheep(\"tom\", 1, \"ç™½è‰²\"); sheep.friend = new Sheep(\"jack\", 2, \"é»‘è‰²\"); Sheep sheep2 = (Sheep)sheep.clone(); //å…‹éš† Sheep sheep3 = (Sheep)sheep.clone(); //å…‹éš† Sheep sheep4 = (Sheep)sheep.clone(); //å…‹éš† Sheep sheep5 = (Sheep)sheep.clone(); //å…‹éš† System.out.println(\"sheep2 =\" + sheep2 + \"sheep2.friend=\" + sheep2.friend.hashCode()); System.out.println(\"sheep3 =\" + sheep3 + \"sheep3.friend=\" + sheep3.friend.hashCode()); System.out.println(\"sheep4 =\" + sheep4 + \"sheep4.friend=\" + sheep4.friend.hashCode()); System.out.println(\"sheep5 =\" + sheep5 + \"sheep5.friend=\" + sheep5.friend.hashCode()); &#125;&#125; æµ…æ‹·è´å¯¹äºæ•°æ®ç±»å‹æ˜¯åŸºæœ¬æ•°æ®ç±»å‹çš„æˆå‘˜å˜é‡ï¼Œæµ…æ‹·è´ä¼šç›´æ¥è¿›è¡Œå€¼ä¼ é€’ï¼Œä¹Ÿå°±æ˜¯å°†è¯¥å±æ€§å€¼å¤åˆ¶ä¸€ä»½ç»™æ–°çš„å¯¹è±¡ï¼› å¯¹äºæ•°æ®ç±»å‹æ˜¯å¼•ç”¨æ•°æ®ç±»å‹çš„æˆå‘˜å˜é‡ï¼Œæ¯”å¦‚è¯´æˆå‘˜å˜é‡æ˜¯æŸä¸ªæ•°ç»„ã€æŸä¸ªç±»çš„å¯¹è±¡ç­‰ï¼Œé‚£ä¹ˆæµ…æ‹·è´ä¼šè¿›è¡Œå¼•ç”¨ä¼ é€’ï¼Œä¹Ÿå°±æ˜¯åªæ˜¯å°†è¯¥æˆå‘˜å˜é‡çš„å¼•ç”¨å€¼ï¼ˆå†…å­˜åœ°å€ï¼‰å¤åˆ¶ä¸€ä»½ç»™æ–°çš„å¯¹è±¡ã€‚å› ä¸ºå®é™…ä¸Šä¸¤ä¸ªå¯¹è±¡çš„è¯¥æˆå‘˜å˜é‡éƒ½æŒ‡å‘åŒä¸€ä¸ªå®ä¾‹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåœ¨ä¸€ä¸ªå¯¹è±¡ä¸­ä¿®æ”¹è¯¥æˆå‘˜å˜é‡ä¼šå½±å“åˆ°å¦ä¸€ä¸ªå¯¹è±¡çš„è¯¥æˆå‘˜å˜é‡å€¼ã€‚ 1Object.clone(); // é»˜è®¤ä¸ºæµ…æ‹·è´ æ·±æ‹·è´å¤åˆ¶å¯¹è±¡çš„æ‰€æœ‰åŸºæœ¬æ•°æ®ç±»å‹çš„æˆå‘˜å˜é‡å€¼ï¼› ä¸ºæ‰€æœ‰å¼•ç”¨æ•°æ®ç±»å‹çš„æˆå‘˜å˜é‡ç”³è¯·å­˜å‚¨ç©ºé—´ï¼Œå¹¶å¤åˆ¶æ¯ä¸ªå¼•ç”¨æ•°æ®ç±»å‹æˆå‘˜å˜é‡æ‰€å¼•ç”¨çš„å¯¹è±¡ï¼Œç›´åˆ°è¯¥å¯¹è±¡å¯è¾¾çš„æ‰€æœ‰å¯¹è±¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹è±¡è¿›è¡Œæ·±æ‹·è´è¦å¯¹æ•´ä¸ªå¯¹è±¡ï¼ˆåŒ…æ‹¬å¯¹è±¡çš„å¼•ç”¨ç±»å‹ï¼‰è¿›è¡Œæ‹·è´ã€‚ é‡å†™ clone æ–¹æ³•123456789101112131415161718192021222324252627282930313233public class DeepCloneableTarget implements Serializable, Cloneable &#123; private static final long serialVersionUID = 1L; private String cloneName; private String cloneClass; // æ„é€ å™¨ public DeepCloneableTarget(String cloneName, String cloneClass) &#123; this.cloneName = cloneName; this.cloneClass = cloneClass; &#125; // å› ä¸ºè¯¥ç±»çš„å±æ€§ï¼Œéƒ½æ˜¯ String , å› æ­¤æˆ‘ä»¬è¿™é‡Œä½¿ç”¨é»˜è®¤çš„ clone å®Œæˆå³å¯ @Override protected Object clone() throws CloneNotSupportedException &#123; return super.clone(); &#125;&#125;public class DeepProtoType implements Serializable, Cloneable&#123; public String name; // String å±æ€§ public DeepCloneableTarget deepCloneableTarget; // å¼•ç”¨ç±»å‹ public DeepProtoType() &#123; super(); &#125; // æ·±æ‹·è´ï¼šä½¿ç”¨ clone æ–¹æ³• @Override protected Object clone() throws CloneNotSupportedException &#123; Object deep = null; // è¿™é‡Œå®Œæˆå¯¹åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆå±æ€§ï¼‰å’Œ String çš„å…‹éš† deep = super.clone(); // å¯¹å¼•ç”¨ç±»å‹çš„å±æ€§ï¼Œè¿›è¡Œå•ç‹¬å¤„ç† DeepProtoType deepProtoType = (DeepProtoType)deep; deepProtoType.deepCloneableTarget = (DeepCloneableTarget)deepCloneableTarget.clone(); return deepProtoType; &#125;&#125; å¯¹è±¡åºåˆ—åŒ–å®ç°ä½¿ç”¨åºåˆ—åŒ–å®ç°å¯¹è±¡çš„æ·±æ‹·è´ã€‚ 12345678910111213141516171819202122232425262728293031public Object deepClone() &#123; // åˆ›å»ºæµå¯¹è±¡ ByteArrayOutputStream bos = null; ObjectOutputStream oos = null; ByteArrayInputStream bis = null; ObjectInputStream ois = null; try &#123; // åºåˆ—åŒ– bos = new ByteArrayOutputStream(); oos = new ObjectOutputStream(bos); oos.writeObject(this); // å½“å‰è¿™ä¸ªå¯¹è±¡ä»¥å¯¹è±¡æµçš„æ–¹å¼è¾“å‡º // ååºåˆ—åŒ– bis = new ByteArrayInputStream(bos.toByteArray()); ois = new ObjectInputStream(bis); DeepProtoType copyObj = (DeepProtoType)ois.readObject(); return copyObj; &#125; catch (Exception e) &#123; e.printStackTrace(); return null; &#125; finally &#123; // å…³é—­æµ try &#123; bos.close(); oos.close(); bis.close(); ois.close(); &#125; catch (Exception e) &#123; System.out.println(e.getMessage()); &#125; &#125;&#125; æ€»ç»“åˆ›å»ºæ–°çš„å¯¹è±¡æ¯”è¾ƒå¤æ‚æ—¶ï¼Œå¯ä»¥åˆ©ç”¨åŸå‹æ¨¡å¼ç®€åŒ–å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ï¼ŒåŒæ—¶ä¹Ÿèƒ½å¤Ÿæé«˜æ•ˆç‡ï¼› ä¸ç”¨é‡æ–°åˆå§‹åŒ–å¯¹è±¡ï¼Œè€Œæ˜¯åŠ¨æ€åœ°è·å¾—å¯¹è±¡è¿è¡Œæ—¶çš„çŠ¶æ€ï¼› å¦‚æœåŸå§‹å¯¹è±¡å‘ç”Ÿå˜åŒ–ï¼ˆå¢åŠ æˆ–è€…å‡å°‘å±æ€§ï¼‰ï¼Œå…¶å®ƒå…‹éš†å¯¹è±¡çš„ä¹Ÿä¼šå‘ç”Ÿç›¸åº”çš„å˜åŒ–ï¼Œæ— éœ€ä¿®æ”¹ä»£ç ï¼› åœ¨å®ç°æ·±å…‹éš†çš„æ—¶å€™å¯èƒ½éœ€è¦æ¯”è¾ƒå¤æ‚çš„ä»£ç ï¼› ç¼ºç‚¹ï¼šéœ€è¦ä¸ºæ¯ä¸€ä¸ªç±»é…å¤‡ä¸€ä¸ªå…‹éš†æ–¹æ³•ï¼Œè¿™å¯¹å…¨æ–°çš„ç±»æ¥è¯´ä¸æ˜¯å¾ˆéš¾ï¼Œä½†å¯¹å·²æœ‰çš„ç±»è¿›è¡Œæ”¹é€ æ—¶ï¼Œéœ€è¦ä¿®æ”¹å…¶æºä»£ç ï¼Œè¿èƒŒäº† ocp åŸåˆ™ã€‚ å»ºé€ è€…æ¨¡å¼å»ºé€ è€…æ¨¡å¼ï¼ˆBuilder Patternï¼‰åˆå«ç”Ÿæˆå™¨æ¨¡å¼ï¼Œæ˜¯ä¸€ç§å¯¹è±¡æ„å»ºæ¨¡å¼ã€‚å®ƒå¯ä»¥å°†å¤æ‚å¯¹è±¡çš„å»ºé€ è¿‡ç¨‹æŠ½è±¡å‡ºæ¥ï¼ˆæŠ½è±¡ç±»åˆ«ï¼‰ï¼Œä½¿è¿™ä¸ªæŠ½è±¡è¿‡ç¨‹çš„ä¸åŒå®ç°æ–¹æ³•å¯ä»¥æ„é€ å‡ºä¸åŒè¡¨ç°ï¼ˆå±æ€§ï¼‰çš„å¯¹è±¡ã€‚ å»ºé€ è€…æ¨¡å¼æ˜¯ä¸€æ­¥ä¸€æ­¥åˆ›å»ºä¸€ä¸ªå¤æ‚çš„å¯¹è±¡ï¼Œå®ƒå…è®¸ç”¨æˆ·åªé€šè¿‡æŒ‡å®šå¤æ‚å¯¹è±¡çš„ç±»å‹å’Œå†…å®¹å°±å¯ä»¥æ„å»ºå®ƒä»¬ï¼Œç”¨æˆ·ä¸éœ€è¦çŸ¥é“å†…éƒ¨çš„å…·ä½“æ„å»ºç»†èŠ‚ã€‚ è§’è‰²ï¼š Productï¼ˆäº§å“è§’è‰²ï¼‰ï¼š ä¸€ä¸ªå…·ä½“çš„äº§å“å¯¹è±¡ï¼› Builderï¼ˆæŠ½è±¡å»ºé€ è€…ï¼‰ï¼š åˆ›å»ºä¸€ä¸ª Product å¯¹è±¡çš„å„ä¸ªéƒ¨ä»¶æŒ‡å®šçš„ æ¥å£ / æŠ½è±¡ç±»ï¼› ConcreteBuilderï¼ˆå…·ä½“å»ºé€ è€…ï¼‰ï¼š å®ç°æ¥å£ï¼Œæ„å»ºå’Œè£…é…å„ä¸ªéƒ¨ä»¶ï¼› Directorï¼ˆæŒ‡æŒ¥è€…ï¼‰ï¼š æ„å»ºä¸€ä¸ªä½¿ç”¨ Builder æ¥å£çš„å¯¹è±¡ã€‚å®ƒä¸»è¦æ˜¯ç”¨äºåˆ›å»ºä¸€ä¸ªå¤æ‚çš„å¯¹è±¡ã€‚å®ƒä¸»è¦æœ‰ä¸¤ä¸ªä½œç”¨ï¼š éš”ç¦»äº†å®¢æˆ·ä¸å¯¹è±¡çš„ç”Ÿäº§è¿‡ç¨‹ï¼› è´Ÿè´£æ§åˆ¶äº§å“å¯¹è±¡çš„ç”Ÿäº§è¿‡ç¨‹ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182public class Client &#123; public static void main(String[] args) &#123; // ç›–æ™®é€šæˆ¿å­ CommonHouse commonHouse = new CommonHouse(); // å‡†å¤‡åˆ›å»ºæˆ¿å­çš„æŒ‡æŒ¥è€… HouseDirector houseDirector = new HouseDirector(commonHouse); // å®Œæˆç›–æˆ¿å­ï¼Œè¿”å›äº§å“ï¼ˆæ™®é€šæˆ¿å­ï¼‰ House house = houseDirector.constructHouse(); System.out.println(\"--------------------------\"); //ç›–é«˜æ¥¼ HighBuilding highBuilding = new HighBuilding(); //é‡ç½®å»ºé€ è€… houseDirector.setHouseBuilder(highBuilding); //å®Œæˆç›–æˆ¿å­ï¼Œè¿”å›äº§å“ï¼ˆé«˜æ¥¼ï¼‰ houseDirector.constructHouse(); &#125;&#125;public class CommonHouse extends HouseBuilder &#123; @Override public void buildBasic() &#123; System.out.println(\" æ™®é€šæˆ¿å­æ‰“åœ°åŸº 5 ç±³ \"); &#125; @Override public void buildWalls() &#123; System.out.println(\" æ™®é€šæˆ¿å­ç Œå¢™ 10cm \"); &#125; @Override public void roofed() &#123; System.out.println(\" æ™®é€šæˆ¿å­å±‹é¡¶ \"); &#125;&#125;public class HighBuilding extends HouseBuilder &#123; @Override public void buildBasic() &#123; System.out.println(\" é«˜æ¥¼çš„æ‰“åœ°åŸº 100 ç±³ \"); &#125; @Override public void buildWalls() &#123; System.out.println(\" é«˜æ¥¼çš„ç Œå¢™ 20cm \"); &#125; @Override public void roofed() &#123; System.out.println(\" é«˜æ¥¼çš„é€æ˜å±‹é¡¶ \"); &#125;&#125;public class House &#123; private String baise; private String wall; private String roofed; // Getter / Setter&#125;// æŠ½è±¡çš„å»ºé€ è€…public abstract class HouseBuilder &#123; protected House house = new House(); // å°†å»ºé€ çš„æµç¨‹å†™å¥½, æŠ½è±¡çš„æ–¹æ³• public abstract void buildBasic(); public abstract void buildWalls(); public abstract void roofed(); // å»ºé€ æˆ¿å­å¥½ï¼Œ å°†äº§å“è¿”å› public House buildHouse() &#123; return house; &#125;&#125;public class HouseDirector &#123; HouseBuilder houseBuilder = null; // æ„é€ å™¨ä¼ å…¥ houseBuilder public HouseDirector(HouseBuilder houseBuilder) &#123; this.houseBuilder = houseBuilder; &#125; // å¦‚ä½•å¤„ç†å»ºé€ æˆ¿å­çš„æµç¨‹ï¼Œäº¤ç»™æŒ‡æŒ¥è€… public House constructHouse() &#123; houseBuilder.buildBasic(); houseBuilder.buildWalls(); houseBuilder.roofed(); return houseBuilder.buildHouse(); &#125;&#125; Factory VS. BuilderæŠ½è±¡å·¥å‚æ¨¡å¼å®ç°å¯¹äº§å“å®¶æ—çš„åˆ›å»ºï¼Œä¸€ä¸ªäº§å“å®¶æ—æ˜¯è¿™æ ·çš„ä¸€ç³»åˆ—äº§å“ï¼šå…·æœ‰ä¸åŒåˆ†ç±»ç»´åº¦çš„äº§å“ç»„åˆï¼Œé‡‡ç”¨æŠ½è±¡å·¥å‚æ¨¡å¼ä¸éœ€è¦å…³å¿ƒæ„å»ºè¿‡ç¨‹ï¼Œåªå…³å¿ƒä»€ä¹ˆäº§å“ç”±ä»€ä¹ˆå·¥å‚ç”Ÿäº§å³å¯ã€‚ å»ºé€ è€…æ¨¡å¼åˆ™æ˜¯è¦æ±‚æŒ‰ç…§æŒ‡å®šçš„è“å›¾å»ºé€ äº§å“ï¼Œå¯ä»¥æ›´åŠ ç²¾ç»†åœ°æ§åˆ¶äº§å“çš„åˆ›å»ºè¿‡ç¨‹ ã€‚å°†å¤æ‚äº§å“çš„åˆ›å»ºæ­¥éª¤åˆ†è§£åœ¨ä¸åŒçš„æ–¹æ³•ä¸­ï¼Œä½¿å¾—åˆ›å»ºè¿‡ç¨‹æ›´åŠ æ¸…æ™°ï¼Œä¹Ÿæ›´æ–¹ä¾¿ä½¿ç”¨ç¨‹åºæ¥æ§åˆ¶åˆ›å»ºè¿‡ç¨‹å®ƒçš„ä¸»è¦ç›®çš„æ˜¯é€šè¿‡ç»„è£…é›¶é…ä»¶è€Œäº§ç”Ÿä¸€ä¸ªæ–°å“ï¼›å»ºé€ è€…æ¨¡å¼æ‰€åˆ›å»ºçš„äº§å“ä¸€èˆ¬å…·æœ‰è¾ƒå¤šçš„å…±åŒç‚¹ï¼Œå…¶ç»„æˆéƒ¨åˆ†ç›¸ä¼¼ï¼Œå¦‚æœäº§å“ä¹‹é—´çš„å·®å¼‚æ€§å¾ˆå¤§ï¼Œåˆ™ä¸é€‚åˆä½¿ç”¨å»ºé€ è€…æ¨¡å¼ï¼Œå› æ­¤å…¶ä½¿ç”¨èŒƒå›´å—åˆ°ä¸€å®šçš„é™åˆ¶ã€‚ ç»“æ„å‹æ¨¡å¼é€‚é…å™¨æ¨¡å¼é€‚é…å™¨æ¨¡å¼ï¼ˆAdapter Patternï¼‰å°†æŸä¸ªç±»çš„æ¥å£è½¬æ¢æˆå®¢æˆ·ç«¯æœŸæœ›çš„å¦ä¸€ä¸ªæ¥å£è¡¨ç¤ºï¼Œä¸»çš„ç›®çš„æ˜¯å…¼å®¹æ€§ï¼Œè®©åŸæœ¬å› æ¥å£ä¸åŒ¹é…ä¸èƒ½ä¸€èµ·å·¥ä½œçš„ä¸¤ä¸ªç±»å¯ä»¥ååŒå·¥ä½œï¼Œå…¶åˆ«åä¸ºåŒ…è£…å™¨ï¼ˆWrapperï¼‰ã€‚ ç§ç±»ï¼šç±» / å¯¹è±¡ / æ¥å£é€‚é…å™¨æ¨¡å¼ã€‚ ç±»é€‚é…å™¨ 123456789101112131415161718192021222324252627282930313233343536373839404142public class Client &#123; public static void main(String[] args) &#123; System.out.println(\" === ç±»é€‚é…å™¨æ¨¡å¼ ===\"); Phone phone = new Phone(); phone.charging(new VoltageAdapter()); &#125;&#125;// é€‚é…æ¥å£public interface IVoltage5V &#123; public int output5V();&#125;public class Phone &#123; // å……ç”µ public void charging(IVoltage5V iVoltage5V) &#123; if(iVoltage5V.output5V() == 5) &#123; System.out.println(\"ç”µå‹ä¸º 5V, å¯ä»¥å……ç”µ\"); &#125; else if (iVoltage5V.output5V() &gt; 5) &#123; System.out.println(\"ç”µå‹å¤§äº 5V, ä¸èƒ½å……ç”µ\"); &#125; &#125;&#125;// è¢«é€‚é…çš„ç±»public class Voltage220V &#123; // è¾“å‡º 220V çš„ç”µå‹ public int output220V() &#123; int src = 220; System.out.println(\"ç”µå‹=\" + src + \"ä¼\"); return src; &#125;&#125;// é€‚é…å™¨ï¼ŒJava å•ç»§æ‰¿æœºåˆ¶ï¼Œæ‰€ä»¥ç›®æ ‡ç±»å¿…é¡»æ˜¯ä¸€ä¸ªæ¥å£public class VoltageAdapter extends Voltage220V implements IVoltage5V &#123; @Override public int output5V() &#123; // è·å–åˆ° 220V ç”µå‹ int srcV = output220V(); int dstV = srcV / 44 ; // è½¬æˆ 5v return dstV; &#125;&#125; å¯¹è±¡é€‚é…å™¨åŸºæœ¬æ€è·¯å’Œç±»çš„é€‚é…å™¨æ¨¡å¼ç›¸åŒï¼Œåªæ˜¯å°† Adapter ç±»ä½œä¿®æ”¹ï¼Œä¸æ˜¯ç»§æ‰¿ resource ç±»ï¼Œè€Œæ˜¯æŒæœ‰å…¶çš„å®ä¾‹ï¼Œä»¥è§£å†³å…¼å®¹æ€§çš„é—®é¢˜ã€‚å³æ ¹æ®åˆæˆå¤ç”¨åŸåˆ™ï¼Œåœ¨ç³»ç»Ÿä¸­å°½é‡ä½¿ç”¨å…³è”å…³ç³»ï¼ˆèšåˆï¼‰æ¥æ›¿ä»£ç»§æ‰¿å…³ç³»ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748public class Client &#123; public static void main(String[] args) &#123; System.out.println(\" === å¯¹è±¡é€‚é…å™¨æ¨¡å¼ ===\"); Phone phone = new Phone(); phone.charging(new VoltageAdapter(new Voltage220V())); &#125;&#125;public interface Voltage5V &#123; public int output5V();&#125;public class Phone &#123; public void charging(IVoltage5V iVoltage5V) &#123; if(iVoltage5V.output5V() == 5) &#123; System.out.println(\"ç”µå‹ä¸º 5V, å¯ä»¥å……ç”µ\"); &#125; else if (iVoltage5V.output5V() &gt; 5) &#123; System.out.println(\"ç”µå‹å¤§äº 5V, ä¸èƒ½å……ç”µ\"); &#125; &#125;&#125;public class Voltage220V &#123; public int output220V() &#123; int src = 220; System.out.println(\"ç”µå‹=\" + src + \"ä¼\"); return src; &#125;&#125;public class VoltageAdapter implements IVoltage5V &#123; private Voltage220V voltage220V; // å…³è”å…³ç³»-èšåˆ // é€šè¿‡æ„é€ å™¨ï¼Œä¼ å…¥ä¸€ä¸ª Voltage220V å®ä¾‹ public VoltageAdapter(Voltage220V voltage220v) &#123; this.voltage220V = voltage220v; &#125; @Override public int output5V() &#123; int dst = 0; if(null != voltage220V) &#123; int src = voltage220V.output220V(); // è·å– 220V ç”µå‹ System.out.println(\"ä½¿ç”¨å¯¹è±¡é€‚é…å™¨ï¼Œè¿›è¡Œé€‚é…\"); dst = src / 44; System.out.println(\"é€‚é…å®Œæˆï¼Œè¾“å‡ºçš„ç”µå‹ä¸º=\" + dst); &#125; return dst; &#125;&#125; å¯¹è±¡é€‚é…å™¨å’Œç±»é€‚é…å™¨å…¶å®ç®—æ˜¯åŒä¸€ç§æ€æƒ³ï¼Œåªä¸è¿‡å®ç°æ–¹å¼ä¸åŒã€‚æ ¹æ®åˆæˆå¤ç”¨åŸåˆ™ï¼Œä½¿ç”¨ç»„åˆæ›¿ä»£ç»§æ‰¿ï¼Œ æ‰€ä»¥å®ƒè§£å†³äº†ç±»é€‚é…å™¨å¿…é¡»ç»§æ‰¿ resource çš„å±€é™æ€§é—®é¢˜ï¼Œä¹Ÿä¸å†è¦æ±‚ destination å¿…é¡»æ˜¯æ¥å£ã€‚ æ¥å£é€‚é…å™¨æ ¸å¿ƒæ€è·¯ï¼šå½“ä¸éœ€è¦å…¨éƒ¨å®ç°æ¥å£æä¾›çš„æ–¹æ³•æ—¶ï¼Œå¯å…ˆè®¾è®¡ä¸€ä¸ªæŠ½è±¡ç±»å®ç°æ¥å£ï¼Œå¹¶ä¸ºè¯¥æ¥å£ä¸­æ¯ä¸ªæ–¹æ³•æä¾›ä¸€ä¸ªé»˜è®¤å®ç°ï¼ˆç©ºæ–¹æ³•ï¼‰ï¼Œé‚£ä¹ˆè¯¥æŠ½è±¡ç±»çš„å­ç±»å¯æœ‰é€‰æ‹©åœ°è¦†ç›–çˆ¶ç±»çš„æŸäº›æ–¹æ³•æ¥å®ç°éœ€æ±‚ã€‚è¯¥æ¨¡å¼é€‚ç”¨äºä¸€ä¸ªæ¥å£ä¸æƒ³ä½¿ç”¨å…¶æ‰€æœ‰çš„æ–¹æ³•çš„æƒ…å†µã€‚ 123456789101112131415161718192021222324252627282930public interface Interface &#123; public void m1(); public void m2(); public void m3(); public void m4();&#125;// åœ¨ AbsAdapter æˆ‘ä»¬å°† Interface çš„æ–¹æ³•è¿›è¡Œé»˜è®¤å®ç°public abstract class AbsAdapter implements Interface &#123; public void m1() &#123; &#125; public void m2() &#123; &#125; public void m3() &#123; &#125; public void m4() &#123; &#125;&#125;public class Client &#123; public static void main(String[] args) &#123; AbsAdapter absAdapter = new AbsAdapter() &#123; // åªéœ€è¦†ç›–éœ€è¦ä½¿ç”¨æ¥å£æ–¹æ³• @Override public void m1() &#123; System.out.println(\"ä½¿ç”¨äº† m1 çš„æ–¹æ³•\"); &#125; &#125;; absAdapter.m1(); &#125;&#125; Spring MVCSpring MVC ä¸­çš„ HandlerAdapter, å°±ä½¿ç”¨äº†é€‚é…å™¨æ¨¡å¼ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899public class DispatchServlet &#123; public static List&lt;HandlerAdapter&gt; handlerAdapters = new ArrayList&lt;HandlerAdapter&gt;(); public DispatchServlet() &#123; // åˆå§‹åŒ–å„ç§é€‚é…å™¨ handlerAdapters.add(new AnnotationHandlerAdapter()); handlerAdapters.add(new HttpHandlerAdapter()); handlerAdapters.add(new SimpleHandlerAdapter()); &#125; public void doDispatch() &#123; // æ­¤å¤„æ¨¡æ‹Ÿ Spring MVC ä» request å– handler çš„å¯¹è±¡ HttpController controller = new HttpController(); // å¾—åˆ°å¯¹åº”é€‚é…å™¨ HandlerAdapter adapter = getHandler(controller); // é€šè¿‡é€‚é…å™¨æ‰§è¡Œå¯¹åº”çš„ controller çš„å¯¹åº”æ–¹æ³• adapter.handle(controller); &#125; public HandlerAdapter getHandler(Controller controller) &#123; // éå†ï¼šæ ¹æ®å¾—åˆ°çš„ controller å³ handler, è¿”å›å¯¹åº”é€‚é…å™¨ for (HandlerAdapter adapter : this.handlerAdapters) &#123; // åˆ¤è¯»æ­¤é€‚é…å™¨æ˜¯å¦æ”¯æŒæ­¤ç±»å‹çš„ controller if (adapter.supports(controller)) &#123; return adapter; &#125; &#125; return null; &#125; public static void main(String[] args) &#123; new DispatchServlet().doDispatch(); &#125;&#125;public interface Controller &#123;&#125;// å¤šç§ Controller ç±» class HttpController implements Controller &#123; public void doHttpHandler() &#123; System.out.println(\"http...\"); &#125;&#125;class SimpleController implements Controller &#123; public void doSimplerHandler() &#123; System.out.println(\"simple...\"); &#125;&#125;class AnnotationController implements Controller &#123; public void doAnnotationHandler() &#123; System.out.println(\"annotation...\"); &#125;&#125;public interface HandlerAdapter &#123; public boolean supports(Object handler); public void handle(Object handler);&#125;// å¤šç§ Adapter ç±»class SimpleHandlerAdapter implements HandlerAdapter &#123; public void handle(Object handler) &#123; ((SimpleController) handler).doSimplerHandler(); &#125; public boolean supports(Object handler) &#123; return (handler instanceof SimpleController); &#125;&#125;class HttpHandlerAdapter implements HandlerAdapter &#123; public void handle(Object handler) &#123; ((HttpController) handler).doHttpHandler(); &#125; public boolean supports(Object handler) &#123; return (handler instanceof HttpController); &#125;&#125;class AnnotationHandlerAdapter implements HandlerAdapter &#123; public void handle(Object handler) &#123; ((AnnotationController) handler).doAnnotationHandler(); &#125; public boolean supports(Object handler) &#123; return (handler instanceof AnnotationController); &#125;&#125; æ¡¥æ¥æ¨¡å¼å°†å®ç°ä¸æŠ½è±¡æ”¾åœ¨ä¸¤ä¸ªä¸åŒçš„ç±»å±‚æ¬¡ä¸­ï¼Œä½¿ä¸¤ä¸ªå±‚æ¬¡å¯ä»¥ç‹¬ç«‹æ”¹å˜ï¼›Bridge æ¨¡å¼åŸºäºç±»çš„æœ€å°è®¾è®¡åŸåˆ™ï¼Œé€šè¿‡ä½¿ç”¨å°è£…ã€èšåˆåŠç»§æ‰¿ç­‰è¡Œä¸ºè®©ä¸åŒçš„ç±»æ‰¿æ‹…ä¸åŒçš„èŒè´£ã€‚å®ƒçš„ä¸»è¦ç‰¹ç‚¹æ˜¯æŠŠæŠ½è±¡ï¼ˆAbstractionï¼‰ä¸è¡Œä¸ºå®ç°ï¼ˆImplementationï¼‰åˆ†ç¦»å¼€æ¥ï¼Œä»è€Œå¯ä»¥ä¿æŒå„éƒ¨åˆ†çš„ç‹¬ç«‹æ€§ä»¥åŠåº”å¯¹ä»–ä»¬çš„åŠŸèƒ½æ‰©å±•ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116public class Client &#123; public static void main(String[] args) &#123; Phone phone1 = new FoldedPhone(new XiaoMi()); phone1.open(); phone1.call(); phone1.close(); System.out.println(\"=======\"); Phone phone2 = new FoldedPhone(new Vivo()); phone2.open(); phone2.call(); phone2.close(); System.out.println(\"=======\"); UpRightPhone phone3 = new UpRightPhone(new XiaoMi()); phone3.open(); phone3.call(); phone3.close(); System.out.println(\"=======\"); UpRightPhone phone4 = new UpRightPhone(new Vivo()); phone4.open(); phone4.call(); phone4.close(); &#125;&#125;// æ‰‹æœºè¿™ä¸€è§’è‰²çš„æŠ½è±¡public abstract class Phone &#123; // ç»„åˆå“ç‰Œ private Brand brand; // æ„é€ å™¨ public Phone(Brand brand) &#123; super(); this.brand = brand; &#125; protected void open() &#123; this.brand.open(); &#125; protected void close() &#123; brand.close(); &#125; protected void call() &#123; brand.call(); &#125;&#125;public class FoldedPhone extends Phone &#123; public FoldedPhone(Brand brand) &#123; super(brand); &#125; public void open() &#123; super.open(); System.out.println(\" æŠ˜å æ ·å¼æ‰‹æœº \"); &#125; public void close() &#123; super.close(); System.out.println(\" æŠ˜å æ ·å¼æ‰‹æœº \"); &#125; public void call() &#123; super.call(); System.out.println(\" æŠ˜å æ ·å¼æ‰‹æœº \"); &#125;&#125;public class UpRightPhone extends Phone &#123; // æ„é€ å™¨ public UpRightPhone(Brand brand) &#123; super(brand); &#125; public void open() &#123; super.open(); System.out.println(\" ç›´ç«‹æ ·å¼æ‰‹æœº \"); &#125; public void close() &#123; super.close(); System.out.println(\" ç›´ç«‹æ ·å¼æ‰‹æœº \"); &#125; public void call() &#123; super.call(); System.out.println(\" ç›´ç«‹æ ·å¼æ‰‹æœº \"); &#125;&#125;// æ‰‹æœºçš„è¡Œä¸ºpublic interface Brand &#123; void open(); void close(); void call();&#125;public class Vivo implements Brand &#123; @Overrid public void open() &#123; System.out.println(\" Vivo æ‰‹æœºå¼€æœº \"); &#125; @Override public void close() &#123; System.out.println(\" Vivo æ‰‹æœºå…³æœº \"); &#125; @Override public void call() &#123; System.out.println(\" Vivo æ‰‹æœºæ‰“ç”µè¯ \"); &#125;&#125;public class XiaoMi implements Brand &#123; @Override public void open() &#123; System.out.println(\" å°ç±³æ‰‹æœºå¼€æœº \"); &#125; @Override public void close() &#123; System.out.println(\" å°ç±³æ‰‹æœºå…³æœº \"); &#125; @Override public void call() &#123; System.out.println(\" å°ç±³æ‰‹æœºæ‰“ç”µè¯ \"); &#125;&#125; JDBC è¿™é‡Œç¨å¾®æœ‰ç‚¹ä¸åŒçš„æ˜¯æ²¡æœ‰è¿›è¡ŒæŠ½è±¡ã€‚ è£…é¥°è€…æ¨¡å¼åŠ¨æ€çš„å°†æ–°åŠŸèƒ½é™„åŠ åˆ°å¯¹è±¡ä¸Šã€‚åœ¨å¯¹è±¡åŠŸèƒ½æ‰©å±•æ–¹é¢ï¼Œå®ƒæ¯”ç»§æ‰¿æ›´æœ‰å¼¹æ€§ï¼Œè£…é¥°è€…æ¨¡å¼ä¹Ÿä½“ç°äº†å¼€é—­åŸåˆ™ OCPã€‚è£…é¥°è€…å¯ä»¥åŒ…å«è¢«è£…é¥°è€…ï¼šä¸€å±‚ä¸€å±‚å°±åƒåŒ…å¿«é€’ä¸€æ ·ï¼Œæ¯”ä¸€æ ·çš„ç‰©å“åŒ…è£…çš„æ–¹å¼ä¸åŒã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100public abstract class Drink &#123; public String des; // é¥®å“çš„æè¿° private float price = 0.0f; // Getter / Setter // è§„å®šå­ç±»éƒ½è¦æœ‰è®¡ç®—ä»·æ ¼çš„æ–¹æ³• public abstract float cost();&#125;public class Coffee extends Drink &#123; @Override public float cost() &#123; return super.getPrice(); &#125;&#125;public class DeCaf extends Coffee &#123; public DeCaf() &#123; setDes(\" DeCaf \"); setPrice(1.0f); &#125;&#125;public class LongBlack extends Coffee &#123; public LongBlack() &#123; setDes(\" longblack \"); setPrice(5.0f); &#125;&#125;public class ShortBlack extends Coffee&#123; public ShortBlack() &#123; setDes(\" shortblack \"); setPrice(4.0f); &#125;&#125;public class Decorator extends Drink &#123; private Drink obj; public Decorator(Drink obj) &#123; // ç»„åˆ this.obj = obj; &#125; @Override public float cost() &#123; // getPrice è‡ªå·±ä»·æ ¼ return super.getPrice() + obj.cost(); // é€’å½’åˆ—å‡ºæ‰€æœ‰ä»·æ ¼ &#125; @Override public String getDes() &#123; // obj.getDes() è¾“å‡ºè¢«è£…é¥°è€…çš„ä¿¡æ¯ return des + \" \" + getPrice() + \" &amp;&amp; \" + obj.getDes(); &#125;&#125;// å…·ä½“çš„ Decoratorï¼Œ è¿™é‡Œå°±æ˜¯è°ƒå‘³å“public class Chocolate extends Decorator &#123; public Chocolate(Drink obj) &#123; super(obj); setDes(\" å·§å…‹åŠ› \"); setPrice(3.0f); // è°ƒå‘³å“çš„ä»·æ ¼ &#125;&#125;public class Milk extends Decorator &#123; public Milk(Drink obj) &#123; super(obj); setDes(\" ç‰›å¥¶ \"); setPrice(2.0f); &#125;&#125;public class CoffeeBar &#123; public static void main(String[] args) &#123; // è£…é¥°è€…æ¨¡å¼ä¸‹çš„è®¢å•ï¼š2 ä»½å·§å…‹åŠ› + 1 ä»½ç‰›å¥¶çš„ LongBlack // ç‚¹ä¸€ä»½ LongBlack Drink order = new LongBlack(); System.out.println(\"è´¹ç”¨ = \" + order.cost()); System.out.println(\"æè¿° = \" + order.getDes()); // order åŠ å…¥ä¸€ä»½ç‰›å¥¶ order = new Milk(order); System.out.println(\"order åŠ å…¥ä¸€ä»½ç‰›å¥¶ è´¹ç”¨ = \" + order.cost()); System.out.println(\"order åŠ å…¥ä¸€ä»½ç‰›å¥¶ æè¿° = \" + order.getDes()); // order åŠ å…¥ä¸€ä»½å·§å…‹åŠ› order = new Chocolate(order); System.out.println(\"order åŠ å…¥ä¸€ä»½ç‰›å¥¶ åŠ å…¥ä¸€ä»½å·§å…‹åŠ› è´¹ç”¨ = \" + order.cost()); System.out.println(\"order åŠ å…¥ä¸€ä»½ç‰›å¥¶ åŠ å…¥ä¸€ä»½å·§å…‹åŠ› æè¿° = \" + order.getDes()); // order åŠ å…¥ä¸€ä»½å·§å…‹åŠ› order = new Chocolate(order); System.out.println(\"order åŠ å…¥ä¸€ä»½ç‰›å¥¶ åŠ å…¥ 2 ä»½å·§å…‹åŠ› è´¹ç”¨ = \" + order.cost()); System.out.println(\"order åŠ å…¥ä¸€ä»½ç‰›å¥¶ åŠ å…¥ 2 ä»½å·§å…‹åŠ› æè¿° = \" + order.getDes()); System.out.println(\"=======\"); Drink order2 = new DeCaf(); System.out.println(\"order2 æ— å› å’–å•¡ è´¹ç”¨ = \" + order2.cost()); System.out.println(\"order2 æ— å› å’–å•¡ æè¿° = \" + order2.getDes()); order2 = new Milk(order2); System.out.println(\"order2 æ— å› å’–å•¡ åŠ å…¥ä¸€ä»½ç‰›å¥¶ è´¹ç”¨ = \" + order2.cost()); System.out.println(\"order2 æ— å› å’–å•¡ åŠ å…¥ä¸€ä»½ç‰›å¥¶ æè¿° = \" + order2.getDes()); &#125;&#125; JDK-FilterInputStream è£…é¥°è€… FilterInputSteam çš„éƒ¨åˆ†ä»£ç ã€‚ ç»„åˆæ¨¡å¼ç»„åˆæ¨¡å¼ï¼ˆComposite Patternï¼‰ï¼Œåˆå«éƒ¨åˆ†æ•´ä½“æ¨¡å¼ï¼Œå®ƒåˆ›å»ºäº†å¯¹è±¡ç»„çš„æ ‘å½¢ç»“æ„ï¼Œå°†å¯¹è±¡ç»„åˆæˆæ ‘çŠ¶ç»“æ„ä»¥è¡¨ç¤ºï¼ˆæ•´ä½“-éƒ¨åˆ†ï¼‰å±‚æ¬¡å…³ç³»ã€‚ç»„åˆæ¨¡å¼ä½¿å¾—ç”¨æˆ·å¯¹å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡çš„è®¿é—®å…·æœ‰ä¸€è‡´æ€§ï¼Œå³ï¼šç»„åˆèƒ½è®©å®¢æˆ·ä»¥ä¸€è‡´çš„æ–¹å¼å¤„ç†ä¸ªåˆ«å¯¹è±¡ä»¥åŠç»„åˆå¯¹è±¡ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136public class Client &#123; public static void main(String[] args) &#123; // ç»„åˆå…³ç³»ï¼šç³» &lt; å­¦é™¢ &lt; å¤§å­¦ OrganizationComponent university = new University(\"æ¸…åå¤§å­¦\", \" ä¸­å›½é¡¶çº§å¤§å­¦ \"); OrganizationComponent computerCollege = new College(\"è®¡ç®—æœºå­¦é™¢\", \" è®¡ç®—æœºå­¦é™¢ \"); OrganizationComponent infoEngineercollege = new College(\"ä¿¡æ¯å·¥ç¨‹å­¦é™¢\", \" ä¿¡æ¯å·¥ç¨‹å­¦é™¢ \"); // å°†ç³»åŠ å…¥åˆ°å­¦é™¢ computerCollege.add(new Department(\"è½¯ä»¶å·¥ç¨‹\", \" è½¯ä»¶å·¥ç¨‹ä¸é”™ \")); computerCollege.add(new Department(\"ç½‘ç»œå·¥ç¨‹\", \" ç½‘ç»œå·¥ç¨‹ä¸é”™ \")); computerCollege.add(new Department(\"è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯\", \" è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯æ˜¯è€ç‰Œçš„ä¸“ä¸š \")); infoEngineercollege.add(new Department(\"é€šä¿¡å·¥ç¨‹\", \" é€šä¿¡å·¥ç¨‹ä¸å¥½å­¦ \")); infoEngineercollege.add(new Department(\"ä¿¡æ¯å·¥ç¨‹\", \" ä¿¡æ¯å·¥ç¨‹å¥½å­¦ \")); // å°†å­¦é™¢åŠ å…¥åˆ°å­¦æ ¡ university.add(computerCollege); university.add(infoEngineercollege); //university.print(); infoEngineercollege.print(); &#125;&#125;public abstract class OrganizationComponent &#123; private String name; // åå­— private String des; // è¯´æ˜ protected void add(OrganizationComponent organizationComponent) &#123; // é»˜è®¤å®ç° throw new UnsupportedOperationException(); &#125; protected void remove(OrganizationComponent organizationComponent) &#123; // é»˜è®¤å®ç° throw new UnsupportedOperationException(); &#125; // æ„é€ å™¨ public OrganizationComponent(String name, String des) &#123; super(); this.name = name; this.des = des; &#125; // Getter / Setter // å­ç±»éƒ½éœ€è¦å®ç°çš„æŠ½è±¡æ–¹æ³• protected abstract void print();&#125;// University ä¸ºéå¶å­èŠ‚ç‚¹, å¯ä»¥ç®¡ç† Collegepublic class University extends OrganizationComponent &#123; List&lt;OrganizationComponent&gt; organizationComponents = new ArrayList&lt;OrganizationComponent&gt;(); // æ„é€ å™¨ public University(String name, String des) &#123; super(name, des); &#125; // é‡å†™ add @Override protected void add(OrganizationComponent organizationComponent) &#123; organizationComponents.add(organizationComponent); &#125; // é‡å†™ remove @Override protected void remove(OrganizationComponent organizationComponent) &#123; organizationComponents.remove(organizationComponent); &#125; @Override public String getName() &#123; return super.getName(); &#125; @Override public String getDes() &#123; return super.getDes(); &#125; @Override protected void print() &#123; System.out.println(\"---\" + getName() + \"---\"); //éå† organizationComponents for (OrganizationComponent organizationComponent : organizationComponents) &#123; organizationComponent.print(); &#125; &#125;&#125;public class College extends OrganizationComponent &#123; // ç”¨äºå­˜æ”¾ Department çš„ List List&lt;OrganizationComponent&gt; organizationComponents = new ArrayList&lt;OrganizationComponent&gt;(); // æ„é€ å™¨ public College(String name, String des) &#123; super(name, des); &#125; // æ ¹æ®éœ€æ±‚é‡å†™æ–¹æ³•ï¼Œä¸åŒå±‚æ¬¡çš„å®ç°å¯èƒ½ä¸åŒ @Override protected void add(OrganizationComponent organizationComponent) &#123; organizationComponents.add(organizationComponent); &#125; @Override protected void remove(OrganizationComponent organizationComponent) &#123; organizationComponents.remove(organizationComponent); &#125; @Override public String getName() &#123; return super.getName(); &#125; @Override public String getDes() &#123; return super.getDes(); &#125; // è¾“å‡ºå­¦é™¢ @Override protected void print() &#123; // TODO Auto-generated method stub System.out.println(\"---\" + getName() + \"---\"); //éå† organizationComponents for (OrganizationComponent organizationComponent : organizationComponents) &#123; organizationComponent.print(); &#125; &#125;&#125;// å¶å­èŠ‚ç‚¹public class Department extends OrganizationComponent &#123; // æ—  List public Department(String name, String des) &#123; super(name, des); &#125; // æ— éœ€é‡å†™ add remove æ–¹æ³• @Override public String getName() &#123; return super.getName(); &#125; @Override public String getDes() &#123; return super.getDes(); &#125; @Override protected void print() &#123; System.out.println(getName()); &#125;&#125; JDK-HashMap å¤–è§‚æ¨¡å¼å¤–è§‚æ¨¡å¼é€šè¿‡å®šä¹‰ä¸€ä¸ªä¸€è‡´çš„æ¥å£ï¼Œç”¨ä»¥å±è”½å†…éƒ¨å­ç³»ç»Ÿçš„ç»†èŠ‚ï¼Œä½¿å¾—è°ƒç”¨ç«¯åªéœ€è·Ÿè¿™ä¸ªæ¥å£å‘ç”Ÿè°ƒç”¨ï¼Œè€Œæ— éœ€å…³å¿ƒè¿™ä¸ªå­ç³»ç»Ÿçš„å†…éƒ¨ç»†èŠ‚ã€‚ äº«å…ƒæ¨¡å¼è¿ç”¨å…±äº«æŠ€æœ¯æœ‰æ•ˆåœ°æ”¯æŒå¤§é‡ç»†ç²’åº¦çš„å¯¹è±¡ï¼›å¸¸ç”¨äºç³»ç»Ÿåº•å±‚å¼€å‘ï¼Œè§£å†³ç³»ç»Ÿçš„æ€§èƒ½é—®é¢˜ã€‚åƒæ•°æ®åº“è¿æ¥æ± ï¼Œé‡Œé¢éƒ½æ˜¯åˆ›å»ºå¥½çš„è¿æ¥å¯¹è±¡ï¼Œåœ¨è¿™äº›è¿æ¥å¯¹è±¡ä¸­æœ‰æˆ‘ä»¬éœ€è¦çš„åˆ™ç›´æ¥æ‹¿æ¥ç”¨ï¼Œé¿å…é‡æ–°åˆ›å»ºï¼Œå¦‚æœæ²¡æœ‰æˆ‘ä»¬éœ€è¦çš„ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªï¼›äº«å…ƒæ¨¡å¼èƒ½å¤Ÿè§£å†³é‡å¤å¯¹è±¡çš„å†…å­˜æµªè´¹çš„é—®é¢˜ï¼Œå½“ç³»ç»Ÿä¸­æœ‰å¤§é‡ç›¸ä¼¼å¯¹è±¡ï¼Œåˆ›å»ºç¼“å†²æ± ï¼Œä¸éœ€æ€»æ˜¯åˆ›å»ºæ–°å¯¹è±¡ï¼Œå¯ä»¥ä»ç¼“å†²æ± é‡Œæ‹¿ã€‚è¿™æ ·å¯ä»¥é™ä½ç³»ç»Ÿå†…å­˜ï¼ŒåŒæ—¶æé«˜æ•ˆç‡ï¼› äº«å…ƒæ¨¡å¼ç»å…¸çš„åº”ç”¨åœºæ™¯å°±æ˜¯æ± æŠ€æœ¯äº†ï¼ŒString å¸¸é‡æ± ã€æ•°æ®åº“è¿æ¥æ± ã€ç¼“å†²æ± ç­‰ç­‰éƒ½æ˜¯äº«å…ƒæ¨¡å¼çš„åº”ç”¨ï¼Œäº«å…ƒæ¨¡å¼æ˜¯æ± æŠ€æœ¯çš„é‡è¦å®ç°æ–¹å¼ã€‚ äº«å…ƒæ¨¡å¼æå‡ºäº†ä¸¤ä¸ªè¦æ±‚ï¼šç»†ç²’åº¦å’Œå…±äº«å¯¹è±¡ã€‚è¿™é‡Œå°±æ¶‰åŠåˆ°å†…éƒ¨çŠ¶æ€å’Œå¤–éƒ¨çŠ¶æ€äº†ï¼Œå³å°†å¯¹è±¡çš„ä¿¡æ¯åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼šå†…éƒ¨çŠ¶æ€å’Œå¤–éƒ¨çŠ¶æ€ï¼š å†…éƒ¨çŠ¶æ€æŒ‡å¯¹è±¡å…±äº«å‡ºæ¥çš„ä¿¡æ¯ï¼Œå­˜å‚¨åœ¨äº«å…ƒå¯¹è±¡å†…éƒ¨ä¸”ä¸ä¼šéšç¯å¢ƒçš„æ”¹å˜è€Œæ”¹å˜ï¼› å¤–éƒ¨çŠ¶æ€æŒ‡å¯¹è±¡å¾—ä»¥ä¾èµ–çš„ä¸€ä¸ªæ ‡è®°ï¼Œæ˜¯éšç¯å¢ƒæ”¹å˜è€Œæ”¹å˜çš„ã€ä¸å¯å…±äº«çš„çŠ¶æ€ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364public class Client &#123; public static void main(String[] args) &#123; // åˆ›å»ºä¸€ä¸ªå·¥å‚ç±» WebSiteFactory factory = new WebSiteFactory(); // å®¢æˆ·è¦ä¸€ä¸ªä»¥æ–°é—»å½¢å¼å‘å¸ƒçš„ç½‘ç«™ WebSite webSite1 = factory.getWebSiteCategory(\"æ–°é—»\"); webSite1.use(new User(\"tom\")); // å®¢æˆ·è¦ä¸€ä¸ªä»¥åšå®¢å½¢å¼å‘å¸ƒçš„ç½‘ç«™ WebSite webSite2 = factory.getWebSiteCategory(\"åšå®¢\"); webSite2.use(new User(\"jack\")); // å®¢æˆ·è¦ä¸€ä¸ªä»¥åšå®¢å½¢å¼å‘å¸ƒçš„ç½‘ç«™ WebSite webSite3 = factory.getWebSiteCategory(\"åšå®¢\"); webSite3.use(new User(\"smith\")); // å®¢æˆ·è¦ä¸€ä¸ªä»¥åšå®¢å½¢å¼å‘å¸ƒçš„ç½‘ç«™ WebSite webSite4 = factory.getWebSiteCategory(\"åšå®¢\"); webSite4.use(new User(\"king\")); System.out.println(\"ç½‘ç«™çš„åˆ†ç±»å…±=\" + factory.getWebSiteCount()); &#125;&#125;public abstract class WebSite &#123; public abstract void use(User user); // æŠ½è±¡æ–¹æ³•&#125;// å…·ä½“ç½‘ç«™public class ConcreteWebSite extends WebSite &#123; // å…±äº«çš„éƒ¨åˆ†ï¼Œå†…éƒ¨çŠ¶æ€ private String type = \"\"; // ç½‘ç«™å‘å¸ƒçš„ç±»å‹ // æ„é€ å™¨ public ConcreteWebSite(String type) &#123; this.type = type; &#125; @Override public void use(User user) &#123; System.out.println(\"ç½‘ç«™çš„å‘å¸ƒå½¢å¼ä¸º:\" + type + \" ä½¿ç”¨è€…æ˜¯\" + user.getName()); &#125;&#125; // ä½¿ç”¨è€…public class User &#123; private String name; public User(String name) &#123; super(); this.name = name; &#125; // Getter / Setter&#125;// ç½‘ç«™å·¥å‚ç±»ï¼Œæ ¹æ®éœ€è¦è¿”å›ä¸€ä¸ªç›¸åº”çš„ç½‘ç«™public class WebSiteFactory &#123; // é›†åˆï¼šç›¸å½“äºä¸€ä¸ªæ±  private HashMap&lt;String, ConcreteWebSite&gt; pool = new HashMap&lt;&gt;(); // æ ¹æ®ç½‘ç«™çš„ç±»å‹ï¼Œè¿”å›ä¸€ä¸ªç½‘ç«™, å¦‚æœæ²¡æœ‰å°±åˆ›å»ºä¸€ä¸ªç½‘ç«™ï¼Œå¹¶æ”¾å…¥åˆ°æ± ä¸­,å¹¶è¿”å› public WebSite getWebSiteCategory(String type) &#123; if(!pool.containsKey(type)) &#123; // æ— æ­¤ç±»å‹åˆ™åˆ›å»ºä¸€ä¸ªç½‘ç«™ï¼Œå¹¶æ”¾å…¥åˆ°æ± ä¸­ pool.put(type, new ConcreteWebSite(type)); &#125; return (WebSite)pool.get(type); &#125; // è·å–ç½‘ç«™åˆ†ç±»çš„æ€»æ•° public int getWebSiteCount() &#123; return pool.size(); &#125;&#125; JDK-Integer[127,-128]ï¼šæ­¤èŒƒå›´å†…ç›´æ¥ä»æ± è¿”å› ã€‚ äº«å…ƒæ¨¡å¼æé«˜äº†ç³»ç»Ÿçš„å¤æ‚åº¦ã€‚éœ€è¦åˆ†ç¦»å‡ºå†…éƒ¨çŠ¶æ€å’Œå¤–éƒ¨çŠ¶æ€ï¼Œè€Œå¤–éƒ¨çŠ¶æ€å…·æœ‰å›ºåŒ–ç‰¹æ€§ï¼Œä¸åº”è¯¥éšç€å†…éƒ¨çŠ¶æ€çš„æ”¹å˜è€Œæ”¹å˜ï¼Œè¿™æ˜¯æˆ‘ä»¬ä½¿ç”¨äº«å…ƒæ¨¡å¼éœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼›ä½¿ç”¨äº«å…ƒæ¨¡å¼æ—¶ï¼Œæ³¨æ„åˆ’åˆ†å†…éƒ¨çŠ¶æ€å’Œå¤–éƒ¨çŠ¶æ€ï¼Œå¹¶ä¸”éœ€è¦æœ‰ä¸€ä¸ªå·¥å‚ç±»åŠ ä»¥æ§åˆ¶ã€‚ ä»£ç†æ¨¡å¼ä»£ç†æ¨¡å¼ï¼šä¸ºä¸€ä¸ªå¯¹è±¡æä¾›ä¸€ä¸ªæ›¿èº«ï¼Œä»¥æ§åˆ¶å¯¹è¿™ä¸ªå¯¹è±¡çš„è®¿é—®ã€‚å³é€šè¿‡ä»£ç†å¯¹è±¡è®¿é—®ç›®æ ‡å¯¹è±¡ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯å¯ä»¥åœ¨ç›®æ ‡å¯¹è±¡å®ç°çš„åŸºç¡€ä¸Šï¼Œå¢å¼ºé¢å¤–çš„åŠŸèƒ½æ“ä½œï¼Œå³æ‰©å±•ç›®æ ‡å¯¹è±¡çš„åŠŸèƒ½ï¼›è¢«ä»£ç†çš„å¯¹è±¡å¯ä»¥æ˜¯è¿œç¨‹å¯¹è±¡ã€åˆ›å»ºå¼€é”€å¤§çš„å¯¹è±¡æˆ–éœ€è¦å®‰å…¨æ§åˆ¶çš„å¯¹è±¡ï¼› ä»£ç†æ¨¡å¼æœ‰ä¸åŒçš„å½¢å¼, ä¸»è¦æœ‰ä¸‰ç§ï¼š é™æ€ä»£ç† åŠ¨æ€ä»£ç† ï¼ˆJDK ä»£ç†ã€æ¥å£ä»£ç†ï¼‰ Cglib ä»£ç† ï¼ˆå¯ä»¥åœ¨å†…å­˜åŠ¨æ€çš„åˆ›å»ºå¯¹è±¡ï¼Œè€Œä¸éœ€è¦å®ç°æ¥å£ï¼Œ ä»–æ˜¯å±äºåŠ¨æ€ä»£ç†çš„èŒƒç•´ï¼‰ é™æ€ä»£ç†é™æ€ä»£ç†åœ¨ä½¿ç”¨æ—¶ï¼Œéœ€è¦å®šä¹‰æ¥å£æˆ–è€…çˆ¶ç±»ï¼Œè¢«ä»£ç†å¯¹è±¡ï¼ˆå³ç›®æ ‡å¯¹è±¡ï¼‰ä¸ä»£ç†å¯¹è±¡ä¸€èµ·å®ç°ç›¸åŒçš„æ¥å£æˆ–è€…æ˜¯ç»§æ‰¿ç›¸åŒçˆ¶ç±»ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738public class Client &#123; public static void main(String[] args) &#123; // åˆ›å»ºç›®æ ‡å¯¹è±¡ï¼šè¢«ä»£ç†å¯¹è±¡ TeacherDaoImpl teacherDaoImpl = new TeacherDaoImpl(); // åˆ›å»ºä»£ç†å¯¹è±¡, åŒæ—¶å°†è¢«ä»£ç†å¯¹è±¡ä¼ é€’ç»™ä»£ç†å¯¹è±¡ TeacherDaoProxy teacherDaoProxy = new TeacherDaoProxy(teacherDaoImpl); // é€šè¿‡ä»£ç†å¯¹è±¡ï¼Œè°ƒç”¨åˆ°è¢«ä»£ç†å¯¹è±¡çš„æ–¹æ³• // å³ï¼šæ‰§è¡Œçš„æ˜¯ä»£ç†å¯¹è±¡çš„æ–¹æ³•ï¼Œä»£ç†å¯¹è±¡å†å»è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„æ–¹æ³• teacherDaoProxy.teach(); &#125;&#125;// æ¥å£public interface TeacherDao &#123; void teach(); // æˆè¯¾çš„æ–¹æ³•&#125;public class TeacherDaoImpl implements TeacherDao &#123; @Override public void teach() &#123; System.out.println(\" è€å¸ˆæˆè¯¾ä¸­ ã€‚ã€‚ã€‚ã€‚ã€‚\"); &#125;&#125;// ä»£ç†å¯¹è±¡ï¼šé™æ€ä»£ç†public class TeacherDaoProxy implements TeacherDao&#123; private TeacherDao target; // ç›®æ ‡å¯¹è±¡ï¼Œé€šè¿‡æ¥å£æ¥èšåˆ // æ„é€ å™¨ public TeacherDaoProxy(TeacherDao target) &#123; this.target = target; &#125; @Override public void teach() &#123; System.out.println(\"å¼€å§‹ä»£ç† å®ŒæˆæŸäº›æ“ä½œ...\"); // ç›®æ ‡æ–¹æ³•å‰æ“ä½œ target.teach(); // ç›®æ ‡æ–¹æ³• System.out.println(\"æäº¤...\"); // ç›®æ ‡æ–¹æ³•åæ“ä½œ &#125;&#125; åŠ¨æ€ä»£ç†ä»£ç†å¯¹è±¡ä¸éœ€è¦å®ç°æ¥å£ï¼Œä½†æ˜¯ç›®æ ‡å¯¹è±¡è¦å®ç°æ¥å£ï¼Œå¦åˆ™ä¸èƒ½ç”¨åŠ¨æ€ä»£ç†ã€‚ä»£ç†å¯¹è±¡çš„ç”Ÿæˆï¼Œæ˜¯åˆ©ç”¨ JDK çš„ APIï¼ŒåŠ¨æ€çš„åœ¨å†…å­˜ä¸­æ„å»ºä»£ç†å¯¹è±¡ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455public class Client &#123; public static void main(String[] args) &#123; // TODO Auto-generated method stub // åˆ›å»ºç›®æ ‡å¯¹è±¡ TeacherDao target = new TeacherDaoImpl(); // ç»™ç›®æ ‡å¯¹è±¡ï¼Œåˆ›å»ºä»£ç†å¯¹è±¡, å¯ä»¥è½¬æˆ TeacherDao TeacherDao proxyInstance = (TeacherDao)new ProxyFactory(target).getProxyInstance(); // proxyInstance = class com.sun.proxy.$Proxy0 å†…å­˜ä¸­åŠ¨æ€ç”Ÿæˆäº†ä»£ç†å¯¹è±¡ System.out.println(\"proxyInstance=\" + proxyInstance.getClass()); // é€šè¿‡ä»£ç†å¯¹è±¡ï¼Œè°ƒç”¨ç›®æ ‡å¯¹è±¡çš„æ–¹æ³• proxyInstance.teach(); proxyInstance.sayHello(\" tom \"); &#125;&#125;// æ¥å£public interface teacherDao &#123; void teach(); // æˆè¯¾æ–¹æ³• void sayHello(String name);&#125;public class ProxyFactory &#123; // ç»´æŠ¤ä¸€ä¸ªç›®æ ‡å¯¹è±¡ , Object private Object target; // æ„é€ å™¨ï¼šå¯¹ target è¿›è¡Œåˆå§‹åŒ– public ProxyFactory(Object target) &#123; this.target = target; &#125; // ç»™ç›®æ ‡å¯¹è±¡ ç”Ÿæˆä¸€ä¸ªä»£ç†å¯¹è±¡ public Object getProxyInstance() &#123; // ClassLoader loader ï¼š æŒ‡å®šå½“å‰ç›®æ ‡å¯¹è±¡ä½¿ç”¨çš„ç±»åŠ è½½å™¨, è·å–åŠ è½½å™¨çš„æ–¹æ³•å›ºå®š // Class&lt;?&gt;[] interfaces: ç›®æ ‡å¯¹è±¡å®ç°çš„æ¥å£ç±»å‹ï¼Œä½¿ç”¨æ³›å‹æ–¹æ³•ç¡®è®¤ç±»å‹ // InvocationHandler h : äº‹æƒ…å¤„ç†ï¼Œæ‰§è¡Œç›®æ ‡å¯¹è±¡çš„æ–¹æ³•æ—¶ï¼Œä¼šè§¦å‘äº‹æƒ…å¤„ç†å™¨æ–¹æ³•, ä¼šæŠŠå½“å‰æ‰§è¡Œ return Proxy.newProxyInstance(target.getClass().getClassLoader(), target.getClass().getInterfaces(), new InvocationHandler() &#123; @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123; System.out.println(\"JDK ä»£ç†å¼€å§‹\"); //åå°„æœºåˆ¶è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„æ–¹æ³• Object returnVal = method.invoke(target, args); System.out.println(\"JDK ä»£ç†æäº¤\"); return returnVal; &#125; &#125;); &#125;&#125;public class TeacherDaoImpl implements TeacherDao &#123; @Override public void teach() &#123; System.out.println(\" è€å¸ˆæˆè¯¾ä¸­... \"); &#125; @Override public void sayHello(String name) &#123; System.out.println(\"hello \" + name); &#125;&#125; Cglib ä»£ç†æ¨¡å¼é™æ€ä»£ç†å’Œ JDK ä»£ç†æ¨¡å¼éƒ½è¦æ±‚ç›®æ ‡å¯¹è±¡æ˜¯å®ç°ä¸€ä¸ªæ¥å£,ä½†æ˜¯æœ‰æ—¶å€™ç›®æ ‡å¯¹è±¡åªæ˜¯ä¸€ä¸ªå•ç‹¬çš„å¯¹è±¡ï¼Œå¹¶æ²¡æœ‰å®ç°ä»»ä½•çš„æ¥å£ï¼Œè¿™ä¸ªæ—¶å€™å¯ä½¿ç”¨ç›®æ ‡å¯¹è±¡å­ç±»æ¥å®ç°ä»£ç†ï¼Œè¿™ç§æ¨¡å¼å°±æ˜¯ Cglib ä»£ç†ã€‚Cglib ä»£ç†ä¹Ÿå«ä½œå­ç±»ä»£ç†ï¼Œå®ƒæ˜¯åœ¨å†…å­˜ä¸­æ„å»ºä¸€ä¸ªå­ç±»å¯¹è±¡ä»è€Œå®ç°å¯¹ç›®æ ‡å¯¹è±¡åŠŸèƒ½æ‰©å±•ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546public class Client &#123; public static void main(String[] args) &#123; // åˆ›å»ºç›®æ ‡å¯¹è±¡ TeacherDao target = new TeacherDao(); // è·å–åˆ°ä»£ç†å¯¹è±¡ï¼Œå¹¶ä¸”å°†ç›®æ ‡å¯¹è±¡ä¼ é€’ç»™ä»£ç†å¯¹è±¡ TeacherDao proxyInstance = (TeacherDao)new ProxyFactory(target).getProxyInstance(); // æ‰§è¡Œä»£ç†å¯¹è±¡çš„æ–¹æ³•ï¼Œè§¦å‘ intercept æ–¹æ³•ï¼Œä»è€Œå®ç°å¯¹ç›®æ ‡å¯¹è±¡çš„è°ƒç”¨ String res = proxyInstance.teach(); System.out.println(\"res=\" + res); &#125;&#125;public class ProxyFactory implements MethodInterceptor &#123; // ç»´æŠ¤ä¸€ä¸ªç›®æ ‡å¯¹è±¡ private Object target; // æ„é€ å™¨ï¼Œä¼ å…¥ä¸€ä¸ªè¢«ä»£ç†çš„å¯¹è±¡ public ProxyFactory(Object target) &#123; this.target = target; &#125; // è¿”å›ä¸€ä¸ªä»£ç†å¯¹è±¡: æ˜¯ target å¯¹è±¡çš„ä»£ç†å¯¹è±¡ public Object getProxyInstance() &#123; // åˆ›å»ºä¸€ä¸ªå·¥å…·ç±» Enhancer enhancer = new Enhancer(); // è®¾ç½®çˆ¶ç±» enhancer.setSuperclass(target.getClass()); // è®¾ç½®å›è°ƒå‡½æ•° enhancer.setCallback(this); // åˆ›å»ºå­ç±»å¯¹è±¡ï¼Œå³ä»£ç†å¯¹è±¡ return enhancer.create(); &#125; // é‡å†™ intercept æ–¹æ³•ï¼Œä¼šè°ƒç”¨ç›®æ ‡å¯¹è±¡çš„æ–¹æ³• @Override public Object intercept(Object arg0, Method method, Object[] args, MethodProxy arg3) throws Throwable &#123; System.out.println(\"Cglib ä»£ç†æ¨¡å¼å¼€å§‹\"); Object returnVal = method.invoke(target, args); System.out.println(\"Cglib ä»£ç†æ¨¡å¼æäº¤\"); return returnVal; &#125;&#125;public class TeacherDao &#123; public String teach() &#123; System.out.println(\" è€å¸ˆæˆè¯¾ä¸­ï¼Œcglib ä»£ç†ä¸éœ€è¦å®ç°æ¥å£ \"); return \"hello\"; &#125;&#125; å¸¸ç”¨å˜ä½“ é˜²ç«å¢™ä»£ç†ï¼šå†…ç½‘é€šè¿‡ä»£ç†ç©¿é€é˜²ç«å¢™ï¼Œå®ç°å¯¹å…¬ç½‘çš„è®¿é—®; ç¼“å­˜ä»£ç†ï¼šæ¯”å¦‚ï¼šå½“è¯·æ±‚å›¾ç‰‡æ–‡ä»¶ç­‰èµ„æºæ—¶ï¼Œå…ˆåˆ°ç¼“å­˜ä»£ç†å–ï¼Œå¦‚æœå–åˆ°èµ„æºåˆ™ okï¼Œå¦‚æœå–ä¸åˆ°èµ„æºï¼Œå†åˆ°å…¬ç½‘æˆ–è€…æ•°æ®åº“å–ï¼Œç„¶åç¼“å­˜ï¼› è¿œç¨‹ä»£ç†è¿œç¨‹å¯¹è±¡çš„æœ¬åœ°ä»£è¡¨ï¼Œé€šè¿‡å®ƒå¯ä»¥æŠŠè¿œç¨‹å¯¹è±¡å½“æœ¬åœ°å¯¹è±¡æ¥è°ƒç”¨ã€‚è¿œç¨‹ä»£ç†é€šè¿‡ç½‘ç»œå’ŒçœŸæ­£çš„è¿œç¨‹å¯¹è±¡æ²Ÿé€šä¿¡æ¯ï¼› åŒæ­¥ä»£ç†ï¼šä¸»è¦ä½¿ç”¨åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ï¼Œå®Œæˆå¤šçº¿ç¨‹é—´åŒæ­¥å·¥ä½œã€‚ è¡Œä¸ºå‹æ¨¡å¼æ¨¡æ¿æ–¹æ³•æ¨¡å¼å®šä¹‰ä¸€ä¸ªæ“ä½œä¸­çš„ç®—æ³•çš„éª¨æ¶ï¼Œè€Œå°†ä¸€äº›æ­¥éª¤å»¶è¿Ÿåˆ°å­ç±»ä¸­ï¼Œä½¿å¾—å­ç±»å¯ä»¥ä¸æ”¹å˜ä¸€ä¸ªç®—æ³•çš„ç»“æ„ï¼Œå°±å¯ä»¥é‡å®šä¹‰è¯¥ç®—æ³•çš„æŸäº›ç‰¹å®šæ­¥éª¤ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748public class Client &#123; public static void main(String[] args) &#123; // åˆ¶ä½œçº¢è±†è±†æµ† System.out.println(\"---åˆ¶ä½œçº¢è±†è±†æµ†---\"); SoyaMilk redBeanSoyaMilk = new RedBeanSoyaMilk(); redBeanSoyaMilk.make(); System.out.println(\"---åˆ¶ä½œèŠ±ç”Ÿè±†æµ†---\"); SoyaMilk peanutSoyaMilk = new PeanutSoyaMilk(); peanutSoyaMilk.make(); &#125;&#125;// æŠ½è±¡ç±»ï¼Œè¡¨ç¤ºè±†æµ†public abstract class SoyaMilk &#123; // final ç±»å‹çš„æ¨¡æ¿æ–¹æ³•ï¼šé˜²æ­¢å­ç±»è¦†ç›– final void make() &#123; select(); addCondiments(); soak(); beat(); &#125; // é€‰ææ–™ void select() &#123; System.out.println(\"ç¬¬ä¸€æ­¥ï¼šé€‰æ‹©å¥½çš„æ–°é²œé»„è±†\"); &#125; // æ·»åŠ ä¸åŒçš„é…æ–™ï¼šæŠ½è±¡æ–¹æ³•ç”±å­ç±»å…·ä½“å®ç° abstract void addCondiments(); // æµ¸æ³¡ void soak() &#123; System.out.println(\"ç¬¬ä¸‰æ­¥ï¼šé»„è±†å’Œé…æ–™å¼€å§‹æµ¸æ³¡ï¼ˆ3å°æ—¶ï¼‰\"); &#125; void beat() &#123; System.out.println(\"ç¬¬å››æ­¥ï¼šé»„è±†å’Œé…æ–™æ”¾åˆ°è±†æµ†æœºå»æ‰“ç¢\"); &#125;&#125;public class PeanutSoyaMilk extends SoyaMilk &#123; @Override void addCondiments() &#123; System.out.println(\" åŠ å…¥ä¸Šå¥½çš„èŠ±ç”Ÿ \"); &#125;&#125;public class RedBeanSoyaMilk extends SoyaMilk &#123; @Override void addCondiments() &#123; System.out.println(\" åŠ å…¥ä¸Šå¥½çš„çº¢è±† \"); &#125;&#125; é’©å­æ–¹æ³•1234567891011121314151617181920212223242526272829//æŠ½è±¡ç±»ï¼Œè¡¨ç¤ºè±†æµ†public abstract class SoyaMilk &#123; final void make() &#123; select(); // é’©å­ if(customerWantCondiments()) &#123; addCondiments(); &#125; soak(); beat(); &#125; // é€‰ææ–™ void select() &#123; System.out.println(\"ç¬¬ä¸€æ­¥ï¼šé€‰æ‹©å¥½çš„æ–°é²œé»„è±†\"); &#125; // é’©å­ï¼šæ·»åŠ ä¸åŒçš„é…æ–™ï¼šæŠ½è±¡æ–¹æ³•ç”±å­ç±»å…·ä½“å®ç° abstract void addCondiments(); // æµ¸æ³¡ void soak() &#123; System.out.println(\"ç¬¬ä¸‰æ­¥ï¼šé»„è±†å’Œé…æ–™å¼€å§‹æµ¸æ³¡ï¼ˆ3å°æ—¶ï¼‰\"); &#125; void beat() &#123; System.out.println(\"ç¬¬å››æ­¥ï¼šé»„è±†å’Œé…æ–™æ”¾åˆ°è±†æµ†æœºå»æ‰“ç¢\"); &#125; // é’©å­æ–¹æ³•ï¼šå†³å®šæ˜¯å¦éœ€è¦æ·»åŠ é…æ–™ boolean customerWantCondiments() &#123; return true; &#125;&#125; Spring å‘½ä»¤æ¨¡å¼å‘½ä»¤æ¨¡å¼ï¼ˆCommand Patternï¼‰ï¼šåœ¨è½¯ä»¶è®¾è®¡ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦å‘æŸäº›å¯¹è±¡å‘é€è¯·æ±‚ï¼Œä½†æ˜¯å¹¶ä¸çŸ¥é“è¯·æ±‚çš„æ¥æ”¶è€…æ˜¯è°ï¼Œä¹Ÿä¸çŸ¥é“è¢«è¯·æ±‚çš„æ“ä½œæ˜¯å“ªä¸ªï¼Œåªéœ€åœ¨ç¨‹åºè¿è¡Œæ—¶æŒ‡å®šå…·ä½“çš„è¯·æ±‚æ¥æ”¶è€…å³å¯ï¼Œæ­¤æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤æ¨¡å¼æ¥è¿›è¡Œè®¾è®¡ã€‚ å‘½åæ¨¡å¼ä½¿å¾—è¯·æ±‚å‘é€è€…ä¸è¯·æ±‚æ¥æ”¶è€…æ¶ˆé™¤å½¼æ­¤ä¹‹é—´çš„è€¦åˆï¼Œè®©å¯¹è±¡ä¹‹é—´çš„è°ƒç”¨å…³ç³»æ›´åŠ çµæ´»ï¼Œå®ç°è§£è€¦ã€‚è¯·æ±‚å‘èµ·è€…å’Œè¯·æ±‚æ‰§è¡Œè€…ä¹‹é—´çš„è§£è€¦æ˜¯é€šè¿‡å‘½ä»¤å¯¹è±¡å®ç°çš„ï¼Œå‘½ä»¤å¯¹è±¡èµ·åˆ°äº†çº½å¸¦æ¡¥æ¢çš„ä½œç”¨ã€‚ åœ¨å‘½åæ¨¡å¼ä¸­ï¼Œä¼šå°†ä¸€ä¸ªè¯·æ±‚å°è£…ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œä»¥ä¾¿ä½¿ç”¨ä¸åŒå‚æ•°æ¥è¡¨ç¤ºä¸åŒçš„è¯·æ±‚(å³å‘½å)ï¼ŒåŒæ—¶å‘½ä»¤æ¨¡å¼ä¹Ÿæ”¯æŒå¯æ’¤é”€çš„æ“ä½œã€‚ ç©ºå‘½ä»¤ä¹Ÿæ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œå®ƒä¸ºæˆ‘ä»¬çœå»äº†åˆ¤ç©ºçš„æ“ä½œã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128public class Client &#123; public static void main(String[] args) &#123; // ä½¿ç”¨å‘½ä»¤è®¾è®¡æ¨¡å¼ï¼Œå®Œæˆé€šè¿‡é¥æ§å™¨å¯¹ç”µç¯è¿›è¡Œæ“ä½œ // åˆ›å»ºç”µç¯çš„å¯¹è±¡ï¼šæ¥å—è€… LightReceiver lightReceiver = new LightReceiver(); // åˆ›å»ºç”µç¯ç›¸å…³çš„å¼€å…³å‘½ä»¤ LightOnCommand lightOnCommand = new LightOnCommand(lightReceiver); LightOffCommand lightOffCommand = new LightOffCommand(lightReceiver); // éœ€è¦ä¸€ä¸ªé¥æ§å™¨ï¼šè°ƒç”¨è€… RemoteController remoteController = new RemoteController(); // ç»™æˆ‘ä»¬çš„é¥æ§å™¨è®¾ç½®å‘½ä»¤, æ¯”å¦‚ no = 0 æ˜¯ç”µç¯çš„å¼€å’Œå…³çš„æ“ä½œ remoteController.setCommand(0, lightOnCommand, lightOffCommand); System.out.println(\"---æŒ‰ä¸‹ç¯çš„å¼€æŒ‰é’®---\"); remoteController.onButtonWasPushed(0); System.out.println(\"---æŒ‰ä¸‹ç¯çš„å…³æŒ‰é’®---\"); remoteController.offButtonWasPushed(0); System.out.println(\"---æŒ‰ä¸‹æ’¤é”€æŒ‰é’®---\"); remoteController.undoButtonWasPushed(); &#125;&#125;// åˆ›å»ºå‘½ä»¤æ¥å£public interface Command &#123; // æ‰§è¡ŒåŠ¨ä½œ(æ“ä½œ) public void execute(); // æ’¤é”€åŠ¨ä½œ(æ“ä½œ) public void undo();&#125;// æ¥æ”¶è€…public class LightReceiver &#123; public void on() &#123; System.out.println(\" ç”µç¯æ‰“å¼€äº†... \"); &#125; public void off() &#123; System.out.println(\" ç”µç¯å…³é—­äº†... \"); &#125;&#125;// ç”µç¯æ“ä½œå‘½ä»¤å…·ä½“å®ç°public class LightOffCommand implements Command &#123; // èšåˆ LightReceiverï¼šæ¥æ”¶è€… LightReceiver light; // æ„é€ å™¨ public LightOffCommand(LightReceiver light) &#123; super(); this.light = light; &#125; @Override public void execute() &#123; // è°ƒç”¨æ¥æ”¶è€…çš„æ–¹æ³• light.off(); &#125; @Override public void undo() &#123; // è°ƒç”¨æ¥æ”¶è€…çš„æ–¹æ³• light.on(); &#125;&#125;public class LightOnCommand implements Command &#123; // èšåˆ LightReceiver LightReceiver light; // æ„é€ å™¨ public LightOnCommand(LightReceiver light) &#123; super(); this.light = light; &#125; @Override public void execute() &#123; // è°ƒç”¨æ¥æ”¶è€…çš„æ–¹æ³• light.on(); &#125; @Override public void undo() &#123; // è°ƒç”¨æ¥æ”¶è€…çš„æ–¹æ³• light.off(); &#125;&#125;// ç©ºå‘½ä»¤æ¨¡å¼public class NoCommand implements Command &#123; @Override public void execute() &#123; &#125; @Override public void undo() &#123; &#125;&#125;public class RemoteController &#123; // å¼€æŒ‰é’®çš„å‘½ä»¤æ•°ç»„ Command[] onCommands; Command[] offCommands; // æ‰§è¡Œæ’¤é”€çš„å‘½ä»¤ Command undoCommand; // æ„é€ å™¨ï¼Œå®Œæˆå¯¹æŒ‰é’®åˆå§‹åŒ– public RemoteController() &#123; onCommands = new Command[5]; offCommands = new Command[5]; for (int i = 0; i &lt; 5; i++) &#123; onCommands[i] = new NoCommand(); offCommands[i] = new NoCommand(); &#125; &#125; // ç»™æˆ‘ä»¬çš„æŒ‰é’®è®¾ç½®ä½ éœ€è¦çš„å‘½ä»¤ public void setCommand(int no, Command onCommand, Command offCommand) &#123; onCommands[no] = onCommand; offCommands[no] = offCommand; &#125; // æŒ‰ä¸‹å¼€æŒ‰é’® public void onButtonWasPushed(int no) &#123; // no 0 // æ‰¾åˆ°ä½ æŒ‰ä¸‹çš„å¼€çš„æŒ‰é’®ï¼Œ å¹¶è°ƒç”¨å¯¹åº”æ–¹æ³• onCommands[no].execute(); // è®°å½•è¿™æ¬¡çš„æ“ä½œï¼Œç”¨äºæ’¤é”€ undoCommand = onCommands[no]; &#125; // æŒ‰ä¸‹å¼€æŒ‰é’® public void offButtonWasPushed(int no) &#123; // no 0 // æ‰¾åˆ°ä½ æŒ‰ä¸‹çš„å…³çš„æŒ‰é’®ï¼Œ å¹¶è°ƒç”¨å¯¹åº”æ–¹æ³• offCommands[no].execute(); // è®°å½•è¿™æ¬¡çš„æ“ä½œï¼Œç”¨äºæ’¤é”€ undoCommand = offCommands[no]; &#125; // æŒ‰ä¸‹æ’¤é”€æŒ‰é’® public void undoButtonWasPushed() &#123; undoCommand.undo(); &#125;&#125; è®¿é—®è€…æ¨¡å¼è®¿é—®è€…æ¨¡å¼ï¼ˆVisitor Patternï¼‰ï¼Œå°è£…ä¸€äº›ä½œç”¨äºæŸç§æ•°æ®ç»“æ„çš„å„å…ƒç´ çš„æ“ä½œï¼Œå®ƒå¯ä»¥åœ¨ä¸æ”¹å˜æ•°æ®ç»“æ„çš„å‰æä¸‹å®šä¹‰ä½œç”¨äºè¿™äº›å…ƒç´ çš„æ–°çš„æ“ä½œã€‚å…¶åšæ³•ä¸»è¦å°†æ•°æ®ç»“æ„ä¸æ•°æ®æ“ä½œåˆ†ç¦»ï¼Œè§£å†³æ•°æ®ç»“æ„å’Œæ“ä½œè€¦åˆæ€§é—®é¢˜ï¼Œå…¶åŸºæœ¬åŸç†æ˜¯åœ¨è¢«è®¿é—®çš„ç±»é‡Œé¢åŠ ä¸€ä¸ªå¯¹å¤–æä¾›æ¥å¾…è®¿é—®è€…çš„æ¥å£ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495public class Client &#123; public static void main(String[] args) &#123; // åˆ›å»º ObjectStructureï¼šæšä¸¾å…ƒç´ ï¼Œç”¨æ¥å…è®¸è®¿é—®è€…è®¿é—®å…ƒç´  ObjectStructure objectStructure = new ObjectStructure(); // åŒåˆ†æ´¾ï¼š1.åˆ†æ´¾è®¿é—®è€… objectStructure.attach(new Man()); objectStructure.attach(new Woman()); // æˆåŠŸ 2.æ ¹æ®è®¿é—®è€…åˆ†å‘ä»»åŠ¡ Success success = new Success(); objectStructure.display(success); System.out.println(\"=======\"); Fail fail = new Fail(); objectStructure.display(fail); System.out.println(\"===å¾…å®šæµ‹è¯„===\"); Wait wait = new Wait(); objectStructure.display(wait); &#125;&#125;// æ•°æ®ç»“æ„ï¼Œç®¡ç† Man Womanpublic class ObjectStructure &#123; // ç»´æŠ¤äº†ä¸€ä¸ªé›†åˆ private List&lt;Person&gt; persons = new LinkedList&lt;&gt;(); // å¢åŠ  Element public void attach(Person p) &#123; persons.add(p); &#125; // ç§»é™¤ Element public void detach(Person p) &#123; persons.remove(p); &#125; // æ˜¾ç¤ºæµ‹è¯„æƒ…å†µ public void display(Action action) &#123; for(Person p: persons) &#123; p.accept(action); &#125; &#125;&#125;// Elementpublic abstract class Person &#123; public abstract void accept(Action action);&#125;public class Man extends Person &#123; @Override public void accept(Action action) &#123; action.getManResult(this); &#125;&#125;public class Woman extends Person&#123; @Override public void accept(Action action) &#123; action.getWomanResult(this); &#125;&#125;// Visitorï¼šä¸º Element æä¾›å…·ä½“æ“ä½œpublic abstract class Action &#123; // ç”·æ€§è¯„ä»· public abstract void getManResult(Man man); // å¥³æ€§è¯„ä»· public abstract void getWomanResult(Woman woman);&#125;public class Success extends Action &#123; @Override public void getManResult(Man man) &#123; System.out.println(\" ç”·äººç»™å¥½è¯„ !\"); &#125; @Override public void getWomanResult(Woman woman) &#123; System.out.println(\" å¥³äººç»™å¥½è¯„ !\"); &#125;&#125;public class Fail extends Action &#123; @Override public void getManResult(Man man) &#123; System.out.println(\" ç”·äººç»™å·®è¯„ !\"); &#125; @Override public void getWomanResult(Woman woman) &#123; System.out.println(\" å¥³äººç»™å·®è¯„ !\"); &#125;&#125;public class Wait extends Action &#123; @Override public void getManResult(Man man) &#123; System.out.println(\" ç”·äººç»™çš„è¯„ä»·æ˜¯è¯¥æ­Œæ‰‹å¾…å®š \"); &#125; @Override public void getWomanResult(Woman woman) &#123; System.out.println(\" å¥³äººç»™çš„è¯„ä»·æ˜¯è¯¥æ­Œæ‰‹å¾…å®š \"); &#125;&#125; è¿­ä»£å™¨æ¨¡å¼è¿­ä»£å™¨æ¨¡å¼ï¼Œæä¾›ä¸€ç§éå†é›†åˆå…ƒç´ çš„ç»Ÿä¸€æ¥å£ï¼Œç”¨ä¸€è‡´çš„æ–¹æ³•éå†é›†åˆå…ƒç´ ï¼Œä¸éœ€è¦çŸ¥é“é›†åˆå¯¹è±¡çš„åº•å±‚è¡¨ç¤ºï¼Œå³ï¼šä¸æš´éœ²å…¶å†…éƒ¨çš„ç»“æ„ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163public class Client &#123; public static void main(String[] args) &#123; // åˆ›å»ºå­¦é™¢ List&lt;College&gt; collegeList = new ArrayList&lt;College&gt;(); ComputerCollege computerCollege = new ComputerCollege(); InfoCollege infoCollege = new InfoCollege(); collegeList.add(computerCollege); collegeList.add(infoCollege); OutPutImpl outPutImpl = new OutPutImpl(collegeList); outPutImpl.printCollege(); &#125;&#125;// æ¥å£public interface College &#123; public String getName(); // æ·»åŠ ç³» public void addDepartment(String name, String desc); // è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ public Iterator createIterator();&#125;// ç³»public class Department &#123; private String name; private String desc; public Department(String name, String desc) &#123; super(); this.name = name; this.desc = desc; &#125; // Getter / Setter&#125;public class ComputerCollege implements College &#123; Department[] departments; int numOfDepartment = 0 ; // ä¿å­˜å½“å‰æ•°ç»„çš„å¯¹è±¡ä¸ªæ•° public ComputerCollege() &#123; departments = new Department[5]; addDepartment(\"Java ä¸“ä¸š\", \" Java ä¸“ä¸š \"); addDepartment(\"PHP ä¸“ä¸š\", \" PHP ä¸“ä¸š \"); addDepartment(\"å¤§æ•°æ®ä¸“ä¸š\", \" å¤§æ•°æ®ä¸“ä¸š \"); &#125; @Override public String getName() &#123; return \"è®¡ç®—æœºå­¦é™¢\"; &#125; @Override public void addDepartment(String name, String desc) &#123; Department department = new Department(name, desc); departments[numOfDepartment] = department; numOfDepartment += 1; &#125; @Override public Iterator createIterator() &#123; // å®ç°äº†æ•°æ®å…±äº« return new ComputerCollegeIterator(departments); &#125;&#125;public class ComputerCollegeIterator implements Iterator &#123; Department[] departments; int position = 0; // éå†çš„ä½ç½® public ComputerCollegeIterator(Department[] departments) &#123; this.departments = departments; &#125; //åˆ¤æ–­æ˜¯å¦è¿˜æœ‰ä¸‹ä¸€ä¸ªå…ƒç´  @Override public boolean hasNext() &#123; if(position &gt;= departments.length || departments[position] == null) &#123; return false; &#125;else &#123; return true; &#125; &#125; @Override public Object next() &#123; Department department = departments[position]; position += 1; return department; &#125; // åˆ é™¤çš„æ–¹æ³•ï¼Œé»˜è®¤ç©ºå®ç° public void remove() &#123; &#125;&#125;public class InfoCollege implements College &#123; List&lt;Department&gt; departmentList; public InfoCollege() &#123; departmentList = new ArrayList&lt;Department&gt;(); addDepartment(\"ä¿¡æ¯å®‰å…¨ä¸“ä¸š\", \" ä¿¡æ¯å®‰å…¨ä¸“ä¸š \"); addDepartment(\"ç½‘ç»œå®‰å…¨ä¸“ä¸š\", \" ç½‘ç»œå®‰å…¨ä¸“ä¸š \"); addDepartment(\"æœåŠ¡å™¨å®‰å…¨ä¸“ä¸š\", \" æœåŠ¡å™¨å®‰å…¨ä¸“ä¸š \"); &#125; @Override public String getName() &#123; // TODO Auto-generated method stub return \"ä¿¡æ¯å·¥ç¨‹å­¦é™¢\"; &#125; @Override public void addDepartment(String name, String desc) &#123; // TODO Auto-generated method stub Department department = new Department(name, desc); departmentList.add(department); &#125; @Override public Iterator createIterator() &#123; return new InfoColleageIterator(departmentList); &#125;&#125;public class InfoColleageIterator implements Iterator &#123; List&lt;Department&gt; departmentList; // ä¿¡æ¯å·¥ç¨‹å­¦é™¢æ˜¯ä»¥ List æ–¹å¼å­˜æ”¾ç³» int index = -1; // ç´¢å¼• public InfoColleageIterator(List&lt;Department&gt; departmentList) &#123; this.departmentList = departmentList; &#125; // åˆ¤æ–­ list ä¸­è¿˜æœ‰æ²¡æœ‰ä¸‹ä¸€ä¸ªå…ƒç´  @Override public boolean hasNext() &#123; if(index &gt;= departmentList.size() - 1) &#123; return false; &#125; else &#123; index += 1; return true; &#125; &#125; @Override public Object next() &#123; return departmentList.get(index); &#125; // é»˜è®¤ public void remove() &#123; &#125;&#125;public class OutPutImpl &#123; // å­¦é™¢é›†åˆ List&lt;College&gt; collegeList; public OutPutImpl(List&lt;College&gt; collegeList) &#123; this.collegeList = collegeList; &#125; // éå†æ‰€æœ‰å­¦é™¢,ç„¶åè°ƒç”¨ printDepartment è¾“å‡ºå„ä¸ªå­¦é™¢çš„ç³» public void printCollege() &#123; // ä» collegeList å–å‡ºæ‰€æœ‰å­¦é™¢, Java ä¸­çš„ List å·²ç»å®ç° Iterator Iterator&lt;College&gt; iterator = collegeList.iterator(); while(iterator.hasNext()) &#123; // å–å‡ºä¸€ä¸ªå­¦é™¢ College college = iterator.next(); System.out.println(\"=== \"+college.getName() +\"====\" ); printDepartment(college.createIterator()); // å¾—åˆ°å¯¹åº”è¿­ä»£å™¨ &#125; &#125; // è¾“å‡ºå­¦é™¢ï¼Œè¾“å‡ºç³» public void printDepartment(Iterator iterator) &#123; while(iterator.hasNext()) &#123; Department d = (Department)iterator.next(); System.out.println(d.getName()); &#125; &#125;&#125; JDK-ArrayList æä¾›äº†ä¸€ç§è®¾è®¡æ€æƒ³ï¼Œå°±æ˜¯ä¸€ä¸ªç±»åº”è¯¥åªæœ‰ä¸€ä¸ªå¼•èµ·å˜åŒ–çš„åŸå› ï¼ˆå«åšå•ä¸€è´£ä»»åŸåˆ™ï¼‰ã€‚åœ¨èšåˆç±»ä¸­ï¼Œæˆ‘ä»¬æŠŠè¿­ä»£å™¨åˆ†å¼€ï¼Œå°±æ˜¯è¦æŠŠç®¡ç†å¯¹è±¡é›†åˆå’Œéå†å¯¹è±¡é›†åˆçš„è´£ä»»åˆ†å¼€ï¼Œè¿™æ ·ä¸€æ¥é›†åˆæ”¹å˜çš„è¯ï¼Œåªå½±å“åˆ°èšåˆå¯¹è±¡ã€‚è€Œå¦‚æœéå†æ–¹å¼æ”¹å˜çš„è¯ï¼Œåªå½±å“åˆ°äº†è¿­ä»£å™¨ã€‚ è§‚å¯Ÿè€…æ¨¡å¼è§‚å¯Ÿè€…æ¨¡å¼ï¼šå¯¹è±¡ä¹‹é—´å¤šå¯¹ä¸€ä¾èµ–çš„ä¸€ç§è®¾è®¡æ–¹æ¡ˆï¼Œè¢«ä¾èµ–çš„å¯¹è±¡ä¸º Subjectï¼Œä¾èµ–çš„å¯¹è±¡ä¸º Observerï¼ŒSubject é€šçŸ¥ Observer å˜åŒ–ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127public class Client &#123; public static void main(String[] args) &#123; // åˆ›å»ºä¸€ä¸ª WeatherData WeatherData weatherData = new WeatherData(); // åˆ›å»ºè§‚å¯Ÿè€… CurrentConditions currentConditions = new CurrentConditions(); BaiduSite baiduSite = new BaiduSite(); // æ³¨å†Œåˆ° weatherData weatherData.registerObserver(currentConditions); weatherData.registerObserver(baiduSite); // æµ‹è¯• System.out.println(\"é€šçŸ¥å„ä¸ªæ³¨å†Œçš„è§‚å¯Ÿè€…, çœ‹çœ‹ä¿¡æ¯\"); weatherData.setData(10f, 100f, 30.3f); weatherData.removeObserver(currentConditions); // æµ‹è¯• System.out.println(); System.out.println(\"é€šçŸ¥å„ä¸ªæ³¨å†Œçš„è§‚å¯Ÿè€…, çœ‹çœ‹ä¿¡æ¯\"); weatherData.setData(10f, 100f, 30.3f); &#125;&#125;// è§‚å¯Ÿè€…æ¥å£public interface Observer &#123; public void update(float temperature, float pressure, float humidity);&#125;public class BaiduSite implements Observer &#123; // æ¸©åº¦ï¼Œæ°”å‹ï¼Œæ¹¿åº¦ private float temperature; private float pressure; private float humidity; // æ›´æ–°å¤©æ°”æƒ…å†µï¼šWeatherData è°ƒç”¨ï¼ˆæ¨é€æ¨¡å¼ï¼‰ public void update(float temperature, float pressure, float humidity) &#123; this.temperature = temperature; this.pressure = pressure; this.humidity = humidity; display(); &#125; // æ˜¾ç¤º public void display() &#123; System.out.println(\"===ç™¾åº¦ç½‘ç«™===\"); System.out.println(\"***ç™¾åº¦ç½‘ç«™ æ°”æ¸© : \" + temperature + \"***\"); System.out.println(\"***ç™¾åº¦ç½‘ç«™ æ°”å‹: \" + pressure + \"***\"); System.out.println(\"***ç™¾åº¦ç½‘ç«™ æ¹¿åº¦: \" + humidity + \"***\"); &#125;&#125;public class CurrentConditions implements Observer &#123; private float temperature; private float pressure; private float humidity; public void update(float temperature, float pressure, float humidity) &#123; this.temperature = temperature; this.pressure = pressure; this.humidity = humidity; display(); &#125; public void display() &#123; System.out.println(\"***Today Temperature: \" + temperature + \"***\"); System.out.println(\"***Today Pressure: \" + pressure + \"***\"); System.out.println(\"***Today Humidity: \" + humidity + \"***\"); &#125;&#125;// æ¥å£, è®© WeatherData æ¥å®ç°public interface Subject &#123; public void registerObserver(Observer o); public void removeObserver(Observer o); public void notifyObservers();&#125;/*** æ ¸å¿ƒç±»* 1. åŒ…å«æœ€æ–°çš„å¤©æ°”æƒ…å†µä¿¡æ¯* 2. å«æœ‰è§‚å¯Ÿè€…é›†åˆï¼Œä½¿ç”¨ ArrayList ç®¡ç†* 3. å½“æ•°æ®æœ‰æ›´æ–°æ—¶ï¼Œå°±ä¸»åŠ¨çš„è°ƒç”¨ ArrayList, é€šçŸ¥æ‰€æœ‰çš„ï¼ˆæ¥å…¥æ–¹ï¼šè§‚å¯Ÿè€…ï¼‰å°±çœ‹åˆ°æœ€æ–°çš„ä¿¡æ¯*/public class WeatherData implements Subject &#123; private float temperatrue; private float pressure; private float humidity; // è§‚å¯Ÿè€…é›†åˆ private ArrayList&lt;Observer&gt; observers; // åŠ å…¥æ–°çš„ç¬¬ä¸‰æ–¹ public WeatherData() &#123; observers = new ArrayList&lt;Observer&gt;(); &#125; public float getTemperature() &#123; return temperatrue; &#125; public float getPressure() &#123; return pressure; &#125; public float getHumidity() &#123; return humidity; &#125; public void dataChange() &#123; // è°ƒç”¨æ¥å…¥æ–¹çš„ update notifyObservers(); &#125; // å½“æ•°æ®æœ‰æ›´æ–°æ—¶ï¼Œå°±è°ƒç”¨ setData public void setData(float temperature, float pressure, float humidity) &#123; this.temperatrue = temperature; this.pressure = pressure; this.humidity = humidity; // è°ƒç”¨ dataChangeï¼Œ å°†æœ€æ–°çš„ä¿¡æ¯æ¨é€ç»™æ¥å…¥æ–¹ currentConditions dataChange(); &#125; // æ³¨å†Œä¸€ä¸ªè§‚å¯Ÿè€… @Override public void registerObserver(Observer o) &#123; observers.add(o); &#125; // ç§»é™¤ä¸€ä¸ªè§‚å¯Ÿè€… @Override public void removeObserver(Observer o) &#123; if(observers.contains(o)) &#123; observers.remove(o); &#125; &#125; // éå†æ‰€æœ‰çš„è§‚å¯Ÿè€…ï¼Œå¹¶é€šçŸ¥ @Override public void notifyObservers() &#123; for(int i = 0; i &lt; observers.size(); i++) &#123; observers.get(i).update(this.temperatrue, this.pressure, this.humidity); &#125; &#125;&#125; è§‚å¯Ÿè€…æ¨¡å¼è®¾è®¡åï¼Œä¼šä»¥é›†åˆçš„æ–¹å¼æ¥ç®¡ç†ç”¨æˆ·ï¼ˆObserverï¼‰ï¼ŒåŒ…æ‹¬æ³¨å†Œï¼Œç§»é™¤å’Œé€šçŸ¥ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å¢åŠ è§‚å¯Ÿè€…ï¼ˆè¿™é‡Œå¯ä»¥ç†è§£æˆä¸€ä¸ªæ–°çš„å…¬å‘Šæ¿ï¼‰å°±ä¸éœ€è¦å»ä¿®æ”¹æ ¸å¿ƒç±» WeatherData ä¸ä¼šä¿®æ”¹ä»£ç ï¼Œéµå®ˆäº† OCP åŸåˆ™ã€‚ ä¸­ä»‹æ¨¡å¼ä¸­ä»‹è€…æ¨¡å¼ï¼ˆMediator Patternï¼‰ï¼Œç”¨ä¸€ä¸ªä¸­ä»‹å¯¹è±¡æ¥å°è£…ä¸€ç³»åˆ—çš„å¯¹è±¡äº¤äº’ã€‚ä¸­ä»‹è€…ä½¿å„ä¸ªå¯¹è±¡ä¸éœ€è¦æ˜¾å¼åœ°ç›¸äº’å¼•ç”¨ï¼Œä»è€Œä½¿å…¶è€¦åˆæ¾æ•£ï¼Œè€Œä¸”å¯ä»¥ç‹¬ç«‹åœ°æ”¹å˜å®ƒä»¬ä¹‹é—´çš„äº¤äº’ã€‚ æ¯”å¦‚ MVC æ¨¡å¼ï¼ŒCï¼ˆController æ§åˆ¶å™¨ï¼‰æ˜¯ Mï¼ˆModel æ¨¡å‹ï¼‰å’Œ Vï¼ˆView è§†å›¾ï¼‰çš„ä¸­ä»‹è€…ï¼Œåœ¨å‰åç«¯äº¤äº’æ—¶èµ·åˆ°äº†ä¸­é—´äººçš„ä½œç”¨ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155public class ClientTest &#123; public static void main(String[] args) &#123; // åˆ›å»ºä¸€ä¸ªä¸­ä»‹è€…å¯¹è±¡ Mediator mediator = new ConcreteMediator(); // åˆ›å»º Alarm å¹¶ä¸”åŠ å…¥åˆ° ConcreteMediator å¯¹è±¡çš„ HashMap Alarm alarm = new Alarm(mediator, \"alarm\"); // åˆ›å»ºäº† CoffeeMachine å¯¹è±¡ï¼Œå¹¶ ä¸”åŠ å…¥åˆ° ConcreteMediator å¯¹è±¡çš„ HashMap CoffeeMachine coffeeMachine = new CoffeeMachine(mediator, \"coffeeMachine\"); // åˆ›å»º Curtains , å¹¶ä¸”åŠ å…¥åˆ° ConcreteMediator å¯¹è±¡çš„ HashMap Curtains curtains = new Curtains(mediator, \"curtains\"); TV tV = new TV(mediator, \"TV\"); // è®©é—¹é’Ÿå‘å‡ºæ¶ˆæ¯ alarm.SendAlarm(0); coffeeMachine.FinishCoffee(); alarm.SendAlarm(1); &#125;&#125;// åŒäº‹æŠ½è±¡ç±»public abstract class Colleague &#123; // æ‰€æœ‰çš„åŒäº‹éƒ½çŸ¥é“ä¸­ä»‹ private Mediator mediator; public String name; public Colleague(Mediator mediator, String name) &#123; this.mediator = mediator; this.name = name; &#125; public Mediator GetMediator() &#123; return this.mediator; &#125; public abstract void SendMessage(int stateChange);&#125;// å…·ä½“çš„åŒäº‹ç±»public class Alarm extends Colleague &#123; // æ„é€ å™¨ public Alarm(Mediator mediator, String name) &#123; super(mediator, name); // åœ¨åˆ›å»º Alarm åŒäº‹å¯¹è±¡æ—¶ï¼Œå°†è‡ªå·±æ³¨å†Œåˆ° ConcreteMediator å¯¹è±¡ä¸­[é›†åˆ] mediator.Register(name, this); &#125; public void SendAlarm(int stateChange) &#123; SendMessage(stateChange); &#125; @Override public void SendMessage(int stateChange) &#123; // è°ƒç”¨çš„ä¸­ä»‹è€…å¯¹è±¡çš„ getMessage this.GetMediator().GetMessage(stateChange, this.name); &#125;&#125;public class CoffeeMachine extends Colleague &#123; public CoffeeMachine(Mediator mediator, String name) &#123; super(mediator, name); mediator.Register(name, this); &#125; @Override public void SendMessage(int stateChange) &#123; this.GetMediator().GetMessage(stateChange, this.name); &#125; public void StartCoffee() &#123; System.out.println(\"It's time to startcoffee!\"); &#125; public void FinishCoffee() &#123; System.out.println(\"After 5 minutes!\"); System.out.println(\"Coffee is ok!\"); SendMessage(0); &#125;&#125;public class TV extends Colleague &#123; public TV(Mediator mediator, String name) &#123; super(mediator, name); mediator.Register(name, this); &#125; @Override public void SendMessage(int stateChange) &#123; this.GetMediator().GetMessage(stateChange, this.name); &#125; public void StartTv() &#123; System.out.println(\"It's time to StartTv!\"); &#125; public void StopTv() &#123; System.out.println(\"StopTv!\"); &#125;&#125;public class Curtains extends Colleague &#123; public Curtains(Mediator mediator, String name) &#123; super(mediator, name); mediator.Register(name, this); &#125; @Override public void SendMessage(int stateChange) &#123; this.GetMediator().GetMessage(stateChange, this.name); &#125; public void UpCurtains() &#123; System.out.println(\"I am holding Up Curtains!\"); &#125;&#125;public abstract class Mediator &#123; // å°†ç»™ä¸­ä»‹è€…å¯¹è±¡åŠ å…¥åˆ°é›†åˆä¸­ public abstract void Register(String colleagueName, Colleague colleague); // æ¥æ”¶æ¶ˆæ¯ï¼šç”±å…·ä½“çš„åŒäº‹å¯¹è±¡å‘å‡º public abstract void GetMessage(int stateChange, String colleagueName); public abstract void SendMessage();&#125;// å…·ä½“çš„ä¸­ä»‹è€…ç±»public class ConcreteMediator extends Mediator &#123; // é›†åˆï¼šæ”¾å…¥æ‰€æœ‰çš„åŒäº‹å¯¹è±¡ private HashMap&lt;String, Colleague&gt; colleagueMap; private HashMap&lt;String, String&gt; interMap; public ConcreteMediator() &#123; colleagueMap = new HashMap&lt;String, Colleague&gt;(); interMap = new HashMap&lt;String, String&gt;(); &#125; @Override public void Register(String colleagueName, Colleague colleague) &#123; colleagueMap.put(colleagueName, colleague); if (colleague instanceof Alarm) &#123; // é™å®šäº†æ¯ç§ç±»å‹æœºå™¨çš„æ•°é‡åªèƒ½æœ‰ä¸€ä¸ªï¼šæœ€æ–°æ³¨å†Œçš„æœºå™¨ interMap.put(\"Alarm\", colleagueName); &#125; else if (colleague instanceof CoffeeMachine) &#123; interMap.put(\"CoffeeMachine\", colleagueName); &#125; else if (colleague instanceof TV) &#123; interMap.put(\"TV\", colleagueName); &#125; else if (colleague instanceof Curtains) &#123; interMap.put(\"Curtains\", colleagueName); &#125; &#125; // å…·ä½“ä¸­ä»‹è€…çš„æ ¸å¿ƒæ–¹æ³• // 1. æ ¹æ®å¾—åˆ°æ¶ˆæ¯ï¼Œå®Œæˆå¯¹åº”ä»»åŠ¡ // 2. ä¸­ä»‹è€…åœ¨è¿™ä¸ªæ–¹æ³•ï¼Œåè°ƒå„ä¸ªå…·ä½“çš„åŒäº‹å¯¹è±¡ï¼Œå®Œæˆä»»åŠ¡ @Override public void GetMessage(int stateChange, String colleagueName) &#123; //å¤„ç†é—¹é’Ÿå‘å‡ºçš„æ¶ˆæ¯ if (colleagueMap.get(colleagueName) instanceof Alarm) &#123; if (stateChange == 0) &#123; ((CoffeeMachine) (colleagueMap.get(interMap.get(\"CoffeeMachine\")))).StartCoffee(); ((TV) (colleagueMap.get(interMap.get(\"TV\")))).StartTv(); &#125; else if (stateChange == 1) &#123; ((TV) (colleagueMap.get(interMap.get(\"TV\")))).StopTv(); &#125; &#125; else if (colleagueMap.get(colleagueName) instanceof CoffeeMachine) &#123; ((Curtains) (colleagueMap.get(interMap.get(\"Curtains\")))).UpCurtains(); &#125; else if (colleagueMap.get(colleagueName) instanceof TV) &#123; // å¦‚æœ TV å‘ç°æ¶ˆæ¯ &#125; else if (colleagueMap.get(colleagueName) instanceof Curtains) &#123; // å¦‚æœ Curtain å‘ç°æ¶ˆæ¯&#125; @Override public void SendMessage() &#123; &#125; &#125;&#125; å¤‡å¿˜å½•æ¨¡å¼å¤‡å¿˜å½•æ¨¡å¼ï¼ˆMemento Patternï¼‰åœ¨ä¸ç ´åå°è£…æ€§çš„å‰æä¸‹ï¼Œæ•è·ä¸€ä¸ªå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ï¼Œå¹¶åœ¨è¯¥å¯¹è±¡ä¹‹å¤–ä¿å­˜è¿™ä¸ªçŠ¶æ€ï¼Œè¿™æ ·ä»¥åå°±å¯å°†è¯¥å¯¹è±¡æ¢å¤åˆ°åŸå…ˆä¿å­˜çš„çŠ¶æ€ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768public class Client &#123; public static void main(String[] args) &#123; // åˆ›å»ºæ¸¸æˆè§’è‰² GameRole gameRole = new GameRole(); gameRole.setVit(100); gameRole.setDef(100); System.out.println(\"å’Œ Boss å¤§æˆ˜å‰çš„çŠ¶æ€\"); gameRole.display(); // æŠŠå½“å‰çŠ¶æ€ä¿å­˜ caretakerï¼šçœ‹å®ˆè€… Caretaker caretaker = new Caretaker(); caretaker.setMemento(gameRole.createMemento()); System.out.println(\"å’Œ Boss å¤§æˆ˜å\"); gameRole.setDef(30); gameRole.setVit(30); gameRole.display(); System.out.println(\"å¤§æˆ˜åï¼Œä½¿ç”¨å¤‡å¿˜å½•å¯¹è±¡æ¢å¤åˆ°æˆ˜æ–—å‰\"); gameRole.recoverGameRoleFromMemento(caretaker.getMemento()); System.out.println(\"æ¢å¤åçš„çŠ¶æ€\"); gameRole.display(); &#125;&#125;// å®ˆæŠ¤è€…å¯¹è±¡, ä¿å­˜æ¸¸æˆè§’è‰²çš„çŠ¶æ€public class Caretaker &#123; // å¦‚æœåªä¿å­˜ä¸€æ¬¡çŠ¶æ€ private Memento memento; // å¯¹ GameRole ä¿å­˜å¤šæ¬¡çŠ¶æ€ // private ArrayList&lt;Memento&gt; mementos; // å¯¹å¤šä¸ªæ¸¸æˆè§’è‰²ä¿å­˜å¤šä¸ªçŠ¶æ€ // private HashMap&lt;String, ArrayList&lt;Memento&gt;&gt; rolesMementos; public Memento getMemento() &#123; return memento; &#125; public void setMemento(Memento memento) &#123; this.memento = memento; &#125;&#125;public class Memento &#123; private int vit; private int def; public Memento(int vit, int def) &#123; super(); this.vit = vit; this.def = def; &#125; // Getter / Setter&#125;public class GameRole &#123; private int vit; private int def; // åˆ›å»º Mementoï¼šå³æ ¹æ®å½“å‰çš„çŠ¶æ€å¾—åˆ° Memento public Memento createMemento() &#123; return new Memento(vit, def); &#125; // å¤‡å¿˜å½•å¯¹è±¡æ¢å¤ GameRole çš„çŠ¶æ€ public void recoverGameRoleFromMemento(Memento memento) &#123; this.vit = memento.getVit(); this.def = memento.getDef(); &#125; // æ˜¾ç¤ºå½“å‰æ¸¸æˆè§’è‰²çš„çŠ¶æ€ public void display() &#123; System.out.println(\"æ¸¸æˆè§’è‰²å½“å‰çš„æ”»å‡»åŠ›ï¼š\" + this.vit + \" é˜²å¾¡åŠ›: \" + this.def); &#125; // Getter / Setter&#125; è§£é‡Šå™¨æ¨¡å¼ç»™å®šä¸€ä¸ªè¯­è¨€ï¼ˆè¡¨è¾¾å¼ï¼‰ï¼Œå®šä¹‰å®ƒçš„æ–‡æ³•çš„ä¸€ç§è¡¨ç¤ºï¼Œå¹¶å®šä¹‰ä¸€ä¸ªè§£é‡Šå™¨ï¼Œä½¿ç”¨è¯¥è§£é‡Šå™¨æ¥è§£é‡Šè¯­è¨€ä¸­çš„å¥å­ï¼ˆè¡¨è¾¾å¼ï¼‰ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129public class ClientTest &#123; public static void main(String[] args) throws IOException &#123; String expStr = getExpStr(); // a+b HashMap&lt;String, Integer&gt; var = getValue(expStr); // var &#123;a=10, b=20&#125; Calculator calculator = new Calculator(expStr); System.out.println(\"è¿ç®—ç»“æœï¼š\" + expStr + \"=\" + calculator.run(var)); &#125; // è·å¾—è¡¨è¾¾å¼ public static String getExpStr() throws IOException &#123; System.out.print(\"è¯·è¾“å…¥è¡¨è¾¾å¼ï¼š\"); return (new BufferedReader(new InputStreamReader(System.in))).readLine(); &#125; // è·å¾—å€¼æ˜ å°„ public static HashMap&lt;String, Integer&gt; getValue(String expStr) throws IOException &#123; HashMap&lt;String, Integer&gt; map = new HashMap&lt;&gt;(); for (char ch : expStr.toCharArray()) &#123; if (ch != '+' &amp;&amp; ch != '-') &#123; if (!map.containsKey(String.valueOf(ch))) &#123; System.out.print(\"è¯·è¾“å…¥\" + String.valueOf(ch) + \"çš„å€¼ï¼š\"); String in = (new BufferedReader(new InputStreamReader(System.in))).readLine(); map.put(String.valueOf(ch), Integer.valueOf(in)); &#125; &#125; &#125; return map; &#125;&#125;public class Calculator &#123; // å®šä¹‰è¡¨è¾¾å¼ private Expression expression; // æ„é€ å‡½æ•°ä¼ å‚ï¼Œå¹¶è§£æ public Calculator(String expStr) &#123; // expStr = a+b // å®‰æ’è¿ç®—å…ˆåé¡ºåº Stack&lt;Expression&gt; stack = new Stack&lt;&gt;(); // è¡¨è¾¾å¼æ‹†åˆ†æˆå­—ç¬¦æ•°ç»„ char[] charArray = expStr.toCharArray();// [a, +, b] Expression left = null; Expression right = null; // éå†æˆ‘ä»¬çš„å­—ç¬¦æ•°ç»„ï¼Œ å³éå† [a, +, b] // é’ˆå¯¹ä¸åŒçš„æƒ…å†µï¼Œåšå¤„ç† for (int i = 0; i &lt; charArray.length; i++) &#123; switch (charArray[i]) &#123; case '+': left = stack.pop(); // ä» stack å–å‡º left =&gt; \"a\" right = new VarExpression(String.valueOf(charArray[++i])); // å–å‡ºå³è¡¨è¾¾å¼ \"b\" stack.push(new AddExpression(left, right)); // ç„¶åæ ¹æ®å¾—åˆ° left å’Œ right æ„å»º AddExpresson åŠ å…¥ stack break; case '-': left = stack.pop(); right = new VarExpression(String.valueOf(charArray[++i])); stack.push(new SubExpression(left, right)); break; default: // å¦‚æœæ˜¯ä¸€ä¸ª Var å°±åˆ›å»ºè¦ç»™ VarExpression å¯¹è±¡ï¼Œå¹¶ push åˆ° stack stack.push(new VarExpression(String.valueOf(charArray[i]))); break; &#125; &#125; // å½“éå†å®Œæ•´ä¸ª charArray æ•°ç»„åï¼Œstack å°±å¾—åˆ°æœ€å Expression this.expression = stack.pop(); &#125; public int run(HashMap&lt;String, Integer&gt; var) &#123; // æœ€åå°†è¡¨è¾¾å¼ a+b å’Œ var = &#123;a=10,b=20&#125; // ç„¶åä¼ é€’ç»™ expression çš„ interpreter è¿›è¡Œè§£é‡Šæ‰§è¡Œ return this.expression.interpreter(var); &#125;&#125;// æŠ½è±¡ç±»è¡¨è¾¾å¼ï¼Œé€šè¿‡ HashMap é”®å€¼å¯¹, å¯ä»¥è·å–åˆ°å˜é‡çš„å€¼public abstract class Expression &#123; // a + b - c // è§£é‡Šå…¬å¼å’Œæ•°å€¼, key å°±æ˜¯å…¬å¼ï¼Œå‚æ•°[a,b,c], value å°±æ˜¯å°±æ˜¯å…·ä½“å€¼ // HashMap &#123;a=10, b=20&#125; public abstract int interpreter(HashMap&lt;String, Integer&gt; var);&#125;// å˜é‡çš„è§£é‡Šå™¨public class VarExpression extends Expression &#123; private String key; // key=a,key=b,key=c public VarExpression(String key) &#123; this.key = key; &#125; // &#123;a=10, b=20&#125; // interpreter æ ¹æ®å˜é‡åç§°ï¼Œè¿”å›å¯¹åº”å€¼ @Override public int interpreter(HashMap&lt;String, Integer&gt; var) &#123; return var.get(this.key); &#125;&#125;// æŠ½è±¡è¿ç®—ç¬¦å·è§£æå™¨ è¿™é‡Œï¼Œæ¯ä¸ªè¿ç®—ç¬¦å·ï¼Œéƒ½åªå’Œè‡ªå·±å·¦å³ä¸¤ä¸ªæ•°å­—æœ‰å…³ç³»ï¼Œ// ä½†å·¦å³ä¸¤ä¸ªæ•°å­—æœ‰å¯èƒ½ä¹Ÿæ˜¯ä¸€ä¸ªè§£æçš„ç»“æœï¼Œæ— è®ºä½•ç§ç±»å‹ï¼Œéƒ½æ˜¯ Expression ç±»çš„å®ç°ç±»public class SymbolExpression extends Expression &#123; protected Expression left; protected Expression right; public SymbolExpression(Expression left, Expression right) &#123; this.left = left; this.right = right; &#125; // å› ä¸º SymbolExpression æ˜¯è®©å…¶å­ç±»æ¥å®ç°ï¼Œå› æ­¤ interpreter æ˜¯ä¸€ä¸ªé»˜è®¤å®ç° @Override public int interpreter(HashMap&lt;String, Integer&gt; var) &#123; return 0; &#125;&#125;public class SubExpression extends SymbolExpression &#123; public SubExpression(Expression left, Expression right) &#123; super(left, right); &#125; // æ±‚å‡º left å’Œ right è¡¨è¾¾å¼ç›¸å‡åçš„ç»“æœ public int interpreter(HashMap&lt;String, Integer&gt; var) &#123; return super.left.interpreter(var) - super.right.interpreter(var); &#125;&#125;public class AddExpression extends SymbolExpression &#123; public AddExpression(Expression left, Expression right) &#123; super(left, right); &#125; // &#123;a=10,b=20&#125; public int interpreter(HashMap&lt;String, Integer&gt; var) &#123; //super.left.interpreter(var) ï¼š è¿”å› left è¡¨è¾¾å¼å¯¹åº”çš„å€¼ a = 10 //super.right.interpreter(var): è¿”å› right è¡¨è¾¾å¼å¯¹åº”å€¼ b = 20 return super.left.interpreter(var) + super.right.interpreter(var); &#125;&#125; çŠ¶æ€æ¨¡å¼ä¸»è¦ç”¨æ¥è§£å†³å¯¹è±¡åœ¨å¤šç§çŠ¶æ€è½¬æ¢æ—¶ï¼Œéœ€è¦å¯¹å¤–è¾“å‡ºä¸åŒçš„è¡Œä¸ºçš„é—®é¢˜ã€‚çŠ¶æ€å’Œè¡Œä¸ºæ˜¯ç›¸å¯¹åº”çš„ï¼ŒçŠ¶æ€ä¹‹é—´å¯ä»¥ç›¸äº’è½¬æ¢ã€‚å½“ä¸€ä¸ªå¯¹è±¡çš„å†…åœ¨çŠ¶æ€æ”¹å˜æ—¶ï¼Œå…è®¸æ”¹å˜å…¶è¡Œä¸ºï¼Œè¿™ä¸ªå¯¹è±¡çœ‹èµ·æ¥åƒæ˜¯æ”¹å˜äº†å…¶ç±»ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181public class ClientTest &#123; public static void main(String[] args) &#123; // åˆ›å»ºæ´»åŠ¨å¯¹è±¡ï¼Œå¥–å“æœ‰ 1 ä¸ªå¥–å“ RaffleActivity activity = new RaffleActivity(1); // æˆ‘ä»¬è¿ç»­æŠ½ 300 æ¬¡å¥– for (int i = 0; i &lt; 30; i++) &#123; System.out.println(\"---ç¬¬\" + (i + 1) + \"æ¬¡æŠ½å¥–---\"); // å‚åŠ æŠ½å¥–ï¼Œç¬¬ä¸€æ­¥ç‚¹å‡»æ‰£é™¤ç§¯åˆ† activity.debuctMoney(); // ç¬¬äºŒæ­¥æŠ½å¥– activity.raffle(); &#125; &#125;&#125;// æŠ½å¥–æ´»åŠ¨// ä¼ å…¥ä¸åŒçš„çŠ¶æ€è¿›è¡Œè°ƒç”¨public class RaffleActivity &#123; // state è¡¨ç¤ºæ´»åŠ¨å½“å‰çš„çŠ¶æ€ï¼Œæ˜¯å˜åŒ– State state = null; // å¥–å“æ•°é‡ int count = 0; // å››ä¸ªå±æ€§ï¼Œè¡¨ç¤ºæ´»åŠ¨çš„å››ç§çŠ¶æ€ State noRafflleState = new NoRaffleState(this); State canRaffleState = new CanRaffleState(this); State dispenseState = new DispenseState(this); State dispensOutState = new DispenseOutState(this); //æ„é€ å™¨ // 1.åˆå§‹åŒ–å½“å‰çš„çŠ¶æ€ä¸º noRafflleStateï¼ˆå³ä¸èƒ½æŠ½å¥–çš„çŠ¶æ€ï¼‰ // 2.åˆå§‹åŒ–å¥–å“çš„æ•°é‡ public RaffleActivity(int count) &#123; this.state = getNoRafflleState(); this.count = count; &#125; // æ‰£åˆ†, è°ƒç”¨å½“å‰çŠ¶æ€çš„ deductMoney public void debuctMoney()&#123; state.deductMoney(); &#125; // æŠ½å¥– public void raffle()&#123; // å¦‚æœå½“å‰çš„çŠ¶æ€æ˜¯æŠ½å¥–æˆåŠŸ if(state.raffle())&#123; // é¢†å–å¥–å“ state.dispensePrize(); &#125; &#125; // Getter / Setter // æ¯é¢†å–ä¸€æ¬¡å¥–å“ï¼Œå¥–å“æ•°é‡å‡ä¸€ public int getCount() &#123; int curCount = count; count--; return curCount; &#125;&#125;// æŠ½å¥–äººçŠ¶æ€æŠ½è±¡ç±»public abstract class State &#123; // æ‰£é™¤ç§¯åˆ† - 50 public abstract void deductMoney(); // æ˜¯å¦æŠ½ä¸­å¥–å“ public abstract boolean raffle(); // å‘æ”¾å¥–å“ public abstract void dispensePrize();&#125;// å¯ä»¥æŠ½å¥–çš„çŠ¶æ€ï¼šé‡å†™å„æ­¥éª¤public class CanRaffleState extends State &#123; RaffleActivity activity; public CanRaffleState(RaffleActivity activity) &#123; this.activity = activity; &#125; // å·²ç»æ‰£é™¤äº†ç§¯åˆ†ï¼Œä¸èƒ½å†æ‰£ @Override public void deductMoney() &#123; System.out.println(\"å·²ç»æ‰£å–è¿‡äº†ç§¯åˆ†\"); &#125; // å¯ä»¥æŠ½å¥–, æŠ½å®Œå¥–åï¼Œæ ¹æ®å®é™…æƒ…å†µï¼Œæ”¹æˆæ–°çš„çŠ¶æ€ @Override public boolean raffle() &#123; System.out.println(\"æ­£åœ¨æŠ½å¥–ï¼Œè¯·ç¨ç­‰ï¼\"); Random r = new Random(); int num = r.nextInt(10); // 10% ä¸­å¥–æœºä¼š if(num == 0)&#123; // æ”¹å˜æ´»åŠ¨çŠ¶æ€ä¸ºå‘æ”¾å¥–å“ context activity.setState(activity.getDispenseState()); return true; &#125;else&#123; System.out.println(\"å¾ˆé—æ†¾æ²¡æœ‰æŠ½ä¸­å¥–å“ï¼\"); // æ”¹å˜çŠ¶æ€ä¸ºä¸èƒ½æŠ½å¥– activity.setState(activity.getNoRafflleState()); return false; &#125; &#125; // ä¸èƒ½å‘æ”¾å¥–å“ @Override public void dispensePrize() &#123; System.out.println(\"æ²¡ä¸­å¥–ï¼Œä¸èƒ½å‘æ”¾å¥–å“\"); &#125;&#125;// å¥–å“å‘é€å®Œæ¯•çŠ¶æ€public class DispenseOutState extends State &#123; // åˆå§‹åŒ–æ—¶ä¼ å…¥æ´»åŠ¨å¼•ç”¨ RaffleActivity activity; public DispenseOutState(RaffleActivity activity) &#123; this.activity = activity; &#125; @Override public void deductMoney() &#123; System.out.println(\"å¥–å“å‘é€å®Œäº†ï¼Œè¯·ä¸‹æ¬¡å†å‚åŠ \"); &#125; @Override public boolean raffle() &#123; System.out.println(\"å¥–å“å‘é€å®Œäº†ï¼Œè¯·ä¸‹æ¬¡å†å‚åŠ \"); return false; &#125; @Override public void dispensePrize() &#123; System.out.println(\"å¥–å“å‘é€å®Œäº†ï¼Œè¯·ä¸‹æ¬¡å†å‚åŠ \"); &#125;&#125;// å‘é€å¥–å“çŠ¶æ€public class DispenseState extends State &#123; // åˆå§‹åŒ–æ—¶ä¼ å…¥æ´»åŠ¨å¼•ç”¨ï¼Œå‘æ”¾å¥–å“åæ”¹å˜å…¶çŠ¶æ€ RaffleActivity activity; public DispenseState(RaffleActivity activity) &#123; this.activity = activity; &#125; @Override public void deductMoney() &#123; System.out.println(\"ä¸èƒ½æ‰£é™¤ç§¯åˆ†\"); &#125; @Override public boolean raffle() &#123; System.out.println(\"ä¸èƒ½æŠ½å¥–\"); return false; &#125; // å‘æ”¾å¥–å“ @Override public void dispensePrize() &#123; if(activity.getCount() &gt; 0)&#123; System.out.println(\"æ­å–œä¸­å¥–äº†\"); // æ”¹å˜çŠ¶æ€ä¸ºä¸èƒ½æŠ½å¥– activity.setState(activity.getNoRafflleState()); &#125;else&#123; System.out.println(\"å¾ˆé—æ†¾ï¼Œå¥–å“å‘é€å®Œäº†\"); // æ”¹å˜çŠ¶æ€ä¸ºå¥–å“å‘é€å®Œæ¯•, åé¢æˆ‘ä»¬å°±ä¸å¯ä»¥æŠ½å¥– activity.setState(activity.getDispensOutState()); // System.out.println(\"æŠ½å¥–æ´»åŠ¨ç»“æŸ\"); // System.exit(0); &#125; &#125;&#125;// ä¸èƒ½æŠ½å¥–çš„çŠ¶æ€public class NoRaffleState extends State &#123; // åˆå§‹åŒ–æ—¶ä¼ å…¥æ´»åŠ¨å¼•ç”¨ï¼Œæ‰£é™¤ç§¯åˆ†åæ”¹å˜å…¶çŠ¶æ€ RaffleActivity activity; public NoRaffleState(RaffleActivity activity) &#123; this.activity = activity; &#125; // å½“å‰çŠ¶æ€å¯ä»¥æ‰£ç§¯åˆ†ï¼Œæ‰£é™¤åï¼Œå°†çŠ¶æ€è®¾ç½®æˆå¯ä»¥æŠ½å¥–çŠ¶æ€ @Override public void deductMoney() &#123; System.out.println(\"æ‰£é™¤ 50 ç§¯åˆ†æˆåŠŸï¼Œæ‚¨å¯ä»¥æŠ½å¥–äº†\"); activity.setState(activity.getCanRaffleState()); &#125; // å½“å‰çŠ¶æ€ä¸èƒ½æŠ½å¥– @Override public boolean raffle() &#123; System.out.println(\"æ‰£äº†ç§¯åˆ†æ‰èƒ½æŠ½å¥–å–”ï¼\"); return false; &#125; // å½“å‰çŠ¶æ€ä¸èƒ½å‘å¥–å“ @Override public void dispensePrize() &#123; System.out.println(\"ä¸èƒ½å‘æ”¾å¥–å“\"); &#125;&#125; ç­–ç•¥æ¨¡å¼åˆ†åˆ«å°è£…è¡Œä¸ºæ¥å£ï¼Œå®ç°ç®—æ³•æ—ï¼Œè¶…ç±»é‡Œæ”¾è¡Œä¸ºæ¥å£å¯¹è±¡ï¼Œåœ¨å­ç±»é‡Œå…·ä½“è®¾å®šè¡Œä¸ºå¯¹è±¡ã€‚åŸåˆ™å°±æ˜¯ï¼šåˆ†ç¦»å˜åŒ–éƒ¨åˆ†ï¼Œå°è£…æ¥å£ï¼ŒåŸºäºæ¥å£ç¼–ç¨‹å„ç§åŠŸèƒ½ã€‚æ­¤æ¨¡å¼è®©è¡Œä¸ºçš„å˜åŒ–ç‹¬ç«‹äºç®—æ³•çš„ä½¿ç”¨è€…ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108public class Client &#123; public static void main(String[] args) &#123; WildDuck wildDuck = new WildDuck(); wildDuck.fly(); ToyDuck toyDuck = new ToyDuck(); toyDuck.fly(); PekingDuck pekingDuck = new PekingDuck(); pekingDuck.fly(); // åŠ¨æ€æ”¹å˜æŸä¸ªå¯¹è±¡çš„è¡Œä¸º, åŒ—äº¬é¸­æ”¹ä¸ºä¸èƒ½é£ï¼šæ”¹å˜ç­–ç•¥ pekingDuck.setFlyBehavior(new NoFlyBehavior()); System.out.println(\"åŒ—äº¬é¸­çš„å®é™…é£ç¿”èƒ½åŠ›\"); pekingDuck.fly(); &#125;&#125;// å®šä¹‰é¸­çš„è¡Œä¸ºæ¨¡å¼public abstract class Duck &#123; // å±æ€§, ç­–ç•¥æ¥å£ FlyBehavior flyBehavior; // å…¶å®ƒå±æ€§ &lt;-&gt; ç­–ç•¥æ¥å£ QuackBehavior quackBehavior; public Duck() &#123; &#125; public abstract void display(); // æ˜¾ç¤ºé¸­å­ä¿¡æ¯ public void quack() &#123; System.out.println(\"é¸­å­å˜å˜å«~~\"); &#125; public void swim() &#123; System.out.println(\"é¸­å­ä¼šæ¸¸æ³³~~\"); &#125; public void fly() &#123; // è‹¥æ”¹å˜ç­–ç•¥ if(flyBehavior != null) &#123; flyBehavior.fly(); &#125; &#125; public void setFlyBehavior(FlyBehavior flyBehavior) &#123; this.flyBehavior = flyBehavior; &#125; public void setQuackBehavior(QuackBehavior quackBehavior) &#123; this.quackBehavior = quackBehavior; &#125;&#125;public class PekingDuck extends Duck &#123; // å‡å¦‚åŒ—äº¬é¸­å¯ä»¥é£ç¿”ï¼Œä½†æ˜¯é£ç¿”æŠ€æœ¯ä¸€èˆ¬ public PekingDuck() &#123; flyBehavior = new BadFlyBehavior(); &#125; @Override public void display() &#123; System.out.println(\"~~åŒ—äº¬é¸­~~~\"); &#125;&#125;public class ToyDuck extends Duck&#123; public ToyDuck() &#123; flyBehavior = new NoFlyBehavior(); &#125; @Override public void display() &#123; System.out.println(\"ç©å…·é¸­\"); &#125; // éœ€è¦é‡å†™çˆ¶ç±»çš„æ‰€æœ‰æ–¹æ³• public void quack() &#123; System.out.println(\"ç©å…·é¸­ä¸èƒ½å«~~\"); &#125; public void swim() &#123; System.out.println(\"ç©å…·é¸­ä¸ä¼šæ¸¸æ³³~~\"); &#125;&#125;public class WildDuck extends Duck &#123; // æ„é€ å™¨ï¼Œä¼ å…¥ FlyBehavor çš„å¯¹è±¡ public WildDuck() &#123; flyBehavior = new GoodFlyBehavior(); &#125; @Override public void display() &#123; System.out.println(\" è¿™æ˜¯é‡é¸­ \"); &#125;&#125;// æœªå®ç°ç­–ç•¥public interface QuackBehavior &#123; void quack();//å­ç±»å®ç°&#125;public interface FlyBehavior &#123; void fly(); // å­ç±»å…·ä½“å®ç°&#125;public class GoodFlyBehavior implements FlyBehavior &#123; @Override public void fly() &#123; System.out.println(\"é£ç¿”æŠ€æœ¯é«˜è¶…~~\"); &#125;&#125;public class NoFlyBehavior implements FlyBehavior&#123; @Override public void fly() &#123; System.out.println(\"ä¸ä¼šé£ç¿”...\"); &#125;&#125;public class BadFlyBehavior implements FlyBehavior &#123; @Override public void fly() &#123; System.out.println(\" é£ç¿”æŠ€æœ¯ä¸€èˆ¬ \"); &#125;&#125; ç­–ç•¥æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šå¤šç”¨ç»„åˆ / èšåˆï¼Œå°‘ç”¨ç»§æ‰¿ï¼›ç”¨è¡Œä¸ºç±»ç»„åˆï¼Œè€Œä¸æ˜¯è¡Œä¸ºçš„ç»§æ‰¿ï¼Œæ›´æœ‰å¼¹æ€§ã€‚ è´£ä»»é“¾æ¨¡å¼èŒè´£é“¾æ¨¡å¼ï¼ˆChain of Responsibility Patternï¼‰, åˆå«è´£ä»»é“¾æ¨¡å¼ï¼Œä¸ºè¯·æ±‚åˆ›å»ºäº†ä¸€ä¸ªæ¥æ”¶è€…å¯¹è±¡çš„é“¾ã€‚è¿™ç§æ¨¡å¼å¯¹è¯·æ±‚çš„å‘é€è€…å’Œæ¥æ”¶è€…è¿›è¡Œè§£è€¦ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112public class Client &#123; public static void main(String[] args) &#123; // åˆ›å»ºä¸€ä¸ªè¯·æ±‚ PurchaseRequest purchaseRequest = new PurchaseRequest(1, 31000, 1); // åˆ›å»ºç›¸å…³çš„å®¡æ‰¹äºº DepartmentApprover departmentApprover = new DepartmentApprover(\"å¼ ä¸»ä»»\"); CollegeApprover collegeApprover = new CollegeApprover(\"æé™¢é•¿\"); ViceSchoolMasterApprover viceSchoolMasterApprover = new ViceSchoolMasterApprover(\"ç‹å‰¯æ ¡\"); SchoolMasterApprover schoolMasterApprover = new SchoolMasterApprover(\"ä½Ÿæ ¡é•¿\"); // éœ€è¦å°†å„ä¸ªå®¡æ‰¹çº§åˆ«çš„ä¸‹ä¸€ä¸ªè®¾ç½®å¥½ (å¤„ç†äººæ„æˆç¯å½¢) // å„å¤„ç†è€…å¤„ç†çš„èŒƒå›´ï¼ˆä»»åŠ¡ç±»å‹ï¼‰ä¸åŒ departmentApprover.setApprover(collegeApprover); collegeApprover.setApprover(viceSchoolMasterApprover); viceSchoolMasterApprover.setApprover(schoolMasterApprover); schoolMasterApprover.setApprover(departmentApprover); // åˆ†å‘ä»»åŠ¡ departmentApprover.processRequest(purchaseRequest); viceSchoolMasterApprover.processRequest(purchaseRequest); &#125;&#125;public abstract class Approver &#123; Approver approver; // ä¸‹ä¸€ä¸ªå¤„ç†è€… String name; // åå­— public Approver(String name) &#123; this.name = name; &#125; // ä¸‹ä¸€ä¸ªå¤„ç†è€… public void setApprover(Approver approver) &#123; this.approver = approver; &#125; // å¤„ç†å®¡æ‰¹è¯·æ±‚çš„æ–¹æ³•ï¼Œå¾—åˆ°ä¸€ä¸ªè¯·æ±‚, å¤„ç†æ˜¯å­ç±»å®Œæˆï¼Œå› æ­¤è¯¥æ–¹æ³•åšæˆæŠ½è±¡ public abstract void processRequest(PurchaseRequest purchaseRequest);&#125;public class CollegeApprover extends Approver &#123; public CollegeApprover(String name) &#123; super(name); &#125; @Override public void processRequest(PurchaseRequest purchaseRequest) &#123; if(purchaseRequest.getPrice() &lt; 5000 &amp;&amp; purchaseRequest.getPrice() &lt;= 10000) &#123; System.out.println(\" è¯·æ±‚ç¼–å· id= \" + purchaseRequest.getId() + \" è¢« \" + this.name + \" å¤„ç†\"); &#125;else &#123; approver.processRequest(purchaseRequest); &#125; &#125;&#125;public class DepartmentApprover extends Approver &#123; public DepartmentApprover(String name) &#123; super(name); &#125; @Override public void processRequest(PurchaseRequest purchaseRequest) &#123; if(purchaseRequest.getPrice() &lt;= 5000) &#123; System.out.println(\" è¯·æ±‚ç¼–å· id= \" + purchaseRequest.getId() + \" è¢« \" + this.name + \" å¤„ç†\"); &#125;else &#123; approver.processRequest(purchaseRequest); &#125; &#125;&#125;public class SchoolMasterApprover extends Approver &#123; public SchoolMasterApprover(String name) &#123; super(name); &#125; @Override public void processRequest(PurchaseRequest purchaseRequest) &#123; if(purchaseRequest.getPrice() &gt; 30000) &#123; System.out.println(\" è¯·æ±‚ç¼–å· id= \" + purchaseRequest.getId() + \" è¢« \" + this.name + \" å¤„ç†\"); &#125;else &#123; approver.processRequest(purchaseRequest); &#125; &#125;&#125;public class ViceSchoolMasterApprover extends Approver &#123; public ViceSchoolMasterApprover(String name) &#123; super(name); &#125; @Override public void processRequest(PurchaseRequest purchaseRequest) &#123; // TODO Auto-generated method stub if(purchaseRequest.getPrice() &lt; 10000 &amp;&amp; purchaseRequest.getPrice() &lt;= 30000) &#123; System.out.println(\" è¯·æ±‚ç¼–å· id= \" + purchaseRequest.getId() + \" è¢« \" + this.name + \" å¤„ç†\"); &#125;else &#123; approver.processRequest(purchaseRequest); &#125; &#125;&#125;// è¯·æ±‚ç±»public class PurchaseRequest &#123; private int type = 0; // è¯·æ±‚ç±»å‹ private float price = 0.0f; // è¯·æ±‚é‡‘é¢ private int id = 0; // æ„é€ å™¨ public PurchaseRequest(int type, float price, int id) &#123; this.type = type; this.price = price; this.id = id; &#125; public int getType() &#123; return type; &#125; public float getPrice() &#123; return price; &#125; public int getId() &#123; return id; &#125;&#125;","categories":[{"name":"æŠ€æœ¯åŸç†","slug":"æŠ€æœ¯åŸç†","permalink":"http://yoursite.com/categories/%E6%8A%80%E6%9C%AF%E5%8E%9F%E7%90%86/"}],"tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"http://yoursite.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}]},{"title":"Python çˆ¬è™«","slug":"Python/Python çˆ¬è™«","date":"2020-03-16T07:09:15.000Z","updated":"2020-07-10T04:19:26.026Z","comments":true,"path":"2020/03/16/Python/Python çˆ¬è™«/","link":"","permalink":"http://yoursite.com/2020/03/16/Python/Python%20%E7%88%AC%E8%99%AB/","excerpt":"Python çˆ¬è™«ç›¸å…³çš„çŸ¥è¯†ã€‚","text":"Python çˆ¬è™«ç›¸å…³çš„çŸ¥è¯†ã€‚ Urllib åº“12345import urllib2 request = urllib2.Request(\"http://www.baidu.com\")response = urllib2.urlopen(request)print response.read() Post &amp; Get123456789import urllibimport urllib2 values = &#123;\"username\":\"1016903103@qq.com\",\"password\":\"XXXX\"&#125;data = urllib.urlencode(values) url = \"https://passport.csdn.net/account/login?from=http://my.csdn.net/my/mycsdn\"request = urllib2.Request(url,data)response = urllib2.urlopen(request)print response.read() 123456789101112import urllibimport urllib2 values=&#123;&#125;values['username'] = \"1016903103@qq.com\"values['password']=\"XXXX\"data = urllib.urlencode(values) url = \"http://passport.csdn.net/account/login\"geturl = url + \"?\"+datarequest = urllib2.Request(geturl)response = urllib2.urlopen(request)print response.read() æ„å»ºæ¶ˆæ¯å¤´1234567891011import urllib import urllib2 url = 'http://www.server.com/login'user_agent = 'Mozilla/4.0 (compatible; MSIE 5.5; Windows NT)' values = &#123;'username' : 'cqc', 'password' : 'XXXX' &#125; headers = &#123; 'User-Agent' : user_agent &#125; data = urllib.urlencode(values) request = urllib2.Request(url, data, headers) response = urllib2.urlopen(request) page = response.read() Proxy è®¾ç½®12345678910import urllib2enable_proxy = Trueproxy_handler = urllib2.ProxyHandler(&#123;\"http\" : 'http://some-proxy.com:8080'&#125;)null_proxy_handler = urllib2.ProxyHandler(&#123;&#125;)if enable_proxy: opener = urllib2.build_opener(proxy_handler)else: opener = urllib2.build_opener(null_proxy_handler)urllib2.install_opener(opener) çˆ¬å– TED æ–‡ç« 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647# -*- coding: utf-8 -*import codecsimport bs4from bs4 import BeautifulSoupimport requestsimport re# ç”¨æˆ·è¾“å…¥ç½‘å€ï¼Œä¾‹å­ï¼šhttps://www.ted.com/talks/Xxx_Xxx_X...input_url = raw_input('Please Enter Article URL: ')url = input_url + '/transcript'# è·å–æ–‡ç« æ ‡é¢˜url_str = url.split('/')title_ = url_str[4]title_str = title_.split('_')title = ''author = ''num = 0for str in title_str: num = num + 1 if(num &gt; 2): if(num == 3): str = str.capitalize() title = title + str + ' ' else: author = author + str.capitalize()print \"Title:\" + titleprint \"Author:\" + author# è·å–æ–‡ç« html = requests.get(url).content soup = BeautifulSoup(html, 'html.parser', from_encoding='utf-8')divs = soup.find_all('div', class_=\"Grid__cell flx-s:1 p-r:4\")article = title + '\\n'rude_t = re.compile(r'\\t')rude_n = re.compile(r'\\n')for div in divs: for string in div.stripped_strings: string = rude_t.sub('', string) string = rude_n.sub(' ', string) article = article + string article = article + '\\n'article = article + '\\n'file = codecs.open(\"TED.txt\",\"a\",\"utf-8\")file.write(article)file.close()print \"Finish!\"","categories":[{"name":"Python","slug":"Python","permalink":"http://yoursite.com/categories/Python/"}],"tags":[{"name":"çˆ¬è™«","slug":"çˆ¬è™«","permalink":"http://yoursite.com/tags/%E7%88%AC%E8%99%AB/"}]},{"title":"Python åŸºç¡€","slug":"Python/Python åŸºç¡€","date":"2020-03-16T06:00:32.000Z","updated":"2020-07-12T08:32:02.783Z","comments":true,"path":"2020/03/16/Python/Python åŸºç¡€/","link":"","permalink":"http://yoursite.com/2020/03/16/Python/Python%20%E5%9F%BA%E7%A1%80/","excerpt":"Python å…¥é—¨ã€‚","text":"Python å…¥é—¨ã€‚ Python åŸºç¡€è¾“å…¥å’Œè¾“å‡º12name = raw_input('please enter your name: ') # è¾“å…¥ä¸ºå­—ç¬¦ä¸²å½¢å¼ int()print 'hello,', name å­—ç¬¦ä¸²è½¬ä¹‰å­—ç¬¦\\å¯ä»¥è½¬ä¹‰å¾ˆå¤šå­—ç¬¦ï¼Œæ¯”å¦‚\\nè¡¨ç¤ºæ¢è¡Œï¼Œ\\tè¡¨ç¤ºåˆ¶è¡¨ç¬¦ï¼Œå­—ç¬¦\\æœ¬èº«ä¹Ÿè¦è½¬ä¹‰ï¼Œæ‰€ä»¥\\\\è¡¨ç¤ºçš„å­—ç¬¦å°±æ˜¯\\ï¼Œå¦‚æœå­—ç¬¦ä¸²é‡Œé¢æœ‰å¾ˆå¤šå­—ç¬¦éƒ½éœ€è¦è½¬ä¹‰ï¼Œå°±éœ€è¦åŠ å¾ˆå¤š\\ï¼Œä¸ºäº†ç®€åŒ–ï¼ŒPythonè¿˜å…è®¸ç”¨r&#39;&#39;è¡¨ç¤º&#39;&#39;å†…éƒ¨çš„å­—ç¬¦ä¸²é»˜è®¤ä¸è½¬ä¹‰ã€‚ å¦‚æœå­—ç¬¦ä¸²å†…éƒ¨æœ‰å¾ˆå¤šæ¢è¡Œï¼Œç”¨\\nå†™åœ¨ä¸€è¡Œé‡Œä¸å¥½é˜…è¯»ï¼Œä¸ºäº†ç®€åŒ–ï¼ŒPythonå…è®¸ç”¨&#39;&#39;&#39;...&#39;&#39;&#39;çš„æ ¼å¼è¡¨ç¤ºå¤šè¡Œå†…å®¹ã€‚ 12345678print '''line1... line2... line3'''## è¾“å‡ºç»“æœ# line1# line2# line3 å ä½ç¬¦ å ä½ç¬¦ %d æ•´æ•° %f æµ®ç‚¹æ•° %s å­—ç¬¦ä¸² %x åå…­è¿›åˆ¶æ•´æ•° 12'Hi, %s, you have $%d.' % ('Michael', 1000000)# 'Hi, Michael, you have $1000000.' å¸ƒå°”å€¼å¸ƒå°”å€¼å’Œå¸ƒå°”ä»£æ•°çš„è¡¨ç¤ºå®Œå…¨ä¸€è‡´ï¼Œä¸€ä¸ªå¸ƒå°”å€¼åªæœ‰Trueã€Falseä¸¤ç§å€¼ï¼Œè¦ä¹ˆæ˜¯Trueï¼Œè¦ä¹ˆæ˜¯Falseï¼Œåœ¨Pythonä¸­ï¼Œå¯ä»¥ç›´æ¥ç”¨Trueã€Falseè¡¨ç¤ºå¸ƒå°”å€¼ï¼ˆè¯·æ³¨æ„å¤§å°å†™ï¼‰ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¸ƒå°”è¿ç®—è®¡ç®—å‡ºæ¥ã€‚ å¸ƒå°”å€¼å¯ä»¥ç”¨andã€orå’Œnotè¿ç®—ã€‚ ç©ºå€¼ç©ºå€¼æ˜¯Pythoné‡Œä¸€ä¸ªç‰¹æ®Šçš„å€¼ï¼Œç”¨Noneè¡¨ç¤ºã€‚Noneä¸èƒ½ç†è§£ä¸º0ï¼Œå› ä¸º0æ˜¯æœ‰æ„ä¹‰çš„ï¼Œè€ŒNoneæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç©ºå€¼ã€‚ å˜é‡å˜é‡åœ¨ç¨‹åºä¸­å°±æ˜¯ç”¨ä¸€ä¸ªå˜é‡åè¡¨ç¤ºäº†ï¼Œå˜é‡åå¿…é¡»æ˜¯å¤§å°å†™è‹±æ–‡ã€æ•°å­—å’Œ_çš„ç»„åˆï¼Œä¸”ä¸èƒ½ç”¨æ•°å­—å¼€å¤´ã€‚ 1234567891011a = 'ABC' # åœ¨å†…å­˜ä¸­åˆ›å»ºäº†ä¸€ä¸ª ABC çš„å­—ç¬¦ä¸²ï¼›åœ¨å†…å­˜ä¸­åˆ›å»ºäº†ä¸€ä¸ªåä¸º a çš„å˜é‡ï¼Œå¹¶æŠŠå®ƒæŒ‡å‘ ABC å­—ç¬¦ä¸²b = aa = 'XYZ'print b # ABC å­—ç¬¦ä¸²&gt;&gt;&gt; a = 'abc'&gt;&gt;&gt; b = a.replace('a', 'A')&gt;&gt;&gt; b'Abc'&gt;&gt;&gt; a'abc' list å’Œ tuplePython å†…ç½®çš„ä¸€ç§æ•°æ®ç±»å‹æ˜¯åˆ—è¡¨ï¼šlistã€‚list æ˜¯ä¸€ç§æœ‰åºçš„é›†åˆï¼Œå¯ä»¥éšæ—¶æ·»åŠ å’Œåˆ é™¤å…¶ä¸­çš„å…ƒç´ ã€‚ 123456789101112131415161718192021222324252627282930&gt;&gt;&gt; classmates = ['Michael', 'Bob', 'Tracy']&gt;&gt;&gt; classmates['Michael', 'Bob', 'Tracy']&gt;&gt;&gt; len(classmates)3&gt;&gt;&gt; classmates[-1]'Tracy'&gt;&gt;&gt; classmates.append('Adam')&gt;&gt;&gt; classmates['Michael', 'Bob', 'Tracy', 'Adam']&gt;&gt;&gt; classmates.insert(1, 'Jack')&gt;&gt;&gt; classmates['Michael', 'Jack', 'Bob', 'Tracy', 'Adam']&gt;&gt;&gt; classmates.pop()'Adam'&gt;&gt;&gt; classmates['Michael', 'Jack', 'Bob', 'Tracy']&gt;&gt;&gt; classmates.pop(1)'Jack'&gt;&gt;&gt; classmates['Michael', 'Bob', 'Tracy']&gt;&gt;&gt; p = ['asp', 'php']&gt;&gt;&gt; s = ['python', 'java', p, 'scheme'] tuple å¦ä¸€ç§æœ‰åºåˆ—è¡¨å«å…ƒç»„ï¼štupleã€‚tuple å’Œ list éå¸¸ç±»ä¼¼ï¼Œä½†æ˜¯ tuple ä¸€æ—¦åˆå§‹åŒ–å°±ä¸èƒ½ä¿®æ”¹ã€‚ 1&gt;&gt;&gt; classmates = ('Michael', 'Bob', 'Tracy') é”™è¯¯ç”¨æ³• 12345&gt;&gt;&gt; t = ('a', 'b', ['A', 'B'])&gt;&gt;&gt; t[2][0] = 'X'&gt;&gt;&gt; t[2][1] = 'Y'&gt;&gt;&gt; t('a', 'b', ['X', 'Y']) # list æ˜¯å¯ä»¥å˜çš„ æ¡ä»¶åˆ¤æ–­å’Œå¾ªç¯12345678if &lt;æ¡ä»¶åˆ¤æ–­1&gt;: &lt;æ‰§è¡Œ1&gt;elif &lt;æ¡ä»¶åˆ¤æ–­2&gt;: &lt;æ‰§è¡Œ2&gt;elif &lt;æ¡ä»¶åˆ¤æ–­3&gt;: &lt;æ‰§è¡Œ3&gt;else: &lt;æ‰§è¡Œ4&gt; 1234sum = 0for x in range(101): sum = sum + xprint sum 123456sum = 0n = 99while n &gt; 0: sum = sum + n n = n - 2print sum dict å’Œ setPython å†…ç½®äº†å­—å…¸ï¼šdict çš„æ”¯æŒï¼Œdict å…¨ç§° dictionaryï¼Œåœ¨å…¶ä»–è¯­è¨€ä¸­ä¹Ÿç§°ä¸º mapï¼Œä½¿ç”¨é”®-å€¼ï¼ˆkey-valueï¼‰å­˜å‚¨ï¼Œå…·æœ‰æå¿«çš„æŸ¥æ‰¾é€Ÿåº¦ã€‚ dict å¯ä»¥ç”¨åœ¨éœ€è¦é«˜é€ŸæŸ¥æ‰¾çš„å¾ˆå¤šåœ°æ–¹ï¼Œåœ¨ Python ä»£ç ä¸­å‡ ä¹æ— å¤„ä¸åœ¨ï¼Œæ­£ç¡®ä½¿ç”¨ dict éå¸¸é‡è¦ï¼Œéœ€è¦ç‰¢è®°çš„ç¬¬ä¸€æ¡å°±æ˜¯ dict çš„ key å¿…é¡»æ˜¯ä¸å¯å˜å¯¹è±¡ã€‚ 123456789101112&gt;&gt;&gt; d['Adam'] = 67&gt;&gt;&gt; d['Adam']67&gt;&gt;&gt; 'Thomas' in dFalse&gt;&gt;&gt; d.get('Thomas')&gt;&gt;&gt; d.get('Thomas', -1)-1# pop('key') set å’Œ dict ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ä¸€ç»„ key çš„é›†åˆï¼Œä½†ä¸å­˜å‚¨ valueã€‚ç”±äº key ä¸èƒ½é‡å¤ï¼Œæ‰€ä»¥ï¼Œåœ¨ set ä¸­ï¼Œæ²¡æœ‰é‡å¤çš„ keyã€‚ 1234567891011121314&gt;&gt;&gt; s = set([1, 1, 2, 2, 3, 3])&gt;&gt;&gt; sset([1, 2, 3])&gt;&gt;&gt; s.add(4)&gt;&gt;&gt; sset([1, 2, 3, 4])&gt;&gt;&gt; s.add(4)&gt;&gt;&gt; sset([1, 2, 3, 4])&gt;&gt;&gt; s.remove(4)&gt;&gt;&gt; sset([1, 2, 3]) å‡½æ•°å†…ç½®å¸¸ç”¨å‡½æ•°åœ¨äº¤äº’å¼å‘½ä»¤è¡Œé€šè¿‡help(abs)æŸ¥çœ‹abså‡½æ•°çš„å¸®åŠ©ä¿¡æ¯ã€‚ 12345678910111213&gt;&gt;&gt; abs(100)100&gt;&gt;&gt; abs(-20)20&gt;&gt;&gt; abs(12.34)12.34&gt;&gt;&gt; cmp(1, 2)-1&gt;&gt;&gt; cmp(2, 1)1&gt;&gt;&gt; cmp(3, 3)0 æ•°æ®ç±»å‹è½¬æ¢ 1234567891011121314&gt;&gt;&gt; int('123')123&gt;&gt;&gt; int(12.34)12&gt;&gt;&gt; float('12.34')12.34&gt;&gt;&gt; str(1.23)'1.23'&gt;&gt;&gt; unicode(100)u'100'&gt;&gt;&gt; bool(1)True&gt;&gt;&gt; bool('')False å®šä¹‰å‡½æ•°å¦‚æœæ²¡æœ‰returnè¯­å¥ï¼Œå‡½æ•°æ‰§è¡Œå®Œæ¯•åä¹Ÿä¼šè¿”å›ç»“æœï¼Œåªæ˜¯ç»“æœä¸ºNoneã€‚ 1234567def my_abs(x): if not isinstance(x, (int, float)): raise TypeError('bad operand type') if x &gt;= 0: return x else: return -x 12def nop(): pass # ä½œä¸ºå ä½ç¬¦ï¼Œæ¯”å¦‚ç°åœ¨è¿˜æ²¡æƒ³å¥½æ€ä¹ˆå†™å‡½æ•°çš„ä»£ç ï¼Œå°±å¯ä»¥å…ˆæ”¾ä¸€ä¸ª passï¼Œè®©ä»£ç èƒ½è¿è¡Œèµ·æ¥ 1234567891011import mathdef move(x, y, step, angle=0): nx = x + step * math.cos(angle) ny = y - step * math.sin(angle) return nx, ny&gt;&gt;&gt; r = move(100, 100, 60, math.pi / 6)&gt;&gt;&gt; print r(151.96152422706632, 70.0) # è¿”å›å€¼æ˜¯ä¸€ä¸ªtupleï¼Œtuple å¯ä»¥çœç•¥æ‹¬å·ï¼Œè€Œå¤šä¸ªå˜é‡å¯ä»¥åŒæ—¶æ¥æ”¶ä¸€ä¸ª tupleï¼ŒæŒ‰ä½ç½®èµ‹ç»™å¯¹åº”çš„å€¼ å‡½æ•°çš„å‚æ•°12345678910# å¤§å¤šæ•°å­¦ç”Ÿæ³¨å†Œæ—¶ä¸éœ€è¦æä¾›å¹´é¾„å’ŒåŸå¸‚ï¼Œåªæä¾›å¿…é¡»çš„ä¸¤ä¸ªå‚æ•°def enroll(name, gender, age=6, city='Beijing'): print 'name:', name print 'gender:', gender print 'age:', age print 'city:', city # åªæœ‰ä¸é»˜è®¤å‚æ•°ä¸ç¬¦çš„å­¦ç”Ÿæ‰éœ€è¦æä¾›é¢å¤–çš„ä¿¡æ¯enroll('Bob', 'M', 7)enroll('Adam', 'M', city='Tianjin') *argsæ˜¯å¯å˜å‚æ•°ï¼Œargs æ¥æ”¶çš„æ˜¯ä¸€ä¸ª tupleï¼› **kwæ˜¯å…³é”®å­—å‚æ•°ï¼Œkw æ¥æ”¶çš„æ˜¯ä¸€ä¸ª dictã€‚","categories":[{"name":"Python","slug":"Python","permalink":"http://yoursite.com/categories/Python/"}],"tags":[{"name":"åŸºç¡€","slug":"åŸºç¡€","permalink":"http://yoursite.com/tags/%E5%9F%BA%E7%A1%80/"}]},{"title":"å¼€å‘å¸¸ç”¨å·¥å…·ç±»","slug":"åå°æŠ€æœ¯/å¼€å‘å¸¸ç”¨å·¥å…·ç±»","date":"2020-03-12T07:31:13.000Z","updated":"2020-07-10T02:57:49.009Z","comments":true,"path":"2020/03/12/åå°æŠ€æœ¯/å¼€å‘å¸¸ç”¨å·¥å…·ç±»/","link":"","permalink":"http://yoursite.com/2020/03/12/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/%E5%BC%80%E5%8F%91%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E7%B1%BB/","excerpt":"è®°å½•ä¸€ä¸‹å¼€å‘ä¸­ç”¨åˆ°çš„å„ç§å°å·¥å…·ç±»ã€‚","text":"è®°å½•ä¸€ä¸‹å¼€å‘ä¸­ç”¨åˆ°çš„å„ç§å°å·¥å…·ç±»ã€‚ åŠ å¯†ç±»Md512345678910111213141516171819202122232425262728293031323334353637383940414243import java.security.MessageDigest;import org.apache.commons.lang3.StringUtils;public class Md5Util &#123; private Md5Util() &#123; throw new IllegalStateException(\"Utility class\"); &#125; /** * md5 åŠ å¯†é€šç”¨å·¥å…·ç±» * * @param encode éœ€åŠ å¯†çš„å­—ç¬¦ä¸² * @return md5 åŠ å¯†åçš„å­—ç¬¦ä¸²ï¼ˆ32ä½å­—ç¬¦ä¸²ï¼‰ */ public static String md5(String encode) &#123; // æ£€éªŒå‚æ•°æ˜¯å¦æ˜¯ null æˆ–è€… \"\" æˆ–è€… \" \" ç­‰ if (StringUtils.isBlank(encode)) &#123; return \"\"; &#125; char[] hexDigits = &#123;'0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f'&#125;; try &#123; // è®¾ç½®å­—ç¬¦é›† byte[] strTemp = encode.getBytes(StandardCharsets.UTF_8); // ç”Ÿæˆä¸€ä¸ª md5 åŠ å¯†è®¡ç®—æ‘˜è¦ MessageDigest mdTemp = MessageDigest.getInstance(\"MD5\"); // è®¡ç®— md5 å‡½æ•° mdTemp.update(strTemp); // digest() æœ€åç¡®å®šè¿”å› md5 hash å€¼ï¼Œè¿”å›å€¼ä¸º 8 ä½å­—ç¬¦ä¸²ã€‚å› ä¸º md5 hash å€¼æ˜¯ 16 ä½çš„ hex å€¼ï¼Œå®é™…ä¸Šå°±æ˜¯ 8 ä½çš„å­—ç¬¦ byte[] md = mdTemp.digest(); int j = md.length; char[] str = new char[j * 2]; int k = 0; for (byte byte0 : md) &#123; // ä¸å¸¦ç¬¦å·å³ç§»å››ä½(ä¸ç®¡ byte0 çš„ç±»å‹ ä½ç§»å¤„è¡¥ 0)ï¼Œ&amp; åå…­è¿›åˆ¶çš„ f å³ é«˜å››ä½æ¸…ç©º å–ä½å››ä½çš„å€¼ï¼Œ&gt;&gt;&gt; ä¼˜å…ˆçº§é«˜äº &amp; str[k++] = hexDigits[byte0 &gt;&gt;&gt; 4 &amp; 0xf]; str[k++] = hexDigits[byte0 &amp; 0xf]; &#125; return new String(str); &#125; catch (Exception e) &#123; return \"\"; &#125; &#125;&#125; JsonFastJson12345&lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;fastjson&lt;/artifactId&gt; &lt;version&gt;1.1.26&lt;/version&gt;&lt;/dependency&gt; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128public class FastJsonConvertUtil &#123; private static final SerializerFeature[] featuresWithNullValue = &#123; SerializerFeature.WriteMapNullValue, SerializerFeature.WriteNullBooleanAsFalse, SerializerFeature.WriteNullListAsEmpty, SerializerFeature.WriteNullNumberAsZero, SerializerFeature.WriteNullStringAsEmpty &#125;; /** * &lt;B&gt;æ–¹æ³•åç§°ï¼š&lt;/B&gt;å°†JSONå­—ç¬¦ä¸²è½¬æ¢ä¸ºå®ä½“å¯¹è±¡&lt;BR&gt; * &lt;B&gt;æ¦‚è¦è¯´æ˜ï¼š&lt;/B&gt;å°†JSONå­—ç¬¦ä¸²è½¬æ¢ä¸ºå®ä½“å¯¹è±¡&lt;BR&gt; * @param data JSONå­—ç¬¦ä¸² * @param clzss è½¬æ¢å¯¹è±¡ * @return T */ public static &lt;T&gt; T convertJSONToObject(String data, Class&lt;T&gt; clzss) &#123; try &#123; T t = JSON.parseObject(data, clzss); return t; &#125; catch (Exception e) &#123; e.printStackTrace(); return null; &#125; &#125; /** * &lt;B&gt;æ–¹æ³•åç§°ï¼š&lt;/B&gt;å°†JSONObjectå¯¹è±¡è½¬æ¢ä¸ºå®ä½“å¯¹è±¡&lt;BR&gt; * &lt;B&gt;æ¦‚è¦è¯´æ˜ï¼š&lt;/B&gt;å°†JSONObjectå¯¹è±¡è½¬æ¢ä¸ºå®ä½“å¯¹è±¡&lt;BR&gt; * @param data JSONObjectå¯¹è±¡ * @param clzss è½¬æ¢å¯¹è±¡ * @return T */ public static &lt;T&gt; T convertJSONToObject(JSONObject data, Class&lt;T&gt; clzss) &#123; try &#123; T t = JSONObject.toJavaObject(data, clzss); return t; &#125; catch (Exception e) &#123; e.printStackTrace(); return null; &#125; &#125; /** * &lt;B&gt;æ–¹æ³•åç§°ï¼š&lt;/B&gt;å°†JSONå­—ç¬¦ä¸²æ•°ç»„è½¬ä¸ºListé›†åˆå¯¹è±¡&lt;BR&gt; * &lt;B&gt;æ¦‚è¦è¯´æ˜ï¼š&lt;/B&gt;å°†JSONå­—ç¬¦ä¸²æ•°ç»„è½¬ä¸ºListé›†åˆå¯¹è±¡&lt;BR&gt; * @param data JSONå­—ç¬¦ä¸²æ•°ç»„ * @param clzss è½¬æ¢å¯¹è±¡ * @return List&lt;T&gt;é›†åˆå¯¹è±¡ */ public static &lt;T&gt; List&lt;T&gt; convertJSONToArray(String data, Class&lt;T&gt; clzss) &#123; try &#123; List&lt;T&gt; t = JSON.parseArray(data, clzss); return t; &#125; catch (Exception e) &#123; e.printStackTrace(); return null; &#125; &#125; /** * &lt;B&gt;æ–¹æ³•åç§°ï¼š&lt;/B&gt;å°†List&lt;JSONObject&gt;è½¬ä¸ºListé›†åˆå¯¹è±¡&lt;BR&gt; * &lt;B&gt;æ¦‚è¦è¯´æ˜ï¼š&lt;/B&gt;å°†List&lt;JSONObject&gt;è½¬ä¸ºListé›†åˆå¯¹è±¡&lt;BR&gt; * @param data List&lt;JSONObject&gt; * @param clzss è½¬æ¢å¯¹è±¡ * @return List&lt;T&gt;é›†åˆå¯¹è±¡ */ public static &lt;T&gt; List&lt;T&gt; convertJSONToArray(List&lt;JSONObject&gt; data, Class&lt;T&gt; clzss) &#123; try &#123; List&lt;T&gt; t = new ArrayList&lt;T&gt;(); for (JSONObject jsonObject : data) &#123; t.add(convertJSONToObject(jsonObject, clzss)); &#125; return t; &#125; catch (Exception e) &#123; e.printStackTrace(); return null; &#125; &#125; /** * &lt;B&gt;æ–¹æ³•åç§°ï¼š&lt;/B&gt;å°†å¯¹è±¡è½¬ä¸ºJSONå­—ç¬¦ä¸²&lt;BR&gt; * &lt;B&gt;æ¦‚è¦è¯´æ˜ï¼š&lt;/B&gt;å°†å¯¹è±¡è½¬ä¸ºJSONå­—ç¬¦ä¸²&lt;BR&gt; * @param obj ä»»æ„å¯¹è±¡ * @return JSONå­—ç¬¦ä¸² */ public static String convertObjectToJSON(Object obj) &#123; try &#123; String text = JSON.toJSONString(obj); return text; &#125; catch (Exception e) &#123; e.printStackTrace(); return null; &#125; &#125; /** * &lt;B&gt;æ–¹æ³•åç§°ï¼š&lt;/B&gt;å°†å¯¹è±¡è½¬ä¸ºJSONObjectå¯¹è±¡&lt;BR&gt; * &lt;B&gt;æ¦‚è¦è¯´æ˜ï¼š&lt;/B&gt;å°†å¯¹è±¡è½¬ä¸ºJSONObjectå¯¹è±¡&lt;BR&gt; * @param obj ä»»æ„å¯¹è±¡ * @return JSONObjectå¯¹è±¡ */ public static JSONObject convertObjectToJSONObject(Object obj)&#123; try &#123; JSONObject jsonObject = (JSONObject) JSONObject.toJSON(obj); return jsonObject; &#125; catch (Exception e) &#123; e.printStackTrace(); return null; &#125; &#125; /** * &lt;B&gt;æ–¹æ³•åç§°ï¼š&lt;/B&gt;&lt;BR&gt; * &lt;B&gt;æ¦‚è¦è¯´æ˜ï¼š&lt;/B&gt;&lt;BR&gt; * @param obj * @return */ public static String convertObjectToJSONWithNullValue(Object obj) &#123; try &#123; String text = JSON.toJSONString(obj, featuresWithNullValue); return text; &#125; catch (Exception e) &#123; e.printStackTrace(); return null; &#125; &#125;&#125;","categories":[{"name":"åå°æŠ€æœ¯","slug":"åå°æŠ€æœ¯","permalink":"http://yoursite.com/categories/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"å¼€å‘å·¥å…·","slug":"å¼€å‘å·¥å…·","permalink":"http://yoursite.com/tags/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/"}]},{"title":"ç”¨æˆ·ç®¡ç†ç³»ç»Ÿ","slug":"é¡¹ç›®å¼€å‘/ç”¨æˆ·ç®¡ç†ç³»ç»Ÿ","date":"2020-03-07T08:44:21.000Z","updated":"2020-07-10T03:53:02.284Z","comments":true,"path":"2020/03/07/é¡¹ç›®å¼€å‘/ç”¨æˆ·ç®¡ç†ç³»ç»Ÿ/","link":"","permalink":"http://yoursite.com/2020/03/07/%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91/%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/","excerpt":"åŸºäº Spring Boot çš„ç”¨æˆ·ç®¡ç†ç³»ç»Ÿã€‚","text":"åŸºäº Spring Boot çš„ç”¨æˆ·ç®¡ç†ç³»ç»Ÿã€‚ å‡†å¤‡å·¥ä½œåŠŸèƒ½æ¨¡å—åˆ†æï¼š æ•°æ®åº“è¡¨åˆ†æï¼š æ•°æ®åº“å»ºè¡¨è¯­å¥ï¼š 1234567891011CREATE TABLE `user_manage_demo` ( `user_id` bigint(11) unsigned NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®idï¼Œç”¨æˆ·id', `username` varchar(50) NOT NULL COMMENT 'ç”¨æˆ·å', `password` varchar(100) NOT NULL COMMENT 'ç”¨æˆ·å¯†ç ', `type` char(1) unsigned NOT NULL COMMENT 'ç”¨æˆ·ç±»å‹ï¼ˆ1ï¼šç®¡ç†å‘˜ï¼›0ï¼šæ™®é€šç”¨æˆ·ï¼‰', `gmt_create` datetime NOT NULL COMMENT 'è®°å½•åˆ›å»ºæ—¶é—´', `gmt_modified` datetime NOT NULL COMMENT 'è®°å½•ä¿®æ”¹æ—¶é—´', `is_delete` tinyint(1) unsigned NOT NULL DEFAULT '0' COMMENT 'è®°å½•æ˜¯å¦é€»è¾‘åˆ é™¤ï¼ˆ0ï¼šæœªåˆ é™¤ï¼›1ï¼šå·²åˆ é™¤ï¼‰', PRIMARY KEY (`user_id`), UNIQUE KEY `uk_name_type` (`username`,`type`) USING BTREE COMMENT 'ç”¨æˆ·åç§°ã€ç±»å‹å”¯ä¸€ç´¢å¼•') ENGINE=InnoDB AUTO_INCREMENT=6 DEFAULT CHARSET=utf8mb4 COMMENT='ç”¨æˆ·ç®¡ç†è¡¨'; åœ¨æ•°æ®åº“è¡¨ä¸­åˆå§‹åŒ–ä¸€æ¡ç®¡ç†å‘˜æ•°æ®ï¼š 1234INSERT INTO `springboot_user`.`user` (`user_id`, `username`, `password`, `type`, `gmt_create`, `gmt_modified`, `is_delete`) VALUES (1, 'admin', '123456', \"1\", '2019-05-19 20:26:22', '2019-05-19 20:26:27', 0); æ¥å£çš„è®¾è®¡ ä¸ºäº†é¡¹ç›®ä»£ç æ›´åŠ ç®€æ´ï¼Œæ­¤é¡¹ç›®æ·»åŠ äº† Lombok æ”¯æŒä¾èµ–å¹¶ä¸” IDEA æ·»åŠ äº†ç›¸åº”çš„ Lombok æ’ä»¶ï¼Œé€šè¿‡åœ¨ç±»æ³¨é‡Š@Dataä¸ºç›¸åº”çš„ç±»æ·»åŠ Getter/Setterï¼ŒtoString()ï¼Œequals() ç­‰æ–¹æ³•ã€‚ 123456&lt;!-- æ·»åŠ  Lombok çš„æ”¯æŒ --&gt;&lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;scope&gt;provided&lt;/scope&gt;&lt;/dependency&gt; å°†å‰ç«¯ä¼ è¾“è¿‡æ¥çš„çš„æ•°æ®å°è£…åœ¨å¯¹åº”çš„ DTO ç±»ä¸­ï¼Œç”¨äºå±•ç¤ºå±‚ä¸æœåŠ¡å±‚ä¹‹é—´çš„æ•°æ®ä¼ è¾“å¯¹è±¡ã€‚ï¼ˆView ğŸ‘‰ Action ğŸ‘‰ Srviceï¼‰ DTOï¼šData Transfer Objectï¼ˆæ•°æ®ä¼ è¾“å¯¹è±¡ï¼‰DTO æ˜¯ä¸€ç»„éœ€è¦è·¨è¿›ç¨‹æˆ–ç½‘ç»œè¾¹ç•Œä¼ è¾“çš„èšåˆæ•°æ®çš„ç®€å•å®¹å™¨ã€‚å®ƒä¸åº”è¯¥åŒ…å«ä¸šåŠ¡é€»è¾‘ï¼Œå¹¶å°†å…¶è¡Œä¸ºé™åˆ¶ä¸ºè¯¸å¦‚å†…éƒ¨ä¸€è‡´æ€§æ£€æŸ¥å’ŒåŸºæœ¬éªŒè¯ä¹‹ç±»çš„æ´»åŠ¨ã€‚ å°†è¿”å›å‰ç«¯çš„æ•°æ®å°è£…åœ¨å¯¹åº”çš„ VO ç±»ä¸­ã€‚ VOï¼šView Objectï¼ˆè§†å›¾å¯¹è±¡ï¼‰VO çš„ä½œç”¨æ˜¯æŠŠæŸä¸ªæŒ‡å®šé¡µé¢ï¼ˆæˆ–ç»„ä»¶ï¼‰çš„æ‰€æœ‰æ•°æ®å°è£…èµ·æ¥ã€‚ DTO ç±»çš„ç¼–å†™åœ¨ DTO ç±»ä¸­æ·»åŠ  JSR303 æ ¡éªŒã€‚ JSR303 æ˜¯ä¸€é¡¹æ ‡å‡†ï¼ŒJSR-349 æ˜¯å…¶çš„å‡çº§ç‰ˆæœ¬ï¼Œæ·»åŠ äº†ä¸€äº›æ–°ç‰¹æ€§ï¼Œä»–ä»¬è§„å®šä¸€äº›æ ¡éªŒè§„èŒƒå³æ ¡éªŒæ³¨è§£ï¼Œå¦‚ @Nullï¼Œ@NotNullï¼Œ@Patternï¼Œåœ¨ javax.validation.constraints åŒ…ä¸‹ï¼Œåªæä¾›è§„èŒƒä¸æä¾›å®ç°ã€‚ Hibernat Validation æ˜¯å¯¹è¿™ä¸ªè§„èŒƒçš„å®è·µï¼ˆä¸è¦å°† Hibernate å’Œæ•°æ®åº“ ORM æ¡†æ¶è”ç³»åœ¨ä¸€èµ·ï¼‰ï¼Œä»–æä¾›äº†ç›¸åº”çš„å®ç°ï¼Œå¹¶å¢åŠ äº†ä¸€äº›å…¶ä»–æ ¡éªŒæ³¨è§£ï¼Œå¦‚@Emailï¼Œ@Lengthï¼Œ@Rangeç­‰ç­‰ï¼Œåœ¨ org.hibernate.validator.constraints åŒ…ä¸‹ã€‚ Spring ä¸ºäº†ç»™å¼€å‘è€…æä¾›ä¾¿æ·ï¼Œå¯¹ Hibernate Validation è¿›è¡Œäº†äºŒæ¬¡å°è£…ï¼Œæ˜¾ç¤ºæ ¡éªŒ Validated Bean æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ Spring validation æˆ–è€… Hibernate validationï¼Œè€Œ Spring Validation å¦ä¸€ä¸ªç‰¹æ€§ï¼Œä¾¿æ˜¯å…¶åœ¨ Spring MVC æ¨¡å—ä¸­æ·»åŠ äº†è‡ªåŠ¨æ ¡éªŒï¼Œå¹¶å°†æ ¡éªŒä¿¡æ¯å°è£…è¿›äº†ç‰¹å®šçš„ç±»ä¸­ã€‚è¿™æ— ç–‘ä¾¿æ·äº†æˆ‘ä»¬çš„ web å¼€å‘ã€‚ 12345678910111213141516171819202122232425/*** DTO ç±»ç¤ºä¾‹* @NotBlank ç”¨äº Stringï¼ˆä¼šå»æ‰ç©ºæ ¼ï¼‰* @NotNull ç”¨äº Integer* @Data è‡ªåŠ¨ç”Ÿæˆ Getter/Setterï¼ŒtoString()ï¼Œequals() ç­‰æ–¹æ³•*/@Datapublic class LoginDTO implements Serializable &#123; private static final long serialVersionUID = 1L; /** ç”¨æˆ·å */ @NotBlank(message = \"ç”¨æˆ·åä¸èƒ½ä¸ºç©º\") private String username; /** ç”¨æˆ·å¯†ç  */ @NotBlank(message = \"ç”¨æˆ·å¯†ç ä¸èƒ½ä¸ºç©º\") private String password; /** éªŒè¯ç  */ @NotBlank(message = \"éªŒè¯ç ä¸èƒ½ä¸ºç©º\") private String checkCode; /** ç±»å‹ */ @NotNull(message = \"ç”¨æˆ·ç±»å‹ä¸èƒ½ä¸ºç©º\") private String type;&#125; VO ç±»çš„ç¼–å†™ 12345678910111213141516171819/*** VO ç±»ç¤ºä¾‹* ç®¡ç†å‘˜ç”¨æˆ·åˆ—è¡¨é¡µé¢çš„ç”¨æˆ·ä¿¡æ¯è¿”å›å¯¹è±¡*/@Datapublic class ViewVO implements Serializable &#123; private static final long serialVersionUID = 1L; /** ç”¨æˆ·æ ‡è¯† */ private Integer userId; /** ç”¨æˆ·å */ private String username; /** ç”¨æˆ·ç±»å‹ */ private String type; /** ç”¨æˆ·åˆ›å»ºæ—¶é—´ */ private Date gtmCreate;&#125; é™æ€å¸¸é‡ç±»å°†é¡¹ç›®ä¸­ä¸€äº›å›ºå®šçš„å­—é¢é‡å®šä¹‰ä¸ºä¸å¯å˜çš„é™æ€å¸¸é‡public static finalã€‚ UrlConstant123456789101112131415161718192021222324/*** URL é™æ€å¸¸é‡ç±»*/public final class UrlConstant &#123; /** æ·»åŠ ç§æœ‰çš„æ„é€ å‡½æ•°ï¼Œé˜²æ­¢é™æ€å¸¸é‡ç±»æ„é€ å…¶å®ƒçš„å®ä¾‹ï¼Œç„¶åæ”¹å˜é™æ€å¸¸é‡çš„å€¼ */ private UrlConstant() &#123; throw new IllegalStateException(\"Utility class\"); &#125; /** è·³è½¬é¦–é¡µ URL */ public static final String INDEX = \"/index\"; /** è·³è½¬æ³¨å†Œ URL */ public static final String REGISTER = \"/register\"; /** è·³è½¬ç™»å½• URL */ public static final String LOGIN = \"/login\"; /** è·³è½¬æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨ URL */ public static final String VIEW = \"/view\"; /** è·³è½¬æ–°å¢ç”¨æˆ· URL */ public static final String USER = \"/user\"; /** è·³è½¬ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ URL */ public static final String MODIFY = \"/modify\";&#125; UserTypeConstant12345678910111213141516171819202122232425262728293031/*** ç”¨æˆ·ç±»å‹é™æ€å¸¸é‡ç±»*/public final class UserTypeConstant &#123; /** æ·»åŠ ç§æœ‰çš„æ„é€ å‡½æ•°ï¼Œé˜²æ­¢é™æ€å¸¸é‡ç±»æ„é€ å…¶å®ƒçš„å®ä¾‹ï¼Œç„¶åæ”¹å˜é™æ€å¸¸é‡çš„å€¼ */ private UserTypeConstant() &#123; throw new IllegalStateException(\"Utility class\"); &#125; /** ç®¡ç†å‘˜ç”¨æˆ· */ public static final String ADMIN = 1; /** æ™®é€šç”¨æˆ· */ public static final String ORDINARY = 0; /** * ç”¨æˆ·ç±»å‹ä»£ç è½¬æè¿° * * @param type ç”¨æˆ·ç±»å‹ * @return ç”¨æˆ·ç±»å‹ä¸­æ–‡æè¿° */ public static String typeToDesc(Sting type) &#123; if (UserTypeConstant.ADMIN.equals(type)) &#123; return \"ç®¡ç†å‘˜\"; &#125; else if (UserTypeConstant.ORDINARY.equals(type)) &#123; return \"æ™®é€šç”¨æˆ·\"; &#125; else &#123; return \"æœªçŸ¥èº«ä»½ï¼Œè¯·è”ç³»ç³»ç»Ÿç®¡ç†å‘˜\"; &#125; &#125; ImageCodeConstant123456789101112131415161718192021222324252627public final class ImageCodeConstant &#123; /** æ·»åŠ ç§æœ‰çš„æ„é€ å‡½æ•°ï¼Œé˜²æ­¢é™æ€å¸¸é‡ç±»æ„é€ å…¶å®ƒçš„å®ä¾‹ï¼Œç„¶åæ”¹å˜é™æ€å¸¸é‡çš„å€¼ */ private ImageCodeConstant() &#123; throw new IllegalStateException(\"Utility class\"); &#125; /** éªŒè¯ç ç”Ÿæˆçš„æ—¶é—´ */ public static final String CODE_TIME = \"codeTime\"; /** éªŒè¯ç è¿‡æœŸæ—¶é—´ï¼Œå•ä½ï¼šåˆ†é’Ÿ */ public static final int CAPTCHA_EXPIRY_TIME = 5; /** ç§’/æ¯«ç§’æ¢ç®— */ public static final int MILLISECOND_CONVERSION = 1000; /** åˆ†é’Ÿ/ç§’æ¢ç®— */ public static final int MINUTE_CONVERSION = 60; /** ç”ŸæˆéªŒè¯ç çš„å˜é‡åç§° */ public static final String SIMPLE_CAPTCHA = \"simpleCaptcha\"; /** ç”ŸæˆéªŒè¯ç çš„å˜é‡å€¼ */ public static final String CAPTCHA_VALUE = \"captchaValue\"; /** ç”Ÿæˆçš„éªŒè¯ç å›¾å½¢çš„å˜é‡å */ public static final String IMAGE = \"image\"; /** ç”Ÿæˆçš„å›¾å½¢éªŒè¯ç æ–‡ä»¶æ ¼å¼åŒ–çš„åç§° */ public static final String JPEG = \"JPEG\"; /** å›¾ç‰‡å­—ç¬¦æ¶‰åŠçš„ç½—é©¬å­—ä½“å */ public static final String TIMES_NEW_ROMAN = \"Times New Roman\";&#125; RespoonseConstant12345678910111213141516171819202122public final class ResponseConstant &#123; /** æ·»åŠ ç§æœ‰çš„æ„é€ å‡½æ•°ï¼Œé˜²æ­¢é™æ€å¸¸é‡ç±»æ„é€ å…¶å®ƒçš„å®ä¾‹ï¼Œç„¶åæ”¹å˜é™æ€å¸¸é‡çš„å€¼ */ private ResponseConstant() &#123; throw new IllegalStateException(\"Utility class\"); &#125; /** å¤„ç†æˆåŠŸæ—¶è¿”å›çš„ Code */ public static final String SUCCESS = \"200\"; /** ä¸šåŠ¡å¤„ç†å¤±è´¥æ—¶è¿”å›çš„ Code */ public static final String FAIL = \"-1\"; /** è¿”å›ä¿¡æ¯çš„ Key å¸¸é‡å€¼ */ public static final String RESPONSE_VO = \"responseVO\"; /** è¿”å›çŠ¶æ€ç å¸¸é‡å€¼ */ public static final String CODE = \"code\"; /** è¿”å›çŠ¶æ€ä¿¡æ¯å¸¸é‡å€¼ */ public static final String MESSAGE = \"message\"&#125; UserConstant1234567891011121314public final class UserConstant &#123; /** æ·»åŠ ç§æœ‰çš„æ„é€ å‡½æ•°ï¼Œé˜²æ­¢é™æ€å¸¸é‡ç±»æ„é€ å…¶å®ƒçš„å®ä¾‹ï¼Œç„¶åæ”¹å˜é™æ€å¸¸é‡çš„å€¼ */ private UserConstant() &#123; throw new IllegalStateException(\"Utility class\"); &#125; /** Session ä¸­çš„ç”¨æˆ·åå¸¸é‡çš„å­—æ®µåç§°ï¼Œå¤šå¤„ä½¿ç”¨ç»Ÿä¸€åœ¨è¿™é‡Œå®šä¹‰ï¼Œé¿å… SonarLint é­”æ³•å€¼çš„å‘Šè­¦ */ public static final String USERNAME = \"username\"; /** Session ä¸­çš„ç”¨æˆ·ç±»å‹å¸¸é‡çš„å­—æ®µåç§°ï¼Œå¤šå¤„ä½¿ç”¨ç»Ÿä¸€åœ¨è¿™é‡Œå®šä¹‰ï¼Œé¿å… SonarLint é­”æ³•å€¼çš„å‘Šè­¦ */ public static final String TYPE = \"type\"; /** Session ä¸­çš„ç”¨æˆ·ç±»å‹åç§°å¸¸é‡çš„å­—æ®µåç§°ï¼Œå¤šå¤„ä½¿ç”¨ç»Ÿä¸€åœ¨è¿™é‡Œå®šä¹‰ï¼Œé¿å… SonarLint é­”æ³•å€¼çš„å‘Šè­¦ */ public static final String TYPE_NAME = \"typeName\";&#125; å·¥å…·ç±»MD5 å¯†ç åŠ å¯†1234567891011121314151617181920212223242526272829303132333435363738394041public class Md5Util &#123; private Md5Util() &#123; throw new IllegalStateException(\"Utility class\"); &#125; /** * md5 åŠ å¯†é€šç”¨å·¥å…·ç±» * * @param encode éœ€åŠ å¯†çš„å­—ç¬¦ä¸² * @return md5 åŠ å¯†åçš„å­—ç¬¦ä¸²ï¼ˆ32ä½å­—ç¬¦ä¸²ï¼‰ */ public static String md5(String encode) &#123; // æ£€éªŒå‚æ•°æ˜¯å¦æ˜¯ null æˆ–è€… \"\" æˆ–è€… \" \" ç­‰ if (StringUtils.isBlank(encode)) &#123; return \"\"; &#125; char[] hexDigits = &#123;'0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f'&#125;; try &#123; // è®¾ç½®å­—ç¬¦é›† byte[] strTemp = encode.getBytes(StandardCharsets.UTF_8); // ç”Ÿæˆä¸€ä¸ª md5 åŠ å¯†è®¡ç®—æ‘˜è¦ MessageDigest mdTemp = MessageDigest.getInstance(\"MD5\"); // è®¡ç®— md5 å‡½æ•° mdTemp.update(strTemp); // digest() æœ€åç¡®å®šè¿”å› md5 hash å€¼ï¼Œè¿”å›å€¼ä¸º 8 ä½å­—ç¬¦ä¸²ã€‚å› ä¸º md5 hash å€¼æ˜¯ 16 ä½çš„ hex å€¼ï¼Œå®é™…ä¸Šå°±æ˜¯ 8 ä½çš„å­—ç¬¦ byte[] md = mdTemp.digest(); int j = md.length; char[] str = new char[j * 2]; int k = 0; for (byte byte0 : md) &#123; // ä¸å¸¦ç¬¦å·å³ç§»å››ä½(ä¸ç®¡ byte0 çš„ç±»å‹ ä½ç§»å¤„è¡¥ 0)ï¼Œ&amp; åå…­è¿›åˆ¶çš„ f å³ é«˜å››ä½æ¸…ç©º å–ä½å››ä½çš„å€¼ï¼Œ&gt;&gt;&gt; ä¼˜å…ˆçº§é«˜äº &amp; str[k++] = hexDigits[byte0 &gt;&gt;&gt; 4 &amp; 0xf]; str[k++] = hexDigits[byte0 &amp; 0xf]; &#125; return new String(str); &#125; catch (Exception e) &#123; return \"\"; &#125; &#125;&#125; éªŒè¯ç ç”Ÿæˆ123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293public class ImageCodeUtil &#123; private ImageCodeUtil() &#123; throw new IllegalStateException(\"Utility class\"); &#125; /** ç”ŸæˆéªŒè¯ç å›¾ç‰‡çš„é»˜è®¤å®½åº¦ */ private static final int IMAGE_WIDTH = 60; /** ç”ŸæˆéªŒè¯ç å›¾ç‰‡çš„é»˜è®¤é«˜åº¦ */ private static final int IMAGE_HEIGHT = 20; /** éšæœºå¹²æ‰°çº¿çš„æ¡æ•°ï¼Œå¤ªç¨€ç–æˆ–è€…å¤ªå¯†ç»‡éƒ½è¾¾ä¸åˆ°å¹²æ‰°çš„æ•ˆæœ */ private static final int RAND_COLOR = 168; /** é¢œè‰²æ•°å€¼çš„ä¸Šé™ï¼Œä¸‰åŸè‰²çš„èŒƒå›´éƒ½æ˜¯ [0, 255] èŒƒå›´ */ private static final int COLOR_MAX = 255; /** å¯æ ¹æ®éœ€è¦æ¥ä¿®æ”¹ï¼Œç”Ÿæˆçº¯æ•°å­—æˆ–è€…çº¯å­—æ¯ï¼Œæˆ–è€…é»˜è®¤è¿™ç§æ··åˆçš„ */ private static char[] mapTable = &#123;'0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'&#125;; /** * ç”Ÿæˆå›¾å½¢éªŒè¯ç  * * @param width ç”Ÿæˆçš„å›¾å½¢éªŒè¯ç çš„å®½åº¦ * @param height ç”Ÿæˆçš„å›¾å½¢éªŒè¯ç çš„é«˜åº¦ * @param verifySize éœ€è¦ç”Ÿæˆçš„éªŒè¯ç ä½æ•° * @return éªŒè¯ç çš„å›¾ç‰‡å¯¹è±¡åŠéªŒè¯ç çš„å€¼ */ public static Map&lt;String, Object&gt; getImageCode(int width, int height, int verifySize) throws NoSuchAlgorithmException &#123; Map&lt;String, Object&gt; returnMap = new HashMap&lt;&gt;(6); // ç¡®ä¿éªŒè¯ç çš„å®½åº¦å’Œé«˜åº¦ä¸èƒ½å°äºæˆ–ç­‰äºé›¶ width = width &lt;= 0 ? IMAGE_WIDTH : width; height = height &lt;= 0 ? IMAGE_HEIGHT : height; // BufferedImage æ˜¯ Image çš„ä¸€ä¸ªå­ç±»ï¼ŒImage å’Œ BufferedImage // ä¸»è¦ä½œç”¨å°±æ˜¯å°†ä¸€å‰¯å›¾ç‰‡åŠ è½½åˆ°å†…å­˜ä¸­ï¼ŒBufferedImage ç”Ÿæˆçš„å›¾ç‰‡åœ¨å†…å­˜é‡Œæœ‰ä¸€ä¸ªå›¾åƒç¼“å†²åŒº // åˆ©ç”¨è¿™ä¸ªç¼“å†²åŒºæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿çš„æ“ä½œè¿™ä¸ªå›¾ç‰‡ï¼Œé€šå¸¸ç”¨æ¥åšå›¾ç‰‡ä¿®æ”¹æ“ä½œå¦‚å¤§å°å˜æ¢ã€å›¾ç‰‡å˜ç°ã€è®¾ç½®å›¾ç‰‡é€æ˜æˆ–ä¸é€æ˜ç­‰ BufferedImage image = new BufferedImage(width, height, BufferedImage.TYPE_INT_RGB); // è·å–å›¾å½¢ä¸Šä¸‹æ–‡ Graphics g = image.getGraphics(); // ç”Ÿæˆéšæœºç±» Random random = SecureRandom.getInstanceStrong(); // è®¾å®šèƒŒæ™¯è‰² g.setColor(getRandColor(200, 250)); // ç”»é•¿æ–¹å½¢ g.fillRect(0, 0, width, height); // è®¾å®šå­—ä½“ g.setFont(new Font(ImageCodeConstant.TIMES_NEW_ROMAN, Font.PLAIN, 18)); // å†æ¬¡è®¾ç½®èƒŒæ™¯è‰²ï¼Œå®æµ‹è·Ÿå‰ä¸€æ¬¡è®¾ç½®èƒŒæ™¯è‰²æœ‰å åŠ çš„æ•ˆæœï¼Œä¼šè®©èƒŒæ™¯é¢œè‰²çœ‹èµ·æ¥æ›´å¤æ‚ g.setColor(getRandColor(160, 200)); // éšæœºäº§ç”Ÿ 168 æ¡å¹²æ‰°çº¿ï¼Œä½¿å›¾è±¡ä¸­çš„è®¤è¯ç ä¸æ˜“è¢«å…¶å®ƒç¨‹åºæ¢æµ‹åˆ° for (int i = 0; i &lt; RAND_COLOR; i++) &#123; // nextInt(n) ä¼šè¿”å› [0, n) ä¹‹é—´çš„éšæœºæ•° int x = random.nextInt(width); int y = random.nextInt(height); int xl = random.nextInt(12); int yl = random.nextInt(12); // x: çº¿æ®µèµ·ç‚¹çš„æ¨ªåæ ‡ï¼›y: çº¿æ®µèµ·ç‚¹çš„çºµåæ ‡ï¼›x + xl: çº¿æ®µç»ˆç‚¹çš„æ¨ªåæ ‡ï¼›y + yl: çº¿æ®µç»ˆç‚¹çš„çºµåæ ‡ g.drawLine(x, y, x + xl, y + yl); &#125; // å®šä¹‰éªŒè¯ç çš„å€¼ StringBuilder captchaValue = new StringBuilder(); // 4ä»£è¡¨éªŒè¯ç ä½æ•°ï¼Œå¦‚æœè¦ç”Ÿæˆæ›´å¤šä½çš„è®¤è¯ç ï¼Œåˆ™åŠ å¤§æ•°å€¼ for (int i = 0; i &lt; verifySize; ++i) &#123; captchaValue.append(mapTable[random.nextInt(mapTable.length)]); // å°†è®¤è¯ç æ˜¾ç¤ºåˆ°å›¾è±¡ä¸­ g.setColor(new Color(20 + random.nextInt(110), 20 + random.nextInt(110), 20 + random.nextInt(110))); // ç›´æ¥ç”Ÿæˆ String str = captchaValue.substring(i, i + 1); // ä½¿ç”¨æ­¤å›¾å½¢ä¸Šä¸‹æ–‡çš„å½“å‰å­—ä½“å’Œé¢œè‰²ç»˜åˆ¶ç”±æŒ‡å®š string ç»™å®šçš„æ–‡æœ¬ g.drawString(str, 13 * i + 6, 16); &#125; // é‡Šæ”¾å›¾å½¢ä¸Šä¸‹æ–‡èµ„æº g.dispose(); // ç»„è£…å›¾åƒç»“æœåŠéªŒè¯ç å€¼å¹¶è¿”å› returnMap.put(ImageCodeConstant.IMAGE, image); returnMap.put(ImageCodeConstant.CAPTCHA_VALUE, captchaValue.toString()); return returnMap; &#125; /** ç»™å®šèŒƒå›´è·å¾—éšæœºé¢œè‰² */ private static Color getRandColor(int fc, int bc) throws NoSuchAlgorithmException &#123; // åˆ›å»ºä¸€ä¸ªéšæœºæ•°ç”Ÿæˆå¯¹è±¡çš„å®ä¾‹ Random random = SecureRandom.getInstanceStrong(); // é¢œè‰²å€¼ä¸èƒ½è¶…è¿‡æœ€å¤§èŒƒå›´ fc = fc &gt; COLOR_MAX ? COLOR_MAX : fc; bc = bc &gt; COLOR_MAX ? COLOR_MAX : bc; // nextInt(n) ä¼šè¿”å› [0, n) ä¹‹é—´çš„éšæœºæ•° int r = fc + random.nextInt(bc - fc); int g = fc + random.nextInt(bc - fc); int b = fc + random.nextInt(bc - fc); // æŒ‰éšæœºç”Ÿæˆçš„ rã€gã€b å€¼è®¾ç½®é¢œè‰²å¹¶è¿”å› return new Color(r, g, b); &#125;&#125; å®ä½“ç±»å®ä½“ç±»çš„å±æ€§ä¸æ•°æ®åº“çš„å­—æ®µç›¸å¯¹åº”ã€‚ 12345678910111213141516171819202122@Datapublic class UserMybatis &#123; private static final long serialVersionUID = 1L; /** ç”¨æˆ· id */ private Integer userId; /** ç”¨æˆ·å */ private String username; /** ç”¨æˆ·å¯†ç  */ private String password; /** ç”¨æˆ·ç±»å‹ */ private String type; /** è®°å½•åˆ›å»ºæ—¶é—´ */ @DateTimeFormat(pattern = \"yyyy-MM-dd HH:mm:ss\") private Date gmtCreate; /** è®°å½•ä¿®æ”¹æ—¶é—´ */ @DateTimeFormat(pattern = \"yyyy-MM-dd HH:mm:ss\") private Date gmtModified; /** è®°å½•æ˜¯å¦åˆ é™¤ */ private Boolean isDelete;&#125; æ•°æ®æºé…ç½®æ•°æ®æºï¼š 12345678# æ•°æ®æºé…ç½®# serverTimezone=Asia/Shanghai è¿™ç§å†™æ³•ä¹Ÿå¯ä»¥# SSL è¿æ¥å¿…é¡»æ˜¾ç¤ºçš„è¿›è¡Œé…ç½®æ˜¯å¦ä½¿ç”¨ï¼Œå¦åˆ™ä¼šæŠ¥è­¦å‘Š# ä½¿ç”¨ MySQL80 æœåŠ¡ mysql-connector-java:8.0.19 ç‰ˆæœ¬çš„è¿æ¥ Jar åŒ… DriverClassï¼šcom.mysql.cj.jdbc.Driverspring.datasource.url=jdbc:mysql://localhost:3306/springboot_user?serverTimezone=GMT%2B8&amp;useUnicode=true&amp;characterEncoding=utf8&amp;useSSL=falsespring.datasource.username=rootspring.datasource.password=123456spring.datasource.driverClassName=com.mysql.cj.jdbc.Driver æµ‹è¯•æ•°æ®æºæ˜¯å¦é…ç½®æˆåŠŸï¼š 12345678910111213@RunWith(SpringRunner.class)@SpringBootTestclass JavaSpringWingoApplicationTests &#123; // æµ‹è¯• DataSource æ˜¯å¦è¢«æˆåŠŸæ³¨å…¥ @Autowired DataSource dataSource; @Test void testDataSource() &#123; System.out.println(dataSource.getClass()); // è¾“å‡ºç»“æœ class com.zaxxer.hikari.HikariDataSource Spring Boot 2 çš„é»˜è®¤è¿æ¥æ±  Hikari &#125;&#125; Druid è¿æ¥æ± 1234567891011121314&lt;!-- æ”¯æŒé˜¿é‡Œ Druid è¿æ¥æ±  --&gt;&lt;!-- æ–¹å¼ä¸€ï¼šä½¿ç”¨ Spring Boot æä¾›çš„å¯åŠ¨å™¨ --&gt;&lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;druid-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;1.1.10&lt;/version&gt;&lt;/dependency&gt;&lt;!-- æ–¹å¼äºŒï¼šæ­¤æ–¹å¼éœ€è¦è‡ªè¡Œç¼–å†™ Druid é…ç½®ç±»å¼•å…¥é…ç½® --&gt;&lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;druid&lt;/artifactId&gt; &lt;!-- &lt;version&gt;1.1.16&lt;/version&gt; æ­¤ç‰ˆæœ¬æ‰¾ä¸åˆ°ä¾èµ– --&gt; &lt;version&gt;1.1.10&lt;/version&gt;&lt;/dependency&gt; Druid é…ç½®123456789101112131415161718192021222324252627282930313233343536373839404142## Druidè¿æ¥æ± é…ç½®spring.datasource.type=com.alibaba.druid.pool.DruidDataSource## Druid è¿æ¥æ± é…ç½®spring.datasource.type=com.alibaba.druid.pool.DruidDataSource# åˆå§‹åŒ–å¤§å°ã€æœ€å°ã€æœ€å¤§spring.datasource.initialSize=1spring.datasource.minIdle=3spring.datasource.maxActive=20# è·å–è¿æ¥ç­‰å¾…è¶…æ—¶æ—¶é—´spring.datasource.maxWait=60000# é…ç½®é—´éš”å¤šä¹…æ‰è¿›è¡Œä¸€æ¬¡æ£€æµ‹ï¼Œæ£€æµ‹éœ€è¦å…³é—­çš„ç©ºé—²è¿æ¥ï¼Œå•ä½æ˜¯æ¯«ç§’spring.datasource.timeBetweenEvictionRunsMillis=30000# æŒ‡å®šè·å–è¿æ¥æ—¶è¿æ¥æ ¡éªŒçš„sqlæŸ¥è¯¢è¯­å¥spring.datasource.validationQuery=select 'x'# è·å–è¿æ¥åï¼Œç¡®å®æ˜¯å¦è¦è¿›è¡Œè¿æ¥ç©ºé—²æ—¶é—´çš„æ£€æŸ¥spring.datasource.testWhileIdle=true# è·å–è¿æ¥æ£€æµ‹spring.datasource.testOnBorrow=false# å½’è¿˜è¿æ¥æ£€æµ‹spring.datasource.testOnReturn=false# æŒ‡å®šè¿æ¥æ ¡éªŒæŸ¥è¯¢çš„è¶…æ—¶æ—¶é—´spring.datasource.validationQueryTimeout=600000# é…ç½®ä¸€ä¸ªè¿æ¥åœ¨æ± æ€»æœ€å°ç”Ÿå­˜çš„æ—¶é—´spring.datasource.minEvictableIdleTimeMillis=300000# æ‰“å¼€ PSCacheï¼Œå¹¶ä¸”æŒ‡å®šæ¯ä¸ªè¿æ¥ä¸Š Cache çš„å¤§å°spring.datasource.poolPreparedStatements=truespring.datasource.maxPoolPreparedStatementPerConnectionSize=20# é…ç½®ç›‘æ§ç»Ÿè®¡æ‹¦æˆªçš„ filterï¼Œå»æ‰åç›‘æ§ç•Œé¢ sql æ— æ³•ç»Ÿè®¡ï¼Œwall ç”¨äºé˜²ç«å¢™ï¼Œstat ç”¨äºç›‘æ§ç»Ÿè®¡spring.datasource.filters=stat,wall,slf4j# é€šè¿‡ connectProperties å±æ€§æ¥æ‰“å¼€ mergeSql åŠŸèƒ½ï¼Œæ…¢ sql è®°å½•ç­‰spring.datasource.connectionProperties=druid.stat.mergeSql=true;druid.stat.logSlowSql=true;druid.stat.slowSqlMillis=5000## druidè¿æ¥æ± ç›‘æ§ è®¿é—® URLï¼šlocahost:8080/druid # éœ€è¦è´¦å·å¯†ç æ‰èƒ½è®¿é—®æ§åˆ¶å°ï¼Œé»˜è®¤ä¸ºrootspring.datasource.druid.stat-view-servlet.login-username=adminspring.datasource.druid.stat-view-servlet.login-password=123# è®¿é—®è·¯å¾„ä¸º/druidæ—¶ï¼Œè·³è½¬åˆ°StatViewServletspring.datasource.druid.stat-view-servlet.url-pattern=/druid/*# æ˜¯å¦èƒ½å¤Ÿé‡ç½®æ•°æ®spring.datasource.druid.stat-view-servlet.reset-enable=false# æ’é™¤ä¸€äº›é™æ€èµ„æºï¼Œä»¥æé«˜æ•ˆç‡spring.datasource.druid.web-stat-filter.exclusions=*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/* å†æ¬¡æµ‹è¯•æ§åˆ¶å°è¾“å‡ºçš„ DataSource çš„ç±»å‹ä¸º com.alibaba.druid.pool.DruidDataSourceã€‚ æ•´åˆ Mybatis123456&lt;!-- æ”¯æŒ MyBatis --&gt;&lt;dependency&gt; &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt; &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;1.3.1&lt;/version&gt;&lt;/dependency&gt; é…ç½® Mapper123456## MyBatis é…ç½®# é…ç½®åˆ«å parameterType ç›´æ¥ä½¿ç”¨ç±»åmybatis.typeAliasesPackage=com.wingo.user.entitymybatis.mapperLocations=classpath:mapping/*.xml# æ‰“å° MyBatis æ‰§è¡Œçš„ SQL æ‰“å°å‡ºæ¥mybatis.configuration.log-impl=org.apache.ibatis.logging.stdout.StdOutImpl Mybatis ç¼–å†™æ•°æ®åº“æ“ä½œçš„æ–¹æ³•å¯¹åº”çš„ XxxMapper.java æ¥å£ç±»ï¼Œä»¥åŠå¯¹åº”çš„ XxxMapper.xml é…ç½®ç±»ï¼Œé…ç½®ç±»ç”¨äºç¼–å†™å…·ä½“çš„ SQL è¯­å¥ä»¥ä¾¿ Mybatis è¿›è¡ŒåŠ¨æ€å®ç°ã€‚ Mapper æ¥å£ç±»1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768// ä¹Ÿå¯é€šè¿‡åœ¨ Spring Boot è¿è¡Œç±»ä¸Šæ·»åŠ  @MapperScan() æ³¨è§£æ‰«æ@Mapper // æ‰«ææ­¤ç±»ä¸º Mybatis çš„ mapper ç±»public interface UserMybatisMapper &#123; /** * ç”¨æˆ·æ³¨å†Œ / æ·»åŠ ç”¨æˆ·ï¼šåœ¨æ•°æ®åº“ä¸­æ·»åŠ ç”¨æˆ·ä¿¡æ¯ * * @param userMybatis ç”¨æˆ· * @return */ int insert(UserMybatis userMybatis); /** * ç”¨æˆ·ç™»å½•ï¼šé€šè¿‡ç”¨æˆ·åã€ç”¨æˆ·å¯†ç å’Œç”¨æˆ·ç±»å‹æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ * * @param username ç”¨æˆ·å * @param password ç”¨æˆ·å¯†ç  * @param type ç”¨æˆ·ç±»å‹ * @return */ UserMybatis findUserMybatisByUsernameAndPasswordAndType(String username, String password, String type); /** * ç®¡ç†å‘˜ç”¨æˆ·ç®¡ç†é¡µé¢ï¼šé€šè¿‡ç”¨æˆ·ç±»å‹å’Œç”¨æˆ·çŠ¶æ€æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ * * @param type ç”¨æˆ·ç±»å‹ * @param isDelete ç”¨æˆ·çŠ¶æ€ * @return */ List&lt;UserMybatis&gt; findAllByTypeAndStatus(String type, Integer isDelete); /** * ç”¨æˆ·ä¿®æ”¹å¯†ç ï¼šé€šè¿‡ç”¨æˆ·åå’Œç”¨æˆ·ç±»ä¿®æ”¹ç”¨æˆ·å¯†ç  * * @param password ç”¨æˆ·å¯†ç  * @param username ç”¨æˆ·å * @param type ç”¨æˆ·ç±»å‹ * @param gmtModified ç”¨æˆ·ä¿®æ”¹æ—¶é—´ * @return */ int updatePasswordByUsernameAndType(String password, String username, String type, Date gmtModified); /** * æ›´æ–°ç”¨æˆ·ä¿¡æ¯ * * @param userMybatis ç”¨æˆ· * @return */ int update(UserMybatis userMybatis); /** *ç®¡ç†å‘˜åˆ é™¤ç”¨æˆ·ï¼šé€šè¿‡ç”¨æˆ·æ ‡è¯†æ›´æ–°ç”¨æˆ·çŠ¶æ€ * * @param userId ç”¨æˆ·æ ‡è¯† * @param gmtModified ç”¨æˆ·ä¿®æ”¹æ—¶é—´ * @return */ int updateStatusByUserId(Integer userId, Date gmtModified); /** * é€šè¿‡ç”¨æˆ·åå’Œç”¨æˆ·ç±»å‹æŸ¥æ‰¾ç”¨æˆ· * * @param username ç”¨æˆ·å * @param type ç”¨æˆ·ç±»å‹ * @return */ UserMybatis findUserMybatisByUsernameAndType(String username, String type);&#125; Mapper é…ç½®å®ç°123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;!DOCTYPE mapper PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"&gt;&lt;mapper namespace=\"com.wingo.user.mapper.UserMybatisMapper\"&gt; &lt;!-- ç¼–å†™å­—æ®µä¸å±æ€§çš„æ˜ å°„å…³ç³» --&gt; &lt;resultMap id=\"BaseResultMap\" type=\"com.wingo.user.entity.UserMybatis\"&gt; &lt;result column=\"user_id\" jdbcType=\"INTEGER\" property=\"userId\" /&gt; &lt;result column=\"username\" jdbcType=\"VARCHAR\" property=\"username\" /&gt; &lt;result column=\"password\" jdbcType=\"VARCHAR\" property=\"password\" /&gt; &lt;result column=\"type\" jdbcType=\"CHAR\" property=\"type\" /&gt; &lt;result column=\"gmt_create\" jdbcType=\"TIMESTAMP\" property=\"gmtCreate\" /&gt; &lt;result column=\"gmt_modified\" jdbcType=\"TIMESTAMP\" property=\"gmtModified\" /&gt; &lt;result column=\"is_delete\" jdbcType=\"BIT\" property=\"isDelete\" /&gt; &lt;/resultMap&gt; &lt;insert id=\"insert\" parameterType=\"UserMybatis\" keyProperty=\"userId\" useGeneratedKeys=\"true\"&gt; INSERT INTO user (user_id, username, password,type, gmt_create, gmt_modified, is_delete) VALUES (#&#123;userId&#125;, #&#123;username&#125;, #&#123;password&#125;, #&#123;type&#125;, #&#123;gmtCreate&#125;, #&#123;gmtModified&#125;, #&#123;isDelete&#125;) &lt;/insert&gt; &lt;select id=\"findUserMybatisByUsernameAndPasswordAndType\" resultMap=\"BaseResultMap\"&gt; SELECT user_id, username, password, type, gmt_create, gmt_modified, is_delete FROM user WHERE username = #&#123;username&#125; AND password = #&#123;password&#125; AND type = #&#123;type&#125; &lt;/select&gt; &lt;select id=\"findAllByTypeAndStatus\" resultMap=\"BaseResultMap\"&gt; SELECT user_id, username, password, type, gmt_create, gmt_modified, is_delete FROM user WHERE type = #&#123;type&#125; AND is_delete = #&#123;isDelete&#125; &lt;/select&gt; &lt;select id=\"findUserMybatisByUsernameAndType\" resultMap=\"BaseResultMap\"&gt; SELECT user_id, username, password, type, gmt_create, gmt_modified, is_delete FROM user WHERE username = #&#123;username&#125; AND type = #&#123;type&#125; &lt;/select&gt; &lt;update id=\"update\" parameterType=\"UserMybatis\"&gt; UPDATE user &lt;set&gt; &lt;if test=\"username != null\"&gt; username = #&#123;username&#125;, &lt;/if&gt; &lt;if test=\"password != null\"&gt; password = #&#123;password&#125;, &lt;/if&gt; &lt;if test=\"type != null\"&gt; type = #&#123;type&#125;, &lt;/if&gt; &lt;if test=\"gmtCreate != null\"&gt; gmt_create = #&#123;gmtCreate&#125;, &lt;/if&gt; &lt;if test=\"gmtModified != null\"&gt; gmt_modified = #&#123;gmtModified&#125;, &lt;/if&gt; &lt;if test=\"isDelete != null\"&gt; is_delete = #&#123;isDelete&#125; &lt;/if&gt; &lt;/set&gt; WHERE user_id = #&#123;userId&#125; &lt;/update&gt; &lt;update id=\"updatePasswordByUsernameAndType\"&gt; UPDATE user SET password = #&#123;password&#125;, gmt_modified = #&#123;gmtModified&#125; where username =#&#123;username&#125; and type = #&#123;type&#125; &lt;/update&gt; &lt;update id=\"updateStatusByUserId\"&gt; UPDATE user SET is_delete = true, gmt_modified = #&#123;gmtModified&#125; WHERE user_id = #&#123;userId&#125; &lt;/update&gt;&lt;/mapper&gt; ç¼–å†™æµ‹è¯•æ–¹æ³•12345678910111213141516171819202122232425262728293031323334353637383940414243444546@RunWith(SpringRunner.class)@SpringBootTestpublic class JavaSpringWingoApplicationTests &#123; @Autowired UserMybatisMapper userMybatisMapper; @Test @Rollback public void testInsert() &#123; Date date = new Date(); UserMybatis userMybatis = new UserMybatis(); userMybatis.setUsername(\"å¼ ä¸‰\"); userMybatis.setPassword(\"123456\"); userMybatis.setType(\"0\"); userMybatis.setGmtCreate(date); userMybatis.setGmtModified(date); userMybatis.setIsDelete(false); userMybatisMapper.insert(userMybatis); &#125; /** * UserMybatis userMybatis = userMybatisMapper. * findUserMybatisByUsernameAndPasswordAndType(\"å¼ ä¸‰\",\"123456\",\"0\"); * * List&lt;UserMybatis&gt; list = new ArrayList&lt;&gt;(); * list = userMybatisMapper.findAllByTypeAndStatus(\"0\",0); * Iterator&lt;UserMybatis&gt; iterable = list.iterator(); * while (iterable.hasNext())&#123; * UserMybatis userMybatis = iterable.next(); * System.out.println(userMybatis); * &#125; * * UserMybatis userMybatis = userMybatisMapper.findUserMybatisByUsernameAndType(\"å¼ ä¸‰\",\"0\"); * * UserMybatis userMybatis = new UserMybatis(); * userMybatis.setUserId(6); * userMybatis.setUsername(\"æå››\"); * int result = userMybatisMapper.update(userMybatis); * * Date date = new Date(); * userMybatisMapper.updatePasswordByUsernameAndType(\"654321\",\"æå››\",\"0\",date); * * Date date = new Date(); * userMybatisMapper.updateStatusByUserId(6,date); */&#125; ä¸šåŠ¡é€»è¾‘å±‚Mybatis ç‰ˆæœ¬ç¼–å†™é¡¹ç›®åœºæ™¯åŠŸèƒ½çš„ä¸šåŠ¡é€»è¾‘ï¼šæ¥æ”¶å‰ç«¯ä¼ æ¥çš„ä¿¡æ¯æ‰€å°ä½çš„ DTOï¼Œç„¶åè°ƒç”¨ DAO è¿›è¡Œä¸šåŠ¡é€»è¾‘çš„ç¼–å†™ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173@Service(\"userServiceMybatisImpl\")public class UserServiceMybatisImpl implements UserService &#123; private final UserMybatisMapper userMybatisMapper; public UserServiceMybatisImpl(UserMybatisMapper userMybatisMapper) &#123; this.userMybatisMapper = userMybatisMapper; &#125; /** * æ£€æŸ¥æ­¤ç”¨æˆ·æ˜¯å¦å·²ç»å­˜åœ¨ * * @param username ç”¨æˆ·å * @return */ private boolean checkUserDuplicate(String username)&#123; // å®šä¹‰é»˜è®¤è¿”å› false boolean isDuplicate = false; UserMybatis userMybatis = userMybatisMapper.findUserMybatisByUsernameAndType(username, UserTypeConstant.ORDINARY); // è‹¥æ­¤ç”¨æˆ·å­˜åœ¨ï¼Œåˆ™è¿”å› true if(userMybatis!=null)&#123; isDuplicate = true; &#125; return isDuplicate; &#125; private UserMybatis buildUserMybatis(String username, String password)&#123; Date data = new Date(); // åˆ›å»ºç”¨æˆ·å®ä½“å¯¹è±¡å¹¶è¿›è¡Œèµ‹å€¼ UserMybatis userMybatis = new UserMybatis(); userMybatis.setUsername(username); userMybatis.setPassword(Md5Util.md5(password)); userMybatis.setType(UserTypeConstant.ORDINARY); userMybatis.setGmtCreate(data); userMybatis.setGmtModified(data); userMybatis.setIsDelete(false); return userMybatis; &#125; /** ç”¨æˆ·æ³¨å†Œ */ @Override @Transactional(rollbackFor = Exception.class) public ResponseVO register(RegisterDTO registerDTO) &#123; // å®šä¹‰è¿”å›å¯¹è±¡ ResponseVO responseVO = new ResponseVO(); // æ£€æŸ¥æ­¤ç”¨æˆ·æ˜¯å¦æ˜¯å¦å·²ç»å­˜åœ¨ if(checkUserDuplicate(registerDTO.getUsername()))&#123; // ç»„è£…é”™è¯¯è¿”å›å¯¹è±¡ responseVO.fail(\"ç”¨æˆ·åé‡å¤ï¼Œè¯·é‡æ–°æ³¨å†Œï¼\"); // è¿”å›é”™è¯¯ä»£ç åŠé”™è¯¯ä¿¡æ¯ return responseVO; &#125; // åˆ›å»ºç”¨æˆ·å®ä½“å¯¹è±¡å¹¶è¿›è¡Œèµ‹å€¼ UserMybatis userMybatis = buildUserMybatis(registerDTO.getUsername(), registerDTO.getPassword()); // ä¿å­˜æ•°æ®åˆ°æ•°æ®åº“ userMybatisMapper.insert(userMybatis); // ç»„è£…æˆåŠŸè¿”å›å¯¹è±¡ responseVO.success(\"æ­å–œæ‚¨ï¼Œæ³¨å†ŒæˆåŠŸï¼è¯·ç™»å½•\"); return responseVO; &#125; /** ç”¨æˆ·ç™»å½• */ @Override public ResponseVO login(LoginDTO loginDTO) &#123; ResponseVO responseVO = new ResponseVO(); UserMybatis userMybatis = userMybatisMapper.findUserMybatisByUsernameAndPasswordAndType (loginDTO.getUsername(), Md5Util.md5(loginDTO.getPassword()), loginDTO.getType()); if(userMybatis == null)&#123; responseVO.fail(\"ç™»å½•å¤±è´¥ï¼Œç”¨æˆ·ä¸å­˜åœ¨ã€å·²åˆ é™¤æˆ–è€…ç”¨æˆ·åã€å¯†ç æˆ–ç±»å‹é€‰æ‹©é”™è¯¯ï¼\"); return responseVO; &#125; responseVO.success(\"ç™»å½•æˆåŠŸï¼\"); // æ„å»ºè¿”å›çš„ç”¨æˆ·ä¿¡æ¯ UserVO userVO = new UserVO(); userVO.setUsername(loginDTO.getUsername()); userVO.setType(loginDTO.getType()); responseVO.setData(\"userVO\", userVO); return responseVO; &#125; /** ç®¡ç†å‘˜æ·»åŠ ç”¨æˆ· */ @Override @Transactional(rollbackFor = Exception.class) public ResponseVO add(AddDTO addDTO) &#123; // å®šä¹‰è¿”å›å¯¹è±¡ ResponseVO responseVO = new ResponseVO(); // æ£€æŸ¥æ­¤ç”¨æˆ·æ˜¯å¦æ˜¯å¦å·²ç»å­˜åœ¨ if(checkUserDuplicate(addDTO.getUsername()))&#123; // ç»„è£…é”™è¯¯è¿”å›å¯¹è±¡ responseVO.fail(\"ç”¨æˆ·åé‡å¤ï¼Œè¯·é‡æ–°æ·»åŠ ï¼\"); // è¿”å›é”™è¯¯ä»£ç åŠé”™è¯¯ä¿¡æ¯ return responseVO; &#125; // åˆ›å»ºç”¨æˆ·å®ä½“å¯¹è±¡å¹¶è¿›è¡Œèµ‹å€¼ UserMybatis userMybatis = buildUserMybatis(addDTO.getUsername(), addDTO.getPassword()); // ä¿å­˜æ•°æ®åˆ°æ•°æ®åº“ userMybatisMapper.insert(userMybatis); // ç»„è£…æˆåŠŸè¿”å›å¯¹è±¡ responseVO.success(\"æ·»åŠ æˆåŠŸï¼\"); return responseVO; &#125; /** ç®¡ç†å‘˜æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨ */ @Override public ResponseVO view() &#123; ResponseVO responseVO = new ResponseVO(); // å®šä¹‰è¿”å›çš„ç»“æœé›†å¯¹è±¡ï¼Œè¿™ç§å®šä¹‰æ–¹å¼æ˜¯å¯¹è±¡å½¢å¼çš„é›†åˆ List&lt;ViewVO&gt; userList = new ArrayList&lt;&gt;(); List&lt;UserMybatis&gt; userMybatisList = userMybatisMapper.findAllByTypeAndStatus(UserTypeConstant.ORDINARY, false); if(userMybatisList == null)&#123; responseVO.fail(\"è¯·æ±‚ç”¨æˆ·åˆ—è¡¨å¤±è´¥ï¼\"); return responseVO; &#125; for(UserMybatis userMybatis : userMybatisList)&#123; // åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡æ¥å­˜å‚¨æŸ¥è¯¢å‡ºçš„ä¸€æ¡æ¡è®°å½• ViewVO viewVO = new ViewVO(); // å¯¹å¯¹è±¡è¿›è¡Œèµ‹å€¼ viewVO.setUserId(userMybatis.getUserId()); viewVO.setUsername(userMybatis.getUsername()); viewVO.setType(userMybatis.getType()); viewVO.setGtmCreate(userMybatis.getGmtCreate()); // å°†å¯¹è±¡æ”¾å…¥é›†åˆä¸­ userList.add(viewVO); &#125; responseVO.success(\"è¯·æ±‚ç”¨æˆ·åˆ—è¡¨æˆåŠŸï¼\"); responseVO.setData(\"viewVO\", userList); return responseVO; &#125; /** ç”¨æˆ·ä¿®æ”¹å¯†ç  */ @Override @Transactional(rollbackFor = Exception.class) public ResponseVO modify(ModifyDTO modifyDTO) &#123; ResponseVO responseVO = new ResponseVO(); // åˆ¤æ–­æ˜¯å¦æœ‰æ–°å¯†ç ä¸”æ–°æ—§å¯†ç æ˜¯å¦ä¸€è‡´ if(modifyDTO.getNewPassword() != null &amp;&amp; modifyDTO.getConfirmNewPassword() != null &amp;&amp; !modifyDTO.getConfirmNewPassword().equals(modifyDTO.getNewPassword()))&#123; responseVO.fail(\"æ–°å¯†ç å’Œç¡®è®¤æ–°å¯†ç ä¸ä¸€è‡´ï¼Œè¯·æ£€æŸ¥ï¼\"); return responseVO; &#125; // åˆ¤æ–­ç”¨æˆ·çš„åŸå¯†ç æ˜¯å¦æ­£ç¡® UserMybatis userMybatis = userMybatisMapper.findUserMybatisByUsernameAndPasswordAndType( modifyDTO.getUsername(), Md5Util.md5(modifyDTO.getPassword()), modifyDTO.getType() ); if(userMybatis == null)&#123; responseVO.fail(\"ç”¨æˆ·åŸå¯†ç ä¸æ­£ç¡®ï¼Œè¯·æ£€æŸ¥ï¼\"); return responseVO; &#125; Date date = new Date(); // ç¡®è®¤æ»¡è¶³ä¿®æ”¹æ¡ä»¶åå¯¹ç”¨æˆ·ä¿¡æ¯è¿›è¡Œæ›´æ–° userMybatis.setPassword(Md5Util.md5(modifyDTO.getNewPassword())); userMybatis.setGmtModified(date); userMybatisMapper.update(userMybatis); responseVO.success(\"å¯†ç ä¿®æ”¹æˆåŠŸï¼\"); return responseVO; &#125; /** åˆ é™¤ç”¨æˆ· */ @Override @Transactional(rollbackFor = Exception.class) public ResponseVO delete(DeleteDTO deleteDTO) &#123; ResponseVO responseVO = new ResponseVO(); Date date = new Date(); int deleteResult = userMybatisMapper.updateStatusByUserId(deleteDTO.getUerId(),date); if(deleteResult != 1)&#123; responseVO.fail(\"åˆ é™¤å¤±è´¥ï¼Œæ²¡æœ‰æ›´æ–°åˆ°æˆ–è€…æ›´æ–°äº†å¤šæ¡è®°å½•ï¼\"); return responseVO; &#125; responseVO.success(\"ç”¨æˆ·åˆ é™¤æˆåŠŸï¼\"); return responseVO; &#125;&#125; æµ‹è¯•ç”¨ä¾‹1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071@RunWith(SpringRunner.class)@SpringBootTestpublic class JavaSpringWingoApplicationTests &#123; @Resource(name = \"userServiceMybatisImpl\") UserService userService; /** Md5Util è¾“å‡º */ @Test public void testMd5()&#123; System.out.println(Md5Util.md5(\"e10adc3949ba59abbe56e057f20f883e\")); &#125; /** æµ‹è¯•æ³¨å†Œæ¥å£ */ @Test @Rollback public void testRegister() &#123; // æ„é€ æ³¨å†Œçš„æµ‹è¯•æ•°æ® RegisterDTO registerDTO = new RegisterDTO(); registerDTO.setUsername(\"Jay\"); registerDTO.setPassword(\"123456\"); // å¤„ç†ä¸šåŠ¡ ResponseVO responseVO = userService.register(registerDTO); // æµ‹è¯•æ–­è¨€ assertEquals(ResponseConstant.SUCCESS, responseVO.get(\"code\")); &#125; /** æµ‹è¯•ç™»å½•æ¥å£ */ @Test public void testLogin()&#123; LoginDTO loginDTO = new LoginDTO(); loginDTO.setUsername(\"Tom\"); loginDTO.setPassword(\"123456\"); loginDTO.setType(0); ResponseVO responseVO = userService.login(loginDTO); assertEquals(ResponseConstant.SUCCESS, responseVO.get(\"code\")); &#125; /** æµ‹è¯•æ·»åŠ æ¥å£ */ @Test @Rollback public void testAdd()&#123; AddDTO addDTO = new AddDTO(); addDTO.setUsername(\"Tim\"); addDTO.setPassword(\"123456\"); ResponseVO responseVO = userService.add(addDTO); assertEquals(ResponseConstant.SUCCESS, responseVO.get(\"code\")); &#125; /** æµ‹è¯•ç”¨æˆ·åˆ—è¡¨æ¥å£ */ @Test public void testView()&#123; ResponseVO responseVO = userService.view(); System.out.println(responseVO); assertEquals(ResponseConstant.SUCCESS, responseVO.get(\"code\")); &#125; /** æµ‹è¯•ä¿®æ”¹å¯†ç æ¥å£*/ @Test @Rollback public void testModify()&#123; ModifyDTO modifyDTO = new ModifyDTO(); modifyDTO.setUsername(\"Jay\"); modifyDTO.setType(0); modifyDTO.setPassword(\"123456\"); modifyDTO.setNewPassword(\"654321\"); modifyDTO.setConfirmNewPassword(\"654321\"); ResponseVO responseVO = userService.modify(modifyDTO); assertEquals(ResponseConstant.SUCCESS, responseVO.get(\"code\")); &#125;&#125; æ§åˆ¶å±‚Swagger æ•´åˆç”¨äºæµè§ˆå™¨è¯·æ±‚æµ‹è¯•ã€‚ ä¹Ÿå¯é‡‡ç”¨ Spring Boot æä¾›çš„ swagger çš„ staterï¼Œåˆ©ç”¨å¯åŠ¨å™¨çš„æ–¹å¼æ·»åŠ ä¾èµ–ï¼Œå¯ä»¥ç›´åœ¨ Spring Boot çš„é…ç½®æ–‡ä»¶ä¸­é…ç½® swagger çš„é…ç½®ä¿¡æ¯ã€‚ 1234567891011&lt;!-- æ·»åŠ  Swagger çš„æ”¯æŒ --&gt;&lt;dependency&gt; &lt;groupId&gt;io.springfox&lt;/groupId&gt; &lt;artifactId&gt;springfox-swagger2&lt;/artifactId&gt; &lt;version&gt;2.9.2&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;io.springfox&lt;/groupId&gt; &lt;artifactId&gt;springfox-swagger-ui&lt;/artifactId&gt; &lt;version&gt;2.9.2&lt;/version&gt;&lt;/dependency&gt; é…ç½®ç±» 1234567891011121314151617@Configuration@EnableSwagger2public class SwaggerConfig &#123; @Bean public Docket createRestApi() &#123; return new Docket(DocumentationType.SWAGGER_2).apiInfo(apiInfo()) .select() .apis(RequestHandlerSelectors.basePackage(\"com.wingo.user.controller\")) .paths(PathSelectors.any()).build(); &#125; private ApiInfo apiInfo() &#123; return new ApiInfoBuilder().title(\"Swagger RESTful APIs\") .description(\"Swagger API æœåŠ¡\") .build(); &#125;&#125; ä»£ç ç¼–å†™ Model modelï¼šSpring MVC æä¾›äº†ä¸€ä¸ªModelç”¨äºæš´éœ²åç«¯ä¼ é€’ç»™é¡µé¢çš„ä¿¡æ¯ï¼Œé€šè¿‡addAttribute(K, V)æ–¹æ³•æ·»åŠ æ•°æ®ï¼Œå¹¶ä¸”åœ¨å‰ç«¯çš„æ¨¡æ¿å¼•æ“é¡µé¢é€šè¿‡${K}å–å¾—å¯¹åº”çš„Vï¼› HttpServletResponse httpServletResponseï¼šencodeRedirectURL(Url)æ–¹æ³•è¿›è¡Œé¡µé¢è·³è½¬ï¼Œè·³è½¬çš„åŒæ—¶æºå¸¦åŸŸä¸­çš„ä¿¡æ¯ï¼› HttpSession httpSessionï¼šsetAttribute(K, V)æ–¹æ³•åœ¨ Session åŸŸä¸­æ·»åŠ ä¿¡æ¯ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201@Controller@Slf4jpublic class UserController &#123; /** æ³¨å…¥ UserService */ @Resource(name = \"userServiceMybatisImpl\") private UserService userService; /** å¤„ç†ç”¨æˆ·æ³¨å†Œçš„è¯·æ±‚ */ @ApiOperation(\"ç”¨æˆ·æ³¨å†Œæ¥å£\") @PostMapping(value = \"/register\") public String register(Model model, @Valid @ModelAttribute(value = \"registerDTO\") RegisterDTO registerDTO, HttpServletResponse httpServletResponse) &#123; ResponseVO responseVO = userService.register(registerDTO); model.addAttribute(ResponseConstant.RESPONSE_VO, responseVO); if (ResponseConstant.SUCCESS.equals(responseVO.get(ResponseConstant.CODE))) &#123; // æ³¨å†ŒæˆåŠŸï¼Œé‡å®šå‘åˆ°å‰ç«¯ç™»å½•é¡µé¢ login.htmlï¼Œå¹¶ä¸”æºå¸¦æ•°æ®è¿‡å» return httpServletResponse.encodeRedirectURL(UrlConstant.LOGIN); &#125; // æ³¨å†Œå¤±è´¥ï¼Œè·³è½¬åˆ°æ³¨å†Œé¡µé¢ï¼Œå¹¶å°†å¤±è´¥çš„ä¿¡æ¯è¿”å› return httpServletResponse.encodeRedirectURL(UrlConstant.REGISTER); &#125; /** * ç”Ÿæˆå›¾å½¢éªŒè¯ç  * * @throws NoSuchAlgorithmException */ @ApiIgnore @GetMapping(value = \"/imageCode\") public String imageCode(HttpServletRequest request, HttpServletResponse response) throws IOException, NoSuchAlgorithmException &#123; OutputStream os = response.getOutputStream(); // ç”ŸæˆéªŒè¯ç  Map&lt;String, Object&gt; map = ImageCodeUtil.getImageCode(60, 20, 4); // æ”¾å…¥å®¢æˆ·ç«¯çš„ Session å¯¹è±¡ä¸­ request.getSession().setAttribute(ImageCodeConstant.SIMPLE_CAPTCHA, map.get(ImageCodeConstant.CAPTCHA_VALUE).toString().toLowerCase()); // è®¾ç½®éªŒè¯ç çš„ç”Ÿæˆæ—¶é—´ï¼Œå¹¶æ”¾å…¥å®¢æˆ·ç«¯ Session å¯¹è±¡ä¸­ request.getSession().setAttribute(ImageCodeConstant.CODE_TIME, System.currentTimeMillis()); // å°†ç”Ÿæˆçš„éªŒè¯ç å›¾ç‰‡å†™åˆ°å›¾ç‰‡è¾“å‡ºæµ try &#123; ImageIO.write((BufferedImage) map.get(ImageCodeConstant.IMAGE), ImageCodeConstant.JPEG, os); &#125; catch (IOException e) &#123; log.error(\"å›¾å½¢éªŒè¯ç ç”Ÿæˆå¼‚å¸¸\"); &#125; return null; &#125; /** å¤„ç†ç”¨æˆ·çš„ç™»å½•è¯·æ±‚ */ @ApiIgnore @PostMapping(value = \"/login\") public String login(Model model, @Valid @ModelAttribute(value = \"loginDTO\") LoginDTO loginDTO, HttpServletResponse httpServletResponse, HttpSession httpSession) &#123; ResponseVO responseVO = new ResponseVO(); // å–å¾—ç”¨æˆ·å¡«å†™çš„éªŒè¯ç  String checkCode = loginDTO.getCheckCode(); // ä» Session ä¸­å–å¾—å­˜å…¥çš„éªŒè¯ç ä¿¡æ¯ Object sessionImageCode = httpSession.getAttribute(ImageCodeConstant.SIMPLE_CAPTCHA); // è·å–éªŒè¯ç ä¿¡æ¯å¤±è´¥ if(sessionImageCode == null)&#123; responseVO.fail(\"è¯·å¡«å†™éªŒè¯ç \"); model.addAttribute(ResponseConstant.RESPONSE_VO, responseVO); return httpServletResponse.encodeRedirectURL(UrlConstant.LOGIN); &#125; String code = sessionImageCode.toString(); // æ£€æµ‹éªŒè¯ç  Date date = new Date(); Long codeTime = Long.valueOf(httpSession.getAttribute(ImageCodeConstant.CODE_TIME) + \"\"); // éªŒè¯ç æ˜¯å¦å¡«å†™æ­£ç¡® if (StringUtils.isBlank(checkCode) || StringUtils.isBlank(code) || !(checkCode.equalsIgnoreCase(code))) &#123; responseVO.fail(\"éªŒè¯ç ä¸ä¸€è‡´\"); model.addAttribute(ResponseConstant.RESPONSE_VO, responseVO); return httpServletResponse.encodeRedirectURL(UrlConstant.LOGIN); &#125; // éªŒè¯ç æ˜¯å¦è¿‡æœŸï¼ˆæœ‰æ•ˆæœŸä¸º 5 åˆ†é’Ÿï¼‰ else if ((date.getTime() - codeTime) / ImageCodeConstant.MILLISECOND_CONVERSION / ImageCodeConstant.MINUTE_CONVERSION &gt; ImageCodeConstant.CAPTCHA_EXPIRY_TIME) &#123; responseVO.fail(\"éªŒè¯ç å·²è¿‡æœŸ\"); model.addAttribute(ResponseConstant.RESPONSE_VO, responseVO); return httpServletResponse.encodeRedirectURL(UrlConstant.LOGIN); &#125; // å¤„ç†ç”¨æˆ·ç™»å½•ä¸šåŠ¡ responseVO = userService.login(loginDTO); // å°†ç»“æœæ”¾å…¥ model ä¸­ï¼Œåœ¨æ¨¡æ¿ä¸­å¯ä»¥å–åˆ° model ä¸­çš„å€¼ // è¿™é‡Œå°±æ˜¯äº¤äº’çš„ä¸€ä¸ªé‡è¦åœ°æ–¹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ¨¡æ¿ä¸­é€šè¿‡è¿™äº›å±æ€§å€¼è®¿é—®åˆ°æ•°æ® model.addAttribute(ResponseConstant.RESPONSE_VO, responseVO); // è®¾ç½®ç™»å½• sessionï¼Œæ¨¡ç‰ˆå¼•æ“ä½¿ç”¨ httpSession.setAttribute(UserConstant.USERNAME, loginDTO.getUsername()); httpSession.setAttribute(UserConstant.TYPE, loginDTO.getType()); // å°†ç±»å‹ç è½¬æ¢ä¸ºä¸­æ–‡è¯´æ˜ httpSession.setAttribute(UserConstant.TYPE_NAME, UserTypeConstant.typeToDesc(loginDTO.getType())); // ç»„è£…ç»“æœè¿”å› if (responseVO == null || !ResponseConstant.SUCCESS.equals(responseVO.get(ResponseConstant.CODE))) &#123; // ç™»å½•å¤±è´¥åˆ™è·³è½¬åˆ°å‰ç«¯ç™»å½•é¡µé¢ login.html return httpServletResponse.encodeRedirectURL(UrlConstant.LOGIN); &#125; // ç™»å½•æˆåŠŸé‡å®šå‘åˆ°å‰ç«¯é¦–é¡µ index.htmlï¼Œå¹¶ä¸”æºå¸¦æ•°æ®è¿‡å» return httpServletResponse.encodeRedirectURL(UrlConstant.INDEX); &#125; /** å¤„ç†æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨çš„è¯·æ±‚ */ @ApiIgnore @GetMapping(value = \"/users\") public String users(Model model, HttpServletResponse httpServletResponse) &#123; // å¤„ç†ç”¨æˆ·åˆ—è¡¨æŸ¥çœ‹ä¸šåŠ¡ ResponseVO responseVO = userService.view(); model.addAttribute(ResponseConstant.RESPONSE_VO, responseVO); // å¼€å§‹é‡å®šå‘å‰ç«¯ç”¨æˆ·åˆ—è¡¨ä¹Ÿ view.htmlï¼Œæºå¸¦æ•°æ®è¿‡å»äº†ã€‚ return httpServletResponse.encodeRedirectURL(UrlConstant.VIEW); &#125; /** å¤„ç†æ–°å¢ç”¨æˆ·çš„è¯·æ±‚ */ @ApiOperation(\"ç”¨æˆ·æ–°å¢æ¥å£\") @PostMapping(value = \"/user\") public String user(Model model, @Valid @ModelAttribute(value = \"addDTO\") AddDTO addDTO, HttpServletResponse httpServletResponse) &#123; // å¤„ç†æ–°å¢ç”¨æˆ·ä¸šåŠ¡ ResponseVO responseVO = userService.add(addDTO); // å°†å¤„ç†ç»“æœå†™å…¥åˆ°è¿”å›å¯¹è±¡ä¸­ model.addAttribute(ResponseConstant.RESPONSE_VO, responseVO); // ç”¨æˆ·æ·»åŠ å¤±è´¥ï¼Œé‡å®šå‘åˆ°å‰ç«¯é¡µé¢ user.html if (responseVO == null || !ResponseConstant.SUCCESS.equals(responseVO.get(ResponseConstant.CODE)))&#123; return httpServletResponse.encodeRedirectURL(UrlConstant.USER); &#125; // å¤„ç†æˆåŠŸ responseVO = userService.view(); model.addAttribute(ResponseConstant.RESPONSE_VO, responseVO); // å¼€å§‹é‡å®šå‘ï¼Œæºå¸¦æ•°æ®è¿‡å» return httpServletResponse.encodeRedirectURL(UrlConstant.VIEW); &#125; /** åˆ é™¤ç”¨æˆ· */ @ApiOperation(\"åˆ é™¤ç”¨æˆ·æ¥å£\") @GetMapping(value = \"/delete\") public String delete(Model model, @Valid @ModelAttribute(value = \"deleteDTO\") DeleteDTO deleteDTO, HttpServletResponse httpServletResponse) &#123; // å¤„ç†é€»è¾‘åˆ é™¤ç”¨æˆ·ä¸šåŠ¡ ResponseVO responseVO = userService.delete(deleteDTO); // åˆ é™¤å¤±è´¥è¿”å›é”™è¯¯ä¿¡æ¯ if(responseVO.get(ResponseConstant.CODE).equals(ResponseConstant.FAIL))&#123; model.addAttribute(ResponseConstant.RESPONSE_VO, responseVO); return httpServletResponse.encodeRedirectURL(UrlConstant.VIEW); &#125; // åˆ é™¤æˆåŠŸåå†æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨æ•°æ®ï¼Œè¿”å›åˆ é™¤åçš„æœ€æ–°ç”¨æˆ·åˆ—è¡¨æ•°æ® responseVO = userService.view(); if (responseVO != null) &#123; model.addAttribute(ResponseConstant.RESPONSE_VO, responseVO); &#125; // é€»è¾‘åˆ é™¤ç”¨æˆ·åï¼Œè·³è½¬åˆ°ç”¨æˆ·å‰ç«¯åˆ—è¡¨é¡µ view.jsp return httpServletResponse.encodeRedirectURL(UrlConstant.VIEW); &#125; /** å¤„ç†ç”¨æˆ·ä¿¡æ¯ä¿®æ”¹çš„è¯·æ±‚ */ @ApiIgnore @PostMapping(value = \"/modify\") public String toModify(Model model, @Valid @ModelAttribute(value = \"modifyDTO\") ModifyDTO modifyDTO, HttpServletResponse httpServletResponse, HttpSession httpSession) &#123; // ä» Session ä¸­å–å¾—ç”¨æˆ·åå­—åŠç±»å‹ String strUsername = httpSession.getAttribute(UserConstant.USERNAME).toString(); String strType = httpSession.getAttribute(UserConstant.TYPE).toString(); modifyDTO.setUsername(strUsername); modifyDTO.setType(strType); // å¤„ç†ç”¨æˆ·ä¿¡æ¯ä¿®æ”¹ä¸šåŠ¡ ResponseVO responseVO = userService.modify(modifyDTO); // å°†ç»“æœæ”¾å…¥ Model ä¸­ï¼Œåœ¨æ¨¡æ¿ä¸­å¯ä»¥å–åˆ° Model ä¸­çš„å€¼ model.addAttribute(ResponseConstant.RESPONSE_VO, responseVO); if (responseVO == null || !ResponseConstant.SUCCESS.equals(responseVO.get(ResponseConstant.CODE))) &#123; // ä¿®æ”¹å¤±è´¥æ—¶ï¼Œç»§ç»­é‡å®šå‘åˆ°å‰ç«¯ç”¨æˆ·ä¿¡æ¯ä¿®æ”¹é¡µé¢ modify.html return httpServletResponse.encodeRedirectURL(UrlConstant.MODIFY); &#125; // å¯†ç ä¿®æ”¹æˆåŠŸï¼Œä» Session ä¸­åˆ é™¤ user å±æ€§ï¼Œç”¨æˆ·é€€å‡ºç™»å½• httpSession.removeAttribute(UserConstant.USERNAME); httpSession.removeAttribute(UserConstant.TYPE); httpSession.removeAttribute(UserConstant.TYPE_NAME); // å¼€å§‹é‡å®šå‘å‰ç«¯ç™»å½•é¡µé¢ login.htmlï¼Œå¹¶ä¸”æºå¸¦æ•°æ®è¿‡å» return httpServletResponse.encodeRedirectURL(UrlConstant.LOGIN); &#125; /** æ³¨é”€ç™»å½• */ @ApiIgnore @GetMapping(value = \"/loginOut\") public String loginOut(HttpSession httpSession, HttpServletResponse httpServletResponse) &#123; // ä» Session ä¸­åˆ é™¤ user å±æ€§ï¼Œç”¨æˆ·é€€å‡ºç™»å½• httpSession.removeAttribute(UserConstant.USERNAME); httpSession.removeAttribute(UserConstant.TYPE); httpSession.removeAttribute(UserConstant.TYPE_NAME); // å¼€å§‹é‡å®šå‘åˆ°å‰ç«¯é¡µé¢ login.html return httpServletResponse.encodeRedirectURL(UrlConstant.LOGIN); &#125; /** å¤„ç† Get:/index è¯·æ±‚ */ @ApiIgnore @GetMapping(value=\"/index\") public String index(HttpServletResponse httpServletResponse)&#123; // é‡å®šå‘åˆ°å‰ç«¯é¡µé¢ index.html return httpServletResponse.encodeRedirectURL(UrlConstant.INDEX); &#125; // çœç•¥ä½™ä¸‹é¡µé¢è·³æ–¹æ³•&#125; Thymeleafå¼•å…¥ä¾èµ–ï¼š 12345&lt;!-- æ”¯æŒ Thymeleaf --&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;&lt;/dependency&gt; é…ç½® Thymeleafï¼š 1234567## Thymeleaf é…ç½®spring.thymeleaf.prefix=classpath:/templatesspring.thymeleaf.suffix=.htmlspring.thymeleaf.mode=HTMLspring.thymeleaf.servlet.content-type=text/htmlspring.thymeleaf.cache=falsespring.thymeleaf.enabled=true login.html1234567891011121314151617181920212223242526272829303132333435363738&lt;!DOCTYPE html&gt;&lt;html xmlns:th=\"http://www.thymeleaf.org\"&gt; &lt;head&gt; &lt;meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"&gt; &lt;title&gt;ç™»å½•&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;p th:if=\"$&#123;responseVO != null &amp;&amp; responseVO.get('message') != null&#125;\" th:text=\"$&#123;responseVO.get('message')&#125;\"&gt;&lt;/p&gt; &lt;form th:action=\"@&#123;/login&#125;\" th:object=\"$&#123;loginDTO&#125;\" method=\"post\"&gt; &lt;div style=\"height: 27px\"&gt; &lt;label for=\"username\"&gt;ç”¨æˆ·å: &lt;/label&gt; &lt;input type=\"text\" name=\"username\" id=\"username\" placeholder=\"ç”¨æˆ·å\" th:value=\"$&#123;registerDTO !=null &amp;&amp; registerDTO.username != null&#125; ? $&#123;registerDTO.username&#125; : ''\" /&gt; &lt;/div&gt; &lt;div style=\"height: 27px\"&gt; &lt;label for=\"password\"&gt;å¯†ç : &lt;/label&gt; &lt;input type=\"password\" name=\"password\" id=\"password\" placeholder=\"å¯†ç \"/&gt; &lt;/div&gt; &lt;div style=\"height: 27px\"&gt; &lt;label for=\"checkCode\" class=\"green\"&gt;éªŒè¯ç : &lt;/label&gt; &lt;input id=\"checkCode\" name=\"checkCode\" class=\"checkCode\" type=\"text\" placeholder=\"éªŒè¯ç \" /&gt; &lt;img style=\"cursor: pointer; margin-left: 3px;\" th:src=\"@&#123;/imageCode&#125;\" onclick=\"this.src=this.src + '?' + new Date().valueOf();\" id=\"validateImg\" alt=\"éªŒè¯ç \" class=\"codePic\" title=\"éªŒè¯ç ã€‚ç‚¹å‡»æ­¤å¤„æ›´æ–°éªŒè¯ç ã€‚\" /&gt; &lt;/div&gt; &lt;div style=\"height: 27px\"&gt; &lt;label for=\"type\"&gt;ç”¨æˆ·ç±»å‹: &lt;/label&gt; &lt;select id=\"type\" name=\"type\"&gt; &lt;option type=\"number\" value=\"0\" &gt;æ™®é€šç”¨æˆ·&lt;/option&gt; &lt;option type=\"number\" value=\"1\" &gt;ç®¡ç†å‘˜ç”¨æˆ·&lt;/option&gt; &lt;/select&gt; &lt;/div&gt; &lt;input type=\"submit\" value=\"ç™»å½•\"&gt; &lt;/form&gt; &lt;/body&gt;&lt;/html&gt; index.html1234567891011121314151617181920&lt;!DOCTYPE html&gt;&lt;html xmlns:th=\"http://www.thymeleaf.org\"&gt;&lt;head&gt;&lt;meta charset=\"UTF-8\"&gt;&lt;title&gt;ç™»å½•åçš„é¦–é¡µ&lt;/title&gt;&lt;/head&gt;&lt;body&gt; &lt;h4&gt; æ¬¢è¿æ‚¨ï¼š&lt;span style=\"color: red\" th:text=\"$&#123;session.username&#125;?$&#123;session.username&#125;:'ï¼ˆæ‚¨æœªç™»å½•ï¼‰'\"&gt;&lt;/span&gt;, ç”¨æˆ·èº«ä»½æ˜¯ï¼š&lt;span style=\"color: red\" th:text=\"$&#123;session.typeName&#125;?$&#123;session.typeName&#125;:'ï¼ˆæ‚¨æœªç™»å½•ï¼‰'\" &gt;&lt;/span&gt; &lt;/h4&gt; &lt;th:block th:if=\"$&#123;session.username != null&#125;\"&gt; &lt;a th:href=\"@&#123;/users&#125;\" th:if=\"$&#123;session.typeName eq 'ç®¡ç†å‘˜'&#125;\"&gt;æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨&lt;/a&gt; &lt;a th:href=\"@&#123;/user&#125;\" th:if=\"$&#123;session.typeName eq 'ç®¡ç†å‘˜'&#125; \"&gt;æ·»åŠ ç”¨æˆ·&lt;/a&gt; &lt;a th:href=\"@&#123;/modify&#125;\"&gt;ä¿®æ”¹å¯†ç &lt;/a&gt; &lt;a th:href=\"@&#123;/loginOut&#125;\"&gt;æ³¨é”€ç™»å½•&lt;/a&gt; &lt;/th:block&gt;&lt;/body&gt;&lt;/html&gt; modify.html123456789101112131415161718192021222324&lt;!DOCTYPE html&gt;&lt;html xmlns:th=\"http://www.thymeleaf.org\"&gt;&lt;head&gt;&lt;meta charset=\"UTF-8\"&gt;&lt;title&gt;ä¿®æ”¹å¯†ç &lt;/title&gt;&lt;/head&gt;&lt;body&gt; &lt;p th:if=\"$&#123;responseVO != null &amp;&amp; responseVO.get('message') != null&#125;\" th:text=\"$&#123;responseVO.get('message')&#125;\"&gt;&lt;/p&gt; &lt;th:block th:if=\"$&#123;session.username != null&#125;\"&gt; &lt;form th:action=\"@&#123;/modify&#125;\" th:object=\"$&#123;modifyDTO&#125;\" method=\"post\"&gt; &lt;label for=\"password\"&gt;åŸå¯†ç :&lt;/label&gt; &lt;input type=\"password\" name=\"password\" id=\"password\" /&gt; &lt;br /&gt; &lt;label for=\"newPassword\"&gt;æ–°å¯†ç :&lt;/label&gt; &lt;input type=\"password\" name=\"newPassword\" id=\"newPassword\" /&gt; &lt;br /&gt; &lt;label for=\"confirmNewPassword\"&gt;ç¡®è®¤æ–°å¯†ç :&lt;/label&gt; &lt;input type=\"password\" name=\"confirmNewPassword\" id=\"confirmNewPassword\" /&gt; &lt;br /&gt; &lt;input type=\"submit\" value=\"ç¡®è®¤ä¿®æ”¹\"&gt; &lt;/form&gt; &lt;/th:block&gt;&lt;/body&gt;&lt;/html&gt; register.html12345678910111213141516171819&lt;!DOCTYPE html&gt;&lt;html xmlns:th=\"http://www.thymeleaf.org\"&gt;&lt;head&gt;&lt;meta charset=\"UTF-8\"&gt;&lt;title&gt;ç”¨æˆ·æ³¨å†Œ&lt;/title&gt;&lt;/head&gt;&lt;body&gt; &lt;p th:if=\"$&#123;responseVO != null &amp;&amp; responseVO.get('message') != null&#125;\" th:text=\"$&#123;responseVO.get('message')&#125;\"&gt;&lt;/p&gt; &lt;form th:action=\"@&#123;/register&#125;\" th:object=\"$&#123;registerDTO&#125;\" method=\"post\"&gt; &lt;label for=\"username\"&gt;ç”¨æˆ·å:&lt;/label&gt; &lt;input type=\"text\" name=\"username\" id=\"username\" /&gt; &lt;br /&gt; &lt;label for=\"password\"&gt;å¯†ç :&lt;/label&gt; &lt;input type=\"password\" name=\"password\" id=\"password\" /&gt; &lt;br /&gt; &lt;input type=\"submit\" value=\"æ³¨å†Œ\"&gt; &lt;/form&gt;&lt;/body&gt;&lt;/html&gt; user.html123456789101112131415161718192021&lt;!DOCTYPE html&gt;&lt;html xmlns:th=\"http://www.thymeleaf.org\"&gt;&lt;head&gt;&lt;meta charset=\"UTF-8\"&gt;&lt;title&gt;æ·»åŠ ç”¨æˆ·&lt;/title&gt;&lt;/head&gt;&lt;body&gt; &lt;p th:if=\"$&#123;responseVO != null &amp;&amp; responseVO.get('message') != null&#125;\" th:text=\"$&#123;responseVO.get('message')&#125;\"&gt;&lt;/p&gt; &lt;th:block th:if=\"$&#123;session.username != null &amp;&amp; session.typeName == 'ç®¡ç†å‘˜'&#125;\"&gt; &lt;form th:action=\"@&#123;/user&#125;\" th:object=\"$&#123;addDTO&#125;\" method=\"post\"&gt; &lt;label for=\"username\"&gt;ç”¨æˆ·å:&lt;/label&gt; &lt;input type=\"text\" name=\"username\" id=\"username\" /&gt; &lt;br /&gt; &lt;label for=\"password\"&gt;å¯†ç :&lt;/label&gt; &lt;input type=\"password\" name=\"password\" id=\"password\" /&gt; &lt;br /&gt; &lt;input type=\"submit\" value=\"æ·»åŠ \"&gt; &lt;/form&gt; &lt;/th:block&gt;&lt;/body&gt;&lt;/html&gt; view.html123456789101112131415161718192021222324252627282930&lt;!DOCTYPE html&gt;&lt;html xmlns:th=\"http://www.thymeleaf.org\"&gt;&lt;head&gt;&lt;meta charset=\"UTF-8\"&gt;&lt;title&gt;æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨&lt;/title&gt;&lt;/head&gt;&lt;body&gt; &lt;table border=\"1\"&gt; &lt;tr&gt; &lt;td&gt;ID&lt;/td&gt; &lt;td&gt;åå­—&lt;/td&gt; &lt;td&gt;ç”¨æˆ·ç±»å‹&lt;/td&gt; &lt;td&gt;æ³¨å†Œæ—¶é—´&lt;/td&gt; &lt;td&gt;æ“ä½œç±»å‹&lt;/td&gt; &lt;/tr&gt; &lt;th:block th:if=\"$&#123;session.username != null &amp;&amp; session.typeName == 'ç®¡ç†å‘˜'&#125;\"&gt; &lt;!-- å¾ªç¯å±•ç¤ºæ™®é€šç”¨æˆ·æ¸…å• --&gt; &lt;th:block th:if=\"$&#123;responseVO.get('data').viewVO != null&#125;\"&gt; &lt;tr th:each=\"ViewVO : $&#123;responseVO.get('data').viewVO&#125;\"&gt; &lt;td th:text=\"$&#123;ViewVO.userId&#125;\"&gt;&lt;/td&gt; &lt;td th:text=\"$&#123;ViewVO.username&#125;\"&gt;&lt;/td&gt; &lt;td th:text=\"$&#123;ViewVO.type&#125;\"&gt;&lt;/td&gt; &lt;td th:text=\"$&#123;#dates.format(ViewVO.gmtCreate, 'yyyy-MM-dd')&#125;\"&gt;&lt;/td&gt; &lt;td&gt;&lt;a th:href=\"@&#123;/delete(uerId=$&#123;ViewVO.userId&#125;)&#125;\"&gt;åˆ é™¤&lt;/a&gt;&lt;/td&gt; &lt;/tr&gt; &lt;/th:block&gt; &lt;/th:block&gt; &lt;/table&gt;&lt;/body&gt;&lt;/html&gt; è¿‡æ»¤å™¨å¯¹æŸäº›ç‰¹å®šé¡µé¢çš„è®¿é—®éœ€è¦æœ‰ä¸€å®šçš„å‰ææ¡ä»¶ï¼šæ¯”å¦‚ç”¨æˆ·æ˜¯å¦ç™»å½•ï¼Œç”¨æˆ·æ˜¯å¦æ‹¥æœ‰è®¿é—®æ­¤é¡µé¢çš„æƒé™ç­‰ã€‚è¦å®ç°è¿™æ ·çš„åŠŸèƒ½å¯ä»¥ä½¿ç”¨ Filterã€‚ è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåºï¼š(1) é€šè¿‡å®ä¾‹åŒ– FilterRegistrationBean ç±»è‡ªå®šä¹‰ Filterï¼ŒsetOrder() æ–¹æ³•å¯ä»¥å®šä¹‰æ‰§è¡Œé¡ºåºã€‚ï¼ˆå°çš„ä¼˜å…ˆï¼‰(2) é€šè¿‡é™å®šç±»åé™å®š Filter çš„é¡ºåºã€‚ï¼ˆé»˜è®¤åˆå§‹åŒ–è¿‡æ»¤å™¨æ—¶è¿›è¡Œäº†ç±»åçš„æ’åºï¼‰ 123456789101112131415161718192021222324252627282930313233@Component@WebFilter(filterName = \"/Filter0Session\", urlPatterns = &#123;\"/index\", \"/add\", \"/modify\", \"/view\", \"/delete\", \"/loginOut\"&#125;)public class Filter0Session implements Filter &#123; private Filter0Session() &#123;&#125; /** è¿‡æ»¤å™¨åˆå§‹åŒ–æ–¹æ³•ï¼Œweb æœåŠ¡å™¨æ ¹æ®é…ç½®åˆ›å»º Filter å®ä¾‹ */ @Override public void init(FilterConfig fConfig) throws ServletException &#123; // Do nothing. &#125; @Override public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException &#123; HttpServletRequest httpServletRequest = (HttpServletRequest) request; HttpServletResponse httpServletResponse = (HttpServletResponse) response; HttpSession httpSession = httpServletRequest.getSession(false); if (httpSession != null &amp;&amp; httpSession.getAttribute(UserConstant.USERNAME) != null) &#123; // ç”¨æˆ·å·²ç™»å½•åˆ™æ”¾è¡Œ chain.doFilter(request, response); &#125; else &#123; // æ£€æµ‹åˆ°ç”¨æˆ·æœªç™»å½•åˆ™è·³è½¬é‡å®šå‘åˆ°ç™»é™†é¡µé¢ httpServletResponse.sendRedirect(\"/login\"); &#125; &#125; /** è¿‡æ»¤å™¨é”€æ¯æ–¹æ³•ï¼Œå¯ä»¥é‡Šæ”¾è¿‡æ»¤å™¨ä½¿ç”¨çš„èµ„æº */ @Override public void destroy() &#123; // Do nothing. &#125;&#125; 12345678910111213141516171819202122232425262728293031323334@Component@WebFilter(filterName = \"/Filter1Admin\", urlPatterns = &#123;\"/add\", \"/view\", \"/delete\"&#125;)public class Filter1Admin implements Filter &#123; private Filter1Admin() &#123;&#125; @Override public void init(FilterConfig fConfig) throws ServletException &#123; // Do nothing. &#125; @Override public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException &#123; HttpServletRequest httpServletRequest = (HttpServletRequest) request; HttpServletResponse httpServletResponse = (HttpServletResponse) response; HttpSession httpSession = httpServletRequest.getSession(false); // æ£€æµ‹ç”¨æˆ·æ˜¯å¦ç™»å½•ï¼Œå¹¶ä¸”ç”¨æˆ·ç±»å‹æ˜¯å¦ä¸ºç®¡ç†å‘˜ if (httpSession != null &amp;&amp; httpSession.getAttribute(UserConstant.USERNAME) != null &amp;&amp; httpSession.getAttribute(UserConstant.TYPE) != null &amp;&amp; UserTypeConstant.ADMIN.equals(httpSession.getAttribute(UserConstant.TYPE))) &#123; chain.doFilter(request, response); &#125; else &#123; httpServletResponse.sendRedirect( \"/login\"); &#125; &#125; @Override public void destroy() &#123; // Do nothing. &#125;&#125; ï¼ï¼ï¼@ServletComponentScan(value = â€œcom.wingo.user.filterâ€) å…¨å±€å¼‚å¸¸å¤„ç†å¯¹äºå‰ç«¯ä¼ è¾“çš„æ•°æ®ï¼Œåœ¨ DTO ç±»ä¸­æ·»åŠ  JSR303 æ ¡éªŒï¼Œåœ¨æµ‹è¯•çš„æ—¶å€™å‘ç°æ­¤æ ¡éªŒçš„æŠ›å‡ºå¼‚å¸¸æ—¶ï¼ŒSpring Boot ä¼šè‡ªåŠ¨è·³è½¬åˆ°é»˜è®¤çš„ error é¡µé¢ã€‚åŸå› åœ¨äºé¡¹ç›®ä¸­æœªå¯¹æ­¤æ ¡éªŒç´¢æŠ›å‡ºçš„å¼‚å¸¸è¿›è¡Œå¤„ç†ã€‚å…ˆçœ‹çœ‹æ ¡éªŒåæ‰€æŠ›å‡ºçš„å¼‚å¸¸ä¿¡æ¯ã€‚ Spring Boot é»˜è®¤çš„é”™è¯¯æç¤ºé¡µé¢ï¼š æ§åˆ¶å°æŠ›å‡ºçš„å¼‚å¸¸BindException: org.springframework.validation.BeanPropertyBindingResult: 3 errors å¯ä»¥åœ¨ controller ç±»ä¸­æ·»åŠ  try{ }catch{ } å¼‚å¸¸å¤„ç†å—æ•æ‰å¼‚å¸¸æŠ›å‡ºï¼Œå¹¶è¿›è¡Œå¤„ç†ï¼ˆå¦‚è¿”å› Jsonï¼‰ã€‚ä½†è¿™æ ·ä»£ç å¾ˆä¸ç¾è§‚ï¼Œæ¨èä½¿ç”¨çš„æ–¹å¼æ˜¯ç”¨æ³¨è§£ @ControllerAdvice + @ExceptionHandler å…¨å±€å¤„ç† Controller å±‚å¼‚å¸¸ã€‚ ç¼–å†™å…¨å±€å¤„ç†ç±» 12345678910111213141516171819202122232425262728@Slf4j@ControllerAdvice // å£°æ˜å…¨å±€çš„å¼‚å¸¸å¤„ç†ç±»@ResponseBodypublic class GlobalExceptionHandler &#123; // å®šä¹‰æ•æ‰çš„å¼‚å¸¸ @ExceptionHandler(BindException.class) @ResponseStatus(HttpStatus.BAD_REQUEST) public ResponseVO resolveMethodArgumentNotValidException(BindException exception) &#123; ResponseVO response = new ResponseVO(); // å®šä¹‰å­—æ®µåŠæ ¡éªŒå¼‚å¸¸ä¿¡æ¯çš„ key / value ç»“æ„ Map&lt;String, String&gt; fieldAndMessage = new HashMap&lt;&gt;(16); StringBuilder sb = new StringBuilder(); // ç»„è£…å­—æ®µåŠæ ¡éªŒå¼‚å¸¸ä¿¡æ¯ for (FieldError fieldError : exception.getBindingResult().getFieldErrors()) &#123; fieldAndMessage.put(fieldError.getField(), fieldError.getDefaultMessage()); sb.append(fieldError.getField()).append(\":\").append(fieldError.getDefaultMessage()).append(\";\"); &#125; String strField = sb.toString(); // ç»„è£…å¼‚å¸¸ä¿¡æ¯ï¼šä»è‡ªå®šä¹‰çš„å¼‚å¸¸ä¿¡æ¯æšä¸¾ç±»ä¸­å–å¾—ä¿¡æ¯ response.setCode(ResponseCodeTypeEnum.PARAMETER_ERROR.getCode()); response.setMessage(ResponseCodeTypeEnum.PARAMETER_ERROR.getMessage()); // æ–¹ä¾¿è°ƒè¯•ï¼šå°†å¼‚å¸¸ç»Ÿä¸€æ‰“å°å‡ºæ¥ log.warn(\"BindException.class å¼‚å¸¸ä¿¡æ¯: &#123;&#125;\", strField); // è¿”å› Json return response; &#125;&#125; è¿è¡Œç»“æœï¼šæ­¤æ—¶å·²ä¸æ˜¾ç¤ºé»˜è®¤çš„é”™è¯¯é¡µé¢ï¼Œè€Œæ˜¯æ˜¾ç¤ºç”±ç”¨æˆ·å®šä¹‰çš„ Json å­—ç¬¦ä¸²ã€‚ æ§åˆ¶å°è¾“å‡ºï¼šæ–¹ä¾¿å¼€å‘è°ƒè¯•ã€‚ è‡ªå®šä¹‰ SQL æ—¥å¿—æ‰“å°å½“å¼€å¯ Mybatis çš„é»˜è®¤æ—¥å¿—æ‰“å°ï¼Œæ§åˆ¶å°çš„ SQL é»˜è®¤æ‰“å°æ ·å¼ï¼š è‡ªå®šä¹‰æ‹¦æˆªå™¨ï¼š [Mybatis æ’ä»¶æ‹¦æˆªå™¨]([https://welab-wingo.cn/2020/03/29/Software/Mybatis/Mybatis%20%E6%8F%92%E4%BB%B6%E4%B9%8B%E6%8B%A6%E6%88%AA%E5%99%A8/](https://welab-wingo.cn/2020/03/29/Software/Mybatis/Mybatis æ’ä»¶ä¹‹æ‹¦æˆªå™¨/)) 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170@Slf4j@Component@Intercepts(&#123;@Signature(type = Executor.class, method = \"update\", args = &#123;MappedStatement.class, Object.class&#125;), @Signature(type = Executor.class, method = \"query\", args = &#123;MappedStatement.class, Object.class, RowBounds.class, ResultHandler.class&#125;)&#125;)public class SqlInterceptor implements Interceptor &#123; private Properties properties; @Override public Object intercept(Invocation invocation) throws Throwable &#123; // MappedStatement ç»´æŠ¤äº†ä¸€æ¡ mapper.xml æ–‡ä»¶é‡Œé¢ select ã€updateã€deleteã€insert èŠ‚ç‚¹çš„å°è£… MappedStatement mappedStatement = (MappedStatement) invocation.getArgs()[0]; Object parameter = null; if (invocation.getArgs().length &gt; 1) &#123; parameter = invocation.getArgs()[1]; &#125; // String sqlId = mappedStatement.getId(); // è·å–åŠ¨æ€ç”Ÿæˆçš„ SQL è¯­å¥ä»¥åŠç›¸åº”çš„å‚æ•°ä¿¡æ¯å¯¹è±¡ BoundSql boundSql = mappedStatement.getBoundSql(parameter); // MyBatis æ‰€æœ‰çš„é…ç½®ä¿¡æ¯éƒ½ç»´æŒåœ¨ Configuration å¯¹è±¡ä¹‹ä¸­ï¼ŒåŒ…æ‹¬ idã€Statement ç±»å‹ã€SQL ç±»å‹ã€mapper çš„ xml æ–‡ä»¶çš„ç»å¯¹åœ°å€ã€æ˜¯å¦ä½¿ç”¨ç¼“å­˜ç­‰é…ç½® Configuration configuration = mappedStatement.getConfiguration(); Object returnValue = null; long start = System.currentTimeMillis(); // ç»§ç»­æ‰§è¡ŒåŸç›®æ ‡æ–¹æ³• returnValue = invocation.proceed(); // è·å–å®ä½“ç±» Class&lt;?&gt; parameterType = getParameterType(mappedStatement); /** åˆ¤æ–­å®ä½“ç±»ä¸Šæ˜¯å¦åŒ…å« @SqlPrint æ³¨è§£ï¼Œä¸åŒ…å«çš„è¯ç›´æ¥è¿”å› */ if (!hasSqlPrintAnnotation(parameterType)) &#123; return returnValue; &#125; long end = System.currentTimeMillis(); long time = (end - start); /** å½“ SQL æ‰§è¡Œå¤§äº 1 æ¯«ç§’æ—¶æ‰“å° SQLï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥ç”¨äºæ…¢ SQL çš„æ‰“å°åŠç›‘æ§ */ if (time &gt; 1) &#123; String sql = getSql(configuration, boundSql, sqlId, time); log.info(sql); &#125; // è¿”å›æ‰§è¡Œåçš„ç»“æœ return returnValue; &#125; /** * ä½œç”¨ï¼šåŒ…è£…ç›®æ ‡å¯¹è±¡ï¼ŒåŒ…è£…çš„æ„æ€å°±æ˜¯ä¸ºç›®æ ‡å¯¹è±¡åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡ */ @Override public Object plugin(Object target) &#123; /** åˆ¤æ–­ä¸‹éœ€è¦æ‹¦æˆªçš„ç›®æ ‡å¯¹è±¡ç±»å‹ï¼Œéœ€è¦æ‹¦æˆªæ—¶æ‰æ‹¦æˆªï¼Œå¦åˆ™ç›´æ¥è¿”å›æœ¬èº«ï¼Œå‡å°‘è¢«ä»£ç†çš„æ¬¡æ•° */ if (target instanceof Executor) &#123; // å€ŸåŠ© Plugin çš„ wrap æ–¹æ³•æ¥ä½¿ç”¨å½“å‰çš„æ‹¦æˆªå™¨åŒ…è£…æˆ‘ä»¬çš„ç›®æ ‡å¯¹è±¡ï¼Œè¿”å›çš„å°±æ˜¯ä¸ºå½“å‰ target åˆ›å»ºçš„åŠ¨æ€ä»£ç† // ä½¿ç”¨ JDK çš„åŠ¨æ€ä»£ç†ï¼Œç»™ target å¯¹è±¡åˆ›å»ºä¸€ä¸ª delegate ä»£ç†å¯¹è±¡ï¼Œä»¥æ­¤æ¥å®ç°æ–¹æ³•æ‹¦æˆªå’Œå¢å¼ºåŠŸèƒ½ï¼Œå®ƒä¼šå›è°ƒ intercept() æ–¹æ³•ã€‚ return Plugin.wrap(target, this); &#125; else &#123; // æ— éœ€æ‹¦æˆªåˆ™ç›´æ¥è¿”å›ç›®æ ‡å¯¹è±¡æœ¬èº« return target; &#125; &#125; /** * å°†æ’ä»¶æ³¨å†Œæ—¶çš„ property å±æ€§è®¾ç½®è¿›æ¥ */ @Override public void setProperties(Properties properties) &#123; this.properties = properties; &#125; /** * ç»„è£…éœ€è¦æ‰“å°çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ SQL è¯­å¥ã€ç‰¹æ®Šæ ‡è®°ã€SQL æ‰§è¡Œæ—¶é—´ç­‰ * * @param configuration MyBatis æ‰€æœ‰çš„é…ç½®ä¿¡æ¯éƒ½ç»´æŒåœ¨ Configuration å¯¹è±¡ä¹‹ä¸­ * @param boundSql è¡¨ç¤ºåŠ¨æ€ç”Ÿæˆçš„ SQL è¯­å¥ä»¥åŠç›¸åº”çš„å‚æ•°ä¿¡æ¯å¯¹è±¡ * @param sqlId æ‹¦æˆªçš„æ‰§è¡Œ SQL çš„idï¼ˆå¯ä»¥ç†è§£ä¸ºæ–¹æ³•ï¼‰ * @param time SQL æ‰§è¡Œæ—¶é—´ * @return */ private static String getSql(Configuration configuration, BoundSql boundSql, String sqlId, long time) &#123; String sql = showSql(configuration, boundSql); StringBuilder str = new StringBuilder(100); // æ‹¦æˆªçš„æ‰§è¡Œ SQL çš„idï¼ˆå¯ä»¥ç†è§£ä¸ºæ–¹æ³•ï¼‰ï¼Œä¾‹å¦‚ï¼šcom.gorge4j.user.mapper.UserManageDemoMyBatisMapper.update str.append(sqlId); str.append(\" : \"); // å…·ä½“æ‰§è¡Œçš„ SQL è¯­å¥ str.append(sql); str.append(\" &gt;&gt;&gt;&gt;&gt;&gt; \"); // SQL æ‰§è¡Œçš„æ—¶é—´ str.append(\"SQLæ‰§è¡Œè€—æ—¶: \"); str.append(time); str.append(\"ms\"); return str.toString(); &#125; /** æŒ‰ç±»å‹æ ¼å¼åŒ– SQL é‡Œçš„å‚æ•° */ private static String getFormatParameterValue(Object obj) &#123; String value = null; if (obj instanceof String) &#123; value = \"'\" + obj.toString() + \"'\"; &#125; else if (obj instanceof Date) &#123; DateFormat formatter = DateFormat.getDateTimeInstance(DateFormat.DEFAULT, DateFormat.DEFAULT, Locale.CHINA); value = \"'\" + formatter.format(new Date()) + \"'\"; &#125; else &#123; if (obj != null) &#123; value = obj.toString(); &#125; else &#123; value = \"\"; &#125; &#125; return value; &#125; /** ç»„è£…éœ€è¦æ‰“å°çš„ SQL */ private static String showSql(Configuration configuration, BoundSql boundSql) &#123; // å–å¾—å‚æ•°çš„å¯¹è±¡ï¼Œå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªå¤šä¸ªå‚æ•°çš„ map ç»“æ„ // ç¤ºä¾‹ï¼šparameterObject:MapperMethod&#123;password=123456,name=xxxxxx,type=O,param3=O,param1=xxxxxx,param2=123456&#125; Object parameterObject = boundSql.getParameterObject(); // æŸ¥è¯¢ SQL ä¸­çš„å‚æ•° List&lt;ParameterMapping&gt; parameterMappings = boundSql.getParameterMappings(); // å°† SQL ä¸­ä¸€ä¸ªæˆ–å¤šä¸ªå›è½¦æ¢è¡Œç¬¦å·æ›¿æ¢æˆä¸€ä¸ªç©ºæ ¼ String sql = boundSql.getSql().replaceAll(\"[\\\\s]+\", \" \"); if (!parameterMappings.isEmpty() &amp;&amp; parameterObject != null) &#123; // Mybatis åœ¨å¯åŠ¨æ—¶å°±ä¼šé€šè¿‡ TypeHandlerRegistry è¿›è¡Œæ³¨å†Œï¼Œå³å»ºç«‹ JdbcType, JavaType, TypeHandler ä¸‰è€…ä¹‹é—´çš„å…³ç³»ã€‚ // å› æ­¤ï¼Œè¿™æ„å‘³ç€åœ¨ Mybatis å¯åŠ¨æ—¶æˆ‘ä»¬ä¹Ÿéœ€è¦é€šè¿‡ TypeHandlerRegistry å°†æˆ‘ä»¬çš„æ‰€æœ‰çš„æšä¸¾ç±»å‹ï¼ˆJavaTypeï¼‰ä¸è‡ªå®šä¹‰çš„æšä¸¾ // TypeHandlerï¼ˆEnumTypeHandlerï¼‰å»ºç«‹è”ç³» TypeHandlerRegistry typeHandlerRegistry = configuration.getTypeHandlerRegistry(); // è‡ªå®šä¹‰ TypeHandler æ—¶ä¼šèµ°è¿™ä¸ªé€»è¾‘ï¼Œå»ºç«‹ JavaType å’Œ JdbcType ä¹‹é—´çš„è”ç³» if (typeHandlerRegistry.hasTypeHandler(parameterObject.getClass())) &#123; // æ›¿æ¢ SQL ä¸­çš„å ä½ç¬¦ â€œ?â€ ä¸ºå…·ä½“çš„å‚æ•°ï¼ŒreplaceFirst ä½œä¸ºæ˜¯æ›¿æ¢åŒ¹é…åˆ°çš„ç¬¬ä¸€ä¸ªå ä½ç¬¦ â€œ?â€ sql = sql.replaceFirst(\"\\\\?\", getFormatParameterValue(parameterObject)); &#125; // æ²¡æœ‰è‡ªå®šä¹‰çš„ TypeHandlerï¼Œèµ°é€šç”¨é€»è¾‘ else &#123; // æ‹¿åˆ° targetï¼ˆæ‹¦æˆªå¯¹è±¡ï¼‰çš„å…ƒæ•°æ® MetaObject metaObject = configuration.newMetaObject(parameterObject); // å‚æ•°æ˜¯æŒ‰é¡ºåºå­˜å‚¨çš„ï¼Œä¸‹é¢é€»è¾‘æŒ‰é¡ºåºæ¥æ›¿æ¢ for (ParameterMapping parameterMapping : parameterMappings) &#123; // è·å–å‚æ•°çš„åç§° String propertyName = parameterMapping.getProperty(); // å¦‚æœå…ƒæ•°æ®å¯¹è±¡ä¸­å­˜åœ¨è¯¥å‚æ•°ï¼Œåˆ™æ›¿æ¢ç›¸åº”çš„å ä½ç¬¦ â€œ?â€ if (metaObject.hasGetter(propertyName)) &#123; Object obj = metaObject.getValue(propertyName); sql = sql.replaceFirst(\"\\\\?\", getFormatParameterValue(obj)); &#125; // å¦‚æœæœ‰é¢å¤–çš„å‚æ•°ï¼Œèµ°ä¸‹é¢çš„é€»è¾‘ else if (boundSql.hasAdditionalParameter(propertyName)) &#123; Object obj = boundSql.getAdditionalParameter(propertyName); sql = sql.replaceFirst(\"\\\\?\", getFormatParameterValue(obj)); &#125; &#125; &#125; &#125; // è¿”å›ç»„è£…å¥½çš„ SQL return sql; &#125; /** è·å–å®ä½“å¯¹è±¡ç±»ï¼šclass com.gorge4j.user.entity.UserManageDemoMyBatis */ private Class&lt;?&gt; getParameterType(MappedStatement statement) &#123; if (statement.getParameterMap() == null || statement.getParameterMap().getType() == null) &#123; return null; &#125; return statement.getParameterMap().getType(); &#125; /** åˆ¤æ–­å®ä½“ç±»ä¸Šæ˜¯å¦åŒ…å«è‡ªå®šä¹‰çš„ SQl æ‰“å°çš„æ³¨è§£ @SqlPrint */ private static boolean hasSqlPrintAnnotation(Class&lt;?&gt; classType) &#123; return classType == null ? Boolean.FALSE : classType.isAnnotationPresent(SqlPrint.class); &#125;&#125; æ³¨æ„ï¼šéœ€è¦åœ¨å®ä½“ç±»ä¸Šæ·»åŠ è‡ªå®šä¹‰æ³¨è§£ @SqlPrint è‡ªå®šä¹‰æ³¨è§£ç±»ï¼š 12345@Retention(RUNTIME)@Target(TYPE)public @interface SqlPrint &#123;&#125; è‡ªå®šä¹‰çš„ SQL æ—¥å¿—æ‰“å°æ ·å¼ï¼š è·¨åŸŸ è·¨åŸŸï¼Œæ˜¯æŒ‡æµè§ˆå™¨ä¸èƒ½æ‰§è¡Œå…¶ä»–ç½‘ç«™çš„è„šæœ¬ã€‚å®ƒæ˜¯ç”±æµè§ˆå™¨çš„åŒæºç­–ç•¥é€ æˆçš„ï¼Œæ˜¯æµè§ˆå™¨å¯¹ JavaScript å®æ–½çš„å®‰å…¨ç­–ç•¥ã€‚ 123456789101112131415161718192021222324@Configurationpublic class CorsConfig extends WebMvcConfigurationSupport &#123; @Override public void addCorsMappings(CorsRegistry registry) &#123; registry.addMapping(\"/**\") .allowedOrigins(\"*\") .allowCredentials(true) .allowedHeaders(\"*\") .allowedMethods(\"GET\", \"POST\", \"DELETE\", \"PUT\", \"OPTIONS\") .maxAge(3600); &#125; // é…ç½® Swagger çš„èµ„æºæ˜ å°„ @Override public void addResourceHandlers(ResourceHandlerRegistry registry) &#123; registry.addResourceHandler(\"swagger-ui.html\") .addResourceLocations(\"classpath:/META-INF/resources/\"); registry.addResourceHandler(\"/webjars/**\") .addResourceLocations(\"classpath:/META-INF/resources/webjars/\"); &#125;&#125; æ³¨æ„12345/** * @see EnableWebMvc ç”¨äº†æ­¤æ³¨è§£é»˜è®¤é…ç½®çš„ MVC å¤±æ•ˆï¼Œéœ€è¦ç”¨æˆ·é‡æ–°é…ç½® * @see WebMvcConfigurer */public class WebMvcConfigurationSupport ... è‡ªå®šä¹‰æ ¡éªŒ é™¤äº†ä½¿ç”¨é»˜è®¤æä¾›çš„ Validatorï¼Œç”¨æˆ·è¿˜å¯ä»¥æä¾›å…·æœ‰è‡ªå®šä¹‰æ ¡éªŒè§„åˆ™çš„ Validatorã€‚ æ³¨è§£ç±»123456789@Target(&#123;ElementType.FIELD&#125;)@Retention(RetentionPolicy.RUNTIME)@Constraint(validatedBy = UsernameValidator.class) // å¼•å…¥æ ¡éªŒè§„åˆ™ç±»è¿›è¡Œæ ¡éªŒpublic @interface Username &#123; // é”™è¯¯æç¤ºæ¶ˆæ¯ @Username(message = \"\") String message() default \"&#123;com.wingo.user.annotaion.Username.message&#125;\"; Class&lt;?&gt;[] groups() default &#123;&#125;; Class&lt;? extends Payload&gt;[] payload() default &#123;&#125;;&#125; 12345678@Target(&#123;ElementType.FIELD&#125;)@Retention(RetentionPolicy.RUNTIME)@Constraint(validatedBy = PasswordValidator.class)public @interface Password &#123; String message() default \"&#123;com.wingo.user.annotaion.Password.message&#125;\"; Class&lt;?&gt;[] groups() default &#123;&#125;; Class&lt;? extends Payload&gt;[] payload() default &#123;&#125;;&#125; æ ¡éªŒç±»123456789101112131415public class UsernameValidator implements ConstraintValidator&lt;Username, String&gt; &#123; @Override public void initialize(Username constraintAnnotation) &#123; // do nothing &#125; @Override public boolean isValid(String value, ConstraintValidatorContext context) &#123; if (StringUtils.isBlank(value)) &#123; return false; &#125; return Pattern.matches(RegexConstant.REGEX_USERNAME, value); &#125;&#125; 123456789101112131415public class PasswordValidator implements ConstraintValidator&lt;Password, String&gt; &#123; @Override public void initialize(Password constraintAnnotation) &#123; // do nothing &#125; @Override public boolean isValid(String value, ConstraintValidatorContext context) &#123; if (StringUtils.isBlank(value)) &#123; return false; &#125; // æ­£åˆ™åŒ¹é… return Pattern.matches(RegexConstant.REGEX_PASS, value); &#125;&#125; è¯·æ±‚å“åº”æ‰“å° åˆ‡é¢ï¼šæ–¹æ³•å‰æ‰“å°è¯·æ±‚ä¿¡æ¯å‚æ•°ï¼›æ–¹æ³•åæ‰“å°å“åº”ä¿¡æ¯ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041@Slf4j@Component@Aspectpublic class ReqAndRespLogAspect &#123; /** * è¯·æ±‚å‚æ•°çš„æ—¥å¿—æ‰“å° * * @param joinPoint åˆ‡ç‚¹ */ @Before(\"within(com.wingo.user.controller.*)\") public void before(JoinPoint joinPoint) &#123; // è·å–ä¼ å…¥ç›®æ ‡æ–¹æ³•çš„å‚æ•°å¯¹è±¡ Object[] args = joinPoint.getArgs(); // è·å–å°è£…äº†ç½²åä¿¡æ¯çš„å¯¹è±¡,åœ¨è¯¥å¯¹è±¡ä¸­å¯ä»¥è·å–åˆ°ç›®æ ‡æ–¹æ³•å,æ‰€å±ç±»çš„Classç­‰ä¿¡æ¯ MethodSignature methodSignature = (MethodSignature) joinPoint.getSignature(); // è·å–æ–¹æ³•å¯¹è±¡ Method method = methodSignature.getMethod(); // åˆ†å‰²ç»„è£…å‚æ•° String strArgs = StringUtils.join(args, \",\"); log.info(\"&#123;&#125;.&#123;&#125; - è¯·æ±‚å‚æ•°: &#123;&#125;\", method.getDeclaringClass().getName(), method.getName(), strArgs); &#125; /** * å“åº”ç»“æœçš„æ—¥å¿—æ‰“å° * * @param joinPoint åˆ‡ç‚¹ * @param res å“åº”ç»“æœå¯¹è±¡ */ @AfterReturning(value = \"within(com.wingo.user.controller.*)\", returning = \"res\") public void after(JoinPoint joinPoint, Object res) &#123; // è·å–å°è£…äº†ç½²åä¿¡æ¯çš„å¯¹è±¡,åœ¨è¯¥å¯¹è±¡ä¸­å¯ä»¥è·å–åˆ°ç›®æ ‡æ–¹æ³•å,æ‰€å±ç±»çš„ Class ç­‰ä¿¡æ¯ MethodSignature methodSignature = (MethodSignature) joinPoint.getSignature(); // è·å–æ–¹æ³•å¯¹è±¡ Method method = methodSignature.getMethod(); // å°†è¿”å›å¯¹è±¡è½¬æ¢æˆ Json å­—ç¬¦ä¸²ï¼Œé¡¹ç›®çš„è¿”å›å¦‚æœä¸æ˜¯ Json çš„æ•°æ®æ ¼å¼ï¼Œé‚£ä¹ˆè¿”å›å‚æ•°å°±åªæœ‰ URL // String strRes = JSONUtils.toJSONString(res); String strRes = res.toString(); log.info(\"&#123;&#125;.&#123;&#125; - è¿”å›ç»“æœ: &#123;&#125;\", method.getDeclaringClass().getName(), method.getName(), strRes); &#125;&#125;","categories":[{"name":"é¡¹ç›®å¼€å‘","slug":"é¡¹ç›®å¼€å‘","permalink":"http://yoursite.com/categories/%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91/"}],"tags":[{"name":"ç”¨æˆ·ç®¡ç†ç³»ç»Ÿ","slug":"ç”¨æˆ·ç®¡ç†ç³»ç»Ÿ","permalink":"http://yoursite.com/tags/%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/"}]},{"title":"Spring Boot æ•°æ®è®¿é—®","slug":"åå°æŠ€æœ¯/Spring Boot/Spring Boot æ•°æ®è®¿é—®","date":"2020-03-05T07:42:42.000Z","updated":"2020-07-10T04:13:37.067Z","comments":true,"path":"2020/03/05/åå°æŠ€æœ¯/Spring Boot/Spring Boot æ•°æ®è®¿é—®/","link":"","permalink":"http://yoursite.com/2020/03/05/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/Spring%20Boot/Spring%20Boot%20%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE/","excerpt":"Spring Boot æ•°æ®è®¿é—®çš„ç›¸å…³çŸ¥è¯†ã€‚","text":"Spring Boot æ•°æ®è®¿é—®çš„ç›¸å…³çŸ¥è¯†ã€‚ JDBC123456789&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt;&lt;/dependency&gt; 1234567spring: datasource: username: root password: 123456 url: jdbc:mysql://localhosthost:3306/jdbc driver-class-name: com.mysql.jdbc.Driver # Spring Boot 2.1.x é»˜è®¤ä½¿ç”¨äº† MySQL 8.0ï¼šcom.mysql.cj.jdbc.Driver Sping Boot é»˜è®¤ä½¿ç”¨ org.apache.tomcat.jdbc.pool.DataSource ä½œä¸ºæ•°æ®æºï¼Œç›¸å…³é…ç½®éƒ½åœ¨ DataSourceProperties é‡Œé¢ã€‚ é»˜è®¤å»ºè¡¨é…ç½®è§„åˆ™ 1schema-*.sql æŒ‡å®šå»ºè¡¨æ–‡ä»¶ sql æ–‡ä»¶çš„æ–‡ä»¶å 1234spring: datasource: schema: - classpath:user.sql Sping Boot è‡ªåŠ¨é…ç½®äº† JdbcTemplate æ“ä½œæ•°æ®åº“ JdbcTempaleåˆ›å»ºä¸€ä¸ª User è¡¨ï¼š 1234CREATE TABLE `User` ( `name` varchar(100) COLLATE utf8mb4_general_ci NOT NULL, `age` int NOT NULL) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci ç¼–å†™å®ä½“å¯¹è±¡ï¼š 12345678@Data // Getter / Setter@NoArgsConstructor // æ— å‚æ„é€ å™¨public class User &#123; private String name; private Integer age;&#125; æ•°æ®è®¿é—®å¯¹è±¡æ¥å£ï¼š 123456789101112131415161718public interface UserService &#123; // æ–°å¢ä¸€ä¸ªç”¨æˆ· int create(String name, Integer age); // æ ¹æ® name æŸ¥è¯¢ç”¨æˆ· List&lt;User&gt; getByName(String name); // æ ¹æ® name åˆ é™¤ç”¨æˆ· int deleteByName(String name); // è·å–ç”¨æˆ·æ€»é‡ int getAllUsers(); // åˆ é™¤æ‰€æœ‰ç”¨æˆ· int deleteAllUsers();&#125; æ•°æ®è®¿é—®æ“ä½œçš„å®ç°ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243@Servicepublic class UserServiceImpl implements UserService &#123; @Autowired private JdbcTemplate jdbcTemplate; UserServiceImpl(JdbcTemplate jdbcTemplate) &#123; this.jdbcTemplate = jdbcTemplate; &#125; @Override public int create(String name, Integer age) &#123; return jdbcTemplate.update(\"insert into USER(NAME, AGE) values(?, ?)\", name, age); &#125; @Override public List&lt;User&gt; getByName(String name) &#123; List&lt;User&gt; users = jdbcTemplate.query (\"select NAME, AGE from USER where NAME = ?\", (resultSet, i) -&gt; &#123; User user = new User(); user.setName(resultSet.getString(\"NAME\")); user.setAge(resultSet.getInt(\"AGE\")); return user; &#125;, name); return users; &#125; @Override public int deleteByName(String name) &#123; return jdbcTemplate.update(\"delete from USER where NAME = ?\", name); &#125; @Override public int getAllUsers() &#123; return jdbcTemplate.queryForObject(\"select count(1) from USER\", Integer.class); &#125; @Override public int deleteAllUsers() &#123; return jdbcTemplate.update(\"delete from USER\"); &#125;&#125; æ•´åˆ Druid æ•°æ®æº123456789101112131415161718&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt;&lt;/dependency&gt;&lt;!-- mysqlé©±åŠ¨ --&gt;&lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;!-- å¯åŠ¨å™¨ä¸­é»˜è®¤çš„ç‰ˆæœ¬è¾ƒé«˜ --&gt; &lt;version&gt;5.1.47&lt;/version&gt; &lt;scope&gt;runtime&lt;/scope&gt;&lt;/dependency&gt;&lt;!--æ•°æ®åº“è¿æ¥æ± --&gt;&lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;druid-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;1.1.20&lt;/version&gt;&lt;/dependency&gt; 123456789101112131415161718192021222324252627282930313233343536373839404142434445spring.datasource.username=rootspring.datasource.password=123456spring.datasource.url=jdbc:mysql://localhost:3306/i-auth?useSSL=false# å¯ä»¥ä¸é…ç½® Druid å¯ä»¥æ ¹æ® url è‡ªåŠ¨è¯†åˆ«æ•°æ®åº“é©±åŠ¨# spring.datasource.driver-class-name=com.mysql.jdbc.Driver# åˆå§‹åŒ–è¿æ¥æ•°spring.datasource.druid.initial-size=5# æœ€å°è¿æ¥æ•°spring.datasource.druid.min-idle=10# æœ€å¤§è¿æ¥æ•°spring.datasource.druid.max-active=10# è·å–è¿æ¥æœ€é•¿ç­‰å¾…æ—¶é—´ å•ä½æ¯«ç§’spring.datasource.druid.max-wait=10000# é…ç½®é—´éš”å¤šä¹…æ‰è¿›è¡Œä¸€æ¬¡æ£€æµ‹ï¼Œæ£€æµ‹éœ€è¦å…³é—­çš„ç©ºé—²è¿æ¥ï¼Œå•ä½æ˜¯æ¯«ç§’spring.datasource.druid.timeBetweenEvictionRunsMillis=30000# æŒ‡å®šè·å–è¿æ¥æ—¶è¿æ¥æ ¡éªŒçš„sqlæŸ¥è¯¢è¯­å¥spring.datasource.druid.validationQuery=select 'x'# è·å–è¿æ¥åï¼Œç¡®å®æ˜¯å¦è¦è¿›è¡Œè¿æ¥ç©ºé—²æ—¶é—´çš„æ£€æŸ¥spring.datasource.druid.testWhileIdle=true# è·å–è¿æ¥æ£€æµ‹spring.datasource.druid.testOnBorrow=false# å½’è¿˜è¿æ¥æ£€æµ‹spring.datasource.druid.testOnReturn=false# æŒ‡å®šè¿æ¥æ ¡éªŒæŸ¥è¯¢çš„è¶…æ—¶æ—¶é—´spring.datasource.druid.validationQueryTimeout=600000# é…ç½®ä¸€ä¸ªè¿æ¥åœ¨æ± æ€»æœ€å°ç”Ÿå­˜çš„æ—¶é—´spring.datasource.druid.minEvictableIdleTimeMillis=300000# æ‰“å¼€ PSCacheï¼Œå¹¶ä¸”æŒ‡å®šæ¯ä¸ªè¿æ¥ä¸Š Cache çš„å¤§å°spring.datasource.druid.poolPreparedStatements=truespring.datasource.druid.maxPoolPreparedStatementPerConnectionSize=20# é…ç½®ç›‘æ§ç»Ÿè®¡æ‹¦æˆªçš„filterï¼Œå»æ‰åç›‘æ§ç•Œé¢sqlæ— æ³•ç»Ÿè®¡ï¼Œ'wall'ç”¨äºé˜²ç«å¢™spring.datasource.druid.filters=stat,wall,slf4j# é€šè¿‡connectPropertieså±æ€§æ¥æ‰“å¼€mergeSqlåŠŸèƒ½ï¼Œæ…¢sqlè®°å½•ç­‰spring.datasource.druid.connectionProperties=druid.stat.mergeSql=true;druid.stat.logSlowSql=true;druid.stat.slowSqlMillis=5000## druidè¿æ¥æ± ç›‘æ§# éœ€è¦è´¦å·å¯†ç æ‰èƒ½è®¿é—®æ§åˆ¶å°ï¼Œé»˜è®¤ä¸ºrootspring.datasource.druid.stat-view-servlet.login-username=adminspring.datasource.druid.stat-view-servlet.login-password=123# è®¿é—®è·¯å¾„ä¸º/druidæ—¶ï¼Œè·³è½¬åˆ°StatViewServletspring.datasource.druid.stat-view-servlet.url-pattern=/druid/*# æ˜¯å¦èƒ½å¤Ÿé‡ç½®æ•°æ®spring.datasource.druid.stat-view-servlet.reset-enable=false# æ’é™¤ä¸€äº›é™æ€èµ„æºï¼Œä»¥æé«˜æ•ˆç‡spring.datasource.druid.web-stat-filter.exclusions=*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/* 1234567891011121314151617181920212223242526272829303132333435363738394041424344// å¯¼å…¥ Druid æ•°æ®æº@Configurationpublic class DruidConfig &#123; // ä¸€ä¸ªè‡ªå®šä¹‰çš„ DataSource ç»„ä»¶ @ConfigurationProperties(prefix = \"spring.datasource\") @Bean public DataSource druid()&#123; return new DruidDataSource(); &#125; // é…ç½® Druid çš„ç›‘æ§ // é…ç½®ä¸€ä¸ªç®¡ç†åå°çš„ Servlet @Bean public ServletRegistrationBean statViewServlet()&#123; ServletRegistrationBean bean = new ServletRegistrationBean(new StatViewServlet(), \"/druid/*\"); Map&lt;String,String&gt; initParams = new HashMap&lt;&gt;(); initParams.put(\"loginUsername\",\"admin\"); initParams.put(\"loginPassword\",\"123456\"); initParams.put(\"allow\",\"\"); // é»˜è®¤å°±æ˜¯å…è®¸æ‰€æœ‰è®¿é—® initParams.put(\"deny\",\"192.168.15.21\"); bean.setInitParameters(initParams); return bean; &#125; // é…ç½®ä¸€ä¸ª Web ç›‘æ§çš„ Filter @Bean public FilterRegistrationBean webStatFilter()&#123; FilterRegistrationBean bean = new FilterRegistrationBean(); bean.setFilter(new WebStatFilter()); Map&lt;String,String&gt; initParams = new HashMap&lt;&gt;(); initParams.put(\"exclusions\",\"*.js,*.css,/druid/*\"); bean.setInitParameters(initParams); bean.setUrlPatterns(Arrays.asList(\"/*\")); return bean; &#125;&#125; æ•´åˆ MyBatiså¯ç›´æ¥ä½¿ç”¨æ’ä»¶ï¼šMybatis-Plus 12345&lt;dependency&gt; &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt; &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;1.3.1&lt;/version&gt;&lt;/dependency&gt; æ³¨è§£ç‰ˆ 1234567891011121314151617// æŒ‡å®šè¿™æ˜¯ä¸€ä¸ªæ“ä½œæ•°æ®åº“çš„ Mapper@Mapperpublic interface DepartmentMapper &#123; @Select(\"select * from department where id=#&#123;id&#125;\") public Department getDeptById(Integer id); @Delete(\"delete from department where id=#&#123;id&#125;\") public int deleteDeptById(Integer id); @Options(useGeneratedKeys = true,keyProperty = \"id\") @Insert(\"insert into department(departmentName) values(#&#123;departmentName&#125;)\") public int insertDept(Department department); @Update(\"update department set departmentName=#&#123;departmentName&#125; where id=#&#123;id&#125;\") public int updateDept(Department department);&#125; 123456789// ä½¿ç”¨ MapperScan æ‰¹é‡æ‰«ææ‰€æœ‰çš„ Mapper æ¥å£ï¼Œæˆ–åœ¨ Mapper ç±»ä½¿ç”¨ Mapper@MapperScan(value = \"com.wingo.springboot.mapper\")@SpringBootApplicationpublic class SpringBootDataMybatisApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(SpringBootDataMybatisApplication.class, args); &#125;&#125; è‡ªå®šä¹‰ MyBatis é…ç½®è§„åˆ™ï¼šé©¼å³°å‘½åæ³•ã€‚ 1234567891011121314@Configuration public class MyBatisConfig &#123; @Bean public ConfigurationCustomizer configurationCustomizer()&#123; return new ConfigurationCustomizer()&#123; @Override public void customize(Configuration configuration) &#123; configuration.setMapUnderscoreToCamelCase(true); &#125; &#125;; &#125; &#125; é…ç½®æ–‡ä»¶ç‰ˆ 12345mybatis: # æŒ‡å®šå…¨å±€é…ç½®æ–‡ä»¶çš„ä½ç½® config-location: classpath:mybatis/mybatis-config.xml # æŒ‡å®š Sql æ˜ å°„æ–‡ä»¶çš„ä½ç½® mapper-locations: classpath:mybatis/mapper/*.xml æ•´åˆ SpringData JPA12345678910111213&lt;!-- JPA --&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;&lt;/dependency&gt;&lt;!-- mysqlé©±åŠ¨ --&gt;&lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;!-- å¯åŠ¨å™¨ä¸­é»˜è®¤çš„ç‰ˆæœ¬è¾ƒé«˜ --&gt; &lt;version&gt;5.1.47&lt;/version&gt; &lt;scope&gt;runtime&lt;/scope&gt;&lt;/dependency&gt; ç¼–å†™ä¸€ä¸ªå®ä½“ç±» Bean å’Œæ•°æ®è¡¨è¿›è¡Œæ˜ å°„ï¼Œå¹¶ä¸”é…ç½®å¥½æ˜ å°„å…³ç³»ï¼š 1234567891011121314// ä½¿ç”¨ JPA æ³¨è§£é…ç½®æ˜ å°„å…³ç³»@Entity // å‘Šè¯‰ JPA è¿™æ˜¯ä¸€ä¸ªå®ä½“ç±»ï¼ˆå’Œæ•°æ®è¡¨æ˜ å°„çš„ç±»ï¼‰@Table(name = \"tbl_user\") // @Table æ¥æŒ‡å®šå’Œå“ªä¸ªæ•°æ®è¡¨å¯¹åº”ï¼Œå¦‚æœçœç•¥é»˜è®¤è¡¨åå°±æ˜¯ userpublic class User &#123; @Id // è¿™æ˜¯ä¸€ä¸ªä¸»é”® @GeneratedValue(strategy = GenerationType.IDENTITY) // è‡ªå¢ä¸»é”® private Integer id; @Column(name = \"last_name\",length = 50) // è¿™æ˜¯å’Œæ•°æ®è¡¨å¯¹åº”çš„ä¸€ä¸ªåˆ— private String lastName; @Column // çœç•¥é»˜è®¤åˆ—åå°±æ˜¯å±æ€§å private String email;&#125; ç¼–å†™ä¸€ä¸ª Dao æ¥å£æ¥æ“ä½œå®ä½“ç±»å¯¹åº”çš„æ•°æ®è¡¨ï¼š 123// ç»§æ‰¿ JpaRepository æ¥å®Œæˆå¯¹æ•°æ®åº“çš„æ“ä½œï¼Œä¼ å‚ï¼šå®ä½“ç±»å‹ ä¸»é”®ç±»å‹public interface UserRepository extends JpaRepository&lt;User,Integer&gt; &#123;&#125; JpaProperties åŸºæœ¬é…ç½® 1234567spring: jpa: hibernate: # æ›´æ–°æˆ–è€…åˆ›å»ºæ•°æ®è¡¨ç»“æ„ ddl-auto: update # æ§åˆ¶å°æ˜¾ç¤ºSQL show-sql: true","categories":[{"name":"åå°æŠ€æœ¯","slug":"åå°æŠ€æœ¯","permalink":"http://yoursite.com/categories/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"MyBatis","slug":"MyBatis","permalink":"http://yoursite.com/tags/MyBatis/"},{"name":"Spring Boot","slug":"Spring-Boot","permalink":"http://yoursite.com/tags/Spring-Boot/"},{"name":"JPA","slug":"JPA","permalink":"http://yoursite.com/tags/JPA/"},{"name":"Druid","slug":"Druid","permalink":"http://yoursite.com/tags/Druid/"},{"name":"JDBC","slug":"JDBC","permalink":"http://yoursite.com/tags/JDBC/"}]},{"title":"Dockerçš„ä½¿ç”¨","slug":"å¼€å‘æ‚é¡¹/Docker çš„ä½¿ç”¨","date":"2020-03-04T09:40:46.000Z","updated":"2020-07-10T03:02:10.457Z","comments":true,"path":"2020/03/04/å¼€å‘æ‚é¡¹/Docker çš„ä½¿ç”¨/","link":"","permalink":"http://yoursite.com/2020/03/04/%E5%BC%80%E5%8F%91%E6%9D%82%E9%A1%B9/Docker%20%E7%9A%84%E4%BD%BF%E7%94%A8/","excerpt":"Docker æ˜¯ä¸€ä¸ªå¼€æºçš„åº”ç”¨å®¹å™¨å¼•æ“ï¼Œæ˜¯ä¸€ä¸ªè½»é‡çº§å®¹å™¨æŠ€æœ¯ã€‚","text":"Docker æ˜¯ä¸€ä¸ªå¼€æºçš„åº”ç”¨å®¹å™¨å¼•æ“ï¼Œæ˜¯ä¸€ä¸ªè½»é‡çº§å®¹å™¨æŠ€æœ¯ã€‚ ç¯å¢ƒæ­å»ºCentOS 7 ä¸‹è½½ï¼šé˜¿é‡Œäº‘é•œåƒ VMware åˆ›å»ºè™šæ‹Ÿæœºè¿è¡Œ CentOS 7 å…‰ç›˜æ˜ åƒæ–‡ä»¶ã€‚ é€‰æ‹© &gt; SYSTEM &gt; INSTALLATION DESTINATIONï¼Œè¿›å…¥ç£ç›˜åˆ†åŒºç•Œé¢ï¼› é€‰æ‹© &gt; I will configure partitioning &gt; Done &gt; partitioning scheme &gt; Standard Partition &gt; + &gt;ï¼š æŒ‚è½½ç‚¹ï¼šswapï¼ŒæœŸæœ›å®¹é‡ï¼š4096ï¼›æŒ‚è½½ç‚¹ï¼š/ï¼ŒæœŸæœ›å®¹é‡ï¼šç•™ç©ºã€‚é€‰æ‹© &gt; SOFTWARE &gt; Minimal Installã€‚Begin Install &gt; è®¾ç½®å¯†ç  &gt; Reboot &gt; åˆå§‹åŒ–å®Œæˆã€‚ ç½‘ç»œé…ç½® CentOS 7.x é»˜è®¤å®‰è£…å¥½ä¹‹åæ˜¯æ²¡æœ‰è‡ªåŠ¨å¼€å¯ç½‘ç»œè¿æ¥çš„ï¼Œéœ€è¦è‡ªè¡Œé…ç½®ã€‚ ï¼ï¼ï¼æ³¨æ„ï¼ï¼ï¼VMWare ç½‘ç»œé€‰æ‹©æ¡¥æ¥æ¨¡å¼ã€‚ 1234cat /etc/sysconfig/network-scripts/ifcfg-ens33 # é»˜è®¤çš„ç½‘ç»œé…ç½®æ–‡ä»¶mv ifcfg-ens33 ifcfg-eth0 # ä¿®æ”¹ä¹ æƒ¯æ€§å‘½åip address # æŸ¥çœ‹ MACvi /etc/sysconfig/network-scripts/ifcfg-eth0 # ä¿®æ”¹é…ç½® æ³¨æ„ï¼šé»˜è®¤ç½‘å…³ä¸€è‡´ï¼›DHCP åŠ¨æ€åˆ†é…æ”¹ä¸º STATIC é™æ€æ¨¡å¼ï¼›é™æ€ IP åœ°å€å¡«å†™ä¸ä¸»æœºç›¸åŒçš„ç½‘æ®µå†…ï¼›MAC åœ°å€éšæœºåˆ†é…ï¼Œä¸å¯é‡å¤ï¼Œå¤åˆ¶ä¸»æœºçš„æ—¶å€™è®°å¾—ä¿®æ”¹ã€‚ä¸€ä¸‹æ˜¯éœ€è¦ä¿®æ”¹çš„é…ç½®ï¼š ä¿®æ”¹ä¸»æœºåï¼šhostnamectl set-hostname [new_hostname] --static Docker å®‰è£…1yum -y install docker æ ¸å¿ƒæ¦‚å¿µDocker ä¸»æœº Hostï¼šå®‰è£…äº† Docker ç¨‹åºçš„æœºå™¨ï¼ˆDocker ç›´æ¥å®‰è£…åœ¨æ“ä½œç³»ç»Ÿä¹‹ä¸Šï¼‰ï¼› Docker å®¢æˆ·ç«¯ Clientï¼šè¿æ¥ Docker ä¸»æœºè¿›è¡Œæ“ä½œï¼› Docker ä»“åº“ Registryï¼šç”¨æ¥ä¿å­˜å„ç§æ‰“åŒ…å¥½çš„è½¯ä»¶é•œåƒï¼› Docker é•œåƒ Imagesï¼šè½¯ä»¶æ‰“åŒ…å¥½çš„é•œåƒ,æ”¾åœ¨ Docker ä»“åº“ä¸­ï¼› Docker å®¹å™¨ Containerï¼šé•œåƒå¯åŠ¨åçš„å®ä¾‹ç§°ä¸ºä¸€ä¸ªå®¹å™¨ï¼›å®¹å™¨æ˜¯ç‹¬ç«‹è¿è¡Œçš„ä¸€ä¸ªæˆ–ä¸€ç»„åº”ç”¨ã€‚ Docker ä½¿ç”¨ è™šæ‹Ÿæœºè®°å¾—è®¾ç½®æ¡¥æ¥ç½‘ç»œå¹¶é€‰æ‹©å¯¹åº”çš„ç½‘å¡æ¥å…¥ç½‘çº¿ã€‚ 1234# è®¾ç½®å¥½ç½‘ç»œä»¥åä½¿ç”¨å‘½ä»¤é‡å¯è™šæ‹Ÿæœºçš„ç½‘ç»œservice network restart# æŸ¥çœ‹ Linux çš„ IP åœ°å€ip addr Linux ç¯å¢ƒä¸‹ Docker çš„å®‰è£…ï¼š 12345678910111213# æ£€æŸ¥å†…æ ¸ç‰ˆæœ¬ï¼ŒDocker è¦æ±‚å†…æ ¸ç‰ˆæœ¬å¿…é¡»æ˜¯ 3.10 åŠä»¥ä¸Šuname -sr# å®‰è£… Dockeryum install docker# è¾“å…¥ y ç¡®è®¤å®‰è£…# å¯åŠ¨ Dockersystemctl start docker# æŸ¥çœ‹ç‰ˆæœ¬docker -v# å¼€æœºå¯åŠ¨ Dockersystemctl enable docker# åœæ­¢ Dockersystemctl stop docker Docker å¸¸ç”¨å‘½ä»¤æ“ä½œ æ“ä½œ å‘½ä»¤ è¯´æ˜ æ£€ç´¢ docker search [name] æˆ‘ä»¬ç»å¸¸å» docker hub ä¸Šæ£€ç´¢é•œåƒçš„è¯¦ç»†ä¿¡æ¯ï¼Œå¦‚é•œåƒçš„ tag æ‹‰å– docker pull [name]:tag :tag æ˜¯å¯é€‰çš„ï¼Œtag è¡¨ç¤ºæ ‡ç­¾ï¼Œå¤šä¸ºè½¯ä»¶çš„ç‰ˆæœ¬ï¼Œé»˜è®¤æ˜¯ latest åˆ—è¡¨ docker images æŸ¥çœ‹æ‰€æœ‰æœ¬åœ°é•œåƒ åˆ é™¤ docker rm image-id åˆ é™¤æŒ‡å®šçš„æœ¬åœ°é•œåƒ 123456789101112131415161718192021222324252627# æœç´¢é•œåƒdocker search tomcat# æ‹‰å–é•œåƒdocker pull tomcat# æ ¹æ®é•œåƒå¯åŠ¨å®¹å™¨ï¼Œæ²¡æœ‰åšæ˜ å°„æ— æ³•æ­£å¸¸è®¿é—®docker run --name mytomcat -d tomcat:latest# æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨docker ps # åœæ­¢è¿è¡Œä¸­çš„å®¹å™¨docker stop cantainerId# æŸ¥çœ‹æ‰€æœ‰çš„å®¹å™¨ï¼Œè¿è¡Œä¸­å’Œå·²ç»é€€å‡ºçš„docker ps -a# å¯åŠ¨å®¹å™¨docker start cantainerId# åˆ é™¤ä¸€ä¸ªå®¹å™¨docker rm cantainerId# å¯åŠ¨ä¸€ä¸ªåšäº†ç«¯å£æ˜ å°„çš„ tomcatdocker run -d -p 8888:8080 tomcat# -dï¼šåå°è¿è¡Œ# -p: å°†ä¸»æœºçš„ç«¯å£æ˜ å°„åˆ°å®¹å™¨çš„ä¸€ä¸ªç«¯å£ ä¸»æœºç«¯å£:å®¹å™¨å†…éƒ¨çš„ç«¯å£# æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€service firewalld status# å…³é—­é˜²ç«å¢™service firewalld stop# æŸ¥çœ‹å®¹å™¨çš„æ—¥å¿—docker logs container-name/container-id# å…·ä½“é•œåƒçš„å¯åŠ¨æ“ä½œå¯ä»¥å‚è€ƒæ¯ä¸€ä¸ªé•œåƒçš„æ–‡æ¡£ å¸¸ç”¨é•œåƒå®‰è£…MySQL1234567891011# å®‰è£…å¹¶å¯åŠ¨ MySQL é•œåƒdocker pull mysqldocker run --name mysql01 -d mysqldocker ps -a# å‘ç°å®¹å™¨å¼‚å¸¸é€€å‡ºäº†ï¼ŒæŸ¥çœ‹é”™è¯¯æ—¥å¿—docker logs containerId# å‘ç°æ˜¯å› ä¸ºæ²¡æœ‰æŒ‡å®šè´¦å·å¯†ç # æ­£ç¡®å¯åŠ¨å¹¶æŒ‡å®šç«¯å£æ˜ å°„docker run -p 3306:3306 --name mysql01 -e MYSQL_ROOT_PASSWORD=123456 -d mysql# docker run --name mysql03 -v [è‡ªå®šä¹‰ MySQL é…ç½®æ–‡ä»¶çš„ç›®å½•]:/etc/mysql/conf.d -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag# docker run --name some-mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci RedisDocker Hub æŸ¥è¯¢ Redis æºã€‚ 123docker pull redisdocker images # æŸ¥çœ‹é•œåƒåç§°docker run -d -p 6379:6379 --name myredis [é•œåƒåç§°] # redis å®¢æˆ·ç«¯æµ‹è¯•è¿æ¥ RabbitMQ1docker run -d -p 5672:5672 -p 15672:15672 --hostname my_rabbitmq --name rabbitmq rabbitmq:management å¸¸è§é”™è¯¯1WARNING: IPv4 forwarding is disabled. Networking will not work. systemctl restart dockeré‡å¯ä¸€ä¸‹ Docker æœåŠ¡å³å¯ã€‚","categories":[{"name":"å¼€å‘æ‚é¡¹","slug":"å¼€å‘æ‚é¡¹","permalink":"http://yoursite.com/categories/%E5%BC%80%E5%8F%91%E6%9D%82%E9%A1%B9/"}],"tags":[{"name":"Docker","slug":"Docker","permalink":"http://yoursite.com/tags/Docker/"}]},{"title":"Spring Boot Web å¼€å‘","slug":"åå°æŠ€æœ¯/Spring Boot/Spring Boot Web å¼€å‘","date":"2020-03-03T06:08:47.000Z","updated":"2020-07-10T04:13:45.688Z","comments":true,"path":"2020/03/03/åå°æŠ€æœ¯/Spring Boot/Spring Boot Web å¼€å‘/","link":"","permalink":"http://yoursite.com/2020/03/03/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/Spring%20Boot/Spring%20Boot%20Web%20%E5%BC%80%E5%8F%91/","excerpt":"Spring Boot Web æ–¹é¢çš„å¼€å‘ä»‹ç»ã€‚","text":"Spring Boot Web æ–¹é¢çš„å¼€å‘ä»‹ç»ã€‚ è‡ªåŠ¨é…ç½®åŸç†ï¼š xxxAutoConfigurationï¼šå¸®æˆ‘ä»¬ç»™å®¹å™¨ä¸­è‡ªåŠ¨é…ç½®ç»„ä»¶ï¼› xxxPropertiesï¼šé…ç½®ç±»å°è£…é…ç½®æ–‡ä»¶çš„å†…å®¹ã€‚ é™æ€èµ„æºæ˜ å°„ä»¥ JAR åŒ…çš„æ–¹å¼•å…¥é™æ€èµ„æºï¼š 123456&lt;!-- å¼•å…¥ jquery-webjar åœ¨è®¿é—®çš„æ—¶å€™åªéœ€è¦å†™ webjars ä¸‹é¢èµ„æºçš„åç§°å³å¯ --&gt;&lt;dependency&gt; &lt;groupId&gt;org.webjars&lt;/groupId&gt; &lt;artifactId&gt;jquery&lt;/artifactId&gt; &lt;version&gt;3.3.1&lt;/version&gt;&lt;/dependency&gt; è®¿é—® jquery.jsï¼šlocalhost:8080/webjars/jquery/3.3.1/jquery.js è®¿é—®å½“å‰é¡¹ç›®çš„ä»»ä½•èµ„æºï¼Œéƒ½å»é™æ€èµ„æºæ–‡ä»¶å¤¹æ‰¾æ˜ å°„ã€‚ 12345&quot;classpath:&#x2F;META-INF&#x2F;resources&#x2F;&quot;, &quot;classpath:&#x2F;resources&#x2F;&quot;,&quot;classpath:&#x2F;static&#x2F;&quot;, &quot;classpath:&#x2F;public&#x2F;&quot; &quot;&#x2F;&quot;ï¼šå½“å‰é¡¹ç›®çš„æ ¹è·¯å¾„ Thymeleaf æ¨¡æ¿å¼•æ“123456789101112&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;!-- é»˜è®¤æ˜¯ 2.1.6 ç‰ˆæœ¬ --&gt; &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;&lt;/dependency&gt;&lt;!-- åˆ‡æ¢ Thymeleaf ç‰ˆæœ¬ --&gt;&lt;properties&gt; &lt;thymeleaf.version&gt;3.0.9.RELEASE&lt;/thymeleaf.version&gt; &lt;!-- å¸ƒå±€åŠŸèƒ½çš„æ”¯æŒç¨‹åº Thymeleaf3 ä¸»ç¨‹åº Layout2 ä»¥ä¸Šç‰ˆæœ¬ --&gt; &lt;!-- Thymeleaf2 layout1--&gt; &lt;thymeleaf-layout-dialect.version&gt;2.2.2&lt;/thymeleaf-layout-dialect.version&gt;&lt;/properties&gt; è‡ªåŠ¨é…ç½®Spriing Boot å¯¹äº Thymeleaf çš„è‡ªåŠ¨é…ç½® 12345678910# Enable template cachingspring thymeleaf cache=true# Template encodingspring thymeleaf encoding=UTF-8# Template mode to be applied to templates. See also StandardTemplateModeHandlersspring thymeleaf mode=HTML5# Prefix that gets prepended to view names when building a URLspring thymeleaf prefix=classpath: /templates/# Suffix that gets appended to view names when building a URLspring thymeleaf suffix=.html 12345678910111213@ConfigurationProperties(prefix = \"spring.thymeleaf\")public class ThymeleafProperties &#123; private static final Charset DEFAULT_ENCODING = Charset.forName(\"UTF-8\"); private static final MimeType DEFAULT_CONTENT_TYPE = MimeType.valueOf(\"text/html\"); public static final String DEFAULT_PREFIX = \"classpath:/templates/\"; public static final String DEFAULT_SUFFIX = \".html\"; // ...&#125; ä»è‡ªåŠ¨é…ç½®ç±»ä¸­å¯ä»¥çœ‹å‡ºåªè¦æˆ‘ä»¬æŠŠ HTML é¡µé¢æ”¾åœ¨classpath:/templates/ç›®å½•ä¸‹ Thymeleaf å°±èƒ½è‡ªåŠ¨æ¸²æŸ“ã€‚ Thymeleaf çš„ä½¿ç”¨123456789101112&lt;!DOCTYPE html&gt;&lt;!-- å¯¼å…¥ Thymeleaf çš„åç§°ç©ºé—´ --&gt;&lt;html lang=\"en\" xmlns:th=\"http://www.thymeleaf.org\"&gt;&lt;head&gt; &lt;meta charset=\"UTF-8\"&gt; &lt;title&gt;Title&lt;/title&gt;&lt;/head&gt;&lt;body&gt; &lt;!-- th:text è®¾ç½® div é‡Œé¢çš„æ–‡æœ¬å†…å®¹ --&gt; &lt;div th:text=\"$&#123;hello&#125;\"&gt;è¿™æ˜¯æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯&lt;/div&gt;&lt;/body&gt;&lt;/html&gt; å¸¸ç”¨æ ‡ç­¾ å¸¸ç”¨è¡¨è¾¾å¼ 123456789101112131415161718192021è¡Œå†…å†™æ³•ï¼š[[]] -&gt; th:text ä¼šè½¬ä¹‰ç‰¹æ®Šå­—ç¬¦[()] -&gt; th:utext ä¸ä¼šè½¬ä¹‰ç‰¹æ®Šå­—ç¬¦å†…ç½®å·¥å…·ç±»ï¼š#execInfo : information about the template being processed.#messages : methods for obtaining externalized messages inside variables expressions, in the same way as they would be obtained using #&#123;â€¦&#125; syntax.#uris : methods for escaping parts of URLs&#x2F;URIs#conversions : methods for executing the configured conversion service (if any).#dates : methods for java.util.Date objects: formatting, component extraction, etc.#calendars : analogous to #dates , but for java.util.Calendar objects.#numbers : methods for formatting numeric objects.#strings : methods for String objects: contains, startsWith, prepending&#x2F;appending, etc.#objects : methods for objects in general.#bools : methods for boolean evaluation.#arrays : methods for arrays.#lists : methods for lists.#sets : methods for sets.#maps : methods for maps.#aggregates : methods for creating aggregates on arrays or collections.#ids : methods for dealing with id attributes that might be repeated (for example, as a result of an iteration). Spring MVC è‡ªåŠ¨é…ç½®Sping Boot å¯¹ Spring MVC çš„é»˜è®¤é…ç½®ï¼šWebMvcAutoConfiguration 12345678910//ä½¿ç”¨ WebMvcConfigurerAdapter å¯ä»¥æ¥æ‰©å±• SpringMVC çš„åŠŸèƒ½@Configurationpublic class MyMvcConfig extends WebMvcConfigurerAdapter &#123; @Override public void addViewControllers(ViewControllerRegistry registry) &#123; // æµè§ˆå™¨å‘é€ /wingo è¯·æ±‚æ¥åˆ° success registry.addViewController(\"/wigno\").setViewName(\"success\"); &#125;&#125; ä¸èƒ½æ ‡æ³¨@EnableWebMvcï¼Œæ ‡æ³¨å Spring MVC çš„é»˜è®¤è‡ªåŠ¨è£…é…å°†ä¸ä¼šè¿›è¡Œï¼Œå³å¼€å‘è€…å…¨é¢æ¥ç®¡ Spring MVC Restful CRUDé»˜è®¤è®¿é—®é¦–é¡µï¼š 1234567891011121314151617// ä½¿ç”¨ WebMvcConfigurerAdapter å¯ä»¥æ¥æ‰©å±• Spring MVC çš„åŠŸèƒ½@Configurationpublic class MyMvcConfig extends WebMvcConfigurerAdapter &#123; // æ‰€æœ‰çš„ WebMvcConfigurerAdapter ç»„ä»¶éƒ½ä¼šä¸€èµ·èµ·ä½œç”¨ @Bean // å°†ç»„ä»¶æ³¨å†Œåœ¨å®¹å™¨ public WebMvcConfigurerAdapter webMvcConfigurerAdapter()&#123; WebMvcConfigurerAdapter adapter = new WebMvcConfigurerAdapter() &#123; @Override public void addViewControllers(ViewControllerRegistry registry) &#123; registry.addViewController(\"/\").setViewName(\"login\"); registry.addViewController(\"/index.html\").setViewName(\"login\"); &#125; &#125;; return adapter; &#125;&#125; å›½é™…åŒ–IDEA ä¼šè‡ªåŠ¨è¯†åˆ«å›½é™…åŒ–ç›®å½•ã€‚ IDEA è¿›è¡Œä¼˜åŒ–åçš„ä¾¿äºç¼–è¾‘çš„è§†å›¾ï¼šï¼ˆç‚¹å‡»å·¦ä¸‹è§’çš„ Resource Bundleï¼‰ Spring Boot ä¸­çš„æ¶ˆæ¯è‡ªåŠ¨é…ç½®ï¼š 12345678public class MessageSourceAutoConfiguration &#123; // ... // é»˜è®¤é…ç½®ä¸º spring.messages.basename=messages å³å›½é™…åŒ–èµ„æºé»˜è®¤æ”¾åœ¨ç±»è·¯å¾„ä¸‹çš„ messages.properties String basename = context.getEnvironment().getProperty(\"spring.messages.basename\", \"messages\"); //... &#125; 12# è‡ªå®šä¹‰å›½é™…åŒ–æ–‡ä»¶çš„ä½ç½®spring.message.basename=i18n.login é¡µé¢è·å–å›½é™…åŒ–çš„ä¿¡æ¯ï¼š 1234567891011121314151617181920212223242526272829303132333435363738&lt;!DOCTYPE html&gt;&lt;html lang=\"en\" xmlns:th=\"http://www.thymeleaf.org\"&gt; &lt;head&gt; &lt;meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"&gt; &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1, shrink-to-fit=no\"&gt; &lt;meta name=\"description\" content=\"\"&gt; &lt;meta name=\"author\" content=\"\"&gt; &lt;title&gt;Signin Template for Bootstrap&lt;/title&gt; &lt;!-- webjars å½¢å¼çš„é™æ€èµ„æºæ˜ å°„ --&gt; &lt;!-- Bootstrap core CSS --&gt; &lt;link href=\"asserts/css/bootstrap.min.css\" th:href=\"@&#123;/webjars/bootstrap/4.0.0/css/bootstrap.css&#125;\" rel=\"stylesheet\"&gt; &lt;!-- Custom styles for this template --&gt; &lt;link href=\"asserts/css/signin.css\" th:href=\"@&#123;/asserts/css/signin.css&#125;\" rel=\"stylesheet\"&gt; &lt;/head&gt; &lt;body class=\"text-center\"&gt; &lt;form class=\"form-signin\" action=\"dashboard.html\"&gt; &lt;img class=\"mb-4\" th:src=\"@&#123;/asserts/img/bootstrap-solid.svg&#125;\" src=\"asserts/img/bootstrap-solid.svg\" alt=\"\" width=\"72\" height=\"72\"&gt; &lt;!-- Thymeleaf ç”¨ #&#123;&#125; è¡¨è¾¾å¼å–å‡ºå›½é™…åŒ–ä¿¡æ¯ --&gt; &lt;h1 class=\"h3 mb-3 font-weight-normal\" th:text=\"#&#123;login.tip&#125;\"&gt;Please sign in&lt;/h1&gt; &lt;label class=\"sr-only\" th:text=\"#&#123;login.username&#125;\"&gt;Username&lt;/label&gt; &lt;input type=\"text\" class=\"form-control\" placeholder=\"Username\" th:placeholder=\"#&#123;login.username&#125;\" required=\"\" autofocus=\"\"&gt; &lt;label class=\"sr-only\" th:text=\"#&#123;login.password&#125;\"&gt;Password&lt;/label&gt; &lt;input type=\"password\" class=\"form-control\" placeholder=\"Password\" th:placeholder=\"#&#123;login.password&#125;\" required=\"\"&gt; &lt;div class=\"checkbox mb-3\"&gt; &lt;label&gt; &lt;input type=\"checkbox\" value=\"remember-me\"/&gt; [[#&#123;login.remember&#125;]] &lt;/label&gt; &lt;/div&gt; &lt;button class=\"btn btn-lg btn-primary btn-block\" type=\"submit\" th:text=\"#&#123;login.btn&#125;\"&gt;Sign in&lt;/button&gt; &lt;p class=\"mt-5 mb-3 text-muted\"&gt;Â© 2017-2018&lt;/p&gt; &lt;a class=\"btn btn-sm\"&gt;ä¸­æ–‡&lt;/a&gt; &lt;a class=\"btn btn-sm\"&gt;English&lt;/a&gt; &lt;/form&gt; &lt;/body&gt;&lt;/html&gt; æ ¹æ®æµè§ˆå™¨è¯·æ±‚ä¸­æ‰€æºå¸¦çš„å›½é™…åŒ– Locale ä¿¡æ¯è¿›è¡Œè¯­è¨€çš„è½¬æ¢ã€‚ 123456789101112131415@Bean@ConditionalOnMissingBean@ConditionalOnProperty( prefix = \"spring.mvc\", name = &#123;\"locale\"&#125;)public LocaleResolver localeResolver() &#123; if (this.mvcProperties.getLocaleResolver() == org.springframework.boot.autoconfigure.web.servlet.WebMvcProperties.LocaleResolver.FIXED) &#123; return new FixedLocaleResolver(this.mvcProperties.getLocale()); &#125; else &#123; AcceptHeaderLocaleResolver localeResolver = new AcceptHeaderLocaleResolver(); localeResolver.setDefaultLocale(this.mvcProperties.getLocale()); return localeResolver; &#125;&#125; å¯ä»¥åœ¨åˆ‡æ¢è¯­è¨€çš„çš„é“¾æ¥ä¸Šæºå¸¦åŒºåŸŸä¿¡æ¯ï¼Œè¿›è¡Œè¯­è¨€åˆ‡æ¢ã€‚ 12345678910111213141516171819202122public class MyLocaleResolver implements LocaleResolver &#123; @Override public Locale resolveLocale(HttpServletRequest request) &#123; String myLocale = request.getParameter(\"locale\"); Locale locale = Locale.getDefault(); if(!StringUtils.isEmpty(myLocale))&#123; String[] split = myLocate.split(\"_\"); //å›½å®¶ è¯­è¨€ locale = new Locale(split[0],split[1]); &#125; return locale; &#125; @Override public void setLocale(HttpServletRequest request, HttpServletResponse response, Locale locale) &#123;&#125; @Bean public LocaleResolver localeResolver()&#123; return new MyLocaleResolver(); &#125;&#125; ç”¨æˆ·ç™»å½•12# ç¦ç”¨ç¼“å­˜spring.thymeleaf.cache&#x3D;false ä¿®æ”¹äº†é¡µé¢å Ctrl + F9 è¿›è¡Œé‡æ–°ç¼–è¯‘ 123&lt;!-- ç™»å½•é”™è¯¯æ¶ˆæ¯æ˜¾ç¤º --&gt;&lt;!-- ä½¿ç”¨ Thymeleaf å†…ç½®å·¥å…·ç±» #Srting, å–ä¼ é€’å˜é‡çš„å€¼ $&#123;&#125; è¡¨è¾¾å¼--&gt;&lt;p style=\"color: red\" th:text=\"$&#123;msg&#125;\" th:if=\"$&#123;not #strings.isEmpty(msg)&#125;\"&gt;&lt;/p&gt; æ‹¦æˆªå™¨æ‹¦æˆªå™¨çš„ç¼–å†™ï¼š 12345678910111213141516171819public class LoginHandlerInterceptor implements HandlerInterceptor &#123; // ç›®æ ‡æ–¹æ³•æ‰§è¡Œä¹‹å‰ @Override public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception &#123; // ç”¨æˆ·ç™»å½•ååœ¨ Session ä¸­ä¿å­˜ç”¨æˆ·æ ‡å¿— Object user = request.getSession().getAttribute(\"loginUser\"); if(user == null)&#123; // æœªç™»é™†ï¼Œè¿”å›ç™»é™†é¡µé¢ request.setAttribute(\"msg\",\"æ²¡æœ‰æƒé™è¯·å…ˆç™»é™†\"); request.getRequestDispatcher(\"/index.html\").forward(request,response); return false; &#125;else&#123; // å·²ç™»é™†ï¼Œæ”¾è¡Œè¯·æ±‚ return true; &#125; &#125; // çœç•¥å…¶å®ƒä¸éœ€è¦ç¼–å†™çš„æŠ½è±¡æ–¹æ³•&#125; æ³¨å†Œæ‹¦æˆªå™¨ 123456789101112131415161718192021// æ‰€æœ‰çš„ WebMvcConfigurerAdapter ç»„ä»¶éƒ½ä¼šä¸€èµ·èµ·ä½œç”¨@Bean // å°†ç»„ä»¶æ³¨å†Œåœ¨å®¹å™¨public WebMvcConfigurerAdapter webMvcConfigurerAdapter()&#123; WebMvcConfigurerAdapter adapter = new WebMvcConfigurerAdapter() &#123; @Override public void addViewControllers(ViewControllerRegistry registry) &#123; registry.addViewController(\"/\").setViewName(\"login\"); registry.addViewController(\"/index.html\").setViewName(\"login\"); &#125; // æ³¨å†Œæ‹¦æˆªå™¨ @Override public void addInterceptors(InterceptorRegistry registry) &#123; // super.addInterceptors(registry); // é™æ€èµ„æº *.css , *.js SpringBoot å·²ç»åšå¥½äº†æ˜ å°„ // é™¤äº†è®¿é—®ç™»å½•é¡µé¢çš„ URL å…¶ä½™çš„ URL å…¨éƒ¨è¿›è¡Œæ‹¦æˆªè®¤è¯ registry.addInterceptor(new LoginHandlerInterceptor()).addPathPatterns(\"/**\") .excludePathPatterns(\"/index.html\",\"/\",\"/user/login\"); &#125; &#125;; return adapter;&#125; å‘˜å·¥åˆ—è¡¨ æ™®é€šCRUDï¼ˆURI æ¥åŒºåˆ†æ“ä½œï¼‰ RestfulCRUD æŸ¥è¯¢ getEmp empâ€”GET æ·»åŠ  addEmp?xxx empâ€”POST ä¿®æ”¹ updateEmp?id=xxx&amp;xxx=xx emp/{id}â€”PUT åˆ é™¤ deleteEmp?id=1 emp/{id}â€”DELETE æœ¬æ¬¡å®éªŒçš„è¯·æ±‚æ¶æ„ï¼š å®éªŒåŠŸèƒ½ è¯·æ±‚URI è¯·æ±‚æ–¹å¼ æŸ¥è¯¢æ‰€æœ‰å‘˜å·¥ emps GET æŸ¥è¯¢æŸä¸ªå‘˜å·¥ï¼ˆæ¥åˆ°ä¿®æ”¹é¡µé¢ï¼‰ emp/{id} GET æ¥åˆ°æ·»åŠ é¡µé¢ emp GET æ·»åŠ å‘˜å·¥ emp POST æ¥åˆ°ä¿®æ”¹é¡µé¢ï¼ˆæŸ¥å‡ºå‘˜å·¥è¿›è¡Œä¿¡æ¯å›æ˜¾ï¼‰ emp/{id} GET ä¿®æ”¹å‘˜å·¥ emp PUT åˆ é™¤å‘˜å·¥ emp/{id} DELETE å‘˜å·¥åˆ—è¡¨ï¼ŒThymeleaf å…¬å…±é¡µé¢å…ƒç´ æŠ½å–ã€‚ 123456789101112131415161718192021222324252627282930&lt;!-- common/footer.html æŠ½å–å…¬å…±ç‰‡æ®µ --&gt;&lt;footer th:fragment=\"copy\"&gt; &amp;copy; 2011 The Good Thymes Virtual Grocery&lt;/footer&gt;&lt;!-- å¼•å…¥å…¬å…±ç‰‡æ®µ --&gt;&lt;div th:insert=\"footer::copy\"&gt;&lt;/div&gt;&lt;div th:replace=\"footer::copy\"&gt;&lt;/div&gt;&lt;div th:include=\"footer::copy\"&gt;&lt;/div&gt;&lt;!-- ~&#123;templatename::selector&#125;ï¼šæ¨¡æ¿å::é€‰æ‹©å™¨~&#123;templatename::fragmentname&#125;:æ¨¡æ¿å::ç‰‡æ®µåinsert çš„å…¬å…±ç‰‡æ®µåœ¨ div æ ‡ç­¾ä¸­ï¼Œå¦‚æœä½¿ç”¨ th:insert ç­‰å±æ€§è¿›è¡Œå¼•å…¥ï¼Œå¯ä»¥ä¸ç”¨å†™ ~&#123;&#125;ï¼›ï¼›è¡Œå†…å†™æ³•å¯ä»¥åŠ ä¸Šï¼š[[~&#123;&#125;]] [(~&#123;&#125;)]--&gt;&lt;!-- æ•ˆæœ --&gt;&lt;div&gt; &lt;footer&gt; &amp;copy; 2011 The Good Thymes Virtual Grocery &lt;/footer&gt;&lt;/div&gt;&lt;footer&gt; &amp;copy; 2011 The Good Thymes Virtual Grocery&lt;/footer&gt;&lt;div&gt; &amp;copy; 2011 The Good Thymes Virtual Grocery&lt;/div&gt; å¼•å…¥ç‰‡æ®µæ—¶ä¼ é€’å‚æ•°ï¼š 12345678&lt;!--å¼•å…¥ä¾§è¾¹æ å¹¶ä¼ å…¥å‚æ•°ï¼›æ­¤å¤„ç”¨çš„ id é€‰æ‹©å™¨æ¥å¼•å…¥ç‰‡æ®µ --&gt;&lt;div th:replace=\"commons/bar::#sidebar(activeUri='emps')\"&gt;&lt;/div&gt;&lt;!-- åº”ç”¨åœºæ™¯ï¼šç‚¹å‡»ä¾§è¾¹æ çš„é€‰é¡¹ï¼Œè¢«ç‚¹å‡»çš„é€‰é¡¹æ ·å¼å‘ç”Ÿæ”¹å˜ï¼Œå˜ä¸ºé«˜äº® --&gt;&lt;!-- è§£å†³æ–¹å¼ï¼šé¡µé¢å¼•ç”¨æ—¶æ‰€ä¼ é€’çš„å‚æ•°è¿›è¡Œæ ·å¼çš„ä¿®æ”¹ï¼Œç”Ÿæˆçš„ä¾§è¾¹æ æ ·å¼æ ¹æ®ä¼ å…¥çš„å‚æ•°æ”¹å˜æ ·å¼ --&gt;&lt;a class=\"nav-link active\" th:class=\"$&#123;activeUri=='main.html'?'nav-link active':'nav-link'&#125;\" href=\"#\" th:href=\"@&#123;/main.html&#125;\"&gt; æ·»åŠ åŠä¿®æ”¹123456789101112131415161718192021222324252627282930313233343536373839404142434445&lt;!-- éœ€è¦åŒºåˆ†æ˜¯å‘˜å·¥ä¿®æ”¹è¿˜æ˜¯æ·»åŠ  --&gt;&lt;form th:action=\"@&#123;/emp&#125;\" method=\"post\"&gt;&lt;!-- å‘é€ put è¯·æ±‚ä¿®æ”¹å‘˜å·¥æ•°æ®--&gt; &lt;!-- Spring MVC ä¸­é…ç½® HiddenHttpMethodFilterï¼›ï¼ˆSpringBootè‡ªåŠ¨é…ç½®å¥½çš„ï¼‰ é¡µé¢åˆ›å»ºä¸€ä¸ªpostè¡¨å•ï¼› åˆ›å»ºä¸€ä¸ª input é¡¹ï¼Œname=\"_method\"ï¼›value å°±æ˜¯æˆ‘ä»¬æŒ‡å®šçš„è¯·æ±‚æ–¹å¼ã€‚ --&gt; &lt;!-- è‹¥ emp æºå¸¦ä¿¡æ¯ï¼Œåˆ™æ­¤è¡¨å•æäº¤çš„æ˜¯ put è¯·æ±‚ --&gt; &lt;input type=\"hidden\" name=\"_method\" value=\"put\" th:if=\"$&#123;emp!=null&#125;\"/&gt; &lt;!-- ä¿®æ”¹éœ€è¦æºå¸¦å‘˜å·¥ id ç”¨äºä¿å­˜ä¿®æ”¹ --&gt; &lt;input type=\"hidden\" name=\"id\" th:if=\"$&#123;emp!=null&#125;\" th:value=\"$&#123;emp.id&#125;\"&gt; &lt;div class=\"form-group\"&gt; &lt;label&gt;LastName&lt;/label&gt; &lt;input name=\"lastName\" type=\"text\" class=\"form-control\" placeholder=\"zhangsan\" th:value=\"$&#123;emp!=null&#125;?$&#123;emp.lastName&#125;\"&gt; &lt;/div&gt; &lt;div class=\"form-group\"&gt; &lt;label&gt;Email&lt;/label&gt; &lt;input name=\"email\" type=\"email\" class=\"form-control\" placeholder=\"zhangsan@atguigu.com\" th:value=\"$&#123;emp!=null&#125;?$&#123;emp.email&#125;\"&gt; &lt;/div&gt; &lt;div class=\"form-group\"&gt; &lt;label&gt;Gender&lt;/label&gt;&lt;br/&gt; &lt;div class=\"form-check form-check-inline\"&gt; &lt;input class=\"form-check-input\" type=\"radio\" name=\"gender\" value=\"1\" th:checked=\"$&#123;emp!=null&#125;?$&#123;emp.gender==1&#125;\"&gt; &lt;label class=\"form-check-label\"&gt;ç”·&lt;/label&gt; &lt;/div&gt; &lt;div class=\"form-check form-check-inline\"&gt; &lt;input class=\"form-check-input\" type=\"radio\" name=\"gender\" value=\"0\" th:checked=\"$&#123;emp!=null&#125;?$&#123;emp.gender==0&#125;\"&gt; &lt;label class=\"form-check-label\"&gt;å¥³&lt;/label&gt; &lt;/div&gt; &lt;/div&gt; &lt;div class=\"form-group\"&gt; &lt;label&gt;department&lt;/label&gt; &lt;!--æäº¤çš„æ˜¯éƒ¨é—¨çš„id--&gt; &lt;select class=\"form-control\" name=\"department.id\"&gt; &lt;option th:selected=\"$&#123;emp!=null&#125;?$&#123;dept.id == emp.department.id&#125;\" th:value=\"$&#123;dept.id&#125;\" th:each=\"dept:$&#123;depts&#125;\" th:text=\"$&#123;dept.departmentName&#125;\"&gt;1&lt;/option&gt; &lt;/select&gt; &lt;/div&gt; &lt;div class=\"form-group\"&gt; &lt;label&gt;Birth&lt;/label&gt; &lt;!-- #dates å·¥å…·ç±»è¿›è¡Œæ—¶é—´æ ¼å¼åŒ– --&gt; &lt;input name=\"birth\" type=\"text\" class=\"form-control\" placeholder=\"zhangsan\" th:value=\"$&#123;emp!=null&#125;?$&#123;#dates.format(emp.birth, 'yyyy-MM-dd HH:mm')&#125;\"&gt; &lt;/div&gt; &lt;button type=\"submit\" class=\"btn btn-primary\" th:text=\"$&#123;emp!=null&#125;?'ä¿®æ”¹':'æ·»åŠ '\"&gt;æ·»åŠ &lt;/button&gt;&lt;/form&gt; åˆ é™¤12345678910111213141516171819202122&lt;tr th:each=\"emp:$&#123;emps&#125;\"&gt; &lt;td th:text=\"$&#123;emp.id&#125;\"&gt;&lt;/td&gt; &lt;td&gt;[[$&#123;emp.lastName&#125;]]&lt;/td&gt; &lt;td th:text=\"$&#123;emp.email&#125;\"&gt;&lt;/td&gt; &lt;td th:text=\"$&#123;emp.gender&#125;==0?'å¥³':'ç”·'\"&gt;&lt;/td&gt; &lt;td th:text=\"$&#123;emp.department.departmentName&#125;\"&gt;&lt;/td&gt; &lt;td th:text=\"$&#123;#dates.format(emp.birth, 'yyyy-MM-dd HH:mm')&#125;\"&gt;&lt;/td&gt; &lt;td&gt; &lt;a class=\"btn btn-sm btn-primary\" th:href=\"@&#123;/emp/&#125;+$&#123;emp.id&#125;\"&gt;ç¼–è¾‘&lt;/a&gt; &lt;!-- th:attr æ ‡ç­¾è‡ªå®šä¹‰å±æ€§åŠå€¼ --&gt; &lt;button th:attr=\"del_uri=@&#123;/emp/&#125;+$&#123;emp.id&#125;\" class=\"btn btn-sm btn-danger deleteBtn\"&gt;åˆ é™¤&lt;/button&gt; &lt;/td&gt;&lt;/tr&gt;&lt;script&gt; $(\".deleteBtn\").click(function()&#123; // åˆ é™¤å½“å‰å‘˜å·¥ $(\"#deleteEmpForm\").attr(\"action\",$(this).attr(\"del_uri\")).submit(); return false; &#125;);&lt;/script&gt; é”™è¯¯å¤„ç†æœºåˆ¶Spring Boot é»˜è®¤çš„é”™è¯¯å¤„ç†æœºåˆ¶ã€‚ é»˜è®¤æ•ˆæœï¼šå¯¹äºæµè§ˆå™¨ï¼ŒSpring Boot è¿”å›ä¸€ä¸ªé»˜è®¤çš„é”™è¯¯é¡µé¢ï¼›å¯¹äºå…¶å®ƒå®¢æˆ·ç«¯ï¼Œé»˜è®¤å“åº”ä¸€ä¸ª Json æ•°æ®ã€‚ 1234567891011// å¸®æˆ‘ä»¬åœ¨é¡µé¢å…±äº«ä¿¡æ¯@Overridepublic Map&lt;String, Object&gt; getErrorAttributes(RequestAttributes requestAttributes, boolean includeStackTrace) &#123; Map&lt;String, Object&gt; errorAttributes = new LinkedHashMap&lt;String, Object&gt;(); errorAttributes.put(\"timestamp\", new Date()); addStatus(errorAttributes, requestAttributes); addErrorDetails(errorAttributes, requestAttributes, includeStackTrace); addPath(errorAttributes, requestAttributes); return errorAttributes;&#125; 1234567891011121314151617181920212223242526// å¤„ç†é»˜è®¤ /error è¯·æ±‚@Controller@RequestMapping(\"$&#123;server.error.path:$&#123;error.path:/error&#125;&#125;\") // é»˜è®¤ä¸ºé”™è¯¯é¡µé¢è·¯å¾„ /errorpublic class BasicErrorController extends AbstractErrorController &#123; @RequestMapping(produces = \"text/html\") // äº§ç”Ÿ HTML ç±»å‹çš„æ•°æ®ï¼›æµè§ˆå™¨å‘é€çš„è¯·æ±‚æ¥åˆ°è¿™ä¸ªæ–¹æ³•å¤„ç† public ModelAndView errorHtml(HttpServletRequest request, HttpServletResponse response) &#123; HttpStatus status = getStatus(request); Map&lt;String, Object&gt; model = Collections.unmodifiableMap(getErrorAttributes( request, isIncludeStackTrace(request, MediaType.TEXT_HTML))); response.setStatus(status.value()); // å»å“ªä¸ªé¡µé¢ä½œä¸ºé”™è¯¯é¡µé¢ï¼ŒåŒ…å«é¡µé¢åœ°å€å’Œé¡µé¢å†…å®¹ ModelAndView modelAndView = resolveErrorView(request, response, status, model); return (modelAndView == null ? new ModelAndView(\"error\", model) : modelAndView); &#125; @RequestMapping @ResponseBody // äº§ç”Ÿ Json æ•°æ®ï¼Œå…¶ä»–å®¢æˆ·ç«¯æ¥åˆ°è¿™ä¸ªæ–¹æ³•å¤„ç† public ResponseEntity&lt;Map&lt;String, Object&gt;&gt; error(HttpServletRequest request) &#123; Map&lt;String, Object&gt; body = getErrorAttributes(request, isIncludeStackTrace(request, MediaType.ALL)); HttpStatus status = getStatus(request); return new ResponseEntity&lt;Map&lt;String, Object&gt;&gt;(body, status); &#125; 1234567891011121314151617181920212223@Overridepublic ModelAndView resolveErrorView(HttpServletRequest request, HttpStatus status, Map&lt;String, Object&gt; model) &#123; ModelAndView modelAndView = resolve(String.valueOf(status), model); if (modelAndView == null &amp;&amp; SERIES_VIEWS.containsKey(status.series())) &#123; modelAndView = resolve(SERIES_VIEWS.get(status.series()), model); &#125; return modelAndView;&#125;private ModelAndView resolve(String viewName, Map&lt;String, Object&gt; model) &#123; // é»˜è®¤ Spring Boot å¯ä»¥å»æ‰¾åˆ°ä¸€ä¸ªé¡µé¢ error/404 String errorViewName = \"error/\" + viewName; // æ¨¡æ¿å¼•æ“å¯ä»¥è§£æè¿™ä¸ªé¡µé¢åœ°å€å°±ç”¨æ¨¡æ¿å¼•æ“è§£æ TemplateAvailabilityProvider provider = this.templateAvailabilityProviders .getProvider(errorViewName, this.applicationContext); if (provider != null) &#123; // æ¨¡æ¿å¼•æ“å¯ç”¨çš„æƒ…å†µä¸‹è¿”å›åˆ° errorViewName æŒ‡å®šçš„è§†å›¾åœ°å€ return new ModelAndView(errorViewName, model); &#125; //æ¨¡æ¿å¼•æ“ä¸å¯ç”¨ï¼Œå°±åœ¨é™æ€èµ„æºæ–‡ä»¶å¤¹ä¸‹æ‰¾ errorViewName å¯¹åº”çš„é¡µé¢ error/404.html return resolveResource(errorViewName, model);&#125; ä¸€ä½†ç³»ç»Ÿå‡ºç° 4xx æˆ–è€… 5xx ä¹‹ç±»çš„é”™è¯¯ï¼ŒErrorPageCustomizer å°±ä¼šç”Ÿæ•ˆï¼ˆå®šåˆ¶é”™è¯¯çš„å“åº”è§„åˆ™ï¼‰ï¼Œå°±ä¼šæ¥åˆ° /error è¯·æ±‚ï¼Œå°±ä¼šè¢«BasicErrorControllerå¤„ç†ã€‚ é”™è¯¯é¡µé¢çš„å®šåˆ¶æœ‰æ¨¡æ¿å¼•æ“çš„æƒ…å†µä¸‹ï¼šerror/çŠ¶æ€ç ï¼ˆå°†é”™è¯¯é¡µé¢å‘½åä¸º é”™è¯¯çŠ¶æ€ç  .html æ”¾åœ¨æ¨¡æ¿å¼•æ“æ–‡ä»¶å¤¹é‡Œé¢çš„ error æ–‡ä»¶å¤¹ä¸‹ï¼‰å‘ç”Ÿæ­¤çŠ¶æ€ç çš„é”™è¯¯å°±ä¼šæ¥åˆ°å¯¹åº”çš„é¡µé¢ã€‚ å¯ä»¥ä½¿ç”¨ 4xx å’Œ 5xx ä½œä¸ºé”™è¯¯é¡µé¢çš„æ–‡ä»¶åæ¥åŒ¹é…è¿™ç§ç±»å‹çš„æ‰€æœ‰é”™è¯¯ï¼Œç²¾ç¡®ä¼˜å…ˆã€‚ï¼ˆä¼˜å…ˆå¯»æ‰¾ç²¾ç¡®çš„ [çŠ¶æ€ç ].htmlï¼‰ 1234567é¡µé¢èƒ½è·å–çš„ä¿¡æ¯ï¼š timestampï¼šæ—¶é—´æˆ³ statusï¼šçŠ¶æ€ç  errorï¼šé”™è¯¯æç¤º exceptionï¼šå¼‚å¸¸å¯¹è±¡ messageï¼šå¼‚å¸¸æ¶ˆæ¯ errorsï¼šJSR303 æ•°æ®æ ¡éªŒçš„é”™è¯¯éƒ½åœ¨è¿™é‡Œ æ²¡æœ‰æ¨¡æ¿å¼•æ“ï¼ˆæ¨¡æ¿å¼•æ“æ‰¾ä¸åˆ°è¿™ä¸ªé”™è¯¯é¡µé¢ï¼‰ï¼Œé™æ€èµ„æºæ–‡ä»¶å¤¹ä¸‹æ‰¾ï¼Œä»¥ä¸Šéƒ½æ²¡æœ‰é”™è¯¯é¡µé¢ï¼Œå°±æ˜¯é»˜è®¤æ¥åˆ°SpringBooté»˜è®¤çš„é”™è¯¯æç¤ºé¡µé¢ã€‚ 12345678910111213141516// è‡ªå®šä¹‰å¼‚å¸¸å¤„ç† &amp; è¿”å›å®šåˆ¶ Json æ•°æ®@ControllerAdvicepublic class MyExceptionHandler &#123; @ResponseBody @ExceptionHandler(UserNotExistException.class) public Map&lt;String,Object&gt; handleException(Exception e)&#123; Map&lt;String,Object&gt; map = new HashMap&lt;&gt;(); // ä¼ å…¥æˆ‘ä»¬è‡ªå·±çš„é”™è¯¯çŠ¶æ€ç  4xx 5xxï¼Œå¦åˆ™å°±ä¸ä¼šè¿›å…¥å®šåˆ¶é”™è¯¯é¡µé¢çš„è§£ææµç¨‹ request.setAttribute(\"javax.servlet.error.status_code\",500); map.put(\"code\",\"user.notexist\"); map.put(\"message\",e.getMessage()); // ç”¨äºé”™è¯¯ä¿¡æ¯çš„è¯»å– request.setAttribute(\"userNotExist\",map); return \"forward:/error\"; &#125;&#125; 12345678910111213141516// ç»™å®¹å™¨ä¸­åŠ å…¥æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„ ErrorAttributes@Componentpublic class MyErrorAttributes extends DefaultErrorAttributes &#123; @Override public Map&lt;String, Object&gt; getErrorAttributes(RequestAttributes requestAttributes, boolean includeStackTrace) &#123; // è¿™ä¸ª map å°±æ˜¯é¡µé¢å’Œ Json èƒ½è·å–çš„æ‰€æœ‰å­—æ®µ Map&lt;String, Object&gt; map = super.getErrorAttributes(requestAttributes, includeStackTrace); map.put(\"company\", \"Welab\"); // å¼‚å¸¸å¤„ç†å™¨æºå¸¦çš„æ•°æ® Map&lt;String, Object&gt; map userNotExist = (Map&lt;String, Object&gt;)requestAttributes.getAttribute(\"userNotExist\",0); map.put(\"userNotExist\", userNotExist) return map; &#125;&#125; åµŒå…¥å¼ Servlet å®¹å™¨ç”±äº Spring Boot é»˜è®¤æ˜¯ä»¥ Jar åŒ…çš„æ–¹å¼å¯åŠ¨åµŒå…¥å¼çš„ Servlet å®¹å™¨æ¥å¯åŠ¨ Spring Boot çš„ web åº”ç”¨ï¼Œæ²¡æœ‰ web.xml æ–‡ä»¶ã€‚ Spring Boot ä¿®æ”¹å’Œ server æœ‰å…³çš„é…ç½®ï¼š 123456# æ–¹å¼ä¸€ï¼špropertiesserver.port=8081server.context-path=/crudserver.tomcat.uri-encoding=UTF-8# é€šç”¨çš„ Servlet å®¹å™¨è®¾ç½® server.xxx# Tomcat çš„è®¾ç½® server.tomcat.xxx 1234567891011// ç¼–å†™åµŒå…¥å¼çš„ Servlet å®¹å™¨çš„å®šåˆ¶å™¨æ¥ä¿®æ”¹ Servlet å®¹å™¨çš„é…ç½®@Bean //ä¸€å®šè¦å°†è¿™ä¸ªå®šåˆ¶å™¨åŠ å…¥åˆ°å®¹å™¨ä¸­public EmbeddedServletContainerCustomizer embeddedServletContainerCustomizer()&#123; return new EmbeddedServletContainerCustomizer() &#123; //å®šåˆ¶åµŒå…¥å¼çš„Servletå®¹å™¨ç›¸å…³çš„è§„åˆ™ @Override public void customize(ConfigurableEmbeddedServletContainer container) &#123; container.setPort(8083); &#125; &#125;;&#125; Servlet ä¸‰å¤§ç»„ä»¶çš„æ³¨å†Œ123456@Beanpublic ServletRegistrationBean myServlet()&#123; ServletRegistrationBean registrationBean = new ServletRegistrationBean( new MyServlet(),\"/myServlet\"); return registrationBean;&#125; 1234567@Beanpublic FilterRegistrationBean myFilter()&#123; FilterRegistrationBean registrationBean = new FilterRegistrationBean(); registrationBean.setFilter(new MyFilter()); registrationBean.setUrlPatterns(Arrays.asList(\"/hello\",\"/myServlet\")); return registrationBean;&#125; 123456@Beanpublic ServletListenerRegistrationBean myListener()&#123; ServletListenerRegistrationBean&lt;MyListener&gt; registrationBean = new ServletListenerRegistrationBean&lt;&gt;(new MyListener()); return registrationBean;&#125; æ›¿æ¢ Servlet å®¹å™¨ 12345&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;!-- å¼•å…¥ web æ¨¡å—é»˜è®¤å°±æ˜¯ä½¿ç”¨åµŒå…¥å¼çš„ Tomcat ä½œä¸º Servlet å®¹å™¨ --&gt;&lt;/dependency&gt; 123456789101112131415161718&lt;!-- å¼•å…¥webæ¨¡å— --&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;artifactId&gt;spring-boot-starter-tomcat&lt;/artifactId&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt;&lt;/dependency&gt;&lt;!--å¼•å…¥å…¶ä»–çš„Servletå®¹å™¨--&gt;&lt;dependency&gt; &lt;artifactId&gt;spring-boot-starter-jetty&lt;/artifactId&gt; &lt;!-- spring-boot-starter-undertow --&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&lt;/dependency&gt; å¤–ç½® Servlet å®¹å™¨ï¼ï¼ï¼åˆ›å»ºçš„å¿…é¡»æ˜¯ä¸€ä¸ª war é¡¹ç›®ï¼ˆåˆ©ç”¨ IDEA åˆ›å»ºå¥½ç›®å½•ç»“æ„ï¼‰ 123456&lt;!-- å°†åµŒå…¥å¼çš„ Tomcat æŒ‡å®šä¸º provided --&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-tomcat&lt;/artifactId&gt; &lt;scope&gt;provided&lt;/scope&gt;&lt;/dependency&gt; å¿…é¡»è¦ç¼–å†™ä¸€ä¸ª SpringBootServletInitializer çš„å­ç±»ï¼Œå¹¶è°ƒç”¨ configure() æ–¹æ³•ã€‚ 123456789public class ServletInitializer extends SpringBootServletInitializer &#123; @Override protected SpringApplicationBuilder configure(SpringApplicationBuilder application) &#123; // ä¼ å…¥ SpringBoot åº”ç”¨çš„ä¸»ç¨‹åº return application.sources(SpringBootMyApplication.class); &#125;&#125; REST æ¶æ„é£æ ¼","categories":[{"name":"åå°æŠ€æœ¯","slug":"åå°æŠ€æœ¯","permalink":"http://yoursite.com/categories/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"Spring Boot","slug":"Spring-Boot","permalink":"http://yoursite.com/tags/Spring-Boot/"},{"name":"Web","slug":"Web","permalink":"http://yoursite.com/tags/Web/"}]},{"title":"Spring Boot æ—¥å¿—","slug":"åå°æŠ€æœ¯/Spring Boot/Spring Boot æ—¥å¿—æ¡†æ¶","date":"2020-03-02T02:27:24.000Z","updated":"2020-07-10T04:13:32.475Z","comments":true,"path":"2020/03/02/åå°æŠ€æœ¯/Spring Boot/Spring Boot æ—¥å¿—æ¡†æ¶/","link":"","permalink":"http://yoursite.com/2020/03/02/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/Spring%20Boot/Spring%20Boot%20%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/","excerpt":"Spring Boot æ—¥å¿—æ¡†æ¶çš„ä½¿ç”¨ã€‚","text":"Spring Boot æ—¥å¿—æ¡†æ¶çš„ä½¿ç”¨ã€‚ æ—¥å¿—æ¡†æ¶å¸‚é¢ä¸Šå¸¸è§çš„æ—¥å¿—æ¡†æ¶ï¼š æ—¥å¿—é—¨é¢ ï¼ˆæ—¥å¿—çš„æŠ½è±¡å±‚ï¼‰ æ—¥å¿—å®ç° JCL: Jakarta Commons Logging;SLF4j: Simple Logging Facade for Java;Jboss-Logging Log4JJUL: java.util.logging;Log4J2 Logback Spring Boot é€‰ç”¨ SLF4J å’Œ Logback Qï¼šSpring Boot æ•´åˆäº†å¾ˆå¤šæ¡†æ¶ï¼Œè‹¥æ•´åˆçš„æ¡†æ¶é»˜è®¤ä½¿ç”¨çš„æ—¥å¿—æ¡†æ¶ä¸ Spring Boot é»˜è®¤ä½¿ç”¨çš„æ—¥å¿—æ¡†æ¶ä¸ä¸€æ ·æ—¶ï¼Œè¦æ€ä¹ˆåšï¼Ÿ Aï¼šæ’é™¤æ•´åˆæ¡†æ¶çš„é»˜è®¤æ—¥å¿—æ¡†æ¶ï¼Œç”¨ä¸­é—´åŒ…æ¥æ›¿ä»£åŸæœ‰çš„æ—¥å¿—æ¡†æ¶ã€‚ SLF4Jåœ¨å¼€å‘çš„ä¸­ï¼Œæ—¥å¿—è®°å½•æ–¹æ³•çš„è°ƒç”¨ä¸åº”è¯¥æ¥ç›´æ¥è°ƒç”¨æ—¥å¿—çš„å®ç°ç±»ï¼Œè€Œæ˜¯è°ƒç”¨æ—¥å¿—æŠ½è±¡å±‚é‡Œé¢çš„æ–¹æ³•ã€‚ 12345678910// ç»™ç³»ç»Ÿé‡Œé¢å¯¼å…¥ SLF4J çš„ JAR å’Œ Logback çš„å®ç° JARimport org.slf4j.Logger;import org.slf4j.LoggerFactory;public class HelloWorld &#123; public static void main(String[] args) &#123; Logger logger = LoggerFactory.getLogger(HelloWorld.class); logger.info(\"Hello World\"); &#125;&#125; SLF4J åšä¸ºä¸åŒçš„æ—¥å¿—å®ç°æ¡†æ¶çš„é—¨é¢çš„é…ç½®ç»“æ„ï¼š ç»Ÿä¸€æ—¥å¿—è®°å½•ï¼š å°†ç³»ç»Ÿä¸­å…¶ä»–æ—¥å¿—æ¡†æ¶å…ˆæ’é™¤å‡ºå»ï¼› ç”¨ä¸­é—´åŒ…æ¥æ›¿æ¢åŸæœ‰çš„æ—¥å¿—æ¡†æ¶ï¼› å¯¼å…¥ SLF4J çš„å…¶ä»–çš„å®ç°ã€‚ Spring Boot æ—¥å¿—å…³ç³»1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-logging&lt;/artifactId&gt;&lt;/dependency&gt; Spring Boot å†…é…ç½®çš„æ’é™¤ Spring çš„ Commons-Loggingï¼š 12345678910&lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-core&lt;/artifactId&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;commons-logging&lt;/groupId&gt; &lt;artifactId&gt;commons-logging&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt;&lt;/dependency&gt; æ—¥å¿—çš„ä½¿ç”¨æ—¥å¿—çš„çº§åˆ«ï¼š 12345678// ç”±ä½åˆ°é«˜ trace &lt; debug &lt; info &lt; warn &lt; error// å¯ä»¥è°ƒæ•´è¾“å‡ºçš„æ—¥å¿—çº§åˆ«ï¼›æ—¥å¿—å°±åªä¼šåœ¨è¿™ä¸ªçº§åˆ«ä»¥ä»¥åçš„é«˜çº§åˆ«ç”Ÿæ•ˆlogger.trace(\"è¿™æ˜¯traceæ—¥å¿—...\");logger.debug(\"è¿™æ˜¯debugæ—¥å¿—...\");// SpringBoot é»˜è®¤ç»™æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ info çº§åˆ«ï¼ˆroot çº§åˆ«ï¼‰logger.info(\"è¿™æ˜¯infoæ—¥å¿—...\");logger.warn(\"è¿™æ˜¯warnæ—¥å¿—...\");logger.error(\"è¿™æ˜¯erroræ—¥å¿—...\"); æ—¥å¿—è¾“å‡ºæ ¼å¼ï¼š 1234567æ—¥å¿—è¾“å‡ºæ ¼å¼ï¼š %dè¡¨ç¤ºæ—¥æœŸæ—¶é—´; %d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; %threadè¡¨ç¤ºçº¿ç¨‹å; %-5levelï¼šçº§åˆ«ä»å·¦æ˜¾ç¤º5ä¸ªå­—ç¬¦å®½åº¦; %logger&#123;50&#125; è¡¨ç¤ºloggeråå­—æœ€é•¿50ä¸ªå­—ç¬¦ï¼Œå¦åˆ™æŒ‰ç…§å¥ç‚¹åˆ†å‰²; %msgï¼šæ—¥å¿—æ¶ˆæ¯; %næ˜¯æ¢è¡Œç¬¦ã€‚ Spring Boot ä¿®æ”¹æ—¥å¿—çš„é»˜è®¤è®¾ç½® 1234567891011121314logging.level.com.wingo=trace # æŒ‡å®šæŸä¸ªåŒ…è·¯å¾„ä¸‹çš„æ—¥å¿—è¾“å‡ºç­‰çº§# logging.path=# ä¸æŒ‡å®šè·¯å¾„åœ¨å½“å‰é¡¹ç›®ä¸‹ç”Ÿæˆ springboot.log æ—¥å¿—# å¯ä»¥æŒ‡å®šå®Œæ•´çš„è·¯å¾„ï¼›# logging.file=G:/springboot.log# åœ¨å½“å‰ç£ç›˜çš„æ ¹è·¯å¾„ä¸‹åˆ›å»º spring æ–‡ä»¶å¤¹å’Œé‡Œé¢çš„ log æ–‡ä»¶å¤¹ï¼›ä½¿ç”¨ spring.log ä½œä¸ºé»˜è®¤æ–‡ä»¶# logging.path=/spring/log# åœ¨æ§åˆ¶å°è¾“å‡ºçš„æ—¥å¿—çš„æ ¼å¼logging.pattern.console=%d&#123;yyyy-MM-dd&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n# æŒ‡å®šæ–‡ä»¶ä¸­æ—¥å¿—è¾“å‡ºçš„æ ¼å¼logging.pattern.file=%d&#123;yyyy-MM-dd&#125; === [%thread] === %-5level === %logger&#123;50&#125; ==== %msg%n æŒ‡å®šé…ç½® ç»™ç±»è·¯å¾„ä¸‹æ”¾ä¸Šæ¯ä¸ªæ—¥å¿—æ¡†æ¶è‡ªå·±çš„é…ç½®æ–‡ä»¶å³å¯ï¼ŒSpringBoot å°±ä¸ä½¿ç”¨ä»–é»˜è®¤é…ç½®çš„äº†ã€‚ Logging System Customization Logback logback-spring.xml, logback-spring.groovy, logback.xml or logback.groovy Log4J2 log4j2-spring.xml or log4j2.xml JDK (Java Util Logging) logging.properties logback.xmlï¼šç›´æ¥å°±è¢«æ—¥å¿—æ¡†æ¶è¯†åˆ«äº†ï¼› logback-spring.xmlï¼šæ—¥å¿—æ¡†æ¶å°±ä¸ç›´æ¥åŠ è½½æ—¥å¿—çš„é…ç½®é¡¹ï¼Œç”± SpringBoot è§£ææ—¥å¿—é…ç½®ï¼Œå¯ä»¥ä½¿ç”¨ SpringBoot çš„é«˜çº§ Profile åŠŸèƒ½ã€‚ SpringBoot çš„é«˜çº§ Profile åŠŸèƒ½ï¼š 123&lt;springProfile name=\"staging\"&gt; &lt;!-- configuration to be enabled when the \"staging\" profile is active --&gt;&lt;/springProfile&gt; é…ç½®æ–‡ä»¶12345678910111213141516171819202122&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;configuration&gt; &lt;!-- å…ˆå®šä¹‰æ‰€æœ‰çš„ appender --&gt; &lt;appenders&gt; &lt;!-- è¾“å‡ºæ§åˆ¶å°çš„é…ç½® --&gt; &lt;console name=\"Console target=SYSTEM_OUT\"&gt; &lt;!-- è¾“å‡ºæ—¥å¿—çš„æ ¼å¼ --&gt; &lt;patternlayout pattern=\"[%p] &gt;&gt;&gt; %m%n\"/&gt; &lt;/console&gt; &lt;/appenders&gt; &lt;loggers&gt; &lt;!-- å®šä¹‰å„ç§åŒ…ä¸‹çš„æ—¥å¿—çš„è¾“å‡ºçº§åˆ« --&gt; &lt;root level=\"DEBUG\"&gt; &lt;!-- è¾“å‡ºåˆ°æ§åˆ¶å° --&gt; &lt;appender-ref ref=\"Console\"/&gt; &lt;/root&gt; &lt;logger name=\"org.springframework\" level=\"ERROR\"/&gt; &lt;logger name=\"com.baomidou\" level=\"ERROR\"/&gt; &lt;logger name=\"org.hibernate\" level=\"ERROR\"/&gt; &lt;logger name=\"com. alibaba druid\" level=\"ERROR\"/&gt; &lt;/loggers&gt;&lt;/configuration&gt; 123456789101112131415161718192021222324252627282930313233343536&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;configuration scan=\"true\" scanPeriod=\"60 seconds\" debug=\"false\"&gt; &lt;contextName&gt;logback&lt;/contextName&gt; &lt;property name=\"log.path\" value=\"C:\\Users\\wingo\\Documents\\Recent\\log\" /&gt; &lt;!--è¾“å‡ºåˆ°æ§åˆ¶å°--&gt; &lt;appender name=\"console\" class=\"ch.qos.logback.core.ConsoleAppender\"&gt; &lt;!-- &lt;filter class=\"ch.qos.logback.classic.filter.ThresholdFilter\"&gt; &lt;level&gt;ERROR&lt;/level&gt; &lt;/filter&gt;--&gt; &lt;encoder&gt; &lt;pattern&gt;[%p] &gt;&gt;&gt; %m%n&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;!--è¾“å‡ºåˆ°æ–‡ä»¶--&gt; &lt;appender name=\"file\" class=\"ch.qos.logback.core.rolling.RollingFileAppender\"&gt; &lt;rollingPolicy class=\"ch.qos.logback.core.rolling.TimeBasedRollingPolicy\"&gt; &lt;fileNamePattern&gt;$&#123;log.path&#125;/logback.%d&#123;yyyy-MM-dd&#125;.log&lt;/fileNamePattern&gt; &lt;/rollingPolicy&gt; &lt;encoder&gt; &lt;pattern&gt;%d&#123;HH:mm:ss.SSS&#125; %contextName [%thread] %-5level %logger&#123;36&#125; - %msg%n&lt;/pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;root level=\"info\"&gt; &lt;appender-ref ref=\"console\" /&gt; &lt;appender-ref ref=\"file\" /&gt; &lt;/root&gt; &lt;!-- logbackä¸ºjavaä¸­çš„åŒ… --&gt; &lt;logger name=\"com.wingo.controller\"/&gt; &lt;!--logback.LogbackDemoï¼šç±»çš„å…¨è·¯å¾„ --&gt; &lt;logger name=\"com.wingo.controller.LearnController\" level=\"WARN\" additivity=\"false\"&gt; &lt;appender-ref ref=\"console\"/&gt; &lt;/logger&gt;&lt;/configuration&gt;","categories":[{"name":"åå°æŠ€æœ¯","slug":"åå°æŠ€æœ¯","permalink":"http://yoursite.com/categories/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"Spring Boot","slug":"Spring-Boot","permalink":"http://yoursite.com/tags/Spring-Boot/"},{"name":"Log","slug":"Log","permalink":"http://yoursite.com/tags/Log/"}]},{"title":"Spring Boot å…¥é—¨é…ç½®","slug":"åå°æŠ€æœ¯/Spring Boot/Spring Boot å…¥é—¨é…ç½®","date":"2020-02-29T02:48:07.000Z","updated":"2020-07-10T04:13:31.158Z","comments":true,"path":"2020/02/29/åå°æŠ€æœ¯/Spring Boot/Spring Boot å…¥é—¨é…ç½®/","link":"","permalink":"http://yoursite.com/2020/02/29/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/Spring%20Boot/Spring%20Boot%20%E5%85%A5%E9%97%A8%E9%85%8D%E7%BD%AE/","excerpt":"Spring Boot 2.x çš„ Hello World ä»¥åŠé…ç½®è¯¦è§£ã€‚","text":"Spring Boot 2.x çš„ Hello World ä»¥åŠé…ç½®è¯¦è§£ã€‚ èƒŒæ™¯ï¼šJ2EE ç¬¨é‡çš„å¼€å‘ã€ç¹å¤šçš„é…ç½®ã€åº•ä¸‹çš„å¼€å‘æ•ˆç‡å§ã€å¤æ‚çš„éƒ¨ç½²æµç¨‹ã€ç¬¬ä¸‰æ–¹æŠ€æœ¯é›†æˆéš¾åº¦å¤§ã€‚ è§£å†³ï¼šSpring å…¨å®¶æ¡¶ ğŸ‘‰ Spring Boot J2EE ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆ ğŸ‘‰ Spring Cloud åˆ†å¸ƒå¼æ•´ä½“è§£å†³æ–¹æ¡ˆ Spring Boot ç®€ä»‹ ç®€åŒ– Spring åº”ç”¨å¼€å‘çš„ä¸€ä¸ªæ¡†æ¶ï¼› æ•´åˆ Spring æŠ€æœ¯æ ˆçš„ä¸€ä¸ªå¤§é›†åˆï¼› J2EE ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆã€‚ å¾®æœåŠ¡ï¼šä¸€ç§æ¶æ„é£æ ¼ï¼Œå³ä¸€ä¸ªåº”ç”¨åº”è¯¥æ˜¯ä¸€ç»„å°å‹æœåŠ¡ï¼Œè¿™äº›å°æœåŠ¡ä¹‹é—´å¯ä»¥é€šè¿‡ HTTP çš„æ–¹å¼è¿›è¡Œé€šä¿¡ï¼Œæ¯ä¸€ä¸ªåŠŸèƒ½å…ƒç´ æœ€ç»ˆéƒ½æ˜¯ä¸€ä¸ªå¯ç‹¬ç«‹æ›¿æ¢å’Œç‹¬ç«‹å‡çº§çš„è½¯ä»¶å•å…ƒã€‚ Spring Boot HelloWorld åŠŸèƒ½ï¼šæµè§ˆå™¨å‘é€ hello è¯·æ±‚ï¼ŒæœåŠ¡å™¨æ¥å—è¯·æ±‚å¹¶å¤„ç†ï¼Œå“åº” Hello World å­—ç¬¦ä¸² é¡¹ç›®ç”Ÿæˆé¡¹ç›®ç”Ÿæˆåœ°å€ï¼šSpring Initiizr å¡«å†™é¡¹ç›®çš„åŸºæœ¬ä¿¡æ¯åç‚¹å‡» Generate ä¸‹è½½ç”Ÿæˆçš„é¡¹ç›®ã€‚ å°†é¡¹ç›®è§£å‹åˆ°ç›¸åº”ç›®å½•ï¼Œæ‰“å¼€ IDEA å¯¼å…¥é¡¹ç›®ã€‚ï¼ˆFile ğŸ‘‰ New ğŸ‘‰ Project from Existing Sourcesï¼‰ é€‰æ‹©ä»¥ Maven é¡¹ç›®çš„æ–¹å¼å¯¼å…¥ã€‚ è®¾ç½® JDK ï¼Œç‚¹å‡» Environment settings é…ç½® Mavenã€‚ é¡¹ç›®å¯¼å…¥æˆåŠŸåçš„é¡¹ç›®ç›®å½•ã€‚ resourcesæ–‡ä»¶å¤¹ä¸­ç›®å½•ç»“æ„ staticï¼šä¿å­˜æ‰€æœ‰çš„é™æ€èµ„æºï¼› js css images ç­‰ï¼› templatesï¼šä¿å­˜æ‰€æœ‰çš„æ¨¡æ¿é¡µé¢ï¼›ï¼ˆSpring Boot é»˜è®¤ jar åŒ…ä½¿ç”¨åµŒå…¥å¼çš„ Tomcatï¼Œé»˜è®¤ä¸æ”¯æŒ JSP é¡µé¢ï¼‰ï¼›å¯ä»¥ä½¿ç”¨æ¨¡æ¿å¼•æ“ï¼ˆfreemarkerã€thymeleafï¼‰ï¼› application.propertiesï¼šSpring Boot åº”ç”¨çš„é…ç½®æ–‡ä»¶ï¼›å¯ä»¥ä¿®æ”¹ä¸€äº›é»˜è®¤è®¾ç½®ï¼› ä»£ç ç¼–å†™åœ¨ pom.xml ä¸­åŠ å…¥ Spring Boot çš„ç›¸å…³ä¾èµ–ã€‚ 1234567&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;!-- åŠŸèƒ½åœºæ™¯æŠ½å–æˆ Starter æ¥å¯¼å…¥ç›¸å…³ä¾èµ– --&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt;&lt;/dependencies&gt; å¯åŠ¨ Spring Boot åº”ç”¨çš„ä¸»ç¨‹åº 1234567891011/** * @author wingo */@SpringBootApplicationpublic class JavaSpringbootWingoApplication &#123; public static void main(String[] args) &#123; run(JavaSpringbootWingoApplication.class, args); &#125;&#125; ç¼–å†™ç›¸å…³çš„ Controller 123456789@Controllerpublic class HelloController &#123; @ResponseBody @RequestMapping(\"/hello\") public String hello()&#123; return \"Hello World!\"; &#125;&#125; è¿è¡Œæµ‹è¯•æ§åˆ¶å°æ‰“å°ä¸­å¯çœ‹åˆ° Tomcat åœ¨å…¶é»˜è®¤ç«¯å£ 8080 è¢«å¼€å¯ã€‚ è®¿é—®ï¼šlocalhost:8080/hello è®¿é—®æˆåŠŸï¼Œæ­¤ Spring Boot é¡¹ç›®å¯æ­£å¸¸è¿è¡Œã€‚ ç®€åŒ–éƒ¨ç½²123456789&lt;!-- è¿™ä¸ªæ’ä»¶å¯ä»¥å°†åº”ç”¨æ‰“åŒ…æˆä¸€ä¸ªå¯æ‰§è¡Œçš„jaråŒ…ï¼Œåœ¨ cmd ç›´æ¥ç”¨ java -jar å‘½ä»¤æ‰§è¡Œ --&gt;&lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;/plugin&gt; &lt;/plugins&gt;&lt;/build&gt; Hello World æ¢ç©¶é¡¹ç›®ä¾èµ–spring-boot-starter-Xxxï¼šå¯åŠ¨å™¨ Spring Boot åœºæ™¯å¯åŠ¨å™¨ï¼Œç”¨äºè‡ªåŠ¨å¯¼å…¥äº†åœºæ™¯è¿è¡Œæ‰€ä¾èµ–çš„ç»„ä»¶ã€‚ 123456&lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;!-- Starter å¯åŠ¨å™¨çš„çˆ¶é¡¹ç›® --&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;1.5.9.RELEASE&lt;/version&gt;&lt;/parent&gt; ç‚¹å‡»è¿›å…¥ spring-boot-starter-parentï¼Œå®ƒçš„çˆ¶é¡¹ç›®æ˜¯ spring-boot-dependenciesã€‚ 1234567&lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;!-- å®šä¹‰äº†å„ç§ä¾èµ–çš„ç‰ˆæœ¬å· --&gt; &lt;artifactId&gt;spring-boot-dependencies&lt;/artifactId&gt; &lt;version&gt;2.2.5.RELEASE&lt;/version&gt; &lt;relativePath&gt;../../spring-boot-dependencies&lt;/relativePath&gt;&lt;/parent&gt; ä¸»ç¨‹åºç±»ï¼ˆå…¥å£ç±»ï¼‰Spring Boot ç”¨@SpringBootApplicationæ¥æ ‡æ³¨ä¸€ä¸ªä¸»ç¨‹åºç±»ï¼Œè¯´æ˜è¿™æ˜¯ä¸€ä¸ª Spring Boot åº”ç”¨ã€‚ 123456@SpringBootConfiguration // è¿™æ˜¯ä¸€ä¸ª Spring Boot é…ç½®ç±»@EnableAutoConfiguration // å¼€å¯è‡ªåŠ¨é…ç½®åŠŸèƒ½@ComponentScan(excludeFilters = &#123; @Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class), @Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) &#125;)public @interface SpringBootApplication &#123;&#125; Spring Boot åœ¨å¯åŠ¨çš„æ—¶å€™ä»ç±»è·¯å¾„ä¸‹çš„ META-INF/spring.factories ä¸­è·å– EnableAutoConfiguration æŒ‡å®šçš„å€¼ï¼Œå°†è¿™äº›å€¼ä½œä¸ºè‡ªåŠ¨é…ç½®ç±»å¯¼å…¥åˆ°å®¹å™¨ä¸­ï¼Œè‡ªåŠ¨é…ç½®ç±»å°±ç”Ÿæ•ˆï¼Œå¸®æˆ‘ä»¬è¿›è¡Œè‡ªåŠ¨é…ç½®å·¥ä½œã€‚ æŒ‰ä½ Ctrl ç‚¹å‡»ä¸€ä¸ªè‡ªåŠ¨è£…é…ç±»ï¼š å‘ç°æœ‰å¤§é‡çš„@Conditionalæ´¾ç”Ÿç±»ï¼Œå¿…é¡»æ˜¯åœ¨@ConditionalæŒ‡å®šçš„æ¡ä»¶æˆç«‹çš„æƒ…å†µä¸‹ï¼Œæ‰ç»™å®¹å™¨ä¸­æ·»åŠ ç»„ä»¶ï¼Œé…ç½®é‡Œé¢çš„æ‰€æœ‰å†…å®¹æ‰ç”Ÿæ•ˆã€‚ å¯ä»¥é€šè¿‡ debug=true å±æ€§è®©æ§åˆ¶å°æ‰“å°è‡ªåŠ¨é…ç½®æŠ¥å‘Šã€‚ Spring Boot é…ç½®æ–‡ä»¶ application.properties application.yml YAMLä»¥æ•°æ®ä¸ºä¸­å¿ƒã€‚ 123server: port: 8081 path: /hello åŸºæœ¬è¯­æ³•ï¼š k:(ç©ºæ ¼)v è¡¨ç¤ºä¸€å¯¹é”®å€¼å¯¹ï¼ˆå¤§å°å†™æ•æ„Ÿï¼‰ï¼› ä»¥ç©ºæ ¼çš„ç¼©è¿›æ¥æ§åˆ¶å±‚çº§å…³ç³»ï¼›åªè¦æ˜¯å·¦å¯¹é½çš„ä¸€åˆ—æ•°æ®ï¼Œéƒ½æ˜¯åŒä¸€ä¸ªå±‚çº§çš„ã€‚ å­—ç¬¦ä¸²å­—ç¬¦ä¸²é»˜è®¤ä¸ç”¨åŠ ä¸Šå•å¼•å·æˆ–è€…åŒå¼•å·ï¼š å•å¼•å·ï¼šä¼šè½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ï¼Œç‰¹æ®Šå­—ç¬¦æœ€ç»ˆåªæ˜¯ä¸€ä¸ªæ™®é€šçš„å­—ç¬¦ä¸²æ•°æ®ï¼› åŒå¼•å·ï¼šä¸ä¼šè½¬ä¹‰å­—ç¬¦ä¸²é‡Œé¢çš„ç‰¹æ®Šå­—ç¬¦ï¼Œç‰¹æ®Šå­—ç¬¦ä¼šä½œä¸ºæœ¬èº«æƒ³è¡¨ç¤ºçš„æ„æ€ã€‚ å¯¹è±¡ã€Mapï¼š 123456friends: lastName: Wen age: 23# è¡Œå†…å†™æ³•friends: &#123;lastName: Wen,age: 23&#125; æ•°ç»„ã€Listã€Setï¼š 123456pets: - cat - dog # è¡Œå†…å†™æ³•friends: [cat,dog] é…ç½®æ–‡ä»¶å€¼çš„æ³¨å…¥é…ç½®æ–‡ä»¶ï¼š 123456789101112person: lastName: hello age: 18 boss: false birth: 2017/12/12 maps: &#123;k1: v1,k2: 12&#125; lists: - lisi - zhaoliu dog: name: å°ç‹— age: 12 Java Bean å°†é…ç½®æ–‡ä»¶ä¸­é…ç½®çš„æ¯ä¸€ä¸ªå±æ€§çš„å€¼ï¼Œæ˜ å°„åˆ°è¿™ä¸ªç»„ä»¶ä¸­ã€‚ åªæœ‰è¿™ä¸ªç»„ä»¶æ˜¯å®¹å™¨ä¸­çš„ç»„ä»¶ï¼Œæ‰èƒ½ä½¿ç”¨å®¹å™¨æä¾›çš„@ConfigurationPropertiesåŠŸèƒ½ @ConfigurationPropertieså‘Šè¯‰ SpringBoot å°†æœ¬ç±»ä¸­çš„æ‰€æœ‰å±æ€§å’Œé…ç½®æ–‡ä»¶ä¸­ç›¸å…³çš„é…ç½®è¿›è¡Œç»‘å®šï¼› prefix = &quot;person&quot;é…ç½®æ–‡ä»¶ä¸­å“ªä¸ªä¸‹é¢çš„æ‰€æœ‰å±æ€§è¿›è¡Œä¸€ä¸€æ˜ å°„ã€‚ 123456789101112131415161718192021/** * å°†é…ç½®æ–‡ä»¶ä¸­é…ç½®çš„æ¯ä¸€ä¸ªå±æ€§çš„å€¼ï¼Œæ˜ å°„åˆ°è¿™ä¸ªç»„ä»¶ä¸­ * @ConfigurationPropertiesï¼šå‘Šè¯‰SpringBootå°†æœ¬ç±»ä¸­çš„æ‰€æœ‰å±æ€§å’Œé…ç½®æ–‡ä»¶ä¸­ç›¸å…³çš„é…ç½®è¿›è¡Œç»‘å®šï¼› * prefix = \"person\"ï¼šé…ç½®æ–‡ä»¶ä¸­å“ªä¸ªä¸‹é¢çš„æ‰€æœ‰å±æ€§è¿›è¡Œä¸€ä¸€æ˜ å°„ * * åªæœ‰è¿™ä¸ªç»„ä»¶æ˜¯å®¹å™¨ä¸­çš„ç»„ä»¶ï¼Œæ‰èƒ½ä½¿ç”¨å®¹å™¨æä¾›çš„@ConfigurationPropertiesåŠŸèƒ½ï¼› * */@Component@ConfigurationProperties(prefix = \"person\")public class Person &#123; private String lastName; private Integer age; private Boolean boss; private Date birth; private Map&lt;String,Object&gt; maps; private List&lt;Object&gt; lists; private Dog dog;&#125; å¯¼å…¥é…ç½®æ–‡ä»¶å¤„ç†å™¨ï¼Œè¿™æ ·ç¼–å†™é…ç½®æ—¶ä¼šæœ‰æç¤ºã€‚ 123456&lt;!-- å¯¼å…¥é…ç½®æ–‡ä»¶å¤„ç†å™¨ï¼Œé…ç½®æ–‡ä»¶è¿›è¡Œç»‘å®šå°±ä¼šæœ‰æç¤º --&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt;&lt;/dependency&gt; properties é…ç½®æ–‡ä»¶åœ¨ IDEA ä¸­é»˜è®¤ UTF-8 å¯èƒ½ä¼šä¹±ç ï¼Œå‹¾é€‰ Setting - File Encodings - Transparent native-to-ascii conversionã€‚ @Valueè·å–å€¼å’Œ@ConfigurationPropertiesè·å–å€¼æ¯”è¾ƒ @ConfigurationProperties @Value åŠŸèƒ½ æ‰¹é‡æ³¨å…¥é…ç½®æ–‡ä»¶ä¸­çš„å±æ€§ ä¸€ä¸ªä¸ªæŒ‡å®š æ¾æ•£ç»‘å®šï¼ˆæ¾æ•£è¯­æ³•ï¼‰ æ”¯æŒ ä¸æ”¯æŒ SpEL ä¸æ”¯æŒ æ”¯æŒ JSR303æ•°æ®æ ¡éªŒ æ”¯æŒ ä¸æ”¯æŒ å¤æ‚ç±»å‹å°è£… æ”¯æŒ ä¸æ”¯æŒ é…ç½®æ–‡ä»¶ yml è¿˜æ˜¯ properties å®ƒä»¬éƒ½èƒ½è·å–åˆ°å€¼ï¼š åªæ˜¯åœ¨æŸä¸ªä¸šåŠ¡é€»è¾‘ä¸­éœ€è¦è·å–ä¸€ä¸‹é…ç½®æ–‡ä»¶ä¸­çš„æŸé¡¹å€¼ï¼Œä½¿ç”¨@Valueï¼› ä¸“é—¨ç¼–å†™äº†ä¸€ä¸ª JavaBean æ¥å’Œé…ç½®æ–‡ä»¶è¿›è¡Œæ˜ å°„ï¼Œæˆ‘ä»¬å°±ç›´æ¥ä½¿ç”¨@ConfigurationPropertiesï¼› é…ç½®æ–‡ä»¶æ³¨å…¥æ ¡éªŒæ•°æ®ã€‚ 12345678//...@Validated // å¼€å¯æ ¡éªŒpublic class Person &#123; //... @Email // å¿…é¡»ä¸ºé‚®ä»¶æ ¼å¼ private String lastName; //...&#125; é…ç½®æ–‡ä»¶çš„åŠ è½½@PropertySourceï¼šåŠ è½½æŒ‡å®šçš„é…ç½®æ–‡ä»¶ã€‚ 1@PropertySource(value = &#123;\"classpath:person.properties\"&#125;) @ImportResourceï¼šè®© Spring çš„é…ç½®æ–‡ä»¶ç”Ÿæ•ˆï¼ŒåŠ è½½è¿›æ¥ã€‚Spring Boot é‡Œé¢æ²¡æœ‰ Spring çš„é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬è‡ªå·±ç¼–å†™çš„é…ç½®æ–‡ä»¶ï¼Œä¹Ÿä¸èƒ½è‡ªåŠ¨è¯†åˆ«ã€‚ 1@ImportResource(locations = &#123;\"classpath:beans.xml\"&#125;) Spring Boot æ¨èä½¿ç”¨å…¨æ³¨è§£çš„æ–¹å¼ã€‚ 12345678910@Configuration // æŒ‡æ˜å½“å‰ç±»æ˜¯ä¸€ä¸ª Spring é…ç½®ç±»public class MyAppConfig &#123; //å°†æ–¹æ³•çš„è¿”å›å€¼æ·»åŠ åˆ°å®¹å™¨ä¸­ï¼›å®¹å™¨ä¸­è¿™ä¸ªç»„ä»¶é»˜è®¤çš„idå°±æ˜¯æ–¹æ³•å @Bean public HelloService helloService()&#123; System.out.println(\"é…ç½®ç±» @Bean ç»™å®¹å™¨ä¸­æ·»åŠ ç»„ä»¶äº†...\"); return new HelloService(); &#125;&#125; é…ç½®æ–‡ä»¶å ä½ç¬¦éšæœºæ•°ï¼š 12$&#123;random.value&#125;ã€$&#123;random.int&#125;ã€$&#123;random.long&#125;$&#123;random.int(10)&#125;ã€$&#123;random.int[1024,65536]&#125; å ä½ç¬¦è·å–ä¹‹å‰é…ç½®è¿‡çš„å€¼ï¼Œå¯ç”¨:æŒ‡å®šé»˜è®¤å€¼ 123456789person.last-name=å¼ ä¸‰$&#123;random.uuid&#125;person.age=$&#123;random.int&#125;person.birth=2017/12/15person.boss=falseperson.maps.k1=v1person.maps.k2=14person.lists=a,b,cperson.dog.name=$&#123;person.hello:hello&#125;_dog // æŒ‡å®šé»˜è®¤å€¼person.dog.age=15 Profileå¤š Profile æ–‡ä»¶ï¼šæˆ‘ä»¬åœ¨ä¸»é…ç½®æ–‡ä»¶ç¼–å†™çš„æ—¶å€™ï¼Œæ–‡ä»¶åå¯ä»¥æ˜¯ application-{profile}.properties / ymlï¼Œé»˜è®¤ä½¿ç”¨ application.properties çš„é…ç½®ã€‚ Yaml æ”¯æŒå¤šæ–‡æ¡£å—çš„æ–¹å¼ï¼š 12345678910111213141516171819server: port: 8081spring: profiles: active: prod # æŒ‡å®šæ¿€æ´»å“ªä¸ªç¯å¢ƒ--- # æ–‡æ¡£å—åˆ†éš”ç¬¦server: port: 8083spring: profiles: dev # å±äº dev ç¯å¢ƒ---server: port: 8084spring: profiles: prod # å±äº prod ç¯å¢ƒ æ¿€æ´»æŒ‡å®šçš„ Profile åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šspring.profiles.active=dev å‘½ä»¤è¡Œè¿è¡Œjava -jar [é¡¹ç›® JAR åŒ…] --spring.profiles.active=dev; è™šæ‹Ÿæœºå‚æ•°-Dspring.profiles.active=dev é…ç½®æ–‡ä»¶åŠ è½½ä½ç½®springboot å¯åŠ¨ä¼šæ‰«æä»¥ä¸‹ä½ç½®çš„ application.properties æˆ–è€… application.yml æ–‡ä»¶ä½œä¸º Spring boot çš„é»˜è®¤é…ç½®æ–‡ä»¶ file:./config/ file:./ classpath:/config/ classpath:/ ä¼˜å…ˆçº§ç”±é«˜åˆ°åº•ï¼Œé«˜ä¼˜å…ˆçº§çš„é…ç½®ä¼šè¦†ç›–ä½ä¼˜å…ˆçº§çš„é…ç½®ï¼›SpringBoot ä¼šä»è¿™å››ä¸ªä½ç½®åŠ è½½å…¨éƒ¨é…ç½®æ–‡ä»¶å½¢æˆäº’è¡¥é…ç½®ã€‚ é¡¹ç›®æ‰“åŒ…å¥½åï¼Œè‹¥è¦æ”¹å˜é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°çš„å½¢å¼ java -jar [é¡¹ç›® JAR åŒ…] --spring.config.location=D:/application.properties æˆ–è€…ç›´æ¥ä½¿ç”¨ --é…ç½®é¡¹=å€¼çš„æ–¹å¼æ”¹å˜æŸä¸€é¡¹é…ç½® java -jar [é¡¹ç›® JAR åŒ…] --server.port=8087 --server.context-path=/abc ä¼˜å…ˆçº§ï¼šå¤–éƒ¨ &gt; å†…éƒ¨ã€å¸¦ profile &gt; ä¸å¸¦ profile å¯åŠ¨åŸç†è§£æ","categories":[{"name":"åå°æŠ€æœ¯","slug":"åå°æŠ€æœ¯","permalink":"http://yoursite.com/categories/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"Spring Boot","slug":"Spring-Boot","permalink":"http://yoursite.com/tags/Spring-Boot/"}]},{"title":"Netty å¸¸ç”¨é…ç½®","slug":"åå°æŠ€æœ¯/Netty/Netty å¸¸ç”¨é…ç½®","date":"2020-02-27T08:35:34.000Z","updated":"2020-07-10T04:03:45.673Z","comments":true,"path":"2020/02/27/åå°æŠ€æœ¯/Netty/Netty å¸¸ç”¨é…ç½®/","link":"","permalink":"http://yoursite.com/2020/02/27/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/Netty/Netty%20%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/","excerpt":"åœ¨ä½¿ç”¨ Netty çš„è¿‡ç¨‹ä¸­ä¼šå¯¹ serverBootStrap çš„ option å’Œ childOption è¿›è¡Œè‡ªå®šä¹‰çš„ä¸€äº›é…ç½®ï¼Œå…·ä½“å°±æ˜¯ä½¿ç”¨ChannelOption é‡Œé¢å£°æ˜çš„å¸¸é‡è¿›è¡Œé…ç½®ï¼Œåœ¨æ­¤ä»‹ç»ä¸€ä¸‹è¿™äº›å¸¸é‡ã€‚","text":"åœ¨ä½¿ç”¨ Netty çš„è¿‡ç¨‹ä¸­ä¼šå¯¹ serverBootStrap çš„ option å’Œ childOption è¿›è¡Œè‡ªå®šä¹‰çš„ä¸€äº›é…ç½®ï¼Œå…·ä½“å°±æ˜¯ä½¿ç”¨ChannelOption é‡Œé¢å£°æ˜çš„å¸¸é‡è¿›è¡Œé…ç½®ï¼Œåœ¨æ­¤ä»‹ç»ä¸€ä¸‹è¿™äº›å¸¸é‡ã€‚ ChannelOption æœåŠ¡ç«¯ï¼š option() ç”¨äºè®¾ç½® ServerChannel çš„é€‰é¡¹ï¼Œè´Ÿè´£ç›‘å¬å’Œæ¥æ”¶è¿æ¥ï¼› childOption()ï¼šç”¨äºè®¾ç½® SocketChannelï¼Œè´Ÿè´£å¤„ç† I/O æ“ä½œã€‚ å®¢æˆ·ç«¯ï¼š æ²¡æœ‰ childOption()ã€‚ ChannelOption.SO_BACKLOG SO_BACKLOG å¯¹åº”çš„æ˜¯ TCP/IP åè®® listen() å‡½æ•°ä¸­çš„ backlog å‚æ•°ï¼Œå‡½æ•° listen(int socketfd, int backlog) ç”¨æ¥åˆå§‹åŒ–æœåŠ¡ç«¯å¯è¿æ¥é˜Ÿåˆ—ï¼ŒæœåŠ¡ç«¯å¤„ç†å®¢æˆ·ç«¯é“¾æ¥æ˜¯é¡ºåºå¤„ç†çš„ï¼Œæ‰€ä»¥åŒä¸€æ—¶é—´åªèƒ½å¤„ç†ä¸€ä¸ªé“¾æ¥ï¼Œå¤šå®¢æˆ·ç«¯è¯·æ±‚è¿‡æ¥æ—¶ï¼ŒæœåŠ¡ç«¯ä¼šå°†æœªå¤„ç†çš„è¯·æ±‚æ”¾å…¥è¯·æ±‚é˜Ÿåˆ—ï¼Œbacklogbå°±æ˜¯åˆ¶å®šäº†é˜Ÿåˆ—çš„å¤§å°ã€‚ ChannelOption.SO_REUSEADDR SO_REUSEADDR å¯¹åº”çš„æ˜¯ Socket é€‰é¡¹ä¸­ SO_REUSEADDRï¼Œè¿™ä¸ªå‚æ•°è¡¨ç¤ºå…è®¸é‡å¤ä½¿ç”¨æœ¬åœ°åœ°å€å’Œç«¯å£ï¼Œä¾‹å¦‚ï¼ŒæŸä¸ªæœåŠ¡å ç”¨äº† TCP çš„ 8080 ç«¯å£ï¼Œå…¶ä»–æœåŠ¡å†å¯¹è¿™ä¸ªç«¯å£è¿›è¡Œç›‘å¬å°±ä¼šæŠ¥é”™ï¼ŒSO_REUSEADDR è¿™ä¸ªå‚æ•°å°±æ˜¯ç”¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜çš„ï¼Œè¯¥å‚æ•°å…è®¸æœåŠ¡å…¬ç”¨ä¸€ä¸ªç«¯å£ï¼Œè¿™ä¸ªåœ¨æœåŠ¡å™¨ç¨‹åºä¸­æ¯”è¾ƒå¸¸ç”¨ï¼Œä¾‹å¦‚æŸä¸ªè¿›ç¨‹éæ­£å¸¸é€€å‡ºï¼Œå¯¹ä¸€ä¸ªç«¯å£çš„å ç”¨å¯èƒ½ä¸ä¼šç«‹å³é‡Šæ”¾ï¼Œè¿™æ—¶å€™å¦‚æœä¸è®¾ç½®è¿™ä¸ªå‚æ•°ï¼Œå…¶ä»–è¿›ç¨‹å°±ä¸èƒ½ç«‹å³ä½¿ç”¨è¿™ä¸ªç«¯å£ã€‚ ChannelOption.SO_KEEPALIVE SO_KEEPALIVE è¿™ä¸ªå‚æ•°å¯¹åº” Socket ä¸­çš„ SO_KEEPALIVEï¼Œå½“è®¾ç½®è¿™ä¸ªå‚æ•°ä¸º true åï¼ŒTCP è¿æ¥ä¼šæµ‹è¯•è¿™ä¸ªè¿æ¥çš„çŠ¶æ€ï¼Œå¦‚æœè¯¥è¿æ¥é•¿æ—¶é—´æ²¡æœ‰æ•°æ®äº¤æµï¼ŒTCP ä¼šè‡ªåŠ¨å‘é€ä¸€ä¸ªæ´»åŠ¨æ¢æµ‹æ•°æ®æŠ¥æ–‡ï¼Œæ¥æ£€æµ‹é“¾æ¥æ˜¯å¦å­˜æ´»ã€‚ ChannelOption.TCP_NODELAY TCP_NODELAY å¯¹åº”äº socket é€‰é¡¹ä¸­çš„ TCP_NODELAYï¼Œè¯¥å‚æ•°çš„ä½¿ç”¨å’Œ Nagle ç®—æ³•æœ‰å…³ï¼ŒNagle ç®—æ³•æ˜¯å°†å°çš„æ•°æ®åŒ…ç»„è£…ä¸ºæ›´å¤§çš„å¸§è¿›è¡Œå‘é€ï¼Œè€Œä¸ä¼šæ¥ä¸€ä¸ªæ•°æ®åŒ…å‘é€ä¸€æ¬¡ï¼Œç›®çš„æ˜¯ä¸ºäº†æé«˜æ¯æ¬¡å‘é€çš„æ•ˆç‡ï¼Œå› æ­¤åœ¨æ•°æ®åŒ…æ²¡æœ‰ç»„æˆè¶³å¤Ÿå¤§çš„å¸§æ—¶ï¼Œå°±ä¼šå»¶è¿Ÿè¯¥æ•°æ®åŒ…çš„å‘é€ï¼Œè™½ç„¶æé«˜äº†ç½‘ç»œè´Ÿè½½å´é€ æˆäº†å»¶æ—¶ï¼ŒTCP_NODELAY å‚æ•°è®¾ç½®ä¸º trueï¼Œå°±å¯ä»¥ç¦ç”¨ Nagle ç®—æ³•ï¼Œå³ä½¿ç”¨å°æ•°æ®åŒ…å³æ—¶ä¼ è¾“ã€‚ä¸ TCP_NODELAY å¯¹åº”çš„å°±æ˜¯ TCP_CORKï¼Œè¯¥é€‰é¡¹ä¼šç­‰åˆ°å‘é€çš„æ•°æ®é‡æœ€å¤§çš„æ—¶å€™ï¼Œä¸€æ¬¡æ€§å‘é€ï¼Œé€‚åˆè¿›è¡Œæ–‡ä»¶ä¼ è¾“ã€‚ ChannelOption.SO_SNDBUF å’Œ ChannelOption.SO_RCVBUF SO_SNDBUF å’Œ SO_RCVBUF å¯¹åº” Socket ä¸­çš„ SO_SNDBUF å’Œ SO_RCVBUF å‚æ•°ï¼Œå³è®¾ç½®å‘é€ç¼“å†²åŒºå’Œæ¥æ”¶ç¼“å†²åŒºçš„å¤§å°ï¼Œå‘é€ç¼“å†²åŒºç”¨äºä¿å­˜å‘é€æ•°æ®ï¼Œç›´åˆ°å‘é€æˆåŠŸï¼Œæ¥æ”¶ç¼“å†²åŒºç”¨äºä¿å­˜ç½‘ç»œåè®®ç«™å†…æ”¶åˆ°çš„æ•°æ®ï¼Œç›´åˆ°ç¨‹åºè¯»å–æˆåŠŸã€‚ CodecHttp æœåŠ¡HttpServerCodec å°†äºŒè¿›åˆ¶æŠ¥æ–‡è½¬ä¸º HTTP æ–‡æœ¬æŠ¥æ–‡ã€‚ HttpObjectAggregator(512*1024) åˆå¹¶åˆ†æ‰¹æ¬¡è¿‡æ¥çš„ HTTP æŠ¥æ–‡ï¼Œåˆå¹¶å Handler æ‹¿åˆ°çš„å°†æ˜¯ä¸€ä¸ªå®Œæ•´çš„ HTTP æŠ¥æ–‡ã€‚","categories":[{"name":"åå°æŠ€æœ¯","slug":"åå°æŠ€æœ¯","permalink":"http://yoursite.com/categories/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"Netty","slug":"Netty","permalink":"http://yoursite.com/tags/Netty/"}]},{"title":"Java 8 æ–°ç‰¹æ€§","slug":"åŸºç¡€çŸ¥è¯†/Java 8 æ–°ç‰¹æ€§","date":"2020-02-18T07:14:54.000Z","updated":"2020-07-10T03:12:41.959Z","comments":true,"path":"2020/02/18/åŸºç¡€çŸ¥è¯†/Java 8 æ–°ç‰¹æ€§/","link":"","permalink":"http://yoursite.com/2020/02/18/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/Java%208%20%E6%96%B0%E7%89%B9%E6%80%A7/","excerpt":"","text":"LambdJava SE 8 çš„ä¸€ä¸ªå¤§äº®ç‚¹æ˜¯å¼•å…¥äº† Lambda è¡¨è¾¾å¼ï¼Œä½¿ç”¨å®ƒè®¾è®¡çš„ä»£ç ä¼šæ›´åŠ ç®€æ´ã€‚ å½“å¼€å‘è€…åœ¨ç¼–å†™ Lambda è¡¨è¾¾å¼æ—¶ï¼Œä¹Ÿä¼šéšä¹‹è¢«ç¼–è¯‘æˆä¸€ä¸ªå‡½æ•°å¼æ¥å£ï¼ŒLambda å…è®¸æŠŠå‡½æ•°ä½œä¸ºä¸€ä¸ªæ–¹æ³•çš„å‚æ•°ä¼ é€’è¿›æ–¹æ³•ä¸­ã€‚Lambda è¡¨è¾¾å¼æœ¬è´¨æ˜¯åŒ¿åå‡½æ•°ï¼ˆæˆ–è€…å«åŒ¿åæ–¹æ³•ï¼‰ï¼Œä¹Ÿå¯ç§°ä¹‹ä¸ºé—­åŒ…ï¼Œåƒæ–¹æ³•ä¸€æ ·ï¼Œ Lambda è¡¨è¾¾å¼å…·æœ‰å¸¦ç±»å‹çš„å‚æ•°ã€ä¸»ä½“å’Œè¿”å›ç±»å‹ã€‚å¯ä½¿ç”¨ Lambda è¯­æ³•æ¥ä»£æ›¿åŒ¿åçš„å†…éƒ¨ç±»ï¼Œä»£ç ä¸ä»…ç®€æ´è€Œä¸”è¿˜å¯è¯»ã€‚ å½“ç„¶ï¼Œä¸è¶³ä¹‹å¤„å¯èƒ½å°±æ˜¯å¯è¯»æ€§ç¨å·®åŠè°ƒè¯•ç¨éº»çƒ¦ä¸€äº›ã€‚ Lambda è¯­æ³•æ ¼å¼èƒ½å¤Ÿç”¨äº Lambda è¡¨è¾¾å¼çš„åªèƒ½æ˜¯ interfaceï¼Œä¸” interface ä¸­åªæœ‰ä¸€ä¸ªæ–¹æ³•ã€‚ Lambda è¡¨è¾¾å¼çš„æ ‡å‡†ç»“æ„ï¼š (parameters) -&gt; {statements;} 123456789101112&#x2F;&#x2F; æ ‡å‡†ç»“æ„çš„å„ç§å˜å½¢&#x2F;&#x2F; å½“æ–¹æ³•ä½“ä¸­åªæœ‰ä¸€æ¡è¯­å¥æ—¶ï¼Œreturn å’Œ &#123;&#125; éƒ½å¯çœç•¥(parameters) -&gt; expression&#x2F;&#x2F; å½“ä»…æœ‰ä¸€ä¸ªå‚æ•°æ—¶ï¼Œ() å¯çœç•¥parameters -&gt; expression&#x2F;&#x2F; å½“æ²¡æœ‰å‚æ•°æ—¶ï¼Œå¯ç›´æ¥ä½¿ç”¨ ()() -&gt; expression&#x2F;&#x2F; ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨å¯ä»¥ä»ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­æ¨æ–­å‡º Lambda è¡¨è¾¾å¼çš„å‚æ•°ç±»å‹ï¼Œæ‰€ä»¥å‚æ•°çš„ç±»å‹å£°æ˜ä¹Ÿå¯ä»¥çœæ‰ Lambda æ–¹æ³•å¼•ç”¨Lambda è¡¨è¾¾å¼ç®€æ´å†™æ³•ï¼šs -&gt; s.toLowerCase()å¯çœç•¥ä¸º String::toLowerCase æ–¹æ³•å¼•ç”¨åŒ…å«çš„æƒ…å†µ é™æ€æ–¹æ³•å¼•ç”¨Class::static_method æ„é€ æ–¹æ³•å¼•ç”¨Class::newæˆ–Class&lt;T&gt;::new ç±»æˆå‘˜æ–¹æ³•å¼•ç”¨Class::method å¯¹è±¡æ–¹æ³•å¼•ç”¨instance::method Supplier æ¥å£ï¼šä¸æ¥å—ä»»ä½•å‚æ•°ï¼Œè¿”å›ä¸€ä¸ªç»“æœï¼ˆåªæœ‰ä¸€ä¸ªget()æ–¹æ³•ï¼‰ã€‚ 123456public class SupplierTest &#123; public static void main(String n args)&#123; Supplier&lt;String&gt; supplier = () -&gt; \"hello world\"; System.out.println(supplier.get()); // æ§åˆ¶å°æ‰“å° hello world &#125;&#125; StreamJava 8 ä¸­çš„Streamæ˜¯å¯¹é›†åˆï¼ˆCollectionï¼‰å¯¹è±¡åŠŸèƒ½çš„å¢å¼ºï¼Œé€‚ç”¨äºå¯¹é›†åˆå¯¹è±¡è¿›è¡Œå„ç§ä¾¿åˆ©ã€é«˜æ•ˆçš„è¿‡æ»¤ã€æ˜ å°„ã€æ’åºåŠèšåˆç­‰æ“ä½œï¼Œå¯ä»¥ç‹¬ç«‹ä¹Ÿå¯ä»¥ç»„åˆæˆå¤æ‚çš„æ“ä½œã€‚ Streamè¿˜åŒæ—¶æ”¯æŒä¸²è¡Œå’Œå¹¶è¡Œä¸¤ç§æ“ä½œæ¨¡å¼ï¼Œå¹¶è¡Œæ¨¡å¼èƒ½å¤Ÿå……åˆ†åˆ©ç”¨ç›®å‰ä¸»æµçš„å¤šæ ¸å¤„ç†å™¨çš„ä¼˜åŠ¿ï¼Œä½¿ç”¨ Fork / Join å¹¶è¡Œæ–¹å¼æ¥æ‹†åˆ†å’ŒåŠ é€Ÿä»»åŠ¡çš„å¤„ç†è¿‡ç¨‹ã€‚Stream API æ— éœ€ç¼–å†™å¤šçº¿ç¨‹ä»£ç ï¼Œé€šè¿‡å¹¶å‘æ¨¡å¼å¾ˆå®¹æ˜“å°±æ”¯æŒä»»åŠ¡çš„å¹¶è¡Œå¤„ç†ã€‚ Stream API ä½¿ç”¨ä¸€ç§ç±»ä¼¼ SQL è¯­å¥ä»æ•°æ®åº“æŸ¥è¯¢æ•°æ®çš„ç›´è§‚æ–¹å¼æ¥æ“ä½œ Java é›†åˆæ•°æ®ï¼Œå¯ä»¥å†™å‡ºé«˜æ•ˆç‡ã€å¹²å‡€ã€ç®€æ´çš„ä»£ç ï¼Œæå¤§çš„æé«˜é›†åˆæ“ä½œçš„ç”Ÿäº§åŠ›ã€‚å¯ä»¥å°†è¦å¤„ç†çš„é›†åˆå…ƒç´ çœ‹ä½œä¸€ç§æµï¼Œæµåœ¨ç®¡é“ä¸­ä¼ è¾“ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ç®¡é“ä¼ è¾“çš„å„ä¸ªèŠ‚ç‚¹ä¸Šè¿›è¡Œç­›é€‰ã€æ’åºåŠèšåˆç­‰æ“ä½œã€‚æµåœ¨ç®¡é“ä¸­ç»è¿‡ä¸­é—´æ“ä½œï¼ˆintermediate operationï¼‰çš„å¤„ç†ï¼Œæœ€åç”±æœ€ç»ˆæ“ä½œï¼ˆterminal operationï¼‰å¾—åˆ°å‰é¢å¤„ç†çš„ç»“æœã€‚ Stream ç¤ºä¾‹12345678910111213141516171819202122232425262728293031public class StreamDemo &#123; public static void main(String[] args) &#123; List&lt;String&gt; peekList = Stream.of(\"one\", \"tow\", \"three\", \"four\", \"five\", \"six\", \"seven\") .filter(e -&gt; e.length() &gt; 3) // è¿‡æ»¤å‡ºå­—ç¬¦ä¸²é•¿åº¦å¤§äº 3 çš„å…ƒç´  .peek(e -&gt; System.out.println(\"Filtered value: \" + e)) .map(String::toUpperCase) // å°†å…ƒç´ è½¬ä¸ºå¤§å†™ .peek(e -&gt; System.out.println(\"Mapped value: \" + e)) .collect(Collectors.toList()); // å°†è¾“å‡º Stream è½¬æ¢ä¸º List System.out.println(\"é›†åˆæ‰“å°ï¼š\"); for (String string : peekList) &#123; System.out.println(string); &#125; &#125;&#125;// è¿è¡Œç»“æœFiltered value: threeMapped value: THREEFiltered value: fourMapped value: FOURFiltered value: fiveMapped value: FIVEFiltered value: sevenMapped value: SEVENé›†åˆæ‰“å°ï¼šTHREEFOURFIVESEVEN Stream åŸºç¡€ç‰¹æ€§ åŸºæœ¬æµç¨‹ï¼šæ•°æ®æºï¼ˆå­˜å‚¨ï¼‰ â†’ å…ƒç´ é˜Ÿåˆ—ï¼ˆStreamï¼‰ â†’ æ“ä½œï¼ˆfilterã€mapã€reduceã€findã€matchã€sorted ç­‰ï¼‰ Pipeliningï¼šä¸­é—´æ“ä½œéƒ½ä¼šè¿”å›æµå¯¹è±¡æœ¬èº«ã€‚è¿™æ ·å¤šä¸ªæ“ä½œå¯ä»¥ä¸²è”æˆä¸€ä¸ªç®¡é“ï¼Œ å¦‚åŒæµå¼é£æ ¼ï¼ˆfluent styleï¼‰ã€‚ è¿™æ ·åšå¯ä»¥å¯¹æ“ä½œè¿›è¡Œä¼˜åŒ–ï¼Œ æ¯”å¦‚å»¶è¿Ÿæ‰§è¡Œï¼ˆlazinessï¼‰å’ŒçŸ­è·¯ï¼ˆshort-circuitingï¼‰ï¼› å†…éƒ¨è¿­ä»£ï¼šä»¥å‰å¯¹é›†åˆéå†éƒ½æ˜¯é€šè¿‡ Iterator æˆ–è€… For-Each çš„æ–¹å¼, æ˜¾å¼çš„åœ¨é›†åˆå¤–éƒ¨è¿›è¡Œè¿­ä»£ï¼Œ è¿™å«åšå¤–éƒ¨è¿­ä»£ã€‚ Java Stream æä¾›äº†å†…éƒ¨è¿­ä»£çš„æ–¹å¼ï¼Œ é€šè¿‡è®¿é—®è€…æ¨¡å¼ï¼ˆVisitorï¼‰å®ç°ã€‚ Stream ä¸² / å¹¶è¡Œ","categories":[{"name":"åŸºç¡€çŸ¥è¯†","slug":"åŸºç¡€çŸ¥è¯†","permalink":"http://yoursite.com/categories/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"}],"tags":[{"name":"Java","slug":"Java","permalink":"http://yoursite.com/tags/Java/"}]},{"title":"WebSocket","slug":"åå°æŠ€æœ¯/Netty/WebSocket","date":"2020-02-17T04:12:30.000Z","updated":"2020-07-10T04:04:07.888Z","comments":true,"path":"2020/02/17/åå°æŠ€æœ¯/Netty/WebSocket/","link":"","permalink":"http://yoursite.com/2020/02/17/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/Netty/WebSocket/","excerpt":"WebSocket å…¥é—¨ä»‹ç»ä»¥åŠ Netty WebSocket åè®®å¼€å‘ã€‚","text":"WebSocket å…¥é—¨ä»‹ç»ä»¥åŠ Netty WebSocket åè®®å¼€å‘ã€‚ HTTP è¯·æ±‚ / å“åº”æ¨¡å¼ï¼šå®¢æˆ·ç«¯åŠ è½½ä¸€ä¸ªç½‘é¡µï¼Œç„¶åç›´åˆ°ç”¨æˆ·ç‚¹å‡»ä¸‹ä¸€é¡µä¹‹å‰ï¼Œä»€ä¹ˆéƒ½ä¸ä¼šå‘ç”Ÿã€‚ Ajaxï¼šç½‘ç»œå¼€å§‹å˜å¾—æ›´åŠ åŠ¨æ€äº†ï¼Œä½†æ‰€æœ‰çš„ HTTP é€šä¿¡ä»ç„¶ç”±å®¢æˆ·ç«¯æ§åˆ¶ï¼Œè¿™å°±éœ€è¦ç”¨æˆ·è¿›è¡Œäº’åŠ¨æˆ–å®šæœŸè½®è¯¢ï¼Œä»¥ä¾¿ä»æœåŠ¡å™¨åŠ è½½æ–°æ•°æ®ã€‚ é•¿æœŸä»¥æ¥å­˜åœ¨ç€å„ç§æŠ€æœ¯è®©æœåŠ¡å™¨å¾—çŸ¥æœ‰æ–°æ•°æ®å¯ç”¨æ—¶ï¼Œç«‹å³å°†æ•°æ®å‘é€åˆ°å®¢æˆ·ç«¯è¿™äº›æŠ€æœ¯ç§ç±»ç¹å¤šã€‚æœ€å¸¸ç”¨çš„ä¸€ç§é»‘å®¢æ‰‹æ®µæ˜¯å¯¹æœåŠ¡å™¨å‘èµ·é“¾æ¥åˆ›å»ºå‡è±¡ï¼Œè¢«ç§°ä¸ºé•¿è½®è¯¢ã€‚åˆ©ç”¨é•¿è½®è¯¢ï¼Œå®¢æˆ·ç«¯å¯ä»¥æ‰“å¼€æŒ‡å‘æœåŠ¡å™¨çš„ HTTP è¿æ¥ï¼Œè€ŒæœåŠ¡å™¨ä¼šä¸€ç›´ä¿æŒè¿æ¥æ‰“å¼€ï¼Œç›´åˆ°å‘é€å“åº”ã€‚æœåŠ¡å™¨åªè¦å®é™…æ‹¥æœ‰æ–°æ•°æ®ï¼Œå°±ä¼šå‘é€å“åº”ã€‚ é—®é¢˜ï¼šç”±äº HTTP åè®®çš„å¼€é”€ï¼Œå¯¼è‡´å®ƒä»¬ä¸é€‚ç”¨äºä½å»¶è¿Ÿåº”ç”¨ã€‚ WebSocketï¼šå°†ç½‘ç»œå¥—æ¥å­—å¼•å…¥åˆ°äº†å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ¥è§£å†³è¿™ä¸€é—®é¢˜ï¼Œæµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´å¯ä»¥é€šè¿‡å¥—æ¥å­—å»ºç«‹æŒä¹…çš„è¿æ¥ï¼ŒåŒæ–¹éšæ—¶éƒ½å¯ä»¥äº’å‘æ•°æ®ç»™å¯¹æ–¹ï¼Œè€Œä¸æ˜¯ä¹‹å‰ç”±å®¢æˆ·ç«¯æ§åˆ¶çš„ä¸€è¯·æ±‚ä¸€åº”ç­”æ¨¡å¼ã€‚ WebSocket å…¥é—¨åœ¨ WebSocket API ä¸­ï¼Œæµè§ˆå™¨å’ŒæœåŠ¡å™¨åªéœ€è¦åšä¸€ä¸ªæ¡æ‰‹çš„åŠ¨ä½œï¼Œç„¶åï¼Œæµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´å°±å½¢æˆäº†ä¸€æ¡å¿«é€Ÿé€šé“ï¼Œä¸¤è€…å°±å¯ä»¥ç›´æ¥äº’ç›¸ä¼ é€æ•°æ®äº†ã€‚WebSocket åŸºäº TCP åŒå‘å…¨åŒå·¥è¿›è¡Œæ¶ˆæ¯ä¼ é€’ï¼Œåœ¨åŒä¸€æ—¶åˆ»ï¼Œæ—¢å¯ä»¥å‘é€æ¶ˆæ¯ï¼Œä¹Ÿå¯ä»¥æ¥æ”¶æ¶ˆæ¯ï¼Œç›¸æ¯”äº HTTP çš„åŠåŒå·¥åè®®ï¼Œæ€§èƒ½å¾—åˆ°å¾ˆå¤§æå‡ã€‚ WebSocket è¿æ¥å»ºç«‹ WebSocket è¿æ¥æ—¶ï¼Œéœ€è¦é€šè¿‡å®¢æˆ·ç«¯æˆ–è€…æµè§ˆå™¨å‘å‡ºæ¡æ‰‹è¯·æ±‚ã€‚ æ¡æ‰‹è¯·æ±‚æ¶ˆæ¯å¦‚ä¸‹ï¼š ä¸ºäº†å»ºç«‹ä¸€ä¸ª WebSocket è¿æ¥ï¼Œå®¢æˆ·ç«¯æµè§ˆå™¨é¦–å…ˆè¦å‘æœåŠ¡å™¨å‘èµ·ä¸€ä¸ª HTTP è¯·æ±‚ï¼Œè¿™ä¸ªè¯·æ±‚å’Œé€šå¸¸çš„ HTTP è¯·æ±‚ä¸åŒï¼ŒåŒ…å«äº†ä¸€äº›é™„åŠ å¤´ä¿¡æ¯ï¼Œå…¶ä¸­é™„åŠ å¤´ä¿¡æ¯ Upgrade: WebSocketè¡¨æ˜è¿™æ˜¯ä¸€ä¸ªç”³è¯·åè®®å‡çº§çš„ HTTP è¯·æ±‚ã€‚æœåŠ¡å™¨ç«¯è§£æè¿™äº›é™„åŠ çš„å¤´ä¿¡æ¯ï¼Œç„¶åç”Ÿæˆåº”ç­”ä¿¡æ¯è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯çš„ WebSocket è¿æ¥å°±å»ºç«‹èµ·æ¥äº†ï¼ŒåŒæ–¹å¯ä»¥é€šè¿‡è¿™ä¸ªè¿æ¥é€šé“è‡ªç”±åœ°ä¼ é€’ä¿¡æ¯ï¼Œå¹¶ä¸”è¿™ä¸ªè¿æ¥ä¼šæŒç»­å­˜åœ¨ç›´åˆ°å®¢æˆ·ç«¯æˆ–è€…æœåŠ¡å™¨ç«¯çš„æŸä¸€æ–¹ä¸»åŠ¨å…³é—­è¿æ¥ã€‚ æ¡æ‰‹åº”ç­”æ¶ˆæ¯å¦‚ä¸‹ï¼š è¯·æ±‚æ¶ˆæ¯ä¸­çš„Sec-WebSocket-Keyæ˜¯éšæœºçš„,æœåŠ¡å™¨ç«¯ä¼šç”¨è¿™äº›æ•°æ®æ¥æ„é€ å‡ºä¸€ä¸ª SHA-1 çš„ä¿¡æ¯æ‘˜è¦ã€‚ä½¿ç”¨ SHA-1 åŠ å¯†,ç„¶åè¿›è¡Œ BASE-64 ç¼–ç ï¼Œå°†ç»“æœåšä¸ºSec- WebSocket- Acceptå¤´çš„å€¼ï¼Œè¿”å›ç»™å®¢æˆ·ç«¯ã€‚ WebSocket ç”Ÿå‘½å‘¨æœŸæ¡æ‰‹æˆåŠŸä¹‹å,æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯å°±å¯ä»¥é€šè¿‡ messages çš„æ–¹å¼è¿›è¡Œé€šä¿¡äº†ï¼Œä¸€ä¸ªæ¶ˆæ¯ç”±ä¸€ä¸ªæˆ–è€…å¤šä¸ªå¸§ç»„æˆï¼ŒWebSocketçš„æ¶ˆæ¯å¹¶ä¸ä¸€å®šå¯¹åº”ä¸€ä¸ªç‰¹å®šç½‘ç»œå±‚çš„å¸§ï¼Œå®ƒå¯ä»¥è¢«åˆ†å‰²æˆå¤šä¸ªå¸§æˆ–è€…è¢«åˆå¹¶ã€‚ WebSocket çš„æ¡æ‰‹å…³é—­æ¶ˆæ¯å¸¦æœ‰ä¸€ä¸ªçŠ¶æ€ç å’Œä¸€ä¸ªå¯é€‰çš„å…³é—­åŸå› ï¼Œå®ƒå¿…é¡»æŒ‰ç…§åè®®è¦æ±‚å‘é€ä¸€ä¸ª Close æ§åˆ¶å¸§ï¼Œå½“å¯¹ç«¯æ¥æ”¶åˆ°å…³é—­æ§åˆ¶å¸§æŒ‡ä»¤æ—¶ï¼Œéœ€è¦ä¸»åŠ¨å…³é—­ WebSocketè¿æ¥ã€‚ Netty WebSocket åè®®å¼€å‘Netty åŸºäº HTTP åè®®æ ˆå¼€å‘äº† WebSocket åè®®æ ˆ,åˆ©ç”¨ Netty çš„ WebSocket åè®®æ ˆå¯ä»¥éå¸¸æ–¹ä¾¿åœ°å¼€å‘å‡º WebSocket å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ã€‚ Netty æœåŠ¡ç«¯å®ä¾‹åŠŸèƒ½ä»‹ç» æ”¯æŒ WebSocket çš„æµè§ˆå™¨é€šè¿‡ WebSocket åè®®å‘é€è¯·æ±‚æ¶ˆæ¯ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯å¯¹è¯·æ±‚æ¶ˆæ¯è¿›è¡Œåˆ¤æ–­ï¼› å¦‚æœæ˜¯åˆæ³•çš„ WebSocket è¯·æ±‚,åˆ™è·å–è¯·æ±‚æ¶ˆæ¯ä½“ï¼ˆæ–‡æœ¬ï¼‰å¹¶åœ¨åé¢è¿½åŠ å­—ç¬¦ä¸²â€œæ¬¢è¿ä½¿ç”¨ Netty WebSocketæœåŠ¡,ç°åœ¨æ—¶åˆ»:[ç³»ç»Ÿæ—¶é—´]â€ï¼› å®¢æˆ·ç«¯ HTML é€šè¿‡å†…åµŒçš„ JS è„šæœ¬åˆ›å»º WebSocket è¿æ¥ï¼Œæ¡æ‰‹æˆåŠŸ / å¤±è´¥ï¼Œåœ¨æ–‡æœ¬æ¡†ä¸­æ‰“å°â€œæ‰“å¼€ Web SocketæœåŠ¡æ­£å¸¸,æµè§ˆå™¨æ”¯æŒ Web Socket!â€ / â€œæŠ±æ­‰ï¼Œæ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒ Web Socketåè®®!â€ã€‚ åŠŸèƒ½å¼€å‘12345678&lt;!-- pom.xml --&gt;&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;io.netty&lt;/groupId&gt; &lt;artifactId&gt;netty-all&lt;/artifactId&gt; &lt;version&gt;5.0.0.Alpha1&lt;/version&gt; &lt;/dependency&gt;&lt;/dependencies&gt; 12345678910111213141516171819202122232425262728293031323334353637383940414243444546// WebSocket æœåŠ¡ç«¯å¯åŠ¨ç±»public class WebSocketServer&#123; public void run(int port) throws Exception&#123; EventLoopGroup bossGroup = new NioEventLoopGroup (); EventLoopGroup workerGroup = new NioEventLoopGroup(); try &#123; ServerBootstrap b= new ServerBootstrap(); b.group(bossGroup, workerGroup) .channel(NioServerSocketChannel.class) .childHandler(new ChannelInitializer&lt;SocketChannel&gt;() &#123; @Override protected void initChannel(SocketChannel ch) throws Exception &#123; ChannelPipeline pipeline = ch.pipeline (); // å°†è¯·æ±‚å’Œåº”ç­”æ¶ˆæ¯ç¼–ç  / è§£ç ä¸º HTTP æ¶ˆæ¯ pipeline.addLast(\"http-codec\", new HttpServerCodec()); // å°† HTTP æ¶ˆæ¯çš„å¤šä¸ªéƒ¨åˆ†ç»„åˆæˆä¸€æ¡å®Œæ•´çš„ HTTP æ¶ˆæ¯ pipeline.addLast (\"aggregator\", new HttpObjectAggregator(65536)); // ä¸»è¦ç”¨äºæ”¯æŒæµè§ˆå™¨å’ŒæœåŠ¡ç«¯è¿›è¡Œ WebSocket é€šä¿¡ ch.pipeline().addLast(\"http-chunked\", new ChunkedWriteHandler()); // å¢åŠ  WebSocket æœåŠ¡ç«¯ handler pipeline.addLast(\"handler\", new WebSocketServerHandler()); &#125; &#125;); Channel ch = b.bind(port).sync().channel(); System.out.println(\"Web socket server started at port\" + port +'.'); System.out.println (\"Open our browser and navigate to http://localhost:\" + port + '/'); ch.closeFuture().sync(); &#125; finally &#123; bossGroup. shutdownGracefully(); workerGroup. shutdownGracefully(); &#125; &#125; public static void main(String[] args) throws Exception &#123; int port = 8080; if (args.length &gt;0) &#123; try&#123; port = Integer.parseInt(args[0]); &#125; catch(NumberFormatException e) &#123; e.printStackTrace(); &#125; &#125; new WebSocketServer().run(port); &#125;&#125; 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889// Websocket æœåŠ¡ç«¯å¤„ç†ç±»public class WebSocketServerHandler extends SimpleChannelInboundHandler&lt;Object&gt; &#123; private static final Logger logger = Logger.getLogger(WebSocketServerHandler.class.getName()); private WebSocketServerHandshaker handshaker; @Override protected void messageReceived(ChannelHandlerContext ctx, Object msg) throws Exception &#123; // ä¼ ç»Ÿçš„ HTTP æ¥å…¥ if (msg instanceof FullHttpRequest)&#123; // åˆ¤æ–­è¯·æ±‚æ¶ˆæ¯æœ‰ä¸­æ˜¯å¦åŒ…å« Upgrade: websocket handleHttpRequest(ctx,(FullHttpRequest)msg); &#125;// WebSocket æ¥å…¥ else if (msg instanceof WebSocketFrame)&#123; handleWebSocketFrame(ctx,(WebSocketFrame)msg); &#125; &#125; private void handleHttpRequest(ChannelHandlerContext ctx, FullHttpRequest req) throws Exception&#123; // å¦‚æœ HTTP è§£ç å¤±è´¥ï¼Œè¿”å› HTTP 400 å“åº”å¼‚å¸¸ if (!req.getDecoderResult().isSuccess() || (!\"websocket\".equals(req.headers().get(\"Upgrade\"))))&#123; sendHttpResponse(ctx, req,new DefaultFullHttpResponse(HttpVersion.HTTP_1_1, HttpResponseStatus.BAD_REQUEST)); return; &#125; // æ„é€ æ¡æ‰‹å·¥å‚ï¼Œæœ¬æœºæµ‹è¯• WebSocketServerHandshakerFactory wsFactory = new WebSocketServerHandshakerFactory(\"ws://localhost:8080/websocket\",null,false); // åˆ›å»ºæ¡æ‰‹å¤„ç†ç±» handshaker = wsFactory.newHandshaker(req); if (handshaker == null)&#123; WebSocketServerHandshakerFactory.sendUnsupportedWebSocketVersionResponse(ctx.channel()); &#125;else &#123; // æ„é€ æ¡æ‰‹å“åº”æ¶ˆæ¯è¿”å›ç»™å®¢æˆ·ç«¯ // å°† WebSocket ç›¸å…³çš„ç¼–ç å’Œè§£ç ç±»åŠ¨æ€æ·»åŠ åˆ° ChannelPipeline ä¸­ç”¨äº WebSocket æ¶ˆæ¯çš„ç¼–è§£ç  handshaker.handshake(ctx.channel(),req); &#125; &#125; // é“¾è·¯å»ºç«‹æˆåŠŸä¹‹ååˆ†åˆ«å¯¹æ§åˆ¶å¸§è¿›è¡Œåˆ¤æ–­ private void handleWebSocketFrame(ChannelHandlerContext ctx, WebSocketFrame frame) &#123; // åˆ¤æ–­æ˜¯å¦å…³é—­é“¾è·¯æŒ‡ä»¤ if (frame instanceof CloseWebSocketFrame)&#123; handshaker.close(ctx.channel(), (CloseWebSocketFrame) frame.retain()); return; &#125; // åˆ¤æ–­æ˜¯å¦æ˜¯ç»´æŒé“¾è·¯çš„ Ping æ¶ˆæ¯ if (frame instanceof PingWebSocketFrame)&#123; // æ„é€  pong æ¶ˆæ¯è¿”å› ctx.channel().write(new PongWebSocketFrame(frame.content()).retain()); return; &#125; // æœ¬ä¾‹ç¨‹ä»…æ”¯æŒæ–‡æœ¬ä¿¡æ¯ï¼Œæ•…å¯¹éæ–‡æœ¬æ¶ˆæ¯æŠ›å‡ºå¼‚å¸¸ if (!(frame instanceof TextWebSocketFrame))&#123; throw new UnsupportedOperationException(String.format(\"%s frame types not supported\",frame.getClass().getName())); &#125; // è¿”å›åº”ç­”æ¶ˆæ¯ String request = ((TextWebSocketFrame) frame).text(); if (logger.isLoggable(Level.FINE))&#123; logger.fine(String.format(\"%s received %s\",ctx.channel(),request)); &#125; // æ„é€ æ–°çš„ TextWebSocketFrame æ¶ˆæ¯è¿”å›ç»™å®¢æˆ·ç«¯ // ç”±äºæ¡æ‰‹åº”ç­”æ—¶åŠ¨æ€å¢åŠ äº† TextWebSocketframe çš„ç¼–ç ç±»,æ‰€ä»¥å¯ä»¥ç›´æ¥å‘é€ TextWebSocketFrameå¯¹è±¡ ctx.channel().write(new TextWebSocketFrame(request+\"æ¬¢è¿ä½¿ç”¨Netty WebSocketæœåŠ¡ï¼Œç°åœ¨æ—¶åˆ»:\" + new Date().toString())); &#125; private static void sendHttpResponse(ChannelHandlerContext ctx,FullHttpRequest req,FullHttpResponse res)&#123; // è¿”å›åº”ç­”ç»™å®¢æˆ·ç«¯ if (res.getStatus().code() != 200)&#123; ByteBuf buf = Unpooled.copiedBuffer(res.getStatus().toString(), CharsetUtil.UTF_8); res.content().writeBytes(buf); // æ˜ç¡®é‡Šæ”¾ByteBufçš„å¼•ç”¨è®¡æ•° buf.release(); setContentLength(res,res.content().readableBytes()); &#125; // å¦‚æœæ˜¯é Keep-Aliveï¼Œå…³é—­è¿æ¥ ChannelFuture f = ctx.channel().writeAndFlush(res); if (!isKeepAlive(req) || res.getStatus().code() != 200)&#123; f.addListener(ChannelFutureListener.CLOSE); &#125; &#125; @Override public void channelReadComplete(ChannelHandlerContext ctx) throws Exception &#123; ctx.flush(); &#125; @Override public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception &#123; cause.printStackTrace(); ctx.close(); &#125;&#125; 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091&lt;html&gt; &lt;head&gt; &lt;meta charset=\"utf-8\"&gt; &lt;title&gt;WebSoket Demo&lt;/title&gt; &lt;script type=\"text/JavaScript\"&gt; var WebSocket = WebSocket || window.WebSocket || window.MozWebSocket; if (!WebSocket) &#123; alert(\"WebSocket not supported by this browser!\"); &#125; else &#123; var ws = null; function Display() &#123; console.log(\"websocket æµ‹è¯•\"); &#125; var log = function (s) &#123; if (document.readyState !== \"complete\") &#123; log.buffer.push(s); &#125; else &#123; document.getElementById(\"contentId\").value += (s + \"/n\"); &#125; &#125; function CreateConnect () &#123; var msg = document.getElementById(\"wsUrlId\"); console.log(\"CreateConnect(), url: \" + msg.value); if (ws == null) &#123; var wsUrlValue = msg.value; try &#123; ws = new WebSocket(wsUrlValue); ws.onmessage = function (event) &#123; log(\"onmessage(), æ¥æ”¶åˆ°æœåŠ¡å™¨æ¶ˆæ¯: \" + event.data); &#125;; ws.onclose = function (event) &#123; log(\"onclose(), Socket å·²å…³é—­!\"); ws = null; &#125;; ws.onopen = function (event) &#123; log(\"onopen(), Socket è¿æ¥æˆåŠŸ!\"); &#125;; ws.onerror = function (event) &#123; &#125;; &#125; catch (e) &#123; ws = null; log(\"è¿æ¥å¼‚å¸¸, é‡ç½® websocket\"); &#125; &#125; &#125; function SendMsg() &#123; var msg = document.getElementById(\"messageId\"); console.log(\"SendMsg(), msg: \" + msg.value); if (ws != null) &#123; log(\"å‘é€ Socket æ¶ˆæ¯: \" + msg.value); ws.send(msg.value); &#125; else &#123; log(\"Socket è¿˜æœªåˆ›å»º!, msg: \" + msg.value); &#125; &#125; function CloseConnect () &#123; console.log(\"CloseConnect()\"); if (ws != null) &#123; ws.close(); &#125; &#125; &#125; &lt;/script&gt; &lt;/head&gt; &lt;body onload=\"Display()\" &gt; &lt;div id=\"valueLabel\"&gt;&lt;/div&gt; &lt;textarea rows=\"10\" cols=\"40\" id=\"contentId\"&gt;&lt;/textarea&gt; &lt;br/&gt; &lt;input name=\"wsUrl\" id=\"wsUrlId\" value=\"ws://localhost:8080/websocket\"/&gt; &lt;button id=\"createButton\" onClick=\"javascript:CreateConnect()\"&gt;Create&lt;/button&gt; &lt;button id=\"closeButton\" onClick=\"javascript:CloseConnect()\"&gt;Close&lt;/button&gt; &lt;br/&gt; &lt;input name=\"message\" id=\"messageId\" value=\"Hello, Server!\"/&gt; &lt;button id=\"sendButton\" onClick=\"javascript:SendMsg()\"&gt;Send&lt;/button&gt; &lt;/body&gt;&lt;/html&gt; æµ‹è¯•ç»“æœæ§åˆ¶å°æ‰“å° æµè§ˆå™¨è°ƒè¯•","categories":[{"name":"åå°æŠ€æœ¯","slug":"åå°æŠ€æœ¯","permalink":"http://yoursite.com/categories/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"Netty","slug":"Netty","permalink":"http://yoursite.com/tags/Netty/"},{"name":"WebSocket","slug":"WebSocket","permalink":"http://yoursite.com/tags/WebSocket/"}]},{"title":"2020 è¯»ä¹¦ç¬”è®°","slug":"ç”Ÿæ´»æ‚è®°/è¯»ä¹¦ç¬”è®°","date":"2020-02-16T14:22:10.000Z","updated":"2020-07-10T04:10:04.004Z","comments":true,"path":"2020/02/16/ç”Ÿæ´»æ‚è®°/è¯»ä¹¦ç¬”è®°/","link":"","permalink":"http://yoursite.com/2020/02/16/%E7%94%9F%E6%B4%BB%E6%9D%82%E8%AE%B0/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/","excerpt":"ä¹¦ç±æ‘˜è¦ä»¥åŠæ„Ÿæ‚Ÿã€‚","text":"ä¹¦ç±æ‘˜è¦ä»¥åŠæ„Ÿæ‚Ÿã€‚ æƒ…ç»ªæ²Ÿé€šï¼šæ”¹å˜çœ‹æ³•ä¸è‡ªæˆ‘è®¤çŸ¥ åº•å±‚é€»è¾‘ æ³•å¾‹ ğŸ‘‰ å°†ä¸è§„åˆ™çš„ç”Ÿæ´»çŠ¶æ€æ”¾å…¥åˆ°ä¸€ä¸ªè§„åˆ™çš„å®¹å™¨ä¸­ ğŸ‘‰ å¦‚ä½•å¤„ç†â€œæº¢å‡ºâ€çš„éƒ¨åˆ†ï¼Ÿ ç¾å­¦ ğŸ‘‰ å¼•èµ·å…±é¸£ ğŸ‘‰ å¦‚ä½•è®©è§‚è€…æ„Ÿå—åˆ°ä½œè€…æ‰€è¦ä¼ è¾¾çš„æƒ…ç»ªï¼Ÿ æ²Ÿé€š ğŸ‘‰ è¯´æœ ğŸ‘‰ æ²¡æœ‰äººå–œæ¬¢è¢«æ”¹å˜ â— äººçš„è§‚ç‚¹çœ‹æ³• = è¿‡å»çš„é€‰æ‹© + è¿‡å»çš„åå¥½ è®²é“ç† / å‘½ä»¤å¼è¯´æ•™ ğŸ‘‰ å¦å®šä¸€ä¸ªçš„è¿‡å» ğŸ‘‰ æœ¬èƒ½æŠ—æ‹’ ğŸ‘ å¼•èµ·å…±é¸£ ğŸ‘ ç»™äºˆé€‰æ‹©æƒ ğŸ‘‰ é€‰æ‹©æƒè¯­å¥ / éšæ—¶å¯ä»¥åæ‚” ğŸ‘ æˆ‘éœ€è¦ ä½ ä¸ºä»€ä¹ˆè¦ äººçš„æƒ…ç»ª ğŸ‘‰ å¾ˆå¤§ç¨‹åº¦å†³å®šé€‰æ‹© ğŸ‘‰ æ·±æŒ–æƒ…ç»ªï¼šè¿™ä»¶äº‹å¯¹ä½ æ¥è¯´æ„å‘³ç€ä»€ä¹ˆï¼Ÿ ğŸ‘‰ æ ¹æ®æƒ…ç»ªå¯»æ‰¾è§£å†³åŠæ³• ğŸ‘ æ„¤æ€’ ğŸ‘‰ å¼ºåŒ–ç°æœ‰æƒ³æ³• æƒŠè®¶ ğŸ‘‰ åŠ¨æ‘‡ç°æœ‰çœ‹æ³• æ‚²ä¼¤ ğŸ‘‰ æ‰¾åˆ°é‡è¦çœ‹æ³• é—®é¢˜çš„ç†è§£ æœŸå¾…ä¸ç°å®çš„è½å·® ğŸ‘‰ æ˜¯å¦åˆç† ä½ çœ¼ä¸­çš„é—®é¢˜æ˜¯åˆ«äººçš„è§£å†³æ–¹æ¡ˆ æ¢è§’åº¦æ€è€ƒé—®é¢˜ ğŸ‘‰ åˆ«å±€é™äºè‡ªèº« äº§å“ç»ç†å››ä¸ªç»´åº¦ï¼šäº§å“ã€ç”¨æˆ·ã€åœºæ™¯ã€æ•ˆç‡ã€‚ äº§å“åŠŸèƒ½ï¼Ÿ ğŸ‘‰ æœåŠ¡ç‰¹æ€§ ATM æœºçš„æ˜¾æ€§ç‰¹æ€§ï¼šå–é’± ATM æœºçš„éšå½¢ç‰¹æ€§ï¼šåˆ†æµçª—å£å‹åŠ›ã€å“ç‰Œæ•ˆåº”ã€æ— åˆ©æ¯çš„ç°é‡‘å¤–å­˜â€¦ï¼ˆè¿è¥åšå¤§é‡çš„å¸‚åœºè°ƒæŸ¥ï¼‰ äº§å“èƒ½å¦è¾¾æˆæˆ˜ç•¥è¿°æ±‚ä»¥åŠèƒ½å¦æŒç»­çš„æä¾›æœåŠ¡ ğŸ‘‰ èµ„æºçš„æœ‰é™æ€§ ğŸ‘‰ å–èˆ ç”¨æˆ· ğŸ‘‰ åˆ†å±‚ã€ç”¨æˆ·ç”»åƒ ğŸ‘‰ ä¸åŒç¾¤ä½“æœ‰ä¸åŒçš„æœåŠ¡éœ€æ±‚ã€ç”¨æˆ·ç‰¹æ€§å½±å“å†³å®šæ–¹å¼ åŒç¨‹è‰ºé¾™ VS ç¾å›¢é…’åº— åœºæ™¯ ğŸ‘‰ æ—¶é—´ã€ç©ºé—´ã€æƒ…ç»ª æƒ…ç»ªçš„åŠ›é‡ ğŸ‘‰ æ¬²æœ› ğŸ‘‰å¤§ç”©å– è‡ªæˆ‘ä¸è‡ªåˆ¶äºŒè€…ä¸å¯å…±å­˜ ğŸ‘‰ æ¢å¯»è‡ªæˆ‘ï¼Œé€‰æ‹©é€‚åˆè‡ªå·±çš„ä¸€é¢ åå ‚æç®€æ¦‚ç‡è¯¾æ¦‚ç‡æ˜¯å¯ä»¥æµ‹é‡çš„æ€è€ƒï¼šäººä»¬å¦‚ä½•è¿›è¡Œæµ‹é‡ï¼Ÿ åœ¨ä¸€å¼€å§‹ï¼Œäººä»¬ç”¨è„šåº¦é‡é•¿åº¦ï¼Œè¿™å¿…ç„¶å­˜åœ¨ä¸€å®šçš„è¯¯å·®ï¼Œä½†è‹¥äººçš„æ•°é‡è¶³å¤Ÿå¤šï¼Œé‚£ä¹ˆè¿™ä¸ªè¯¯å·®å°†åœ¨ä¸€å®šç¨‹åº¦ä¸Šæœ‰æ‰€å‡å°ï¼›åæ¥å‡ºç°äº†é‡å°ºç­‰æµ‹é‡å·¥å…·ï¼Œä¸åŒç²¾åº¦çš„æµ‹é‡å·¥å…·ä¹Ÿå­˜åœ¨ä¸åŒç¨‹åº¦çš„è¯¯å·®ã€‚æ€»çš„æ¥è®²ï¼Œæµ‹é‡æ˜¯ä¸€ä¸ªä¸æ–­ç²¾è¿›çš„è¿‡ç¨‹ã€‚ æ¦‚ç‡çš„æµ‹åº¦åŒæ ·å¦‚æ­¤ã€‚åœ¨æµ‹åº¦ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆè¦æ‰¾åˆ°ï¼ˆæˆ–è€…åˆ¶é€ ï¼‰åŒç­‰å¯èƒ½æ€§çš„æƒ…å†µï¼Œç„¶åè®¡æ•°è¿™äº›æƒ…å†µå‘ç”Ÿçš„æ¬¡æ•°ã€‚äºæ˜¯ï¼Œäº‹ä»¶Açš„æ¦‚ç‡ï¼Œè®°ä½œP(A)ï¼Œä¸º ç”±ä¸Šè¿°å…¬å¼å¯ä»¥ä½œå‡ºä»¥ä¸‹æ¨æ–­ï¼š æ¦‚ç‡æ°¸è¿œä¸ä¼šæ˜¯è´Ÿå€¼ï¼› å¦‚æœæ‰€æœ‰å¯èƒ½å‘ç”Ÿçš„æƒ…å†µä¸­å‡åŒ…å«äº‹ä»¶ Aï¼Œåˆ™ P(A)=1ï¼› å¦‚æœäº‹ä»¶ A å’Œäº‹ä»¶ B ä¸ä¼šåŒæ—¶å‘ç”Ÿï¼ˆå³ç›¸äº’ç‹¬ç«‹äº‹ä»¶ï¼‰ï¼Œåˆ™P(AâˆªB) = P(A)+P(B)ï¼› åœ¨ A å‘ç”Ÿæ¡ä»¶ä¸‹ B çš„å‘ç”Ÿæ¦‚ç‡ç­‰äº B ä¸ A åŒæ—¶å‘ç”Ÿçš„æƒ…å†µæ•°é‡é™¤ä»¥ A å‘ç”Ÿçš„æƒ…å†µæ•°é‡ï¼Œå³P(Aâˆ©B)=P(A)P(B|A)ã€‚å¦‚æœ A å’Œ B ç›¸äº’ç‹¬ç«‹ï¼Œå³P(B|A)=P(B)ï¼Œåˆ™P(Aâˆ©B)=P(A)P(B)ã€‚ æ­¤å¤–ï¼ŒæŸä¸ªäº‹ä»¶ä¸ä¼šå‘ç”Ÿçš„æ¦‚ç‡ç­‰äº1ä¸è¯¥äº‹ä»¶å‘ç”Ÿæ¦‚ç‡çš„å·®ï¼šP(!A) = 1â€“P(A)ã€‚ï¼ï¼ï¼è¿™ä¸ªå¾ˆé‡è¦ï¼Œæœ‰æ—¶å€™æ­£å‘æ“ä½œä¸è¡Œå°±å¤§èƒ†çš„åå‘æ“ä½œä¸€æ³¢å§ï¼ æœŸæœ›å€¼ æœŸæœ›å€¼å°±æ˜¯æ¦‚ç‡çš„åŠ æƒå¹³å‡ã€‚æœŸæœ›å€¼å¯ä»¥æ ¹æ®å„ç§ç»“æœå‡ºç°çš„æ¦‚ç‡æ¥è¡¡é‡å®ƒä»¬çš„æˆæœ¬ä¸æ”¶ç›Šæƒ…å†µï¼Œè¿™ä¸ä»…æœ‰åŠ©äºè®¡ç®—ï¼Œè¿˜æ˜¯å…¬å¹³æ€§å’Œä»·å€¼çš„è¡¡é‡æ–¹æ³•ã€‚ éª°å­é—®é¢˜ï¼šä¸€åç©å®¶éœ€è¦åœ¨8æ¬¡æŠ›æ·éª°å­çš„èµŒå±€ä¸­æ·å‡ºä¸€ä¸ª6ç‚¹ã€‚æ­¤æ—¶ï¼ŒæŠ•æ³¨é‡‘é¢å·²ç»ç¡®å®šï¼Œè¿™åç©å®¶å·²ç»æŠ›æ·äº†3æ¬¡ï¼Œä½†æ²¡æœ‰ä¸€æ¬¡æ˜¯6ç‚¹ã€‚å¦‚æœä»èµŒæ³¨ä¸­æ‹¿å‡ºä¸€å®šæ¯”ä¾‹çš„é’±ç»™è¿™åç©å®¶ï¼Œè®©ä»–æ”¾å¼ƒç¬¬4æ¬¡çš„æŠ›æ·æœºä¼šï¼ˆä»…æ”¾å¼ƒè¿™ä¸€æ¬¡ï¼‰ï¼Œé‚£ä¹ˆç»™ä»–å¤šå°‘é’±æ‰ç®—å…¬å¹³ï¼Ÿ è¿™ä¸ªé—®é¢˜å…¶å®å°±æ˜¯ä¸€ä¸ªæœ‰å…³äºæœŸæœ›å€¼çš„é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè‹¥ç©å®¶ä¸æ”¾å¼ƒè¿™ä¸€æ¬¡çš„æŠ›æ·ï¼Œåœ¨æ¥ä¸‹æ¥5æ­¤æŠ•æ·ä¸­ï¼Œæ¯ä¸€æ¬¡çš„æœŸæœ›æ”¶å…¥æ˜¯å¤šå°‘å‘¢ï¼Ÿå³å¤šå°‘é’±å¯ä»¥å¾ˆå…¬å¹³çš„æŠµæ¶ˆåˆ°è¿™ä¸€æ¬¡æŠ›æ·çš„æ”¶ç›Šã€‚ ç©å®¶ä»å‰©ä½™5æ¬¡æœºä¼šï¼Œå‡è®¾èµŒæ³¨ä¸ºSï¼Œå› ä¸ºèµŒæ³¨åœ¨ç¬¬4æ¬¡æŠ›æ·éª°å­æ—¶æ·å‡º6ç‚¹çš„å¯èƒ½æ€§ä¸º1/6ï¼Œæ‰€ä»¥ç¬¬4æ¬¡æŠ›æ·çš„åŠ æƒå¹³å‡å³ä¸º(1/6)*Sï¼›å‰©ä¸‹çš„4æ¬¡æŠ•æŠ›æ·çš†æœªå‡ºç°ç‚¹æ•°6çš„æ¦‚ç‡ä¸º(5/6)^4=P(A)ï¼Œæ‰€ä»¥æ»´4æ¬¡æŠ›æ·ç‚¹æ•°ä¸ä¸º6å¹¶ä¸”ä¹‹åçš„æŠ›æ·å‡ºç°ä¸€æ¬¡ç‚¹æ•°ä¸º6çš„æ¦‚ç‡ä¸º(5/6)(1-P(A))=P(B)ï¼Œå³åŠ æƒå¹³å‡ä¸ºP(B)*Sã€‚ ä»ç»“æœå¯ä»¥çœ‹å‡ºï¼Œå¯¹èµŒæ³¨çš„åŠ æƒå¹³å‡å¯ä»¥å¾—å‡ºæ¯ç§æƒ…å†µä¸‹çš„å…¬å¹³åˆ†é…ï¼Œæ­¤æ—¶ç»™ç©å®¶é‡‘é¢(1/6)Så°±æ˜¯å…¬å¹³çš„ã€‚ ç›¸å…³æ€§åˆ¤æ–­å°±æ˜¯æ¦‚ç‡ä»å¸‚åœºå…¥æ‰‹ï¼Œå…ˆè¦å‡è®¾é‡‘é’±æ˜¯ä»·å€¼çš„é‡åº¦ã€‚æœ‰äº†è¿™ä¸ªå…ˆå†³æ¡ä»¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ç›´æˆªäº†å½“çš„æ–¹å¼ä¼°ç®—åˆ¤æ–­æ¦‚ç‡ï¼ˆjudgmental probabilityï¼‰ï¼Œå¹¶æ¨æ–­è¿™äº›å…·æœ‰ç›¸å…³æ€§çš„åˆ¤æ–­çš„æ•°å­¦ç»“æ„ã€‚ç¬¬äºŒéƒ¨åˆ†åˆ™èˆå¼ƒäº†è¿™ä¸ªå‡è®¾å‰æï¼Œè¿›è¡Œäº†æ›´å…·ä¸€èˆ¬æ€§çš„åˆ†æã€‚è¿™æ ·ä¸€æ¥ï¼Œæ¦‚ç‡å’Œæ•ˆç”¨éƒ½æ˜¯å¯ä»¥æµ‹é‡çš„ä¼Ÿå¤§æ€æƒ³å°±å®Œæ•´äº†ã€‚ èµŒåšä¸åˆ¤æ–­æ¦‚ç‡ å¦‚æœèµŒå±€ç»“æœä¸º A æ—¶çš„æ”¶ç›Šä¸º1ï¼Œåä¹‹ä¸º0ï¼ŒA çš„æ¦‚ç‡å°±æ˜¯è¯¥èµŒå±€çš„æœŸæœ›å€¼ã€‚ å¦‚æœä½ ä¸ºè¯¥èµŒå±€æ”¯ä»˜çš„ä»·æ ¼ç­‰äº P(A)ï¼Œè¿™å¯ä»¥è¢«è§†ä¸ºä¸€æ¬¡ç­‰ä»·äº¤æ˜“ã€‚å¦‚æœä»·æ ¼ä½äº P(A)ï¼Œä½ å°±ä¼šæ„¿æ„ä¹°å…¥ï¼›å¦‚æœä»·æ ¼é«˜äº P(A)ï¼Œä½ è‚¯å®šä¸æ„¿æ„ä¹°å…¥ã€‚å› æ­¤ï¼Œæ ¹æ®ä½ çš„ä»·æ ¼å¹³è¡¡ç‚¹ï¼Œå°±å¯ä»¥æµ‹ç®—å‡ºä½ å¯¹ A çš„åˆ¤æ–­æ¦‚ç‡ã€‚ ä»¥ä¸Šçš„æè¿°ä¸­å‰è€…æ˜¯å¸•æ–¯å¡ä¸è´¹é©¬æå‡ºçš„æ–¹æ³•ï¼Œé€šè¿‡æ¦‚ç‡æ¥è®¡ç®—æœŸæœ›å€¼ï¼›è€Œåè€…æ˜¯æƒ æ›´æ–¯çš„åšæ³•ï¼Œé€†å‘åº”ç”¨å¸•æ–¯å¡ä¸è´¹é©¬æå‡ºçš„æ–¹æ³•ï¼Œç”¨æœŸæœ›å€¼æ¥è®¡ç®—æ¦‚ç‡ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œè®¤çœŸè€ƒè™‘æŸä¸ªäººæ„¿æ„åœ¨æŸä¸ªäº‹ä»¶ä¸ŠæŠ¼ä¸‹çš„èµŒæ³¨ï¼Œä»¥æ­¤ä¼°ç®—è¯¥äº‹ä»¶çš„æœŸæœ›å€¼ã€‚ä½ çš„åˆ¤æ–­æ¦‚ç‡çš„åŠ æƒå¹³å‡å€¼ï¼Œå°±æ˜¯äº‹ä»¶çš„æœŸæœ›å€¼ã€‚ ç›¸å…³æ€§åˆ¤æ–­ è²å°¼è’‚æŒ‡å‡ºï¼Œå¦‚æœä¸€ä¸ªäººçš„æŠ¼æ³¨è¡Œä¸ºæ˜¯ç›¸å…³çš„ï¼Œé‚£ä¹ˆä»–çš„åˆ¤æ–­æ¦‚ç‡çš„ç¡®å…·æœ‰æ¦‚ç‡çš„æ•°å­¦ç»“æ„ã€‚ é€šè¿‡ç†æƒ³åŒ–çš„æ¨¡å‹æ¥è®ºè¯è¿™ä¸ªè§‚ç‚¹ï¼šå‡è®¾ä¸€ä¸ªäººåƒèµŒæ³¨ç»çºªäººï¼ˆæˆ–è€…è¡ç”Ÿå“äº¤æ˜“å‘˜ï¼‰é‚£æ ·ä¹°å–èµŒæ³¨ã€‚å¦‚æœä»–çš„æœŸæœ›å€¼æ˜¯é›¶ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªå…¬å¹³çš„èµŒæ³¨ï¼›å¦‚æœä»–çš„æœŸæœ›å€¼æ˜¯æ­£å€¼ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªæœ‰åˆ©çš„èµŒæ³¨ï¼›å¦‚æœä»–çš„æœŸæœ›å€¼æ˜¯è´Ÿå€¼ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªä¸åˆ©çš„èµŒæ³¨ã€‚åªè¦æœ‰äººæ‰¾ä¸Šé—¨æ¥ï¼Œä»–ä¾¿æ¥è€…ä¸æ‹’ï¼Œä¸€è¾¹ä¹°å…¥å…¬å¹³æˆ–æœ‰åˆ©çš„èµŒæ³¨ï¼Œä¸€è¾¹å–å‡ºå…¬å¹³æˆ–ä¸åˆ©çš„èµŒæ³¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœè‹¥å¹²æ¡©äº¤æ˜“ä»¥æŸç§æ–¹å¼ç»„åˆåˆ°ä¸€èµ·å°±æœ‰å¯èƒ½æ‰å…¥è·å…°èµŒï¼ˆDutch bookï¼‰çš„é™·é˜±ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ— è®ºåœ¨å“ªç§æƒ…å†µä¸‹éƒ½ä¼šé­å—å‡€æŸå¤±ã€‚ è·å…°èµŒï¼šå³å†³ç­–ä¸å…·æœ‰ç›¸å…³æ€§ï¼Œå¯¼è‡´èµŒå±€æ— è®ºå¦‚ä½•éƒ½ä¸ä¼šè¾“ã€‚ ç›¸å…³æ€§ï¼šäººä»¬ææ˜“åšå‡ºæ ¹æœ¬ä¸ç›¸å…³çš„è‰ç‡åˆ¤æ–­ï¼Œä»æ ¹æœ¬ä¸Šæ¥è®²ï¼Œè¦å…·å¤‡ç›¸å…³æ€§ï¼Œå°±å¿…é¡»åšåˆ°å‰åä¸€è‡´ã€‚ç›¸å…³æ€§è¡¨é¢äº†åˆ¤æ–­æ˜¯å…·æœ‰æ¦‚ç‡çš„æ•°å­¦ç»“æ„ã€‚ ç›¸å…³æ€§æ„å‘³ç€æ¦‚ç‡ã€‚å½“ä¸”ä»…å½“åˆ¤æ–­æ¦‚ç‡å…·æœ‰ç»å…¸æ¦‚ç‡çš„æ•°å­¦ç»“æ„æ—¶ï¼Œè¿™äº›åˆ¤æ–­æ¦‚ç‡æ‰å…·æœ‰ç›¸å…³æ€§ã€‚","categories":[{"name":"ç”Ÿæ´»æ‚è®°","slug":"ç”Ÿæ´»æ‚è®°","permalink":"http://yoursite.com/categories/%E7%94%9F%E6%B4%BB%E6%9D%82%E8%AE%B0/"}],"tags":[{"name":"è¯»ä¹¦ç¬”è®°","slug":"è¯»ä¹¦ç¬”è®°","permalink":"http://yoursite.com/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"}]},{"title":"Java åç«¯å¼€å‘ç¯å¢ƒæ­å»º","slug":"ç¯å¢ƒæ­å»º/Java åç«¯å¼€å‘ç¯å¢ƒæ­å»º","date":"2020-02-15T09:48:23.000Z","updated":"2020-07-10T03:09:35.975Z","comments":true,"path":"2020/02/15/ç¯å¢ƒæ­å»º/Java åç«¯å¼€å‘ç¯å¢ƒæ­å»º/","link":"","permalink":"http://yoursite.com/2020/02/15/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/Java%20%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/","excerpt":"è®°å½•å¼€å‘ç¯å¢ƒæ­å»ºè¿‡ç¨‹ä»¥åŠæ•´åˆèµ„æºä»¥ä¾¿å¿«é€Ÿæ­å»ºç¯å¢ƒã€‚","text":"è®°å½•å¼€å‘ç¯å¢ƒæ­å»ºè¿‡ç¨‹ä»¥åŠæ•´åˆèµ„æºä»¥ä¾¿å¿«é€Ÿæ­å»ºç¯å¢ƒã€‚ JDK å®‰è£… Oracle å®˜ç½‘ ä¸‹è½½ JDK å®‰è£…åŒ…ï¼Œéœ€è¦æ³¨å†Œè´¦å·åæ‰å¯ä¸‹è½½ã€‚ äº‘ç›˜èµ„æºä¸‹è½½ï¼šjdk-8u241-windows-x64.exe ä¿®æ”¹å®‰è£…ç›®å½•æ³¨æ„äº‹é¡¹ï¼š â€‹ å®‰è£…åœ¨éæ“ä½œç³»ç»Ÿæ‰€åœ¨ç›®å½•ä¸‹ï¼› â€‹ å®‰è£…çš„è·¯å¾„ä¸­ä¸è¦æœ‰ä¸­æ–‡åŠç©ºæ ¼ã€‚ ç›®å½•ä»‹ç»JDK ç›®å½•ï¼šJava Development Kit å³ Java å¼€å‘å·¥å…·ï¼ŒåŒ…å« JREã€‚ JRE ç›®å½•ï¼šJava Runtime Environment å³ Java è¿è¡Œæ—¶ç¯å¢ƒã€‚ JVMï¼šJava Virtual Machine å³ Java è™šæ‹Ÿæœº JVM æ˜¯æ•´ä¸ª Java å®ç°è·¨å¹³å°çš„æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œæ‰€æœ‰çš„ Java ç¨‹åºä¼šé¦–å…ˆè¢«ç¼–è¯‘ä¸º .class çš„ç±»æ–‡ä»¶ï¼Œè¿™ç§ç±»æ–‡ä»¶å¯ä»¥åœ¨è™šæ‹Ÿæœºä¸Šæ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´ .class æ–‡ä»¶å¹¶ä¸ç›´æ¥ä¸æœºå™¨çš„æ“ä½œç³»ç»Ÿç›¸å¯¹åº”ï¼Œè€Œæ˜¯ç»è¿‡è™šæ‹Ÿæœºé—´æ¥ä¸æ“ä½œç³»ç»Ÿäº¤äº’ï¼Œç”±è™šæ‹Ÿæœºå°†ç¨‹åºè§£é‡Šç»™æœ¬åœ°ç³»ç»Ÿæ‰§è¡Œã€‚ JRE = JVM + libã€‚å…‰æœ‰ JVM è¿˜ä¸èƒ½è®© .class æ–‡ä»¶æ‰§è¡Œï¼Œå› ä¸ºåœ¨è§£é‡Š .class æ–‡ä»¶çš„æ—¶å€™ JVM éœ€è¦è°ƒç”¨è§£é‡Šæ‰€éœ€è¦çš„ç±»åº“ libã€‚åœ¨ JDK çš„å®‰è£…ç›®å½•é‡Œä½ å¯ä»¥æ‰¾åˆ° JRE ç›®å½•ï¼Œé‡Œé¢æœ‰ä¸¤ä¸ªæ–‡ä»¶å¤¹ bin å’Œ libï¼Œåœ¨è¿™é‡Œå¯ä»¥è®¤ä¸º bin é‡Œçš„å°±æ˜¯ jvmï¼Œlib ä¸­åˆ™æ˜¯ JVM å·¥ä½œæ‰€éœ€è¦çš„ç±»åº“ï¼Œæ‰€ä»¥ JVM å’Œ lib å’Œèµ·æ¥å°±ç§°ä¸º JREã€‚ JDK ç›®å½• binï¼šå¼€å‘å·¥å…·ï¼ŒåŒ…å«äº†å¼€å‘ã€æ‰§è¡Œã€è°ƒè¯• Java ç¨‹åºæ‰€ä½¿ç”¨çš„å·¥å…·å’Œå®ç”¨ç¨‹åºï¼Œä»¥åŠå¼€å‘å·¥å…·æ‰€éœ€è¦çš„ç±»åº“å’Œæ”¯æŒæ–‡ä»¶ã€‚ includeï¼šå¤´æ–‡ä»¶ï¼Œå®ƒæ”¯æŒä½¿ç”¨ Java æœ¬åœ°æ¥å£å’Œ Java è™šæ‹Ÿæœºè°ƒè¯•æ¥å£çš„æœ¬åœ°ä»£ç ç¼–ç¨‹ã€‚ jreï¼šè¿è¡Œç¯å¢ƒï¼Œå®ç°äº† Java è¿è¡Œç¯å¢ƒã€‚æ˜¯è¿è¡Œ Java ç¨‹åºæ‰€å¿…é¡»çš„ç¯å¢ƒã€‚JRE åŒ…å«äº† Java è™šæ‹Ÿæœº JavaTM Virtual Machine(JVM)ã€Java æ ¸å¿ƒç±»åº“å’Œæ”¯æŒæ–‡ä»¶ã€‚å¦‚æœåªè¿è¡Œ Java ç¨‹åºï¼Œåˆ™åªéœ€è¦å®‰è£… JREã€‚å¦‚éœ€å¼€å‘ Java ç¨‹åºï¼Œåˆ™éœ€å®‰è£… JDKã€‚JDK ä¸­åŒ…å«äº† JREã€‚ libï¼šåŒ…æ‹¬äº† Java å¼€å‘ç¯å¢ƒçš„ Jar åŒ…ï¼Œæ˜¯ç»™ JDK ç”¨çš„ã€‚ä¾‹å¦‚ JDK ä¸‹æœ‰ä¸€äº›å·¥å…·ï¼Œå¯èƒ½è¦ç”¨è¯¥ç›®å½•ä¸­çš„æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼Œç¼–è¯‘å™¨ç­‰ã€‚ src.zipï¼šæ„æˆ Java æ ¸å¿ƒ API çš„æ‰€æœ‰ç±»çš„æºæ–‡ä»¶ï¼ŒåŒ…æ‹¬äº† java.ã€javax. å’ŒæŸäº› org.* åŒ…ä¸­ç±»çš„æºæ–‡ä»¶ï¼Œä¸åŒ…å« com.sun.* åŒ…ä¸­ç±»çš„æºæ–‡ä»¶ã€‚ éªŒè¯å®‰è£… é…ç½®ç¯å¢ƒå˜é‡æ–°å»ºï¼šJAVA_HOME = [JDK å®‰è£…ç›®å½•]ç¼–è¾‘æ·»åŠ ï¼šclasspath = %JAVA_HOME%/lib/dt.jar;%JAVA_HOME%/lib/tools.jar;.;ç¼–è¾‘æ·»åŠ ï¼šPath = %JAVA_HOME%/bin; Path ç¯å¢ƒå˜é‡çš„å€¼å°±æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„çš„åˆ—è¡¨ï¼Œæä¾›ç»™ç³»ç»Ÿå¯»æ‰¾å’Œæ‰§è¡Œåº”ç”¨ç¨‹åºçš„è·¯å¾„ã€‚å½“æ‰§è¡Œä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶æ—¶ï¼Œç³»ç»Ÿé¦–å…ˆåœ¨å½“å‰è·¯å¾„ä¸‹å¯»æ‰¾ï¼Œå¦‚æœªæ‰¾åˆ°ï¼Œåˆ™åˆ° Path ä¸­æŒ‡å®šçš„å„ä¸ªè·¯å¾„ä¸­å»å¯»æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°ä¸ºæ­¢ï¼Œå¦‚æœ Path è·¯å¾„ä¸­ä¹Ÿæ‰¾ä¸åˆ°ï¼Œåˆ™æŠ¥é”™ã€‚Java çš„ç¼–è¯‘å™¨ï¼ˆjavac.exeï¼‰å’Œè§£é‡Šå™¨ï¼ˆjava.exeï¼‰éƒ½åœ¨å…¶å®‰è£…è·¯å¾„ä¸‹çš„ bin ç›®å½•ä¸­ï¼Œä¸ºäº†åœ¨ä»»ä½•è·¯å¾„ä¸‹éƒ½å¯ä»¥ä½¿ç”¨å®ƒä»¬ç¼–è¯‘æ‰§è¡Œ Java ç¨‹åºï¼Œåº”è¯¥å°†å®ƒä»¬æ‰€åœ¨çš„ç›®å½•æ·»åŠ åˆ° Path å˜é‡ä¸­;classpath ç¯å¢ƒå˜é‡æŒ‡å®šäº† Java ç¨‹åºç¼–è¯‘æˆ–è¿è¡Œæ—¶æ‰€ç”¨åˆ°çš„ç±»çš„æœç´¢åˆ—è¡¨ã€‚Java è™šæ‹ŸæœºæŸ¥æ‰¾ç±»çš„è¿‡ç¨‹ä¸åŒäº Windows æŸ¥æ‰¾å¯æ‰§è¡Œå‘½ä»¤ï¼ˆ.exeã€.bat æˆ– .cmd ä»¥åŠ .dll åŠ¨æ€é“¾æ¥åº“ï¼‰çš„è¿‡ç¨‹ã€‚å®ƒä¸åœ¨å½“å‰è·¯å¾„ä¸‹å¯»æ‰¾ï¼Œåªåˆ° classpath æŒ‡å®šçš„è·¯å¾„åˆ—è¡¨ä¸­å»å¯»æ‰¾ï¼Œæ‰€ä»¥åœ¨è®¾å®šç¯å¢ƒå˜é‡æ—¶ä¸€å®šè¦æŠŠå½“å‰è·¯å¾„åŒ…å«è¿›æ¥ã€‚å˜é‡ä¸­çš„â€œ.â€ä»£è¡¨å½“å‰è·¯å¾„ï¼Œè¡¨ç¤º Java è™šæ‹Ÿæœºå…ˆåˆ°å½“å‰è·¯å¾„ä¸‹å»æŸ¥æ‰¾è¦ä½¿ç”¨çš„ç±»ï¼Œå½“å‰è·¯å¾„æŒ‡ Java è™šæ‹Ÿæœºè¿è¡Œæ—¶çš„å½“å‰å·¥ä½œç›®å½•;3ã€JAVA_HOME çš„å€¼å°±æ˜¯ JDK å®‰è£…è·¯å¾„çš„å€¼ã€‚å½“éœ€è¦ä½¿ç”¨ JDK è·¯å¾„æ—¶ï¼Œç›´æ¥ç”¨ %JAVA_HOME% çš„æ–¹å¼å¼•ç”¨ï¼Œæ–¹ä¾¿ç®€å•ã€‚å¦‚æœ JDK çš„å®‰è£…è·¯å¾„å‘ç”Ÿäº†å˜åŒ–æˆ–è€…å®‰è£…äº†æ–°ç‰ˆæœ¬çš„ JDKï¼Œåªéœ€ä¿®æ”¹ JAVA_HOME çš„å€¼å³å¯ï¼Œå…¶å®ƒå¼•ç”¨ JAVA_HOME çš„åœ°æ–¹ä¸éœ€è¦ä¿®æ”¹ã€‚ æµ‹è¯•è¿è¡Œ Java ç¨‹åºæ–°å»º HelloWorld.java æ–‡ä»¶ã€‚ 12345public class HelloWorld &#123; public static void main(String[] args) &#123; System.out.println(\"Hello World!\"); &#125;&#125; ç¼–è¯‘è§£é‡Šè¿è¡Œã€‚ javac HelloWorld.javaçš„æ„æ€æ˜¯ç¼–è¯‘ HelloWorld.java æ–‡ä»¶ï¼Œå¹¶ç”Ÿæˆ HelloWorld.class å­—èŠ‚ç æ–‡ä»¶ã€‚ java HelloWorld çš„æ„æ€æ˜¯è¿è¡Œå­—èŠ‚ç æ–‡ä»¶ HelloWorld.classï¼Œè¿è¡Œçš„æ—¶å€™å¹¶ä¸éœ€è¦è¾“å…¥ .class åç¼€ã€‚ è¿è¡ŒæˆåŠŸåè¾“å‡ºç»“æœï¼šHello World! MySQL å®‰è£…å®˜ç½‘ä¸‹è½½ï¼šMySQL Installer 8.0.19 äº‘ç›˜èµ„æºä¸‹è½½ï¼šmysql-installer-community-8.0.19.0.msi ä¸‹è½½ MSI ç‰ˆæœ¬ï¼Œç›´æ¥å®‰è£…ï¼ŒMSI ç‰ˆæœ¬å®‰è£…çš„å¥½å¤„æ˜¯ä¸ç”¨æ‰‹åŠ¨é…ç½®ç¯å¢ƒå˜é‡ï¼Œå’Œä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œæ•´ä¸ªå®‰è£…è¿‡ç¨‹åªéœ€è¦ç‚¹å‡»ä¸‹ä¸€æ­¥å³å¯ã€‚ å®‰è£…ç‰ˆæœ¬åˆ†åœ¨çº¿å®‰è£…ç‰ˆæœ¬å’Œç¦»çº¿å®‰è£…ç‰ˆæœ¬ï¼Œè¿™é‡Œé€‰æ‹©ç¦»çº¿å®‰è£…ç‰ˆæœ¬ï¼Œæ•´ä¸ªå®‰è£…è¿‡ç¨‹ä¼šæ¯”è¾ƒæµç•…ã€‚è€Œåœ¨çº¿å®‰è£…åœ¨ç½‘ç»œä¸ä½³çš„æƒ…å†µä¸‹å¯èƒ½ä¼šç‰¹åˆ«æ…¢ã€‚ è¿è¡Œå®‰è£…åŒ…ï¼Œé€‰æ‹© Full æ¨¡å¼å®‰è£… æµ‹è¯•æ¨¡å¼ä¸‹ï¼Œä¸ºäº†å…¼å®¹è€ç‰ˆæœ¬çš„å¼€å‘å·¥å…·ä»¥åŠ jar åŒ…ï¼Œé€‰æ‹©ä¼ ç»Ÿæˆæƒæ–¹æ³•ï¼ˆMySQL 5.xï¼‰ã€‚ å¼ºå¯†ç åŠ å¯†æ–¹æ³•ï¼ˆMySQL 8.0ï¼‰é‡‡ç”¨äº†æ–°çš„å¯†ç åŠ å¯†æ–¹å¼ï¼Œä¹Ÿå°±æ„å‘³ç€è€ç‰ˆæœ¬çš„æ•°æ®åº“è®¿é—®å®¢æˆ·ç«¯ç‰ˆæœ¬ä¹Ÿè¦æ›´æ–°åˆ°æ”¯æŒçš„ç‰ˆæœ¬ã€‚ æ£€æµ‹æ˜¯å¦èƒ½è¿æ¥ä¸Š MySQL æœåŠ¡å™¨ã€‚ å®‰è£…å®Œæˆã€‚services.mscæŸ¥çœ‹ MySQL æœåŠ¡æ˜¯å¦å·²ç»å¯åŠ¨ï¼Œå¹¶åˆ©ç”¨ SQLyog è®¿é—®æ•°æ®åº“ã€‚ Tomcat å®‰è£…å®˜ç½‘ä¸‹è½½ï¼šapache-tomcat-8.5.51.exe è¿è¡Œå®‰è£…åŒ…ã€‚ ä¸‹è½½å®Œæˆåï¼Œæ¥åˆ°å®‰è£…ç›®å½•ã€‚å¯ä»¥çœ‹åˆ° Tomcat æœåŠ¡å·²ç»å¯åŠ¨ã€‚ï¼ˆå¯ç”¨ startup / showdown.bat æ¥å¯åŠ¨ / å…³é—­æœåŠ¡ï¼‰ é€šè¿‡è„šæœ¬å¯åŠ¨æœåŠ¡åå‘ç°è¾“å‡ºçš„æ—¥å¿—ä¸­å­˜åœ¨ä¹±ç ã€‚åˆ°å®‰è£…ç›®å½•ä¸‹çš„ bin æ–‡ä»¶å¤¹ä¸­ç¼–è¾‘ logging.properties é…ç½®æ–‡ä»¶ã€‚ é‡å¯ Tomcat æœåŠ¡å™¨ï¼Œæ—¥å¿—è¾“å‡ºæ­£å¸¸ã€‚æˆåŠŸè®¿é—® localhost:8080ã€‚ IDEA å®‰è£…å®˜ç½‘ä¸‹è½½ï¼šIntelliJ IDEA äº‘ç›˜èµ„æºä¸‹è½½ï¼šIntelliJ-2019.1.4.exe IDEA çš„å®‰è£…å’Œé…ç½®ï¼šç‚¹å‡»è¿›å…¥ Maven çš„å®‰è£…å’Œé…ç½®ï¼šç‚¹å‡»è¿›å…¥ IDEA å¸¸ç”¨æ’ä»¶ä»‹ç»ï¼ˆUpdatingï¼‰PSï¼šé‡åˆ°ä½¿ç”¨åœºæ™¯åæŒç»­æ›´æ–°å„æ’ä»¶ç”¨æ³•ã€‚ Setting â†’ Plugins ä¸‹æœç´¢å¹¶ä¸‹è½½æ’ä»¶ GitToolBox æä¾› Git çš„ä¸€äº›æ“ä½œï¼Œå¯ä»¥è®¾ç½®æ—¶é—´é—´éš”æ¥æ¯”å¯¹æœ¬åœ°ä»£ç å’ŒæœåŠ¡å™¨ä¸Šä»£ç æœ‰å¤šå°‘ä¸åŒï¼Œè¿™æ ·å¯ä»¥åœ¨æäº¤ä»£ç å…ˆè¿›è¡Œä»£ç çš„æ›´æ–°ã€‚ Findbugs-IDEA æ­¤æ’ä»¶ä»…æ”¯æŒåˆ° 2018.1.8 ç‰ˆæœ¬çš„ IDEAã€‚ PMD æ˜¯ä¸€ä¸ªé™æ€ä»£ç æ£€æµ‹å·¥å…·ï¼Œè¾…åŠ©æˆ‘ä»¬æ£€æµ‹æ½œåœ¨bugçš„å·¥å…·ï¼Œå¤§å¤§å‡å°‘äº†äººå·¥å®¡æŸ¥æˆæœ¬ï¼Œæé«˜ç¼–ç æ•ˆç‡ã€‚ Alibaba Java Coding Guidelines å¿«æ·é”®Ctrl+Shift+Alt+Jï¼Œç¼–ç è§„çº¦æ‰«æã€‚ Lomboké¡¹ç›®ä¸­ç»å¸¸ä½¿ç”¨ beanï¼Œentity ç­‰ç±»ï¼Œç»å¤§éƒ¨åˆ†æ•°æ®ç±»ç±»ä¸­éƒ½éœ€è¦ getã€setã€toStringã€equals å’Œ hashCode æ–¹æ³•ï¼Œè™½ç„¶ eclipse å’Œ idea å¼€å‘ç¯å¢ƒä¸‹éƒ½æœ‰è‡ªåŠ¨ç”Ÿæˆçš„å¿«æ·æ–¹å¼ï¼Œä½†è‡ªåŠ¨ç”Ÿæˆè¿™äº›ä»£ç åï¼Œå¦‚æœ bean ä¸­çš„å±æ€§ä¸€æ—¦æœ‰ä¿®æ”¹ã€åˆ é™¤æˆ–å¢åŠ æ—¶ï¼Œéœ€è¦é‡æ–°ç”Ÿæˆæˆ–åˆ é™¤ get / set ç­‰æ–¹æ³•ï¼Œç»™ä»£ç ç»´æŠ¤å¢åŠ è´Ÿæ‹…ã€‚è€Œä½¿ç”¨äº† lombok åˆ™ä¸ä¸€æ ·ï¼Œä½¿ç”¨äº† lombok çš„æ³¨è§£ï¼ˆ@Setterï¼Œ@Getterï¼Œ@ToStringï¼Œ@@RequiredArgsConstructorï¼Œ@EqualsAndHashCodeï¼Œ@Dataï¼‰ä¹‹åï¼Œå°±ä¸éœ€è¦ç¼–å†™æˆ–ç”Ÿæˆ get / set ç­‰æ–¹æ³•ï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šå‡å°‘äº†ä»£ç é‡ï¼Œè€Œä¸”å‡å°‘äº†ä»£ç ç»´æŠ¤çš„è´Ÿæ‹…ã€‚æ•…å¼ºçƒˆå»ºè®®é¡¹ç›®ä¸­ä½¿ç”¨ lombokï¼Œå»æ‰ bean ä¸­ getã€setã€toStringã€equals å’Œ hashCode ç­‰æ–¹æ³•çš„ä»£ç ã€‚ pom.xml ä¸­æ·»åŠ  Lombok ä¾èµ– 12345&lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;version&gt;1.16.10&lt;/version&gt;&lt;/dependency&gt; ç¤ºä¾‹ä»£ç  1234567891011121314151617package com.lombok.demo; import lombok.EqualsAndHashCode;import lombok.Getter;import lombok.Setter;import lombok.ToString;@Setter@Getter@ToString@EqualsAndHashCodepublic class Student &#123; private String name; private int age; private String male;&#125; æµ‹è¯•ç±» 1234567891011121314151617181920212223242526272829package com.lombok.demo; import lombok.extern.java.Log; // çœç•¥äº† private static final ogger log = Logger.getLogger(LogExample.class.getName());@Logpublic class LombokTest &#123; public static void main(String[] args) &#123; Student student = new Student(); student.setAge(23); student.setMale(\"man\"); student.setName(\"wingo\"); System.out.println(student.toString()); Student student2 = new Student(); student2.setAge(23); student2.setMale(\"man\"); student2.setName(\"wingo\"); System.out.println(student.equals(student2)); student2.setAge(\"24\"); System.out.println(student.equals(student2)); log.info(\"lombok test\"); &#125;&#125; æµ‹è¯•ç»“æœ 1234Student(name&#x3D;wingo, age&#x3D;23, male&#x3D;man)truefalselombok test SonarLint ä»£ç åˆ†æå·¥å…·ï¼Œèƒ½å¤Ÿåœ¨ç¼–ç çš„é˜¶æ®µå®æ—¶æ£€æŸ¥ä»£ç ï¼Œå¹¶ä¸”åœ¨ä»£ç æäº¤å‰åšæ£€æŸ¥ç­‰ï¼ŒæŠŠå­˜åœ¨çš„é—®é¢˜æå‰æš´éœ²ï¼Œæé«˜ä»£ç è´¨é‡ã€‚ .ignore åœ¨é¡¹ç›®ä¸Šå³é”® â†’ New â†’ .ignore file â†’ .gitignore file(Git)ï¼Œå¿½ç•¥ä¸éœ€è¦æäº¤çš„æ–‡ä»¶ã€‚ Maven Helper æŸ¥çœ‹ Maven çš„å†²çªä¸ä¾èµ–ã€‚ Acejump å¿«é€Ÿå…‰æ ‡è·³è½¬æ–¹å¼ã€‚ RestfulToolkit æ¥å£æµ‹è¯•å·¥å…·ã€‚ CodeGlance åœ¨ä»£ç çš„å³ä¾§æ˜¾ç¤ºä»£ç å°åœ°å›¾ã€‚ MyBatis Log Plugin æ§åˆ¶å°æ‰“å° MyBatis è„šæœ¬æ—¥å¿—ã€‚ String Manipulation å¼ºå¤§çš„å­—ç¬¦ä¸²è½¬æ¢å·¥å…·ã€‚ GsonForma Json å®åŠ›ç±»å¿«é€Ÿç”Ÿæˆå·¥å…·ã€‚ JUnitGenerator V2.0 å¸®åŠ©ç”Ÿæˆå•å…ƒæµ‹è¯•å·¥å…·ã€‚ JRebel çƒ­éƒ¨ç½²æ’ä»¶ã€‚å®Œå…¨ä¸ç”¨é‡å¯æœåŠ¡å™¨ï¼Œå¼€å‘åç«¯å’Œå‰ç«¯ä¸€æ ·ã€‚åŒ…æ‹¬æ·»åŠ ç±»ï¼Œæ–¹æ³•ï¼Œæ³¨è§£ï¼Œä¿®æ”¹ xml å’Œ properies æ–‡ä»¶ã€‚ Translation GenerateAllSetter CodeMaker ä»£ç ç”Ÿæˆæ’ä»¶ã€‚æ”¯æŒå¢åŠ è‡ªå®šä¹‰ä»£ç æ¨¡æ¿ï¼ˆVelocityï¼‰ï¼›æ”¯æŒé€‰æ‹©å¤šä¸ªç±»ä½œä¸ºä»£ç æ¨¡æ¿çš„ä¸Šä¸‹æ–‡ã€‚ Grep Console å¯ä»¥è®¾ç½®ä¸åŒçº§åˆ«logçš„å­—ä½“é¢œè‰²å’ŒèƒŒæ™¯è‰²ã€‚ Key Promoter X å¿«æ·é”®æç¤ºå·¥å…·ã€‚å½“ä½ åœ¨ IDEA é‡Œé¢ä½¿ç”¨é¼ æ ‡çš„æ—¶å€™ï¼Œå¦‚æœè¿™ä¸ªé¼ æ ‡æ“ä½œæ˜¯èƒ½å¤Ÿç”¨å¿«æ·é”®æ›¿ä»£çš„ï¼Œé‚£ä¹ˆ Key Promoter X ä¼šå¼¹å‡ºä¸€ä¸ªæç¤ºæ¡†ï¼Œå‘ŠçŸ¥ä½ è¿™ä¸ªé¼ æ ‡æ“ä½œå¯ä»¥ç”¨ä»€ä¹ˆå¿«æ·é”®æ›¿ä»£ã€‚ Swipï¼ˆSpring Web Initializrï¼‰ IdeaVim åœ¨ Intellij ä¸­æ¨¡æ‹Ÿ Vim çš„æ“ä½œæ–¹å¼ã€‚ BashSupport IEDA ä¸­çš„ BashSupport æ’ä»¶æ”¯æŒåœ¨IDEAä¸­ç¼–å†™shellè„šæœ¬æ–‡ä»¶ï¼Œæœ‰å‹å¥½çš„ä»£ç æ ¼å¼ï¼Œæ”¯æŒè‡ªåŠ¨è¡¥å…¨ï¼Œæ£€æŸ¥é”™è¯¯ï¼Œå¹¶ä¸”é…ç½®å®Œä¹‹åï¼Œè¿˜å¯ä»¥åœ¨IEDAä¸­ç›´æ¥è¿è¡Œshellè„šæœ¬ EduTools ä½¿ç”¨ EduToolsï¼Œæ‚¨å¯ä»¥é€šè¿‡ä»£ç ç»ƒä¹ ä»»åŠ¡æ¥å­¦ä¹ å’Œæ•™å¯¼ Kotlin","categories":[{"name":"ç¯å¢ƒæ­å»º","slug":"ç¯å¢ƒæ­å»º","permalink":"http://yoursite.com/categories/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"}],"tags":[{"name":"Welab","slug":"Welab","permalink":"http://yoursite.com/tags/Welab/"}]},{"title":"Git å‘½ä»¤æ¸…å•","slug":"å¼€å‘æ‚é¡¹/Git å‘½ä»¤æ¸…å•","date":"2020-02-15T07:17:45.000Z","updated":"2020-07-10T03:00:21.734Z","comments":true,"path":"2020/02/15/å¼€å‘æ‚é¡¹/Git å‘½ä»¤æ¸…å•/","link":"","permalink":"http://yoursite.com/2020/02/15/%E5%BC%80%E5%8F%91%E6%9D%82%E9%A1%B9/Git%20%E5%91%BD%E4%BB%A4%E6%B8%85%E5%8D%95/","excerpt":"Git å¯¹äºç¨‹åºå‘˜å¯ä»¥è¯´ä½¿ä¸€é¡¹å¿…å¤‡çš„æŠ€èƒ½ï¼Œæ•…åˆ—æ­¤æ¸…å•æ–¹ä¾¿æŸ¥è¯¢ã€‚","text":"Git å¯¹äºç¨‹åºå‘˜å¯ä»¥è¯´ä½¿ä¸€é¡¹å¿…å¤‡çš„æŠ€èƒ½ï¼Œæ•…åˆ—æ­¤æ¸…å•æ–¹ä¾¿æŸ¥è¯¢ã€‚ è½¬è½½è‡ªï¼šé˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿— â†’ å¸¸ç”¨ Git å‘½ä»¤æ¸…å• Git æ“ä½œæµç¨‹ Workspaceï¼šå·¥ä½œåŒºï¼› Index / Stageï¼šæš‚å­˜åŒºï¼› Repositoryï¼šæœ¬åœ°ä»“åº“ï¼› Remoteï¼šè¿œç¨‹ä»“åº“ã€‚ æ–°å»ºä»£ç åº“12345678# åœ¨å½“å‰ç›®å½•æ–°å»ºä¸€ä¸ª Git ä»£ç åº“git init# æ–°å»ºä¸€ä¸ªç›®å½•ï¼Œå°†å…¶åˆå§‹åŒ–ä¸º Git ä»£ç åº“git init [project-name]# ä¸‹è½½ä¸€ä¸ªé¡¹ç›®å’Œå®ƒçš„æ•´ä¸ªä»£ç å†å²git clone [url] é…ç½®Git çš„è®¾ç½®æ–‡ä»¶ä¸º.gitconfigï¼Œå®ƒå¯ä»¥åœ¨ç”¨æˆ·ä¸»ç›®å½•ä¸‹ï¼ˆå…¨å±€é…ç½®ï¼‰ï¼Œä¹Ÿå¯ä»¥åœ¨é¡¹ç›®ç›®å½•ä¸‹ï¼ˆé¡¹ç›®é…ç½®ï¼‰ã€‚ 123456789101112# æ˜¾ç¤ºå½“å‰çš„ Git é…ç½®git config --list# ç¼–è¾‘ Git é…ç½®æ–‡ä»¶git config -e [--global]# æŸ¥çœ‹ Git é…ç½®æ–‡ä»¶git config -l# è®¾ç½®æäº¤ä»£ç æ—¶çš„ç”¨æˆ·ä¿¡æ¯git config [--global] user.name \"[name]\"git config [--global] user.email \"[email address]\" æ–‡ä»¶æ“ä½œ123456789101112131415161718192021# æ·»åŠ æŒ‡å®šæ–‡ä»¶åˆ°æš‚å­˜åŒºgit add [file1] [file2] ...# æ·»åŠ æŒ‡å®šç›®å½•åˆ°æš‚å­˜åŒºï¼ŒåŒ…æ‹¬å­ç›®å½•git add [dir]# æ·»åŠ å½“å‰ç›®å½•çš„æ‰€æœ‰æ–‡ä»¶åˆ°æš‚å­˜åŒºgit add .# æ·»åŠ æ¯ä¸ªå˜åŒ–å‰ï¼Œéƒ½ä¼šè¦æ±‚ç¡®è®¤# å¯¹äºåŒä¸€ä¸ªæ–‡ä»¶çš„å¤šå¤„å˜åŒ–ï¼Œå¯ä»¥å®ç°åˆ†æ¬¡æäº¤git add -p# åˆ é™¤å·¥ä½œåŒºæ–‡ä»¶ï¼Œå¹¶ä¸”å°†è¿™æ¬¡åˆ é™¤æ”¾å…¥æš‚å­˜åŒºgit rm [file1] [file2] ...# åœæ­¢è¿½è¸ªæŒ‡å®šæ–‡ä»¶ï¼Œä½†è¯¥æ–‡ä»¶ä¼šä¿ç•™åœ¨å·¥ä½œåŒºgit rm --cached [file]# æ”¹åæ–‡ä»¶ï¼Œå¹¶ä¸”å°†è¿™ä¸ªæ”¹åæ”¾å…¥æš‚å­˜åŒºgit mv [file-original] [file-renamed] ä»£ç æäº¤123456789101112131415161718# æäº¤æš‚å­˜åŒºåˆ°ä»“åº“åŒºgit commit -m [message]# æäº¤æš‚å­˜åŒºçš„æŒ‡å®šæ–‡ä»¶åˆ°ä»“åº“åŒºgit commit [file1] [file2] ... -m [message]# æäº¤å·¥ä½œåŒºè‡ªä¸Šæ¬¡ commit ä¹‹åçš„å˜åŒ–ï¼Œç›´æ¥åˆ°ä»“åº“åŒºgit commit -a# æäº¤æ—¶æ˜¾ç¤ºæ‰€æœ‰ diff ä¿¡æ¯git commit -v# ä½¿ç”¨ä¸€æ¬¡æ–°çš„ commitï¼Œæ›¿ä»£ä¸Šä¸€æ¬¡æäº¤# å¦‚æœä»£ç æ²¡æœ‰ä»»ä½•æ–°å˜åŒ–ï¼Œåˆ™ç”¨æ¥æ”¹å†™ä¸Šä¸€æ¬¡ commit çš„æäº¤ä¿¡æ¯git commit --amend -m [message]# é‡åšä¸Šä¸€æ¬¡commitï¼Œå¹¶åŒ…æ‹¬æŒ‡å®šæ–‡ä»¶çš„æ–°å˜åŒ–git commit --amend [file1] [file2] ... åˆ†æ”¯åˆ†æ”¯ä»‹ç»åˆ†æ”¯æ˜¯ä¸ºäº†å°†ä¿®æ”¹è®°å½•çš„æ•´ä½“æµç¨‹åˆ†å‰ä¿å­˜ã€‚åˆ†å‰åçš„åˆ†æ”¯ä¸å—å…¶ä»–åˆ†æ”¯çš„å½±å“ï¼Œæ‰€ä»¥åœ¨åŒä¸€ä¸ªæ•°æ®åº“é‡Œå¯ä»¥åŒæ—¶è¿›è¡Œå¤šä¸ªä¿®æ”¹ã€‚ åˆ†å‰çš„åˆ†æ”¯æ˜¯å¯ä»¥åˆå¹¶çš„ã€‚ master åˆ†æ”¯ï¼šåœ¨æ•°æ®åº“è¿›è¡Œæœ€åˆçš„æäº¤å, Git ä¼šåˆ›å»ºä¸€ä¸ªåä¸º master çš„åˆ†æ”¯ã€‚å› æ­¤ä¹‹åçš„æäº¤ï¼Œåœ¨åˆ‡æ¢åˆ†æ”¯ä¹‹å‰éƒ½ä¼šæ·»åŠ åˆ° master åˆ†æ”¯é‡Œã€‚ åˆ†æ”¯çš„è¿ç”¨Merge åˆ†æ”¯ï¼šMerge åˆ†æ”¯æ˜¯ä¸ºäº†å¯ä»¥éšæ—¶å‘å¸ƒ release è€Œåˆ›å»ºçš„åˆ†æ”¯ï¼Œå®ƒè¿˜èƒ½ä½œä¸º Topic åˆ†æ”¯çš„æºåˆ†æ”¯ä½¿ç”¨ã€‚é€šå¸¸ï¼Œå¤§å®¶ä¼šå°† master åˆ†æ”¯å½“ä½œ Merge åˆ†æ”¯ä½¿ç”¨ã€‚ Topic åˆ†æ”¯ï¼šTopic åˆ†æ”¯æ˜¯ä¸ºäº†å¼€å‘æ–°åŠŸèƒ½æˆ–ä¿®å¤ Bug ç­‰ä»»åŠ¡è€Œå»ºç«‹çš„åˆ†æ”¯ã€‚è‹¥è¦åŒæ—¶è¿›è¡Œå¤šä¸ªçš„ä»»åŠ¡ï¼Œè¯·åˆ›å»ºå¤šä¸ªçš„ Topic åˆ†æ”¯ã€‚Topic åˆ†æ”¯æ˜¯ä»ç¨³å®šçš„ Merge åˆ†æ”¯åˆ›å»ºçš„ã€‚å®Œæˆä½œä¸šåï¼Œè¦æŠŠ Topic åˆ†æ”¯åˆå¹¶å› Merge åˆ†æ”¯ã€‚ åˆ†æ”¯æ“ä½œå®ä¾‹æ–°å»ºä»“åº“12345mkdir testcd testgit initgit add myfile.txtgit commit -m \"first commit\" æ–°å»ºåˆ†æ”¯12345# åˆ›å»ºåˆ†æ”¯git branch test01# æ˜¾ç¤ºåˆ†æ”¯åˆ—è¡¨# å¸¦*çš„å°±æ˜¯ç°åœ¨çš„åˆ†æ”¯git branch åˆ‡æ¢åˆ†æ”¯12345# åˆ‡æ¢åˆ†æ”¯git checkout test01Switched to branch 'issue1'git add myfile.txtgit commit -m \"æ·»åŠ addçš„è¯´æ˜\" åˆå¹¶åˆ†æ”¯123git checkout masterSwitched to branch 'master'git merge test01 master åˆ†æ”¯æŒ‡å‘çš„æäº¤ç§»åŠ¨åˆ°å’Œ test01 åŒæ ·çš„ä½ç½®ã€‚è¿™ä¸ªæ˜¯ fast-forwardï¼ˆå¿«è¿›ï¼‰åˆå¹¶ã€‚ å¸¸ç”¨å‘½ä»¤123456789101112131415161718192021222324252627282930313233343536373839404142434445# åˆ—å‡ºæ‰€æœ‰æœ¬åœ°åˆ†æ”¯git branch# åˆ—å‡ºæ‰€æœ‰è¿œç¨‹åˆ†æ”¯git branch -r# åˆ—å‡ºæ‰€æœ‰æœ¬åœ°åˆ†æ”¯å’Œè¿œç¨‹åˆ†æ”¯git branch -a# æ–°å»ºä¸€ä¸ªåˆ†æ”¯ï¼Œä½†ä¾ç„¶åœç•™åœ¨å½“å‰åˆ†æ”¯git branch [branch-name]# æ–°å»ºä¸€ä¸ªåˆ†æ”¯ï¼Œå¹¶åˆ‡æ¢åˆ°è¯¥åˆ†æ”¯git checkout -b [branch]# æ–°å»ºä¸€ä¸ªåˆ†æ”¯ï¼ŒæŒ‡å‘æŒ‡å®šcommitgit branch [branch] [commit]# æ–°å»ºä¸€ä¸ªåˆ†æ”¯ï¼Œä¸æŒ‡å®šçš„è¿œç¨‹åˆ†æ”¯å»ºç«‹è¿½è¸ªå…³ç³»git branch --track [branch] [remote-branch]# åˆ‡æ¢åˆ°æŒ‡å®šåˆ†æ”¯ï¼Œå¹¶æ›´æ–°å·¥ä½œåŒºgit checkout [branch-name]# åˆ‡æ¢åˆ°ä¸Šä¸€ä¸ªåˆ†æ”¯git checkout -# å»ºç«‹è¿½è¸ªå…³ç³»ï¼Œåœ¨ç°æœ‰åˆ†æ”¯ä¸æŒ‡å®šçš„è¿œç¨‹åˆ†æ”¯ä¹‹é—´git branch --set-upstream [branch] [remote-branch]# åˆå¹¶æŒ‡å®šåˆ†æ”¯åˆ°å½“å‰åˆ†æ”¯git merge [branch]# é€‰æ‹©ä¸€ä¸ªcommitï¼Œåˆå¹¶è¿›å½“å‰åˆ†æ”¯git cherry-pick [commit]# åˆ é™¤åˆ†æ”¯git branch -d [branch-name]# æäº¤è¿œç¨‹åˆ†æ”¯git push origin [branch-name]# åˆ é™¤è¿œç¨‹åˆ†æ”¯git push origin --delete [branch-name]git branch -dr [remote/branch] æ ‡ç­¾1234567891011121314151617181920212223242526# åˆ—å‡ºæ‰€æœ‰taggit tag# æ–°å»ºä¸€ä¸ªtagåœ¨å½“å‰commitgit tag [tag]# æ–°å»ºä¸€ä¸ªtagåœ¨æŒ‡å®šcommitgit tag [tag] [commit]# åˆ é™¤æœ¬åœ°taggit tag -d [tag]# åˆ é™¤è¿œç¨‹taggit push origin :refs/tags/[tagName]# æŸ¥çœ‹tagä¿¡æ¯git show [tag]# æäº¤æŒ‡å®štaggit push [remote] [tag]# æäº¤æ‰€æœ‰taggit push [remote] --tags# æ–°å»ºä¸€ä¸ªåˆ†æ”¯ï¼ŒæŒ‡å‘æŸä¸ªtaggit checkout -b [branch] [tag] æŸ¥çœ‹ä¿¡æ¯123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960# æ˜¾ç¤ºæœ‰å˜æ›´çš„æ–‡ä»¶git status# æ˜¾ç¤ºå½“å‰åˆ†æ”¯çš„ç‰ˆæœ¬å†å²git log# æ˜¾ç¤ºcommitå†å²ï¼Œä»¥åŠæ¯æ¬¡commitå‘ç”Ÿå˜æ›´çš„æ–‡ä»¶git log --stat# æœç´¢æäº¤å†å²ï¼Œæ ¹æ®å…³é”®è¯git log -S [keyword]# æ˜¾ç¤ºæŸä¸ªcommitä¹‹åçš„æ‰€æœ‰å˜åŠ¨ï¼Œæ¯ä¸ªcommitå æ®ä¸€è¡Œgit log [tag] HEAD --pretty=format:%s# æ˜¾ç¤ºæŸä¸ªcommitä¹‹åçš„æ‰€æœ‰å˜åŠ¨ï¼Œå…¶\"æäº¤è¯´æ˜\"å¿…é¡»ç¬¦åˆæœç´¢æ¡ä»¶git log [tag] HEAD --grep feature# æ˜¾ç¤ºæŸä¸ªæ–‡ä»¶çš„ç‰ˆæœ¬å†å²ï¼ŒåŒ…æ‹¬æ–‡ä»¶æ”¹ågit log --follow [file]git whatchanged [file]# æ˜¾ç¤ºæŒ‡å®šæ–‡ä»¶ç›¸å…³çš„æ¯ä¸€æ¬¡diffgit log -p [file]# æ˜¾ç¤ºè¿‡å»5æ¬¡æäº¤git log -5 --pretty --oneline# æ˜¾ç¤ºæ‰€æœ‰æäº¤è¿‡çš„ç”¨æˆ·ï¼ŒæŒ‰æäº¤æ¬¡æ•°æ’åºgit shortlog -sn# æ˜¾ç¤ºæŒ‡å®šæ–‡ä»¶æ˜¯ä»€ä¹ˆäººåœ¨ä»€ä¹ˆæ—¶é—´ä¿®æ”¹è¿‡git blame [file]# æ˜¾ç¤ºæš‚å­˜åŒºå’Œå·¥ä½œåŒºçš„å·®å¼‚git diff# æ˜¾ç¤ºæš‚å­˜åŒºå’Œä¸Šä¸€ä¸ªcommitçš„å·®å¼‚git diff --cached [file]# æ˜¾ç¤ºå·¥ä½œåŒºä¸å½“å‰åˆ†æ”¯æœ€æ–°commitä¹‹é—´çš„å·®å¼‚git diff HEAD# æ˜¾ç¤ºä¸¤æ¬¡æäº¤ä¹‹é—´çš„å·®å¼‚git diff [first-branch]...[second-branch]# æ˜¾ç¤ºä»Šå¤©ä½ å†™äº†å¤šå°‘è¡Œä»£ç git diff --shortstat \"@&#123;0 day ago&#125;\"# æ˜¾ç¤ºæŸæ¬¡æäº¤çš„å…ƒæ•°æ®å’Œå†…å®¹å˜åŒ–git show [commit]# æ˜¾ç¤ºæŸæ¬¡æäº¤å‘ç”Ÿå˜åŒ–çš„æ–‡ä»¶git show --name-only [commit]# æ˜¾ç¤ºæŸæ¬¡æäº¤æ—¶ï¼ŒæŸä¸ªæ–‡ä»¶çš„å†…å®¹git show [commit]:[filename]# æ˜¾ç¤ºå½“å‰åˆ†æ”¯çš„æœ€è¿‘å‡ æ¬¡æäº¤git reflog è¿œç¨‹åŒæ­¥1234567891011121314151617181920212223# ä¸‹è½½è¿œç¨‹ä»“åº“çš„æ‰€æœ‰å˜åŠ¨git fetch [remote]# æ˜¾ç¤ºæ‰€æœ‰è¿œç¨‹ä»“åº“git remote -v# æ˜¾ç¤ºæŸä¸ªè¿œç¨‹ä»“åº“çš„ä¿¡æ¯git remote show [remote]# å¢åŠ ä¸€ä¸ªæ–°çš„è¿œç¨‹ä»“åº“ï¼Œå¹¶å‘½ågit remote add [shortname] [url]# å–å›è¿œç¨‹ä»“åº“çš„å˜åŒ–ï¼Œå¹¶ä¸æœ¬åœ°åˆ†æ”¯åˆå¹¶git pull [remote] [branch]# ä¸Šä¼ æœ¬åœ°æŒ‡å®šåˆ†æ”¯åˆ°è¿œç¨‹ä»“åº“git push [remote] [branch]# å¼ºè¡Œæ¨é€å½“å‰åˆ†æ”¯åˆ°è¿œç¨‹ä»“åº“ï¼Œå³ä½¿æœ‰å†²çªgit push [remote] --force# æ¨é€æ‰€æœ‰åˆ†æ”¯åˆ°è¿œç¨‹ä»“åº“git push [remote] --all æ’¤é”€12345678910111213141516171819202122232425262728293031# æ¢å¤æš‚å­˜åŒºçš„æŒ‡å®šæ–‡ä»¶åˆ°å·¥ä½œåŒºgit checkout [file]# æ¢å¤æŸä¸ªcommitçš„æŒ‡å®šæ–‡ä»¶åˆ°æš‚å­˜åŒºå’Œå·¥ä½œåŒºgit checkout [commit] [file]# æ¢å¤æš‚å­˜åŒºçš„æ‰€æœ‰æ–‡ä»¶åˆ°å·¥ä½œåŒºgit checkout .# é‡ç½®æš‚å­˜åŒºçš„æŒ‡å®šæ–‡ä»¶ï¼Œä¸ä¸Šä¸€æ¬¡commitä¿æŒä¸€è‡´ï¼Œä½†å·¥ä½œåŒºä¸å˜git reset [file]# é‡ç½®æš‚å­˜åŒºä¸å·¥ä½œåŒºï¼Œä¸ä¸Šä¸€æ¬¡commitä¿æŒä¸€è‡´git reset --hard# é‡ç½®å½“å‰åˆ†æ”¯çš„æŒ‡é’ˆä¸ºæŒ‡å®šcommitï¼ŒåŒæ—¶é‡ç½®æš‚å­˜åŒºï¼Œä½†å·¥ä½œåŒºä¸å˜git reset [commit]# é‡ç½®å½“å‰åˆ†æ”¯çš„HEADä¸ºæŒ‡å®šcommitï¼ŒåŒæ—¶é‡ç½®æš‚å­˜åŒºå’Œå·¥ä½œåŒºï¼Œä¸æŒ‡å®šcommitä¸€è‡´git reset --hard [commit]# é‡ç½®å½“å‰HEADä¸ºæŒ‡å®šcommitï¼Œä½†ä¿æŒæš‚å­˜åŒºå’Œå·¥ä½œåŒºä¸å˜git reset --keep [commit]# æ–°å»ºä¸€ä¸ªcommitï¼Œç”¨æ¥æ’¤é”€æŒ‡å®šcommit# åè€…çš„æ‰€æœ‰å˜åŒ–éƒ½å°†è¢«å‰è€…æŠµæ¶ˆï¼Œå¹¶ä¸”åº”ç”¨åˆ°å½“å‰åˆ†æ”¯git revert [commit]# æš‚æ—¶å°†æœªæäº¤çš„å˜åŒ–ç§»é™¤ï¼Œç¨åå†ç§»å…¥git stashgit stash pop å®é™…é—®é¢˜è§£å†³123456789## åˆ†æ”¯å–å¾—æ›´æ–°åˆ° master æ–‡ä»¶git checkout mastergit pull mastergit checkout wingogit merge master## è¿œç¨‹ä¿®æ”¹åˆ†æ”¯æ–‡ä»¶åçš„æœ¬åœ°æ›´æ–°git reset --hard # å¼ºåˆ¶è¦†ç›–æœ¬åœ°ç‰ˆæœ¬git pull origin wingo # åŒæ­¥è¿œç¨‹çš„åˆ†æ”¯","categories":[{"name":"å¼€å‘æ‚é¡¹","slug":"å¼€å‘æ‚é¡¹","permalink":"http://yoursite.com/categories/%E5%BC%80%E5%8F%91%E6%9D%82%E9%A1%B9/"}],"tags":[{"name":"Git","slug":"Git","permalink":"http://yoursite.com/tags/Git/"}]},{"title":"å„ç§ä¹±ç é—®é¢˜","slug":"å¼€å‘æ‚é¡¹/å„ç§ä¹±ç é—®é¢˜","date":"2020-02-01T11:38:54.000Z","updated":"2020-07-10T04:14:42.971Z","comments":true,"path":"2020/02/01/å¼€å‘æ‚é¡¹/å„ç§ä¹±ç é—®é¢˜/","link":"","permalink":"http://yoursite.com/2020/02/01/%E5%BC%80%E5%8F%91%E6%9D%82%E9%A1%B9/%E5%90%84%E7%A7%8D%E4%B9%B1%E7%A0%81%E9%97%AE%E9%A2%98/","excerpt":"åœ¨é¡¹ç›®å¼€å‘ä¸­ï¼Œå› ä¸ºå„ç§è¯­è¨€çš„ç¼–ç ä¸åŒå¸¸å¸¸ä¼šé‡åˆ°å„ç§ä¹±ç çš„é—®é¢˜ï¼Œä»¤äººç³Ÿå¿ƒï¼Œæ•…å†™ä¸€ç¯‡åšå®¢ä¸“é—¨ç”¨äºè®°å½•åšä¸»åœ¨å¼€å‘è¿‡ç¨‹é‡åˆ°çš„å„ç§ä¹±ç é—®é¢˜ã€‚","text":"åœ¨é¡¹ç›®å¼€å‘ä¸­ï¼Œå› ä¸ºå„ç§è¯­è¨€çš„ç¼–ç ä¸åŒå¸¸å¸¸ä¼šé‡åˆ°å„ç§ä¹±ç çš„é—®é¢˜ï¼Œä»¤äººç³Ÿå¿ƒï¼Œæ•…å†™ä¸€ç¯‡åšå®¢ä¸“é—¨ç”¨äºè®°å½•åšä¸»åœ¨å¼€å‘è¿‡ç¨‹é‡åˆ°çš„å„ç§ä¹±ç é—®é¢˜ã€‚ Tomcat æ§åˆ¶å°ä¹±ç åˆ° Tomcat /conf /logging.properties ä¸­ä¿®æ”¹æ­¤é¡¹java.util.logging.ConsoleHandler.encodingä¸º GBKã€‚","categories":[{"name":"å¼€å‘æ‚é¡¹","slug":"å¼€å‘æ‚é¡¹","permalink":"http://yoursite.com/categories/%E5%BC%80%E5%8F%91%E6%9D%82%E9%A1%B9/"}],"tags":[{"name":"ä¹±ç ","slug":"ä¹±ç ","permalink":"http://yoursite.com/tags/%E4%B9%B1%E7%A0%81/"}]},{"title":"Chatroom ç®€ä»‹","slug":"é¡¹ç›®å¼€å‘/èŠå¤©å®¤é¡¹ç›®","date":"2020-01-31T04:16:27.000Z","updated":"2020-07-10T03:56:15.344Z","comments":true,"path":"2020/01/31/é¡¹ç›®å¼€å‘/èŠå¤©å®¤é¡¹ç›®/","link":"","permalink":"http://yoursite.com/2020/01/31/%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91/%E8%81%8A%E5%A4%A9%E5%AE%A4%E9%A1%B9%E7%9B%AE/","excerpt":"ä¸€ä¸ªç½‘é¡µç‰ˆçš„çº¿ä¸ŠèŠå¤©å®¤","text":"ä¸€ä¸ªç½‘é¡µç‰ˆçš„çº¿ä¸ŠèŠå¤©å®¤ é¡¹ç›®ç®€ä»‹é¡¹ç›®åŸºæœ¬æ€è·¯æ­¤é¡¹ç›®ä»¥ Tomcat ä½œä¸ºæ ¸å¿ƒæœåŠ¡å™¨ç”¨äºå¤„ç†å®¢æˆ·ç™»å½•ã€ä¸ªäººä¿¡æ¯ç®¡ç†ç­‰ HTTP ç±»å‹çš„è¯·æ±‚ï¼Œç«¯å£å·ï¼š8080ã€‚ åœ¨ Tomcat æœåŠ¡å™¨ä¸­å¦å¼€ä¸€ä¸ªçº¿ç¨‹å¯åŠ¨ Netty WebSocket æœåŠ¡å™¨ç”¨äºå¤„ç†ç”¨æˆ·æ¶ˆæ¯é€šä¿¡çš„ WebSocket ç±»å‹çš„è¯·æ±‚ï¼Œç«¯å£å·ï¼š3333ã€‚ ç”¨æˆ·ç™»å½•åï¼š Tomcat æœåŠ¡å™¨ä¼šè¿”å›ç”¨æˆ·çš„ä¸ªäººä¿¡æ¯ï¼ŒåŒæ—¶æ›´æ–°è®°å½•åœ¨çº¿ç”¨æˆ·ï¼Œæ ¹æ®ç”¨æˆ· id å»ºç«‹ä¸€æ¡ WebSocket è¿æ¥å¹¶ä¿å­˜åœ¨åç«¯ä»¥ä¾¿è¿›è¡Œå®æ—¶é€šä¿¡ã€‚ æµè§ˆå™¨å°†ç»´æŒä¸€ä¸ª Session å¯¹è±¡æ¥ä¿æŒç™»å½•çŠ¶æ€ï¼ˆ30 minï¼‰ã€‚ ç”¨æˆ·ä¸ç”¨æˆ·è¿›è¡Œé€šä¿¡ï¼š æœåŠ¡å™¨æ ¹æ®æ”¶åˆ°çš„æ¶ˆæ¯å†…å®¹ä¸­çš„å¯¹è¯æ–¹çš„ç”¨æˆ· id æ‰¾åˆ°ä¿å­˜çš„ WebSocket è¿æ¥ï¼Œé€šè¿‡è¯¥è¿æ¥å‘é€æ¶ˆæ¯ã€‚ ç”¨æˆ·é€€å‡ºï¼š é‡Šæ”¾ç”¨æˆ·çš„ WebSocket è¿æ¥ã€‚ æ¸…ç©ºç”¨æˆ·åœ¨ Session å¯¹è±¡ä¸­çš„ç™»é™†çŠ¶æ€ã€‚ ç³»ç»ŸåŠŸèƒ½æ¨¡å—ç™»å½•æ¨¡å—ï¼šç”¨æˆ·ç™»å½•ã€ç”¨æˆ·æ³¨é”€ã€‚ èŠå¤©ç®¡ç†æ¨¡å—ï¼šå•æ¡æ¶ˆæ¯å‘é€ã€ç¾¤ç»„æ¶ˆæ¯å‘é€ã€‚ï¼ˆæ¶ˆæ¯ï¼šæ–‡æœ¬ã€æ–‡ä»¶ï¼‰ æœåŠ¡å™¨pom.xml 123456789101112131415161718192021222324&lt;!-- netty4 --&gt;&lt;dependency&gt; &lt;groupId&gt;io.netty&lt;/groupId&gt; &lt;artifactId&gt;netty-all&lt;/artifactId&gt; &lt;version&gt;4.1.2.Final&lt;/version&gt;&lt;/dependency&gt;&lt;build&gt; &lt;finalName&gt;WebSocket&lt;/finalName&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt; &lt;version&gt;3.6.2&lt;/version&gt; &lt;configuration&gt; &lt;source&gt;1.8&lt;/source&gt; &lt;target&gt;1.8&lt;/target&gt; &lt;optimize&gt;true&lt;/optimize&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;/plugins&gt;&lt;/build&gt; è‡ªå®šä¹‰ WebSocket æœåŠ¡å™¨æœåŠ¡å™¨ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081public class WebSocketServer implements Runnable &#123; private final Logger logger = LoggerFactory.getLogger(WebSocketServer.class); @Autowired private EventLoopGroup bossGroup; @Autowired private EventLoopGroup workerGroup; @Autowired private ServerBootstrap serverBootstrap; // port å’Œ childChannelHandler ç”¨ Xml çš„æ–¹å¼é…ç½®ï¼Œéœ€è¦ getter/setter æ–¹æ³• private int port; private ChannelHandler childChannelHandler; private ChannelFuture serverChannelFuture; public WebSocketServer() &#123; &#125; @Override public void run() &#123; build(); &#125; // å¯åŠ¨Netty WebsocketæœåŠ¡å™¨ public void build() &#123; try &#123; long begin = System.currentTimeMillis(); serverBootstrap.group(bossGroup, workerGroup) // boss è´Ÿè´£å®¢æˆ·ç«¯çš„ TCP è¿æ¥è¯·æ±‚ worker è´Ÿè´£ä¸å®¢æˆ·ç«¯ä¹‹å‰çš„è¯»å†™æ“ä½œ .channel(NioServerSocketChannel.class) // é…ç½®å®¢æˆ·ç«¯çš„ channel ç±»å‹ .option(ChannelOption.SO_BACKLOG, 1024) // è®¾ç½®è¯·æ±‚é˜Ÿåˆ—çš„é•¿åº¦ .option(ChannelOption.TCP_NODELAY, true) // é™ä½å»¶è¿Ÿ .childOption(ChannelOption.SO_KEEPALIVE, true) // ä¸¤å°æ—¶æ— æ´»åŠ¨æ£€æµ‹å¿ƒè·³ .childOption(ChannelOption.RCVBUF_ALLOCATOR, new FixedRecvByteBufAllocator(592048)) // é…ç½®å›ºå®šé•¿åº¦æ¥æ”¶ç¼“å­˜åŒºåˆ†é…å™¨ .childHandler(childChannelHandler); // ç»‘å®š I/O äº‹ä»¶çš„å¤„ç†ç±»ï¼ŒWebSocketChildChannelHandler ä¸­å®šä¹‰ long end = System.currentTimeMillis(); logger.info(\"Netty WebsocketæœåŠ¡å™¨å¯åŠ¨å®Œæˆï¼Œè€—æ—¶ \" + (end - begin) + \" msï¼Œå·²ç»‘å®šç«¯å£ \" + port + \" é˜»å¡å¼ç­‰å€™å®¢æˆ·ç«¯è¿æ¥\"); serverChannelFuture = serverBootstrap.bind(port).sync(); &#125; catch (Exception e) &#123; logger.info(e.getMessage()); bossGroup.shutdownGracefully(); workerGroup.shutdownGracefully(); e.printStackTrace(); &#125; &#125; // å…³é—­ WebSocket æœåŠ¡å™¨ public void close()&#123; serverChannelFuture.channel().close(); Future&lt;?&gt; bossGroupFuture = bossGroup.shutdownGracefully(); Future&lt;?&gt; workerGroupFuture = workerGroup.shutdownGracefully(); try &#123; bossGroupFuture.await(); workerGroupFuture.await(); &#125; catch (InterruptedException ignore) &#123; ignore.printStackTrace(); &#125; &#125; public ChannelHandler getChildChannelHandler() &#123; return childChannelHandler; &#125; public void setChildChannelHandler(ChannelHandler childChannelHandler) &#123; this.childChannelHandler = childChannelHandler; &#125; public int getPort() &#123; return port; &#125; public void setPort(int port) &#123; this.port = port; &#125;&#125; æ•°æ®å¤„ç†ç±» 1234567891011121314151617181920@Componentpublic class WebSocketChildChannelHandler extends ChannelInitializer&lt;SocketChannel&gt;&#123; @Resource(name = \"webSocketServerHandler\") private ChannelHandler webSocketServerHandler; @Resource(name = \"httpRequestHandler\") private ChannelHandler httpRequestHandler; // åˆå§‹åŒ–é€šé“ï¼Œè£…è½½ä¸Šæ‰€éœ€è¦çš„å¤„ç†å™¨ @Override protected void initChannel(SocketChannel ch) throws Exception &#123; ch.pipeline().addLast(\"http-codec\", new HttpServerCodec()); // HTTPç¼–ç è§£ç å™¨ ch.pipeline().addLast(\"aggregator\", new HttpObjectAggregator(65536)); // åˆå¹¶åˆ†æ‰¹æ¬¡è¿‡æ¥çš„ HTTP æŠ¥æ–‡ï¼Œåˆå¹¶å Handleræ‹¿åˆ°çš„å°†æ˜¯ä¸€ä¸ªå®Œæ•´çš„ HTTP æŠ¥æ–‡ ch.pipeline().addLast(\"http-chunked\", new ChunkedWriteHandler()); // æ–¹ä¾¿å¤§æ–‡ä»¶ä¼ è¾“ï¼Œä¸è¿‡å®è´¨ä¸Šéƒ½æ˜¯çŸ­çš„æ–‡æœ¬æ•°æ® ch.pipeline().addLast(\"http-handler\", httpRequestHandler); // ç»‘å®šè‡ªå®šä¹‰çš„ Http è¯·æ±‚å¤„ç†å™¨ ch.pipeline().addLast(\"websocket-handler\",webSocketServerHandler); // ç»‘å®šè‡ªå®šä¹‰çš„ WebSocket è¯·æ±‚å¤„ç†å™¨ &#125;&#125; è‡ªå®šä¹‰ Http è¯·æ±‚å¤„ç†ç±» 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859@Component@Sharablepublic class HttpRequestHandler extends SimpleChannelInboundHandler&lt;Object&gt; &#123; @Override protected void channelRead0(ChannelHandlerContext ctx, Object msg) throws Exception &#123; if (msg instanceof FullHttpRequest) &#123; // å¤„ç† Http è¯·æ±‚ handleHttpRequest(ctx, (FullHttpRequest) msg); &#125; else if (msg instanceof WebSocketFrame) &#123; // retain() å¢åŠ  ByteBuf çš„å¼•ç”¨è®¡æ•°ï¼ŒfireChannelRead é€šçŸ¥éœ€è¦ç»§ç»­è°ƒç”¨é“¾è¡¨åé¢çš„ channelRead ctx.fireChannelRead(((WebSocketFrame) msg).retain()); &#125; &#125; // å¤„ç† Http è¯·æ±‚ï¼Œä¸»è¦æ˜¯å®Œæˆ HTTP åè®®åˆ° Websocket åè®®çš„å‡çº§ private void handleHttpRequest(ChannelHandlerContext ctx, FullHttpRequest req) &#123; if (!req.decoderResult().isSuccess()) &#123; sendHttpResponse(ctx, req, new DefaultFullHttpResponse(HttpVersion.HTTP_1_1, HttpResponseStatus.BAD_REQUEST)); return; &#125; // æ„é€ æ¡æ‰‹å·¥å‚ WebSocketServerHandshakerFactory wsFactory = new WebSocketServerHandshakerFactory( \"ws:/\" + ctx.channel() + \"/websocket\", null, false); // åˆ›å»ºæ¡æ‰‹å¤„ç†ç±» WebSocketServerHandshaker handshaker = wsFactory.newHandshaker(req); // å°†æ­¤è¿æ¥ä¿å­˜åˆ°ä¸€ä¸ªå…¨å±€ Map ä¸­ï¼Œç”¨æˆ·é€€å‡ºç™»é™†æ—¶è¦ç§»é™¤æ­¤å¤„ç†ç±» Constant.webSocketHandshakerMap.put(ctx.channel().id().asLongText(), handshaker); if (handshaker == null) &#123; WebSocketServerHandshakerFactory.sendUnsupportedVersionResponse(ctx.channel()); &#125; else &#123; // æ„é€ æ¡æ‰‹å“åº”æ¶ˆæ¯è¿”å›ç»™å®¢æˆ·ç«¯ // å°† WebSocket ç›¸å…³çš„ç¼–ç å’Œè§£ç ç±»åŠ¨æ€æ·»åŠ åˆ° ChannelPipeline ä¸­ç”¨äº WebSocket æ¶ˆæ¯çš„ç¼–è§£ç  handshaker.handshake(ctx.channel(), req); &#125; &#125; private void sendHttpResponse(ChannelHandlerContext ctx, FullHttpRequest req, DefaultFullHttpResponse res) &#123; // è¿”å›åº”ç­”ç»™å®¢æˆ·ç«¯ if (res.status().code() != 200) &#123; ByteBuf buf = Unpooled.copiedBuffer(res.status().toString(), CharsetUtil.UTF_8); res.content().writeBytes(buf); buf.release(); &#125; // å¦‚æœæ˜¯éKeep-Aliveï¼Œå…³é—­è¿æ¥ boolean keepAlive = HttpUtil.isKeepAlive(req); ChannelFuture f = ctx.channel().writeAndFlush(res); if (!keepAlive) &#123; f.addListener(ChannelFutureListener.CLOSE); &#125; &#125; @Override public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception &#123; cause.printStackTrace(); ctx.close(); &#125;&#125; è‡ªå®šä¹‰ WebSocket è¯·æ±‚å¤„ç†ç±» 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394959697@Component@Sharablepublic class WebSocketServerHandler extends SimpleChannelInboundHandler&lt;WebSocketFrame&gt; &#123; private static final Logger LOGGER = LoggerFactory.getLogger(WebSocketServerHandler.class); @Autowired private ChatService chatService; // å¯¹ WebSocket çš„è¯·æ±‚æ¶ˆæ¯è¿›è¡Œå¤„ç† @Override protected void channelRead0(ChannelHandlerContext ctx, WebSocketFrame msg) throws Exception &#123; handlerWebSocketFrame(ctx, msg); &#125; private void handlerWebSocketFrame(ChannelHandlerContext ctx, WebSocketFrame frame) throws Exception &#123; // å…³é—­è¯·æ±‚ if (frame instanceof CloseWebSocketFrame) &#123; WebSocketServerHandshaker handshaker = Constant.webSocketHandshakerMap.get(ctx.channel().id().asLongText()); if (handshaker == null) &#123; sendErrorMessage(ctx, \"ä¸å­˜åœ¨çš„å®¢æˆ·ç«¯è¿æ¥ï¼\"); &#125; else &#123; handshaker.close(ctx.channel(), (CloseWebSocketFrame) frame.retain()); &#125; return; &#125; // pingè¯·æ±‚ if (frame instanceof PingWebSocketFrame) &#123; ctx.channel().write(new PongWebSocketFrame(frame.content().retain())); return; &#125; // åªæ”¯æŒæ–‡æœ¬æ ¼å¼ï¼Œä¸æ”¯æŒäºŒè¿›åˆ¶æ¶ˆæ¯ if (!(frame instanceof TextWebSocketFrame)) &#123; sendErrorMessage(ctx, \"ä»…æ”¯æŒæ–‡æœ¬(Text)æ ¼å¼ï¼Œä¸æ”¯æŒäºŒè¿›åˆ¶æ¶ˆæ¯\"); &#125; // å®¢æœç«¯å‘é€è¿‡æ¥çš„æ¶ˆæ¯ String request = ((TextWebSocketFrame)frame).text(); LOGGER.info(\"æœåŠ¡ç«¯æ”¶åˆ°æ–°ä¿¡æ¯ï¼š\" + request); JSONObject param = null; try &#123; param = JSONObject.parseObject(request); &#125; catch (Exception e) &#123; sendErrorMessage(ctx, \"JSONå­—ç¬¦ä¸²è½¬æ¢å‡ºé”™ï¼\"); e.printStackTrace(); &#125; if (param == null) &#123; sendErrorMessage(ctx, \"å‚æ•°ä¸ºç©ºï¼\"); return; &#125; String type = (String) param.get(\"type\"); switch (type) &#123; case \"REGISTER\": chatService.register(param, ctx); break; case \"SINGLE_SENDING\": chatService.singleSend(param, ctx); break; case \"GROUP_SENDING\": chatService.groupSend(param, ctx); break; case \"FILE_MSG_SINGLE_SENDING\": chatService.FileMsgSingleSend(param, ctx); break; case \"FILE_MSG_GROUP_SENDING\": chatService.FileMsgGroupSend(param, ctx); break; default: chatService.typeError(ctx); break; &#125; &#125; // å®¢æˆ·ç«¯æ–­å¼€è¿æ¥ @Override public void channelInactive(ChannelHandlerContext ctx) throws Exception &#123; chatService.remove(ctx); &#125; // å‡ºç°å¼‚å¸¸å…³é—­é€šé“ @Override public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception &#123; cause.printStackTrace(); ctx.close(); &#125; private void sendErrorMessage(ChannelHandlerContext ctx, String errorMsg) &#123; String responseJson = new ResponseJson() .error(errorMsg) .toString(); ctx.channel().writeAndFlush(new TextWebSocketFrame(responseJson)); &#125;&#125; æ•´åˆ WebSocket æœåŠ¡å™¨å…ˆæ¥çœ‹çœ‹é¡¹ç›®çš„æœåŠ¡å™¨æ„æˆã€‚ Tomcat æ˜¯ä¸€ä¸ªå…è´¹çš„å¼€æ”¾æºä»£ç çš„ Servlet å®¹å™¨ å›é¡¾ä¸€ä¸‹ Servlet çš„ç”Ÿå‘½å‘¨æœŸã€‚ è¦æŠŠ Netty WebSocket æœåŠ¡å™¨æ•´åˆåˆ° Tomcat æœåŠ¡å™¨ä¸­ï¼Œé‚£ä¹ˆå°±éœ€è¦åœ¨ Servlet åˆå§‹åŒ–ä¹‹å‰å‘Šè¯‰å…¶æ‰€éœ€è¦è¿›è¡Œçš„æ“ä½œã€‚å†™ä¸€ä¸ª@PostConstructæ³¨è§£æ–¹æ³•å¼€å¯ä¸€ä¸ªç‹¬ç«‹çº¿ç¨‹ç”¨äºå¯åŠ¨ Netty WebSocket æœåŠ¡å™¨ï¼›å¹¶ä¸”å†™ä¸€ä¸ª@PreDestoryæ³¨è§£æ–¹æ³•åœ¨ Servlet å®Œå…¨å…³é—­ä¹‹å‰å…³é—­ WebSocket æœåŠ¡å™¨ã€‚ 1234567891011121314151617181920212223242526@Component@Scope(\"singleton\")public class AppContext &#123; private final Logger logger = LoggerFactory.getLogger(AppContext.class); @Autowired private WebSocketServer webSocketServer; private Thread nettyThread; @PostConstruct public void init() &#123; nettyThread = new Thread(webSocketServer); logger.info(\"å¼€å¯ç‹¬ç«‹çº¿ç¨‹ï¼Œå¯åŠ¨ Netty WebSocket æœåŠ¡å™¨...\"); nettyThread.start(); &#125; @PreDestroy public void close() &#123; logger.info(\"æ­£åœ¨é‡Šæ”¾Netty Websocketç›¸å…³è¿æ¥...\"); webSocketServer.close(); logger.info(\"æ­£åœ¨å…³é—­Netty WebsocketæœåŠ¡å™¨çº¿ç¨‹...\"); nettyThread.stop(); logger.info(\"ç³»ç»ŸæˆåŠŸå…³é—­ï¼\"); &#125;&#125; åœ¨æ‰§è¡Œè¿™ä¸ªæ–¹æ³•ä¹‹å‰ï¼ŒTomcat å·²ç»åŠ è½½å®Œé…ç½®æ–‡ä»¶ï¼Œè¿™é‡Œçš„ WebSocket æœåŠ¡å™¨æ˜¯é€šè¿‡@AutoWiredè£…è½½è¿›æ¥çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ WebSocket éœ€è¦åœ¨ Spring å®¹å™¨ä¸­æ³¨å†Œæˆä¸ºä¸€ä¸ª Beanã€‚ ApplicationContext-netty.xml 1234567891011121314&lt;!-- æ‰«æå…³äº Netty Websocket çš„åŒ… --&gt;&lt;context:component-scan base-package=\"com.wingo.web.websocket\"/&gt;&lt;!-- æŠŠ Netty çš„ä¸€äº›ç±»æœåŠ¡å™¨æ³¨å†Œåˆ° Springï¼Œæ–¹ä¾¿å¤„ç†å’Œæ‰©å±• --&gt;&lt;!-- ç”¨äºå¤„ç†å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚ --&gt;&lt;bean id=\"bossGroup\" class=\"io.netty.channel.nio.NioEventLoopGroup\"/&gt;&lt;!-- ç”¨äºå¤„ç†å®¢æˆ·ç«¯ I/O æ“ä½œ --&gt;&lt;bean id=\"workerGroup\" class=\"io.netty.channel.nio.NioEventLoopGroup\"/&gt;&lt;!-- æœåŠ¡å™¨å¯åŠ¨å¼•å¯¼ç±» --&gt;&lt;bean id=\"serverBootstrap\" class=\"io.netty.bootstrap.ServerBootstrap\" scope=\"prototype\"/&gt;&lt;!-- è‡ªå®šä¹‰çš„Netty WebsocketæœåŠ¡å™¨ --&gt;&lt;bean id=\"webSocketServer\" class=\"com.wingo.web.websocket.WebSocketServer\"&gt; &lt;property name=\"port\" value=\"3333\"/&gt; &lt;property name=\"childChannelHandler\" ref=\"webSocketChildChannelHandler\" /&gt;&lt;/bean&gt; Mybatisé¡¹ç›®ç›®å½• Modelï¼š po/User.java ç”¨æˆ·å®ä½“ Dao UserDao.java ç”¨æˆ·æ•°æ®è®¿é—®å¯¹è±¡ Service UserService.java ç”¨æˆ·ä¸šåŠ¡é€»è¾‘ UserServiceImpl.java Xml UserMapper.xml æŒä¹…å±‚ / å¯¹è±¡å…³ç³»æ˜ å°„æ–‡ä»¶ ApplicationContext-dao.xml ApplicationContext-service.xml MybatisConfig.xml pom.xml Properties jdbc.properties æ•°æ®åº“é…ç½®æ–‡ä»¶ é¡¹ç›®æ­å»ºpom.xml æ·»åŠ  Mybatis ç›¸å…³ä¾èµ–åŒ… 12345678910111213141516171819202122232425&lt;!-- MySQL --&gt;&lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;5.1.6&lt;/version&gt;&lt;/dependency&gt;&lt;!-- c3p0 è¿æ¥æ±  --&gt;&lt;dependency&gt; &lt;groupId&gt;c3p0&lt;/groupId&gt; &lt;artifactId&gt;c3p0&lt;/artifactId&gt; &lt;version&gt;0.9.1.2&lt;/version&gt;&lt;/dependency&gt;&lt;!-- Mybatis --&gt;&lt;dependency&gt; &lt;groupId&gt;org.mybatis&lt;/groupId&gt; &lt;artifactId&gt;mybatis&lt;/artifactId&gt; &lt;version&gt;3.2.2&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.mybatis&lt;/groupId&gt; &lt;artifactId&gt;mybatis-spring&lt;/artifactId&gt; &lt;version&gt;1.3.0&lt;/version&gt;&lt;/dependency&gt; æ•°æ®åº“çš„å»ºç«‹ 123456CREATE TABLE `user` ( `user_id` int(11) NOT NULL AUTO_INCREMENT, `user_name` varchar(64) DEFAULT NULL, `password` varchar(64) DEFAULT NULL, PRIMARY KEY (`user_id`)) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8 ç”¨æˆ·å®ä½“ç±» 123456789101112131415161718192021222324252627282930313233343536373839public class User &#123; private Long userId; private String userName; private String password; public Long getUserId() &#123; return userId; &#125; public void setUserId(Long userId) &#123; this.userId = userId; &#125; public String getUserName() &#123; return userName; &#125; public void setUserName(String userName) &#123; this.userName = userName; &#125; public String getPassword() &#123; return password; &#125; public void setPassword(String password) &#123; this.password = password; &#125; @Override public String toString() &#123; return \"User&#123;\" + \"userId='\" + userId + '/'' + \", username='\" + userName + '/'' + \", password='\" + password + '/'' + '&#125;'; &#125;&#125; æ•°æ®è®¿é—®ç±» 1234567public interface UserDao &#123; // ä¿å­˜ç”¨æˆ·ä¿¡æ¯ void saveUser(User user); // é€šè¿‡ id å–å¾—ç”¨æˆ·ä¿¡æ¯ User queryById(long user);&#125; å¯¹è±¡ / æŒä¹…å±‚æ˜ å°„æ–‡ä»¶ 1234567891011121314151617181920212223&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;!DOCTYPE mapper PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"&gt;&lt;mapper namespace=\"wingo.dao.UserDao\"&gt; &lt;insert id=\"saveUser\" parameterType=\"wingo.model.po.User\" useGeneratedKeys=\"true\" keyProperty=\"userId\"&gt; INSERT INTO user (user_name,password) VALUES (#&#123;userName&#125;,#&#123;password&#125;) &lt;/insert&gt; &lt;select id=\"queryById\" parameterType=\"long\" resultType=\"wingo.model.po.User\" &gt; &lt;!-- å…·ä½“çš„sql --&gt; SELECT user_id,user_name,password FROM user WHERE user_id = #&#123;userId&#125; &lt;/select&gt;&lt;/mapper&gt; ä¸šåŠ¡é€»è¾‘ç±» 12345public interface UserService &#123; void saveUser(User user); User queryById(long userId);&#125; ä¸šåŠ¡é€»è¾‘ç±»çš„å®ç° 123456789101112131415public class UserServiceImpl implements UserService &#123; private Logger logger= LoggerFactory.getLogger(this.getClass()); @Autowired private UserDao userDao; public void saveUser(User user) &#123; userDao.saveUser(user); &#125; public User queryById(long userId) &#123; return userDao.queryById(userId); &#125;&#125; æ•°æ®åº“ä¿¡æ¯é…ç½® jdbc.properties 1234jdbc.driver=com.mysql.jdbc.Driverjdbc.url=jdbc:mysql://127.0.0.1:3306/nettychatroom?useUnicode=true&amp;characterEncoding=utf8jdbc.username=rootjdbc.password= 123456 Mybatis é…ç½® 1234567891011121314151617181920&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;&lt;!DOCTYPE configuration PUBLIC \"-//mybatis.org//DTD Config 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-config.dtd\"&gt;&lt;configuration&gt; &lt;!-- é…ç½®å…¨å±€å±æ€§ --&gt; &lt;settings&gt; &lt;!-- ä½¿ç”¨jdbcçš„getGeneratedKeysè·å–æ•°æ®åº“è‡ªå¢ä¸»é”®å€¼ --&gt; &lt;setting name=\"useGeneratedKeys\" value=\"true\" /&gt; &lt;!-- ä½¿ç”¨åˆ—åˆ«åæ›¿æ¢åˆ—å é»˜è®¤:true --&gt; &lt;setting name=\"useColumnLabel\" value=\"true\" /&gt; &lt;!-- å¼€å¯é©¼å³°å‘½åè½¬æ¢:Table&#123;create_time&#125; -&gt; Entity&#123;createTime&#125; --&gt; &lt;setting name=\"mapUnderscoreToCamelCase\" value=\"true\" /&gt; &lt;!-- å¼€å¯æ§åˆ¶å°æ‰“å° SQL è¯­å¥ --&gt; &lt;setting name=\"logImpl\" value=\"STDOUT_LOGGING\" /&gt; &lt;/settings&gt;&lt;/configuration&gt; æ•°æ®è®¿é—®å±‚ä¸Šä¸‹æ–‡é…ç½® ApplicationContext-dao.xml 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;beans xmlns=\"http://www.springframework.org/schema/beans\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:context=\"http://www.springframework.org/schema/context\" xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd\"&gt; &lt;!-- é…ç½®æ•´åˆmybatisè¿‡ç¨‹ --&gt; &lt;!-- 1.é…ç½®æ•°æ®åº“ç›¸å…³å‚æ•°propertiesçš„å±æ€§ï¼š$&#123;url&#125; --&gt; &lt;context:property-placeholder location=\"classpath:jdbc.properties\" /&gt; &lt;!-- 2.æ•°æ®åº“è¿æ¥æ±  --&gt; &lt;bean id=\"dataSource\" class=\"com.mchange.v2.c3p0.ComboPooledDataSource\"&gt; &lt;!-- é…ç½®è¿æ¥æ± å±æ€§ --&gt; &lt;property name=\"driverClass\" value=\"$&#123;jdbc.driver&#125;\" /&gt; &lt;property name=\"jdbcUrl\" value=\"$&#123;jdbc.url&#125;\" /&gt; &lt;property name=\"user\" value=\"$&#123;jdbc.username&#125;\" /&gt; &lt;property name=\"password\" value=\"$&#123;jdbc.password&#125;\" /&gt; &lt;!-- c3p0è¿æ¥æ± çš„ç§æœ‰å±æ€§ --&gt; &lt;property name=\"maxPoolSize\" value=\"30\" /&gt; &lt;property name=\"minPoolSize\" value=\"10\" /&gt; &lt;!-- å…³é—­è¿æ¥åä¸è‡ªåŠ¨commit --&gt; &lt;property name=\"autoCommitOnClose\" value=\"false\" /&gt; &lt;!-- è·å–è¿æ¥è¶…æ—¶æ—¶é—´ --&gt; &lt;property name=\"checkoutTimeout\" value=\"10000\" /&gt; &lt;!-- å½“è·å–è¿æ¥å¤±è´¥é‡è¯•æ¬¡æ•° --&gt; &lt;property name=\"acquireRetryAttempts\" value=\"2\" /&gt; &lt;/bean&gt; &lt;!-- 3.é…ç½®SqlSessionFactoryå¯¹è±¡ --&gt; &lt;bean id=\"sqlSessionFactory\" class=\"org.mybatis.spring.SqlSessionFactoryBean\"&gt; &lt;!-- æ³¨å…¥æ•°æ®åº“è¿æ¥æ±  --&gt; &lt;property name=\"dataSource\" ref=\"dataSource\" /&gt; &lt;!-- é…ç½®MyBatieså…¨å±€é…ç½®æ–‡ä»¶:mybatis-config.xml --&gt; &lt;property name=\"configLocation\" value=\"classpath:MybatisConfig.xml\" /&gt; &lt;!-- æ‰«æentityåŒ…ï¼Œä½¿ç”¨åˆ«å --&gt; &lt;property name=\"typeAliasesPackage\" value=\"wingo.dao\" /&gt; &lt;!-- æ‰«æsqlé…ç½®æ–‡ä»¶:mapperéœ€è¦çš„xmlæ–‡ä»¶ --&gt; &lt;property name=\"mapperLocations\" value=\"classpath:mapper/*.xml\" /&gt; &lt;/bean&gt; &lt;!-- 4.é…ç½®æ‰«æDaoæ¥å£åŒ…ï¼ŒåŠ¨æ€å®ç°Daoæ¥å£ï¼Œæ³¨å…¥åˆ°springå®¹å™¨ä¸­ --&gt; &lt;bean class=\"org.mybatis.spring.mapper.MapperScannerConfigurer\"&gt; &lt;!-- æ³¨å…¥sqlSessionFactory --&gt; &lt;property name=\"sqlSessionFactoryBeanName\" value=\"sqlSessionFactory\" /&gt; &lt;!-- ç»™å‡ºéœ€è¦æ‰«æDaoæ¥å£åŒ… --&gt; &lt;property name=\"basePackage\" value=\"wingo.dao\" /&gt; &lt;/bean&gt;&lt;/beans&gt; ä¸šåŠ¡é€»è¾‘å±‚ä¸Šä¸‹æ–‡é…ç½® 12345678910111213141516171819202122&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;beans xmlns=\"http://www.springframework.org/schema/beans\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:context=\"http://www.springframework.org/schema/context\" xmlns:tx=\"http://www.springframework.org/schema/tx\" xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd\"&gt; &lt;!-- æ‰«æserviceåŒ…ä¸‹æ‰€æœ‰ä½¿ç”¨æ³¨è§£çš„ç±»å‹ --&gt; &lt;context:component-scan base-package=\"wingo.service\"/&gt; &lt;!-- é…ç½®äº‹åŠ¡ç®¡ç†å™¨ --&gt; &lt;bean id=\"transactionManager\" class=\"org.springframework.jdbc.datasource.DataSourceTransactionManager\"&gt; &lt;!-- æ³¨å…¥æ•°æ®åº“è¿æ¥æ±  --&gt; &lt;property name=\"dataSource\" ref=\"dataSource\" /&gt; &lt;/bean&gt; &lt;!-- é…ç½®åŸºäºæ³¨è§£çš„å£°æ˜å¼äº‹åŠ¡ --&gt; &lt;tx:annotation-driven/&gt;&lt;/beans&gt; Junit 4 æµ‹è¯•Junit 4 æ•´åˆå¼•å…¥ä¾èµ– 1234567&lt;!-- Junit --&gt;&lt;dependency&gt; &lt;groupId&gt;junit&lt;/groupId&gt; &lt;artifactId&gt;junit&lt;/artifactId&gt; &lt;version&gt;4.12&lt;/version&gt; &lt;!--&lt;scope&gt;test&lt;/scope&gt;--&gt;&lt;/dependency&gt; æµ‹è¯•åŸºç±» 123456789@RunWith(SpringJUnit4ClassRunner.class) //ä½¿ç”¨junit4è¿›è¡Œæµ‹è¯•@ContextConfiguration(locations=&#123; \"classpath:spring/ApplicationContext-dao.xml\", \"classpath:spring/ApplicationContext-service.xml\"&#125;) //åŠ è½½é…ç½®æ–‡ä»¶public class BaseJunit4Test &#123;&#125; æµ‹è¯•ç±» 12345678910111213141516171819202122public class UserTest extends BaseJunit4Test&#123; @Autowired private UserService userService; @Test @Transactional //æ ‡æ˜æ­¤æ–¹æ³•éœ€ä½¿ç”¨äº‹åŠ¡ @Rollback(false) //æ ‡æ˜ä½¿ç”¨å®Œæ­¤æ–¹æ³•åäº‹åŠ¡ä¸å›æ»š,trueæ—¶ä¸ºå›æ»š public void test()&#123; System.out.println(\"æµ‹è¯•Springæ•´åˆJunit4è¿›è¡Œå•å…ƒæµ‹è¯•\"); // User user = new User(); // user.setUserName(\"test1\"); // user.setPassword(\"111\"); // userService.saveUser(user); User user = userService.queryById(1); System.out.println(user.toString()); &#125;&#125; æµ‹è¯•ç»“æœ Spring MVC é¡¹ç›®ç»“æ„ Viewï¼š longin.html ç”¨æˆ·ç™»å½•é¡µé¢ chatroom.html èŠå¤©å®¤é¡µé¢ Controller UserController.java LoginController.java Xml ApplicationContext-mvc.xml web.xml pom.xml é¡¹ç›®æ­å»ºpom.xml æ·»åŠ  Spring å…¨å®¶æ¡¶ä¾èµ–ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465&lt;properties&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;&lt;/properties&gt;&lt;dependencies&gt; &lt;!-- Spring --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-core&lt;/artifactId&gt; &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-context&lt;/artifactId&gt; &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-web&lt;/artifactId&gt; &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt; &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-orm&lt;/artifactId&gt; &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-tx&lt;/artifactId&gt; &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-test&lt;/artifactId&gt; &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-jdbc&lt;/artifactId&gt; &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-expression&lt;/artifactId&gt; &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-aop&lt;/artifactId&gt; &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-context-support&lt;/artifactId&gt; &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; web.xml ä¸­å°†è¯·æ±‚äº¤ç»™ SpringMVC å¤„ç† 12345678910111213141516&lt;!-- å‰ç«¯æ§åˆ¶å™¨ --&gt;&lt;servlet&gt; &lt;servlet-name&gt;SpringMVC&lt;/servlet-name&gt; &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet &lt;/servlet-class&gt; &lt;init-param&gt; &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt; &lt;param-value&gt;classpath:spring/ApplicationContext-mvc.xml&lt;/param-value&gt; &lt;/init-param&gt; &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;&lt;/servlet&gt;&lt;servlet-mapping&gt; &lt;servlet-name&gt;SpringMVC&lt;/servlet-name&gt; &lt;url-pattern&gt;/&lt;/url-pattern&gt;&lt;/servlet-mapping&gt; å¯¹ SpringMVC è¿›è¡Œé…ç½® 12345678910111213141516171819202122232425262728293031323334&lt;!-- MVC è´Ÿè´£æ‰«æ Controller --&gt;&lt;context:component-scan base-package=\"wingo.web.controller\"/&gt;&lt;!-- å¯åŠ¨ Spring MVC çš„æ³¨è§£åŠŸèƒ½ï¼Œå®Œæˆè¯·æ±‚å’Œæ³¨è§£POJOçš„æ˜ å°„,è§£å†³ @ResponseBody ä¹±ç é—®é¢˜ --&gt;&lt;!-- éœ€è¦åœ¨ annotation-driven ä¹‹å‰,å¦åˆ™ä¹±ç é—®é¢˜åŒæ ·æ— æ³•è§£å†³ --&gt;&lt;bean class=\"org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter\"&gt; &lt;property name=\"messageConverters\"&gt; &lt;list&gt; &lt;bean class=\"org.springframework.http.converter.StringHttpMessageConverter\"&gt; &lt;property name=\"supportedMediaTypes\"&gt; &lt;list&gt; &lt;value&gt;text/html;charset=UTF-8&lt;/value&gt; &lt;/list&gt; &lt;/property&gt; &lt;/bean&gt; &lt;/list&gt; &lt;/property&gt;&lt;/bean&gt;&lt;!-- å¼€å¯ MVC çš„æ³¨è§£å¼é…ç½® --&gt;&lt;mvc:annotation-driven/&gt;&lt;!-- è§†å›¾è§£é‡Šç±» --&gt;&lt;bean name=\"viewResolver\" class=\"org.springframework.web.servlet.view.InternalResourceViewResolver\"&gt; &lt;property name=\"prefix\" value=\"/WEB-INF/views/\" /&gt; &lt;property name=\"suffix\" value=\".html\" /&gt; &lt;property name=\"order\" value=\"0\" /&gt;&lt;/bean&gt;&lt;!-- è®¾ç½®ä¸æ‹¦æˆªé™æ€æ–‡ä»¶ --&gt;&lt;mvc:resources location=\"/WEB-INF/views/\" mapping=\"/WEB-INF/views/**\" /&gt;&lt;mvc:resources location=\"/static/\" mapping=\"/static/**/**\" /&gt;&lt;mvc:resources location=\"/UploadFile/\" mapping=\"/UploadFile/**\" /&gt; ç¼–å†™æ§åˆ¶å™¨æ–¹æ³• 12345678@Controllerpublic class UserController &#123; // è·³è½¬åˆ°ç™»é™†é¡µé¢ @RequestMapping(value = &#123;\"login\", \"/\"&#125;, method = RequestMethod.GET) public String toLogin() &#123; return \"login\"; &#125;&#125; 1234567public class ChatroomController &#123; // ç™»å½•æˆåŠŸåçš„è·³è½¬é¡µé¢ @RequestMapping(method = RequestMethod.GET) public String toChatroom() &#123; return \"chatroom\"; &#125;&#125; é¡¹ç›®æµ‹è¯•æ§åˆ¶å°è¾“å‡º @RequestMapping(value = {&quot;login&quot;, &quot;/&quot;}, method = RequestMethod.GET) æ•´åˆ SwaggerSwagger æ˜¯ä¸€æ¬¾ RESTFUL æ¥å£çš„æ–‡æ¡£åœ¨çº¿è‡ªåŠ¨ç”Ÿæˆ + åŠŸèƒ½æµ‹è¯•åŠŸèƒ½è½¯ä»¶ã€‚ @Api ï¼šä¿®é¥°æ•´ä¸ªç±»ï¼Œæè¿°Controllerçš„ä½œç”¨ï¼›@ApiOperation ï¼šæè¿°ä¸€ä¸ªç±»çš„ä¸€ä¸ªæ–¹æ³•ï¼Œæˆ–è€…è¯´ä¸€ä¸ªæ¥å£ï¼›@ApiParam ï¼šå•ä¸ªå‚æ•°æè¿°ï¼›ç”¨åœ¨æ–¹æ³•å‚æ•°ä¸Š@ApiModel ï¼šç”¨å¯¹è±¡æ¥æ¥æ”¶å‚æ•°ï¼›@ApiProperty ï¼šç”¨å¯¹è±¡æ¥æ”¶å‚æ•°æ—¶ï¼Œæè¿°å¯¹è±¡çš„ä¸€ä¸ªå­—æ®µï¼›@ApiResponse ï¼šHTTPå“åº”å…¶ä¸­1ä¸ªæè¿°ï¼›@ApiResponses ï¼šHTTPå“åº”æ•´ä½“æè¿°ï¼›@ApiIgnore ï¼šä½¿ç”¨è¯¥æ³¨è§£å¿½ç•¥è¿™ä¸ªAPIï¼›@ApiError ï¼šå‘ç”Ÿé”™è¯¯è¿”å›çš„ä¿¡æ¯ï¼›@ApiImplicitParam ï¼šä¸€ä¸ªè¯·æ±‚å‚æ•°ï¼šç”¨åœ¨æ–¹æ³•ä¸Š ã€‚@ApiImplicitParams ï¼šå¤šä¸ªè¯·æ±‚å‚æ•°ï¼šç”¨åœ¨æ–¹æ³•ä¸Šã€‚ å¼•å…¥ä¾èµ–åŒ… 123456789101112131415161718192021222324252627282930313233&lt;!-- Swagger å¯å¸®åŠ©å¼€å‘äººå‘˜è®¾è®¡ï¼Œæ„å»ºï¼Œè®°å½•å’Œä½¿ç”¨ RESTful Web æœåŠ¡ --&gt;&lt;dependency&gt; &lt;groupId&gt;io.springfox&lt;/groupId&gt; &lt;artifactId&gt;springfox-swagger-ui&lt;/artifactId&gt; &lt;version&gt;2.9.2&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;io.springfox&lt;/groupId&gt; &lt;artifactId&gt;springfox-swagger2&lt;/artifactId&gt; &lt;version&gt;2.9.2&lt;/version&gt;&lt;/dependency&gt;&lt;!-- Jackson åŒ…ï¼Œé…åˆ Spring @ResponseBody æ³¨è§£ï¼Œä»¥åŠ Json å·¥å…·åŒ… --&gt;&lt;dependency&gt; &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt; &lt;artifactId&gt;jackson-core&lt;/artifactId&gt; &lt;version&gt;2.9.0&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt; &lt;artifactId&gt;jackson-annotations&lt;/artifactId&gt; &lt;version&gt;2.9.0&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt; &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt; &lt;version&gt;2.9.0&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;fastjson&lt;/artifactId&gt; &lt;version&gt;1.2.6&lt;/version&gt;&lt;/dependency&gt; é…ç½® Swagger 1234567891011121314151617181920212223@EnableSwagger2 //ä½¿ Swagger2 ç”Ÿæ•ˆ@ComponentScan(basePackages = &#123;\"wingo.web.controller\"&#125;) //éœ€è¦æ‰«æçš„controlleråŒ…è·¯å¾„@Configurable //é…ç½®æ³¨è§£ï¼Œè‡ªåŠ¨åœ¨æœ¬ç±»ä¸Šä¸‹æ–‡åŠ è½½ä¸€äº›ç¯å¢ƒå˜é‡ä¿¡æ¯public class SwaggerConfig extends WebMvcConfigurationSupport &#123; //RestApiConfig @Bean public Docket buildDocket()&#123; return new Docket(DocumentationType.SWAGGER_2) .apiInfo(buildApiInf()) .select() .apis(RequestHandlerSelectors.basePackage(\"wingo.web.controller\"))//controllerè·¯å¾„ .paths(PathSelectors.any()) .build(); &#125; private ApiInfo buildApiInf()&#123; return new ApiInfoBuilder() .title(\"Wingo's Swagger\") .description(\"Web Restful æµ‹è¯•\") .build(); &#125;&#125; Spring åŠ è½½ SwaggerConfig 123456&lt;!-- åŠ è½½ SwaggerConfig --&gt;&lt;bean class=\"springfox.documentation.swagger2.configuration.Swagger2DocumentationConfiguration\" id=\"swagger2Config\"/&gt;&lt;!-- ä¸æ‹¦æˆªæ‰€éœ€é™æ€æ–‡ä»¶ --&gt;&lt;mvc:resources mapping=\"swagger-ui.html\" location=\"classpath:/META-INF/resources/\"/&gt;&lt;mvc:resources mapping=\"/webjars/**\" location=\"classpath:/META-INF/resources/webjars/\"/&gt; åœ¨éœ€è¦æ ‡æ³¨çš„æ§åˆ¶å™¨ç±»æ–¹æ³•ä¸Šæ·»åŠ æ³¨è§£ 123456789101112131415161718192021@Controller@RequestMapping(value=\"/swagger\")public class TestSwaggerController &#123; @ApiOperation(value = \"æµ‹è¯•ä¸“ç”¨\", notes = \"è¿”å›ä¸€ä¸ª JSON å­—ç¬¦ä¸²\") @RequestMapping(value=\"/test\",method= RequestMethod.GET) @ResponseBody public String test()&#123; ObjectMapper mapper = new ObjectMapper(); User user = new User(); user.setUserId((long) 1); user.setUserName(\"ä¸­æ–‡æµ‹è¯•\"); user.setPassword(\"111\"); String str = null; try &#123; str = mapper.writeValueAsString(user); &#125; catch (JsonProcessingException e) &#123; e.printStackTrace(); &#125; return str; &#125;&#125; è®¿é—®ï¼š[é¡¹ç›®æ ¹ç›®å½•]/swagger-ui.html ç‚¹å‡» Try it out è¿›è¡Œè¯·æ±‚çš„å‘é€ã€‚ æˆåŠŸè¯·æ±‚å¹¶çš„åˆ°å“åº”ã€‚ åŠŸèƒ½æ¨¡å—æ•°æ®åº“ç»“æ„ åŸºäº Spring æ³¨è§£å¼å¼€å‘ å‰åç«¯åˆ†ç¦»ï¼Œè¿”å› Json çš„è§†å›¾å¯¹è±¡ç±» 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374public class ResponseJson extends HashMap&lt;String, Object&gt; &#123; private static final long serialVersionUID = 1L; private static final Integer SUCCESS_STATUS = 200; private static final Integer ERROR_STATUS = -1; private static final String SUCCESS_MSG = \"ä¸€åˆ‡æ­£å¸¸\"; public ResponseJson() &#123; super(); &#125; public ResponseJson(int code) &#123; super(); setStatus(code); &#125; public ResponseJson(HttpStatus status) &#123; super(); setStatus(status.value()); setMsg(status.getReasonPhrase()); &#125; public ResponseJson success() &#123; put(\"msg\", SUCCESS_MSG); put(\"status\", SUCCESS_STATUS); return this; &#125; public ResponseJson success(String msg) &#123; put(\"msg\", msg); put(\"status\", SUCCESS_STATUS); return this; &#125; public ResponseJson error(String msg) &#123; put(\"msg\", msg); put(\"status\", ERROR_STATUS); return this; &#125; public ResponseJson setData(String key, Object obj) &#123; @SuppressWarnings(\"unchecked\") HashMap&lt;String, Object&gt; data = (HashMap&lt;String, Object&gt;) get(\"data\"); if (data == null) &#123; data = new HashMap&lt;String, Object&gt;(); put(\"data\", data); &#125; data.put(key, obj); return this; &#125; public ResponseJson setStatus(int status) &#123; put(\"status\", status); return this; &#125; public ResponseJson setMsg(String msg) &#123; put(\"msg\", msg); return this; &#125; public ResponseJson setValue(String key, Object val) &#123; put(key, val); return this; &#125; /** * è¿”å›JSONå­—ç¬¦ä¸² */ @Override public String toString() &#123; return JSONObject.toJSONString(this); &#125;&#125; ç”¨æ¥å­˜æ”¾ Netty WebSocket è¿æ¥ä¿¡æ¯çš„å¸¸é‡ç±» 123456789101112public class Constant &#123; // ä¸€ä¸ª userId å¯¹åº”ä¸€ä¸ª Session public static final String USER_TOKEN = \"userId\"; // ç”¨äºä¿å­˜ Http å‡çº§ WebSocket åçš„æ¡æ‰‹å®ä¾‹ public static Map&lt;String, WebSocketServerHandshaker&gt; webSocketHandshakerMap = new ConcurrentHashMap&lt;String, WebSocketServerHandshaker&gt;(); // ç”¨äºä¿å­˜å·²ç™»å½•çš„ç”¨æˆ·çš„é€šé“ä¿¡æ¯ public static Map&lt;String, ChannelHandlerContext&gt; onlineUserMap = new ConcurrentHashMap&lt;String, ChannelHandlerContext&gt;();&#125; ç”¨æˆ·ç™»å½• User ğŸ‘‰ å®ä½“ç±»ï¼Œä¸æ•°æ®åº“è¡¨ user å‘å¯¹åº” 123456789public class User &#123; private Long userId; private String username; private String password; private String avatarUrl; // çœç•¥äº† Getter Setter toString æ–¹æ³•&#125; UserDaoã€UserMapperğŸ‘‰ é€šè¿‡ç”¨æˆ·è¾“å…¥çš„ç”¨æˆ·ååˆ°æ•°æ®åº“ä¸­æ‰¾åˆ°æ­¤ç”¨æˆ·çš„ç”¨æˆ·ä¿¡æ¯ã€‚ 1User getByUsername(String username); 123456789&lt;select id=\"getByUsername\" resultType=\"com.wingo.model.po.User\" &gt; &lt;!-- å…·ä½“çš„sql --&gt; SELECT user_id, username, password FROM user WHERE username = #&#123;username&#125;&lt;/select&gt; SecurityServiceã€SecurityServiceImpl ğŸ‘‰ å®ç°ç™»å½•çš„ä¸šåŠ¡é€»è¾‘ 123456789101112public ResponseJson login(String username, String password, HttpSession session) &#123; User user = userDao.getByUsername(username); if (user == null) &#123; return new ResponseJson().error(\"ä¸å­˜åœ¨è¯¥ç”¨æˆ·å\"); &#125; if (!user.getPassword().equals(password)) &#123; return new ResponseJson().error(\"å¯†ç ä¸æ­£ç¡®\"); &#125; // å°†å·²ç™»å½•çš„ç”¨æˆ·çš„ userId ä¿å­˜åœ¨ Session ä¸­ session.setAttribute(Constant.USER_TOKEN, user.getUserId()); return new ResponseJson().success();&#125; SecurityController ğŸ‘‰ URLæ˜ å°„ä»¥åŠå‰åç«¯æ•°æ®äº¤äº’ 12345@RequestMapping(value = \"login\", method = RequestMethod.POST)@ResponseBodypublic ResponseJson login(HttpSession session, @RequestParam String username, @RequestParam String password) &#123; return securityService.login(username, password, session);&#125; ç”¨æˆ·ç‚¹å‡»ç™»å½•æŒ‰é’®åï¼Œå‘é€ Ajax è¯·æ±‚è¿›è¡Œç”¨æˆ·éªŒè¯ï¼ŒéªŒè¯é€šè¿‡åè·³è½¬åˆ° chatroom é¡µé¢ã€‚ 123456789101112131415161718192021&lt;script type=\"text/javascript\"&gt; function login() &#123; $.ajax(&#123; type : 'POST', url : 'login', dataType: 'json', data : &#123; username: $(\"#username\").val(), password: $(\"#password\").val() &#125;, async : false, success: function(data) &#123; if (data.status == 200) &#123; window.location.href=\"chatroom\"; &#125; else &#123; alert(data.msg); &#125; &#125; &#125;);&#125;&lt;/script&gt; åˆå§‹åŒ–ç”¨æˆ·ä¿¡æ¯ ç”¨æˆ·æ‹¦æˆªè®¤è¯UserAuthInteceptor ğŸ‘‰ æ£€æµ‹ç”¨æˆ·æ˜¯å¦ç™»å½•å¹¶è®¾ç½®èµ„æºè®¿é—®æƒé™ 12345678910111213141516171819202122232425262728public class UserAuthInteceptor implements HandlerInterceptor &#123; @Override public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception &#123; HttpSession session = request.getSession(); Object userToken = session.getAttribute(Constant.USER_TOKEN); if (userToken == null) &#123; response.sendRedirect(\"login\"); return false; &#125; return true; &#125; @Override public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception &#123; // å…è®¸æ‰€æœ‰èµ„æºéƒ½å¯ä»¥è®¿é—®èµ„æº response.setHeader(\"Access-Control-Allow-Origin\", \"*\"); // è¡¨ç¤ºæ˜¯å¦å¯ä»¥å°†å¯¹è¯·æ±‚çš„å“åº”æš´éœ²ç»™é¡µé¢ response.setHeader(\"Access-Control-Allow-Credentials\",\"true\"); &#125; @Override public void afterCompletion(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object o, Exception e) throws Exception &#123; &#125;&#125; é…ç½® Spring MVC å¯¹ chatoom é¡µé¢çš„è®¿é—®è¯·æ±‚è¿›è¡Œæ‹¦æˆªè®¤è¯ 1234567&lt;!-- ç”¨æˆ·è®¤è¯æ‹¦æˆªå™¨ --&gt;&lt;mvc:interceptors&gt; &lt;mvc:interceptor&gt; &lt;mvc:mapping path=\"/chatroom/**\" /&gt; &lt;bean class=\"com.wingo.web.interceptor.UserAuthInteceptor\" /&gt; &lt;/mvc:interceptor&gt;&lt;/mvc:interceptors&gt; PO &amp; VOåœ¨è¿”å›ç»™ç”¨æˆ·çš„ä¿¡æ¯ä¸­ï¼Œé™¤äº†ç”¨æˆ·çš„ä¸ªäººä¿¡æ¯ï¼Œè¿˜éœ€è¦ç”¨æˆ·çš„å¥½å‹åˆ—è¡¨ä¿¡æ¯ä»¥åŠç¾¤èŠåˆ—è¡¨ä¿¡æ¯ã€‚åˆ›å»ºä¸€ä¸ª VO ç±»ç”¨äºä¿å­˜å‰ç«¯æ‰€éœ€è¦çš„æ‰€æœ‰ä¿¡æ¯ã€‚ UserInfo ç±» 123456789101112public class UserInfo &#123; private Long userId; private String username; private String password; private String avatarUrl; private List&lt;User&gt; friendList; // å¥½å‹åˆ—è¡¨ä¿¡æ¯ private List&lt;Chatgroup&gt; groupList; // ç¾¤èŠä¿¡æ¯ // æ„é€ å™¨æ–¹æ³•ä¾¿äºå®ä¾‹åŒ– // ...&#125; Chatgroup ç±» 123456789// group ä¸º MySQL çš„å…³é”®å­—ï¼Œä¸å¯ä½¿ç”¨public class Chatgroup &#123; private Long groupId; private String groupName; private String groupAvatarUrl; // ...&#125; GroupInfo ç±» 12345678910public class GroupInfo &#123; private Long groupId; private String groupName; private String groupAvatarUrl; private List&lt;User&gt; members; // æ„é€ å™¨æ–¹æ³•ä¾¿äºå®ä¾‹åŒ– // ...&#125; ChatroomController ğŸ‘‰ é€šè¿‡ userId è·å–ç”¨æˆ·çš„ä¿¡æ¯ 1234567@RequestMapping(value = \"/get_userinfo\", method = RequestMethod.POST) @ResponseBodypublic ResponseJson getUserInfo(HttpSession session) &#123; Object userId = session.getAttribute(Constant.USER_TOKEN); System.out.println(\"Session ä¸­çš„ userId = \" + userId); return userService.getByUserId(String.valueOf(userId));&#125; UserServiceImpl 123456789101112131415161718192021222324252627282930313233343536373839@Servicepublic class UserServiceImpl implements UserService &#123; @Autowired private UserDao userDao; @Autowired private UserChatRelationDao userChatRelationDao; @Autowired private GroupDao groupDao; @Override public ResponseJson getByUserId(String userId) &#123; User user = userDao.getByUserId(userId); UserInfo userInfo = new UserInfo( user.getUserId(), user.getUsername(), user.getPassword(), user.getAvatarUrl() ); // friendList æ„é€  List&lt;String&gt; friendsId = userChatRelationDao.getUserFriendsIdByUserId(userId); List&lt;User&gt; friends = new ArrayList&lt;User&gt;(); for(String friendId : friendsId)&#123; User friend = userDao.getByUserId(friendId); friends.add(friend); &#125; // groupList æ„é€  List&lt;String&gt; groupsId = userChatRelationDao.getGroupsIdByUserId(userId); List&lt;Chatgroup&gt; groups = new ArrayList&lt;Chatgroup&gt;(); for(String groupId : groupsId)&#123; Chatgroup group = groupDao.getByGroupId(groupId); groups.add(group); &#125; userInfo.setGroupList(groups); userInfo.setFriendList(friends); return new ResponseJson().success() .setData(\"userInfo\", userInfo); &#125;&#125; é€šè¿‡ Swagger æ¨¡æ‹Ÿè¯·æ±‚å–å¾—è¿”å›çš„ Json æ•°æ®ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839&#123; \"msg\": \"ä¸€åˆ‡æ­£å¸¸\", \"data\": &#123; \"userInfo\": &#123; \"userId\": 1, \"username\": \"test1\", \"password\": null, \"avatarUrl\": \"static/img/avatar/Member001.jpg\", \"friendList\": [ &#123; \"userId\": 2, \"username\": \"test2\", \"password\": null, \"avatarUrl\": \"static/img/avatar/Member001.jpg\" &#125;, &#123; \"userId\": 4, \"username\": \"test3\", \"password\": null, \"avatarUrl\": \"static/img/avatar/Member001.jpg\" &#125;, &#123; \"userId\": 5, \"username\": \"test4\", \"password\": null, \"avatarUrl\": \"static/img/avatar/Member001.jpg\" &#125; ], \"groupList\": [ &#123; \"groupId\": 1000, \"groupName\": \"Group1\", \"groupAvatarUrl\": \"static/img/avatar/Group01.jpg\" &#125; ] &#125; &#125;, \"status\": 200&#125; ç”¨æˆ·ä¿¡æ¯åˆå§‹åŒ–å®Œæˆã€‚ é¡µé¢å¸ƒå±€ç²—ç•¥ç‰ˆ ç”¨æˆ·å•èŠå‰ç«¯é¡µé¢åœ¨å–å¾—åå°æ‰€è¿”å›çš„ Json ä¿¡æ¯ä¹‹åï¼Œæ ¹æ®ä¿¡æ¯åˆå§‹åŒ–ç”¨æˆ·çš„èŠå¤©é¡µé¢ã€‚ æ­¤ç¨‹åºä¸å°†èŠå¤©ä¿¡æ¯ä¿å­˜åˆ°æ•°æ®åº“ä¸­ï¼Œè€Œæ˜¯ä¿å­˜åœ¨å‰ç«¯çš„èŠå¤©é¡µé¢ç”¨ Javascript æ‰€è‡ªå®šä¹‰çš„ä¸€ä¸ªæ•°æ®ç»“æ„é‡Œï¼Œä¸€ä¸ªSentMessageMap(key, new Array())ã€‚ç”¨æˆ·è¿›è¡Œç”¨æˆ·ä¿¡æ¯çš„åˆå§‹åŒ–æ—¶è¦å°†æ­¤ç”¨æˆ·ä¿¡æ¯ä¸­çš„ groupId ä»¥åŠ userId ä½œä¸ºé”®åˆå§‹åŒ–è¿™ä¸ªèŠå¤©ä¿¡æ¯çš„ Mapï¼Œä»¥ä¾¿åé¢è¿›è¡ŒèŠå¤©ä¿¡æ¯çš„ä¿å­˜ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263function setUserInfo() &#123; $.ajax(&#123; type : 'POST', url : 'chatroom/get_userinfo', dataType: 'json', async : true, success: function(data) &#123; console.log(\"è·å–ç”¨æˆ·ä¿¡æ¯...\"); if (data.status == 200) &#123; // è‡ªå®šä¹‰çš„æ•°æ®ç»“æ„ï¼Œç”¨äºä¿å­˜èŠå¤©ä¿¡æ¯è¿›è¡Œå›æ˜¾ sentMessageMap = new SentMessageMap(); // è·å–ç”¨æˆ·ä¿¡æ¯ var userInfo = data.data.userInfo; userId = userInfo.userId; $(\"#username\").html(userInfo.username); $(\"#avatarUrl\").attr(\"src\", userInfo.avatarUrl); var groupListHTML = \"\"; // è·å–ç”¨æˆ·çš„ç¾¤ç»„ä¿¡æ¯ var groupList = userInfo.groupList; // åˆå§‹åŒ–ç¾¤èŠæ¡†åˆ—è¡¨ for (var i = 0; i &lt; groupList.length; i++) &#123; // æ·»åŠ  Key sentMessageMap.put(groupList[i].groupId, new Array()); groupListHTML += '&lt;li&gt;' + '&lt;div class=\"liLeft\"&gt;&lt;img src=\"' + groupList[i].groupAvatarUrl + '\"&gt;&lt;/div&gt;' + '&lt;div class=\"liRight\"&gt;' + '&lt;span class=\"hidden-groupId\"&gt;' + groupList[i].groupId + '&lt;/span&gt;' + '&lt;span class=\"intername\"&gt;' + groupList[i].groupName + '&lt;/span&gt;' + '&lt;span class=\"infor\"&gt;&lt;/span&gt;' + '&lt;/div&gt;' + '&lt;/li&gt;'; &#125; // æ·»åŠ ç¾¤èŠæ¡†åˆ—è¡¨ $('.conLeft ul').append(groupListHTML); var friendListHTML = \"\"; // è·å–ç”¨æˆ·å¥½å‹ä¿¡æ¯ var friendList = userInfo.friendList; // åˆå§‹åŒ–å¥½å‹æ¡†åˆ—è¡¨ for (var i = 0; i &lt; friendList.length; i++) &#123; // æ·»åŠ  Key sentMessageMap.put(friendList[i].userId, new Array()); friendListHTML += '&lt;li&gt;' + '&lt;div class=\"liLeft\"&gt;&lt;img src=\"' + friendList[i].avatarUrl + '\"&gt;&lt;/div&gt;' + '&lt;div class=\"liRight\"&gt;' + '&lt;span class=\"hidden-userId\"&gt;' + friendList[i].userId + '&lt;/span&gt;' + '&lt;span class=\"intername\"&gt;' + friendList[i].username + '&lt;/span&gt;' + '&lt;span class=\"infor\"&gt;&lt;/span&gt;' + '&lt;/div&gt;' + '&lt;/li&gt;'; &#125; // æ·»åŠ å¥½å‹åˆ—è¡¨ $('.conLeft ul').append(friendListHTML); // ç»‘å®šå¥½å‹æ¡†ç‚¹å‡»äº‹ä»¶ï¼šæ˜¾ç¤ºå³ä¾§æ¶ˆæ¯æ¡† $('.conLeft ul li').on('click', friendLiClickEvent); &#125; else &#123; alert(data.msg); &#125; &#125; &#125;);&#125; å•èŠæµç¨‹ ç›‘å¬ç»‘å®š1234567891011121314151617181920212223242526272829303132333435363738if(!window.WebSocket)&#123; window.WebSocket = window.MozWebSocket; &#125; if(window.WebSocket)&#123; socket = new WebSocket(\"ws://localhost:3333\"); socket.onmessage = function(event)&#123; var json = JSON.parse(event.data); if (json.status == 200) &#123; var type = json.data.type; console.log(\"æ”¶åˆ°ä¸€æ¡æ–°ä¿¡æ¯ï¼Œç±»å‹ä¸ºï¼š\" + type); switch(type) &#123; case \"REGISTER\": ws.registerReceive(); break; case \"SINGLE_SENDING\": ws.singleReceive(json.data); break; default: console.log(\"ä¸æ­£ç¡®çš„ç±»å‹ï¼\"); &#125; &#125; else &#123; alert(json.msg); console.log(json.msg); &#125; &#125;; // è¿æ¥æˆåŠŸ1ç§’åï¼Œå°†ç”¨æˆ·ä¿¡æ¯æ³¨å†Œåˆ°æœåŠ¡å™¨åœ¨çº¿ç”¨æˆ·è¡¨ socket.onopen = setTimeout(function(event)&#123; console.log(\"WebSocketå·²æˆåŠŸè¿æ¥ï¼\"); ws.register(); &#125;, 1000) socket.onclose = function(event)&#123; console.log(\"WebSocketå·²å…³é—­...\"); &#125;; &#125; else &#123; alert(\"æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒWebSocketï¼\"); &#125; WebSocket å¤„ç†1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162var ws = &#123; register: function() &#123; if (!window.WebSocket) &#123; return; &#125; if (socket.readyState == WebSocket.OPEN) &#123; var data = &#123; \"userId\" : userId, \"type\" : \"REGISTER\" &#125;; socket.send(JSON.stringify(data)); &#125; else &#123; alert(\"Websocketè¿æ¥æ²¡æœ‰å¼€å¯ï¼\"); &#125; &#125;, singleSend: function(fromUserId, toUserId, content) &#123; if (!window.WebSocket) &#123; return; &#125; if (socket.readyState == WebSocket.OPEN) &#123; var data = &#123; \"fromUserId\" : fromUserId, \"toUserId\" : toUserId, \"content\" : content, \"type\" : \"SINGLE_SENDING\" &#125;; // å°†ä¿¡æ¯å‘é€ç»™å®¢æˆ·ç«¯çš„ WebSocketServerhandler è¿›è¡Œå¤„ç† socket.send(JSON.stringify(data)); &#125; else &#123; alert(\"Websocketè¿æ¥æ²¡æœ‰å¼€å¯ï¼\"); &#125; &#125;, registerReceive: function() &#123; console.log(\"userIdä¸º \" + userId + \" çš„ç”¨æˆ·ç™»è®°åˆ°åœ¨çº¿ç”¨æˆ·è¡¨æˆåŠŸï¼\"); &#125;, singleReceive: function(data) &#123; // è·å–ã€æ„é€ å‚æ•° console.log(data); var fromUserId = data.fromUserId; var content = data.content; var fromAvatarUrl; var $receiveLi; // ä¸ºè®¾ç½®æ¶ˆæ¯æé†’ä»¥åŠè·å–å¤´åƒå–å¾—å…ƒç´  $('.conLeft').find('span.hidden-userId').each(function()&#123; if (this.innerHTML == fromUserId) &#123; fromAvatarUrl = $(this).parent(\".liRight\") .siblings(\".liLeft\").children('img').attr(\"src\"); $receiveLi = $(this).parent(\".liRight\").parent(\"li\"); &#125; &#125;) var answer=''; answer += '&lt;li&gt;' + '&lt;div class=\"answers\"&gt;'+ content +'&lt;/div&gt;' + '&lt;div class=\"answerHead\"&gt;&lt;img src=\"' + fromAvatarUrl + '\"/&gt;&lt;/div&gt;' + '&lt;/li&gt;'; // æ¶ˆæ¯æ¡†å¤„ç† æ”¾å…¥æš‚å­˜åŒºï¼Œè‹¥ç”¨æˆ·æ­£å¤„äºä¸æ–°å‘æ¶ˆæ¯ç”¨æˆ·çš„èŠå¤©çª—å£åˆ™å›æ˜¾ï¼ˆåˆ©ç”¨æš‚å­˜åŒºè®¡ç®—é«˜åº¦ï¼‰ processMsgBox.receiveSingleMsg(answer, fromUserId); // å¥½å‹åˆ—è¡¨å¤„ç† 1.è®¾ç½®çº¢è‰²æé†’æ ‡å¿— 2.è®¾ç½®éƒ¨åˆ†æ–°æ¶ˆæ¯æé†’ 3.ç½®é¡¶æ–°æ¶ˆæ¯ processFriendList.receiving(content, $receiveLi); &#125;,&#125; å‘é€æŒ‰é’®1234567891011121314151617181920212223242526272829303132333435$('.sendBtn').on('click',function()&#123; var fromUserId = userId; var toUserId = $('#toUserId').val(); var toGroupId = $('#toGroupId').val(); var news = $('#dope').val(); if (toUserId == '' &amp;&amp; toGroupId == '') &#123; alert(\"è¯·é€‰æ‹©å¯¹è¯æ–¹\"); return; &#125; if(news == '')&#123; alert('æ¶ˆæ¯ä¸èƒ½ä¸ºç©º'); return; &#125; else &#123; if (toUserId.length != 0) &#123; ws.singleSend(fromUserId, toUserId, news); &#125; else &#123; // ç¾¤å‘ &#125; $('#dope').val(''); var avatarUrl = $('#avatarUrl').attr(\"src\"); var msg = ''; msg += '&lt;li&gt;'+ '&lt;div class=\"news\"&gt;' + news + '&lt;/div&gt;' + '&lt;div class=\"nesHead\"&gt;&lt;img src=\"' + avatarUrl + '\"/&gt;&lt;/div&gt;' + '&lt;/li&gt;'; // æ¶ˆæ¯æ¡†å¤„ç†ï¼š processMsgBox.sendMsg(msg, toUserId, toGroupId); // å¥½å‹åˆ—è¡¨å¤„ç†ï¼š var $sendLi = $('.conLeft').find('li.bg'); processFriendList.sending(news, $sendLi); &#125;&#125;) æ¶ˆæ¯æ¡†å¤„ç†123456789101112131415161718192021222324252627282930sendMsg: function(msg, toUserId, toGroupId) &#123; // æŠŠå†…å®¹æ·»åŠ åˆ°æ¶ˆæ¯æ¡† $('.newsList').append(msg); // 2. æ‰‹åŠ¨è®¡ç®—ã€è°ƒæ•´å›æ˜¾æ¶ˆæ¯çš„å®½åº¦ var $newsDiv = $('.newsList li').last().children(\"div\").first(); var fixWidth = 300; // è‡ªå®šä¹‰çš„æ¶ˆæ¯æ¡†æœ¬èº«çš„æœ€é•¿å®½åº¦ var maxWidth = 493; // æ¶ˆæ¯æ¡†æ‰€åœ¨è¡Œ div çš„æ»¡å®½åº¦ï¼ˆä¸åŒ…å«å¤´åƒæ¡†çš„å®½åº¦éƒ¨åˆ†ï¼‰ var minMarginLeftWidth = 224; // æŒ‰ç†è¯´åº”è¯¥æ˜¯ maxwidth - fixWidthï¼Œè¿™é‡Œå‡ºç°äº†ç‚¹é—®é¢˜ var marginLeftWidth; // è¦è®¡ç®—æ¶ˆæ¯æ¡†çš„margin-leftå®½åº¦ if ($newsDiv.actual('width') &lt; fixWidth) &#123; marginLeftWidth = maxWidth - $newsDiv.actual('width'); $newsDiv.css(\"margin-left\", marginLeftWidth + \"px\"); &#125; else &#123; $newsDiv.css(\"width\", fixWidth + \"px\") .css(\"margin-left\", minMarginLeftWidth + \"px\"); &#125; // 3. æŠŠ è°ƒæ•´åçš„æ¶ˆæ¯htmlæ ‡ç­¾å­—ç¬¦ä¸² æ·»åŠ åˆ°å·²å‘é€ç”¨æˆ·æ¶ˆæ¯è¡¨ if (toUserId.length != 0) &#123; // å¾—åˆ°æ•°ç»„æ·»åŠ æ–°æ¶ˆæ¯ ä»¥ outerHTML çš„å½¢å¼ // last() å¾—åˆ°åŒ¹é…å…ƒç´ çš„æœ€åä¸€ä¸ª sentMessageMap.get(toUserId).push($('.newsList li').last().prop(\"outerHTML\")); &#125; else &#123; sentMessageMap.get(toGroupId).push($('.newsList li').last().prop(\"outerHTML\")); &#125; // 4. æ»šåŠ¨æ¡å¾€åº•éƒ¨ç§» $('.RightCont').scrollTop($('.RightCont')[0].scrollHeight );&#125; å¥½å‹åˆ—è¡¨å¤„ç†12345678910111213141516sending: function(content, $sendLi) &#123; // è®¾ç½®éƒ¨åˆ†æ–°æ¶ˆæ¯æé†’ if (content.length &gt; 8) &#123; content = content.substring(0, 8) + \"...\"; &#125; $('.conLeft').find('li.bg').children('.liRight').children('.infor').text(content); // å¦‚æœå­˜åœ¨æ–°æ¶ˆæ¯æé†’å¾½ç« ï¼Œåˆ™å»é™¤å¾½ç«  if ($sendLi.find('.layui-badge').length &gt; 0) &#123; $sendLi.find('.layui-badge').remove(); &#125; //$('.conLeft ul').prepend('&lt;li class=\"bg\"&gt;' + $sendLi.html() + '&lt;/li&gt;'); // å¥½å‹æ¡†æ–°æ¶ˆæ¯ç½®é¡¶ $('.conLeft ul').prepend($sendLi.prop(\"outerHTML\")); $sendLi.remove(); $('.conLeft ul li').first().on('click', friendLiClickEvent)&#125; æœåŠ¡å™¨å¤„ç†12345678910111213141516171819202122@Overridepublic void singleSend(JSONObject param, ChannelHandlerContext ctx) &#123; String fromUserId = String.valueOf(param.get(\"fromUserId\")); String toUserId = (String)param.get(\"toUserId\"); String content = (String)param.get(\"content\"); // å–å¾—æ¥æ”¶è€…çš„é€šé“ ChannelHandlerContext toUserCtx = Constant.onlineUserMap.get(toUserId); if (toUserCtx == null) &#123; String responseJson = new ResponseJson() .error(MessageFormat.format(\"userIdä¸º &#123;0&#125; çš„ç”¨æˆ·æ²¡æœ‰ç™»å½•ï¼\", toUserId)) .toString(); sendMessage(ctx, responseJson); &#125; else &#123; String responseJson = new ResponseJson().success() .setData(\"fromUserId\", fromUserId) .setData(\"content\", content) .setData(\"type\", ChatType.SINGLE_SENDING) .toString(); // å‘é€æ¶ˆæ¯ç»™æ¥æ”¶è€…çš„é€šé“ï¼Œæµè§ˆå™¨ socket ç›‘å¬å¤„ç† sendMessage(toUserCtx, responseJson); &#125;&#125; æµ‹è¯• é€šè¿‡æ§åˆ¶å°è°ƒè¯•å¯ä»¥å–å¾— sentMessageMap ä¸­ä¿å­˜äº†ä¸ userId=2 çš„ç”¨æˆ·çš„èŠå¤©ä¿¡æ¯æ•°ç»„ã€‚ é€šè¿‡æ§åˆ¶å°è°ƒè¯•å¯ä»¥å–å¾— sentMessageMap ä¸­ä¿å­˜äº†ä¸ userId=1 çš„ç”¨æˆ·çš„èŠå¤©ä¿¡æ¯æ•°ç»„ã€‚ ç¾¤ç»„èŠå¤©ç¾¤ç»„èŠå¤©çš„æµç¨‹ä¸ç”¨æˆ·å•èŠæµç¨‹åŸºæœ¬ç›¸ä¼¼ï¼Œåªæ˜¯åœ¨ç»™æ¥æ”¶è€…çš„é€šé“å‘é€æ¶ˆæ¯æ—¶éœ€è¦é€šè¿‡ç¾¤ç»„ä¿¡æ¯å–å¾—ç¾¤ç»„é‡Œçš„æˆå‘˜çš„ä¿¡æ¯ï¼Œå¹¶è·å–æˆå‘˜çš„æ‰€æœ‰é€šé“è¿›è¡Œæ¶ˆæ¯çš„éå‘é€ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738@Overridepublic void groupSend(JSONObject param, ChannelHandlerContext ctx) &#123; String fromUserId = String.valueOf(param.get(\"fromUserId\")); String toGroupId = (String)param.get(\"toGroupId\"); String content = (String)param.get(\"content\"); Chatgroup chatgroup = groupDao.getByGroupId(toGroupId); if (chatgroup == null) &#123; String responseJson = new ResponseJson().error(\"è¯¥ç¾¤idä¸å­˜åœ¨\").toString(); sendMessage(ctx, responseJson); &#125; else &#123; List&lt;String&gt; groupUsersId = userChatRelationDao.getUsersIdByGroupId(toGroupId); List&lt;User&gt; groupUser = new ArrayList&lt;User&gt;(); for(String groupUserId : groupUsersId)&#123; groupUser.add(userDao.getByUserId(groupUserId)); &#125; GroupInfo groupInfo = new GroupInfo( chatgroup.getGroupId(), chatgroup.getGroupName(), chatgroup.getGroupAvatarUrl(), groupUser ); String responseJson = new ResponseJson().success() .setData(\"fromUserId\", fromUserId) .setData(\"content\", content) .setData(\"toGroupId\", toGroupId) .setData(\"type\", ChatType.GROUP_SENDING) .toString(); groupInfo.getMembers() .forEach(member -&gt; &#123; ChannelHandlerContext toCtx = Constant.onlineUserMap.get(String.valueOf(member.getUserId())); if (toCtx != null &amp;&amp; !String.valueOf(member.getUserId()).equals(fromUserId)) &#123; sendMessage(toCtx, responseJson); &#125; &#125;); &#125;&#125; æ¥æ”¶æ¶ˆæ¯è€…åˆ™æ ¹æ® groupId æ¥æ˜¾ç¤ºæ¥æ”¶åˆ°çš„æ¶ˆæ¯ã€‚ 1234567891011121314151617181920212223242526272829303132groupReceive: function(data) &#123; // è·å–ã€æ„é€ å‚æ•° console.log(data); var fromUserId = data.fromUserId; var content = data.content; var toGroupId = data.toGroupId; var fromAvatarUrl; var $receiveLi; $('.conLeft').find('span.hidden-userId').each(function()&#123; if (this.innerHTML == fromUserId) &#123; fromAvatarUrl = $(this).parent(\".liRight\") .siblings(\".liLeft\").children('img').attr(\"src\"); /* $receiveLi = $(this).parent(\".liRight\").parent(\"li\"); */ &#125; &#125;) $('.conLeft').find('span.hidden-groupId').each(function()&#123; // ç¾¤ç»„èŠå¤©æ¡† if (this.innerHTML == toGroupId) &#123; $receiveLi = $(this).parent(\".liRight\").parent(\"li\"); &#125; &#125;) var answer=''; answer += '&lt;li&gt;' + '&lt;div class=\"answers\"&gt;'+ content +'&lt;/div&gt;' + '&lt;div class=\"answerHead\"&gt;&lt;img src=\"' + fromAvatarUrl + '\"/&gt;&lt;/div&gt;' + '&lt;/li&gt;'; // æ¶ˆæ¯æ¡†å¤„ç† processMsgBox.receiveGroupMsg(answer, toGroupId); // å¥½å‹åˆ—è¡¨å¤„ç† processFriendList.receiving(content, $receiveLi);&#125;, å‘é€è¡¨æƒ…è¡¨æƒ…çš„å‘é€çš„åº•å±‚åŸç†å’Œå‘é€æ–‡å­—æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯å‘é€è¡¨æƒ…çš„è¯ï¼Œå‘é€å†…å®¹æ˜¯ä¸€ä¸²é™æ€èµ„æºçš„ URIã€‚ è¡¨æƒ…æ¨¡å—ç»‘å®šçš„ç›‘å¬äº‹ä»¶ï¼š 1234567$('.ExP').on('mouseenter',function()&#123; $('.emjon').show();&#125;)$('.emjon').on('mouseleave',function()&#123; $('.emjon').hide();&#125;) å‘é€æ–‡ä»¶æ–‡ä»¶çš„ä¸Šä¼ ä½¿ç”¨çš„æ˜¯ commons-fileupload å·¥å…·ç±»ã€‚ 123456&lt;!-- æ–‡ä»¶ä¸Šä¼  --&gt;&lt;dependency&gt; &lt;groupId&gt;commons-fileupload&lt;/groupId&gt; &lt;artifactId&gt;commons-fileupload&lt;/artifactId&gt; &lt;version&gt;1.3.3&lt;/version&gt;&lt;/dependency&gt; æ–‡ä»¶ä¸Šä¼ çš„æ¨¡æ€æ¡†è¡¨æ ¼ï¼š 123456789101112&lt;div class=\"modal-body\"&gt; &lt;form class=\"form-horizontal\"&gt; &lt;div class=\"form-group\"&gt; &lt;label class=\"col-sm-3 control-label\"&gt;é€‰æ‹©æ–‡ä»¶&lt;/label&gt; &lt;div class=\"col-sm-9\"&gt; &lt;input type=\"file\" name=\"file\" class=\"col-sm-9 myfile\" /&gt; &lt;p class=\"help-block\"&gt;æ³¨æ„ï¼šæ–‡ä»¶å¤§å°ä¸è¶…è¿‡30Mï¼Œæœ‰æ•ˆæœŸä¸º7å¤©&lt;/p&gt; &lt;/div&gt; &lt;/div&gt; &lt;/form&gt;&lt;/div&gt; Bootstrap çš„æ–‡ä»¶ä¸Šä¼ æ§ä»¶ bootstrap-fileinput çš„ä½¿ç”¨ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778$(\".myfile\").fileinput(&#123; uploadUrl:\"chatroom/upload\", uploadAsync : true, // é»˜è®¤å¼‚æ­¥ä¸Šä¼  showUpload : true, // æ˜¯å¦æ˜¾ç¤ºä¸Šä¼ æŒ‰é’® showRemove : false, // æ˜¾ç¤ºç§»é™¤æŒ‰é’® showCaption : false, // æ˜¯å¦æ˜¾ç¤ºæ ‡é¢˜ showPreview : true, // æ˜¯å¦æ˜¾ç¤ºé¢„è§ˆï¼Œé»˜è®¤ä¸º true dropZoneTitle: \"è¯·é€šè¿‡æ‹–æ‹½å›¾ç‰‡æ–‡ä»¶æ”¾åˆ°è¿™é‡Œ\", dropZoneEnabled : false, // æ˜¯å¦æ˜¾ç¤ºæ‹–æ‹½åŒºåŸŸï¼Œé»˜è®¤ä¸å†™ä¸º trueï¼Œä½†æ˜¯ä¼šå ç”¨å¾ˆå¤§åŒºåŸŸ maxFileSize: 30720, // å•ä½ä¸º kbï¼Œå¦‚æœä¸º 0 è¡¨ç¤ºä¸é™åˆ¶æ–‡ä»¶å¤§å° maxFileCount : 1, // è¡¨ç¤ºå…è®¸åŒæ—¶ä¸Šä¼ çš„æœ€å¤§æ–‡ä»¶ä¸ªæ•° enctype : 'multipart/form-data', validateInitialCount : true, previewFileIcon : \"&lt;i class='glyphicon glyphicon-file'&gt;&lt;/i&gt;\", msgFilesTooMany : \"é€‰æ‹©ä¸Šä¼ çš„æ–‡ä»¶æ•°é‡(&#123;n&#125;) è¶…è¿‡å…è®¸çš„æœ€å¤§æ•°å€¼&#123;m&#125;ï¼\", language : 'zh'&#125;)// å¼‚æ­¥ä¸Šä¼ è¿”å›æ–‡ä»¶ä¸Šä¼ é”™è¯¯ç»“æœå¤„ç†$('.myfile').on('fileerror', function(event, data, msg) &#123; console.log(\"fileerror\"); console.log(data);&#125;);// å¼‚æ­¥ä¸Šä¼ è¿”å›ç»“æœå¤„ç†$(\".myfile\").on(\"fileuploaded\", function(event, data, previewId, index) &#123; // 1. ä¸Šä¼ æˆåŠŸ1.5ç§’åè‡ªåŠ¨å…³é—­ä¸Šä¼ æ¨¡æ€æ¡† console.log(\"fileuploaded\"); setTimeout(function() &#123; $('#upload-cancel').trigger('click'); $('.fileinput-remove').trigger('click'); &#125;, 1500); // 2. è·å–ã€è®¾ç½®å‚æ•° var returnData = data.response.data; var originalFilename = returnData.originalFilename; var fileSize = returnData.fileSize; var fileUrl = returnData.fileUrl; var content = \"[æ–‡ä»¶]\"; var fromUserId = userId; var avatarUrl = $('#avatarUrl').attr(\"src\"); var $sendLi = $('.conLeft').find('li.bg'); var toUserId = $('#toUserId').val(); var toGroupId = $('#toGroupId').val(); // æ‹¼æ¥å‘é€è€…å¯¹è¯æ¡†çš„æ¶ˆæ¯ var fileHtml = '&lt;li&gt;'+ '&lt;div class=\"send-file-shown\"&gt;' + '&lt;div class=\"media\"&gt;' + '&lt;a href=\"' + fileUrl + '\" class=\"media-left\"&gt;' + '&lt;i class=\"glyphicon glyphicon-file\" style=\"font-size:28pt;\"&gt;&lt;/i&gt;' + '&lt;/a&gt;' + '&lt;div class=\"media-body\"&gt; ' + '&lt;h5 class=\"media-heading\"&gt;' + originalFilename + '&lt;/h5&gt;' + '&lt;span&gt;'+ fileSize + '&lt;/span&gt;' + '&lt;/div&gt;' + '&lt;/div&gt;'+ '&lt;/div&gt;' + '&lt;div class=\"nesHead\"&gt;&lt;img src=\"' + avatarUrl + '\"/&gt;&lt;/div&gt;' + '&lt;/li&gt;'; // 3. å‘é€ä¿¡æ¯åˆ°æœåŠ¡å™¨ if (toUserId.length != 0) &#123; ws.fileMsgSingleSend(fromUserId, toUserId, originalFilename, fileUrl, fileSize); &#125; else &#123; ws.fileMsgGroupSend(fromUserId, toGroupId, originalFilename, fileUrl, fileSize); &#125; // 4. æ¶ˆæ¯æ¡†å¤„ç†ï¼š processMsgBox.sendFileMsg(fileHtml, toUserId, toGroupId); // 5. å¥½å‹åˆ—è¡¨å¤„ç† processFriendList.sending(content, $sendLi);&#125;);//ä¸Šä¼ å‰$('.myfile').on('filepreupload', function(event, data, previewId, index) &#123; console.log(\"filepreupload\");&#125;); æ–‡ä»¶ä¸Šä¼ çš„æ§åˆ¶å™¨ï¼š 123456@RequestMapping(value = \"/upload\", method = POST)@ResponseBody public ResponseJson upload( @RequestParam(value = \"file\", required = true) file, HttpServletRequest request) &#123; return fileUploadService.upload(file, request);&#125; æ–‡ä»¶ä¸Šä¼ çš„ä¸šåŠ¡é€»è¾‘å¤„ç†ï¼š 123456789101112131415161718192021222324252627282930313233343536373839public class FileUploadServiceImpl implements FileUploadService &#123; // é¡¹ç›®çš„æ‰“åŒ…ç›®å½•ï¼Œæœ¬é¡¹ç›®æ‰“åŒ…åœ¨æ ¹ç›®å½•ä¸‹ private final static String SERVER_URL_PREFIX = \"http://localhost:8080/\"; // ä¿å­˜ä¸Šä¼ æ–‡ä»¶çš„æ–‡ä»¶å¤¹åç§° private final static String FILE_STORE_PATH = \"UploadFile\"; @Override public ResponseJson upload(MultipartFile file, HttpServletRequest request) &#123; // é‡å‘½åæ–‡ä»¶ï¼Œé˜²æ­¢é‡å String filename = getRandomUUID(); String suffix = \"\"; String originalFilename = file.getOriginalFilename(); String fileSize = FileUtils.getFormatSize(file.getSize()); // æˆªå–æ–‡ä»¶çš„åç¼€å if (originalFilename.contains(\".\")) &#123; suffix = originalFilename.substring(originalFilename.lastIndexOf(\".\")); &#125; filename = filename + suffix; // getRealPath(â€œ/â€) è·å–å®é™…è·¯å¾„,â€œ/â€æŒ‡ä»£é¡¹ç›®æ ¹ç›®å½•,æ‰€ä»¥ä»£ç è¿”å›çš„æ˜¯é¡¹ç›®åœ¨å®¹å™¨ä¸­çš„å®é™…å‘å¸ƒè¿è¡Œçš„æ ¹è·¯å¾„ String prefix = request.getSession().getServletContext().getRealPath(\"/\") + FILE_STORE_PATH; System.out.println(\"å­˜å‚¨è·¯å¾„ä¸º:\" + prefix + \"\\\\\" + filename); Path filePath = Paths.get(prefix, filename); try &#123; Files.copy(file.getInputStream(), filePath); &#125; catch (IOException e) &#123; e.printStackTrace(); return new ResponseJson().error(\"æ–‡ä»¶ä¸Šä¼ å‘ç”Ÿé”™è¯¯ï¼\"); &#125; return new ResponseJson().success() .setData(\"originalFilename\", originalFilename) .setData(\"fileSize\", fileSize) .setData(\"fileUrl\", SERVER_URL_PREFIX + FILE_STORE_PATH + \"\\\\\" + filename); &#125; private String getRandomUUID() &#123; return UUID.randomUUID().toString().replace(\"-\", \"\"); &#125;&#125; WebSoclet å¤„ç†æ–‡ä»¶å‘é€æ–¹æ³•ï¼š 123456789101112131415161718192021222324public void FileMsgSingleSend(JSONObject param, ChannelHandlerContext ctx) &#123; String fromUserId = String.valueOf(param.get(\"fromUserId\")); String toUserId = (String)param.get(\"toUserId\"); String originalFilename = (String)param.get(\"originalFilename\"); String fileSize = (String)param.get(\"fileSize\"); String fileUrl = (String)param.get(\"fileUrl\"); ChannelHandlerContext toUserCtx = Constant.onlineUserMap.get(toUserId); if (toUserCtx == null) &#123; String responseJson = new ResponseJson() .error(MessageFormat.format(\"userIdä¸º &#123;0&#125; çš„ç”¨æˆ·æ²¡æœ‰ç™»å½•ï¼\", toUserId)) .toString(); sendMessage(ctx, responseJson); &#125; else &#123; String responseJson = new ResponseJson().success() .setData(\"fromUserId\", fromUserId) .setData(\"originalFilename\", originalFilename) .setData(\"fileSize\", fileSize) .setData(\"fileUrl\", fileUrl) .setData(\"type\", ChatType.FILE_MSG_SINGLE_SENDING) .toString(); sendMessage(toUserCtx, responseJson); &#125;&#125;// ç¾¤å‘æ–‡ä»¶åˆ™ä¸ç¾¤ç»„èŠå¤©ç±»ä¼¼ï¼Œå–ç¾¤ç»„ä¸­çš„ç”¨æˆ·çš„é€šé“éå†å‘é€æ–‡ä»¶ä¿¡æ¯ æ¥æ”¶è€…å¯¹è¯æ¡†æ¥æ”¶æ–‡ä»¶æ¶ˆæ¯çš„æ‹¼æ¥ï¼š 1234567891011121314151617181920212223242526272829303132333435363738fileMsgSingleRecieve: function(data) &#123; // è·å–ã€æ„é€ å‚æ•° console.log(data); var fromUserId = data.fromUserId; var originalFilename = data.originalFilename; var fileSize = data.fileSize; var fileUrl = data.fileUrl; var content = \"[æ–‡ä»¶]\"; var fromAvatarUrl; var $receiveLi; $('.conLeft').find('span.hidden-userId').each(function()&#123; if (this.innerHTML == fromUserId) &#123; fromAvatarUrl = $(this).parent(\".liRight\") .siblings(\".liLeft\").children('img').attr(\"src\"); $receiveLi = $(this).parent(\".liRight\").parent(\"li\"); &#125; &#125;) var fileHtml = '&lt;li&gt;'+ '&lt;div class=\"receive-file-shown\"&gt;' + '&lt;div class=\"media\"&gt;' + '&lt;div class=\"media-body\"&gt; ' + '&lt;h5 class=\"media-heading\"&gt;' + originalFilename + '&lt;/h5&gt;' + '&lt;span&gt;'+ fileSize + '&lt;/span&gt;' + '&lt;/div&gt;' + '&lt;a href=\"' + fileUrl + '\" class=\"media-right\"&gt;' + '&lt;i class=\"glyphicon glyphicon-file\" style=\"font-size:28pt;\"&gt;&lt;/i&gt;' + '&lt;/a&gt;' + '&lt;/div&gt;'+ '&lt;/div&gt;' + '&lt;div class=\"answerHead\"&gt;&lt;img src=\"' + fromAvatarUrl + '\"/&gt;&lt;/div&gt;' + '&lt;/li&gt;'; // æ¶ˆæ¯æ¡†å¤„ç† processMsgBox.receiveSingleMsg(fileHtml, fromUserId); // å¥½å‹åˆ—è¡¨å¤„ç† processFriendList.receiving(content, $receiveLi);&#125;,","categories":[{"name":"é¡¹ç›®å¼€å‘","slug":"é¡¹ç›®å¼€å‘","permalink":"http://yoursite.com/categories/%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91/"}],"tags":[{"name":"èŠå¤©å®¤","slug":"èŠå¤©å®¤","permalink":"http://yoursite.com/tags/%E8%81%8A%E5%A4%A9%E5%AE%A4/"}]},{"title":"Maven å®‰è£…å’Œé…ç½®","slug":"ç¯å¢ƒæ­å»º/Maven çš„å®‰è£…å’Œé…ç½®","date":"2020-01-30T06:36:59.000Z","updated":"2020-07-10T03:07:09.078Z","comments":true,"path":"2020/01/30/ç¯å¢ƒæ­å»º/Maven çš„å®‰è£…å’Œé…ç½®/","link":"","permalink":"http://yoursite.com/2020/01/30/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/Maven%20%E7%9A%84%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE/","excerpt":"Maven æ˜¯ä¸€ä¸ªé¡¹ç›®ç®¡ç†å·¥å…·ï¼Œå¯ä»¥å¯¹ Java é¡¹ç›®è¿›è¡Œæ„å»ºã€ä¾èµ–ç®¡ç†ã€‚","text":"Maven æ˜¯ä¸€ä¸ªé¡¹ç›®ç®¡ç†å·¥å…·ï¼Œå¯ä»¥å¯¹ Java é¡¹ç›®è¿›è¡Œæ„å»ºã€ä¾èµ–ç®¡ç†ã€‚ Maven çš„å®‰è£…Maven ä¸‹è½½åœ°å€ï¼šMaven ä¸‹è½½ 3..6.x ç‰ˆæœ¬ä¼šæœ‰è«åå…¶å¦™çš„æŠ¥é”™ï¼Œå»ºè®®ä½¿ç”¨ 3.5.x ç‰ˆæœ¬ è§£å‹åè¿›è¡Œç¯å¢ƒå˜é‡çš„é…ç½®ï¼šM2_HOMEã€%M2_HOME%\\binã€‚ åœ¨ cmd çª—å£ä¸‹è¾“å…¥mvn -væ˜¾ç¤º Maven ç‰ˆæœ¬å³é…ç½®æˆåŠŸã€‚ ä¿®æ”¹é…ç½®æ–‡ä»¶ç›®å½•ï¼šâ€¦apache-maven-3.6.3\\conf\\settings.xml æœ¬åœ°ä»“åº“ä½ç½®çš„ä¿®æ”¹åœ¨&lt;localRepository&gt;æ ‡ç­¾å†…æ·»åŠ è‡ªå·±çš„æœ¬åœ°ä½ç½®è·¯å¾„ã€‚ ä¿®æ”¹é»˜è®¤çš„ JDK ç‰ˆæœ¬123456789101112&lt;profile&gt; &lt;id&gt;JDK-1.8&lt;/id&gt; &lt;activation&gt; &lt;activeByDefault&gt;true&lt;/activeByDefault&gt; &lt;jdk&gt;1.8&lt;/jdk&gt; &lt;/activation&gt; &lt;properties&gt; &lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt; &lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt; &lt;maven.compiler.compilerVersion&gt;1.8&lt;/maven.compiler.compilerVersion&gt; &lt;/properties&gt; &lt;/profile&gt; æ·»åŠ å›½å†…é•œåƒæº1234567891011121314151617181920212223&lt;!-- é˜¿é‡Œäº‘ä»“åº“ --&gt;&lt;mirror&gt; &lt;id&gt;alimaven&lt;/id&gt; &lt;mirrorOf&gt;central&lt;/mirrorOf&gt; &lt;name&gt;aliyun maven&lt;/name&gt; &lt;url&gt;http://maven.aliyun.com/nexus/content/repositories/central/&lt;/url&gt;&lt;/mirror&gt;&lt;!-- ä¸­å¤®ä»“åº“1 --&gt;&lt;mirror&gt; &lt;id&gt;repo1&lt;/id&gt; &lt;mirrorOf&gt;central&lt;/mirrorOf&gt; &lt;name&gt;Human Readable Name for this Mirror.&lt;/name&gt; &lt;url&gt;http://repo1.maven.org/maven2/&lt;/url&gt;&lt;/mirror&gt;&lt;!-- ä¸­å¤®ä»“åº“2 --&gt;&lt;mirror&gt; &lt;id&gt;repo2&lt;/id&gt; &lt;mirrorOf&gt;central&lt;/mirrorOf&gt; &lt;name&gt;Human Readable Name for this Mirror.&lt;/name&gt; &lt;url&gt;http://repo2.maven.org/maven2/&lt;/url&gt;&lt;/mirror&gt; IDEA ä¸­é…ç½® Maven","categories":[{"name":"ç¯å¢ƒæ­å»º","slug":"ç¯å¢ƒæ­å»º","permalink":"http://yoursite.com/categories/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"}],"tags":[{"name":"Maven","slug":"Maven","permalink":"http://yoursite.com/tags/Maven/"}]},{"title":"IDEA å®‰è£…ä¸é…ç½®","slug":"ç¯å¢ƒæ­å»º/IDEA å®‰è£…ä¸é…ç½®","date":"2020-01-29T08:25:01.000Z","updated":"2020-04-19T06:41:32.058Z","comments":true,"path":"2020/01/29/ç¯å¢ƒæ­å»º/IDEA å®‰è£…ä¸é…ç½®/","link":"","permalink":"http://yoursite.com/2020/01/29/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/IDEA%20%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/","excerpt":"IDEA å…¨ç§° IntelliJ IDEAï¼Œæ˜¯javaè¯­è¨€å¼€å‘çš„é›†æˆç¯å¢ƒï¼ŒIntelliJåœ¨ä¸šç•Œè¢«å…¬è®¤ä¸ºæœ€å¥½çš„javaå¼€å‘å·¥å…·ä¹‹ä¸€ã€‚è®©æˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹è¿™æ¬¾ç¼–è¾‘å™¨ï¼Œå¹¶ä¸”è¿›è¡Œä¸€å®šçš„é…ç½®ã€‚","text":"IDEA å…¨ç§° IntelliJ IDEAï¼Œæ˜¯javaè¯­è¨€å¼€å‘çš„é›†æˆç¯å¢ƒï¼ŒIntelliJåœ¨ä¸šç•Œè¢«å…¬è®¤ä¸ºæœ€å¥½çš„javaå¼€å‘å·¥å…·ä¹‹ä¸€ã€‚è®©æˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹è¿™æ¬¾ç¼–è¾‘å™¨ï¼Œå¹¶ä¸”è¿›è¡Œä¸€å®šçš„é…ç½®ã€‚ IDEA å®‰è£…ä¸ç ´è§£ä¸‹è½½ IDEAï¼Œé“¾æ¥ï¼šhttps://share.weiyun.com/50wrg7G ä¸‹è½½ç ´è§£è¡¥ä¸ï¼Œé“¾æ¥ï¼šhttps://share.weiyun.com/5kRW75Z å®‰è£…è½¯ä»¶ ï¼ˆå…¨éƒ¨é»˜è®¤å°±è¡Œï¼Œå°ç¼–å®‰è£…åœ¨ D ç›˜çš„æ ¹ç›®å½•ï¼‰ï¼Œå®‰è£…å¥½åå°†ç ´è§£è¡¥ä¸å¤åˆ¶åˆ° \\IntelliJ IDEA 2019.1.4\\bin\\ ç›®å½•ä¸‹ï¼Œåœ¨ bin ç›®å½•ä¸‹åˆ†åˆ«æ‰¾åˆ° idea.exe.vmoptions å’Œ idea64.exe.vmoptionsï¼Œåœ¨æœ«å°¾æ·»åŠ -javaagent:å®‰è£…ç›®å½•ä¸‹çš„\\IntelliJ IDEA 2019.1.3\\bin\\jetbrains-agent.jaråä¿å­˜ã€‚ æ‰“å¼€ IDEAï¼Œé€‰æ‹©ä½¿ç”¨ï¼ˆEvaluate for freeï¼‰ï¼Œé€‰æ‹© Configure - Edit Custom VM Optionsï¼Œåœ¨å¼¹å‡ºçš„çª—å£ç¡®å®šæœ«å°¾æ˜¯åˆšåˆšä¿®æ”¹çš„å‚æ•° -javaagent:D:\\IntelliJ IDEA 2019.1.4\\bin\\jetbrains-agent.jar ï¼ˆå¦‚æœæç¤ºåˆ›å»ºï¼Œé€‰æ‹©æ˜¯ï¼Œåœ¨æœ«å°¾å†æ·»åŠ ä¸Šé¢çš„å‚æ•°ï¼‰ã€‚ é€‰æ‹© Manage Licenseï¼Œ License Server å¡«å†™http://jetbrains-license-serverï¼Œç‚¹å‡» Activateã€‚é‡å¯ä½ çš„ IDEA ,æŸ¥çœ‹æ˜¯å¦å·²ç»ç ´è§£æˆåŠŸã€‚ IDEA æ¨¡å—åœ¨ Eclipse ä¸­æˆ‘ä»¬æœ‰ Workspaceï¼ˆå·¥ä½œç©ºé—´ï¼‰å’Œ Projectï¼ˆå·¥ç¨‹ï¼‰çš„æ¦‚å¿µï¼Œåœ¨ IDEA ä¸­åªæœ‰ Projectï¼ˆå·¥ç¨‹ï¼‰å’Œ Moduleï¼ˆæ¨¡å—ï¼‰çš„æ¦‚å¿µã€‚ Eclipse IDEA Workspace Project Project Module IntelliJ IDEA æ˜¯æ— æ³•åœ¨åŒä¸€ä¸ªçª—å£ç®¡ç† n ä¸ªé¡¹ç›®ã€‚ IntelliJ IDEA æä¾›çš„è§£å†³æ–¹æ¡ˆæ˜¯æ‰“å¼€å¤šä¸ªé¡¹ç›®å®ä¾‹ï¼Œå³æ‰“å¼€å¤šä¸ªé¡¹ç›®çª—å£ã€‚ å³ï¼š ä¸€ä¸ª Project æ‰“å¼€ä¸€ä¸ª Window çª—å£ã€‚ åœ¨ IntelliJ IDEA ä¸­ Project æ˜¯æœ€é¡¶çº§çš„çº§åˆ«ï¼Œæ¬¡çº§åˆ«æ˜¯ Moduleã€‚ä¸€ä¸ª Project å¯ä»¥æœ‰å¤šä¸ª Moduleã€‚ç›®å‰ä¸»æµçš„å¤§å‹é¡¹ç›®éƒ½æ˜¯åˆ†å¸ƒå¼éƒ¨ç½²çš„ï¼Œ ç»“æ„éƒ½æ˜¯ç±»ä¼¼è¿™ç§å¤š Module ç»“æ„ã€‚ IDEA é…ç½®Viewï¼šToolbar [âˆš] è®¾ç½®ä¸»é¢˜ä¸‹è½½å–œæ¬¢çš„ IDEA çš„ä¸»é¢˜ï¼Œä¸‹è½½åœ°å€ï¼šthemesmap Fileï¼šImport setting é€‰ä¸­ä¸‹è½½çš„ä¸»é¢˜å¯¼å…¥åæç¤ºé‡å¯ï¼Œç­‰å¾…é‡å¯å®Œæˆ Editor General Mouseï¼šChange font size(Zoom) with Ctrl+Mouse Whee Otherï¼šShow quick documentation on mouse move Auto Import Javaï¼š appearanceï¼šShow method separators Code Completionï¼šMatch case [Ã—] Editor Tabsï¼šShow tabs in one row [Ã—] Fontï¼šSize File and Code Templates 1234/**@author Wingo@create $&#123;YEAR&#125;-$&#123;MONTH&#125;-$&#123;DAY&#125; $&#123;TIME&#125;*/ File Encodingï¼š Properties Filesï¼šUTF-8 [âˆš] å¿«æ·é”®è®¾ç½®KeyMapï¼šEclipse Eclipse å¸¸ç”¨å¿«æ·é”® æ‰§è¡Œ (run) alt+r æç¤ºè¡¥å…¨ (Class Name Completion) alt+/ å•è¡Œæ³¨é‡Š ctrl + / å¤šè¡Œæ³¨é‡Š ctrl + shift + / å‘ä¸‹å¤åˆ¶ä¸€è¡Œ (Duplicate Lines) ctrl+alt+down åˆ é™¤ä¸€è¡Œæˆ–é€‰ä¸­è¡Œ (delete line) ctrl+d å‘ä¸‹ç§»åŠ¨è¡Œ (move statement down) alt+down å‘ä¸Šç§»åŠ¨è¡Œ (move statement up) alt+up å‘ä¸‹å¼€å§‹æ–°çš„ä¸€è¡Œ (start new line) shift+enter å‘ä¸Šå¼€å§‹æ–°çš„ä¸€è¡Œ (Start New Line before current) ctrl+shift+enter å¦‚ä½•æŸ¥çœ‹æºç  (class) ctrl + é€‰ä¸­æŒ‡å®šçš„ç»“æ„ / ctrl + shift + t ä¸‡èƒ½è§£é”™ / ç”Ÿæˆè¿”å›å€¼å˜é‡ alt + enter é€€å›åˆ°å‰ä¸€ä¸ªç¼–è¾‘çš„é¡µé¢ (back) alt + left è¿›å…¥åˆ°ä¸‹ä¸€ä¸ªç¼–è¾‘çš„é¡µé¢ ( é’ˆå¯¹äºä¸Šæ¡ ) (forward) alt + right æŸ¥çœ‹ç»§æ‰¿å…³ç³» (type hierarchy) F4 æ ¼å¼åŒ–ä»£ç  (reformat code) ctrl+shift+F æç¤ºæ–¹æ³•å‚æ•°ç±»å‹ (Parameter Info) ctrl+alt+/ å¤åˆ¶ä»£ç  ctrl + c æ’¤é”€ ctrl + z åæ’¤é”€ ctrl + y æŸ¥çœ‹ç±»çš„ç»“æ„ï¼šç±»ä¼¼äº eclipse çš„ outline ctrl+o é‡æ„ï¼š ä¿®æ”¹å˜é‡åä¸æ–¹æ³•å (rename) alt+shift+r å¤§å†™è½¬å°å†™ / å°å†™è½¬å¤§å†™ (toggle case) ctrl+shift+y ç”Ÿæˆæ„é€ å™¨/get/set/toString alt +shift + s æŸ¥çœ‹æ–‡æ¡£è¯´æ˜(quick documentation) F2 ç”Ÿæˆ try-catch ç­‰(surround with) alt+shift+z å±€éƒ¨å˜é‡æŠ½å–ä¸ºæˆå‘˜å˜é‡(introduce field) alt+shift+f æŸ¥æ‰¾/æ›¿æ¢(å½“å‰) ctrl+f æŸ¥æ‰¾(å…¨å±€) ctrl+h æŸ¥æ‰¾æ–‡ä»¶ double Shift æŸ¥çœ‹ç±»çš„ç»§æ‰¿ç»“æ„å›¾(Show UML Diagram) ctrl + shift + u æŸ¥çœ‹æ–¹æ³•çš„å¤šå±‚é‡å†™ç»“æ„(method hierarchy) ctrl+alt+h æŠ½å–æ–¹æ³•(Extract Method) alt+shift+m å…³é—­å½“å‰æ‰“å¼€çš„ä»£ç æ (close) ctrl + w å…³é—­æ‰“å¼€çš„æ‰€æœ‰ä»£ç æ (close all) ctrl + shift + w å¿«é€Ÿæœç´¢ç±»ä¸­çš„é”™è¯¯(next highlighted error) ctrl + shift + q æŸ¥æ‰¾æ–¹æ³•åœ¨å“ªé‡Œè¢«è°ƒç”¨(Call Hierarchy) ctrl+shift+h å…³äºæ¨¡æ¿Editor &gt; General &gt; Postfix Completion Editor &gt; Live Templatesï¼ˆå¯è‡ªå®šä¹‰ï¼‰ ä¿®æ”¹å½“è¡Œæ³¨è§£é£æ ¼æ‰“å¼€ idea çš„è®¾ç½®ï¼Œä¾æ¬¡ç‚¹å‡»ã€ŒEditorã€â€”â€”ã€ŒCode Styleã€â€”â€”ã€ŒJavaã€â€”â€”ã€ŒCode Generationã€ï¼Œç„¶åå–æ¶ˆå‹¾é€‰ Line comment at first columnï¼ŒåŒæ—¶å‹¾é€‰ Add a space at comment start","categories":[{"name":"Software","slug":"Software","permalink":"http://yoursite.com/categories/Software/"}],"tags":[{"name":"IDEA","slug":"IDEA","permalink":"http://yoursite.com/tags/IDEA/"}]},{"title":"Hexo å®‰è£…ä¸é…ç½®","slug":"ç¯å¢ƒæ­å»º/Hexo å®‰è£…ä¸é…ç½®","date":"2020-01-29T04:59:01.000Z","updated":"2020-07-10T02:59:31.918Z","comments":true,"path":"2020/01/29/ç¯å¢ƒæ­å»º/Hexo å®‰è£…ä¸é…ç½®/","link":"","permalink":"http://yoursite.com/2020/01/29/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/Hexo%20%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/","excerpt":"Hexo ä»‹ç»Hexo æ˜¯ä¸€ä¸ªç®€å•ã€å¿«é€Ÿã€å¼ºå¤§çš„åŸºäº Github Pages çš„åšå®¢å‘å¸ƒå·¥å…·ï¼Œæ”¯æŒMarkdownæ ¼å¼ï¼Œæœ‰ä¼—å¤šä¼˜ç§€æ’ä»¶å’Œä¸»é¢˜ã€‚","text":"Hexo ä»‹ç»Hexo æ˜¯ä¸€ä¸ªç®€å•ã€å¿«é€Ÿã€å¼ºå¤§çš„åŸºäº Github Pages çš„åšå®¢å‘å¸ƒå·¥å…·ï¼Œæ”¯æŒMarkdownæ ¼å¼ï¼Œæœ‰ä¼—å¤šä¼˜ç§€æ’ä»¶å’Œä¸»é¢˜ã€‚ å®˜ç½‘ï¼š http://hexo.io GitHub æ­å»ºå·¥ä½œä»“åº“æ­å»ºHexo æ˜¯åŸºäº GitHub çš„ï¼Œé¦–å…ˆä½ éœ€è¦æœ‰ä¸€ä¸ª GitHub çš„è´¦å·ï¼Œå¹¶ä¸”åˆ›å»ºä¸€ä¸ªç”¨äºå­˜æ”¾åšå®¢çš„é™æ€æ–‡ä»¶çš„ä»“åº“ã€‚è¿™ä¸ªä»“åº“çš„åç§°å¿…é¡»æ˜¯[username].github.ioï¼Œä¹‹åä½ ä¾¿å¯ä»¥ç”¨http://[username].github.ioè®¿é—®ä½ æ­å»ºçš„åšå®¢ã€‚ åŸŸåç»‘å®šåœ¨äº‘å¹³å°è´­ä¹°è‡ªå·±å–œæ¬¢çš„åŸŸåï¼Œå¹¶ä¸”åœ¨å¹³å°çš„æ§åˆ¶å°è¿›è¡ŒåŸŸåçš„ç»‘å®šã€‚ æ‰“å¼€æ§åˆ¶å°ping http://[username].github.ioï¼Œå¾—åˆ° IP åœ°å€ã€‚ ç„¶ååˆ°ä½ çš„åŸŸå DNS è®¾ç½®é¡µï¼Œå°† A è®°å½•æŒ‡å‘ä½  ping å‡ºæ¥çš„ IPï¼Œå°† CNAME æŒ‡å‘[username].github.ioï¼Œè¿™æ ·å¯ä»¥ä¿è¯æ— è®ºæ˜¯å¦æ·»åŠ  www éƒ½å¯ä»¥è®¿é—®ã€‚ CNAME æ–‡ä»¶ï¼šåˆ›å»ºä¸€ä¸ª CNAME ï¼Œåœ¨å…¶ä¸­è¾“å…¥ä½ çš„åŸŸåï¼Œä¿å­˜åæ”¾ç½®åœ¨ä½ çš„ theme ç›®å½•ä¸‹çš„ resource ç›®å½•ä¸‹ é…ç½® SSH Keyåˆ° Github å®˜ç½‘ä¸‹è½½å®¢æˆ·ç«¯ï¼Œå³é”®é€‰æ‹© git bash hereã€‚è¾“å…¥ cd ~/.ssh æ£€æŸ¥æœ¬æœºæ˜¯å¦å·²ç»å­˜åœ¨ SSH å¯†é’¥ã€‚ è‹¥æ˜¾ç¤º No such file or directory åˆ™è¯´æ˜æœ¬æœºè¿˜æœªåˆ›å»º SSH å¯†é’¥ã€‚ è¾“å…¥ssh-keygen -t rsa -C &quot;[email]&quot;ï¼Œå¹¶è¿ç»­å›è½¦ç›´åˆ°æç¤ºå¯†é’¥ç”ŸæˆæˆåŠŸã€‚ è¾“å…¥cd ~/.sshï¼Œç„¶åè¾“å…¥lså³å¯çœ‹åˆ°æ­¤ç›®å½•ä¸‹ç”Ÿæˆçš„å…¬é’¥ï¼ˆpubï¼‰å’Œç§é’¥ã€‚åˆ©ç”¨catå‘½ä»¤å–å¾—å…¬é’¥çš„å†…å®¹ï¼Œå¹¶ä¸”å¤åˆ¶å…¬é’¥å†…å®¹ï¼Œç²˜è´´åˆ° GitHub çš„ Settings ä¸­çš„ SSH Keys ä¸­ï¼ˆåç§°è‡ªå®šä¹‰å³å¯ï¼‰ã€‚ è¾“å…¥ssh -T git@github.comï¼Œè¾“å…¥ yes åè‹¥æç¤ºè¿æ¥æˆåŠŸåˆ™ SSH Key é…ç½®æˆåŠŸã€‚ æ­¤å¤–ï¼Œä½ è¿˜éœ€è¦è¾“å…¥git config --global user.name &quot;[username]&quot;å’Œgit config --global user.email &quot;[email]&quot;è¿›è¡Œé…ç½®ã€‚ï¼ˆå±€éƒ¨é…ç½®æ—¶ä¸åŠ  --globalï¼‰ å¤šä¸ª SSH Keyä¸ºäº†åŒºåˆ«ä¸ªäºº / å…¬å¸çš„ä»£ç ä»“åº“ï¼Œå…¬å¸çš„ä»£ç ä»“åº“çš„é‚®ä»¶ç”Ÿæˆä¸€ä¸ªæ–°çš„ SSH Keyï¼Œä¸ºé¿å…ä¹‹å‰çš„åˆ›å»ºçš„ id_rsa è¢«è¦†ç›–ï¼Œæ­¤æ¬¡åˆ›å»ºéœ€è¦æ˜¾ç¤ºçš„é‡å‘½åæ–‡ä»¶ id_rsa_welabã€‚ å¾—åˆ°å…¬é’¥å¹¶ä¸”å¤åˆ¶åˆ°å…¬å¸ç”¨æˆ·åï¼Œè¿›è¡Œé¡¹ç›®å…‹éš†æ—¶æŠ¥é”™ï¼Œæ’æŸ¥åå‘ç°æ­¤ id_rsa_welab éé»˜è®¤å‘½åï¼Œæ•…éœ€è¦æ‰‹åŠ¨æ·»åŠ åˆ° ssh-agent ä¸­ï¼ˆéœ€æ‰‹åŠ¨å¼€å¯ï¼‰ã€‚ 12# å¼€å¯ ssh-agent !!! æ³¨æ„ æ˜¯ ~ ä¸‹é¢çš„ ``ï¼Œä¸æ˜¯ ''eval `ssh-agent` è¾“å…¥ ssh-add [path]å‘½ä»¤ã€‚ æ·»åŠ åå³å¯æˆåŠŸå…‹éš†é¡¹ç›®ã€‚ Hexo å®‰è£…é¦–å…ˆè¦å®‰è£… Node.jsï¼Œç„¶ååˆ©ç”¨ npm å®‰è£… Hexoã€‚ å³é”®é€‰æ‹© git bash hereã€‚è¾“å…¥npm install -g Hexoï¼Œç­‰å¾…ä¸‹è½½å®Œæˆã€‚ è¾“å…¥ cd [blog catalogue]ï¼Œåˆ°ä½ æ”¾ç½® Blog æ–‡ä»¶çš„ç›®å½•ä¸‹ï¼Œè¾“å…¥hexo initåˆå§‹åŒ– Hexo æ–‡ä»¶ã€‚ è¾“å…¥ hexo generateå›è½¦ï¼Œhexo serverå›è½¦ï¼Œæµè§ˆå™¨è¾“å…¥localhost:4000å³å¯çœ‹åˆ°åšå®¢é¡µé¢ å¸¸ç”¨å‘½ä»¤1234hexo cleanhexo generatehexo serverhexo deploy ä¸»é¢˜æ›´æ¢è§ï¼š[hexo-theme-indigo]","categories":[{"name":"ç¯å¢ƒæ­å»º","slug":"ç¯å¢ƒæ­å»º","permalink":"http://yoursite.com/categories/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"}],"tags":[{"name":"Hexo","slug":"Hexo","permalink":"http://yoursite.com/tags/Hexo/"}]},{"title":"Netty å¼•å¯¼","slug":"åå°æŠ€æœ¯/Netty/Netty å¼•å¯¼","date":"2020-01-25T16:25:24.000Z","updated":"2020-07-10T04:04:28.236Z","comments":true,"path":"2020/01/26/åå°æŠ€æœ¯/Netty/Netty å¼•å¯¼/","link":"","permalink":"http://yoursite.com/2020/01/26/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/Netty/Netty%20%E5%BC%95%E5%AF%BC/","excerpt":"å¼•å¯¼ä¸€ä¸ªåº”ç”¨ç¨‹åºæ˜¯æŒ‡å¯¹å®ƒè¿›è¡Œé…ç½®ï¼Œå¹¶ä½¿å®ƒè¿è¡Œèµ·æ¥çš„è¿‡ç¨‹ã€‚Nettyå¤„ç†å¼•å¯¼çš„æ–¹å¼ä½¿ä½ çš„åº”ç”¨ç¨‹åºå’Œç½‘ç»œå±‚ç›¸éš”ç¦»ï¼Œæ— è®ºå®ƒæ˜¯å®¢æˆ·ç«¯è¿˜æ˜¯æœåŠ¡å™¨ã€‚æ‰€æœ‰çš„æ¡†æ¶ç»„ä»¶éƒ½å°†ä¼šåœ¨åå°ç»“åˆåœ¨ ä¸€èµ·å¹¶ä¸”å¯ç”¨ã€‚","text":"å¼•å¯¼ä¸€ä¸ªåº”ç”¨ç¨‹åºæ˜¯æŒ‡å¯¹å®ƒè¿›è¡Œé…ç½®ï¼Œå¹¶ä½¿å®ƒè¿è¡Œèµ·æ¥çš„è¿‡ç¨‹ã€‚Nettyå¤„ç†å¼•å¯¼çš„æ–¹å¼ä½¿ä½ çš„åº”ç”¨ç¨‹åºå’Œç½‘ç»œå±‚ç›¸éš”ç¦»ï¼Œæ— è®ºå®ƒæ˜¯å®¢æˆ·ç«¯è¿˜æ˜¯æœåŠ¡å™¨ã€‚æ‰€æœ‰çš„æ¡†æ¶ç»„ä»¶éƒ½å°†ä¼šåœ¨åå°ç»“åˆåœ¨ ä¸€èµ·å¹¶ä¸”å¯ç”¨ã€‚ Bootstrap ç±»å¼•å¯¼ç±»çš„å±‚æ¬¡ç»“æ„åŒ…æ‹¬ä¸€ä¸ªæŠ½è±¡çš„çˆ¶ç±»å’Œä¸¤ä¸ªå…·ä½“çš„å¼•å¯¼å­ç±»ã€‚ ç›¸å¯¹äºå°†å…·ä½“çš„å¼•å¯¼ç±»åˆ†åˆ«çœ‹ä½œç”¨äºæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„å¼•å¯¼æ¥è¯´ï¼Œè®°ä½å®ƒä»¬çš„æœ¬æ„æ˜¯ç”¨æ¥æ”¯ æ’‘ä¸åŒçš„åº”ç”¨ç¨‹åºçš„åŠŸèƒ½ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒæœåŠ¡å™¨è‡´åŠ›äºä½¿ç”¨ä¸€ä¸ªçˆ¶ Channel æ¥æ¥å—æ¥è‡ªå®¢æˆ·ç«¯çš„è¿æ¥ï¼Œå¹¶åˆ›å»ºå­ Channel ä»¥ç”¨äºå®ƒä»¬ä¹‹é—´çš„é€šä¿¡ï¼›è€Œå®¢æˆ·ç«¯å°†æœ€å¯èƒ½åªéœ€è¦ä¸€ä¸ªå•ç‹¬çš„ã€æ²¡æœ‰çˆ¶ Channel çš„ Channel æ¥ç”¨äºæ‰€æœ‰çš„ç½‘ç»œäº¤äº’ã€‚ ä¸ºä»€ä¹ˆå¼•å¯¼ç±»æ˜¯ Cloneable çš„ï¼š ä½ æœ‰æ—¶å¯èƒ½ä¼šéœ€è¦åˆ›å»ºå¤šä¸ªå…·æœ‰ç±»ä¼¼é…ç½®æˆ–è€…å®Œå…¨ç›¸åŒé…ç½®çš„Channelã€‚ä¸ºäº†æ”¯æŒè¿™ç§æ¨¡å¼è€Œåˆä¸éœ€è¦ä¸ºæ¯ä¸ª Channel éƒ½åˆ›å»ºå¹¶é…ç½®ä¸€ä¸ªæ–°çš„å¼•å¯¼ç±»å®ä¾‹ï¼Œ AbstractBootstrap è¢«æ ‡è®°ä¸ºäº† Cloneableã€‚ æ³¨æ„ï¼Œè¿™ç§æ–¹å¼åªä¼šåˆ›å»ºå¼•å¯¼ç±»å®ä¾‹çš„ EventLoopGroup çš„ä¸€ä¸ªæµ…æ‹·è´ï¼Œæ‰€ä»¥ï¼Œåè€…å°†åœ¨æ‰€æœ‰å…‹éš†çš„ Channel å®ä¾‹ä¹‹é—´å…±äº«ã€‚è¿™æ˜¯å¯ä»¥æ¥å—çš„ï¼Œå› ä¸ºé€šå¸¸è¿™äº›å…‹éš†çš„ Channel çš„ç”Ÿå‘½å‘¨æœŸéƒ½å¾ˆçŸ­æš‚ï¼Œä¸€ä¸ªå…¸å‹çš„åœºæ™¯æ˜¯ï¼šåˆ›å»ºä¸€ä¸ª Channel ä»¥è¿›è¡Œä¸€æ¬¡HTTPè¯·æ±‚ã€‚ å¼•å¯¼å®¢æˆ·ç«¯Bootstrap ç±»è´Ÿè´£ä¸ºå®¢æˆ·ç«¯å’Œä½¿ç”¨æ— è¿æ¥åè®®çš„åº”ç”¨ç¨‹åºåˆ›å»º Channelã€‚ 12345678910111213141516171819202122232425262728293031323334// å¼•å¯¼ä¸€ä¸ªå®¢æˆ·ç«¯EventLoopGroup group = new NioEventLoopGroup();// åˆ›å»ºä¸€ä¸ª Bootstrap ç±»çš„å®ä¾‹ç”¨æ¥åˆ›å»ºå’Œè¿æ¥æ–°çš„å®¢æˆ·ç«¯ ChannelBootstrap bootstrap = new Bootstrap();// è®¾ç½® EventLoopGroup æä¾›ç”¨äºå¤„ç† Channel äº‹ä»¶çš„ EventLoopbootstrap.group(group) // æŒ‡å®šè¦ä½¿ç”¨çš„ Channel å®ç° .channel(NioSocketChannel.class) .handler( // è®¾ç½®ç”¨äº Channel äº‹ä»¶å’Œæ•°æ®çš„ ChannelInboundHandler new SimpleChannelInboundHandler&lt;ByteBuf&gt;() &#123; @Override protected void channeRead0(ChannelHandlerContext channelHandlerContext, ByteBuf byteBuf) throws Exception &#123; System.out.println(\"Received data\"); &#125; &#125; );ChannelFuture future = bootstrap.connect( // è¿æ¥åˆ°è¿œç¨‹ä¸»æœº new InetSocketAddress(\"www.manning.com\", 80));future.addListener( new ChannelFutureListener() &#123; @Override public void operationComplete(ChannelFuture channelFuture) throws Exception &#123; if (channelFuture.isSuccess()) &#123; System.out.println(\"Connection established\"); &#125; else &#123; System.err.println(\"Connection attempt failed\"); channelFuture.cause().printStackTrace(); &#125; &#125; &#125; ); å¼•å¯¼æœåŠ¡å™¨è´Ÿè´£å¼•å¯¼ ServerChannel çš„ ServerBootstrap æä¾›äº†è´Ÿè´£åˆ›å»ºå­ Channel çš„æ–¹æ³• childXxx()ï¼Œè¿™äº›å­ Channel ä»£è¡¨äº†å·²è¢«æ¥æ”¶çš„è¿æ¥ã€‚ 1234567891011121314151617181920212223242526272829// å¼•å¯¼æœåŠ¡å™¨NioEventLoopGroup group = new NioEventLoopGroup();ServerBootstrap bootstrap = new ServerBootstrap();bootstrap.group(group) .channel(NioServerSocketChannel.class) // å­çº¿ç¨‹ .childHandler( new SimpleChannelInboundHandler&lt;ByteBuf&gt;() &#123; @Override protected void channelRead0(ChannelHandlerContext ctx, ByteBuf byteBuf) throws Exception &#123; System.out.println(\"Received data\"); &#125; &#125; );// ç›‘å¬ç«¯å£ChannelFuture future = bootstrap.bind(new InetSocketAddress(8080));future.addListener( new ChannelFutureListener() &#123; @Override public void operationComplete(ChannelFuture channelFuture) throws Exception &#123; if (channelFuture.isSuccess()) &#123; System.out.println(\"Server bound\"); &#125; else &#123; System.err.println(\"Bound attempt failed\"); channelFuture.cause().printStackTrace(); &#125; &#125; &#125; ); ä» Channel å¼•å¯¼å®¢æˆ·ç«¯å‡è®¾ä½ çš„æœåŠ¡å™¨æ­£åœ¨å¤„ç†ä¸€ä¸ªå®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œè¿™ä¸ªè¯·æ±‚éœ€è¦å®ƒå……å½“ç¬¬ä¸‰æ–¹ç³»ç»Ÿçš„å®¢æˆ·ç«¯ã€‚ 1234567891011121314151617181920212223242526272829303132333435ServerBootstrap bootstrap = new ServerBootstrap();bootstrap.group(new NioEventLoopGroup(), new NioEventLoopGroup()) .channel(NioServerSocketChannel.class) .childHandler( new SimpleChannelInboundHandler&lt;ByteBuf&gt;() &#123; ChannelFuture connectFuture; @Override public void channelActive(ChannelHandlerContext ctx) throws Exception &#123; Bootstrap bootstrap = new Bootstrap(); bootstrap.channel(NioSocketChannel.class).handler( new SimpleChannelInboundHandler&lt;ByteBuf&gt;() &#123; @Override protected void channelRead0(ChannelHandlerContext ctx, ByteBuf in) throws Exception &#123; System.out.println(\"Received data\"); &#125; &#125; ); // ä½¿ç”¨ä¸åˆ†é…ç»™å·²è¢«æ¥å—çš„å­ Channel ç›¸åŒçš„ EventLoop bootstrap.group(ctx.channel().eventLoop()); connectFuture = bootstrap.connect( new InetSocketAddress(\"www.manning.com\", 80)); &#125; @Override protected void channelRead0(ChannelHandlerContext channelHandlerContext, ByteBuf byteBuf) throws Exception &#123; if (connectFuture.isDone()) &#123; // do something with the data &#125; &#125; &#125; );ChannelFuture future = bootstrap.bind(new InetSocketAddress(8080));future.addListener(new ChannelFutureListener() &#123; @Override public void operationComplete(ChannelFuture channelFuture)throws Exception &#123; if (channelFuture.isSuccess()) &#123; System.out.println(\"Server bound\"); &#125; else &#123; System.err.println(\"Bind attempt failed\"); channelFuture.cause().printStackTrace(); &#125; &#125; &#125; ); å°½å¯èƒ½åœ°é‡ç”¨ EventLoopï¼Œä»¥å‡å°‘çº¿ç¨‹åˆ›å»ºæ‰€å¸¦æ¥çš„å¼€é”€ã€‚ åœ¨å¼•å¯¼è¿‡ç¨‹ä¸­æ·»åŠ å¤šä¸ª ChannelHandleråœ¨å‰é¢çš„å‡ ä¸ªä¾‹å­ä¸­ï¼Œåœ¨å¼•å¯¼çš„è¿‡ç¨‹ä¸­è°ƒç”¨äº† handler() æˆ–è€… childHandler() æ–¹æ³•æ¥æ·»åŠ å•ä¸ªçš„ ChannelHandlerã€‚è¿™å¯¹äºç®€å•çš„åº”ç”¨ç¨‹åºæ¥è¯´å¯èƒ½å·²ç»è¶³å¤Ÿäº†ï¼Œä½†æ˜¯å®ƒä¸èƒ½æ»¡è¶³æ›´åŠ å¤æ‚çš„éœ€æ±‚ã€‚ protected abstract void initChannel(C ch) throws Exception; è¿™ä¸ªæ–¹æ³•æä¾›äº†ä¸€ç§å°†å¤šä¸ª ChannelHandler æ·»åŠ åˆ°ä¸€ä¸ª ChannelPipeline ä¸­çš„ç®€ä¾¿æ–¹æ³• 12345678910111213141516// å¼•å¯¼å’Œä½¿ç”¨ ChannelInitializerServerBootstrap bootstrap = new ServerBootstrap();bootstrap.group(new NioEventLoopGroup(), new NioEventLoopGroup()) .channel(NioServerSocketChannel.class) .childHandler(new ChannelInitializerImpl());ChannelFuture future = bootstrap.bind(new InetSocketAddress(8080));future.sync();// ChannelInitializer çš„å®ç°final class ChannelInitializerImpl extends ChannelInitializer&lt;Channel&gt; &#123; @Override protected void initChannel(Channel ch) throws Exception &#123; ChannelPipeline pipeline = ch.pipeline(); pipeline.addLast(new HttpClientCodec()); pipeline.addLast(new HttpObjectAggregator(Integer.MAX_VALUE)); &#125; &#125; å¦‚æœä½ çš„åº”ç”¨ç¨‹åºä½¿ç”¨äº†å¤šä¸ª ChannelHandlerï¼Œè¯·å®šä¹‰ä½ è‡ªå·±çš„ ChannelInitializer å®ç°æ¥å°†å®ƒä»¬å®‰è£…åˆ° ChannelPipeline ä¸­ã€‚ ChannelOption å’Œå±æ€§ä½ å¯ä»¥ä½¿ç”¨ option() æ–¹æ³•æ¥å°† ChannelOption åº”ç”¨åˆ°å¼•å¯¼ã€‚ä½ æ‰€æä¾›çš„å€¼å°†ä¼šè¢«è‡ªåŠ¨åº”ç”¨åˆ°å¼•å¯¼æ‰€åˆ›å»ºçš„æ‰€æœ‰ Channelã€‚å¯ç”¨çš„ ChannelOption åŒ…æ‹¬äº†åº•å±‚è¿æ¥çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¦‚ keep-alive æˆ–è€…è¶…æ—¶å±æ€§ä»¥åŠç¼“å†²åŒºè®¾ç½®ã€‚ Netty æä¾›äº† AttributeMap æŠ½è±¡ï¼ˆä¸€ä¸ªç”± Channel å’Œå¼•å¯¼ç±»æä¾›çš„é›†åˆï¼‰ä»¥åŠ AttributeKeyï¼ˆä¸€ ä¸ªç”¨äºæ’å…¥å’Œè·å–å±æ€§å€¼çš„æ³›å‹ç±»ï¼‰ã€‚ä½¿ç”¨è¿™äº›å·¥å…·ï¼Œä¾¿å¯ä»¥å®‰å…¨åœ°å°†ä»»ä½•ç±»å‹çš„æ•°æ®é¡¹ä¸å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ Channelï¼ˆåŒ…å« ServerChannel çš„å­ Channelï¼‰ç›¸å…³è”äº†ã€‚ 123456789101112131415161718192021222324252627// ä½¿ç”¨å±æ€§å€¼// åˆ›å»ºä¸€ä¸ª AttributeKey ä»¥æ ‡è¯†è¯¥å±æ€§final AttributeKey&lt;Integer&gt; id = new AttributeKey&lt;Integer&gt;(\"ID\");Bootstrap bootstrap = new Bootstrap();bootstrap.group(new NioEventLoopGroup()) .channel(NioSocketChannel.class) .handler( new SimpleChannelInboundHandler&lt;ByteBuf&gt;() &#123; @Override public void channelRegistered(ChannelHandlerContext ctx) throws Exception &#123; // ä½¿ç”¨ AttributeKey æ£€ç´¢å±æ€§ä»¥åŠå®ƒçš„å€¼ Integer idValue = ctx.channel().attr(id).get(); // do something with the idValue &#125; @Override protected void channelRead0(ChannelHandlerContext channelHandlerContext, ByteBuf byteBuf) throws Exception &#123; System.out.println(\"Received data\"); &#125; &#125; );// å¼•å¯¼çš„æ¯ä¸€ä¸ª Channel éƒ½å°†å…·æœ‰è¿™äº›å±æ€§bootstrap.option(ChannelOption.SO_KEEPALIVE,true) .option(ChannelOption.CONNECT_TIMEOUT_MILLIS, 5000);// å­˜å‚¨è¯¥ id å±æ€§bootstrap.attr(id, 123456);ChannelFuture future = bootstrap.connect(new InetSocketAddress(\"www.manning.com\", 80));future.syncUninterruptibly(); å¼•å¯¼ DatagramChannelé™¤äº†åŸºäº TCP åè®®çš„ SocketChannelï¼ŒBootstrap ç±»ä¹Ÿå¯ä»¥è¢«ç”¨äºæ— è¿æ¥åè®®ã€‚ä¸ºæ­¤ã€‚Netty æä¾›äº†å„ç§ DatagramChannel çš„å®ç°ã€‚å”¯ä¸€åŒºåˆ«å°±æ˜¯ï¼Œä¸å†è°ƒç”¨ connect() æ–¹æ³•ï¼Œè€Œæ˜¯åªè°ƒç”¨ bind() æ–¹æ³•ã€‚ 1234567891011121314151617181920212223242526// ä½¿ç”¨ Bootstrap å’Œ DatagramChannelBootstrap bootstrap = new Bootstrap();bootstrap.group(new OioEventLoopGroup()) .channel(OioDatagramChannel.class) .handler( new SimpleChannelInboundHandler&lt;DatagramPacket&gt;()&#123; @Override public void channelRead0(ChannelHandlerContext ctx, DatagramPacket msg) throws Exception &#123; // Do something with the packet &#125; &#125; );// è°ƒç”¨ bind() æ–¹æ³•ï¼Œå› ä¸ºè¯¥åè®®æ˜¯æ— è¿æ¥çš„ChannelFuture future = bootstrap.bind(new InetSocketAddress(0));future.addListener(new ChannelFutureListener() &#123; @Override public void operationComplete(ChannelFuture channelFuture) throws Exception &#123; if (channelFuture.isSuccess()) &#123; System.out.println(\"Channel bound\"); &#125; else &#123; System.err.println(\"Bind attempt failed\"); channelFuture.cause().printStackTrace(); &#125; &#125;&#125;); å…³é—­å¼•å¯¼ä½¿ä½ çš„åº”ç”¨ç¨‹åºå¯åŠ¨å¹¶ä¸”è¿è¡Œèµ·æ¥ï¼Œä½†æ˜¯è¿Ÿæ—©ä½ éƒ½éœ€è¦ä¼˜é›…åœ°å°†å®ƒå…³é—­ã€‚ 123456789// ä¼˜é›…çš„å…³é—­EventLoopGroup group = new NioEventLoopGroup();Bootstrap bootstrap = new Bootstrap();bootstrap.group(group) .channel(NioSocketChannel.class);...;Future&lt;?&gt; future = group.shutdownGracefully();// block until the group has shutdownfuture.syncUninterruptibly(); æ³¨æ„ï¼ŒshutdownGracefully() æ–¹æ³•ä¹Ÿæ˜¯ä¸€ä¸ªå¼‚æ­¥çš„æ“ä½œï¼Œæ‰€ä»¥ä½ éœ€è¦é˜»å¡ç­‰å¾…ç›´åˆ°å®ƒå®Œæˆï¼Œæˆ–è€…å‘æ‰€è¿”å›çš„ Future æ³¨å†Œä¸€ä¸ªç›‘å¬å™¨ä»¥åœ¨å…³é—­å®Œæˆæ—¶è·å¾—é€šçŸ¥ã€‚","categories":[{"name":"åå°æŠ€æœ¯","slug":"åå°æŠ€æœ¯","permalink":"http://yoursite.com/categories/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"Netty","slug":"Netty","permalink":"http://yoursite.com/tags/Netty/"}]},{"title":"Netty EventLoop å’Œçº¿ç¨‹æ¨¡å‹","slug":"åå°æŠ€æœ¯/Netty/Netty EventLoop å’Œçº¿ç¨‹æ¨¡å‹","date":"2020-01-25T08:09:20.000Z","updated":"2020-07-10T04:04:11.749Z","comments":true,"path":"2020/01/25/åå°æŠ€æœ¯/Netty/Netty EventLoop å’Œçº¿ç¨‹æ¨¡å‹/","link":"","permalink":"http://yoursite.com/2020/01/25/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/Netty/Netty%20EventLoop%20%E5%92%8C%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B/","excerpt":"çº¿ç¨‹æ¨¡å‹æŒ‡å®šäº†æ“ä½œç³»ç»Ÿã€ç¼–ç¨‹è¯­è¨€ã€æ¡†æ¶æˆ–è€…åº”ç”¨ç¨‹åºçš„ä¸Šä¸‹æ–‡ä¸­çš„çº¿ç¨‹ç®¡ç†çš„å…³é”®æ–¹é¢ï¼Œå¦‚ä½•ä»¥åŠä½•æ—¶åˆ›å»ºçº¿ç¨‹å°†å¯¹åº”ç”¨ç¨‹åºä»£ç çš„æ‰§è¡Œäº§ç”Ÿæ˜¾è‘—çš„å½±å“ã€‚","text":"çº¿ç¨‹æ¨¡å‹æŒ‡å®šäº†æ“ä½œç³»ç»Ÿã€ç¼–ç¨‹è¯­è¨€ã€æ¡†æ¶æˆ–è€…åº”ç”¨ç¨‹åºçš„ä¸Šä¸‹æ–‡ä¸­çš„çº¿ç¨‹ç®¡ç†çš„å…³é”®æ–¹é¢ï¼Œå¦‚ä½•ä»¥åŠä½•æ—¶åˆ›å»ºçº¿ç¨‹å°†å¯¹åº”ç”¨ç¨‹åºä»£ç çš„æ‰§è¡Œäº§ç”Ÿæ˜¾è‘—çš„å½±å“ã€‚ çº¿ç¨‹æ¨¡å‹æ¦‚è¿°å¤šæ ¸å¿ƒæˆ–å¤šä¸ª CPU çš„è®¡ç®—æœºç°åœ¨å·²ç»å¸ç©ºè§æƒ¯ï¼Œå¤§å¤šæ•°çš„ç°ä»£åº”ç”¨ç¨‹åºéƒ½åˆ©ç”¨äº† å¤æ‚çš„å¤šçº¿ç¨‹å¤„ç†æŠ€æœ¯ä»¥æœ‰æ•ˆåœ°åˆ©ç”¨ç³»ç»Ÿèµ„æºã€‚ åœ¨æ—©æœŸçš„ Java è¯­è¨€ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨å¤šçº¿ç¨‹å¤„ç†çš„ä¸»è¦æ–¹å¼æ— éæ˜¯æŒ‰éœ€åˆ›å»ºå’Œå¯åŠ¨æ–°çš„ Thread æ¥æ‰§è¡Œå¹¶å‘çš„ä»»åŠ¡å•å…ƒï¼Œè¿™æ˜¯ä¸€ç§åœ¨é«˜è´Ÿè½½ä¸‹å·¥ä½œå¾—å¾ˆå·®çš„åŸå§‹æ–¹å¼ã€‚Java 5 éšåå¼•å…¥äº† Executor APIï¼Œå…¶çº¿ç¨‹æ± é€šè¿‡ç¼“å­˜å’Œé‡ç”¨ Thread æå¤§åœ°æé«˜äº†æ€§èƒ½ã€‚ è™½ç„¶æ± åŒ–å’Œé‡ç”¨çº¿ç¨‹ç›¸å¯¹äºç®€å•åœ°ä¸ºæ¯ä¸ªä»»åŠ¡éƒ½åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹æ˜¯ä¸€ç§è¿›æ­¥ï¼Œä½†æ˜¯å®ƒå¹¶ä¸èƒ½ æ¶ˆé™¤ç”±ä¸Šä¸‹æ–‡åˆ‡æ¢æ‰€å¸¦æ¥çš„å¼€é”€ï¼Œå…¶å°†éšç€çº¿ç¨‹æ•°é‡çš„å¢åŠ å¾ˆå¿«å˜å¾—æ˜æ˜¾ï¼Œå¹¶ä¸”åœ¨é«˜è´Ÿè½½ä¸‹æ„ˆæ¼”æ„ˆçƒˆã€‚Netty æ¡†æ¶å¸®åŠ©ç®€åŒ–äº†è¿™ä¸€å¤„ç†ã€‚ EventLoop æ¥å£è¿è¡Œä»»åŠ¡æ¥å¤„ç†åœ¨è¿æ¥çš„ç”Ÿå‘½å‘¨æœŸå†…å‘ç”Ÿçš„äº‹ä»¶æ˜¯ä»»ä½•ç½‘ç»œæ¡†æ¶çš„åŸºæœ¬åŠŸèƒ½ã€‚ä¸ä¹‹ç›¸åº”çš„ç¼–ç¨‹ä¸Šçš„æ„é€ é€šå¸¸è¢«ç§°ä¸ºäº‹ä»¶å¾ªç¯ï¼šNetty ä½¿ç”¨äº† interface io.netty.channel.EventLoop æ¥é€‚é…çš„æœ¯è¯­ã€‚ 1234567// åœ¨äº‹ä»¶å¾ªç¯ä¸­æ‰§è¡Œä»»åŠ¡while (!terminated) &#123; List&lt;Runnable&gt; readyEvents = blockUntilEventsReady(); for (Runnable ev: readyEvents) &#123; ev.run(); &#125; &#125; Netty çš„ EventLoop æ˜¯ååŒè®¾è®¡çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒé‡‡ç”¨äº†ä¸¤ä¸ªåŸºæœ¬çš„ APIï¼šå¹¶å‘å’Œç½‘ç»œç¼–ç¨‹ã€‚é¦–å…ˆï¼Œio.netty.util.concurrent åŒ…æ„å»ºåœ¨ JDK çš„ java.util.concurrent åŒ…ä¸Šï¼Œç”¨æ¥æä¾›çº¿ç¨‹æ‰§è¡Œå™¨ã€‚å…¶æ¬¡ï¼Œio.netty.channel åŒ…ä¸­çš„ç±»ï¼Œä¸ºäº†ä¸ Channel çš„äº‹ä»¶è¿›è¡Œäº¤äº’ï¼Œæ‰©å±•äº†è¿™äº›æ¥å£/ç±»ã€‚ åœ¨è¿™ä¸ªæ¨¡å‹ä¸­ï¼Œä¸€ä¸ª EventLoop å°†ç”±ä¸€ä¸ªæ°¸è¿œéƒ½ä¸ä¼šæ”¹å˜çš„ Thread é©±åŠ¨ï¼ŒåŒæ—¶ä»»åŠ¡ ï¼ˆRunnable æˆ–è€… Callableï¼‰å¯ä»¥ç›´æ¥æäº¤ç»™ EventLoop å®ç°ï¼Œä»¥ç«‹å³æ‰§è¡Œæˆ–è€…è°ƒåº¦æ‰§è¡Œã€‚æ ¹æ®é…ç½®å’Œå¯ç”¨æ ¸å¿ƒçš„ä¸åŒï¼Œå¯èƒ½ä¼šåˆ›å»ºå¤šä¸ª EventLoop å®ä¾‹ç”¨ä»¥ä¼˜åŒ–èµ„æºçš„ä½¿ç”¨ï¼Œå¹¶ä¸”å•ä¸ª EventLoop å¯èƒ½ä¼šè¢«æŒ‡æ´¾ç”¨äºæœåŠ¡å¤šä¸ª Channelã€‚ äº‹ä»¶/ä»»åŠ¡çš„æ‰§è¡Œé¡ºåº ï¼š äº‹ä»¶å’Œä»»åŠ¡æ˜¯ä»¥å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰çš„é¡ºåºæ‰§è¡Œçš„ã€‚è¿™æ ·å¯ä»¥é€šè¿‡ä¿è¯å­—èŠ‚å†…å®¹æ€»æ˜¯æŒ‰æ­£ç¡®çš„é¡ºåºè¢«å¤„ç†ï¼Œæ¶ˆé™¤æ½œåœ¨çš„æ•°æ®æŸåçš„å¯èƒ½æ€§ã€‚ ä»»åŠ¡è°ƒåº¦ä½¿ç”¨æ ¸å¿ƒçš„ Java API å’Œ Netty çš„ EventLoop æ¥è°ƒåº¦ä»»åŠ¡ JDK çš„ä»»åŠ¡è°ƒåº¦ API123456789101112// ä½¿ç”¨ ScheduledExecutorService æ¥åœ¨ 60 ç§’çš„å»¶è¿Ÿä¹‹åæ‰§è¡Œä¸€ä¸ªä»»åŠ¡ScheduledExecutorService executor = Executors.newScheduledThreadPool(10);ScheduledFuture&lt;?&gt; future = executor.schedule( new Runnable() &#123; @Override public void run() &#123; System.out.println(\"60 seconds later\"); &#125; &#125;, 60, TimeUnit.SECONDS); // è°ƒåº¦ä»»åŠ¡åœ¨ä»ç°åœ¨å¼€å§‹çš„ 60 ç§’ä¹‹åæ‰§è¡Œ...;executor.shutdown(); ä½¿ç”¨ EventLoop è°ƒåº¦ä»»åŠ¡12345678910// ä½¿ç”¨ EventLoop æ¥åœ¨ 60 ç§’çš„å»¶è¿Ÿä¹‹åæ‰§è¡Œä¸€ä¸ªä»»åŠ¡Channel ch = ...;ScheduledFuture&lt;?&gt; future = ch.eventLoop().schedule( new Runnable() &#123; @Override public void run() &#123; System.out.println(\"60 seconds later\"); &#125; &#125;, 60, TimeUnit.SECONDS); 123456789101112// ä½¿ç”¨ EventLoop è°ƒåº¦å‘¨æœŸæ€§çš„ä»»åŠ¡Channel ch = ...;ScheduledFuture&lt;?&gt; future = ch.eventLoop().scheduleAtFixedRate( new Runnable() &#123; @Override public void run() &#123; System.out.println(\"Run every 60 seconds\"); &#125; &#125;, 60, 60, TimeUnit.Seconds);// åˆ©ç”¨æ¯ä¸ªå¼‚æ­¥æ“ä½œæ‰€è¿”å›çš„ ScheduledFuture å–æ¶ˆä»»åŠ¡future.cancel(false); å®ç°ç»†èŠ‚æ›´åŠ è¯¦ç»†åœ°æ¢è®¨ Netty çš„çº¿ç¨‹æ¨¡å‹å’Œä»»åŠ¡è°ƒåº¦å®ç°çš„ä¸»è¦å†…å®¹ã€‚ çº¿ç¨‹ç®¡ç†Netty çº¿ç¨‹æ¨¡å‹çš„å“è¶Šæ€§èƒ½å–å†³äºå¯¹äºå½“å‰æ‰§è¡Œçš„ Thread çš„èº«ä»½çš„ç¡®å®šã€‚ æ°¸è¿œä¸è¦å°†ä¸€ä¸ªé•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡æ”¾å…¥åˆ°æ‰§è¡Œé˜Ÿåˆ—ä¸­ï¼Œå› ä¸ºå®ƒå°†é˜»å¡éœ€è¦åœ¨åŒä¸€çº¿ç¨‹ä¸Šæ‰§è¡Œçš„ä»»ä½•å…¶ä»–ä»»åŠ¡ã€‚å¦‚æœå¿…é¡»è¦è¿›è¡Œé˜»å¡è°ƒç”¨æˆ–è€…æ‰§è¡Œé•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡ï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨ä¸€ä¸ªä¸“é—¨çš„ EventExecutorã€‚ EventLoop / çº¿ç¨‹çš„åˆ†é…æœåŠ¡äº Channel çš„ I/O å’Œäº‹ä»¶çš„ EventLoop åŒ…å«åœ¨ EventLoopGroup ä¸­ã€‚æ ¹æ®ä¸åŒçš„ä¼ è¾“å®ç°ï¼ŒEventLoop çš„åˆ›å»ºå’Œåˆ†é…æ–¹å¼ä¹Ÿä¸åŒã€‚ å¼‚æ­¥ä¼ è¾“å¼‚æ­¥ä¼ è¾“å®ç°åªä½¿ç”¨äº†å°‘é‡çš„ EventLoopï¼ˆä»¥åŠå’Œå®ƒä»¬ç›¸å…³è”çš„ Threadï¼‰ï¼Œè€Œä¸”åœ¨å½“å‰çš„çº¿ç¨‹æ¨¡å‹ä¸­ï¼Œå®ƒä»¬å¯èƒ½ä¼šè¢«å¤šä¸ª Channel æ‰€å…±äº«ã€‚è¿™ä½¿å¾—å¯ä»¥é€šè¿‡å°½å¯èƒ½å°‘é‡çš„ Thread æ¥æ”¯æ’‘å¤§é‡çš„ Channelï¼Œè€Œä¸æ˜¯æ¯ä¸ª Channel åˆ†é…ä¸€ä¸ª Threadã€‚ ä¸€æ—¦ä¸€ä¸ª Channel è¢«åˆ†é…ç»™ä¸€ä¸ª EventLoopï¼Œå®ƒå°†åœ¨å®ƒçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­éƒ½ä½¿ç”¨è¿™ä¸ª EventLoopï¼ˆä»¥åŠç›¸å…³è”çš„ Threadï¼‰ã€‚ é˜»å¡ä¼ è¾“è¿™é‡Œæ¯ä¸€ä¸ª Channel éƒ½å°†è¢«åˆ†é…ç»™ä¸€ä¸ª EventLoopï¼ˆä»¥åŠå®ƒçš„ Threadï¼‰ã€‚ æ¯ä¸ª Channel çš„ I/O äº‹ä»¶éƒ½å°†åªä¼šè¢«ä¸€ä¸ª Thread ï¼ˆç”¨äºæ”¯æ’‘è¯¥ Channel çš„ EventLoop çš„é‚£ä¸ª Threadï¼‰å¤„ç†ï¼ˆNetty çš„ä¸€è‡´æ€§ä½“ç°ï¼‰ã€‚","categories":[{"name":"åå°æŠ€æœ¯","slug":"åå°æŠ€æœ¯","permalink":"http://yoursite.com/categories/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"Netty","slug":"Netty","permalink":"http://yoursite.com/tags/Netty/"}]},{"title":"Netty ChannelHandler å’Œ ChannelPipeline","slug":"åå°æŠ€æœ¯/Netty/Netty ChannelHandler å’Œ ChannelPipeline","date":"2020-01-24T14:09:35.000Z","updated":"2020-07-10T04:04:14.733Z","comments":true,"path":"2020/01/24/åå°æŠ€æœ¯/Netty/Netty ChannelHandler å’Œ ChannelPipeline/","link":"","permalink":"http://yoursite.com/2020/01/24/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/Netty/Netty%20ChannelHandler%20%E5%92%8C%20ChannelPipeline/","excerpt":"ChannelPipeline ä¸­å°† ChannelHandler é“¾æ¥åœ¨ä¸€èµ·ä»¥ç»„ç»‡å¤„ç†é€»è¾‘ï¼Œè¿˜æœ‰ä¸€ä¸ªé‡è¦çš„å…³ç³» ChannelHandlerContextã€‚","text":"ChannelPipeline ä¸­å°† ChannelHandler é“¾æ¥åœ¨ä¸€èµ·ä»¥ç»„ç»‡å¤„ç†é€»è¾‘ï¼Œè¿˜æœ‰ä¸€ä¸ªé‡è¦çš„å…³ç³» ChannelHandlerContextã€‚ ChannelHandler å®¶æ—Channel çš„ç”Ÿå‘½å‘¨æœŸå½“ Channel çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œå°†ä¼šç”Ÿæˆå¯¹åº”çš„äº‹ä»¶ã€‚è¿™äº›äº‹ä»¶å°†ä¼šè¢«è½¬å‘ç»™ ChannelPipeline ä¸­çš„ ChannelHandlerï¼Œå…¶å¯ä»¥éšåå¯¹å®ƒä»¬åšå‡ºå“åº”ã€‚ ChannelHandler çš„ç”Ÿå‘½å‘¨æœŸ ç±»å‹ æè¿° handlerAdded å½“æŠŠ ChannelHandler æ·»åŠ åˆ° ChannelPipeline ä¸­æ—¶è¢«è°ƒç”¨ handlerRemoved å½“ä» ChannelPipeline ä¸­ç§»é™¤ ChannelHandler æ—¶è¢«è°ƒç”¨ exceptionCaught å½“å¤„ç†è¿‡ç¨‹ä¸­åœ¨ ChannelPipeline ä¸­æœ‰é”™è¯¯äº§ç”Ÿæ—¶è¢«è°ƒç”¨ Netty å®šä¹‰äº†ä¸¤ä¸ªé‡è¦çš„ Channelhandler å­æ¥å£ï¼š ChannelInboundHandlerâ€”â€”å¤„ç†å…¥ç«™æ•°æ®ä»¥åŠå„ç§çŠ¶æ€å˜åŒ–ï¼› ChannelOutboundHandlerâ€”â€”å¤„ç†å‡ºç«™æ•°æ®å¹¶ä¸”å…è®¸æ‹¦æˆªæ‰€æœ‰çš„æ“ä½œã€‚ ChannelInboundHandler æ¥å£12345678910// é‡Šæ”¾æ¶ˆæ¯èµ„æº@Sharable// æ‰©å±•äº† ChannelInboundHandlerAdapterpublic class DiscardHandler extends ChannelInboundHandlerAdapter &#123; @Override public void channelRead(ChannelHandlerContext ctx, Object msg) &#123; // ä¸¢å¼ƒå·²æ¥æ”¶çš„æ¶ˆæ¯ ReferenceCountUtil.release(msg); &#125; &#125; 123456789// ä½¿ç”¨ SimpleChannelInboundHandler ä¼šè‡ªåŠ¨é‡Šæ”¾èµ„æº@Sharablepublic class SimpleDiscardHandler extends SimpleChannelInboundHandler&lt;Object&gt; &#123; @Override public void channelRead0(ChannelHandlerContext ctx, Object msg) &#123; // ä¸éœ€è¦ä»»ä½•æ˜¾å¼çš„èµ„æºé‡Šæ”¾ // No need to do anything special &#125; &#125; ChannelOutboundHandler æ¥å£ChannelOutboundHandler çš„ä¸€ä¸ªå¼ºå¤§çš„åŠŸèƒ½æ˜¯å¯ä»¥æŒ‰éœ€æ¨è¿Ÿæ“ä½œæˆ–è€…äº‹ä»¶ï¼Œè¿™ä½¿å¾—å¯ ä»¥é€šè¿‡ä¸€äº›å¤æ‚çš„æ–¹æ³•æ¥å¤„ç†è¯·æ±‚ã€‚ ChannelPromise ä¸ ChannelFutureï¼šChannelOutboundHandler ä¸­çš„å¤§éƒ¨åˆ†æ–¹æ³•éƒ½éœ€è¦ä¸€ä¸ª ChannelPromise å‚æ•°ï¼Œä»¥ä¾¿åœ¨æ“ä½œå®Œæˆæ—¶å¾—åˆ°é€šçŸ¥ã€‚ChannelPromise æ˜¯ ChannelFuture çš„ä¸€ä¸ªå­ç±»ï¼Œå…¶å®šä¹‰äº†ä¸€äº›å¯å†™çš„æ–¹æ³•ï¼Œå¦‚ setSuccess() å’Œ setFailure()ï¼Œä»è€Œä½¿ ChannelFuture ä¸å¯å˜ã€‚ ChannelHandler é€‚é…å™¨é€‚é…å™¨å¯¹ ChannelHandler è¿›è¡Œäº†ç®€å•çš„å®ç°ï¼Œåªéœ€è¦ç®€å•åœ°æ‰©å±•å®ƒä»¬ï¼Œå¹¶ä¸”é‡å†™é‚£äº›ä½ æƒ³è¦è‡ªå®šä¹‰çš„æ–¹æ³•ã€‚ ChannelInboundHandlerAdapter å’Œ ChannelOutboundHandlerAdapter ä¸­æ‰€æä¾›çš„æ–¹æ³•ä½“è°ƒç”¨äº†å…¶ç›¸å…³è”çš„ ChannelHandlerContext ä¸Šçš„ç­‰æ•ˆæ–¹æ³•ï¼Œä»è€Œå°†äº‹ä»¶è½¬å‘åˆ°äº† ChannelPipeline ä¸­çš„ä¸‹ä¸€ä¸ª ChannelHandler ä¸­ã€‚ èµ„æºç®¡ç†æ¯å½“é€šè¿‡è°ƒç”¨ ChannelInboundHandler.channelRead() æˆ–è€… ChannelOutboundHandler.write() æ–¹æ³•æ¥å¤„ç†æ•°æ®æ—¶ï¼Œä½ éƒ½éœ€è¦ç¡®ä¿æ²¡æœ‰ä»»ä½•çš„èµ„æºæ³„æ¼ã€‚ Netty ä½¿ç”¨å¼•ç”¨è®¡æ•°æ¥å¤„ç†æ± åŒ–çš„ ByteBufã€‚æ‰€ä»¥åœ¨å®Œå…¨ä½¿ç”¨å®ŒæŸä¸ª ByteBuf åï¼Œè°ƒæ•´å…¶å¼•ç”¨è®¡æ•°æ˜¯å¾ˆé‡è¦çš„ã€‚ 123456789101112// ä¸¢å¼ƒå¹¶é‡Šæ”¾å‡ºæˆ˜æ¶ˆæ¯@Sharablepublic class DiscardOutboundHandler extends ChannelOutboundHandlerAdapter &#123; @Override public void write(ChannelHandlerContext ctx, Object msg, ChannelPromise promise) &#123; // é‡Šæ”¾èµ„æº ReferenceCountUtil.release(msg); // é€šçŸ¥ ChannelPromise æ•°æ®å·²ç»è¢«å¤„ç†äº† promise.setSuccess(); &#125;&#125; é‡è¦çš„æ˜¯ï¼Œä¸ä»…è¦é‡Šæ”¾èµ„æºï¼Œè¿˜è¦é€šçŸ¥ ChannelPromiseã€‚å¦åˆ™å¯èƒ½ä¼šå‡ºç° ChannelFutureListener æ”¶ä¸åˆ°æŸä¸ªæ¶ˆæ¯å·²ç»è¢«å¤„ç†äº†çš„é€šçŸ¥çš„æƒ…å†µã€‚ å¦‚æœä¸€ä¸ªæ¶ˆæ¯è¢«æ¶ˆè´¹æˆ–è€…ä¸¢å¼ƒäº†ï¼Œå¹¶ä¸”æ²¡æœ‰ä¼ é€’ç»™ ChannelPipeline ä¸­çš„ä¸‹ä¸€ä¸ª ChannelOutboundHandlerï¼Œé‚£ä¹ˆç”¨æˆ·å°±æœ‰è´£ä»»è°ƒç”¨ ReferenceCountUtil.release()ã€‚ ChannelPipeline æ¥å£æ¯ä¸€ä¸ªæ–°åˆ›å»ºçš„ Channel éƒ½å°†ä¼šè¢«åˆ†é…ä¸€ä¸ªæ–°çš„ ChannelPipelineã€‚è¿™é¡¹å…³è”æ˜¯æ°¸ä¹…æ€§çš„ï¼›Channel æ—¢ä¸èƒ½é™„åŠ å¦å¤–ä¸€ä¸ª ChannelPipelineï¼Œä¹Ÿä¸èƒ½åˆ†ç¦»å…¶å½“å‰çš„ã€‚ æ ¹æ®äº‹ä»¶çš„èµ·æºï¼Œäº‹ä»¶å°†ä¼šè¢« ChannelInboundHandler æˆ–è€… ChannelOutboundHandler å¤„ç†ã€‚éšåï¼Œé€šè¿‡è°ƒç”¨ ChannelHandlerContext å®ç°ï¼Œå®ƒå°†è¢«è½¬å‘ç»™åŒä¸€è¶…ç±»å‹çš„ä¸‹ä¸€ä¸ª ChannelHandlerã€‚ ä¿®æ”¹ ChannelPipelineChannelHandler å¯ä»¥é€šè¿‡æ·»åŠ  addXxx()ã€åˆ é™¤ remove() æˆ–è€…æ›¿æ¢ replace() å…¶ä»–çš„ ChannelHandler æ¥å®æ—¶åœ°ä¿®æ”¹ ChannelPipeline çš„å¸ƒå±€ã€‚ ChannelHandler çš„æ‰§è¡Œå’Œé˜»å¡ é€šå¸¸ ChannelPipeline ä¸­çš„æ¯ä¸€ä¸ª ChannelHandler éƒ½æ˜¯é€šè¿‡å®ƒçš„ EventLoopï¼ˆI/O çº¿ç¨‹ï¼‰æ¥å¤„ç†ä¼ é€’ç»™å®ƒçš„äº‹ä»¶çš„ã€‚æ‰€ä»¥è‡³å…³é‡è¦çš„æ˜¯ä¸è¦é˜»å¡è¿™ä¸ªçº¿ç¨‹ï¼Œå› ä¸ºè¿™ä¼šå¯¹æ•´ä½“çš„ I/O å¤„ç†äº§ç”Ÿè´Ÿé¢çš„å½±å“ã€‚ ä½†æœ‰æ—¶å¯èƒ½éœ€è¦ä¸é‚£äº›ä½¿ç”¨é˜»å¡ API çš„é—ç•™ä»£ç è¿›è¡Œäº¤äº’ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼ŒChannelPipeline æœ‰ä¸€äº›æ¥å—ä¸€ä¸ª EventExecutorGroup çš„ add()æ–¹æ³•ã€‚å¦‚æœä¸€ä¸ªäº‹ä»¶è¢«ä¼ é€’ç»™ä¸€ä¸ªè‡ªå®šä¹‰çš„ EventExecutorGroupï¼Œå®ƒå°†è¢«åŒ…å«åœ¨è¿™ä¸ª EventExecutorGroup ä¸­çš„æŸä¸ª EventExecutor æ‰€å¤„ç†ï¼Œä»è€Œè¢«ä»è¯¥ Channel æœ¬èº«çš„ EventLoop ä¸­ç§»é™¤ã€‚å¯¹äºè¿™ç§ç”¨ä¾‹ï¼ŒNetty æä¾›äº†ä¸€ä¸ªå« DefaultEventExecutorGroup çš„é»˜è®¤å®ç°ã€‚ getXxx()ï¼šé€šè¿‡ç±»å‹æˆ–è€…åç§°æ¥è®¿é—® ChannelHandler çš„æ–¹æ³•ã€‚ context()ï¼šè¿”å›å’Œ ChannelHandler ç»‘å®šçš„ ChannelHandlerContextã€‚ names()ï¼šè¿”å› ChannelPipeline ä¸­æ‰€æœ‰ ChannelHandler çš„åç§°ã€‚ è§¦å‘äº‹ä»¶ChannelPipeline çš„ API å…¬å¼€äº†ç”¨äºè°ƒç”¨å…¥ç«™å’Œå‡ºç«™æ“ä½œçš„é™„åŠ æ–¹æ³•ã€‚ å°ç»“ ChannelPipeline ä¿å­˜äº†ä¸ Channel ç›¸å…³è”çš„ ChannelHandlerï¼› ChannelPipeline å¯ä»¥æ ¹æ®éœ€è¦ï¼Œé€šè¿‡æ·»åŠ æˆ–è€…åˆ é™¤ ChannelHandler æ¥åŠ¨æ€åœ°ä¿®æ”¹ï¼› ChannelPipeline æœ‰ç€ä¸°å¯Œçš„ API ç”¨ä»¥è¢«è°ƒç”¨ï¼Œä»¥å“åº”å…¥ç«™å’Œå‡ºç«™äº‹ä»¶ã€‚ ChannelHandlerContext æ¥å£ChannelHandlerContext ä»£è¡¨äº† ChannelHandler å’Œ ChannelPipeline ä¹‹é—´çš„å…³è”ï¼Œæ¯å½“æœ‰ ChannelHandler æ·»åŠ åˆ° ChannelPipeline ä¸­æ—¶ï¼Œéƒ½ä¼šåˆ›å»º ChannelHandlerContextã€‚ ChannelHandlerContext çš„ä¸»è¦åŠŸèƒ½æ˜¯ç®¡ç†å®ƒæ‰€å…³è”çš„ ChannelHandler å’Œåœ¨åŒä¸€ä¸ª ChannelPipeline ä¸­çš„å…¶ä»– ChannelHandler ä¹‹é—´çš„äº¤äº’ã€‚ ChannelHandlerContext å’Œ ChannelHandler ä¹‹é—´çš„å…³è”ï¼ˆç»‘å®šï¼‰æ˜¯æ°¸è¿œä¸ä¼šæ”¹å˜çš„ï¼Œæ‰€ä»¥ç¼“å­˜å¯¹å®ƒçš„å¼•ç”¨æ˜¯å®‰å…¨çš„ï¼› ä½¿ç”¨ ChannelHandlerContextChannelã€ChannelPipelineã€ChannelHandler ä»¥åŠ ChannelHandlerContext ä¹‹é—´çš„å…³ç³» 1234// ä» ChannelHandlerContext è®¿é—® ChannelChannelHandlerContext ctx = ..;Channel channel = ctx.channel();channel.write(Unpooled.copiedBuffer(\"Netty in Action\", CharsetUtil.UTF_8)); 1234// é€šè¿‡ ChannelHandlerContext è®¿é—® ChannelPipelineChannelHandlerContext ctx = ..;ChannelPipeline pipeline = ctx.pipeline();pipeline.write(Unpooled.copiedBuffer(\"Netty in Action\", CharsetUtil.UTF_8)); é‡è¦çš„æ˜¯è¦æ³¨æ„åˆ°ï¼Œè™½ç„¶è¢«è°ƒç”¨çš„ Channel æˆ– ChannelPipeline ä¸Šçš„ write()æ–¹æ³•å°†ä¸€ç›´ä¼ æ’­äº‹ä»¶é€š è¿‡æ•´ä¸ª ChannelPipelineï¼Œä½†æ˜¯åœ¨ ChannelHandler çš„çº§åˆ«ä¸Šï¼Œäº‹ä»¶ä»ä¸€ä¸ª ChannelHandler åˆ°ä¸‹ä¸€ä¸ª ChannelHandler çš„ç§»åŠ¨æ˜¯ç”± ChannelHandlerContext ä¸Šçš„è°ƒç”¨å®Œæˆçš„. 1234// è°ƒç”¨ ChannelHandlerContext çš„ write()æ–¹æ³•ChannelHandlerContext ctx = ..;// write()æ–¹æ³•å°†æŠŠç¼“å†²åŒºæ•°æ®å‘é€åˆ°ä¸‹ä¸€ä¸ª ChannelHandlerctx.write(Unpooled.copiedBuffer(\"Netty in Action\", CharsetUtil.UTF_8)); é«˜çº§ç”¨æ³•ç¼“å­˜ ChannelHandlerContext çš„å¼•ç”¨ä»¥ä¾›ç¨åä½¿ç”¨ï¼Œè¿™å¯èƒ½ä¼šå‘ç”Ÿåœ¨ä»»ä½•çš„ ChannelHandler æ–¹æ³•ä¹‹å¤–ï¼Œç”šè‡³æ¥è‡ªäºä¸åŒçš„çº¿ç¨‹ã€‚ 12345678910111213// ç¼“å­˜åˆ° ChannelHandlerContext çš„å¼•ç”¨public class WriteHandler extends ChannelHandlerAdapter &#123; private ChannelHandlerContext ctx; @Override public void handlerAdded(ChannelHandlerContext ctx) &#123; //å­˜å‚¨åˆ° ChannelHandlerContext çš„å¼•ç”¨ä»¥ä¾›ç¨åä½¿ç”¨ this.ctx = ctx; &#125; public void send(String msg) &#123; // ä½¿ç”¨ä¹‹å‰å­˜å‚¨çš„åˆ° ChannelHandlerContext çš„å¼•ç”¨æ¥å‘é€æ¶ˆæ¯ ctx.writeAndFlush(msg); &#125; &#125; å› ä¸ºä¸€ä¸ª ChannelHandler å¯ä»¥ä»å±äºå¤šä¸ª ChannelPipelineï¼Œæ‰€ä»¥å®ƒä¹Ÿå¯ä»¥ç»‘å®šåˆ°å¤šä¸ª ChannelHandlerContext å®ä¾‹ã€‚å¯¹äºè¿™ç§ç”¨æ³•æŒ‡åœ¨å¤šä¸ª ChannelPipeline ä¸­å…±äº«åŒä¸€ ä¸ª ChannelHandlerï¼Œå¯¹åº”çš„ ChannelHandler å¿…é¡»è¦ä½¿ç”¨ @Sharable æ³¨è§£æ ‡æ³¨ï¼›å¦åˆ™ï¼Œ è¯•å›¾å°†å®ƒæ·»åŠ åˆ°å¤šä¸ª ChannelPipeline æ—¶å°†ä¼šè§¦å‘å¼‚å¸¸ã€‚æ˜¾è€Œæ˜“è§ï¼Œä¸ºäº†å®‰å…¨åœ°è¢«ç”¨äºå¤šä¸ª å¹¶å‘çš„ Channelï¼ˆå³è¿æ¥ï¼‰ï¼Œè¿™æ ·çš„ ChannelHandler å¿…é¡»æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ 123456789// å¯å…±äº«çš„ ChannelHandler@Sharable public class SharableHandler extends ChannelInboundHandlerAdapter &#123; @Override public void channelRead(ChannelHandlerContext ctx, Object msg) &#123; System.out.println(\"Channel read message: \" + msg); ctx.fireChannelRead(msg); &#125; &#125; å¼‚å¸¸å¤„ç†Netty æä¾›äº†å‡ ç§æ–¹å¼ç”¨äºå¤„ç†å…¥ç«™æˆ–è€…å‡ºç«™å¤„ç†è¿‡ç¨‹ä¸­æ‰€æŠ›å‡ºçš„å¼‚å¸¸ã€‚ å¤„ç†å…¥ç«™å¼‚å¸¸12345678// åŸºæœ¬çš„å…¥ç«™å¼‚å¸¸å¤„ç†public class InboundExceptionHandler extends ChannelInboundHandlerAdapter &#123; @Override public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) &#123; cause.printStackTrace(); ctx.close(); &#125; &#125; å¤„ç†å‡ºç«™å¼‚å¸¸å‡ºç«™çš„å¼‚å¸¸å¤„ç†åŸºäºä¸€ä¸‹é€šçŸ¥æœºåˆ¶ï¼š æ¯ä¸ªå‡ºç«™æ“ä½œéƒ½å°†è¿”å›ä¸€ä¸ª ChannelFutureã€‚æ³¨å†Œåˆ° ChannelFuture çš„ ChannelFutureListener å°†åœ¨æ“ä½œå®Œæˆæ—¶è¢«é€šçŸ¥è¯¥æ“ä½œæ˜¯æˆåŠŸäº†è¿˜æ˜¯å‡ºé”™äº†ã€‚ å‡ ä¹æ‰€æœ‰çš„ ChannelOutboundHandler ä¸Šçš„æ–¹æ³•éƒ½ä¼šä¼ å…¥ä¸€ä¸ª ChannelPromise çš„å®ä¾‹ã€‚ä½œä¸º ChannelFuture çš„å­ç±»ï¼ŒChannelPromise ä¹Ÿå¯ä»¥è¢«åˆ†é…ç”¨äºå¼‚æ­¥é€šçŸ¥çš„ç›‘å¬å™¨ã€‚ä½†æ˜¯ï¼ŒChannelPromise è¿˜å…·æœ‰æä¾›ç«‹å³é€šçŸ¥çš„å¯å†™æ–¹æ³•ã€‚ ChannelPromise çš„å¯å†™æ–¹æ³• é€šè¿‡è°ƒç”¨ ChannelPromise ä¸Šçš„ setSuccess() å’Œ setFailure() æ–¹æ³•ï¼Œå¯ä»¥ä½¿ä¸€ä¸ªæ“ä½œçš„çŠ¶æ€åœ¨ ChannelHandler çš„æ–¹æ³•è¿”å›ç»™å…¶è°ƒç”¨è€…æ—¶ä¾¿å³åˆ»è¢«æ„ŸçŸ¥åˆ°ã€‚ 12345678910// æ·»åŠ  ChannelFutureListener åˆ° ChannelFutureChannelFuture future = channel.write(someMessage);future.addListener(new ChannelFutureListener() &#123; @Override public void operationComplete(ChannelFuture f) &#123; if (!f.isSuccess()) &#123; f.cause().printStackTrace(); f.channel().close(); &#125; &#125;&#125;); 123456789101112131415// æ·»åŠ  ChannelFutureListener åˆ° ChannelPromisepublic class OutboundExceptionHandler extends ChannelOutboundHandlerAdapter &#123; @Override public void write(ChannelHandlerContext ctx, Object msg, ChannelPromise promise) &#123; promise.addListener(new ChannelFutureListener() &#123; @Override public void operationComplete(ChannelFuture f) &#123; if (!f.isSuccess()) &#123; f.cause().printStackTrace(); f.channel().close(); &#125; &#125; &#125;); &#125; &#125;","categories":[{"name":"åå°æŠ€æœ¯","slug":"åå°æŠ€æœ¯","permalink":"http://yoursite.com/categories/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"Netty","slug":"Netty","permalink":"http://yoursite.com/tags/Netty/"}]},{"title":"Netty ByteBuf","slug":"åå°æŠ€æœ¯/Netty/Netty ByteBuf","date":"2020-01-24T03:29:09.000Z","updated":"2020-07-10T04:04:17.155Z","comments":true,"path":"2020/01/24/åå°æŠ€æœ¯/Netty/Netty ByteBuf/","link":"","permalink":"http://yoursite.com/2020/01/24/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/Netty/Netty%20ByteBuf/","excerpt":"æ€»æ‰€å‘¨çŸ¥ï¼Œç½‘ç»œæ•°æ®çš„åŸºæœ¬å•ä½æ€»æ˜¯å­—èŠ‚ã€‚Java NIO æä¾›äº† ByteBuffer ä½œä¸ºå®ƒçš„å­—èŠ‚å®¹å™¨ï¼Œä½†æ˜¯è¿™ä¸ªç±»ä½¿ç”¨èµ·æ¥è¿‡äºå¤æ‚ï¼Œè€Œä¸”ä¹Ÿæœ‰äº›ç¹çã€‚å› æ­¤ï¼ŒNetty æä¾›äº†ä¸€ä¸ªæ›¿ä»£å“ ByteBufï¼Œä¸€ä¸ªå¼ºå¤§çš„å®ç°ï¼Œæ—¢è§£å†³äº† JDK API çš„å±€é™æ€§ï¼Œåˆä¸ºç½‘ç»œåº”ç”¨ç¨‹åºçš„å¼€å‘è€…æä¾›äº†æ›´å¥½çš„ APIã€‚","text":"æ€»æ‰€å‘¨çŸ¥ï¼Œç½‘ç»œæ•°æ®çš„åŸºæœ¬å•ä½æ€»æ˜¯å­—èŠ‚ã€‚Java NIO æä¾›äº† ByteBuffer ä½œä¸ºå®ƒçš„å­—èŠ‚å®¹å™¨ï¼Œä½†æ˜¯è¿™ä¸ªç±»ä½¿ç”¨èµ·æ¥è¿‡äºå¤æ‚ï¼Œè€Œä¸”ä¹Ÿæœ‰äº›ç¹çã€‚å› æ­¤ï¼ŒNetty æä¾›äº†ä¸€ä¸ªæ›¿ä»£å“ ByteBufï¼Œä¸€ä¸ªå¼ºå¤§çš„å®ç°ï¼Œæ—¢è§£å†³äº† JDK API çš„å±€é™æ€§ï¼Œåˆä¸ºç½‘ç»œåº”ç”¨ç¨‹åºçš„å¼€å‘è€…æä¾›äº†æ›´å¥½çš„ APIã€‚ ByteBuf çš„ APINetty çš„æ•°æ®å¤„ç† API é€šè¿‡ä¸¤ä¸ªç»„ä»¶æš´éœ²ï¼šabstract class ByteBuf å’Œ interface ByteBufHolderã€‚ ByteBuf ç±»ByteBuf ç±»æ˜¯ Netty çš„æ•°æ®å®¹å™¨ï¼Œé€šè¿‡ä½¿ç”¨ä¸åŒçš„ç´¢å¼•æ¥ç®€åŒ–å¯¹å®ƒæ‰€åŒ…å«çš„æ•°æ®çš„è®¿é—®ã€‚ HowByteBuf ç»´æŠ¤äº†ä¸¤ä¸ªä¸åŒçš„ç´¢å¼•ï¼šä¸€ä¸ªç”¨äºè¯»å–ï¼Œä¸€ä¸ªç”¨äºå†™å…¥ã€‚è¯»å–æ—¶ï¼ŒreaderIndex å°†ä¼šè¢«é€’å¢å·²ç»è¢«è¯»å–çš„å­—èŠ‚æ•°ï¼›å†™å…¥æ—¶ï¼ŒwriterIndex ä¹Ÿä¼šè¢«é€’å¢ã€‚readerIndex == writerIndex æ—¶åˆ™åˆ°è¾¾å¯è¯»å–æ•°æ®çš„æœ«å°¾ã€‚ åç§°ä»¥ read æˆ–è€… write å¼€å¤´çš„ ByteBuf æ–¹æ³•ï¼Œå°†ä¼šæ¨è¿›å…¶å¯¹åº”çš„ç´¢å¼•ï¼Œè€Œåç§°ä»¥ set æˆ–è€… get å¼€å¤´çš„æ“ä½œåˆ™ä¸ä¼šã€‚åé¢çš„è¿™äº›æ–¹æ³•å°†åœ¨ä½œä¸ºä¸€ä¸ªå‚æ•°ä¼ å…¥çš„ä¸€ä¸ªç›¸å¯¹ç´¢å¼•ä¸Šæ‰§è¡Œæ“ä½œã€‚ Modeåœ¨ä½¿ç”¨ Netty æ—¶ï¼Œæœ‰å‡ ç§å¸¸è§çš„å›´ç»• ByteBuf è€Œæ„å»ºçš„ä½¿ç”¨æ¨¡å¼ã€‚ å †ç¼“å†²åŒºæœ€å¸¸ç”¨çš„ ByteBuf æ¨¡å¼æ˜¯å°†æ•°æ®å­˜å‚¨åœ¨ JVM çš„å †ç©ºé—´ä¸­ã€‚è¿™ç§æ¨¡å¼è¢«ç§°ä¸ºæ”¯æ’‘æ•°ç»„ã€‚ 12345678910111213// æ”¯æ’‘æ•°ç»„ByteBuf heapBuf = ...;// æ£€æŸ¥ ByteBuf æ˜¯å¦æœ‰ä¸€ä¸ªæ”¯æ’‘æ•°ç»„if (heapBuf.hasArray()) &#123; // è·å–å¯¹è¯¥æ•°ç»„çš„å¼•ç”¨ byte[] array = heapBuf.array(); // è®¡ç®—ç¬¬ä¸€ä¸ªå­—èŠ‚çš„åç§»é‡ int offset = heapBuf.arrayOffset() + heapBuf.readerIndex(); // è·å–å¯è¯»å­—èŠ‚æ•° int length = heapBuf.readableBytes(); // ä½¿ç”¨è·å–çš„ä¿¡æ¯ä½œä¸ºå‚æ•°è°ƒç”¨è‡ªå®šä¹‰æ–¹æ³• handleArray(array, offset, length);&#125; ç›´æ¥ç¼“å†²åŒºï¼ˆUpdatingï¼‰å¤åˆç¼“å†²å™¨ï¼ˆUpdatingï¼‰å­—èŠ‚çº§æ“ä½œByteBuf æä¾›äº†è®¸å¤šè¶…å‡ºåŸºæœ¬è¯»ã€å†™æ“ä½œçš„æ–¹æ³•ç”¨äºä¿®æ”¹å®ƒçš„æ•°æ®ã€‚ éšæœºè®¿é—®ç´¢å¼•123456// è®¿é—®æ•°æ®ByteBuf buffer = ...;for (int i = 0; i &lt; buffer.capacity(); i++) &#123; byte b = buffer.getByte(i); System.out.println((char)b);&#125; é¡ºåºè®¿é—®ç´¢å¼•è™½ç„¶ ByteBuf åŒæ—¶å…·æœ‰è¯»ç´¢å¼•å’Œå†™ç´¢å¼•ï¼Œä½†æ˜¯ JDK çš„ ByteBuffer å´åªæœ‰ä¸€ä¸ªç´¢å¼•ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆå¿…é¡»è°ƒç”¨ flip() æ–¹æ³•æ¥åœ¨è¯»æ¨¡å¼å’Œå†™æ¨¡å¼ä¹‹é—´è¿›è¡Œåˆ‡æ¢çš„åŸå›  ByteBuf çš„å†…éƒ¨åˆ†æ®µ å¯ä¸¢å¼ƒå­—èŠ‚å¯ä¸¢å¼ƒå­—èŠ‚çš„åˆ†æ®µåŒ…å«äº†å·²ç»è¢«è¯»è¿‡çš„å­—èŠ‚ã€‚é€šè¿‡è°ƒç”¨ discardReadBytes() æ–¹æ³•ï¼Œå¯ä»¥ä¸¢å¼ƒå®ƒä»¬å¹¶å›æ”¶ç©ºé—´ã€‚è¿™ä¸ªåˆ†æ®µçš„åˆå§‹å¤§å°ä¸º 0ï¼Œå­˜å‚¨åœ¨ readerIndex ä¸­ï¼Œä¼šéšç€ read æ“ä½œçš„æ‰§è¡Œè€Œå¢åŠ ï¼ˆget*æ“ä½œä¸ä¼šç§»åŠ¨ readerIndexï¼‰ã€‚ å¯è¯»å­—èŠ‚ByteBuf çš„å¯è¯»å­—èŠ‚åˆ†æ®µå­˜å‚¨äº†å®é™…æ•°æ®ã€‚ 12345// è¯»å–æ‰€æœ‰æ•°æ®ByteBuf buffer = ...;while (buffer.isReadable()) &#123; System.out.println(buffer.readByte());&#125; å¯å†™å­—èŠ‚å¯å†™å­—èŠ‚åˆ†æ®µæ˜¯æŒ‡ä¸€ä¸ªæ‹¥æœ‰æœªå®šä¹‰å†…å®¹çš„ã€å†™å…¥å°±ç»ªçš„å†…å­˜åŒºåŸŸã€‚ 12345// å†™æ•°æ®ByteBuf buffer = ...;while (buffer.writableBytes() &gt;= 4) &#123; buffer.writeInt(random.nextInt());&#125; ç´¢å¼•ç®¡ç†å¯ä»¥é€šè¿‡è°ƒç”¨ markReaderIndex()ã€markWriterIndex()ã€resetWriterIndex() å’Œ resetReaderIndex() æ¥æ ‡è®°å’Œé‡ç½® ByteBuf çš„ readerIndex å’Œ writerIndexã€‚ ä¹Ÿå¯ä»¥é€šè¿‡è°ƒç”¨ readerIndex(int) æˆ–è€… writerIndex(int) æ¥å°†ç´¢å¼•ç§»åŠ¨åˆ°æŒ‡å®šä½ç½®ã€‚è¯•å›¾å°†ä»»ä½•ä¸€ä¸ªç´¢å¼•è®¾ç½®åˆ°ä¸€ä¸ªæ— æ•ˆçš„ä½ç½®éƒ½å°†å¯¼è‡´ä¸€ä¸ª IndexOutOfBoundsExceptionã€‚ å¯ä»¥é€šè¿‡è°ƒç”¨ clear()æ–¹æ³•æ¥å°† readerIndex å’Œ writerIndex éƒ½è®¾ç½®ä¸º 0ï¼ˆä¸ä¼šæ¸…é™¤å†…å­˜ä¸­çš„å†…å®¹ï¼‰ã€‚ æŸ¥æ‰¾æ“ä½œï¼ˆUpdatingï¼‰123// ä½¿ç”¨ ByteBufProcessor æ¥å¯»æ‰¾\\rByteBuf buffer = ...;int index = buffer.forEachByte(ByteBufProcessor.FIND_CR); æ´¾ç”Ÿç¼“å†²åŒºæ´¾ç”Ÿç¼“å†²åŒºä¸º ByteBuf æä¾›äº†ä»¥ä¸“é—¨çš„æ–¹å¼æ¥å‘ˆç°å…¶å†…å®¹çš„è§†å›¾ã€‚ä¿®æ”¹äº†å…¶ä¸­ä¸€ä¸ªï¼Œæºå®ä¾‹ä¹Ÿä¼šè¢«ä¿®æ”¹ï¼ˆå…±äº«ï¼‰ã€‚ 12345678910// å¯¹ ByteBuf è¿›è¡Œåˆ‡ç‰‡Charset utf8 = Charset.forName(\"UTF-8\");ByteBuf buf = Unpooled.copiedBuffer(\"Netty in Action rocks!\", utf8);ByteBuf sliced = buf.slice(0, 15);// æ‰“å° Netty in ActionSystem.out.println(sliced.toString(utf8));// æ›´æ”¹ç´¢å¼• 0 å¤„çš„å­—èŠ‚buf.setByte(0, (byte)'J');// True å› ä¸ºæ•°æ®æ˜¯å…±äº«å…³ç³»assert buf.getByte(0) == sliced.getByte(0); ByteBuf å¤åˆ¶ å¦‚æœéœ€è¦ä¸€ä¸ªç°æœ‰ç¼“å†²åŒºçš„çœŸå®å‰¯æœ¬ï¼Œè¯·ä½¿ç”¨ copy() æˆ–è€… copy(int, int) æ–¹æ³•ã€‚ä¸åŒäºæ´¾ç”Ÿç¼“å†²åŒºï¼Œç”±è¿™ä¸ªè°ƒç”¨æ‰€è¿”å›çš„ ByteBuf æ‹¥æœ‰ç‹¬ç«‹çš„æ•°æ®å‰¯æœ¬ 12345678// å¤åˆ¶ä¸€ä¸ª ByteBufCharset utf8 = Charset.forName(\"UTF-8\");ByteBuf buf = Unpooled.copiedBuffer(\"Netty in Action rocks!\", utf8);ByteBuf copy = buf.copy(0, 15);System.out.println(copy.toString(utf8));buf.setByte(0, (byte) 'J');// True å› ä¸ºæ•°æ®æ˜¯éå…±äº«å…³ç³»assert buf.getByte(0) != copy.getByte(0); é™¤äº†ä¿®æ”¹åŸå§‹ ByteBuf çš„åˆ‡ç‰‡æˆ–è€…å‰¯æœ¬çš„æ•ˆæœä»¥å¤–ï¼Œè¿™ä¸¤ç§åœºæ™¯æ˜¯ç›¸åŒçš„ã€‚åªè¦æœ‰å¯èƒ½ï¼Œ ä½¿ç”¨ slice() æ–¹æ³•æ¥é¿å…å¤åˆ¶å†…å­˜çš„å¼€é”€ã€‚ è¯»å†™æ“ä½œgetXxx() å’Œ setXxx() æ“ä½œï¼Œä»ç»™å®šçš„ç´¢å¼•å¼€å§‹ï¼Œå¹¶ä¸”ä¿æŒç´¢å¼•ä¸å˜ã€‚ 12345678910111213// getXxx() And setXxx()Charset utf8 = Charset.forName(\"UTF-8\");ByteBuf buf = Unpooled.copiedBuffer(\"Netty in Action rocks!\", utf8);// æ‰“å°ç¬¬ä¸€ä¸ªå­—ç¬¦ NSystem.out.println((char)buf.getByte(0));int readerIndex = buf.readerIndex();int writerIndex = buf.writerIndex();// æ›´æ”¹ç´¢å¼• 0 å¤„çš„å­—èŠ‚buf.setByte(0, (byte)'B');System.out.println((char)buf.getByte(0));// True ä¸ä¼šå½±å“ç›¸åº”çš„ç´¢å¼•assert readerIndex == buf.readerIndex();assert writerIndex == buf.writerIndex(); readXxx() å’Œ writeXxx() æ“ä½œï¼Œä»ç»™å®šçš„ç´¢å¼•å¼€å§‹ï¼Œå¹¶ä¸”ä¼šæ ¹æ®å·²ç»è®¿é—®è¿‡çš„å­—èŠ‚æ•°å¯¹ç´¢ å¼•è¿›è¡Œè°ƒæ•´ã€‚ 1234567891011// readXxx() And writeXxx()Charset utf8 = Charset.forName(\"UTF-8\");ByteBuf buf = Unpooled.copiedBuffer(\"Netty in Action rocks!\", utf8);System.out.println((char)buf.readByte());int readerIndex = buf.readerIndex();int writerIndex = buf.writerIndex();// å°†å­—ç¬¦ ï¼Ÿ è¿½åŠ åˆ°ç¼“å­˜åŒºï¼ŒwriterIndex æ”¹å˜buf.writeByte((byte)'?');// Trueassert readerIndex == buf.readerIndex();assert writerIndex != buf.writerIndex(); ByteBufHolder æ¥å£å¦‚æœæƒ³è¦å®ç°ä¸€ä¸ªå°†å…¶æœ‰æ•ˆè´Ÿè½½å­˜å‚¨åœ¨ ByteBuf ä¸­çš„æ¶ˆæ¯å¯¹è±¡ï¼Œé‚£ä¹ˆ ByteBufHolder å°†æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ã€‚ ByteBuf åˆ†é…å¸¸è§çš„å‡ ç§ç®¡ç† ByteBuf å®ä¾‹çš„ä¸åŒæ–¹å¼ã€‚ æŒ‰éœ€åˆ†é…ï¼šByteBufAllocator æ¥å£ä¸ºäº†é™ä½åˆ†é…å’Œé‡Šæ”¾å†…å­˜çš„å¼€é”€ï¼ŒNetty é€šè¿‡ interface ByteBufAllocator å®ç°äº†ï¼ˆByteBuf çš„ï¼‰æ± åŒ–ï¼Œå®ƒå¯ä»¥ç”¨æ¥åˆ†é…æˆ‘ä»¬æ‰€æè¿°è¿‡çš„ä»»æ„ç±»å‹çš„ ByteBuf å®ä¾‹ã€‚ å¯ä»¥é€šè¿‡ Channelï¼ˆæ¯ä¸ªéƒ½å¯ä»¥æœ‰ä¸€ä¸ªä¸åŒçš„ ByteBufAllocator å®ä¾‹ï¼‰æˆ–è€…ç»‘å®šåˆ° ChannelHandler çš„ ChannelHandlerContext è·å–ä¸€ä¸ªåˆ° ByteBufAllocator çš„å¼•ç”¨ã€‚ 1234567// è·å–ä¸€ä¸ªåˆ° ByteBufAllocator çš„å¼•ç”¨Channel channel = ...;ByteBufAllocator allocator = channel.alloc();....ChannelHandlerContext ctx = ...;ByteBufAllocator allocator2 = ctx.alloc();... Nettyæä¾›äº†ä¸¤ç§ByteBufAllocatorçš„å®ç°ï¼šPooledByteBufAllocator å’Œ UnpooledByteBufAllocatorã€‚ Unpooled ç¼“å†²æ± å¯èƒ½æŸäº›æƒ…å†µä¸‹ï¼Œä½ ä¸éœ€è¦ä¸€ä¸ª ByteBufAllocator çš„å¼•ç”¨ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼ŒNetty æä¾›äº†ä¸€ä¸ªç®€å•çš„ç§°ä¸º Unpooled çš„å·¥å…·ç±»ï¼Œå®ƒæä¾›äº†é™æ€çš„è¾…åŠ©æ–¹æ³•æ¥åˆ›å»ºæœªæ± åŒ–çš„ ByteBuf å®ä¾‹ã€‚ ByteBufUtil ç±»ByteBufUtil æä¾›äº†ç”¨äºæ“ä½œ ByteBuf çš„é™æ€çš„è¾…åŠ©æ–¹æ³•ã€‚ å¼•ç”¨è®¡æ•°å¼•ç”¨è®¡æ•°æ˜¯ä¸€ç§é€šè¿‡åœ¨æŸä¸ªå¯¹è±¡æ‰€æŒæœ‰çš„èµ„æºä¸å†è¢«å…¶ä»–å¯¹è±¡å¼•ç”¨æ—¶é‡Šæ”¾è¯¥å¯¹è±¡æ‰€æŒæœ‰çš„èµ„æºæ¥ä¼˜åŒ–å†…å­˜ä½¿ç”¨å’Œæ€§èƒ½çš„æŠ€æœ¯ã€‚Netty åœ¨ç¬¬ 4 ç‰ˆä¸­ä¸º ByteBuf å’Œ ByteBufHolder å¼•å…¥äº†å¼•ç”¨è®¡æ•°æŠ€æœ¯ï¼Œå®ƒä»¬éƒ½å®ç°äº† interface ReferenceCountedã€‚","categories":[{"name":"åå°æŠ€æœ¯","slug":"åå°æŠ€æœ¯","permalink":"http://yoursite.com/categories/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"Netty","slug":"Netty","permalink":"http://yoursite.com/tags/Netty/"}]},{"title":"Netty ä¼ è¾“","slug":"åå°æŠ€æœ¯/Netty/Netty ä¼ è¾“","date":"2020-01-22T11:03:21.000Z","updated":"2020-07-10T04:04:47.561Z","comments":true,"path":"2020/01/22/åå°æŠ€æœ¯/Netty/Netty ä¼ è¾“/","link":"","permalink":"http://yoursite.com/2020/01/22/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/Netty/Netty%20%E4%BC%A0%E8%BE%93/","excerpt":"æµç»ç½‘ç»œçš„æ•°æ®æ€»æ˜¯å…·æœ‰ç›¸åŒçš„ç±»å‹ï¼šå­—èŠ‚ã€‚è¿™äº›å­—èŠ‚æ˜¯å¦‚ä½•æµåŠ¨çš„ä¸»è¦å–å†³äºæˆ‘ä»¬æ‰€è¯´çš„ç½‘ç»œä¼ è¾“ï¼ˆä¸€ä¸ªå¸®åŠ©æˆ‘ä»¬æŠ½è±¡åº•å±‚æ•°æ®ä¼ è¾“æœºåˆ¶çš„æ¦‚å¿µï¼‰","text":"æµç»ç½‘ç»œçš„æ•°æ®æ€»æ˜¯å…·æœ‰ç›¸åŒçš„ç±»å‹ï¼šå­—èŠ‚ã€‚è¿™äº›å­—èŠ‚æ˜¯å¦‚ä½•æµåŠ¨çš„ä¸»è¦å–å†³äºæˆ‘ä»¬æ‰€è¯´çš„ç½‘ç»œä¼ è¾“ï¼ˆä¸€ä¸ªå¸®åŠ©æˆ‘ä»¬æŠ½è±¡åº•å±‚æ•°æ®ä¼ è¾“æœºåˆ¶çš„æ¦‚å¿µï¼‰ æ¡ˆä¾‹ç ”ç©¶ï¼šJDK VS. NettyåŸç”Ÿ JDK123456789101112131415161718192021222324252627282930313233343536// JDK çš„é˜»å¡ç½‘ç»œç¼–ç¨‹public class PlainOioServer &#123; public void serve(int port) throws IOException &#123; final ServerSocket socket = new ServerSocket(port); try &#123; for (;;) &#123; final Socket clientSocket = socket.accept(); System.out.println(\"Accepted connection from \" + clientSocket); new Thread( // åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹æ¥å¤„ç†è¯¥è¿æ¥ new Runnable() &#123; @Override public void run() &#123; OutputStream out; try &#123; out = clientSocket.getOutputStream(); // å°†æ¶ˆæ¯å†™ç»™å·²è¿æ¥çš„å®¢æˆ·ç«¯ out.write(\"Hi!\\r\\n\".getBytes(Charset.forName(\"UTF-8\"))); out.flush(); clientSocket.close(); &#125;catch (IOException e) &#123; e.printStackTrace(); &#125;finally &#123; try &#123; clientSocket.close(); &#125;catch (IOException ex) &#123; // ignore on close &#125; &#125; &#125; &#125;).start(); // å¯åŠ¨çº¿ç¨‹ &#125; &#125;catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; &#125; éšç€åº”ç”¨ç¨‹åºçš„ç”¨æˆ·è¶Šæ¥è¶Šå¤šï¼Œé˜»å¡ I/O å¹¶ä¸èƒ½å¾ˆå¥½åœ°ä¼¸ç¼©åˆ°æ”¯æ’‘æˆåƒä¸Šä¸‡åœ°å¹¶å‘è¿å…¥è¿æ¥ã€‚æ­¤æ—¶å¼‚æ­¥ I/O å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†å¼‚æ­¥ I/O çš„ API æ˜¯å®Œå…¨ä¸åŒçš„ï¼Œå› æ­¤ä¸å¾—ä¸é‡å†™æ­¤åº”ç”¨ç¨‹åºã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465// JDK éé˜»å¡ç½‘ç»œå¤„ç†public class PlainNioServer &#123; public void serve(int port) throws IOException &#123; ServerSocketChannel serverChannel = ServerSocketChannel.open(); serverChannel.configureBlocking(false); ServerSocket ssocket = serverChannel.socket(); InetSocketAddress address = new InetSocketAddress(port); ssocket.bind(address); // æ‰“å¼€ Selector æ¥å¤„ç† Channel Selector selector = Selector.open(); // å°† ServerChannel æ³¨å†Œåˆ° Selector ä»¥ä¾¿æ¥å—è¿æ¥ï¼ˆæŠ¥ä¸ªåï¼‰ serverChannel.register(selector, SelectionKey.OP_ACCEPT); final ByteBuffer msg = ByteBuffer.wrap(\"Hi!\\r\\n\".getBytes()); for (;;) &#123; try &#123; // ç­‰å¾… select() éœ€è¦å¤„ç†çš„æ–°äº‹ä»¶ï¼Œé˜»å¡å°†ä¸€ç›´æŒç»­åˆ°ä¸‹ä¸€ä¸ªä¼ å…¥äº‹ä»¶ selector.select(); &#125; catch (IOException ex) &#123; ex.printStackTrace(); // handle exception break; &#125; // è·å–æ‰€æœ‰æ¥æ”¶äº‹ä»¶çš„æ ‡è¯† SelectionKey() Set&lt;SelectionKey&gt; readyKeys = selector.selectedKeys(); Iterator&lt;SelectionKey&gt; iterator = readyKeys.iterator(); while (iterator.hasNext()) &#123; // å–å‡ºæ ‡è¯†ï¼Œä»¥ä¾¿æ ‡è¯†æ‰€å¯¹åº”çš„äº‹ä»¶è¿›è¡Œä¸šåŠ¡æ“ä½œ SelectionKey key = iterator.next(); // æ­¤äº‹ä»¶å·²ç»å–å‡ºå¤„ç†ï¼Œå°†å…¶æ ‡è¯†ç¬¦ç§»é™¤ iterator.remove(); try &#123; // æ£€æŸ¥äº‹ä»¶ç±»å‹ if (key.isAcceptable()) &#123; ServerSocketChannel server = (ServerSocketChannel)key.channel(); // æ¥å—å®¢æˆ·ç«¯ SocketChannel client = server.accept(); client.configureBlocking(false); // å°†å®¢æˆ·ç«¯æ³¨å†Œåˆ°é€‰æ‹©å™¨ client.register(selector, SelectionKey.OP_WRITE | SelectionKey.OP_READ, msg.duplicate()); System.out.println(\"Accepted connection from \" + client); &#125; // æ£€æŸ¥äº‹ä»¶ç±»å‹ if (key.isWritable()) &#123; SocketChannel client = (SocketChannel)key.channel(); ByteBuffer buffer =(ByteBuffer)key.attachment(); while (buffer.hasRemaining()) &#123; // å°†æ•°æ®å†™åˆ°å·²è¿æ¥çš„å®¢æˆ·ç«¯ if (client.write(buffer) == 0) &#123; break; &#125; &#125; client.close(); &#125; &#125; catch (IOException ex) &#123; key.cancel(); try &#123; key.channel().close(); &#125; catch (IOException cex) &#123; // ignore on close &#125; &#125; &#125; // while &#125; // for &#125; &#125; Netty æ¡†æ¶å› ä¸º Netty ä¸ºæ¯ç§ä¼ è¾“çš„å®ç°éƒ½æš´éœ²äº†ç›¸åŒçš„ APIï¼Œé˜»å¡ä¸éé˜»å¡ç½‘ç»œä¼ è¾“çš„å®ç°éƒ½ä¾èµ–äº interface Channelã€ ChannelPipeline å’Œ ChannelHandlerã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243// ä½¿ç”¨ Netty çš„ç½‘ç»œå¤„ç†public class NettyOioServer &#123; public void server(int port) throws Exception &#123; final ByteBuf buf = Unpooled.unreleasableBuffer( Unpooled.copiedBuffer(\"Hi!\\r\\n\", Charset.forName(\"UTF-8\")) ); // é˜»å¡æ¨¡å¼ EventLoopGroup group = new OioEventLoopGroup(); // éé˜»å¡æ¨¡å¼ // EventLoopGroup group = new OioEventLoopGroup(); try &#123; ServerBootstrap b = new ServerBootstrap(); b.group(group) // éé˜»å¡æ¨¡å¼ // .channel(NioServerSocketChannel.class) .channel(OioServerSocketChannel.class) .localAddress(new InetSocketAddress(port)) // æ¯ä¸ªè¿æ¥çš„é€šé“éƒ½éœ€è¦è°ƒç”¨æ­¤åˆå§‹åŒ–æ–¹æ³• .childHandler( new ChannelInitializer&lt;SocketChannel&gt;() &#123; @Override public void initChannel(SocketChannel ch) throws Exception &#123; ch.pipeline().addLast( // æ‹¦æˆªå’Œå¤„ç†äº‹ä»¶ new ChannelInboundHandlerAdapter() &#123; @Override public void channelActive(ChannelHandlerContext ctx)throws Exception &#123; ctx.writeAndFlush(buf.duplicate()) // ç›‘å¬ï¼Œä»¥ä¾¿åœ¨æ¶ˆæ¯å†™å®Œåå…³é—­è¿æ¥ .addListener(ChannelFutureListener.CLOSE); &#125; &#125; ); &#125; &#125; ); ChannelFuture f = b.bind().sync(); f.channel().closeFuture().sync(); &#125; finally &#123; group.shutdownGracefully().sync(); &#125; &#125; &#125; ä¼ è¾“ APIä¼ è¾“ API çš„æ ¸å¿ƒæ˜¯ interface Channelï¼Œå®ƒè¢«ç”¨äºæ‰€æœ‰çš„ I/O æ“ä½œ æ¯ä¸ª Channel éƒ½å°†ä¼šè¢«åˆ†é…ä¸€ä¸ª ChannelPipeline å’Œ ChannelConfigã€‚ChannelConfig åŒ…å«äº†è¯¥ Channel çš„æ‰€æœ‰é…ç½®è®¾ç½®ï¼Œå¹¶ä¸”æ”¯æŒçƒ­æ›´æ–°ã€‚ ç”±äº Channel æ˜¯ç‹¬ä¸€æ— äºŒçš„ï¼Œä¸ºäº†ä¿è¯é¡ºåºå°† Channel å£°æ˜ä¸º java.lang. Comparable çš„ä¸€ä¸ªå­æ¥å£ã€‚ ChannelPipeline æŒæœ‰æ‰€æœ‰å°†åº”ç”¨äºå…¥ç«™å’Œå‡ºç«™æ•°æ®ä»¥åŠäº‹ä»¶çš„ ChannelHandler å®ä¾‹ï¼Œè¿™äº› ChannelHandler å®ç°äº†åº”ç”¨ç¨‹åºç”¨äºå¤„ç†çŠ¶æ€å˜åŒ–ä»¥åŠæ•°æ®å¤„ç†çš„é€»è¾‘ã€‚ä½ ä¹Ÿå¯ä»¥æ ¹æ®éœ€è¦é€šè¿‡æ·»åŠ æˆ–è€…ç§»é™¤ChannelHandlerå®ä¾‹æ¥ä¿®æ”¹ ChannelPipelineã€‚é€šè¿‡åˆ©ç”¨Nettyçš„è¿™é¡¹èƒ½åŠ›å¯ä»¥æ„å»ºå‡ºé«˜åº¦çµæ´»çš„åº”ç”¨ç¨‹åºã€‚ 123456789101112131415161718192021// å†™å‡ºåˆ° ChannelChannel channel = ...;// åˆ›å»ºæŒæœ‰è¦å†™æ•°æ®çš„ ByteBufByteBuf buf = Unpooled.copiedBuffer(\"your data\", CharsetUtil.UTF_8);// å†™æ•°æ®å¹¶ä¸”å†²åˆ·å®ƒChannelFuture cf = channel.writeAndFlush(buf);// æ·»åŠ ç›‘å¬å™¨ä»¥ä¾¿åœ¨æ“ä½œå®Œæˆåæ¥æ”¶åˆ°é€šçŸ¥cf.addListener( new ChannelFutureListener() &#123; @Override public void operationComplete(ChannelFuture future) &#123; // æ“ä½œå®Œæˆå¹¶ä¸”æ²¡æœ‰å‘ç”Ÿé”™è¯¯ if (future.isSuccess()) &#123; System.out.println(\"Write successful\"); &#125; else &#123; System.err.println(\"Write error\"); future.cause().printStackTrace(); &#125; &#125; &#125;); Netty çš„ Channel å®ç°æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› æ­¤ä½ å¯ä»¥å­˜å‚¨ä¸€ä¸ªåˆ° Channel çš„å¼•ç”¨ï¼Œå¹¶ä¸”æ¯å½“ä½ éœ€è¦å‘è¿œç¨‹èŠ‚ç‚¹å†™æ•°æ®æ—¶ï¼Œéƒ½å¯ä»¥ä½¿ç”¨å®ƒï¼Œå³ä½¿å½“æ—¶è®¸å¤šçº¿ç¨‹éƒ½åœ¨ä½¿ç”¨å®ƒã€‚ 1234567891011121314151617// ä»å¤šä¸ªçº¿ç¨‹ä½¿ç”¨åŒä¸€ä¸ª Channelfinal Channel channel = ...;final ByteBuf buf = Unpooled.copiedBuffer(\"your data\",CharsetUtil.UTF_8).retain();// åˆ›å»ºå°†æ•°æ®å†™åˆ° Channel çš„ RunnableRunnable writer = new Runnable() &#123; @Override public void run() &#123; channel.writeAndFlush(buf.duplicate()); &#125;&#125;;// è·å–åˆ°çº¿ç¨‹æ±  Executor çš„å¼•ç”¨Executor executor = Executors.newCachedThreadPool();// write in one threadexecutor.execute(writer);// write in another threadexecutor.execute(writer);... å†…ç½®çš„ä¼ è¾“Netty å†…ç½®äº†ä¸€äº›å¯å¼€ç®±å³ç”¨çš„ä¼ è¾“ã€‚å› ä¸ºå¹¶ä¸æ˜¯å®ƒä»¬æ‰€æœ‰çš„ä¼ è¾“éƒ½æ”¯æŒæ¯ä¸€ç§åè®®ï¼Œæ‰€ä»¥ä½ å¿…é¡»é€‰æ‹©ä¸€ä¸ªå’Œä½ çš„åº”ç”¨ç¨‹åºæ‰€ä½¿ç”¨çš„åè®®ç›¸å®¹çš„ä¼ è¾“ã€‚ NIONIO æä¾›äº†ä¸€ä¸ªæ‰€æœ‰ I/O æ“ä½œçš„å…¨å¼‚æ­¥çš„å®ç°ï¼Œåˆ©ç”¨äº† JDK1.4 æ—¶ä¾¿å¯ç”¨çš„åŸºäºé€‰æ‹©å™¨çš„ APIã€‚ é€‰æ‹©å™¨èƒŒåçš„åŸºæœ¬æ¦‚å¿µæ˜¯å……å½“ä¸€ä¸ªæ³¨å†Œè¡¨ï¼Œåœ¨é‚£é‡Œä½ å°†å¯ä»¥è¯·æ±‚åœ¨ Channel çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶å¾—åˆ°é€šçŸ¥ã€‚ class java.nio.channels.SelectionKey å®šä¹‰äº†ä¸€ç»„åº”ç”¨ç¨‹åºæ­£åœ¨è¯·æ±‚é€šçŸ¥çš„çŠ¶æ€å˜åŒ–é›†ã€‚ é€‰æ‹©å™¨é€‰æ‹©å¹¶å¤„ç†çŠ¶æ€çš„å˜åŒ– é›¶æ‹·è´ï¼ˆzero-copyï¼‰ï¼šå®ƒä½¿ä½ å¯ä»¥å¿«é€Ÿé«˜æ•ˆåœ°å°†æ•°æ®ä»æ–‡ä»¶ç³»ç»Ÿç§»åŠ¨åˆ°ç½‘ç»œæ¥å£ï¼Œè€Œä¸éœ€è¦å°†å…¶ä»å†…æ ¸ç©ºé—´å¤åˆ¶åˆ°ç”¨æˆ·ç©ºé—´ï¼Œå…¶åœ¨åƒ FTP æˆ–è€… HTTP è¿™æ ·çš„åè®®ä¸­å¯ä»¥æ˜¾è‘—åœ°æå‡æ€§èƒ½ã€‚ Epollç”¨äº Linux çš„æœ¬åœ°éé˜»å¡ä¼ è¾“ï¼ŒLinux JDK NIO API ä½¿ç”¨äº†è¿™äº› epoll è°ƒç”¨ã€‚ OIONetty çš„ OIO ä¼ è¾“å®ç°ä»£è¡¨äº†ä¸€ç§æŠ˜ä¸­ï¼šå®ƒå¯ä»¥é€šè¿‡å¸¸è§„çš„ä¼ è¾“ API ä½¿ç”¨ï¼Œä½†æ˜¯ç”±äºå®ƒæ˜¯å»ºç«‹åœ¨ java.net åŒ…çš„é˜»å¡å®ç°ä¹‹ä¸Šçš„ï¼Œæ‰€ä»¥å®ƒä¸æ˜¯å¼‚æ­¥çš„ã€‚ä½†æ˜¯ï¼Œå®ƒä»ç„¶éå¸¸é€‚åˆäºæŸäº›ç”¨é€”ã€‚ Local ä¼ è¾“ç”¨äºåœ¨åŒä¸€ä¸ª JVM ä¸­è¿è¡Œçš„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç¨‹åºä¹‹é—´çš„å¼‚æ­¥é€šä¿¡ã€‚ Embedded ä¼ è¾“Netty æä¾›äº†ä¸€ç§é¢å¤–çš„ä¼ è¾“ï¼Œä½¿å¾—ä½ å¯ä»¥å°†ä¸€ç»„ ChannelHandler ä½œä¸ºå¸®åŠ©å™¨ç±»åµŒå…¥åˆ°å…¶ä»–çš„ ChannelHandler å†…éƒ¨ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½ å°†å¯ä»¥æ‰©å±•ä¸€ä¸ª ChannelHandler çš„åŠŸèƒ½ï¼Œè€Œåˆä¸éœ€è¦ä¿®æ”¹å…¶å†…éƒ¨ä»£ç ã€‚","categories":[{"name":"åå°æŠ€æœ¯","slug":"åå°æŠ€æœ¯","permalink":"http://yoursite.com/categories/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"Netty","slug":"Netty","permalink":"http://yoursite.com/tags/Netty/"}]},{"title":"Netty ç»„ä»¶å’Œè®¾è®¡","slug":"åå°æŠ€æœ¯/Netty/Netty ç»„ä»¶å’Œè®¾è®¡","date":"2020-01-22T06:09:03.000Z","updated":"2020-07-10T04:04:23.276Z","comments":true,"path":"2020/01/22/åå°æŠ€æœ¯/Netty/Netty ç»„ä»¶å’Œè®¾è®¡/","link":"","permalink":"http://yoursite.com/2020/01/22/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/Netty/Netty%20%E7%BB%84%E4%BB%B6%E5%92%8C%E8%AE%BE%E8%AE%A1/","excerpt":"Channelã€EventLoop å’Œ ChannelFutureChannelã€EventLoop å’Œ ChannelFuture ç±»åˆåœ¨ä¸€èµ·å¯ä»¥è¢«è®¤ä¸ºæ˜¯ Netty çš„ç½‘ç»œæŠ½è±¡ä»£è¡¨","text":"Channelã€EventLoop å’Œ ChannelFutureChannelã€EventLoop å’Œ ChannelFuture ç±»åˆåœ¨ä¸€èµ·å¯ä»¥è¢«è®¤ä¸ºæ˜¯ Netty çš„ç½‘ç»œæŠ½è±¡ä»£è¡¨ Channelï¼šSocket EventLoopï¼šæ§åˆ¶æµã€å¤šçº¿ç¨‹å¤„ç†ã€å¹¶å‘ ChannelFutureï¼šå¼‚æ­¥é€šçŸ¥ Channel æ¥å£åŸºæœ¬çš„ I/O æ“ä½œï¼ˆbind()ã€connect()ã€read()å’Œ write()ï¼‰ä¾èµ–äºåº•å±‚ç½‘ç»œä¼ è¾“æ‰€æä¾›çš„åŸè¯­ã€‚åœ¨åŸºäº Java çš„ç½‘ç»œç¼–ç¨‹ä¸­ï¼Œå…¶åŸºæœ¬çš„æ„é€ æ˜¯ class Socketã€‚Netty çš„ Channel æ¥å£æ‰€æä¾›çš„ APIï¼Œå¤§å¤§åœ°é™ä½äº†ç›´æ¥ä½¿ç”¨ Socket ç±»çš„å¤æ‚æ€§ã€‚æ­¤å¤–ï¼ŒChannel ä¹Ÿæ˜¯æ‹¥æœ‰è®¸å¤šé¢„å®šä¹‰çš„ã€ä¸“é—¨åŒ–å®ç°çš„å¹¿æ³›ç±»å±‚æ¬¡ç»“æ„çš„æ ¹ã€‚ EvenLoop æ¥å£ ä¸€ä¸ª EventLoopGroup åŒ…å«ä¸€ä¸ªæˆ–è€…å¤šä¸ª EventLoopï¼› ä¸€ä¸ª EventLoop åœ¨å®ƒçš„ç”Ÿå‘½å‘¨æœŸå†…åªå’Œä¸€ä¸ª Thread ç»‘å®šï¼› æ‰€æœ‰ç”± EventLoop å¤„ç†çš„ I/O äº‹ä»¶éƒ½å°†åœ¨å®ƒä¸“æœ‰çš„ Thread ä¸Šè¢«å¤„ç†ï¼› ä¸€ä¸ª Channel åœ¨å®ƒçš„ç”Ÿå‘½å‘¨æœŸå†…åªæ³¨å†Œäºä¸€ä¸ª EventLoopï¼› ä¸€ä¸ª EventLoop å¯èƒ½ä¼šè¢«åˆ†é…ç»™ä¸€ä¸ªæˆ–å¤šä¸ª Channelã€‚ åœ¨è¿™ç§è®¾è®¡ä¸­ï¼Œä¸€ä¸ªç»™å®š Channel çš„ I/O æ“ä½œéƒ½æ˜¯ç”±ç›¸åŒçš„ Thread æ‰§è¡Œçš„ï¼Œå®é™…ä¸Šæ¶ˆé™¤äº†å¯¹äºåŒæ­¥çš„éœ€è¦ã€‚ channelFuture æ¥å£Netty ä¸­æ‰€æœ‰çš„ I/O æ“ä½œéƒ½æ˜¯å¼‚æ­¥çš„ï¼Œå› ä¸ºä¸€ä¸ªæ“ä½œå¯èƒ½ä¸ä¼šç«‹å³è¿”å›ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ç§ç”¨äºåœ¨ä¹‹åçš„æŸä¸ªæ—¶é—´ç‚¹ç¡®å®šå…¶ç»“æœçš„æ–¹æ³•ã€‚ä¸ºæ­¤ï¼ŒNetty æä¾›äº† ChannelFuture æ¥å£ï¼Œå…¶ addListener() æ–¹æ³•æ³¨å†Œäº†ä¸€ä¸ª ChannelFutureListenerï¼Œä»¥ä¾¿åœ¨æŸä¸ªæ“ä½œå®Œæˆæ—¶ï¼ˆæ— è®ºæ˜¯å¦æˆåŠŸï¼‰å¾—åˆ°é€šçŸ¥ã€‚ ChannelHandler å’Œ ChannelPipelineæ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬æ›´åŠ ç»†è‡´çš„çœ‹ä¸€çœ‹å“ªé‚£äº›ç®¡ç†æ•°æ®æµä»¥åŠæ‰§è¡Œåº”ç”¨ç¨‹åºå¤„ç†é€»è¾‘çš„ç»„ä»¶ã€‚ ChannelHandler æ¥å£ä»åº”ç”¨ç¨‹åºå¼€å‘äººå‘˜çš„è§’åº¦æ¥çœ‹ï¼ŒNetty çš„ä¸»è¦ç»„ä»¶æ˜¯ ChannelHandlerï¼Œå®ƒå……å½“äº†æ‰€æœ‰å¤„ç†å…¥ç«™å’Œå‡ºç«™æ•°æ®çš„åº”ç”¨ç¨‹åºé€»è¾‘çš„å®¹å™¨ã€‚è¿™æ˜¯å¯è¡Œçš„ï¼Œå› ä¸º ChannelHandler çš„æ–¹æ³•æ˜¯ç”±ç½‘ç»œäº‹ä»¶ï¼ˆå…¶ä¸­æœ¯è¯­â€œäº‹ä»¶â€çš„ä½¿ç”¨éå¸¸å¹¿æ³›ï¼‰è§¦å‘çš„ã€‚äº‹å®ä¸Šï¼ŒChannelHandler å¯ä¸“é—¨ç”¨äºå‡ ä¹ä»»ä½•ç±»å‹çš„åŠ¨ä½œï¼Œä¾‹å¦‚å°†æ•°æ®ä»ä¸€ç§æ ¼å¼è½¬æ¢ä¸ºå¦å¤–ä¸€ç§æ ¼å¼ï¼Œæˆ–è€…å¤„ç†è½¬æ¢è¿‡ç¨‹ä¸­æ‰€æŠ›å‡ºçš„å¼‚å¸¸ã€‚ ä½ çš„åº”ç”¨ç¨‹åºçš„ä¸šåŠ¡é€»è¾‘é€šå¸¸é©»ç•™åœ¨ä¸€ä¸ªæˆ–è€…å¤šä¸ª ChannelInboundHandler ä¸­ã€‚ ChannelPipeline æ¥å£ChannelPipeline æä¾›äº† ChannelHandler é“¾çš„å®¹å™¨ï¼Œå¹¶å®šä¹‰äº†ç”¨äºåœ¨è¯¥é“¾ä¸Šä¼ æ’­å…¥ç«™å’Œå‡ºç«™äº‹ä»¶æµçš„ APIã€‚å½“ Channel è¢«åˆ›å»ºæ—¶ï¼Œå®ƒä¼šè¢«è‡ªåŠ¨åœ°åˆ†é…åˆ°å®ƒä¸“å±çš„ ChannelPipelineã€‚ ChannelHandler å®‰è£…åˆ° ChannelPipeline ä¸­çš„è¿‡ç¨‹ï¼š ä¸€ä¸ªChannelInitializerçš„å®ç°è¢«æ³¨å†Œåˆ°äº†ServerBootstrapä¸­ï¼› å½“ ChannelInitializer.initChannel() æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼ŒChannelInitializer å°†åœ¨ ChannelPipeline ä¸­å®‰è£…ä¸€ç»„è‡ªå®šä¹‰çš„ ChannelHandlerï¼› ChannelInitializer å°†å®ƒè‡ªå·±ä» ChannelPipeline ä¸­ç§»é™¤ã€‚ ChannelHandler æ˜¯ä¸“ä¸ºæ”¯æŒå¹¿æ³›çš„ç”¨é€”è€Œè®¾è®¡çš„ï¼Œå¯ä»¥å°†å®ƒçœ‹ä½œæ˜¯å¤„ç†å¾€æ¥ ChannelPipeline äº‹ä»¶ï¼ˆåŒ…æ‹¬æ•°æ®ï¼‰çš„ä»»ä½•ä»£ç çš„é€šç”¨å®¹å™¨ã€‚ä½¿å¾—äº‹ä»¶æµç» ChannelPipeline æ˜¯ ChannelHandler çš„å·¥ä½œï¼Œå®ƒä»¬æ˜¯åœ¨åº”ç”¨ç¨‹åºçš„åˆå§‹åŒ–æˆ–è€…å¼•å¯¼é˜¶æ®µè¢«å®‰è£…çš„ã€‚è¿™äº›å¯¹è±¡æ¥æ”¶äº‹ä»¶ã€æ‰§è¡Œå®ƒä»¬æ‰€å®ç°çš„å¤„ç†é€»è¾‘ï¼Œå¹¶å°†æ•°æ®ä¼ é€’ç»™é“¾ä¸­çš„ä¸‹ä¸€ä¸ª ChannelHandlerã€‚å®ƒä»¬çš„æ‰§è¡Œé¡ºåºæ˜¯ç”±å®ƒä»¬è¢«æ·»åŠ çš„é¡ºåºæ‰€å†³å®šçš„ã€‚å®é™…ä¸Šï¼Œè¢«æˆ‘ä»¬ç§°ä¸º ChannelPipeline çš„æ˜¯è¿™äº› ChannelHandler çš„ç¼–æ’é¡ºåºã€‚ å¦‚åŒä¸Šå›¾æ‰€ç¤ºï¼Œå…¥ç«™å’Œå‡ºç«™ ChannelHandler å¯ä»¥è¢«å®‰è£…åˆ°åŒä¸€ä¸ª ChannelPipeline ä¸­ã€‚è™½ç„¶ ChannelInboundHandle å’Œ ChannelOutboundHandle éƒ½æ‰©å±•è‡ª ChannelHandlerï¼Œä½†æ˜¯ Netty èƒ½åŒºåˆ† ChannelInboundHandler å®ç°å’Œ ChannelOutboundHandler å®ç°ï¼Œå¹¶ç¡®ä¿æ•°æ®åªä¼šåœ¨å…·æœ‰ç›¸åŒå®šå‘ç±»å‹çš„ä¸¤ä¸ª ChannelHandler ä¹‹é—´ä¼ é€’ã€‚ å½“ ChannelHandler è¢«æ·»åŠ åˆ° ChannelPipeline æ—¶ï¼Œå®ƒå°†ä¼šè¢«åˆ†é…ä¸€ä¸ª ChannelHandlerContextï¼Œå…¶ä»£è¡¨äº† ChannelHandler å’Œ ChannelPipeline ä¹‹é—´çš„ç»‘å®šã€‚è™½ç„¶è¿™ä¸ªå¯¹è±¡å¯ä»¥è¢«ç”¨äºè·å–åº•å±‚çš„ Channelï¼Œä½†æ˜¯å®ƒä¸»è¦è¿˜æ˜¯è¢«ç”¨äºå†™å‡ºç«™æ•°æ®ã€‚ åœ¨ Netty ä¸­ï¼Œæœ‰ä¸¤ç§å‘é€æ¶ˆæ¯çš„æ–¹å¼ã€‚ä½ å¯ä»¥ç›´æ¥å†™åˆ° Channel ä¸­ï¼Œä¹Ÿå¯ä»¥å†™åˆ°å’Œ ChannelHandler ç›¸å…³è”çš„ ChannelHandlerContext å¯¹è±¡ä¸­ã€‚å‰ä¸€ç§æ–¹å¼å°†ä¼šå¯¼è‡´æ¶ˆæ¯ä» ChannelPipeline çš„å°¾ç«¯å¼€å§‹æµåŠ¨ï¼Œè€Œåè€…å°†å¯¼è‡´æ¶ˆæ¯ä» ChannelPipeline ä¸­çš„ä¸‹ä¸€ä¸ª ChannelHandler å¼€å§‹æµåŠ¨ã€‚ ç¼–ç å™¨å’Œè§£ç å™¨æ­£å¦‚æœ‰ç”¨æ¥ç®€åŒ– ChannelHandler çš„åˆ›å»ºçš„é€‚é…å™¨ç±»ä¸€æ ·ï¼Œæ‰€æœ‰ç”± Netty æä¾›çš„ç¼–ç å™¨/è§£ç å™¨é€‚é…å™¨ç±»éƒ½å®ç° äº† ChannelOutboundHandler æˆ–è€… ChannelInboundHandler æ¥å£ã€‚ é€šå¸¸æ¥è¯´ï¼Œè¿™äº›åŸºç±»çš„åç§°å°†ç±»ä¼¼äº ByteToMessageDecoder æˆ– MessageToByteEncoderã€‚å¯¹äºç‰¹æ®Šçš„ç±»å‹ï¼Œä½ å¯èƒ½ä¼šå‘ç°ç±»ä¼¼äº ProtobufEncoder å’Œ ProtobufDecoder è¿™æ ·çš„åç§°â€”â€”é¢„ç½®çš„ç”¨æ¥æ”¯æŒ Google çš„ Protocol Buffersã€‚ æŠ½è±¡ç±» SimpleChannelInboundHandleræœ€å¸¸è§çš„æƒ…å†µæ˜¯ï¼Œä½ çš„åº”ç”¨ç¨‹åºä¼šåˆ©ç”¨ä¸€ä¸ª ChannelHandler æ¥æ¥æ”¶è§£ç æ¶ˆæ¯ï¼Œå¹¶å¯¹è¯¥æ•°æ®åº”ç”¨ä¸šåŠ¡é€»è¾‘ã€‚è¦åˆ›å»ºä¸€ä¸ªè¿™æ ·çš„ ChannelHandlerï¼Œä½ åªéœ€è¦æ‰©å±•åŸºç±» SimpleChannelInboundHandler&lt;T&gt;ï¼Œå…¶ä¸­ T æ˜¯ä½ è¦å¤„ç†çš„æ¶ˆæ¯çš„ Java ç±»å‹ ã€‚åœ¨è¿™ä¸ª ChannelHandler ä¸­ï¼Œä½ å°†éœ€è¦é‡å†™åŸºç±»çš„ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ–¹æ³•ï¼Œå¹¶ä¸”è·å–ä¸€ä¸ªåˆ° ChannelHandlerContext çš„å¼•ç”¨ï¼Œ è¿™ä¸ªå¼•ç”¨å°†ä½œä¸ºè¾“å…¥å‚æ•°ä¼ é€’ç»™ ChannelHandler çš„æ‰€æœ‰æ–¹æ³•ã€‚ å¼•å¯¼Netty çš„å¼•å¯¼ç±»ä¸ºåº”ç”¨ç¨‹åºçš„ç½‘ç»œå±‚é…ç½®æä¾›äº†å®¹å™¨ï¼Œè¿™æ¶‰åŠå°†ä¸€ä¸ªè¿›ç¨‹ç»‘å®šåˆ°æŸä¸ªæŒ‡å®šçš„ç«¯å£ï¼Œæˆ–è€…å°†ä¸€ä¸ªè¿›ç¨‹è¿æ¥åˆ°å¦ä¸€ä¸ªè¿è¡Œåœ¨æŸä¸ªæŒ‡å®šä¸»æœºçš„æŒ‡å®šç«¯å£ä¸Šçš„è¿›ç¨‹ã€‚ â€œæœåŠ¡å™¨â€å’Œâ€œå®¢æˆ·ç«¯â€å®é™…ä¸Šè¡¨ç¤ºäº†ä¸åŒçš„ç½‘ç»œè¡Œä¸ºï¼›æ¢å¥è¯è¯´ï¼Œæ˜¯ç›‘å¬ä¼ å…¥çš„è¿æ¥è¿˜æ˜¯å»ºç«‹åˆ°ä¸€ä¸ªæˆ–è€…å¤šä¸ªè¿›ç¨‹çš„è¿æ¥ã€‚ å› æ­¤ï¼Œæœ‰ä¸¤ç§ç±»å‹çš„å¼•å¯¼ï¼šä¸€ç§ç”¨äºå®¢æˆ·ç«¯ï¼ˆç®€å•åœ°ç§°ä¸º Bootstrapï¼‰ï¼Œè€Œå¦ä¸€ç§ï¼ˆServerBootstrapï¼‰ç”¨äºæœåŠ¡å™¨ã€‚æ— è®ºä½ çš„åº”ç”¨ç¨‹åºä½¿ç”¨å“ªç§åè®®æˆ–è€…å¤„ç†å“ªç§ç±»å‹çš„æ•°æ®ï¼Œå”¯ä¸€å†³å®šå®ƒä½¿ç”¨å“ªç§å¼•å¯¼ç±»çš„æ˜¯å®ƒæ˜¯ä½œä¸ºä¸€ä¸ªå®¢æˆ·ç«¯è¿˜æ˜¯ä½œä¸ºä¸€ä¸ªæœåŠ¡å™¨ã€‚ Bootstrap å°†è¿æ¥è¿œç¨‹ä¸»æœºå’Œç«¯å£ï¼Œæ•°é‡é€šå¸¸ä¸ºä¸€ä¸ªã€‚ ServerBootstrap å°†ç»‘å®šåˆ°ä¸€ä¸ªç«¯å£ï¼Œå› ä¸ºæœåŠ¡å™¨å¿…é¡»è¦ç›‘å¬è¿æ¥ï¼Œæ•°é‡é€šå¸¸ä¸ºä¸¤ä¸ªã€‚ ç¬¬ä¸€ç»„å°†åªåŒ…å«ä¸€ä¸ª ServerChannelï¼Œä»£è¡¨æœåŠ¡å™¨è‡ªèº«çš„å·²ç»‘å®šåˆ°æŸä¸ªæœ¬åœ°ç«¯å£çš„æ­£åœ¨ç›‘å¬çš„å¥—æ¥å­—ã€‚ ç¬¬äºŒç»„å°†åŒ…å«æ‰€æœ‰å·²åˆ›å»ºçš„ç”¨æ¥å¤„ç†ä¼ å…¥å®¢æˆ·ç«¯è¿æ¥ï¼ˆå¯¹äºæ¯ä¸ªæœåŠ¡å™¨å·²ç»æ¥å—çš„è¿æ¥éƒ½æœ‰ä¸€ä¸ªï¼‰çš„ Channelã€‚ ä¸ ServerChannel ç›¸å…³è”çš„ EventLoopGroup å°†åˆ†é…ä¸€ä¸ªè´Ÿè´£ä¸ºä¼ å…¥è¿æ¥è¯·æ±‚åˆ›å»º Channel çš„ EventLoopã€‚ä¸€æ—¦è¿æ¥è¢«æ¥å—ï¼Œç¬¬äºŒä¸ª EventLoopGroup å°±ä¼šç»™å®ƒçš„ Channel åˆ†é…ä¸€ä¸ª EventLoopã€‚","categories":[{"name":"åå°æŠ€æœ¯","slug":"åå°æŠ€æœ¯","permalink":"http://yoursite.com/categories/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"Netty","slug":"Netty","permalink":"http://yoursite.com/tags/Netty/"}]},{"title":"ä¸€ä¸ªç®€å•çš„ Netty åº”ç”¨ç¨‹åº","slug":"åå°æŠ€æœ¯/Netty/Netty ç®€å•åº”ç”¨ç¨‹åº","date":"2020-01-21T14:46:53.000Z","updated":"2020-07-10T04:04:35.183Z","comments":true,"path":"2020/01/21/åå°æŠ€æœ¯/Netty/Netty ç®€å•åº”ç”¨ç¨‹åº/","link":"","permalink":"http://yoursite.com/2020/01/21/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/Netty/Netty%20%E7%AE%80%E5%8D%95%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F/","excerpt":"åº”ç”¨ç¨‹åº EchoEcho å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„äº¤äº’æ˜¯éå¸¸ç®€å•çš„ï¼›åœ¨å®¢æˆ·ç«¯å»ºç«‹ä¸€ä¸ªè¿æ¥ä¹‹åï¼Œå®ƒä¼šå‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªæˆ–å¤šä¸ªæ¶ˆæ¯ï¼Œåè¿‡æ¥ï¼ŒæœåŠ¡å™¨åˆä¼šå°†æ¯ä¸ªæ¶ˆæ¯å›é€ç»™å®¢æˆ·ç«¯ã€‚è¿™ä¸€ç®€å•çš„åŠŸèƒ½å……åˆ†ä½“ç°äº†å®¢æˆ·ç«¯/æœåŠ¡å™¨ç³»ç»Ÿä¸­å…¸å‹çš„è¯·æ±‚-å“åº”äº¤äº’æ¨¡å¼ã€‚","text":"åº”ç”¨ç¨‹åº EchoEcho å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„äº¤äº’æ˜¯éå¸¸ç®€å•çš„ï¼›åœ¨å®¢æˆ·ç«¯å»ºç«‹ä¸€ä¸ªè¿æ¥ä¹‹åï¼Œå®ƒä¼šå‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªæˆ–å¤šä¸ªæ¶ˆæ¯ï¼Œåè¿‡æ¥ï¼ŒæœåŠ¡å™¨åˆä¼šå°†æ¯ä¸ªæ¶ˆæ¯å›é€ç»™å®¢æˆ·ç«¯ã€‚è¿™ä¸€ç®€å•çš„åŠŸèƒ½å……åˆ†ä½“ç°äº†å®¢æˆ·ç«¯/æœåŠ¡å™¨ç³»ç»Ÿä¸­å…¸å‹çš„è¯·æ±‚-å“åº”äº¤äº’æ¨¡å¼ã€‚ ç¼–å†™ Echo æœåŠ¡å™¨æ‰€æœ‰çš„ Netty æœåŠ¡å™¨éƒ½éœ€è¦ä»¥ä¸‹ä¸¤éƒ¨åˆ† è‡³å°‘ä¸€ä¸ª ChannelHandlerï¼šè¯¥ç»„ä»¶å®ç°äº†æœåŠ¡å™¨å¯¹ä»å®¢æˆ·ç«¯æ¥æ”¶çš„æ•°æ®çš„å¤„ç†ï¼Œå³å®ƒçš„ä¸šåŠ¡é€»è¾‘ã€‚ å¼•å¯¼ï¼šè¿™æ˜¯é…ç½®æœåŠ¡å™¨çš„å¯åŠ¨ä»£ç ã€‚è‡³å°‘ï¼Œå®ƒä¼šå°†æœåŠ¡å™¨ç»‘å®šåˆ°å®ƒè¦ç›‘å¬è¿æ¥è¯·æ±‚çš„ç«¯å£ä¸Šã€‚ ChannelHandler å’Œä¸šåŠ¡é€»è¾‘å› ä¸ºä½ çš„ Echo æœåŠ¡å™¨ä¼šå“åº”ä¼ å…¥çš„æ¶ˆæ¯ï¼Œæ‰€ä»¥å®ƒéœ€è¦å®ç° ChannelInboundHandler æ¥å£ï¼Œç”¨æ¥å®šä¹‰å“åº”å…¥ç«™äº‹ä»¶çš„æ–¹æ³•ã€‚è¿™ä¸ªç®€å•çš„åº”ç”¨ç¨‹åºåªéœ€è¦ç”¨åˆ°å°‘é‡çš„è¿™äº›æ–¹æ³•ï¼Œæ‰€ä»¥ç»§æ‰¿ ChannelInboundHandlerAdapter ç±»ä¹Ÿå°±è¶³å¤Ÿäº†ï¼Œå®ƒæä¾›äº† ChannelInboundHandler çš„é»˜è®¤å®ç°ã€‚ 123456789101112131415161718192021222324// EchoServerHandler ç±»@Sharable // æ ‡ç¤ºä¸€ä¸ª ChannelHandler å¯ä»¥è¢«å¤šä¸ª Channel å®‰å…¨åœ°å…±äº«public class EchoServerHandler extends ChannelInboundHandlerAdapter &#123; // å¯¹äºæ¯ä¸ªä¼ å…¥çš„æ¶ˆæ¯éƒ½è¦è°ƒç”¨ @Override public void channelRead(ChannelHandlerContext ctx, Object msg) &#123; ByteBuf in = (ByteBuf) msg; System.out.println(\"Server received: \" + in.toString(CharsetUtil.UTF_8)); // å°†æ¥æ”¶åˆ°çš„æ•°æ®å†™ç»™å‘é€è€… ctx.write(in); &#125; // é€šçŸ¥ ChannelInboundHandler æœ€åä¸€æ¬¡å¯¹ channelRead() çš„è°ƒç”¨æ˜¯å½“å‰æ‰¹é‡è¯»å–ä¸­çš„æœ€åä¸€æ¡æ¶ˆæ¯ @Override public void channelReadComplete(ChannelHandlerContext ctx) &#123; // å°†æ¶ˆæ¯å†²åˆ·åˆ°è¿œç¨‹èŠ‚ç‚¹å¹¶ä¸”å…³é—­è¯¥ Channel ctx.writeAndFlush(Unpooled.EMPTY_BUFFER).addListener(ChannelFutureListener.CLOSE); &#125; // åœ¨è¯»å–æ“ä½œæœŸé—´ï¼Œæœ‰å¼‚å¸¸æŠ›å‡ºæ—¶ä¼šè°ƒç”¨ @Override public void exceptionCaught(ChannelHandlerContext ctx,Throwable cause) &#123; cause.printStackTrace(); ctx.close(); &#125;&#125; ChannelHandler çš„ä¸€äº›å…³é”®ç‚¹ï¼š é’ˆå¯¹ä¸åŒç±»å‹çš„äº‹ä»¶æ¥è°ƒç”¨ ChannelHandlerï¼› åº”ç”¨ç¨‹åºé€šè¿‡å®ç°æˆ–è€…æ‰©å±• ChannelHandler æ¥æŒ‚é’©åˆ°äº‹ä»¶çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¹¶ä¸”æä¾›è‡ªå®šä¹‰çš„åº”ç”¨ç¨‹åºé€»è¾‘ï¼› åœ¨æ¶æ„ä¸Šï¼ŒChannelHandler æœ‰åŠ©äºä¿æŒä¸šåŠ¡é€»è¾‘ä¸ç½‘ç»œå¤„ç†ä»£ç çš„åˆ†ç¦»ã€‚è¿™ç®€åŒ–äº†å¼€å‘è¿‡ç¨‹ï¼Œå› ä¸ºä»£ç å¿…é¡»ä¸æ–­åœ°æ¼”åŒ–ä»¥å“åº”ä¸æ–­å˜åŒ–çš„éœ€æ±‚ã€‚ å¼•å¯¼æœåŠ¡å™¨ç»‘å®šåˆ°æœåŠ¡å™¨å°†åœ¨å…¶ä¸Šç›‘å¬å¹¶æ¥å—ä¼ å…¥è¿æ¥è¯·æ±‚çš„ç«¯å£ï¼› é…ç½® Channelï¼Œä»¥å°†æœ‰å…³çš„å…¥ç«™æ¶ˆæ¯é€šçŸ¥ç»™ EchoServerHandler å®ä¾‹ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546// EchoServer ç±»public class EchoServer &#123; private final int port; public EchoServer(int port) &#123; this.port = port; &#125; public static void main(String[] args) throws Exception &#123; if (args.length != 1) &#123; System.err.println(\"Usage: \" + EchoServer.class.getSimpleName() + \" &lt;port&gt;\"); &#125; int port = Integer.parseInt(args[0]); new EchoServer(port).start(); &#125; public void start() throws Exception &#123; final EchoServerHandler serverHandler = new EchoServerHandler(); // åˆ›å»ºä¸€ä¸ªå¾ªç¯ç»„ EventLoopGroup EventLoopGroup group = new NioEventLoopGroup(); try &#123; // åˆ›å»ºä¸€ä¸ª ServerBootstrap çš„å®ä¾‹ä»¥å¼•å¯¼å’Œç»‘å®šæœåŠ¡å™¨ ServerBootstrap b = new ServerBootstrap(); b.group(group) .channel(NioServerSocketChannel.class) // æŒ‡å®šæœåŠ¡å™¨ç»‘å®šçš„æœ¬åœ°çš„ InetSocketAddress .localAddress(new InetSocketAddress(port)) .childHandler( // æ¥å—ä¸€ä¸ªæ–°è¿æ¥åˆ™ä¸€ä¸ªæ–°çš„å­ Channel å°†ä¼šè¢«åˆ›å»º new ChannelInitializer&lt;SocketChannel&gt;()&#123; // ä½¿ç”¨ä¸€ä¸ª EchoServerHandler çš„å®ä¾‹åˆå§‹åŒ–æ¯ä¸€ä¸ªæ–°çš„ Channel @Override public void initChannel(SocketChannel ch)throws Exception &#123; ch.pipeline().addLast(serverHandler); &#125; &#125; ); // å¼‚æ­¥åœ°ç»‘å®šæœåŠ¡å™¨ï¼Œsync() æ–¹æ³•çš„è°ƒç”¨å°†å¯¼è‡´å½“å‰ Thread é˜»å¡ï¼Œä¸€ç›´åˆ°ç»‘å®šæ“ä½œå®Œæˆä¸ºæ­¢ ChannelFuture f = b.bind().sync(); // å¼‚æ­¥åœ°å…³é—­æœåŠ¡å™¨ f.channel().closeFuture().sync(); &#125; finally &#123; group.shutdownGracefully().sync(); &#125; &#125; &#125; ç¼–å†™ Echo å®¢æˆ·ç«¯ Echo å®¢æˆ·ç«¯å°†ä¼šï¼š è¿æ¥åˆ°æœåŠ¡å™¨ï¼› å‘é€ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ¶ˆæ¯ï¼› å¯¹äºæ¯ä¸ªæ¶ˆæ¯ï¼Œç­‰å¾…å¹¶æ¥å—ä»æœåŠ¡å™¨å‘é€å›çš„ç›¸åŒæ¶ˆæ¯ å…³é—­è¿æ¥ã€‚ é€šè¿‡ ChannelHandler å®ç°å®¢æˆ·ç«¯é€»è¾‘å¦‚åŒæœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯å°†æ‹¥æœ‰ä¸€ä¸ªç”¨æ¥å¤„ç†æ•°æ®çš„ ChannelInboundHandlerã€‚ 123456789101112131415161718192021// å®¢æˆ·ç«¯çš„ ChannelHandler// ByteBuf ä¸º Nutty çš„å­—èŠ‚å®¹å™¨@Sharablepublic class EchoClientHandler extends SimpleChannelInboundHandler&lt;ByteBuf&gt; &#123; // åœ¨åˆ°æœåŠ¡å™¨çš„è¿æ¥å·²ç»å»ºç«‹ä¹‹åå°†è¢«è°ƒç”¨ @Override public void channelActive(ChannelHandlerContext ctx) &#123; ctx.writeAndFlush(Unpooled.copiedBuffer(\"Netty rocks!\",CharsetUtil.UTF_8)); &#125; // å½“ä»æœåŠ¡å™¨æ¥æ”¶åˆ°ä¸€æ¡æ¶ˆæ¯æ—¶è¢«è°ƒç”¨ @Override public void channelRead0(ChannelHandlerContext ctx, ByteBuf in) &#123; System.out.println(\"Client received: \" + in.toString(CharsetUtil.UTF_8)); &#125; // åœ¨å¤„ç†è¿‡ç¨‹ä¸­å¼•å‘å¼‚å¸¸æ—¶è¢«è°ƒç”¨ @Override public void exceptionCaught(ChannelHandlerContext ctx,Throwable cause) &#123; cause.printStackTrace(); ctx.close(); &#125;&#125; SimpleChannelInboundHandler ä¸ ChannelInboundHandler ä½ å¯èƒ½ä¼šæƒ³ï¼šä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨å®¢æˆ·ç«¯ä½¿ç”¨çš„æ˜¯ SimpleChannelInboundHandlerï¼Œè€Œä¸æ˜¯åœ¨ EchoServerHandler ä¸­æ‰€ä½¿ç”¨çš„ ChannelInboundHandlerAdapter å‘¢ï¼Ÿè¿™å’Œä¸¤ä¸ªå› ç´ çš„ç›¸äº’ä½œç”¨æœ‰å…³ï¼šä¸šåŠ¡é€»è¾‘å¦‚ä½•å¤„ç†æ¶ˆæ¯ä»¥åŠ Netty å¦‚ä½•ç®¡ç†èµ„æºã€‚ åœ¨å®¢æˆ·ç«¯ï¼Œå½“ channelRead0() æ–¹æ³•å®Œæˆæ—¶ï¼Œä½ å·²ç»æœ‰äº†ä¼ å…¥æ¶ˆæ¯ï¼Œå¹¶ä¸”å·²ç»å¤„ç†å®Œå®ƒäº†ã€‚å½“è¯¥æ–¹æ³•è¿”å›æ—¶ï¼ŒSimpleChannelInboundHandler è´Ÿè´£é‡Šæ”¾æŒ‡å‘ä¿å­˜è¯¥æ¶ˆæ¯çš„ ByteBuf çš„å†…å­˜å¼•ç”¨ã€‚ åœ¨ EchoServerHandler ä¸­ï¼Œä½ ä»ç„¶éœ€è¦å°†ä¼ å…¥æ¶ˆæ¯å›é€ç»™å‘é€è€…ï¼Œè€Œ write()æ“ä½œæ˜¯å¼‚æ­¥çš„ï¼Œç›´åˆ° channelRead() æ–¹æ³•è¿”å›åå¯èƒ½ä»ç„¶æ²¡æœ‰å®Œæˆã€‚ä¸ºæ­¤ï¼ŒEchoServerHandler æ‰©å±•äº† ChannelInboundHandlerAdapterï¼Œå…¶åœ¨è¿™ä¸ªæ—¶é—´ç‚¹ä¸Šä¸ä¼šé‡Šæ”¾æ¶ˆæ¯ã€‚ æ¶ˆæ¯åœ¨ EchoServerHandler çš„ channelReadComplete() æ–¹æ³•ä¸­ï¼Œå½“ writeAndFlush() æ–¹æ³•è¢«è°ƒç”¨æ—¶è¢«é‡Šæ”¾ å¼•å¯¼å®¢æˆ·ç«¯å¼•å¯¼å®¢æˆ·ç«¯ç±»ä¼¼äºå¼•å¯¼æœåŠ¡å™¨ï¼Œä¸åŒçš„æ˜¯ï¼Œå®¢æˆ·ç«¯æ˜¯ä½¿ç”¨ä¸»æœºå’Œç«¯å£å‚æ•°æ¥è¿æ¥è¿œç¨‹åœ°å€ï¼Œä¹Ÿå°±æ˜¯è¿™é‡Œçš„ Echo æœåŠ¡å™¨çš„åœ°å€ï¼Œè€Œä¸æ˜¯ç»‘å®šåˆ°ä¸€ä¸ªä¸€ç›´è¢«ç›‘å¬çš„ç«¯å£ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940// å®¢æˆ·ç«¯çš„ä¸»ç±»public class EchoClient &#123; private final String host; private final int port; public EchoClient(String host, int port) &#123; this.host = host; this.port = port; &#125; public void start() throws Exception &#123; EventLoopGroup group = new NioEventLoopGroup(); try &#123; Bootstrap b = new Bootstrap(); b.group(group) .channel(NioSocketChannel.class) .remoteAddress(new InetSocketAddress(host, port)) .handler( new ChannelInitializer&lt;SocketChannel&gt;() &#123; @Override public void initChannel(SocketChannel ch) throws Exception &#123; ch.pipeline().addLast(new EchoClientHandler()); &#125; &#125; ); ChannelFuture f = b.connect().sync(); f.channel().closeFuture().sync(); &#125; finally &#123; group.shutdownGracefully().sync(); &#125; &#125; public static void main(String[] args) throws Exception &#123; if (args.length != 2) &#123; System.err.println(\"Usage: \" + EchoClient.class.getSimpleName() + \" &lt;host&gt; &lt;port&gt;\"); return; &#125; String host = args[0]; int port = Integer.parseInt(args[1]); new EchoClient(host, port).start(); &#125; &#125;","categories":[{"name":"åå°æŠ€æœ¯","slug":"åå°æŠ€æœ¯","permalink":"http://yoursite.com/categories/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"Netty","slug":"Netty","permalink":"http://yoursite.com/tags/Netty/"}]},{"title":"ç¯å¢ƒå˜é‡","slug":"ç¯å¢ƒæ­å»º/ç¯å¢ƒå˜é‡","date":"2020-01-21T14:35:41.000Z","updated":"2020-07-10T02:50:01.154Z","comments":true,"path":"2020/01/21/ç¯å¢ƒæ­å»º/ç¯å¢ƒå˜é‡/","link":"","permalink":"http://yoursite.com/2020/01/21/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F/","excerpt":"ç¯å¢ƒå˜é‡é…ç½®æ±‡æ€»","text":"ç¯å¢ƒå˜é‡é…ç½®æ±‡æ€» Java ç¯å¢ƒè®¾ç½®JAVA_HOMEï¼š[ JDK å®‰è£…ç›®å½• ] CLASSPATHï¼šâ€¦;%JAVA_HOME%\\bin Maven ç¯å¢ƒè®¾ç½®M2_HOMEï¼š[ å®‰è£…ç›®å½• ]/apache-maven-x.x.x CLASSPATHï¼šâ€¦;%M2_HOME%\\bin","categories":[{"name":"æŠ€æœ¯æ‚é¡¹","slug":"æŠ€æœ¯æ‚é¡¹","permalink":"http://yoursite.com/categories/%E6%8A%80%E6%9C%AF%E6%9D%82%E9%A1%B9/"}],"tags":[{"name":"ç¯å¢ƒå˜é‡","slug":"ç¯å¢ƒå˜é‡","permalink":"http://yoursite.com/tags/%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F/"}]},{"title":"Netty å…¥é—¨ç®€ä»‹","slug":"åå°æŠ€æœ¯/Netty/Netty å…¥é—¨ç®€ä»‹","date":"2020-01-21T01:37:11.000Z","updated":"2020-07-10T04:04:31.425Z","comments":true,"path":"2020/01/21/åå°æŠ€æœ¯/Netty/Netty å…¥é—¨ç®€ä»‹/","link":"","permalink":"http://yoursite.com/2020/01/21/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/Netty/Netty%20%E5%85%A5%E9%97%A8%E7%AE%80%E4%BB%8B/","excerpt":"Java IOæ— è®ºæ˜¯ C è¯­è¨€ï¼Œè¿˜æ˜¯ Javaï¼Œåœ¨è¿›è¡Œç½‘ç»œç¼–ç¨‹çš„å¼€å‘æ—¶éƒ½è¾ƒä¸ºä¸å‹å¥½ã€‚æ—©æœŸçš„ Java APIï¼ˆ java.net ï¼‰åªæ”¯æŒç”±æœ¬åœ°ç³»ç»Ÿå¥—æ¥å­—åº“æä¾›æ‰€è°“çš„é˜»å¡å‡½æ•°ã€‚","text":"Java IOæ— è®ºæ˜¯ C è¯­è¨€ï¼Œè¿˜æ˜¯ Javaï¼Œåœ¨è¿›è¡Œç½‘ç»œç¼–ç¨‹çš„å¼€å‘æ—¶éƒ½è¾ƒä¸ºä¸å‹å¥½ã€‚æ—©æœŸçš„ Java APIï¼ˆ java.net ï¼‰åªæ”¯æŒç”±æœ¬åœ°ç³»ç»Ÿå¥—æ¥å­—åº“æä¾›æ‰€è°“çš„é˜»å¡å‡½æ•°ã€‚ 12345678910111213141516171819202122// é˜»å¡ I/O ç¤ºä¾‹I/O// åˆ›å»ºä¸€ä¸ª ServerSocket ç”¨ä»¥ç›‘å¬ç«¯å£ä¸Šçš„è¿æ¥è¯·æ±‚ServerSocket serverSocket = new ServerSocket(portNumber);// accept() æ–¹æ³•è°ƒç”¨å°†è¢«é˜»å¡ï¼Œç›´åˆ°ä¸€ä¸ªè¿æ¥å»ºç«‹Socket clientSocket = serverSocket.accept();BufferReader in = new BufferReader( new InputStreamReader( clientSocket.getInputStream() ));// PrintWriter(OutputStream out, boolean autoFlush) ???PrintWriter out = new PrintWriter(clientSocket.getOutputStream(), true);String request, response;while ((request = in.readLine()) != null) &#123; if (\"Done\".equals(request)) &#123; break; // å®¢æˆ·ç«¯å‘é€äº† Done åˆ™é€€å‡ºå¤„ç†å¾ªç¯ &#125; // You can use ProcessRequest to handle your request response = processRequest(request); out.println(response);&#125; è¿™æ®µä»£ç ç‰‡æ®µå°†åªèƒ½åŒæ—¶å¤„ç†ä¸€ä¸ªè¿æ¥ï¼Œè¦ç®¡ç†å¤šä¸ªå¹¶å‘å®¢æˆ·ç«¯ï¼Œéœ€è¦ä¸ºæ¯ä¸ªæ–°çš„å®¢æˆ·ç«¯ Socket åˆ›å»ºä¸€ä¸ªæ–°çš„ Threadã€‚ ä½¿ç”¨é˜»å¡ I/Oå¤„ç†å¤šä¸ªè¿æ¥ï¼š Java NIOclass java.nio.channels.Selector æ˜¯ Java çš„éé˜»å¡ I/O å®ç°çš„å…³é”®ã€‚å®ƒä½¿ç”¨äº†äº‹ä»¶é€šçŸ¥ API ä»¥ç¡®å®šåœ¨ä¸€ç»„éé˜»å¡å¥—æ¥å­—ä¸­æœ‰å“ªäº›å·²ç»å°±ç»ªèƒ½å¤Ÿè¿› è¡Œ I/O ç›¸å…³çš„æ“ä½œã€‚å› ä¸ºå¯ä»¥åœ¨ä»»ä½•çš„æ—¶é—´æ£€æŸ¥ä»»æ„ çš„è¯»æ“ä½œæˆ–è€…å†™æ“ä½œçš„å®ŒæˆçŠ¶æ€ã€‚ ä½¿ç”¨ Selector çš„éé˜»å¡ I/O Netty ç®€ä»‹åœ¨ç½‘ç»œç¼–ç¨‹é¢†åŸŸï¼ŒNetty æ˜¯ Java çš„å“è¶Šæ¡†æ¶ã€‚å®ƒé©¾é©­äº† Java é«˜ API çš„èƒ½åŠ›ï¼Œå¹¶å°†å…¶éšè—åœ¨ä¸€ä¸ªæ˜“äºä½¿ç”¨çš„ API ä¹‹åã€‚Netty ä½¿ä½ å¯ä»¥ä¸“æ³¨äºè‡ªå·±çœŸæ­£æ„Ÿå…´è¶£çš„ï¼šä½ çš„åº”ç”¨ç¨‹åºçš„ç‹¬ä¸€æ— äºŒçš„ä»·å€¼ã€‚ ä¸€ä¸ªæ—¢æ˜¯å¼‚æ­¥çš„åˆæ˜¯äº‹ä»¶é©±åŠ¨çš„ç³»ç»Ÿä¼šè¡¨ç°å‡ºä¸€ç§ç‰¹æ®Šçš„ã€å¯¹æˆ‘ä»¬æ¥è¯´æå…·ä»·å€¼çš„è¡Œä¸ºï¼šå®ƒå¯ä»¥ä»¥ä»»æ„çš„é¡ºåºå“åº”åœ¨ä»»æ„çš„æ—¶é—´ç‚¹äº§ç”Ÿçš„äº‹ä»¶ã€‚ å®Œå…¨å¼‚æ­¥çš„ I/Oï¼šéé˜»å¡ç½‘ç»œè°ƒç”¨ä½¿å¾—æˆ‘ä»¬å¯ä»¥ä¸å¿…ç­‰å¾…ä¸€ä¸ªæ“ä½œçš„å®Œæˆã€‚å¼‚æ­¥æ–¹æ³•ä¼šç«‹å³è¿”å›ï¼Œå¹¶ä¸”åœ¨å®ƒå®Œæˆæ—¶ï¼Œä¼šç›´æ¥æˆ–è€…åœ¨ç¨åçš„æŸä¸ªæ—¶é—´ç‚¹é€šçŸ¥ç”¨æˆ·ã€‚ é€‰æ‹©å™¨ä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿé€šè¿‡è¾ƒå°‘çš„çº¿ç¨‹ä¾¿å¯ç›‘è§†è®¸å¤šè¿æ¥ä¸Šçš„äº‹ä»¶ã€‚ Netty çš„æ ¸å¿ƒç»„ä»¶ChannelChannel æ—¶ Java NIO çš„ä¸€ä¸ªåŸºæœ¬æ„é€ ã€‚ å®ƒä»£è¡¨ä¸€ä¸ªåˆ°å®ä½“ï¼ˆå¦‚ä¸€ä¸ªç¡¬ä»¶è®¾å¤‡ã€ä¸€ä¸ªæ–‡ä»¶ã€ä¸€ä¸ªç½‘ç»œå¥—æ¥å­—æˆ–è€…ä¸€ä¸ªèƒ½å¤Ÿæ‰§ è¡Œä¸€ä¸ªæˆ–è€…å¤šä¸ªä¸åŒçš„I/Oæ“ä½œçš„ç¨‹åºç»„ä»¶ï¼‰çš„å¼€æ”¾è¿æ¥ï¼Œå¦‚è¯»æ“ä½œå’Œå†™æ“ä½œã€‚ åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥æŠŠ Channel çœ‹ä½œæ˜¯ä¼ å…¥ï¼ˆå…¥ç«™ï¼‰æˆ–è€…ä¼ å‡ºï¼ˆå‡ºç«™ï¼‰æ•°æ®çš„è½½ä½“ã€‚å› æ­¤ï¼Œå®ƒå¯ä»¥è¢«æ‰“å¼€æˆ–è€…è¢«å…³é—­ï¼Œè¿æ¥æˆ–è€…æ–­å¼€è¿æ¥ã€‚ å›è°ƒNetty åœ¨å†…éƒ¨ä½¿ç”¨äº†å›è°ƒæ¥å¤„ç†äº‹ä»¶ï¼›å½“ä¸€ä¸ªå›è°ƒè¢«è§¦å‘æ—¶ï¼Œç›¸å…³çš„äº‹ä»¶å¯ä»¥è¢«ä¸€ä¸ª interfaceChannelHandler çš„å®ç°å¤„ç† 12345678910// è¢«å›è°ƒè§¦å‘çš„ ChannelHandlerpublic class ConnectHandler extends ChannelInboundHandlerAdapter &#123; @Override // å½“ä¸€ä¸ªæ–°çš„è¿æ¥è¢«å»ºç«‹å®Œæˆæ—¶ï¼Œæ­¤æ–¹æ³•å°†ä¼šè¢«è°ƒç”¨ public void channelActive(ChannelHandlerContext ctx) throws Exception &#123; System.out.println( \"Client \" + ctx.channel().remoteAddress() + \" connected\" ); &#125;&#125; FutureFuture æä¾›äº†å¦ä¸€ç§åœ¨æ“ä½œå®Œæˆæ—¶é€šçŸ¥åº”ç”¨ç¨‹åºçš„æ–¹å¼ã€‚è¿™ä¸ªå¯¹è±¡å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œçš„ç»“æœçš„å ä½ç¬¦ï¼›å®ƒå°†åœ¨æœªæ¥çš„æŸä¸ªæ—¶åˆ»å®Œæˆï¼Œå¹¶æä¾›å¯¹å…¶ç»“æœçš„è®¿é—®ã€‚ JDK é¢„ç½®äº† interface java.util.concurrent.Futureï¼Œä½†æ˜¯å…¶æ‰€æä¾›çš„å®ç°ï¼Œåªå…è®¸æ‰‹åŠ¨æ£€æŸ¥å¯¹åº”çš„æ“ä½œæ˜¯å¦å·²ç»å®Œæˆï¼Œæˆ–è€…ä¸€ç›´é˜»å¡ç›´åˆ°å®ƒå®Œæˆã€‚è¿™æ˜¯éå¸¸ç¹ççš„ï¼Œæ‰€ä»¥ Netty æä¾›äº†å®ƒè‡ªå·±çš„å®ç°ï¼šChannelFutureï¼Œç”¨äºåœ¨æ‰§è¡Œå¼‚æ­¥æ“ä½œçš„æ—¶å€™ä½¿ç”¨ã€‚ ChannelFutureæä¾›äº†å‡ ç§é¢å¤–çš„æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•ä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿæ³¨å†Œä¸€ä¸ªæˆ–è€…å¤šä¸ª ChannelFutureListener å®ä¾‹ã€‚ç”± ChannelFutureListener æä¾›çš„é€šçŸ¥æœºåˆ¶æ¶ˆé™¤äº†æ‰‹åŠ¨æ£€æŸ¥å¯¹åº”çš„æ“ä½œæ˜¯å¦å®Œæˆçš„å¿…è¦ã€‚ ç›‘å¬å™¨çš„å›è°ƒæ–¹æ³• operationComplete()ï¼šå°†ä¼šåœ¨å¯¹åº”çš„æ“ä½œå®Œæˆæ—¶è¢«è°ƒç”¨ã€‚ ç›‘å¬å™¨å¯ä»¥åˆ¤æ–­æ“ä½œæ˜¯æˆåŠŸåœ°å®Œæˆäº†è¿˜æ˜¯å‡ºé”™äº†ï¼ˆ æ£€ç´¢äº§ç”Ÿçš„ Throwable ï¼‰ã€‚ æ¯ä¸ª Netty çš„å‡ºç«™ I/O æ“ä½œéƒ½å°†è¿”å›ä¸€ä¸ª ChannelFutureï¼›ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä»¬éƒ½ä¸ä¼šé˜»å¡ã€‚æ­£å¦‚æˆ‘ä»¬å‰é¢æ‰€æåˆ°è¿‡çš„ä¸€æ ·ï¼ŒNetty å®Œå…¨æ˜¯å¼‚æ­¥å’Œäº‹ä»¶é©±åŠ¨çš„ã€‚ 123456789101112131415161718192021222324252627// å¼‚æ­¥çš„å»ºç«‹è¿æ¥Channel channel = ...;// Does not blockChannelFuture future = channel.connect( // å¼‚æ­¥åœ°è¿æ¥åˆ°è¿œç¨‹èŠ‚ç‚¹ new InetSocketAddress(\"192.168.0.1\", 25));// æ³¨å†Œä¸€ä¸ª ChannelFutureListener ä»¥ä¾¿åœ¨æ“ä½œå®Œæˆæ—¶è·å¾—é€šçŸ¥future.addListener( new ChannelFutureListener() &#123; @Override public void operationComplete(ChannelFuture future) &#123; // æ£€æŸ¥æ“ä½œçš„çŠ¶æ€ if (future.isSuccess())&#123; ByteBuf buffer = Unpooled.copiedBuffer( \"Hello\",Charset.defaultCharset() ); // å°†æ•°æ®å¼‚æ­¥å‘é€åˆ°è¿œç¨‹èŠ‚ç‚¹ ChannelFuture wf = future.channel().writeAndFlush(buffer); .... &#125; else &#123; Throwable cause = future.cause(); cause.printStackTrace(); &#125; &#125; &#125;); å›è°ƒå’Œ Future æ˜¯ç›¸äº’è¡¥å……çš„æœºåˆ¶ï¼›å®ƒä»¬ç›¸äº’ç»“åˆï¼Œæ„æˆäº† Netty æœ¬èº«çš„å…³é”®æ„ä»¶å—ä¹‹ä¸€ã€‚ äº‹ä»¶å’Œ ChannelHandlerNetty æ˜¯ä¸€ä¸ªç½‘ç»œç¼–ç¨‹æ¡†æ¶ï¼Œæ‰€ä»¥äº‹ä»¶æ˜¯æŒ‰ç…§å®ƒä»¬ä¸å…¥ç«™æˆ–å‡ºç«™æ•°æ®æµçš„ç›¸å…³æ€§è¿›è¡Œåˆ†ç±»çš„ã€‚ å¯èƒ½ç”±å…¥ç«™æ•°æ®æˆ–è€…ç›¸å…³çš„çŠ¶æ€æ›´æ”¹è€Œè§¦å‘çš„äº‹ä»¶ï¼š è¿æ¥å·²è¢«æ¿€æ´»æˆ–è€…è¿æ¥å¤±æ´»ï¼› æ•°æ®è¯»å–ï¼› ç”¨æˆ·äº‹ä»¶ï¼› é”™è¯¯äº‹ä»¶ã€‚ å‡ºç«™äº‹ä»¶æ˜¯æœªæ¥å°†ä¼šè§¦å‘çš„æŸä¸ªåŠ¨ä½œçš„æ“ä½œç»“æœï¼Œè¿™äº›åŠ¨ä½œåŒ…æ‹¬ï¼š æ‰“å¼€æˆ–è€…å…³é—­åˆ°è¿œç¨‹èŠ‚ç‚¹çš„è¿æ¥ï¼› å°†æ•°æ®å†™åˆ°æˆ–è€…å†²åˆ·åˆ°å¥—æ¥å­—ã€‚ æ¯ä¸ªäº‹ä»¶éƒ½å¯ä»¥è¢«åˆ†å‘ç»™ ChannelHandler ç±»ä¸­çš„æŸä¸ªç”¨æˆ·å®ç°çš„æ–¹æ³•ï¼Œåé¢ä¼šå¯¹æ­¤ç±»è¿›è¡Œæ›´è¿›ä¸€æ­¥çš„è¯´æ˜ï¼Œç›®å‰ä½ å¯ä»¥æ¯ä¸ª ChannelHandler çš„å®ä¾‹éƒ½ç±»ä¼¼äºä¸€ç§ä¸ºäº†å“åº”ç‰¹å®šäº‹ä»¶è€Œè¢«æ‰§è¡Œçš„å›è°ƒã€‚ æµç» ChannelHandler é“¾çš„å…¥ç«™äº‹ä»¶å’Œå‡ºç«™äº‹ä»¶ å„ç»„ä»¶çš„æ•´åˆ Futureã€å›è°ƒå’Œ ChannelHandler Netty çš„å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹æ˜¯å»ºç«‹åœ¨ Future å’Œå›è°ƒçš„æ¦‚å¿µä¹‹ä¸Šçš„ï¼Œè€Œå°†äº‹ä»¶æ´¾å‘åˆ° ChannelHandler çš„æ–¹æ³•åˆ™å‘ç”Ÿåœ¨æ›´æ·±çš„å±‚æ¬¡ä¸Šã€‚ç»“åˆåœ¨ä¸€èµ·ï¼Œè¿™äº›å…ƒç´ å°±æä¾›äº†ä¸€ä¸ªå¤„ç†ç¯å¢ƒï¼Œä½¿ä½ çš„åº”ç”¨ç¨‹åºé€» è¾‘å¯ä»¥ç‹¬ç«‹äºä»»ä½•ç½‘ç»œæ“ä½œç›¸å…³çš„é¡¾è™‘è€Œç‹¬ç«‹åœ°æ¼”å˜ã€‚è¿™ä¹Ÿæ˜¯ Netty çš„è®¾è®¡æ–¹å¼çš„ä¸€ä¸ªå…³é”®ç›®æ ‡ã€‚ æ‹¦æˆªæ“ä½œä»¥åŠé«˜é€Ÿåœ°è½¬æ¢å…¥ç«™æ•°æ®å’Œå‡ºç«™æ•°æ®ï¼Œéƒ½åªéœ€è¦ä½ æä¾›å›è°ƒæˆ–è€…åˆ©ç”¨æ“ä½œæ‰€è¿”å›çš„ Futureã€‚è¿™ä½¿å¾—é“¾æ¥æ“ä½œå˜å¾—æ—¢ç®€å•åˆé«˜æ•ˆï¼Œå¹¶ä¸”ä¿ƒè¿›äº†å¯é‡ç”¨çš„é€šç”¨ä»£ç çš„ç¼–å†™ã€‚ é€‰æ‹©å™¨ã€äº‹ä»¶å’Œ EventLoop Netty é€šè¿‡è§¦å‘äº‹ä»¶å°† Selector ä»åº”ç”¨ç¨‹åºä¸­æŠ½è±¡å‡ºæ¥ï¼Œæ¶ˆé™¤äº†æ‰€æœ‰æœ¬æ¥å°†éœ€è¦æ‰‹åŠ¨ç¼–å†™ çš„æ´¾å‘ä»£ç ã€‚åœ¨å†…éƒ¨ï¼Œå°†ä¼šä¸ºæ¯ä¸ª Channel åˆ†é…ä¸€ä¸ª EventLoopï¼Œç”¨ä»¥å¤„ç†æ‰€æœ‰äº‹ä»¶ã€‚ EventLoop æœ¬èº«åªç”±ä¸€ä¸ªçº¿ç¨‹é©±åŠ¨ï¼Œå…¶å¤„ç†äº†ä¸€ä¸ª Channel çš„æ‰€æœ‰ I/O äº‹ä»¶ï¼Œå¹¶ä¸”åœ¨è¯¥ EventLoop çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…éƒ½ä¸ä¼šæ”¹å˜ï¼ˆ æ— éœ€é¡¾è™‘åŒæ­¥ ï¼‰ã€‚","categories":[{"name":"åå°æŠ€æœ¯","slug":"åå°æŠ€æœ¯","permalink":"http://yoursite.com/categories/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/"}],"tags":[{"name":"Netty","slug":"Netty","permalink":"http://yoursite.com/tags/Netty/"}]}],"categories":[{"name":"æ•°å­¦æ¨å¯¼","slug":"æ•°å­¦æ¨å¯¼","permalink":"http://yoursite.com/categories/%E6%95%B0%E5%AD%A6%E6%8E%A8%E5%AF%BC/"},{"name":"æ·±åº¦å­¦ä¹ ","slug":"æ·±åº¦å­¦ä¹ ","permalink":"http://yoursite.com/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"},{"name":"Python","slug":"Python","permalink":"http://yoursite.com/categories/Python/"},{"name":"åå°æŠ€æœ¯","slug":"åå°æŠ€æœ¯","permalink":"http://yoursite.com/categories/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/"},{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://yoursite.com/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"},{"name":"æŠ€æœ¯åŸç†","slug":"æŠ€æœ¯åŸç†","permalink":"http://yoursite.com/categories/%E6%8A%80%E6%9C%AF%E5%8E%9F%E7%90%86/"},{"name":"å¼€å‘æ‚é¡¹","slug":"å¼€å‘æ‚é¡¹","permalink":"http://yoursite.com/categories/%E5%BC%80%E5%8F%91%E6%9D%82%E9%A1%B9/"},{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","permalink":"http://yoursite.com/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"},{"name":"é¡¹ç›®å¼€å‘","slug":"é¡¹ç›®å¼€å‘","permalink":"http://yoursite.com/categories/%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91/"},{"name":"ç¯å¢ƒæ­å»º","slug":"ç¯å¢ƒæ­å»º","permalink":"http://yoursite.com/categories/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"},{"name":"åŸºç¡€çŸ¥è¯†","slug":"åŸºç¡€çŸ¥è¯†","permalink":"http://yoursite.com/categories/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"},{"name":"ç”Ÿæ´»æ‚è®°","slug":"ç”Ÿæ´»æ‚è®°","permalink":"http://yoursite.com/categories/%E7%94%9F%E6%B4%BB%E6%9D%82%E8%AE%B0/"},{"name":"Software","slug":"Software","permalink":"http://yoursite.com/categories/Software/"},{"name":"æŠ€æœ¯æ‚é¡¹","slug":"æŠ€æœ¯æ‚é¡¹","permalink":"http://yoursite.com/categories/%E6%8A%80%E6%9C%AF%E6%9D%82%E9%A1%B9/"}],"tags":[{"name":"çº¿æ€§ä»£æ•°","slug":"çº¿æ€§ä»£æ•°","permalink":"http://yoursite.com/tags/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0/"},{"name":"æ·±åº¦å­¦ä¹ ","slug":"æ·±åº¦å­¦ä¹ ","permalink":"http://yoursite.com/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"},{"name":"åŸºç¡€","slug":"åŸºç¡€","permalink":"http://yoursite.com/tags/%E5%9F%BA%E7%A1%80/"},{"name":"Spring","slug":"Spring","permalink":"http://yoursite.com/tags/Spring/"},{"name":"Flume","slug":"Flume","permalink":"http://yoursite.com/tags/Flume/"},{"name":"Kafka","slug":"Kafka","permalink":"http://yoursite.com/tags/Kafka/"},{"name":"HBase","slug":"HBase","permalink":"http://yoursite.com/tags/HBase/"},{"name":"ç®—æ³•æ•´ç†","slug":"ç®—æ³•æ•´ç†","permalink":"http://yoursite.com/tags/%E7%AE%97%E6%B3%95%E6%95%B4%E7%90%86/"},{"name":"MySQL","slug":"MySQL","permalink":"http://yoursite.com/tags/MySQL/"},{"name":"Hive","slug":"Hive","permalink":"http://yoursite.com/tags/Hive/"},{"name":"Linux","slug":"Linux","permalink":"http://yoursite.com/tags/Linux/"},{"name":"Hadoop","slug":"Hadoop","permalink":"http://yoursite.com/tags/Hadoop/"},{"name":"sklearn","slug":"sklearn","permalink":"http://yoursite.com/tags/sklearn/"},{"name":"RabbitMQ","slug":"RabbitMQ","permalink":"http://yoursite.com/tags/RabbitMQ/"},{"name":"Dubbo","slug":"Dubbo","permalink":"http://yoursite.com/tags/Dubbo/"},{"name":"ç‚¹èµ","slug":"ç‚¹èµ","permalink":"http://yoursite.com/tags/%E7%82%B9%E8%B5%9E/"},{"name":"H2","slug":"H2","permalink":"http://yoursite.com/tags/H2/"},{"name":"Mybatis","slug":"Mybatis","permalink":"http://yoursite.com/tags/Mybatis/"},{"name":"Aysnc","slug":"Aysnc","permalink":"http://yoursite.com/tags/Aysnc/"},{"name":"Scheduled","slug":"Scheduled","permalink":"http://yoursite.com/tags/Scheduled/"},{"name":"Email","slug":"Email","permalink":"http://yoursite.com/tags/Email/"},{"name":"Spring Boot","slug":"Spring-Boot","permalink":"http://yoursite.com/tags/Spring-Boot/"},{"name":"Security","slug":"Security","permalink":"http://yoursite.com/tags/Security/"},{"name":"Shiro","slug":"Shiro","permalink":"http://yoursite.com/tags/Shiro/"},{"name":"ElasticSearch","slug":"ElasticSearch","permalink":"http://yoursite.com/tags/ElasticSearch/"},{"name":"MQ","slug":"MQ","permalink":"http://yoursite.com/tags/MQ/"},{"name":"Springboot","slug":"Springboot","permalink":"http://yoursite.com/tags/Springboot/"},{"name":"Cache","slug":"Cache","permalink":"http://yoursite.com/tags/Cache/"},{"name":"MyBatis","slug":"MyBatis","permalink":"http://yoursite.com/tags/MyBatis/"},{"name":"é«˜å¹¶å‘ç¼–ç¨‹","slug":"é«˜å¹¶å‘ç¼–ç¨‹","permalink":"http://yoursite.com/tags/%E9%AB%98%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"},{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"http://yoursite.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"},{"name":"çˆ¬è™«","slug":"çˆ¬è™«","permalink":"http://yoursite.com/tags/%E7%88%AC%E8%99%AB/"},{"name":"å¼€å‘å·¥å…·","slug":"å¼€å‘å·¥å…·","permalink":"http://yoursite.com/tags/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/"},{"name":"ç”¨æˆ·ç®¡ç†ç³»ç»Ÿ","slug":"ç”¨æˆ·ç®¡ç†ç³»ç»Ÿ","permalink":"http://yoursite.com/tags/%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/"},{"name":"JPA","slug":"JPA","permalink":"http://yoursite.com/tags/JPA/"},{"name":"Druid","slug":"Druid","permalink":"http://yoursite.com/tags/Druid/"},{"name":"JDBC","slug":"JDBC","permalink":"http://yoursite.com/tags/JDBC/"},{"name":"Docker","slug":"Docker","permalink":"http://yoursite.com/tags/Docker/"},{"name":"Web","slug":"Web","permalink":"http://yoursite.com/tags/Web/"},{"name":"Log","slug":"Log","permalink":"http://yoursite.com/tags/Log/"},{"name":"Netty","slug":"Netty","permalink":"http://yoursite.com/tags/Netty/"},{"name":"Java","slug":"Java","permalink":"http://yoursite.com/tags/Java/"},{"name":"WebSocket","slug":"WebSocket","permalink":"http://yoursite.com/tags/WebSocket/"},{"name":"è¯»ä¹¦ç¬”è®°","slug":"è¯»ä¹¦ç¬”è®°","permalink":"http://yoursite.com/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"},{"name":"Welab","slug":"Welab","permalink":"http://yoursite.com/tags/Welab/"},{"name":"Git","slug":"Git","permalink":"http://yoursite.com/tags/Git/"},{"name":"ä¹±ç ","slug":"ä¹±ç ","permalink":"http://yoursite.com/tags/%E4%B9%B1%E7%A0%81/"},{"name":"èŠå¤©å®¤","slug":"èŠå¤©å®¤","permalink":"http://yoursite.com/tags/%E8%81%8A%E5%A4%A9%E5%AE%A4/"},{"name":"Maven","slug":"Maven","permalink":"http://yoursite.com/tags/Maven/"},{"name":"IDEA","slug":"IDEA","permalink":"http://yoursite.com/tags/IDEA/"},{"name":"Hexo","slug":"Hexo","permalink":"http://yoursite.com/tags/Hexo/"},{"name":"ç¯å¢ƒå˜é‡","slug":"ç¯å¢ƒå˜é‡","permalink":"http://yoursite.com/tags/%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F/"}]}