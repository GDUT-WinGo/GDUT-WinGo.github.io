<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>Hbase | Wingo&#39;s Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="HBase">
    <meta name="description" content="HBase 的简本介绍及简使用。">
<meta property="og:type" content="article">
<meta property="og:title" content="Hbase">
<meta property="og:url" content="http://yoursite.com/2020/05/03/%E5%A4%A7%E6%95%B0%E6%8D%AE/HBase/index.html">
<meta property="og:site_name" content="Wingo&#39;s Blog">
<meta property="og:description" content="HBase 的简本介绍及简使用。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://welab-wingo.gitee.io/image/2020/05/HBase/HBase01.jpg">
<meta property="og:image" content="http://welab-wingo.gitee.io/image/2020/05/HBase/HBase02.jpg">
<meta property="og:image" content="http://welab-wingo.gitee.io/image/2020/05/HBase/HBase03.jpg">
<meta property="og:image" content="http://welab-wingo.gitee.io/image/2020/05/HBase/HBase04.jpg">
<meta property="og:image" content="http://welab-wingo.gitee.io/image/2020/05/HBase/HBase05.jpg">
<meta property="og:image" content="http://welab-wingo.gitee.io/image/2020/05/HBase/HBase06.jpg">
<meta property="og:image" content="http://welab-wingo.gitee.io/image/2020/05/HBase/HBase07.jpg">
<meta property="og:image" content="http://welab-wingo.gitee.io/image/2020/05/HBase/HBase08.jpg">
<meta property="og:image" content="http://welab-wingo.gitee.io/image/2020/05/HBase/HBase09.jpg">
<meta property="article:published_time" content="2020-05-03T00:41:00.000Z">
<meta property="article:modified_time" content="2020-07-10T03:39:13.000Z">
<meta property="article:author" content="Wingo">
<meta property="article:tag" content="HBase">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://welab-wingo.gitee.io/image/2020/05/HBase/HBase01.jpg">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

<meta name="generator" content="Hexo 4.2.0"></head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Wingo</h5>
          <a href="mailto:1318263468@qq.com" title="1318263468@qq.com" class="mail">1318263468@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                Home
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Hbase</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">Hbase</h1>
        <h5 class="subtitle">
            
                <time datetime="2020-05-03T00:41:00.000Z" itemprop="datePublished" class="page-time">
  2020-05-03
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#简介"><span class="post-toc-text">简介</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#数据模型"><span class="post-toc-text">数据模型</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#基本架构"><span class="post-toc-text">基本架构</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#安装部署"><span class="post-toc-text">安装部署</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Shell"><span class="post-toc-text">Shell</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#基本操作"><span class="post-toc-text">基本操作</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#表操作"><span class="post-toc-text">表操作</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#进阶"><span class="post-toc-text">进阶</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#结构原理"><span class="post-toc-text">结构原理</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#写流程"><span class="post-toc-text">写流程</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#MemStore-Flush"><span class="post-toc-text">MemStore Flush</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#读流程"><span class="post-toc-text">读流程</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#StoreFile-Compaction"><span class="post-toc-text">StoreFile Compaction</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Region-Split"><span class="post-toc-text">Region Split</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#API"><span class="post-toc-text">API</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#表操作-1"><span class="post-toc-text">表操作</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#MapReduce"><span class="post-toc-text">MapReduce</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#官方案例"><span class="post-toc-text">官方案例</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#自定义"><span class="post-toc-text">自定义</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#集成-Hive"><span class="post-toc-text">集成 Hive</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#优化"><span class="post-toc-text">优化</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#高可用"><span class="post-toc-text">高可用</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#预分区"><span class="post-toc-text">预分区</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#RowKey"><span class="post-toc-text">RowKey</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#内存优化"><span class="post-toc-text">内存优化</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#项目实战"><span class="post-toc-text">项目实战</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#表的创建"><span class="post-toc-text">表的创建</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#功能实现"><span class="post-toc-text">功能实现</span></a></li></ol></li></ol>
        </nav>
    </aside>


<article id="post-大数据/HBase"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">Hbase</h1>
        <div class="post-meta">
            <time class="post-time" title="2020-05-03 08:41:00" datetime="2020-05-03T00:41:00.000Z"  itemprop="datePublished">2020-05-03</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据</a></li></ul>



            

        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <p>HBase 的简本介绍及简使用。</p>
<a id="more"></a>

<h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>HBase 是一种分布式、可扩展、支持海量数据存储的 NoSQL 数据库。</p>
<p>逻辑上，HBase 的数据模型同关系型数据库很类似，数据存储在一张表中，有行有列。 但从 HBase 的底层物理存储结构（K-V）来看，HBase 更像是一个 multi-dimensional map。</p>
<img src="http://welab-wingo.gitee.io/image/2020/05/HBase/HBase01.jpg" style="zoom: 80%;" />

<h4 id="数据模型"><a href="#数据模型" class="headerlink" title="数据模型"></a>数据模型</h4><p><strong>Name Space</strong></p>
<p>命名空间，类似于关系型数据库的 DatabBase 概念，每个命名空间下有多个表。HBase 有两个自带的命名空间，分别是 hbase 和 default，hbase 中存放的是 HBase 内置的表， default 表是用户默认使用的命名空间。</p>
<p><strong>Region</strong> </p>
<p>类似于关系型数据库的表概念。不同的是，HBase 定义表时只需要声明列族即可，不需 要声明具体的列。这意味着，往 HBase 写入数据时，字段可以动态、按需指定。因此，和关 系型数据库相比，HBase 能够轻松应对字段变更的场景。</p>
<p><strong>Row</strong> </p>
<p>HBase 表中的每行数据都由一个 RowKey 和多个 Column（列）组成，数据是按照 RowKey 的字典顺序存储的，并且查询数据时只能根据 RowKey 进行检索，所以 RowKey 的设计十分重 要。</p>
<p><strong>Column</strong> </p>
<p>HBase 中的每个列都由 (Column Family) 列族 和 (Column Qualifier )列限定符进行限 定，例如 info：name，info：age。建表时，只需指明列族，而列限定符无需预先定义。</p>
<p><strong>Time Stamp</strong> </p>
<p>用于标识数据的不同版本（version），每条数据写入时，如果不指定时间戳，系统会自动为其加上该字段，其值为写入 HBase 的时间。</p>
<p><strong>Cell</strong> </p>
<p>由 {RowKey, Column Family：Column Qualifier, Time Stamp} 唯一确定的单元。cell 中的数据是没有类型的，全部是字节码形式存贮。</p>
<h4 id="基本架构"><a href="#基本架构" class="headerlink" title="基本架构"></a>基本架构</h4><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://welab-wingo.gitee.io/image/2020/05/HBase/HBase02.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<p><strong>Region Server</strong> </p>
<p>Region Server 为 Region 的管理者，其实现类为 HRegionServer，主要作用如下：对于数据的操作：get, put, delete； 对于 Region 的操作：splitRegion、compactRegion。</p>
<p><strong>Master</strong> </p>
<p>Master 是所有 Region Server 的管理者，其实现类为 HMaster，主要作用如下： 对于表的操作：create, delete, alter；对于 RegionServer的操作：分配 regions 到每个RegionServer，监控每个 RegionServer 的状态，负载均衡和故障转移。</p>
<p><strong>Zookeeper</strong></p>
<p>HBase 通过 Zookeeper 来做 Master 的高可用、RegionServer 的监控、元数据的入口以及集群配置的维护等工作。</p>
<p><strong>HDFS</strong> </p>
<p>HDFS 为 HBase 提供最终的底层数据存储服务，同时为 HBase 提供高可用的支持。</p>
<h4 id="安装部署"><a href="#安装部署" class="headerlink" title="安装部署"></a>安装部署</h4><blockquote>
<p>首先要保证 Zookeeper 集群和 Hadoop 集群正常部署并启动。</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf hbase-1.3.1-bin.tar.gz -C /opt/module</span><br><span class="line">vi hbase-env.sh </span><br><span class="line">	export JAVA_HOME=/opt/module/jdk1.6.0_144</span><br><span class="line">	export HBASE_MANAGES_ZK=false # 关闭自带的 Zookeeper</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 修改 hbase-site.xml 配置文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.rootdir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://hadoop102:9000/HBase<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.cluster.distributed<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 0.98 后的新变动，之前版本没有.port,默认端口为 60000 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.master.port<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>16000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- region servers --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.zookeeper.quorum<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop102,hadoop103,hadoop104<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.zookeeper.property.dataDir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>/opt/module/zookeeper-3.4.10/zkData<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 软连接 hadoop 配置文件到 HBase</span></span><br><span class="line">ln -s /opt/module/hadoop2.7.2/etc/hadoop/core-site.xml /opt/module/hbase/conf/core-site.xml</span><br><span class="line">ln -s /opt/module/hadoop2.7.2/etc/hadoop/hdfs-site.xml /opt/module/hbase/conf/hdfs-site.xml</span><br><span class="line"><span class="meta">#</span><span class="bash"> 利用脚本发送到其它集群</span></span><br><span class="line"> xsync hbase/</span><br><span class="line"><span class="meta"> #</span><span class="bash"> 时间同步，否则会导致 regionserver 无法启动，抛出 ClockOutOfSyncException 异常</span></span><br><span class="line"> bin/start-hbase.sh</span><br><span class="line"><span class="meta"> #</span><span class="bash"> 可通过 16010 端口访问 HBase 管理页面</span></span><br></pre></td></tr></table></figure>

<h3 id="Shell"><a href="#Shell" class="headerlink" title="Shell"></a>Shell</h3><h4 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 进入 HBase 客户端命令行</span></span><br><span class="line">bin/hbase shell</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看帮助命令</span></span><br><span class="line">hbase(main):001:0&gt; help</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看当前数据库中有哪些表 </span></span><br><span class="line">hbase(main):002:0&gt; list</span><br></pre></td></tr></table></figure>

<h4 id="表操作"><a href="#表操作" class="headerlink" title="表操作"></a>表操作</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建表，只需要初始化一个列族信息即可</span></span><br><span class="line">hbase(main):002:0&gt; create 'student','info'</span><br><span class="line"><span class="meta">#</span><span class="bash"> 插入数据到表 </span></span><br><span class="line">hbase(main):003:0&gt; put 'student','1001','info:sex','male'</span><br><span class="line">hbase(main):004:0&gt; put 'student','1001','info:age','18'</span><br><span class="line">hbase(main):005:0&gt; put 'student','1002','info:name','Janna'</span><br><span class="line">hbase(main):006:0&gt; put 'student','1002','info:sex','female'</span><br><span class="line">hbase(main):007:0&gt; put 'student','1002','info:age','20'</span><br><span class="line"><span class="meta">#</span><span class="bash"> 扫描查看表数据</span></span><br><span class="line">hbase(main):008:0&gt; scan 'student'</span><br><span class="line">hbase(main):009:0&gt; scan 'student',&#123;STARTROW=&gt;'1001', STOPROW=&gt;'1001'&#125;</span><br><span class="line">hbase(main):010:0&gt; scan 'student',&#123;STARTROW=&gt;'1001'&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看表结构</span></span><br><span class="line">hbase(main):011:0&gt; describe ‘student’</span><br><span class="line"><span class="meta">#</span><span class="bash"> 更新指定字段的数据</span></span><br><span class="line">hbase(main):012:0&gt; put 'student','1001','info:name','Nick'</span><br><span class="line">hbase(main):013:0&gt; put 'student','1001','info:age','100'</span><br><span class="line">hbase(main):014:0&gt; get 'student','1001'</span><br><span class="line">hbase(main):015:0&gt; get 'student','1001','info:name'</span><br><span class="line"><span class="meta">#</span><span class="bash"> 统计表数据行数</span></span><br><span class="line">hbase(main):021:0&gt; count 'student'</span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除数据</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除某 rowkey 的全部数据</span></span><br><span class="line">hbase(main):016:0&gt; deleteall 'student','1001'</span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除某 rowkey 的某一列数据</span></span><br><span class="line">hbase(main):017:0&gt; delete 'student','1002','info:sex'</span><br><span class="line"><span class="meta">#</span><span class="bash"> 清空表数据</span></span><br><span class="line">hbase(main):018:0&gt; truncate 'student'</span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除表 需要先让该表为 <span class="built_in">disable</span> 状态</span></span><br><span class="line">hbase(main):019:0&gt; disable 'student'</span><br><span class="line"><span class="meta">#</span><span class="bash"> 然后才能 drop 这个表</span></span><br><span class="line">hbase(main):020:0&gt; drop 'student'</span><br><span class="line"><span class="meta">#</span><span class="bash"> 变更表信息 将 info 列族中的数据存放 3 个版本</span></span><br><span class="line">hbase(main):022:0&gt; alter 'student',&#123;NAME=&gt;'info',VERSIONS=&gt;3&#125;</span><br><span class="line">hbase(main):022:0&gt; get 'student','1001',&#123;COLUMN=&gt;'info:name',VERSIONS=&gt;3&#125;</span><br></pre></td></tr></table></figure>

<h3 id="进阶"><a href="#进阶" class="headerlink" title="进阶"></a>进阶</h3><h4 id="结构原理"><a href="#结构原理" class="headerlink" title="结构原理"></a>结构原理</h4><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://welab-wingo.gitee.io/image/2020/05/HBase/HBase03.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<p><strong>StoreFile</strong> </p>
<p>保存实际数据的物理文件，StoreFile 以 HFile 的形式存储在 HDFS 上。每个 Store 会有 一个或多个 StoreFile（HFile），数据在每个 StoreFile 中都是有序的。</p>
<p><strong>MemStore</strong> </p>
<p>写缓存，由于 HFile 中的数据要求是有序的，所以数据是先存储在 MemStore 中，排好序后，等到达刷写时机才会刷写到 HFile，每次刷写都会形成一个新的 HFile。</p>
<p> <strong>WAL</strong> Write-Ahead Logging</p>
<p>由于数据要经 MemStore 排序后才能刷写到 HFile，但把数据保存在内存中会有很高的概率导致数据丢失，为了解决这个问题，数据会先写在一个叫做 Write-Ahead logfile 的文件 中，然后再写入 MemStore 中。所以在系统出现故障的时候，数据可以通过这个日志文件重建。</p>
<h4 id="写流程"><a href="#写流程" class="headerlink" title="写流程"></a>写流程</h4><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://welab-wingo.gitee.io/image/2020/05/HBase/HBase04.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<ol>
<li>Client 先访问 zookeeper，获取 hbase:meta 表位于哪个 Region Server；</li>
<li>访问对应的 Region Server，获取 hbase:meta 表，根据写请求的 namespace:table/rowkey， 查询出目标数据位于哪个 Region Server 中的哪个 Region 中。并将该 table 的 region 信息以 及 meta 表的位置信息缓存在客户端的 meta cache，方便下次访问；</li>
<li>与目标 Region Server 进行通讯；</li>
<li>将数据顺序写入（追加）到 WAL；</li>
<li>将数据写入对应的 MemStore，数据会在 MemStore 进行排序；</li>
<li>向客户端发送 ack；</li>
<li>等达到 MemStore 的刷写时机后，将数据刷写到 HFile。</li>
</ol>
<h4 id="MemStore-Flush"><a href="#MemStore-Flush" class="headerlink" title="MemStore Flush"></a>MemStore Flush</h4><img src="http://welab-wingo.gitee.io/image/2020/05/HBase/HBase05.jpg" style="zoom:67%;" />

<p>刷写时机</p>
<ol>
<li>当某个 memstroe 的大小达到了 hbase.hregion.memstore.flush.size（默认值 128M）， 其所在 region 的所有 memstore 都会刷写。 当 memstore 的大小达到了 hbase.hregion.memstore.flush.size（默认值 128M） * hbase.hregion.memstore.block.multiplier（默认值 4） 时，会阻止继续往该 memstore 写数据。</li>
<li>当 region server 中 memstore 的总大小达到 java_heapsize * hbase.regionserver.global.memstore.size（默认值 0.4）* hbase.regionserver.global.memstore.size.lower.limit（默认值 0.95）， region 会按照其所有 memstore 的大小顺序（由大到小）依次进行刷写。直到 region server 中所有 memstore 的总大小减小到上述值以下。 当 region server 中 memstore 的总大小达到 java_heapsize * hbase.regionserver.global.memstore.size（默认值 0.4） 时，会阻止继续往所有的 memstore 写数据。</li>
<li>到达自动刷写的时间，也会触发 memstore flush。自动刷新的时间间隔由该属性进行配置，官方建议关闭此配置，hbase.regionserver.optionalcacheflushinterval（默认 1 小时）。</li>
<li>当 WAL 文件的数量超过 hbase.regionserver.max.logs，region 会按照时间顺序依次进行刷写，直到 WAL 文件数量减小到 hbase.regionserver.max.log 以下（该属性名已经废弃， 现无需手动设置，最大值为 32）。</li>
</ol>
<h4 id="读流程"><a href="#读流程" class="headerlink" title="读流程"></a>读流程</h4><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://welab-wingo.gitee.io/image/2020/05/HBase/HBase06.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<ol>
<li>Client 先访问 zookeeper，获取 hbase:meta 表位于哪个 Region Server；</li>
<li>访问对应的 Region Server，获取 hbase:meta 表，根据读请求的 namespace:table/rowkey， 查询出目标数据位于哪个 Region Server 中的哪个 Region 中。并将该 table 的 region 信息以 及 meta 表的位置信息缓存在客户端的 meta cache，方便下次访问；</li>
<li>与目标 Region Server 进行通讯；</li>
<li>分别在 Block Cache（读缓存），MemStore 和 Store File（HFile）中查询目标数据，并将查到的所有数据进行合并。此处所有数据是指同一条数据的不同版本（time stamp）或者不同的类型（Put / Delete）；</li>
<li>将从文件中查询到的数据块（Block，HFile 数据存储单元，默认大小为 64KB）缓存到 Block Cache；</li>
<li>将合并后的最终结果返回给客户端。</li>
</ol>
<h4 id="StoreFile-Compaction"><a href="#StoreFile-Compaction" class="headerlink" title="StoreFile Compaction"></a>StoreFile Compaction</h4><p>由于 memstore 每次刷写都会生成一个新的 HFile，且同一个字段的不同版本（timestamp） 和不同类型（Put / Delete）有可能会分布在不同的 HFile 中，因此查询时需要遍历所有的 HFile。为了减少 HFile 的个数，以及清理掉过期和删除的数据，会进行 StoreFile Compaction。 </p>
<p>Compaction 分为两种，分别是 Minor Compaction 和 Major Compaction。</p>
<p>Minor Compaction 会将临近的若干个较小的 HFile 合并成一个较大的 HFile，但不会清理过期和删除的数据。<br>Major Compaction 会将一个 Store 下的所有的 HFile 合并成一个大 HFile，并且会清理掉过期 和删除的数据。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://welab-wingo.gitee.io/image/2020/05/HBase/HBase07.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h4 id="Region-Split"><a href="#Region-Split" class="headerlink" title="Region Split"></a>Region Split</h4><p>默认情况下，每个 Table 起初只有一个 Region，随着数据的不断写入，Region 会自动进行拆分。刚拆分时，两个子 Region 都位于当前的 Region Server，但处于负载均衡的考虑， HMaster 有可能会将某个 Region 转移给其他的 Region Server。</p>
<p>Region Split 时机：</p>
<ol>
<li>.当1个region中的某个 Store 下所有 StoreFile 的总大小超过 hbase.hregion.max.filesize， 该 Region 就会进行拆分（0.94 版本之前）。</li>
<li>当 1 个 region 中 的 某 个 Store 下所有 StoreFile 的 总 大 小 超 过<br>Min(R^2 * “hbase.hregion.memstore.flush.size”,hbase.hregion.max.filesize”)，该 Region 就会进行拆分，其 中 R 为当前 Region Server 中属于该 Table 的个数（0.94 版本之后）。</li>
</ol>
<img src="http://welab-wingo.gitee.io/image/2020/05/HBase/HBase08.jpg" style="zoom: 67%;" />

<h3 id="API"><a href="#API" class="headerlink" title="API"></a>API</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hbase<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hbase-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hbase<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hbase-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取 Configuration 对象</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Configuration conf;</span><br><span class="line"><span class="keyword">static</span>&#123;</span><br><span class="line">    <span class="comment">// 使用 HBaseConfiguration 的单例方法实例化</span></span><br><span class="line">    conf = HBaseConfiguration.create();</span><br><span class="line">    <span class="comment">// 只需要配置 Zookeeper 的信息，因为 mate 都存在 Zookeeper 中</span></span><br><span class="line">    conf.set(<span class="string">"hbase.zookeeper.quorum"</span>, <span class="string">"192.166.9.102"</span>);</span><br><span class="line">    conf.set(<span class="string">"hbase.zookeeper.property.clientPort"</span>, <span class="string">"2181"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="表操作-1"><a href="#表操作-1" class="headerlink" title="表操作"></a>表操作</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 判断表石是否存在</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isTableExist</span><span class="params">(String tableName)</span> <span class="keyword">throws</span> </span></span><br><span class="line"><span class="function">    MasterNotRunningException,ZooKeeperConnectionException, IOException</span>&#123;</span><br><span class="line">    <span class="comment">// 在 HBase 中管理、访问表需要先创建 HBaseAdmin 对象</span></span><br><span class="line">    ConnectionFactory.createConnection(conf);</span><br><span class="line">    HBaseAdmin admin = <span class="keyword">new</span> HBaseAdmin(conf);</span><br><span class="line">    <span class="keyword">return</span> admin.tableExists(tableName);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建表</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">createTable</span><span class="params">(String tableName, String... columnFamily)</span> <span class="keyword">throws</span></span></span><br><span class="line"><span class="function">    MasterNotRunningException, ZooKeeperConnectionException, IOException</span>&#123;</span><br><span class="line">    HBaseAdmin admin = <span class="keyword">new</span> HBaseAdmin(conf);</span><br><span class="line">    <span class="comment">// 判断表是否存在</span></span><br><span class="line">    <span class="keyword">if</span>(isTableExist(tableName))&#123;</span><br><span class="line">        System.out.println(<span class="string">"表"</span> + tableName + <span class="string">"已存在"</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">// 创建表属性对象，表名需要转字节</span></span><br><span class="line">        HTableDescriptor descriptor = <span class="keyword">new</span> HTableDescriptor(TableName.valueOf(tableName));</span><br><span class="line">        <span class="comment">// 创建多个列族</span></span><br><span class="line">        <span class="keyword">for</span>(String cf : columnFamily)&#123;</span><br><span class="line">            descriptor.addFamily(<span class="keyword">new</span> HColumnDescriptor(cf));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 根据对表的配置，创建表</span></span><br><span class="line">        admin.createTable(descriptor);</span><br><span class="line">        System.out.println(<span class="string">"表"</span> + tableName + <span class="string">"创建成功！"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除表</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">dropTable</span><span class="params">(String tableName)</span> <span class="keyword">throws</span></span></span><br><span class="line"><span class="function">    MasterNotRunningException, ZooKeeperConnectionException, IOException</span>&#123;</span><br><span class="line">    HBaseAdmin admin = <span class="keyword">new</span> HBaseAdmin(conf);</span><br><span class="line">    <span class="keyword">if</span>(isTableExist(tableName))&#123;</span><br><span class="line">        admin.disableTable(tableName);</span><br><span class="line">        admin.deleteTable(tableName);</span><br><span class="line">        System.out.println(<span class="string">"表"</span> + tableName + <span class="string">"删除成功！"</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"表"</span> + tableName + <span class="string">"不存在！"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 向表中插入数据</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">addRowData</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    String tableName, String rowKey, String columnFamily, String column, String value)</span> </span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">    <span class="comment">// 创建 HTable 对象</span></span><br><span class="line">    HTable hTable = <span class="keyword">new</span> HTable(conf, tableName);</span><br><span class="line">    <span class="comment">// 向表中插入数据</span></span><br><span class="line">    Put put = <span class="keyword">new</span> Put(Bytes.toBytes(rowKey));</span><br><span class="line">    <span class="comment">// 向 Put 对象中组装数据</span></span><br><span class="line">    put.add(Bytes.toBytes(columnFamily), Bytes.toBytes(column),</span><br><span class="line">            Bytes.toBytes(value));</span><br><span class="line">    hTable.put(put);</span><br><span class="line">    hTable.close();</span><br><span class="line">    System.out.println(<span class="string">"插入数据成功"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除多行数据</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">deleteMultiRow</span><span class="params">(String tableName, String... rows)</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">    HTable hTable = <span class="keyword">new</span> HTable(conf, tableName);</span><br><span class="line">    List&lt;Delete&gt; deleteList = <span class="keyword">new</span> ArrayList&lt;Delete&gt;();</span><br><span class="line">    <span class="keyword">for</span>(String row : rows)&#123;</span><br><span class="line">        Delete delete = <span class="keyword">new</span> Delete(Bytes.toBytes(row));</span><br><span class="line">        deleteList.add(delete);</span><br><span class="line">    &#125;</span><br><span class="line">    hTable.delete(deleteList);</span><br><span class="line">    hTable.close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取所有数据</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">getAllRows</span><span class="params">(String tableName)</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">    HTable hTable = <span class="keyword">new</span> HTable(conf, tableName);</span><br><span class="line">    <span class="comment">// 得到用于扫描 region 的对象</span></span><br><span class="line">    Scan scan = <span class="keyword">new</span> Scan();</span><br><span class="line">    <span class="comment">// 使用 HTable 得到 resultcanner 实现类的对象</span></span><br><span class="line">    ResultScanner resultScanner = hTable.getScanner(scan);</span><br><span class="line">    <span class="keyword">for</span>(Result result : resultScanner)&#123;</span><br><span class="line">        <span class="comment">// 获取单元</span></span><br><span class="line">        Cell[] cells = result.rawCells();</span><br><span class="line">        <span class="keyword">for</span>(Cell cell : cells)&#123;</span><br><span class="line">            <span class="comment">//得到 rowkey</span></span><br><span class="line">            System.out.println(<span class="string">" 行 键 :"</span> + Bytes.toString(CellUtil.cloneRow(cell)));</span><br><span class="line">            <span class="comment">//得到列族</span></span><br><span class="line">            System.out.println(<span class="string">" 列 族 "</span> + Bytes.toString(CellUtil.cloneFamily(cell)));</span><br><span class="line">            System.out.println(<span class="string">" 列 :"</span> + Bytes.toString(CellUtil.cloneQualifier(cell)));</span><br><span class="line">            System.out.println(<span class="string">" 值 :"</span> + Bytes.toString(CellUtil.cloneValue(cell)));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取某一行数据</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">getRow</span><span class="params">(String tableName, String rowKey)</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">    HTable table = <span class="keyword">new</span> HTable(conf, tableName);</span><br><span class="line">    Get get = <span class="keyword">new</span> Get(Bytes.toBytes(rowKey));</span><br><span class="line">    Result result = table.get(get);</span><br><span class="line">    <span class="keyword">for</span>(Cell cell : result.rawCells())&#123;</span><br><span class="line">        System.out.println(<span class="string">" 行 键 :"</span> + Bytes.toString(result.getRow()));</span><br><span class="line">        System.out.println(<span class="string">" 列 族 "</span> + Bytes.toString(CellUtil.cloneFamily(cell)));</span><br><span class="line">        System.out.println(<span class="string">" 列 :"</span> + Bytes.toString(CellUtil.cloneQualifier(cell)));</span><br><span class="line">        System.out.println(<span class="string">" 值 :"</span> + Bytes.toString(CellUtil.cloneValue(cell)));</span><br><span class="line">        System.out.println(<span class="string">"时间戳:"</span> + cell.getTimestamp());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取某一行指定(列族:列)的数据</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">getRowQualifier</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    String tableName, String rowKey, String family, String qualifier)</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">    HTable table = <span class="keyword">new</span> HTable(conf, tableName);</span><br><span class="line">    Get get = <span class="keyword">new</span> Get(Bytes.toBytes(rowKey));</span><br><span class="line">    get.addColumn(Bytes.toBytes(family),Bytes.toBytes(qualifier));</span><br><span class="line">    Result result = table.get(get);</span><br><span class="line">    <span class="keyword">for</span>(Cell cell : result.rawCells())&#123;</span><br><span class="line">        System.out.println(<span class="string">" 行 键 :"</span> + Bytes.toString(result.getRow()));</span><br><span class="line">        System.out.println(<span class="string">" 列 族 "</span> + Bytes.toString(CellUtil.cloneFamily(cell)));</span><br><span class="line">        System.out.println(<span class="string">" 列 :"</span> + Bytes.toString(CellUtil.cloneQualifier(cell)));</span><br><span class="line">        System.out.println(<span class="string">" 值 :"</span> + Bytes.toString(CellUtil.cloneValue(cell)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="MapReduce"><a href="#MapReduce" class="headerlink" title="MapReduce"></a>MapReduce</h4><p>通过 HBase 的相关 Java API，我们可以实现伴随 HBase 操作的 MapReduce 过程，比如使用 MapReduce 将数据从本地文件系统导入到 HBase 的表中，比如我们从 HBase 中读取一些原 始数据后使用 MapReduce 做数据分析。</p>
<h5 id="官方案例"><a href="#官方案例" class="headerlink" title="官方案例"></a>官方案例</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/profile</span><br><span class="line"><span class="meta">	#</span><span class="bash"> <span class="built_in">export</span> HBASE_HOME=/opt/module/hbase</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> <span class="built_in">export</span> HADOOP_HOME=/opt/module/hadoop-2.7.2</span></span><br><span class="line">vi hadoop-env.sh # 注意：在 for 循环之后配</span><br><span class="line"><span class="meta">	#</span><span class="bash"> <span class="built_in">export</span> HADOOP_CLASSPATH=<span class="variable">$HADOOP_CLASSPATH</span>:/opt/module/hbase/lib/*</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 使用 MapReduce 将本地数据导入到 HBase</span></span><br><span class="line">vi fruit.tsv</span><br><span class="line">    # 1001 Apple Red</span><br><span class="line">    # 1002 Pear Yellow</span><br><span class="line">    # 1003 Pineapple Yellow</span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建 Hbase 表</span></span><br><span class="line">Hbase(main):001:0&gt; create 'fruit','info'</span><br><span class="line"><span class="meta">#</span><span class="bash"> 在 HDFS 中创建 input_fruit 文件夹并上传 fruit.tsv 文件</span></span><br><span class="line">/opt/module/hadoop-2.7.2/bin/hdfs dfs -mkdir /input_fruit/</span><br><span class="line">/opt/module/hadoop-2.7.2/bin/hdfs dfs -put fruit.tsv /input_fruit/</span><br><span class="line"><span class="meta">#</span><span class="bash"> 执行 MapReduce 到 HBase 的 fruit 表中</span></span><br><span class="line">/opt/module/hadoop-2.7.2/bin/yarn jar lib/hbase-server-1.3.1.jar</span><br><span class="line">importtsv \</span><br><span class="line">-Dimporttsv.columns=HBASE_ROW_KEY,info:name,info:color fruit \</span><br><span class="line">hdfs://hadoop102:9000/input_fruit</span><br><span class="line"><span class="meta">#</span><span class="bash"> 使用 scan 命令查看导入后的结果</span></span><br><span class="line">Hbase(main):001:0&gt; scan ‘fruit’</span><br></pre></td></tr></table></figure>

<h5 id="自定义"><a href="#自定义" class="headerlink" title="自定义"></a>自定义</h5><blockquote>
<p>将 fruit 表中的一部分数据，通过 MR 迁入到 fruit_mr 表中。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 继承的都是 HBase 提供的 Mapper 和 Reducer</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReadFruitMapper</span> <span class="keyword">extends</span> <span class="title">TableMapper</span>&lt;<span class="title">ImmutableBytesWritable</span>, <span class="title">Put</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(ImmutableBytesWritable key, Result value, Context context)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">// 将 fruit 的 name 和 color 提取出来，相当于将每一行数据读取出来放入到 Put 对象中</span></span><br><span class="line">        Put put = <span class="keyword">new</span> Put(key.get());</span><br><span class="line">        <span class="comment">// 遍历添加 column 行</span></span><br><span class="line">        <span class="keyword">for</span>(Cell cell: value.rawCells())&#123;</span><br><span class="line">            <span class="comment">// 添加/克隆列族:info</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="string">"info"</span>.equals(Bytes.toString(CellUtil.cloneFamily(cell))))&#123;</span><br><span class="line">                <span class="comment">// 添加/克隆列：name</span></span><br><span class="line">                <span class="keyword">if</span>(<span class="string">"name"</span>.equals(Bytes.toString(CellUtil.cloneQualifier(cell))))&#123;</span><br><span class="line">                    <span class="comment">// 将该列 cell 加入到 put 对象中</span></span><br><span class="line">                    put.add(cell);</span><br><span class="line">                    <span class="comment">// 添加/克隆列:color</span></span><br><span class="line">                &#125;<span class="keyword">else</span></span><br><span class="line">                    <span class="keyword">if</span>(<span class="string">"color"</span>.equals(Bytes.toString(CellUtil.cloneQualifier(cell))))&#123;</span><br><span class="line">                        <span class="comment">// 向该列 cell 加入到 put 对象中</span></span><br><span class="line">                        put.add(cell);</span><br><span class="line">                    &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 将从 fruit 读取到的每行数据写入到 context 中作为 map 的输出</span></span><br><span class="line">        context.write(key, put);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WriteFruitMRReducer</span> <span class="keyword">extends</span> <span class="title">TableReducer</span>&lt;<span class="title">ImmutableBytesWritable</span>, <span class="title">Put</span>, <span class="title">NullWritable</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">reduce</span><span class="params">(ImmutableBytesWritable key, Iterable&lt;Put&gt; values, Context context)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">// 读出来的每一行数据写入到 fruit_mr 表中</span></span><br><span class="line">        <span class="keyword">for</span>(Put put: values)&#123;</span><br><span class="line">            context.write(NullWritable.get(), put);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Fruit2FruitMRRunner</span> <span class="keyword">extends</span> <span class="title">Configured</span> <span class="keyword">implements</span> <span class="title">Tool</span></span>&#123;</span><br><span class="line">    <span class="comment">// 组装 Job</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">run</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// 得到 Configuration</span></span><br><span class="line">        Configuration conf = <span class="keyword">this</span>.getConf();</span><br><span class="line">        <span class="comment">// 创建 Job 任务</span></span><br><span class="line">        Job job = Job.getInstance(conf, <span class="keyword">this</span>.getClass().getSimpleName());</span><br><span class="line">        job.setJarByClass(Fruit2FruitMRRunner<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        <span class="comment">// 配置 Job</span></span><br><span class="line">        Scan scan = <span class="keyword">new</span> Scan();</span><br><span class="line">        scan.setCacheBlocks(<span class="keyword">false</span>);</span><br><span class="line">        scan.setCaching(<span class="number">500</span>);</span><br><span class="line">        <span class="comment">// 设置 Mapper，注意导入的是 mapreduce 包下的，不是 mapred 包下的，后者是老版本</span></span><br><span class="line">        TableMapReduceUtil.initTableMapperJob(</span><br><span class="line">            <span class="string">"fruit"</span>, <span class="comment">// 数据源的表名</span></span><br><span class="line">            scan, <span class="comment">// scan 扫描控制器</span></span><br><span class="line">            ReadFruitMapper<span class="class">.<span class="keyword">class</span>, // 设置 <span class="title">Mapper</span> 类</span></span><br><span class="line"><span class="class">            <span class="title">ImmutableBytesWritable</span>.<span class="title">class</span>, // 设置 <span class="title">Mapper</span> 输出 <span class="title">key</span> 类型</span></span><br><span class="line"><span class="class">            <span class="title">Put</span>.<span class="title">class</span>, // 设置 <span class="title">Mapper</span> 输出 <span class="title">value</span> 值类型</span></span><br><span class="line"><span class="class">            <span class="title">job</span> // 设置给哪个 <span class="title">JOB</span></span></span><br><span class="line"><span class="class">        )</span>;</span><br><span class="line">        <span class="comment">// 设置 Reducer</span></span><br><span class="line">        TableMapReduceUtil.initTableReducerJob(<span class="string">"fruit_mr"</span>, WriteFruitMRReducer<span class="class">.<span class="keyword">class</span>, <span class="title">job</span>)</span>;</span><br><span class="line">        <span class="comment">// 设置 Reduce 数量，最少 1 个</span></span><br><span class="line">        job.setNumReduceTasks(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">boolean</span> isSuccess = job.waitForCompletion(<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">if</span>(!isSuccess)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IOException(<span class="string">"Job running with error"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> isSuccess ? <span class="number">0</span> : <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">( String[] args )</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">    Configuration conf = HbaseConfiguration.create();</span><br><span class="line">    <span class="keyword">int</span> status = ToolRunner.run(conf, <span class="keyword">new</span> Fruit2FruitMRRunner(), args);</span><br><span class="line">    System.exit(status);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>实现将 HDFS 中的数据写入到 Hbase 表中。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReadFruitFromHDFSMapper</span> <span class="keyword">extends</span> <span class="title">Mapper</span>&lt;<span class="title">LongWritable</span>, <span class="title">Text</span>, <span class="title">ImmutableBytesWritable</span>, <span class="title">Put</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(LongWritable key, Text value, Context context)</span> </span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">// 从 HDFS 中读取的数据</span></span><br><span class="line">        String lineValue = value.toString();</span><br><span class="line">        <span class="comment">// 读取出来的每行数据使用 \t 进行分割，存于 String 数组</span></span><br><span class="line">        String[] values = lineValue.split(<span class="string">"\t"</span>);</span><br><span class="line">        <span class="comment">// 根据数据中值的含义取值</span></span><br><span class="line">        String rowKey = values[<span class="number">0</span>];</span><br><span class="line">        String name = values[<span class="number">1</span>];</span><br><span class="line">        String color = values[<span class="number">2</span>];</span><br><span class="line">        <span class="comment">// 初始化 rowKey</span></span><br><span class="line">        ImmutableBytesWritable rowKeyWritable = <span class="keyword">new</span></span><br><span class="line">            ImmutableBytesWritable(Bytes.toBytes(rowKey));</span><br><span class="line">        <span class="comment">// 初始化 put 对象</span></span><br><span class="line">        Put put = <span class="keyword">new</span> Put(Bytes.toBytes(rowKey));</span><br><span class="line">        <span class="comment">// 参数分别 列族、列、值</span></span><br><span class="line">        put.add(Bytes.toBytes(<span class="string">"info"</span>), Bytes.toBytes(<span class="string">"name"</span>), Bytes.toBytes(name));</span><br><span class="line">        put.add(Bytes.toBytes(<span class="string">"info"</span>), Bytes.toBytes(<span class="string">"color"</span>),Bytes.toBytes(color));</span><br><span class="line"></span><br><span class="line">        context.write(rowKeyWritable, put);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WriteFruitMRFromTxtReducer</span> <span class="keyword">extends</span> </span></span><br><span class="line"><span class="class">    <span class="title">TableReducer</span>&lt;<span class="title">ImmutableBytesWritable</span>, <span class="title">Put</span>, <span class="title">NullWritable</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">reduce</span><span class="params">(ImmutableBytesWritable key, Iterable&lt;Put&gt; values, Context context)</span> </span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> IOException, InterruptedException</span>&#123;</span><br><span class="line">        <span class="comment">// 读出来的每一行数据写入到 fruit_hdfs 表中</span></span><br><span class="line">        <span class="keyword">for</span>(Put put: values)&#123;</span><br><span class="line">            context.write(NullWritable.get(), put);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Txt2FruitRunner</span> <span class="keyword">extends</span> <span class="title">Configured</span> <span class="keyword">implements</span> <span class="title">Tool</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">run</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// 得到 Configuration</span></span><br><span class="line">        Configuration conf = <span class="keyword">this</span>.getConf();</span><br><span class="line">        <span class="comment">// 创建 Job 任务</span></span><br><span class="line">        Job job = Job.getInstance(conf, <span class="keyword">this</span>.getClass().getSimpleName());</span><br><span class="line">        job.setJarByClass(Txt2FruitRunner<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        Path inPath = <span class="keyword">new</span> Path(<span class="string">"hdfs://hadoop102:9000/input_fruit/fruit.tsv"</span>);</span><br><span class="line">        FileInputFormat.addInputPath(job, inPath);</span><br><span class="line">        <span class="comment">// 设置 Mapper</span></span><br><span class="line">        job.setMapperClass(ReadFruitFromHDFSMapper<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setMapOutputKeyClass(ImmutableBytesWritable<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setMapOutputValueClass(Put<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        <span class="comment">// 设置 Reducer</span></span><br><span class="line">        TableMapReduceUtil.initTableReducerJob(<span class="string">"fruit_mr"</span>, WriteFruitMRFromTxtReducer<span class="class">.<span class="keyword">class</span>, <span class="title">job</span>)</span>;</span><br><span class="line">        <span class="comment">// 设置 Reduce 数量，最少 1 个</span></span><br><span class="line">        job.setNumReduceTasks(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">boolean</span> isSuccess = job.waitForCompletion(<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">if</span>(!isSuccess)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IOException(<span class="string">"Job running with error"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> isSuccess ? <span class="number">0</span> : <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="集成-Hive"><a href="#集成-Hive" class="headerlink" title="集成 Hive"></a>集成 Hive</h3><blockquote>
<p>操作 Hive 的同时对 HBase 也会产生影响，所以 Hive 需要持有操作 HBase 的 Jar。</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 这里使用软链接的方式引包</span></span><br><span class="line">export HBASE_HOME=/opt/module/hbase</span><br><span class="line">export HIVE_HOME=/opt/module/hive</span><br><span class="line">ln -s $HBASE_HOME/lib/hbase-common-1.3.1.jar $HIVE_HOME/lib/hbase-common-1.3.1.jar</span><br><span class="line">ln -s $HBASE_HOME/lib/hbase-server-1.3.1.jar $HIVE_HOME/lib/hbaseserver-1.3.1.jar</span><br><span class="line">ln -s $HBASE_HOME/lib/hbase-client-1.3.1.jar $HIVE_HOME/lib/hbase-client-1.3.1.jar</span><br><span class="line">ln -s $HBASE_HOME/lib/hbase-protocol-1.3.1.jar $HIVE_HOME/lib/hbase-protocol-1.3.1.jar</span><br><span class="line">ln -s $HBASE_HOME/lib/hbase-it-1.3.1.jar $HIVE_HOME/lib/hbase-it1.3.1.jar</span><br><span class="line">ln -s $HBASE_HOME/lib/htrace-core-3.1.0-incubating.jar $HIVE_HOME/lib/htrace-core-3.1.0-incubating.jar</span><br><span class="line">ln -s $HBASE_HOME/lib/hbase-hadoop2-compat-1.3.1.jar $HIVE_HOME/lib/hbase-hadoop2-compat-1.3.1.jar</span><br><span class="line">ln -s $HBASE_HOME/lib/hbase-hadoop-compat-1.3.1.jar $HIVE_HOME/lib/hbase-hadoop-compat-1.3.1.jar</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 修改 hive-site.xml --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.zookeeper.quorum<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop102,hadoop103,hadoop104<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>The list of ZooKeeper servers to talk to. This is</span><br><span class="line">        only needed for read/write locks.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.zookeeper.client.port<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>2181<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>The port of ZooKeeper servers to talk to. This is</span><br><span class="line">        only needed for read/write locks.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 在 Hive 中创建表同时关联 HBase</span></span><br><span class="line">CREATE TABLE hive_hbase_emp_table(</span><br><span class="line">    empno int,</span><br><span class="line">    ename string,</span><br><span class="line">    job string,</span><br><span class="line">    mgr int,</span><br><span class="line">    hiredate string,</span><br><span class="line">    sal double,</span><br><span class="line">    comm double,</span><br><span class="line">    deptno int</span><br><span class="line">)</span><br><span class="line">STORED BY 'org.apache.hadoop.hive.hbase.HBaseStorageHandler'</span><br><span class="line">WITH SERDEPROPERTIES ("hbase.columns.mapping" = </span><br><span class="line">":key, info:ename, info:job, info:mgr,i nfo:hiredate,i nfo:sal, info:comm, info:deptno")</span><br><span class="line">TBLPROPERTIES ("hbase.table.name" = "hbase_emp_table");</span><br><span class="line"><span class="meta">#</span><span class="bash"> 完成之后，可以分别进入 Hive 和 HBase 查看，都生成了对应的表</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 不能将数据直接 load 进 Hive 所关联 HBase 的那张表中</span></span><br><span class="line">CREATE TABLE emp(</span><br><span class="line">    empno int,</span><br><span class="line">    ename string,</span><br><span class="line">    job string,</span><br><span class="line">    mgr int,</span><br><span class="line">    hiredate string,</span><br><span class="line">    sal double,</span><br><span class="line">    comm double,</span><br><span class="line">    deptno int</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by '\t';</span><br><span class="line"><span class="meta">#</span><span class="bash"> 向 Hive 中间表中 load 数据</span></span><br><span class="line">load data local inpath '/home/admin/softwares/data/emp.txt' into table emp;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 通过 insert 命令将中间表中的数据导入到 Hive 关联 Hbase 的那张表中</span></span><br><span class="line">insert into table hive_hbase_emp_table select * from emp;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看 Hive 以及关联的 HBase 表中是否已经成功的同步插入了数据</span></span><br><span class="line">select * from hive_hbase_emp_table;</span><br><span class="line">scan ‘hbase_emp_table’</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在 HBase 中已经存储了某一张表 hbase_emp_table，然后在 Hive 中创建一个外部表来关联 HBase 中的 hbase_emp_table 这张表，使之可以借助 Hive 来分析 HBase 这张表中的数据。</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">CREATE EXTERNAL TABLE relevance_hbase_emp(</span><br><span class="line">    empno int,</span><br><span class="line">    ename string,</span><br><span class="line">    job string,</span><br><span class="line">    mgr int,</span><br><span class="line">    hiredate string,</span><br><span class="line">    sal double,</span><br><span class="line">    comm double,</span><br><span class="line">    deptno int</span><br><span class="line">)</span><br><span class="line">STORED BY 'org.apache.hadoop.hive.hbase.HBaseStorageHandler'</span><br><span class="line">WITH SERDEPROPERTIES ("hbase.columns.mapping" =</span><br><span class="line">":key, info:ename, info:job, info:mgr, info:hiredate, info:sal, info:comm, info:deptno")</span><br><span class="line">TBLPROPERTIES ("hbase.table.name" = "hbase_emp_table");</span><br><span class="line"><span class="meta">#</span><span class="bash"> 关联后就可以使用 Hive 函数进行一些分析操作了</span></span><br><span class="line"> select * from relevance_hbase_emp;</span><br></pre></td></tr></table></figure>



<h3 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h3><h4 id="高可用"><a href="#高可用" class="headerlink" title="高可用"></a>高可用</h4><p>在 HBase 中 HMaster 负责监控 HRegionServer 的生命周期，均衡 RegionServer 的负载， 如果 HMaster 挂掉了，那么整个 HBase 集群将陷入不健康的状态，并且此时的工作状态并 不会维持太久。所以 HBase 支持对 HMaster 的高可用配置。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 关闭 HBase 集群</span></span><br><span class="line"> bin/stop-hbase.sh</span><br><span class="line"><span class="meta">#</span><span class="bash"> 在 conf 目录下创建 backup-masters 文件</span></span><br><span class="line">touch conf/backup-masters</span><br><span class="line"><span class="meta">#</span><span class="bash"> 在 backup-masters 文件中配置高可用 HMaster 节点</span></span><br><span class="line">echo hadoop103 &gt; conf/backup-master</span><br><span class="line"><span class="meta">#</span><span class="bash"> 将整个 conf 目录 scp 到其他节点</span></span><br><span class="line">scp -r conf/ hadoop103:/opt/module/hbase/</span><br><span class="line">scp -r conf/ hadoop104:/opt/module/hbase/</span><br></pre></td></tr></table></figure>

<h4 id="预分区"><a href="#预分区" class="headerlink" title="预分区"></a>预分区</h4><p>每一个 region 维护着 StartRow 与 EndRow，如果加入的数据符合某个 Region 维护的 RowKey 范围，则该数据交给这个 Region 维护。那么依照这个原则，我们可以将数据所要投放的分区提前大致的规划好，以提高 HBase 性能。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 手动设定预分区</span></span><br><span class="line">create 'staff1','info','partition1',SPLITS =&gt; ['1000','2000','3000','4000']</span><br><span class="line"><span class="meta">#</span><span class="bash"> 生成 16 进制序列预分区</span></span><br><span class="line">create 'staff2','info','partition2',&#123;NUMREGIONS =&gt; 15, SPLITALGO =&gt; 'HexStringSplit'&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 按照文件中设置的规则预分区</span></span><br><span class="line">create 'staff3','partition3',SPLITS_FILE =&gt; 'splits.txt'</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java API</span></span><br><span class="line"><span class="comment">// 自定义算法，产生一系列 hash 散列值存储在二维数组中</span></span><br><span class="line"><span class="keyword">byte</span>[][] splitKeys = 某个散列值函数</span><br><span class="line"><span class="comment">// 创建 HbaseAdmin 实例</span></span><br><span class="line">HBaseAdmin hAdmin = <span class="keyword">new</span> HBaseAdmin(HbaseConfiguration.create());</span><br><span class="line"><span class="comment">// 创建 HTableDescriptor 实例</span></span><br><span class="line">HTableDescriptor tableDesc = <span class="keyword">new</span> HTableDescriptor(tableName);</span><br><span class="line"><span class="comment">// 通过 HTableDescriptor 实例和散列值二维数组创建带有预分区的 Hbase 表</span></span><br><span class="line">hAdmin.createTable(tableDesc, splitKeys);</span><br></pre></td></tr></table></figure>

<h4 id="RowKey"><a href="#RowKey" class="headerlink" title="RowKey"></a>RowKey</h4><p>一条数据的唯一标识就是 RowKey，那么这条数据存储于哪个分区，取决于 RowKey 处于哪个一个预分区的区间内，设计 RowKey 的主要目的 ，就是让数据均匀的分布于所有的 region 中，在一定程度上防止数据倾斜。</p>
<p>HASH，在做此操作之前，一般我们会选择从数据集中抽取样本，来决定什么样的 rowKey 来 Hash 后作为每个分区的临界值。</p>
<h4 id="内存优化"><a href="#内存优化" class="headerlink" title="内存优化"></a>内存优化</h4><p>HBase 操作过程中需要大量的内存开销，毕竟 Table 是可以缓存在内存中的，一般会分配整个可用内存的 70%给 HBase 的 Java 堆。但是不建议分配非常大的堆内存，因为 GC  程持续太久会导致 RegionServer 处于长期不可用状态，一般 16~48G 内存就可以了，如果因为框架占用内存过高导致系统内存不足，框架一样会被系统服务拖死。</p>
<ul>
<li><p>属性：dfs.support.append<br>解释：开启 HDFS 追加同步，可以优秀的配合 HBase 的数据同步和持久化。<br>默认值为 true。</p>
</li>
<li><p>属性：dfs.datanode.max.transfer.threads<br>解释：HBase 一般都会同一时间操作大量的文件，根据集群的数量和规模以及数据动作， 设置为 4096 或者更高。<br>默认值：4096</p>
</li>
<li><p>属性：dfs.image.transfer.timeout<br>解释：如果对于某一次数据操作来讲，延迟非常高，socket 需要等待更长的时间，建议把该值设置为更大的值（默认 60000 毫秒），以确保 socket 不会被 timeout 掉。</p>
</li>
<li><p>属性：mapreduce.map.output.compress mapreduce.map.output.compress.codec<br>解释：开启这两个数据可以大大提高文件的写入效率，减少写入时间。第一个属性值修改为 true，第二个属性值修改为：org.apache.hadoop.io.compress.GzipCodec 或者其他压缩方式。</p>
</li>
<li><p>属性：Hbase.regionserver.handler.count<br>解释：默认值为 30，用于指定 RPC 监听的数量，可以根据客户端的请求数进行调整，读写请求较多时，增加此值。</p>
</li>
<li><p>属性：hbase.hregion.max.filesize<br>解释：默认值 10737418240（10GB），如果需要运行 HBase 的 MR 任务，可以减小此值， 因为一个 region 对应一个 map 任务，如果单个 region 过大，会导致 map 任务执行时间过长。该值的意思就是，如果 HFile 的大小达到这个数值，则这个 region 会被切分为两个 Hfile。</p>
</li>
<li><p>属性：hbase.client.write.buffer<br>解释：用于指定 Hbase 客户端缓存，增大该值可以减少 RPC 调用次数，但是会消耗更多内存，反之则反之。一般我们需要设定一定的缓存大小，以达到减少 RPC 次数的目的。</p>
</li>
<li><p>属性：hbase.client.scanner.caching<br>解释：用于指定 scan.next 方法获取的默认行数，值越大，消耗内存越大。</p>
</li>
</ul>
<p>flush、compact、split 机制</p>
<p>当 MemStore 达到阈值，将 Memstore 中的数据 Flush 进 Storefile；compact 机制则是把 flush 出来的小文件合并成大的 Storefile 文件。split 则是当 Region 达到阈值，会把过大的 Region 一分为二。</p>
<ul>
<li><p>hbase.hregion.memstore.flush.size：134217728</p>
<p>这个参数的作用是当单个 HRegion 内所有的 Memstore 大小总和超过指定值时，flush 该 HRegion 的所有 memstore。RegionServer 的 flush 是通过将请求添加一个队列，模拟生 产消费模型来异步处理的。那这里就有一个问题，当队列来不及消费，产生大量积压请求 时，可能会导致内存陡增，最坏的情况是触发 OOM</p>
</li>
<li><p>hbase.regionserver.global.memstore.upperLimit：0.4<br>hbase.regionserver.global.memstore.lowerLimit：0.38<br>当 MemStore 使用内存总量达到hbase.regionserver.global.memstore.upperLimit 指定值时，将会有多个 MemStores flush 到文件中，MemStore flush 顺序是按照大小降序执行的，直到刷新到 MemStore 使用内存略小于 lowerLimit</p>
</li>
</ul>
<h3 id="项目实战"><a href="#项目实战" class="headerlink" title="项目实战"></a>项目实战</h3><blockquote>
<p>微博内容的浏览，数据库表设计；<br>用户社交体现：关注用户，取关用户；<br>拉取关注的人的微博内容。</p>
</blockquote>
<h4 id="表的创建"><a href="#表的创建" class="headerlink" title="表的创建"></a>表的创建</h4><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://welab-wingo.gitee.io/image/2020/05/HBase/HBase09.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建命名空间以及表名的定义</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取配置 conf</span></span><br><span class="line"><span class="keyword">private</span> Configuration conf = HbaseConfiguration.create();</span><br><span class="line"><span class="comment">// 微博内容表的表名</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">byte</span>[] TABLE_CONTENT = Bytes.toBytes(<span class="string">"weibo:content"</span>);</span><br><span class="line"><span class="comment">// 用户关系表的表名</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">byte</span>[] TABLE_RELATIONS = Bytes.toBytes(<span class="string">"weibo:relations"</span>);</span><br><span class="line"><span class="comment">// 微博收件箱表的表名</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">byte</span>[] TABLE_RECEIVE_CONTENT_EMAIL = </span><br><span class="line">    Bytes.toBytes(<span class="string">"weibo:receive_content_email"</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initNamespace</span><span class="params">()</span></span>&#123;</span><br><span class="line">    HbaseAdmin admin = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        admin = <span class="keyword">new</span> HbaseAdmin(conf);</span><br><span class="line">        <span class="comment">// 命名空间类似于关系型数据库中的 schema，可以想象成文件夹</span></span><br><span class="line">        NamespaceDescriptor weibo = NamespaceDescriptor</span><br><span class="line">            .create(<span class="string">"weibo"</span>)</span><br><span class="line">            .addConfiguration(<span class="string">"creator"</span>, <span class="string">"wingo"</span>)</span><br><span class="line">            .addConfiguration(<span class="string">"create_time"</span>, System.currentTimeMillis() + <span class="string">""</span>)</span><br><span class="line">            .build();</span><br><span class="line">        admin.createNamespace(weibo);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (MasterNotRunningException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ZooKeeperConnectionException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span> != admin)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                admin.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建微博内容表</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 表结构</span></span><br><span class="line"><span class="comment">Table Name 		weibo:content</span></span><br><span class="line"><span class="comment">RowKey			用户 ID_时间戳</span></span><br><span class="line"><span class="comment">ColumnFamily 	info</span></span><br><span class="line"><span class="comment">ColumnLabel 	内容</span></span><br><span class="line"><span class="comment">Version 		1 个版本</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createTableContent</span><span class="params">()</span></span>&#123;</span><br><span class="line">    HbaseAdmin admin = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        admin = <span class="keyword">new</span> HbaseAdmin(conf);</span><br><span class="line">        <span class="comment">// 创建表表述</span></span><br><span class="line">        HTableDescriptor content = <span class="keyword">new</span> HTableDescriptor(TableName.valueOf(TABLE_CONTENT));</span><br><span class="line">        <span class="comment">// 创建列族描述</span></span><br><span class="line">        HColumnDescriptor info = <span class="keyword">new</span> HColumnDescriptor(Bytes.toBytes(<span class="string">"info"</span>));</span><br><span class="line">        <span class="comment">// 设置块缓存</span></span><br><span class="line">        info.setBlockCacheEnabled(<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">// 设置块缓存大小</span></span><br><span class="line">        info.setBlocksize(<span class="number">2097152</span>);</span><br><span class="line">        <span class="comment">// 设置压缩方式</span></span><br><span class="line">        <span class="comment">// info.setCompressionType(Algorithm.SNAPPY);</span></span><br><span class="line">        <span class="comment">// 设置版本数量</span></span><br><span class="line">        info.setMaxVersions(<span class="number">1</span>);</span><br><span class="line">        info.setMinVersions(<span class="number">1</span>);</span><br><span class="line">        content.addFamily(info);</span><br><span class="line">        admin.createTable(content);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (MasterNotRunningException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ZooKeeperConnectionException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span> != admin)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                admin.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建用户关系表</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 表结构</span></span><br><span class="line"><span class="comment">Table Name 		weibo:relations</span></span><br><span class="line"><span class="comment">RowKey 			用户 ID</span></span><br><span class="line"><span class="comment">ColumnFamily 	attends、fans</span></span><br><span class="line"><span class="comment">ColumnLabel 	关注用户 ID，粉丝用户 ID</span></span><br><span class="line"><span class="comment">ColumnValue 	用户 ID</span></span><br><span class="line"><span class="comment">Version 		1 个版本</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createTableRelations</span><span class="params">()</span></span>&#123;</span><br><span class="line">    HbaseAdmin admin = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        admin = <span class="keyword">new</span> HbaseAdmin(conf);</span><br><span class="line">        HTableDescriptor relations = <span class="keyword">new</span> HTableDescriptor(TableName.valueOf(TABLE_RELATIONS));</span><br><span class="line">        HColumnDescriptor attends = <span class="keyword">new</span> HColumnDescriptor(Bytes.toBytes(<span class="string">"attends"</span>));</span><br><span class="line">        attends.setBlockCacheEnabled(<span class="keyword">true</span>);</span><br><span class="line">        attends.setBlocksize(<span class="number">2097152</span>);</span><br><span class="line">        attends.setMaxVersions(<span class="number">1</span>);</span><br><span class="line">        attends.setMinVersions(<span class="number">1</span>);</span><br><span class="line">        HColumnDescriptor fans = <span class="keyword">new</span> HColumnDescriptor(Bytes.toBytes(<span class="string">"fans"</span>));</span><br><span class="line">        fans.setBlockCacheEnabled(<span class="keyword">true</span>);</span><br><span class="line">        fans.setBlocksize(<span class="number">2097152</span>);</span><br><span class="line">        fans.setMaxVersions(<span class="number">1</span>);</span><br><span class="line">        fans.setMinVersions(<span class="number">1</span>);</span><br><span class="line">        relations.addFamily(attends);</span><br><span class="line">        relations.addFamily(fans);</span><br><span class="line">        admin.createTable(relations);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (MasterNotRunningException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ZooKeeperConnectionException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span> != admin)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                admin.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建微博收件箱表</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 表结构</span></span><br><span class="line"><span class="comment">Table Name 		weibo:receive_content_email</span></span><br><span class="line"><span class="comment">RowKey 			用户 ID</span></span><br><span class="line"><span class="comment">ColumnFamily 	info</span></span><br><span class="line"><span class="comment">ColumnLabel 	用户 ID</span></span><br><span class="line"><span class="comment">ColumnValue 	取微博内容的 RowKey</span></span><br><span class="line"><span class="comment">Version 		1000</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createTableReceiveContentEmail</span><span class="params">()</span></span>&#123;</span><br><span class="line">    HbaseAdmin admin = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        admin = <span class="keyword">new</span> HbaseAdmin(conf);</span><br><span class="line">        HTableDescriptor receive_content_email = <span class="keyword">new</span> </span><br><span class="line">            HTableDescriptor(TableName.valueOf(TABLE_RECEIVE_CONTENT_EMAIL));</span><br><span class="line">        HColumnDescriptor info = <span class="keyword">new</span> HColumnDescriptor(Bytes.toBytes(<span class="string">"info"</span>));</span><br><span class="line">        info.setBlockCacheEnabled(<span class="keyword">true</span>);</span><br><span class="line">        info.setBlocksize(<span class="number">2097152</span>);</span><br><span class="line">        info.setMaxVersions(<span class="number">1000</span>);</span><br><span class="line">        info.setMinVersions(<span class="number">1000</span>);</span><br><span class="line">        receive_content_email.addFamily(info);;</span><br><span class="line">        admin.createTable(receive_content_email);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (MasterNotRunningException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ZooKeeperConnectionException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span> != admin)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                admin.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="功能实现"><a href="#功能实现" class="headerlink" title="功能实现"></a>功能实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">微博内容表中添加 1 条数据</span></span><br><span class="line"><span class="comment">微博收件箱表对所有粉丝用户添加数据：微博内容的 RowKey</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Message</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String uid;</span><br><span class="line">    <span class="keyword">private</span> String timestamp;</span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> uid;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUid</span><span class="params">(String uid)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.uid = uid;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTimestamp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> timestamp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTimestamp</span><span class="params">(String timestamp)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.timestamp = timestamp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getContent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> content;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setContent</span><span class="params">(String content)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.content = content;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Message [uid="</span> + uid + <span class="string">", timestamp="</span> + timestamp +</span><br><span class="line">            <span class="string">", content="</span> + content + <span class="string">"]"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">publishContent</span><span class="params">(String uid, String content)</span></span>&#123;</span><br><span class="line">    HConnection connection = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        connection = HConnectionManager.createConnection(conf);</span><br><span class="line">        <span class="comment">// 微博内容表中添加 1 条数据，首先获取微博内容表描述</span></span><br><span class="line">        HTableInterface contentTBL = connection.getTable(TableName.valueOf(TABLE_CONTENT));</span><br><span class="line">        <span class="comment">// 组装 Rowkey</span></span><br><span class="line">        <span class="keyword">long</span> timestamp = System.currentTimeMillis();</span><br><span class="line">        String rowKey = uid + <span class="string">"_"</span> + timestamp;</span><br><span class="line">        Put put = <span class="keyword">new</span> Put(Bytes.toBytes(rowKey));</span><br><span class="line">        put.add(Bytes.toBytes(<span class="string">"info"</span>), Bytes.toBytes(<span class="string">"content"</span>), timestamp, Bytes.toBytes(content));</span><br><span class="line">        contentTBL.put(put);</span><br><span class="line">        <span class="comment">// 向微博收件箱表中加入发布的 Rowkey</span></span><br><span class="line">        <span class="comment">// 查询用户关系表，得到当前用户有哪些粉丝</span></span><br><span class="line">        HTableInterface relationsTBL = connection.getTable(TableName.valueOf(TABLE_RELATIONS));</span><br><span class="line">        <span class="comment">// 取出目标数据</span></span><br><span class="line">        Get get = <span class="keyword">new</span> Get(Bytes.toBytes(uid));</span><br><span class="line">        <span class="comment">// 指定取出的目标数据的值</span></span><br><span class="line">        get.addFamily(Bytes.toBytes(<span class="string">"fans"</span>));</span><br><span class="line">        Result result = relationsTBL.get(get);</span><br><span class="line">        <span class="comment">// 初始化一个二进制数组用于存放数据</span></span><br><span class="line">        List&lt;<span class="keyword">byte</span>[]&gt; fans = <span class="keyword">new</span> ArrayList&lt;<span class="keyword">byte</span>[]&gt;();</span><br><span class="line">        <span class="comment">// 遍历取出当前发布微博的用户的所有粉丝数据</span></span><br><span class="line">        <span class="keyword">for</span>(Cell cell : result.rawCells())&#123;</span><br><span class="line">            fans.add(CellUtil.cloneQualifier(cell));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 如果该用户没有粉丝，则直接 return</span></span><br><span class="line">        <span class="keyword">if</span>(fans.size() &lt;= <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">        <span class="comment">// 开始操作收件箱表</span></span><br><span class="line">        HTableInterface recTBL = connection.getTable(TableName.valueOf(TABLE_RECEIVE_CONTENT_EMAIL));</span><br><span class="line">        List&lt;Put&gt; puts = <span class="keyword">new</span> ArrayList&lt;Put&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">byte</span>[] fan : fans)&#123;</span><br><span class="line">            Put fanPut = <span class="keyword">new</span> Put(fan);</span><br><span class="line">            fanPut.add(Bytes.toBytes(<span class="string">"info"</span>), Bytes.toBytes(uid), timestamp, Bytes.toBytes(rowKey));</span><br><span class="line">            puts.add(fanPut);</span><br><span class="line">        &#125;</span><br><span class="line">        recTBL.put(puts);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span> != connection)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                connection.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>添加关注用户</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">在微博用户关系表中，对当前主动操作的用户添加新关注的好友</span></span><br><span class="line"><span class="comment">在微博用户关系表中，对被关注的用户添加新的粉丝</span></span><br><span class="line"><span class="comment">微博收件箱表中添加所关注的用户发布的微博</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addAttends</span><span class="params">(String uid, String... attends)</span></span>&#123;</span><br><span class="line">    <span class="comment">// 参数过滤</span></span><br><span class="line">    <span class="keyword">if</span>(attends == <span class="keyword">null</span> || attends.length &lt;= <span class="number">0</span> || uid == <span class="keyword">null</span> || uid.length() &lt;= <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    HConnection connection = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        connection = HConnectionManager.createConnection(conf);</span><br><span class="line">        <span class="comment">// 用户关系表操作对象（连接到用户关系表）</span></span><br><span class="line">        HTableInterface relationsTBL = connection.getTable(TableName.valueOf(TABLE_RELATIONS));</span><br><span class="line">        List&lt;Put&gt; puts = <span class="keyword">new</span> ArrayList&lt;Put&gt;();</span><br><span class="line">        <span class="comment">// 在微博用户关系表中，添加新关注的好友</span></span><br><span class="line">        Put attendPut = <span class="keyword">new</span> Put(Bytes.toBytes(uid));</span><br><span class="line">        <span class="keyword">for</span>(String attend : attends)&#123;</span><br><span class="line">            <span class="comment">// 为当前用户添加关注的人</span></span><br><span class="line">            attendPut.add(Bytes.toBytes(<span class="string">"attends"</span>), Bytes.toBytes(attend), Bytes.toBytes(attend));</span><br><span class="line">            <span class="comment">// 为被关注的人，添加粉丝</span></span><br><span class="line">            Put fansPut = <span class="keyword">new</span> Put(Bytes.toBytes(attend));</span><br><span class="line">            fansPut.add(Bytes.toBytes(<span class="string">"fans"</span>), Bytes.toBytes(uid), Bytes.toBytes(uid));</span><br><span class="line">            <span class="comment">// 将所有关注的人一个一个的添加到 puts（List）集合中</span></span><br><span class="line">            puts.add(fansPut);</span><br><span class="line">        &#125;</span><br><span class="line">        puts.add(attendPut);</span><br><span class="line">        relationsTBL.put(puts);</span><br><span class="line">        <span class="comment">// 微博收件箱添加关注的用户发布的微博内容（content）的 rowkey</span></span><br><span class="line">        HTableInterface contentTBL = connection.getTable(TableName.valueOf(TABLE_CONTENT));</span><br><span class="line">        Scan scan = <span class="keyword">new</span> Scan();</span><br><span class="line">        <span class="comment">// 用于存放取出来的关注的人所发布的微博的 rowkey</span></span><br><span class="line">        List&lt;<span class="keyword">byte</span>[]&gt; rowkeys = <span class="keyword">new</span> ArrayList&lt;<span class="keyword">byte</span>[]&gt;();</span><br><span class="line">        <span class="keyword">for</span>(String attend : attends)&#123;</span><br><span class="line">            <span class="comment">// 过滤扫描 rowkey，即：前置位匹配被关注的人的 uid_</span></span><br><span class="line">            RowFilter filter = <span class="keyword">new</span> RowFilter</span><br><span class="line">                (CompareFilter.CompareOp.EQUAL, <span class="keyword">new</span> SubstringComparator(attend + <span class="string">"_"</span>));</span><br><span class="line">            <span class="comment">// 为扫描对象指定过滤规则</span></span><br><span class="line">            scan.setFilter(filter);</span><br><span class="line">            <span class="comment">// 通过扫描对象得到 scanner</span></span><br><span class="line">            ResultScanner result = contentTBL.getScanner(scan);</span><br><span class="line">            <span class="comment">// 迭代器遍历扫描出来的结果集</span></span><br><span class="line">            Iterator&lt;Result&gt; iterator = result.iterator();</span><br><span class="line">            <span class="keyword">while</span>(iterator.hasNext())&#123;</span><br><span class="line">                <span class="comment">// 取出每一个符合扫描结果的那一行数据</span></span><br><span class="line">                Result r = iterator.next();</span><br><span class="line">                <span class="keyword">for</span>(Cell cell : r.rawCells())&#123;</span><br><span class="line">                    <span class="comment">// 将得到的 rowkey 放置于集合容器中</span></span><br><span class="line">                    rowkeys.add(CellUtil.cloneRow(cell));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 将取出的微博 rowkey 放置于当前操作用户的收件箱中</span></span><br><span class="line">        <span class="keyword">if</span>(rowkeys.size() &lt;= <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">        <span class="comment">// 得到微博收件箱表的操作对象</span></span><br><span class="line">        HTableInterface recTBL =connection.getTable(TableName.valueOf(TABLE_RECEIVE_CONTENT_EMAIL));</span><br><span class="line">        <span class="comment">// 用于存放多个关注的用户的发布的多条微博 rowkey 信息</span></span><br><span class="line">        List&lt;Put&gt; recPuts = <span class="keyword">new</span> ArrayList&lt;Put&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">byte</span>[] rk : rowkeys)&#123;</span><br><span class="line">            Put put = <span class="keyword">new</span> Put(Bytes.toBytes(uid));</span><br><span class="line">            <span class="comment">// uid_timestamp</span></span><br><span class="line">            String rowKey = Bytes.toString(rk);</span><br><span class="line">            <span class="comment">// 截取 uid</span></span><br><span class="line">            String attendUID = rowKey.substring(<span class="number">0</span>, rowKey.indexOf(<span class="string">"_"</span>));</span><br><span class="line">            <span class="keyword">long</span> timestamp = Long.parseLong(rowKey.substring(rowKey.indexOf(<span class="string">"_"</span>) + <span class="number">1</span>));</span><br><span class="line">            <span class="comment">// 将微博 rowkey 添加到指定单元格中</span></span><br><span class="line">            put.add(Bytes.toBytes(<span class="string">"info"</span>), Bytes.toBytes(attendUID), timestamp, rk);</span><br><span class="line">            recPuts.add(put);</span><br><span class="line">        &#125;</span><br><span class="line">        recTBL.put(recPuts);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span> != connection)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                connection.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>取关用户</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 即关注用户的反向操作</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeAttends</span><span class="params">(String uid, String... attends)</span></span>&#123;</span><br><span class="line">    <span class="comment">// 过滤数据</span></span><br><span class="line">    <span class="keyword">if</span>(uid == <span class="keyword">null</span> || uid.length() &lt;= <span class="number">0</span> || attends == <span class="keyword">null</span> || attends.length &lt;= <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">    HConnection connection = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        connection = HConnectionManager.createConnection(conf);</span><br><span class="line">        <span class="comment">// 在微博用户关系表中，删除已关注的好友</span></span><br><span class="line">        HTableInterface relationsTBL = connection.getTable(TableName.valueOf(TABLE_RELATIONS));</span><br><span class="line">        <span class="comment">// 待删除的用户关系表中的所有数据</span></span><br><span class="line">        List&lt;Delete&gt; deletes = <span class="keyword">new</span> ArrayList&lt;Delete&gt;();</span><br><span class="line">        <span class="comment">// 当前取关操作者的 uid 对应的 Delete 对象</span></span><br><span class="line">        Delete attendDelete = <span class="keyword">new</span> Delete(Bytes.toBytes(uid));</span><br><span class="line">        <span class="comment">// 遍历取关，同时每次取关都要将被取关的人的粉丝 -1</span></span><br><span class="line">        <span class="keyword">for</span>(String attend : attends)&#123;</span><br><span class="line">            attendDelete.deleteColumn(Bytes.toBytes(<span class="string">"attends"</span>), Bytes.toBytes(attend));</span><br><span class="line">            Delete fansDelete = <span class="keyword">new</span> Delete(Bytes.toBytes(attend));</span><br><span class="line">            fansDelete.deleteColumn(Bytes.toBytes(<span class="string">"fans"</span>), Bytes.toBytes(uid));</span><br><span class="line">            deletes.add(fansDelete);</span><br><span class="line">        &#125;</span><br><span class="line">        deletes.add(attendDelete);</span><br><span class="line">        relationsTBL.delete(deletes);</span><br><span class="line">        <span class="comment">//  收件箱表中删除取关的人的微博 rowkey</span></span><br><span class="line">        HTableInterface recTBL = connection.getTable(TableName.valueOf(TABLE_RECEIVE_CONTENT_EMAIL));</span><br><span class="line">        Delete recDelete = <span class="keyword">new</span> Delete(Bytes.toBytes(uid));</span><br><span class="line">        <span class="keyword">for</span>(String attend : attends)&#123;</span><br><span class="line">            recDelete.deleteColumn(Bytes.toBytes(<span class="string">"info"</span>), Bytes.toBytes(attend));</span><br><span class="line">        &#125;</span><br><span class="line">        recTBL.delete(recDelete);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>获取关注的人的微博内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 即通过微博收件箱中的 RowKey 获取对应的微博内容</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Message&gt; <span class="title">getAttendsContent</span><span class="params">(String uid)</span></span>&#123;</span><br><span class="line">    HConnection connection = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        connection = HConnectionManager.createConnection(conf);</span><br><span class="line">        HTableInterface recTBL = connection.getTable(TableName.valueOf(TABLE_RECEIVE_CONTENT_EMAIL));</span><br><span class="line">        <span class="comment">// 从收件箱中取得微博 rowKey</span></span><br><span class="line">        Get get = <span class="keyword">new</span> Get(Bytes.toBytes(uid));</span><br><span class="line">        <span class="comment">// 设置最大版本号</span></span><br><span class="line">        get.setMaxVersions(<span class="number">5</span>);</span><br><span class="line">        List&lt;<span class="keyword">byte</span>[]&gt; rowkeys = <span class="keyword">new</span> ArrayList&lt;<span class="keyword">byte</span>[]&gt;();</span><br><span class="line">        Result result = recTBL.get(get);</span><br><span class="line">        <span class="keyword">for</span>(Cell cell : result.rawCells())&#123;</span><br><span class="line">            rowkeys.add(CellUtil.cloneValue(cell));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 根据取出的所有 rowkey 去微博内容表中检索数据</span></span><br><span class="line">        HTableInterface contentTBL = connection.getTable(TableName.valueOf(TABLE_CONTENT));</span><br><span class="line">        List&lt;Get&gt; gets = <span class="keyword">new</span> ArrayList&lt;Get&gt;();</span><br><span class="line">        <span class="comment">// 根据 rowkey 取出对应微博的具体内容</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">byte</span>[] rk : rowkeys)&#123;</span><br><span class="line">            Get g = <span class="keyword">new</span> Get(rk);</span><br><span class="line">            gets.add(g);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 得到所有的微博内容的 result 对象</span></span><br><span class="line">        Result[] results = contentTBL.get(gets);</span><br><span class="line">        List&lt;Message&gt; messages = <span class="keyword">new</span> ArrayList&lt;Message&gt;();</span><br><span class="line">        <span class="keyword">for</span>(Result res : results)&#123;</span><br><span class="line">            <span class="keyword">for</span>(Cell cell : res.rawCells())&#123;</span><br><span class="line">                Message message = <span class="keyword">new</span> Message();</span><br><span class="line">                String rowKey = Bytes.toString(CellUtil.cloneRow(cell));</span><br><span class="line">                String userid = rowKey.substring(<span class="number">0</span>, rowKey.indexOf(<span class="string">"_"</span>));</span><br><span class="line">                String timestamp = rowKey.substring(rowKey.indexOf(<span class="string">"_"</span>) + <span class="number">1</span>);</span><br><span class="line">                String content = Bytes.toString(CellUtil.cloneValue(cell));</span><br><span class="line">                message.setContent(content);</span><br><span class="line">                message.setTimestamp(timestamp);</span><br><span class="line">                message.setUid(userid);</span><br><span class="line">                messages.add(message);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> messages;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            connection.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2020-07-10T03:39:13.000Z" itemprop="dateUpdated">2020-07-10 11:39:13</time>
</span><br>


        
    </div>
    
    <footer>
        <a href="http://yoursite.com">
            <img src="/img/avatar.jpg" alt="Wingo">
            Wingo
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HBase/" rel="tag">HBase</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://yoursite.com/2020/05/03/%E5%A4%A7%E6%95%B0%E6%8D%AE/HBase/&title=《Hbase》 — Wingo's Blog&pic=http://yoursite.com/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://yoursite.com/2020/05/03/%E5%A4%A7%E6%95%B0%E6%8D%AE/HBase/&title=《Hbase》 — Wingo's Blog&source=HBase 的简本介绍及简使用。" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://yoursite.com/2020/05/03/%E5%A4%A7%E6%95%B0%E6%8D%AE/HBase/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Hbase》 — Wingo's Blog&url=http://yoursite.com/2020/05/03/%E5%A4%A7%E6%95%B0%E6%8D%AE/HBase/&via=http://yoursite.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://yoursite.com/2020/05/03/%E5%A4%A7%E6%95%B0%E6%8D%AE/HBase/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2020/05/06/%E5%A4%A7%E6%95%B0%E6%8D%AE/Kafka/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">Kafka</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2020/04/30/%E6%8A%80%E6%9C%AF%E5%8E%9F%E7%90%86/%E5%8D%81%E5%A4%A7%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95%EF%BC%88%E5%86%85%E9%83%A8%E6%8E%92%E5%BA%8F%EF%BC%89/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">算法整理</h4>
      </a>
    </div>
  
</nav>



    











    <!-- Valine Comments -->
    <div class="comments vcomment" id="comments"></div>
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script>
    <!-- Valine Comments script -->
    <script>
        var GUEST_INFO = ['nick','mail','link'];
        var guest_info = 'nick,mail,link'.split(',').filter(function(item){
          return GUEST_INFO.indexOf(item) > -1
        });
        new Valine({
            el: '#comments',
            notify: 'false' == 'true',
            verify: 'false' == 'true',
            appId: "QoOGpxpe5BGO7EmBfCSjvsdy-gzGzoHsz",
            appKey: "rD7bmgy1t0G7BO6g9US2nMGg",
            avatar: "mm",
            placeholder: "Just go go",
            guest_info: guest_info.length == 0 ? GUEST_INFO : guest_info,
            pageSize: "10"
        })
    </script>
    <!-- Valine Comments end -->










</article>



</div>

        <footer class="footer">
    <div class="top">
        

        <p>
            
            <span>得失从缘，心无增减</span>
        </p>
    </div> 
    <div class="bottom">
        <p><span>Wingo &copy; 2020 - 2021</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://yoursite.com/2020/05/03/%E5%A4%A7%E6%95%B0%E6%8D%AE/HBase/&title=《Hbase》 — Wingo's Blog&pic=http://yoursite.com/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://yoursite.com/2020/05/03/%E5%A4%A7%E6%95%B0%E6%8D%AE/HBase/&title=《Hbase》 — Wingo's Blog&source=HBase 的简本介绍及简使用。" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://yoursite.com/2020/05/03/%E5%A4%A7%E6%95%B0%E6%8D%AE/HBase/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Hbase》 — Wingo's Blog&url=http://yoursite.com/2020/05/03/%E5%A4%A7%E6%95%B0%E6%8D%AE/HBase/&via=http://yoursite.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://yoursite.com/2020/05/03/%E5%A4%A7%E6%95%B0%E6%8D%AE/HBase/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="//api.qrserver.com/v1/create-qr-code/?data=http://yoursite.com/2020/05/03/%E5%A4%A7%E6%95%B0%E6%8D%AE/HBase/" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>










</body>
</html>
