<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>用户管理系统 | Wingo&#39;s Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="Project">
    <meta name="description" content="基于 Spring Boot 的用户管理系统。">
<meta property="og:type" content="article">
<meta property="og:title" content="用户管理系统">
<meta property="og:url" content="http://yoursite.com/2020/03/07/Welab/%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/index.html">
<meta property="og:site_name" content="Wingo&#39;s Blog">
<meta property="og:description" content="基于 Spring Boot 的用户管理系统。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://welab-wingo.gitee.io/image/2020/03/UserManagementSystem/Demand.PNG">
<meta property="og:image" content="http://welab-wingo.gitee.io/image/2020/03/UserManagementSystem/Database01.PNG">
<meta property="og:image" content="http://welab-wingo.gitee.io/image/2020/03/UserManagementSystem/Port.png">
<meta property="og:image" content="http://welab-wingo.gitee.io/image/2020/03/UserManagementSystem/VO.PNG">
<meta property="og:image" content="http://welab-wingo.gitee.io/image/2020/03/UserManagementSystem/ValidError01.png">
<meta property="og:image" content="http://welab-wingo.gitee.io/image/2020/03/UserManagementSystem/ValidError02.png">
<meta property="og:image" content="http://welab-wingo.gitee.io/image/2020/03/UserManagementSystem/ValidError03.png">
<meta property="og:image" content="http://welab-wingo.gitee.io/image/2020/03/UserManagementSystem/SQLLog01.png">
<meta property="og:image" content="http://welab-wingo.gitee.io/image/2020/03/UserManagementSystem/SQLLog03.png">
<meta property="article:published_time" content="2020-03-07T08:44:21.000Z">
<meta property="article:modified_time" content="2020-04-19T06:45:04.725Z">
<meta property="article:author" content="Wingo">
<meta property="article:tag" content="Project">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://welab-wingo.gitee.io/image/2020/03/UserManagementSystem/Demand.PNG">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="/css/style.css?v=1.7.2">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

<meta name="generator" content="Hexo 4.2.0"></head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Wingo</h5>
          <a href="mailto:1318263468@qq.com" title="1318263468@qq.com" class="mail">1318263468@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                Home
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">用户管理系统</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">用户管理系统</h1>
        <h5 class="subtitle">
            
                <time datetime="2020-03-07T08:44:21.000Z" itemprop="datePublished" class="page-time">
  2020-03-07
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Welab/">Welab</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#准备工作"><span class="post-toc-number">1.</span> <span class="post-toc-text">准备工作</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#接口的设计"><span class="post-toc-number">2.</span> <span class="post-toc-text">接口的设计</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#DTO-类的编写"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">DTO 类的编写</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#VO-类的编写"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">VO 类的编写</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#静态常量类"><span class="post-toc-number">3.</span> <span class="post-toc-text">静态常量类</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#UrlConstant"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">UrlConstant</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#UserTypeConstant"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">UserTypeConstant</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#ImageCodeConstant"><span class="post-toc-number">3.3.</span> <span class="post-toc-text">ImageCodeConstant</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#RespoonseConstant"><span class="post-toc-number">3.4.</span> <span class="post-toc-text">RespoonseConstant</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#UserConstant"><span class="post-toc-number">3.5.</span> <span class="post-toc-text">UserConstant</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#工具类"><span class="post-toc-number">4.</span> <span class="post-toc-text">工具类</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#MD5-密码加密"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">MD5 密码加密</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#验证码生成"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">验证码生成</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#实体类"><span class="post-toc-number">5.</span> <span class="post-toc-text">实体类</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#数据源"><span class="post-toc-number">6.</span> <span class="post-toc-text">数据源</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Druid-连接池"><span class="post-toc-number">6.1.</span> <span class="post-toc-text">Druid 连接池</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Druid-配置"><span class="post-toc-number">6.2.</span> <span class="post-toc-text">Druid 配置</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#整合-Mybatis"><span class="post-toc-number">7.</span> <span class="post-toc-text">整合 Mybatis</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#配置-Mapper"><span class="post-toc-number">7.1.</span> <span class="post-toc-text">配置 Mapper</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Mapper-接口类"><span class="post-toc-number">7.2.</span> <span class="post-toc-text">Mapper 接口类</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Mapper-配置实现"><span class="post-toc-number">7.3.</span> <span class="post-toc-text">Mapper 配置实现</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#编写测试方法"><span class="post-toc-number">7.4.</span> <span class="post-toc-text">编写测试方法</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#业务逻辑层"><span class="post-toc-number">8.</span> <span class="post-toc-text">业务逻辑层</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Mybatis-版本"><span class="post-toc-number">8.1.</span> <span class="post-toc-text">Mybatis 版本</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#测试用例"><span class="post-toc-number">8.2.</span> <span class="post-toc-text">测试用例</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#控制层"><span class="post-toc-number">9.</span> <span class="post-toc-text">控制层</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Swagger-整合"><span class="post-toc-number">9.1.</span> <span class="post-toc-text">Swagger 整合</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#代码编写"><span class="post-toc-number">9.2.</span> <span class="post-toc-text">代码编写</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Thymeleaf"><span class="post-toc-number">10.</span> <span class="post-toc-text">Thymeleaf</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#login-html"><span class="post-toc-number">10.1.</span> <span class="post-toc-text">login.html</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#index-html"><span class="post-toc-number">10.2.</span> <span class="post-toc-text">index.html</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#modify-html"><span class="post-toc-number">10.3.</span> <span class="post-toc-text">modify.html</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#register-html"><span class="post-toc-number">10.4.</span> <span class="post-toc-text">register.html</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#user-html"><span class="post-toc-number">10.5.</span> <span class="post-toc-text">user.html</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#view-html"><span class="post-toc-number">10.6.</span> <span class="post-toc-text">view.html</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#过滤器"><span class="post-toc-number">11.</span> <span class="post-toc-text">过滤器</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#全局异常处理"><span class="post-toc-number">12.</span> <span class="post-toc-text">全局异常处理</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#自定义-SQL-日志打印"><span class="post-toc-number">13.</span> <span class="post-toc-text">自定义 SQL 日志打印</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#跨域"><span class="post-toc-number">14.</span> <span class="post-toc-text">跨域</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#注意"><span class="post-toc-number">14.1.</span> <span class="post-toc-text">注意</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#自定义校验"><span class="post-toc-number">15.</span> <span class="post-toc-text">自定义校验</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#注解类"><span class="post-toc-number">15.1.</span> <span class="post-toc-text">注解类</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#校验类"><span class="post-toc-number">15.2.</span> <span class="post-toc-text">校验类</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#请求响应打印"><span class="post-toc-number">16.</span> <span class="post-toc-text">请求响应打印</span></a></li></ol>
        </nav>
    </aside>


<article id="post-Welab/用户管理系统"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">用户管理系统</h1>
        <div class="post-meta">
            <time class="post-time" title="2020-03-07 16:44:21" datetime="2020-03-07T08:44:21.000Z"  itemprop="datePublished">2020-03-07</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Welab/">Welab</a></li></ul>



            

        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <p>基于 Spring Boot 的用户管理系统。</p>
<a id="more"></a>

<h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><p>功能模块分析：</p>
<p><img src="http://welab-wingo.gitee.io/image/2020/03/UserManagementSystem/Demand.PNG" alt=""></p>
<p>数据库表分析：</p>
<p><img src="http://welab-wingo.gitee.io/image/2020/03/UserManagementSystem/Database01.PNG" alt=""></p>
<p>数据库建表语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`user_manage_demo`</span> (</span><br><span class="line">  <span class="string">`user_id`</span> <span class="built_in">bigint</span>(<span class="number">11</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT <span class="keyword">COMMENT</span> <span class="string">'主键id，用户id'</span>,</span><br><span class="line">  <span class="string">`username`</span> <span class="built_in">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'用户名'</span>,</span><br><span class="line">  <span class="string">`password`</span> <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'用户密码'</span>,</span><br><span class="line">  <span class="string">`type`</span> <span class="built_in">char</span>(<span class="number">1</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'用户类型（1：管理员；0：普通用户）'</span>,</span><br><span class="line">  <span class="string">`gmt_create`</span> datetime <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'记录创建时间'</span>,</span><br><span class="line">  <span class="string">`gmt_modified`</span> datetime <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'记录修改时间'</span>,</span><br><span class="line">  <span class="string">`is_delete`</span> <span class="built_in">tinyint</span>(<span class="number">1</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span> <span class="keyword">COMMENT</span> <span class="string">'记录是否逻辑删除（0：未删除；1：已删除）'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`user_id`</span>),</span><br><span class="line">  <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> <span class="string">`uk_name_type`</span> (<span class="string">`username`</span>,<span class="string">`type`</span>) <span class="keyword">USING</span> BTREE <span class="keyword">COMMENT</span> <span class="string">'用户名称、类型唯一索引'</span></span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">6</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8mb4 <span class="keyword">COMMENT</span>=<span class="string">'用户管理表'</span>;</span><br></pre></td></tr></table></figure>

<p>在数据库表中初始化一条管理员数据：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`springboot_user`</span>.<span class="string">`user`</span></span><br><span class="line">	(<span class="string">`user_id`</span>, <span class="string">`username`</span>, <span class="string">`password`</span>, <span class="string">`type`</span>, <span class="string">`gmt_create`</span>, <span class="string">`gmt_modified`</span>, <span class="string">`is_delete`</span>) </span><br><span class="line"><span class="keyword">VALUES</span> </span><br><span class="line">	(<span class="number">1</span>, <span class="string">'admin'</span>, <span class="string">'123456'</span>, <span class="string">"1"</span>, <span class="string">'2019-05-19 20:26:22'</span>, <span class="string">'2019-05-19 20:26:27'</span>, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<h3 id="接口的设计"><a href="#接口的设计" class="headerlink" title="接口的设计"></a>接口的设计</h3><blockquote>
<p>为了项目代码更加简洁，此项目添加了 Lombok 支持依赖并且 IDEA 添加了相应的 Lombok 插件，通过在类注释<code>@Data</code>为相应的类添加Getter/Setter，toString()，equals() 等方法。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 添加 Lombok 的支持 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p><img src="http://welab-wingo.gitee.io/image/2020/03/UserManagementSystem/Port.png" alt=""></p>
<p>将前端传输过来的的数据封装在对应的 DTO 类中，用于展示层与服务层之间的数据传输对象。（View 👉 Action 👉 Srvice）</p>
<blockquote>
<p>DTO：Data Transfer Object（数据传输对象）DTO 是一组需要跨进程或网络边界传输的聚合数据的简单容器。它不应该包含业务逻辑，并将其行为限制为诸如内部一致性检查和基本验证之类的活动。</p>
</blockquote>
<p>将返回前端的数据封装在对应的 VO 类中。</p>
<blockquote>
<p>VO：View Object（视图对象）VO 的作用是把某个指定页面（或组件）的所有数据封装起来。</p>
</blockquote>
<h4 id="DTO-类的编写"><a href="#DTO-类的编写" class="headerlink" title="DTO 类的编写"></a>DTO 类的编写</h4><p>在 DTO 类中添加 JSR303 校验。</p>
<blockquote>
<p>JSR303 是一项标准，JSR-349 是其的升级版本，添加了一些新特性，他们规定一些校验规范即校验注解，如 <code>@Null</code>，<code>@NotNull</code>，<code>@Pattern</code>，在 javax.validation.constraints 包下，只提供规范不提供实现。</p>
<p>Hibernat Validation 是对这个规范的实践（不要将 Hibernate 和数据库 ORM 框架联系在一起），他提供了相应的实现，并增加了一些其他校验注解，如<code>@Email</code>，<code>@Length</code>，<code>@Range</code>等等，在 org.hibernate.validator.constraints 包下。</p>
<p>Spring 为了给开发者提供便捷，对 Hibernate Validation 进行了二次封装，显示校验 Validated Bean 时，你可以使用 Spring validation 或者 Hibernate validation，而 Spring Validation 另一个特性，便是其在 Spring MVC 模块中添加了自动校验，并将校验信息封装进了特定的类中。这无疑便捷了我们的 web 开发。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* DTO 类示例</span></span><br><span class="line"><span class="comment">* <span class="doctag">@NotBlank</span> 用于 String（会去掉空格）</span></span><br><span class="line"><span class="comment">* <span class="doctag">@NotNull</span> 用于 Integer</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Data</span> 自动生成 Getter/Setter，toString()，equals() 等方法</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginDTO</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 用户名 */</span></span><br><span class="line">    <span class="meta">@NotBlank</span>(message = <span class="string">"用户名不能为空"</span>)</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="comment">/** 用户密码 */</span></span><br><span class="line">    <span class="meta">@NotBlank</span>(message = <span class="string">"用户密码不能为空"</span>)</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="comment">/** 验证码 */</span></span><br><span class="line">    <span class="meta">@NotBlank</span>(message = <span class="string">"验证码不能为空"</span>)</span><br><span class="line">    <span class="keyword">private</span> String checkCode;</span><br><span class="line">    <span class="comment">/** 类型 */</span></span><br><span class="line">    <span class="meta">@NotNull</span>(message = <span class="string">"用户类型不能为空"</span>)</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="VO-类的编写"><a href="#VO-类的编写" class="headerlink" title="VO 类的编写"></a>VO 类的编写</h4><p><img src="http://welab-wingo.gitee.io/image/2020/03/UserManagementSystem/VO.PNG" alt=""></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* VO 类示例</span></span><br><span class="line"><span class="comment">* 管理员用户列表页面的用户信息返回对象</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewVO</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 用户标识 */</span></span><br><span class="line">    <span class="keyword">private</span> Integer userId;</span><br><span class="line">    <span class="comment">/** 用户名 */</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="comment">/** 用户类型 */</span></span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line">    <span class="comment">/** 用户创建时间 */</span></span><br><span class="line">    <span class="keyword">private</span> Date gtmCreate;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="静态常量类"><a href="#静态常量类" class="headerlink" title="静态常量类"></a>静态常量类</h3><p>将项目中一些固定的字面量定义为不可变的静态常量<code>public static final</code>。</p>
<h4 id="UrlConstant"><a href="#UrlConstant" class="headerlink" title="UrlConstant"></a>UrlConstant</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* URL 静态常量类</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">UrlConstant</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 添加私有的构造函数，防止静态常量类构造其它的实例，然后改变静态常量的值 */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">UrlConstant</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Utility class"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 跳转首页 URL */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String INDEX = <span class="string">"/index"</span>;</span><br><span class="line">    <span class="comment">/** 跳转注册 URL */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String REGISTER = <span class="string">"/register"</span>;</span><br><span class="line">    <span class="comment">/** 跳转登录 URL */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String LOGIN = <span class="string">"/login"</span>;</span><br><span class="line">    <span class="comment">/** 跳转查看用户列表 URL */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String VIEW = <span class="string">"/view"</span>;</span><br><span class="line">    <span class="comment">/** 跳转新增用户 URL */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String USER = <span class="string">"/user"</span>;</span><br><span class="line">    <span class="comment">/** 跳转修改用户信息 URL */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String MODIFY = <span class="string">"/modify"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="UserTypeConstant"><a href="#UserTypeConstant" class="headerlink" title="UserTypeConstant"></a>UserTypeConstant</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 用户类型静态常量类</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">UserTypeConstant</span> </span>&#123; </span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 添加私有的构造函数，防止静态常量类构造其它的实例，然后改变静态常量的值 */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">UserTypeConstant</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Utility class"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 管理员用户 */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String ADMIN = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 普通用户 */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String ORDINARY = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户类型代码转描述</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type 用户类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 用户类型中文描述</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">typeToDesc</span><span class="params">(Sting type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (UserTypeConstant.ADMIN.equals(type)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"管理员"</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (UserTypeConstant.ORDINARY.equals(type)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"普通用户"</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"未知身份，请联系系统管理员"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="ImageCodeConstant"><a href="#ImageCodeConstant" class="headerlink" title="ImageCodeConstant"></a>ImageCodeConstant</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ImageCodeConstant</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 添加私有的构造函数，防止静态常量类构造其它的实例，然后改变静态常量的值 */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">ImageCodeConstant</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Utility class"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 验证码生成的时间 */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String CODE_TIME = <span class="string">"codeTime"</span>;</span><br><span class="line">    <span class="comment">/** 验证码过期时间，单位：分钟 */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CAPTCHA_EXPIRY_TIME = <span class="number">5</span>;</span><br><span class="line">    <span class="comment">/** 秒/毫秒换算 */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MILLISECOND_CONVERSION = <span class="number">1000</span>;</span><br><span class="line">    <span class="comment">/** 分钟/秒换算 */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MINUTE_CONVERSION = <span class="number">60</span>;</span><br><span class="line">    <span class="comment">/** 生成验证码的变量名称 */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String SIMPLE_CAPTCHA = <span class="string">"simpleCaptcha"</span>;</span><br><span class="line">    <span class="comment">/** 生成验证码的变量值 */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String CAPTCHA_VALUE = <span class="string">"captchaValue"</span>;</span><br><span class="line">    <span class="comment">/** 生成的验证码图形的变量名 */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String IMAGE = <span class="string">"image"</span>;</span><br><span class="line">    <span class="comment">/** 生成的图形验证码文件格式化的名称 */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String JPEG = <span class="string">"JPEG"</span>;</span><br><span class="line">    <span class="comment">/** 图片字符涉及的罗马字体名 */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TIMES_NEW_ROMAN = <span class="string">"Times New Roman"</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="RespoonseConstant"><a href="#RespoonseConstant" class="headerlink" title="RespoonseConstant"></a>RespoonseConstant</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ResponseConstant</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 添加私有的构造函数，防止静态常量类构造其它的实例，然后改变静态常量的值 */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">ResponseConstant</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Utility class"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 处理成功时返回的 Code */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String SUCCESS = <span class="string">"200"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 业务处理失败时返回的 Code */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String FAIL = <span class="string">"-1"</span>;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">/** 返回信息的 Key 常量值 */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String RESPONSE_VO = <span class="string">"responseVO"</span>;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">/** 返回状态码常量值 */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String CODE = <span class="string">"code"</span>;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">/** 返回状态信息常量值 */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String MESSAGE = <span class="string">"message"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="UserConstant"><a href="#UserConstant" class="headerlink" title="UserConstant"></a>UserConstant</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">UserConstant</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 添加私有的构造函数，防止静态常量类构造其它的实例，然后改变静态常量的值 */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">UserConstant</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Utility class"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/** Session 中的用户名常量的字段名称，多处使用统一在这里定义，避免 SonarLint 魔法值的告警 */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String USERNAME = <span class="string">"username"</span>;</span><br><span class="line">    <span class="comment">/** Session 中的用户类型常量的字段名称，多处使用统一在这里定义，避免 SonarLint 魔法值的告警 */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TYPE = <span class="string">"type"</span>;</span><br><span class="line">    <span class="comment">/** Session 中的用户类型名称常量的字段名称，多处使用统一在这里定义，避免 SonarLint 魔法值的告警 */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TYPE_NAME = <span class="string">"typeName"</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="工具类"><a href="#工具类" class="headerlink" title="工具类"></a>工具类</h3><h4 id="MD5-密码加密"><a href="#MD5-密码加密" class="headerlink" title="MD5 密码加密"></a>MD5 密码加密</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Md5Util</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Md5Util</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Utility class"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * md5 加密通用工具类</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> encode 需加密的字符串</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> md5 加密后的字符串（32位字符串）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">md5</span><span class="params">(String encode)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 检验参数是否是 null 或者 "" 或者 " " 等</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isBlank(encode)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">char</span>[] hexDigits = &#123;<span class="string">'0'</span>, <span class="string">'1'</span>, <span class="string">'2'</span>, <span class="string">'3'</span>, <span class="string">'4'</span>, <span class="string">'5'</span>, <span class="string">'6'</span>, <span class="string">'7'</span>, <span class="string">'8'</span>, <span class="string">'9'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>, <span class="string">'f'</span>&#125;;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 设置字符集</span></span><br><span class="line">            <span class="keyword">byte</span>[] strTemp = encode.getBytes(StandardCharsets.UTF_8);</span><br><span class="line">            <span class="comment">// 生成一个 md5 加密计算摘要</span></span><br><span class="line">            MessageDigest mdTemp = MessageDigest.getInstance(<span class="string">"MD5"</span>);</span><br><span class="line">            <span class="comment">// 计算 md5 函数</span></span><br><span class="line">            mdTemp.update(strTemp);</span><br><span class="line">            <span class="comment">// digest() 最后确定返回 md5 hash 值，返回值为 8 位字符串。因为 md5 hash 值是 16 位的 hex 值，实际上就是 8 位的字符</span></span><br><span class="line">            <span class="keyword">byte</span>[] md = mdTemp.digest();</span><br><span class="line">            <span class="keyword">int</span> j = md.length;</span><br><span class="line">            <span class="keyword">char</span>[] str = <span class="keyword">new</span> <span class="keyword">char</span>[j * <span class="number">2</span>];</span><br><span class="line">            <span class="keyword">int</span> k = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">byte</span> byte0 : md) &#123;</span><br><span class="line">                <span class="comment">// 不带符号右移四位(不管 byte0 的类型 位移处补 0)，&amp; 十六进制的 f 即 高四位清空 取低四位的值，&gt;&gt;&gt; 优先级高于 &amp;</span></span><br><span class="line">                str[k++] = hexDigits[byte0 &gt;&gt;&gt; <span class="number">4</span> &amp; <span class="number">0xf</span>];</span><br><span class="line">                str[k++] = hexDigits[byte0 &amp; <span class="number">0xf</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> String(str);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="验证码生成"><a href="#验证码生成" class="headerlink" title="验证码生成"></a>验证码生成</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ImageCodeUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">ImageCodeUtil</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Utility class"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 生成验证码图片的默认宽度 */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> IMAGE_WIDTH = <span class="number">60</span>;</span><br><span class="line">    <span class="comment">/** 生成验证码图片的默认高度 */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> IMAGE_HEIGHT = <span class="number">20</span>;</span><br><span class="line">    <span class="comment">/** 随机干扰线的条数，太稀疏或者太密织都达不到干扰的效果 */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> RAND_COLOR = <span class="number">168</span>;</span><br><span class="line">    <span class="comment">/** 颜色数值的上限，三原色的范围都是 [0, 255] 范围 */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> COLOR_MAX = <span class="number">255</span>;</span><br><span class="line">    <span class="comment">/** 可根据需要来修改，生成纯数字或者纯字母，或者默认这种混合的 */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">char</span>[] mapTable = &#123;<span class="string">'0'</span>, <span class="string">'1'</span>, <span class="string">'2'</span>, <span class="string">'3'</span>, <span class="string">'4'</span>, <span class="string">'5'</span>, <span class="string">'6'</span>, <span class="string">'7'</span>, <span class="string">'8'</span>, <span class="string">'9'</span>, <span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'D'</span>, <span class="string">'E'</span>, <span class="string">'F'</span>,</span><br><span class="line">            <span class="string">'G'</span>, <span class="string">'H'</span>, <span class="string">'I'</span>, <span class="string">'J'</span>, <span class="string">'K'</span>, <span class="string">'L'</span>, <span class="string">'M'</span>, <span class="string">'N'</span>, <span class="string">'O'</span>, <span class="string">'P'</span>, <span class="string">'Q'</span>, <span class="string">'R'</span>, <span class="string">'S'</span>, <span class="string">'T'</span>, <span class="string">'U'</span>, <span class="string">'V'</span>, <span class="string">'W'</span>, <span class="string">'X'</span>, <span class="string">'Y'</span>, <span class="string">'Z'</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成图形验证码</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> width 生成的图形验证码的宽度</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> height 生成的图形验证码的高度</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> verifySize 需要生成的验证码位数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 验证码的图片对象及验证码的值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String, Object&gt; <span class="title">getImageCode</span><span class="params">(<span class="keyword">int</span> width, <span class="keyword">int</span> height, <span class="keyword">int</span> verifySize)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> NoSuchAlgorithmException </span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; returnMap = <span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">6</span>);</span><br><span class="line">        <span class="comment">// 确保验证码的宽度和高度不能小于或等于零</span></span><br><span class="line">        width = width &lt;= <span class="number">0</span> ? IMAGE_WIDTH : width;</span><br><span class="line">        height = height &lt;= <span class="number">0</span> ? IMAGE_HEIGHT : height;</span><br><span class="line">        <span class="comment">// BufferedImage 是 Image 的一个子类，Image 和 BufferedImage</span></span><br><span class="line">        <span class="comment">// 主要作用就是将一副图片加载到内存中，BufferedImage 生成的图片在内存里有一个图像缓冲区</span></span><br><span class="line">        <span class="comment">// 利用这个缓冲区我们可以很方便的操作这个图片，通常用来做图片修改操作如大小变换、图片变灰、设置图片透明或不透明等</span></span><br><span class="line">        BufferedImage image = <span class="keyword">new</span> BufferedImage(width, height, BufferedImage.TYPE_INT_RGB);</span><br><span class="line">        <span class="comment">// 获取图形上下文</span></span><br><span class="line">        Graphics g = image.getGraphics();</span><br><span class="line">        <span class="comment">// 生成随机类</span></span><br><span class="line">        Random random = SecureRandom.getInstanceStrong();</span><br><span class="line">        <span class="comment">// 设定背景色</span></span><br><span class="line">        g.setColor(getRandColor(<span class="number">200</span>, <span class="number">250</span>));</span><br><span class="line">        <span class="comment">// 画长方形</span></span><br><span class="line">        g.fillRect(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">        <span class="comment">// 设定字体</span></span><br><span class="line">        g.setFont(<span class="keyword">new</span> Font(ImageCodeConstant.TIMES_NEW_ROMAN, Font.PLAIN, <span class="number">18</span>));</span><br><span class="line">        <span class="comment">// 再次设置背景色，实测跟前一次设置背景色有叠加的效果，会让背景颜色看起来更复杂</span></span><br><span class="line">        g.setColor(getRandColor(<span class="number">160</span>, <span class="number">200</span>));</span><br><span class="line">        <span class="comment">// 随机产生 168 条干扰线，使图象中的认证码不易被其它程序探测到</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; RAND_COLOR; i++) &#123;</span><br><span class="line">            <span class="comment">// nextInt(n) 会返回 [0, n) 之间的随机数</span></span><br><span class="line">            <span class="keyword">int</span> x = random.nextInt(width);</span><br><span class="line">            <span class="keyword">int</span> y = random.nextInt(height);</span><br><span class="line">            <span class="keyword">int</span> xl = random.nextInt(<span class="number">12</span>);</span><br><span class="line">            <span class="keyword">int</span> yl = random.nextInt(<span class="number">12</span>);</span><br><span class="line">            <span class="comment">// x: 线段起点的横坐标；y: 线段起点的纵坐标；x + xl: 线段终点的横坐标；y + yl: 线段终点的纵坐标</span></span><br><span class="line">            g.drawLine(x, y, x + xl, y + yl);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 定义验证码的值</span></span><br><span class="line">        StringBuilder captchaValue = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="comment">// 4代表验证码位数，如果要生成更多位的认证码，则加大数值</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; verifySize; ++i) &#123;</span><br><span class="line">            captchaValue.append(mapTable[random.nextInt(mapTable.length)]);</span><br><span class="line">            <span class="comment">// 将认证码显示到图象中</span></span><br><span class="line">            g.setColor(<span class="keyword">new</span> Color(<span class="number">20</span> + random.nextInt(<span class="number">110</span>), <span class="number">20</span> + random.nextInt(<span class="number">110</span>), <span class="number">20</span> + random.nextInt(<span class="number">110</span>)));</span><br><span class="line">            <span class="comment">// 直接生成</span></span><br><span class="line">            String str = captchaValue.substring(i, i + <span class="number">1</span>);</span><br><span class="line">            <span class="comment">// 使用此图形上下文的当前字体和颜色绘制由指定 string 给定的文本</span></span><br><span class="line">            g.drawString(str, <span class="number">13</span> * i + <span class="number">6</span>, <span class="number">16</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 释放图形上下文资源</span></span><br><span class="line">        g.dispose();</span><br><span class="line">        <span class="comment">// 组装图像结果及验证码值并返回</span></span><br><span class="line">        returnMap.put(ImageCodeConstant.IMAGE, image);</span><br><span class="line">        returnMap.put(ImageCodeConstant.CAPTCHA_VALUE, captchaValue.toString());</span><br><span class="line">        <span class="keyword">return</span> returnMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 给定范围获得随机颜色 */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Color <span class="title">getRandColor</span><span class="params">(<span class="keyword">int</span> fc, <span class="keyword">int</span> bc)</span> <span class="keyword">throws</span> NoSuchAlgorithmException </span>&#123;</span><br><span class="line">        <span class="comment">// 创建一个随机数生成对象的实例</span></span><br><span class="line">        Random random = SecureRandom.getInstanceStrong();</span><br><span class="line">        <span class="comment">// 颜色值不能超过最大范围</span></span><br><span class="line">        fc = fc &gt; COLOR_MAX ? COLOR_MAX : fc;</span><br><span class="line">        bc = bc &gt; COLOR_MAX ? COLOR_MAX : bc;</span><br><span class="line">        <span class="comment">// nextInt(n) 会返回 [0, n) 之间的随机数</span></span><br><span class="line">        <span class="keyword">int</span> r = fc + random.nextInt(bc - fc);</span><br><span class="line">        <span class="keyword">int</span> g = fc + random.nextInt(bc - fc);</span><br><span class="line">        <span class="keyword">int</span> b = fc + random.nextInt(bc - fc);</span><br><span class="line">        <span class="comment">// 按随机生成的 r、g、b 值设置颜色并返回</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Color(r, g, b);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="实体类"><a href="#实体类" class="headerlink" title="实体类"></a>实体类</h3><p>实体类的属性与数据库的字段相对应。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserMybatis</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 用户 id */</span></span><br><span class="line">    <span class="keyword">private</span> Integer userId;</span><br><span class="line">    <span class="comment">/** 用户名 */</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="comment">/** 用户密码 */</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="comment">/** 用户类型 */</span></span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line">    <span class="comment">/** 记录创建时间 */</span></span><br><span class="line">    <span class="meta">@DateTimeFormat</span>(pattern = <span class="string">"yyyy-MM-dd HH:mm:ss"</span>)</span><br><span class="line">    <span class="keyword">private</span> Date gmtCreate;</span><br><span class="line">    <span class="comment">/** 记录修改时间 */</span></span><br><span class="line">    <span class="meta">@DateTimeFormat</span>(pattern = <span class="string">"yyyy-MM-dd HH:mm:ss"</span>)</span><br><span class="line">    <span class="keyword">private</span> Date gmtModified;</span><br><span class="line">    <span class="comment">/** 记录是否删除 */</span></span><br><span class="line">    <span class="keyword">private</span> Boolean isDelete;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="数据源"><a href="#数据源" class="headerlink" title="数据源"></a>数据源</h3><p>配置数据源：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 数据源配置</span></span><br><span class="line"><span class="comment"># serverTimezone=Asia/Shanghai 这种写法也可以</span></span><br><span class="line"><span class="comment"># SSL 连接必须显示的进行配置是否使用，否则会报警告</span></span><br><span class="line"><span class="comment"># 使用 MySQL80 服务 mysql-connector-java:8.0.19 版本的连接 Jar 包 DriverClass：com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="meta">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/springboot_user?serverTimezone=GMT%2B8&amp;useUnicode=true&amp;characterEncoding=utf8&amp;useSSL=false</span></span><br><span class="line"><span class="meta">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">spring.datasource.password</span>=<span class="string">123456</span></span><br><span class="line"><span class="meta">spring.datasource.driverClassName</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br></pre></td></tr></table></figure>

<p>测试数据源是否配置成功：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringRunner<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">SpringBootTest</span></span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">JavaSpringWingoApplicationTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 测试 DataSource 是否被成功注入</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    DataSource dataSource;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">testDataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(dataSource.getClass());</span><br><span class="line">        <span class="comment">// 输出结果 class com.zaxxer.hikari.HikariDataSource Spring Boot 2 的默认连接池 Hikari</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Druid-连接池"><a href="#Druid-连接池" class="headerlink" title="Druid 连接池"></a>Druid 连接池</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 支持阿里 Druid 连接池 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 方式一：使用 Spring Boot 提供的启动器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 方式二：此方式需要自行编写 Druid 配置类引入配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;version&gt;1.1.16&lt;/version&gt; 此版本找不到依赖 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="Druid-配置"><a href="#Druid-配置" class="headerlink" title="Druid 配置"></a>Druid 配置</h4><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## Druid连接池配置</span></span><br><span class="line"><span class="meta">spring.datasource.type</span>=<span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line"><span class="comment">## Druid 连接池配置</span></span><br><span class="line"><span class="meta">spring.datasource.type</span>=<span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line"><span class="comment"># 初始化大小、最小、最大</span></span><br><span class="line"><span class="meta">spring.datasource.initialSize</span>=<span class="string">1</span></span><br><span class="line"><span class="meta">spring.datasource.minIdle</span>=<span class="string">3</span></span><br><span class="line"><span class="meta">spring.datasource.maxActive</span>=<span class="string">20</span></span><br><span class="line"><span class="comment"># 获取连接等待超时时间</span></span><br><span class="line"><span class="meta">spring.datasource.maxWait</span>=<span class="string">60000</span></span><br><span class="line"><span class="comment"># 配置间隔多久才进行一次检测，检测需要关闭的空闲连接，单位是毫秒</span></span><br><span class="line"><span class="meta">spring.datasource.timeBetweenEvictionRunsMillis</span>=<span class="string">30000</span></span><br><span class="line"><span class="comment"># 指定获取连接时连接校验的sql查询语句</span></span><br><span class="line"><span class="meta">spring.datasource.validationQuery</span>=<span class="string">select 'x'</span></span><br><span class="line"><span class="comment"># 获取连接后，确实是否要进行连接空闲时间的检查</span></span><br><span class="line"><span class="meta">spring.datasource.testWhileIdle</span>=<span class="string">true</span></span><br><span class="line"><span class="comment"># 获取连接检测</span></span><br><span class="line"><span class="meta">spring.datasource.testOnBorrow</span>=<span class="string">false</span></span><br><span class="line"><span class="comment"># 归还连接检测</span></span><br><span class="line"><span class="meta">spring.datasource.testOnReturn</span>=<span class="string">false</span></span><br><span class="line"><span class="comment"># 指定连接校验查询的超时时间</span></span><br><span class="line"><span class="meta">spring.datasource.validationQueryTimeout</span>=<span class="string">600000</span></span><br><span class="line"><span class="comment"># 配置一个连接在池总最小生存的时间</span></span><br><span class="line"><span class="meta">spring.datasource.minEvictableIdleTimeMillis</span>=<span class="string">300000</span></span><br><span class="line"><span class="comment"># 打开 PSCache，并且指定每个连接上 Cache 的大小</span></span><br><span class="line"><span class="meta">spring.datasource.poolPreparedStatements</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">spring.datasource.maxPoolPreparedStatementPerConnectionSize</span>=<span class="string">20</span></span><br><span class="line"><span class="comment"># 配置监控统计拦截的 filter，去掉后监控界面 sql 无法统计，wall 用于防火墙，stat 用于监控统计</span></span><br><span class="line"><span class="meta">spring.datasource.filters</span>=<span class="string">stat,wall,slf4j</span></span><br><span class="line"><span class="comment"># 通过 connectProperties 属性来打开 mergeSql 功能，慢 sql 记录等</span></span><br><span class="line"><span class="meta">spring.datasource.connectionProperties</span>=<span class="string">druid.stat.mergeSql=true;druid.stat.logSlowSql=true;druid.stat.slowSqlMillis=5000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## druid连接池监控 访问 URL：locahost:8080/druid </span></span><br><span class="line"><span class="comment"># 需要账号密码才能访问控制台，默认为root</span></span><br><span class="line"><span class="meta">spring.datasource.druid.stat-view-servlet.login-username</span>=<span class="string">admin</span></span><br><span class="line"><span class="meta">spring.datasource.druid.stat-view-servlet.login-password</span>=<span class="string">123</span></span><br><span class="line"><span class="comment"># 访问路径为/druid时，跳转到StatViewServlet</span></span><br><span class="line"><span class="meta">spring.datasource.druid.stat-view-servlet.url-pattern</span>=<span class="string">/druid/*</span></span><br><span class="line"><span class="comment"># 是否能够重置数据</span></span><br><span class="line"><span class="meta">spring.datasource.druid.stat-view-servlet.reset-enable</span>=<span class="string">false</span></span><br><span class="line"><span class="comment"># 排除一些静态资源，以提高效率</span></span><br><span class="line"><span class="meta">spring.datasource.druid.web-stat-filter.exclusions</span>=<span class="string">*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*</span></span><br></pre></td></tr></table></figure>

<p>再次测试控制台输出的 DataSource 的类型为 com.alibaba.druid.pool.DruidDataSource。</p>
<h3 id="整合-Mybatis"><a href="#整合-Mybatis" class="headerlink" title="整合 Mybatis"></a>整合 Mybatis</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 支持 MyBatis --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="配置-Mapper"><a href="#配置-Mapper" class="headerlink" title="配置 Mapper"></a>配置 Mapper</h4><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## MyBatis 配置</span></span><br><span class="line"><span class="comment"># 配置别名 parameterType 直接使用类名</span></span><br><span class="line"><span class="meta">mybatis.typeAliasesPackage</span>=<span class="string">com.wingo.user.entity</span></span><br><span class="line"><span class="meta">mybatis.mapperLocations</span>=<span class="string">classpath:mapping/*.xml</span></span><br><span class="line"><span class="comment"># 打印 MyBatis 执行的 SQL 打印出来</span></span><br><span class="line"><span class="meta">mybatis.configuration.log-impl</span>=<span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br></pre></td></tr></table></figure>

<p>Mybatis 编写数据库操作的方法对应的 XxxMapper.java 接口类，以及对应的 XxxMapper.xml 配置类，配置类用于编写具体的 SQL 语句以便 Mybatis 进行动态实现。</p>
<h4 id="Mapper-接口类"><a href="#Mapper-接口类" class="headerlink" title="Mapper 接口类"></a>Mapper 接口类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 也可通过在 Spring Boot 运行类上添加 @MapperScan() 注解扫描</span></span><br><span class="line"><span class="meta">@Mapper</span> <span class="comment">// 扫描此类为 Mybatis 的 mapper 类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMybatisMapper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户注册 / 添加用户：在数据库中添加用户信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userMybatis 用户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">insert</span><span class="params">(UserMybatis userMybatis)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户登录：通过用户名、用户密码和用户类型查询用户信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password 用户密码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type 用户类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">UserMybatis <span class="title">findUserMybatisByUsernameAndPasswordAndType</span><span class="params">(String username, String password, String type)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 管理员用户管理页面：通过用户类型和用户状态查询用户信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type 用户类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> isDelete 用户状态</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">List&lt;UserMybatis&gt; <span class="title">findAllByTypeAndStatus</span><span class="params">(String type, Integer isDelete)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户修改密码：通过用户名和用户类修改用户密码</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password 用户密码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type 用户类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> gmtModified 用户修改时间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">updatePasswordByUsernameAndType</span><span class="params">(String password, String username, String type, Date gmtModified)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新用户信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userMybatis 用户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">update</span><span class="params">(UserMybatis userMybatis)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *管理员删除用户：通过用户标识更新用户状态</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId 用户标识</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> gmtModified 用户修改时间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">updateStatusByUserId</span><span class="params">(Integer userId, Date gmtModified)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过用户名和用户类型查找用户</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type 用户类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">UserMybatis <span class="title">findUserMybatisByUsernameAndType</span><span class="params">(String username, String type)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Mapper-配置实现"><a href="#Mapper-配置实现" class="headerlink" title="Mapper 配置实现"></a>Mapper 配置实现</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span> <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.wingo.user.mapper.UserMybatisMapper"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 编写字段与属性的映射关系 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"BaseResultMap"</span> <span class="attr">type</span>=<span class="string">"com.wingo.user.entity.UserMybatis"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"user_id"</span> <span class="attr">jdbcType</span>=<span class="string">"INTEGER"</span> <span class="attr">property</span>=<span class="string">"userId"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"username"</span> <span class="attr">jdbcType</span>=<span class="string">"VARCHAR"</span> <span class="attr">property</span>=<span class="string">"username"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"password"</span> <span class="attr">jdbcType</span>=<span class="string">"VARCHAR"</span> <span class="attr">property</span>=<span class="string">"password"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"type"</span> <span class="attr">jdbcType</span>=<span class="string">"CHAR"</span> <span class="attr">property</span>=<span class="string">"type"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"gmt_create"</span> <span class="attr">jdbcType</span>=<span class="string">"TIMESTAMP"</span> <span class="attr">property</span>=<span class="string">"gmtCreate"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"gmt_modified"</span> <span class="attr">jdbcType</span>=<span class="string">"TIMESTAMP"</span> <span class="attr">property</span>=<span class="string">"gmtModified"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"is_delete"</span> <span class="attr">jdbcType</span>=<span class="string">"BIT"</span> <span class="attr">property</span>=<span class="string">"isDelete"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insert"</span> <span class="attr">parameterType</span>=<span class="string">"UserMybatis"</span> <span class="attr">keyProperty</span>=<span class="string">"userId"</span> <span class="attr">useGeneratedKeys</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">        INSERT INTO</span><br><span class="line">            user (user_id, username, password,type, gmt_create, gmt_modified, is_delete)</span><br><span class="line">        VALUES</span><br><span class="line">            (#&#123;userId&#125;, #&#123;username&#125;, #&#123;password&#125;, #&#123;type&#125;, #&#123;gmtCreate&#125;, #&#123;gmtModified&#125;, #&#123;isDelete&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findUserMybatisByUsernameAndPasswordAndType"</span> <span class="attr">resultMap</span>=<span class="string">"BaseResultMap"</span>&gt;</span></span><br><span class="line">        SELECT</span><br><span class="line">            user_id, username, password, type, gmt_create, gmt_modified, is_delete</span><br><span class="line">        FROM</span><br><span class="line">            user</span><br><span class="line">        WHERE</span><br><span class="line">            username = #&#123;username&#125;</span><br><span class="line">        AND</span><br><span class="line">            password = #&#123;password&#125;</span><br><span class="line">        AND</span><br><span class="line">            type = #&#123;type&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAllByTypeAndStatus"</span> <span class="attr">resultMap</span>=<span class="string">"BaseResultMap"</span>&gt;</span></span><br><span class="line">        SELECT</span><br><span class="line">            user_id, username, password, type, gmt_create, gmt_modified, is_delete</span><br><span class="line">        FROM</span><br><span class="line">             user</span><br><span class="line">        WHERE</span><br><span class="line">            type = #&#123;type&#125;</span><br><span class="line">        AND</span><br><span class="line">            is_delete = #&#123;isDelete&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findUserMybatisByUsernameAndType"</span> <span class="attr">resultMap</span>=<span class="string">"BaseResultMap"</span>&gt;</span></span><br><span class="line">        SELECT</span><br><span class="line">            user_id, username, password, type, gmt_create, gmt_modified, is_delete</span><br><span class="line">        FROM</span><br><span class="line">             user</span><br><span class="line">        WHERE</span><br><span class="line">            username = #&#123;username&#125;</span><br><span class="line">        AND</span><br><span class="line">            type = #&#123;type&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"update"</span> <span class="attr">parameterType</span>=<span class="string">"UserMybatis"</span>&gt;</span></span><br><span class="line">        UPDATE</span><br><span class="line">            user</span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"username != null"</span>&gt;</span></span><br><span class="line">                username = #&#123;username&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"password != null"</span>&gt;</span></span><br><span class="line">                password = #&#123;password&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"type != null"</span>&gt;</span></span><br><span class="line">                type = #&#123;type&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"gmtCreate != null"</span>&gt;</span></span><br><span class="line">                gmt_create = #&#123;gmtCreate&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"gmtModified != null"</span>&gt;</span></span><br><span class="line">                gmt_modified = #&#123;gmtModified&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"isDelete != null"</span>&gt;</span></span><br><span class="line">                is_delete = #&#123;isDelete&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">        WHERE</span><br><span class="line">            user_id = #&#123;userId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updatePasswordByUsernameAndType"</span>&gt;</span></span><br><span class="line">        UPDATE</span><br><span class="line">            user</span><br><span class="line">        SET</span><br><span class="line">            password = #&#123;password&#125;, gmt_modified = #&#123;gmtModified&#125;</span><br><span class="line">        where</span><br><span class="line">            username =#&#123;username&#125;</span><br><span class="line">        and</span><br><span class="line">            type = #&#123;type&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateStatusByUserId"</span>&gt;</span></span><br><span class="line">        UPDATE</span><br><span class="line">            user</span><br><span class="line">        SET</span><br><span class="line">            is_delete = true, gmt_modified = #&#123;gmtModified&#125;</span><br><span class="line">        WHERE</span><br><span class="line">            user_id = #&#123;userId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="编写测试方法"><a href="#编写测试方法" class="headerlink" title="编写测试方法"></a>编写测试方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringRunner<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">SpringBootTest</span></span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">JavaSpringWingoApplicationTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    UserMybatisMapper userMybatisMapper;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@Rollback</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testInsert</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Date date = <span class="keyword">new</span> Date();</span><br><span class="line">        UserMybatis userMybatis = <span class="keyword">new</span> UserMybatis();</span><br><span class="line">        userMybatis.setUsername(<span class="string">"张三"</span>);</span><br><span class="line">        userMybatis.setPassword(<span class="string">"123456"</span>);</span><br><span class="line">        userMybatis.setType(<span class="string">"0"</span>);</span><br><span class="line">        userMybatis.setGmtCreate(date);</span><br><span class="line">        userMybatis.setGmtModified(date);</span><br><span class="line">        userMybatis.setIsDelete(<span class="keyword">false</span>);</span><br><span class="line">        userMybatisMapper.insert(userMybatis);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">    * UserMybatis userMybatis = userMybatisMapper.</span></span><br><span class="line"><span class="comment">    *	findUserMybatisByUsernameAndPasswordAndType("张三","123456","0");</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * List&lt;UserMybatis&gt; list = new ArrayList&lt;&gt;();</span></span><br><span class="line"><span class="comment">    * list = userMybatisMapper.findAllByTypeAndStatus("0",0);</span></span><br><span class="line"><span class="comment">    * Iterator&lt;UserMybatis&gt; iterable = list.iterator();</span></span><br><span class="line"><span class="comment">    * while (iterable.hasNext())&#123;</span></span><br><span class="line"><span class="comment">    * 	UserMybatis userMybatis = iterable.next();</span></span><br><span class="line"><span class="comment">    * 	System.out.println(userMybatis);</span></span><br><span class="line"><span class="comment">    * &#125;</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * UserMybatis userMybatis = userMybatisMapper.findUserMybatisByUsernameAndType("张三","0");</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * UserMybatis userMybatis = new UserMybatis();</span></span><br><span class="line"><span class="comment">    * userMybatis.setUserId(6);</span></span><br><span class="line"><span class="comment">    * userMybatis.setUsername("李四");</span></span><br><span class="line"><span class="comment">    * int result = userMybatisMapper.update(userMybatis);</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * Date date = new Date();</span></span><br><span class="line"><span class="comment">    * userMybatisMapper.updatePasswordByUsernameAndType("654321","李四","0",date);</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * Date date = new Date();</span></span><br><span class="line"><span class="comment">    * userMybatisMapper.updateStatusByUserId(6,date);</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="业务逻辑层"><a href="#业务逻辑层" class="headerlink" title="业务逻辑层"></a>业务逻辑层</h3><h4 id="Mybatis-版本"><a href="#Mybatis-版本" class="headerlink" title="Mybatis 版本"></a>Mybatis 版本</h4><p>编写项目场景功能的业务逻辑：接收前端传来的信息所封住的 DTO，然后调用 DAO 进行业务逻辑的编写。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span>(<span class="string">"userServiceMybatisImpl"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceMybatisImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span></span><br><span class="line">    UserMybatisMapper userMybatisMapper;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserServiceMybatisImpl</span><span class="params">(UserMybatisMapper userMybatisMapper)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userMybatisMapper = userMybatisMapper;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 检查此用户是否已经存在</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">checkUserDuplicate</span><span class="params">(String username)</span></span>&#123;</span><br><span class="line">        <span class="comment">// 定义默认返回 false</span></span><br><span class="line">        <span class="keyword">boolean</span> isDuplicate = <span class="keyword">false</span>;</span><br><span class="line">        UserMybatis userMybatis = userMybatisMapper.findUserMybatisByUsernameAndType(username, UserTypeConstant.ORDINARY);</span><br><span class="line">        <span class="comment">// 若此用户存在，则返回 true</span></span><br><span class="line">        <span class="keyword">if</span>(userMybatis!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            isDuplicate = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> isDuplicate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> UserMybatis <span class="title">buildUserMybatis</span><span class="params">(String username, String password)</span></span>&#123;</span><br><span class="line">        Date data = <span class="keyword">new</span> Date();</span><br><span class="line">        <span class="comment">// 创建用户实体对象并进行赋值</span></span><br><span class="line">        UserMybatis userMybatis = <span class="keyword">new</span> UserMybatis();</span><br><span class="line">        userMybatis.setUsername(username);</span><br><span class="line">        userMybatis.setPassword(Md5Util.md5(password));</span><br><span class="line">        userMybatis.setType(UserTypeConstant.ORDINARY);</span><br><span class="line">        userMybatis.setGmtCreate(data);</span><br><span class="line">        userMybatis.setGmtModified(data);</span><br><span class="line">        userMybatis.setIsDelete(<span class="keyword">false</span>);</span><br><span class="line">        <span class="keyword">return</span> userMybatis;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 用户注册 */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span>(rollbackFor = Exception<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">ResponseVO</span> <span class="title">register</span>(<span class="title">RegisterDTO</span> <span class="title">registerDTO</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 定义返回对象</span></span><br><span class="line">        ResponseVO responseVO = <span class="keyword">new</span> ResponseVO();</span><br><span class="line">        <span class="comment">// 检查此用户是否是否已经存在</span></span><br><span class="line">        <span class="keyword">if</span>(checkUserDuplicate(registerDTO.getUsername()))&#123;</span><br><span class="line">            <span class="comment">// 组装错误返回对象</span></span><br><span class="line">            responseVO.fail(<span class="string">"用户名重复，请重新注册！"</span>);</span><br><span class="line">            <span class="comment">// 返回错误代码及错误信息</span></span><br><span class="line">            <span class="keyword">return</span> responseVO;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 创建用户实体对象并进行赋值</span></span><br><span class="line">        UserMybatis userMybatis = buildUserMybatis(registerDTO.getUsername(), registerDTO.getPassword());</span><br><span class="line">        <span class="comment">// 保存数据到数据库</span></span><br><span class="line">        userMybatisMapper.insert(userMybatis);</span><br><span class="line">        <span class="comment">// 组装成功返回对象</span></span><br><span class="line">        responseVO.success(<span class="string">"恭喜您，注册成功！请登录"</span>);</span><br><span class="line">        <span class="keyword">return</span> responseVO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 用户登录 */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseVO <span class="title">login</span><span class="params">(LoginDTO loginDTO)</span> </span>&#123;</span><br><span class="line">        ResponseVO responseVO = <span class="keyword">new</span> ResponseVO();</span><br><span class="line">        UserMybatis userMybatis = userMybatisMapper.findUserMybatisByUsernameAndPasswordAndType</span><br><span class="line">                        (loginDTO.getUsername(), Md5Util.md5(loginDTO.getPassword()), loginDTO.getType());</span><br><span class="line">        <span class="keyword">if</span>(userMybatis == <span class="keyword">null</span>)&#123;</span><br><span class="line">            responseVO.fail(<span class="string">"登录失败，用户不存在、已删除或者用户名、密码或类型选择错误！"</span>);</span><br><span class="line">            <span class="keyword">return</span> responseVO;</span><br><span class="line">        &#125;</span><br><span class="line">        responseVO.success(<span class="string">"登录成功！"</span>);</span><br><span class="line">        <span class="comment">// 构建返回的用户信息</span></span><br><span class="line">        UserVO userVO = <span class="keyword">new</span> UserVO();</span><br><span class="line">        userVO.setUsername(loginDTO.getUsername());</span><br><span class="line">        userVO.setType(loginDTO.getType());</span><br><span class="line">        responseVO.setData(<span class="string">"userVO"</span>, userVO);</span><br><span class="line">        <span class="keyword">return</span> responseVO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 管理员添加用户 */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span>(rollbackFor = Exception<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">ResponseVO</span> <span class="title">add</span>(<span class="title">AddDTO</span> <span class="title">addDTO</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 定义返回对象</span></span><br><span class="line">        ResponseVO responseVO = <span class="keyword">new</span> ResponseVO();</span><br><span class="line">        <span class="comment">// 检查此用户是否是否已经存在</span></span><br><span class="line">        <span class="keyword">if</span>(checkUserDuplicate(addDTO.getUsername()))&#123;</span><br><span class="line">            <span class="comment">// 组装错误返回对象</span></span><br><span class="line">            responseVO.fail(<span class="string">"用户名重复，请重新添加！"</span>);</span><br><span class="line">            <span class="comment">// 返回错误代码及错误信息</span></span><br><span class="line">            <span class="keyword">return</span> responseVO;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 创建用户实体对象并进行赋值</span></span><br><span class="line">        UserMybatis userMybatis = buildUserMybatis(addDTO.getUsername(), addDTO.getPassword());</span><br><span class="line">        <span class="comment">// 保存数据到数据库</span></span><br><span class="line">        userMybatisMapper.insert(userMybatis);</span><br><span class="line">        <span class="comment">// 组装成功返回对象</span></span><br><span class="line">        responseVO.success(<span class="string">"添加成功！"</span>);</span><br><span class="line">        <span class="keyword">return</span> responseVO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 管理员查看用户列表 */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseVO <span class="title">view</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ResponseVO responseVO = <span class="keyword">new</span> ResponseVO();</span><br><span class="line">        <span class="comment">// 定义返回的结果集对象，这种定义方式是对象形式的集合</span></span><br><span class="line">        List&lt;ViewVO&gt; userList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        List&lt;UserMybatis&gt; userMybatisList = userMybatisMapper.findAllByTypeAndStatus(UserTypeConstant.ORDINARY, <span class="keyword">false</span>);</span><br><span class="line">        <span class="keyword">if</span>(userMybatisList == <span class="keyword">null</span>)&#123;</span><br><span class="line">            responseVO.fail(<span class="string">"请求用户列表失败！"</span>);</span><br><span class="line">            <span class="keyword">return</span> responseVO;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(UserMybatis userMybatis : userMybatisList)&#123;</span><br><span class="line">            <span class="comment">// 创建一个新对象来存储查询出的一条条记录</span></span><br><span class="line">            ViewVO viewVO = <span class="keyword">new</span> ViewVO();</span><br><span class="line">            <span class="comment">// 对对象进行赋值</span></span><br><span class="line">            viewVO.setUserId(userMybatis.getUserId());</span><br><span class="line">            viewVO.setUsername(userMybatis.getUsername());</span><br><span class="line">            viewVO.setType(userMybatis.getType());</span><br><span class="line">            viewVO.setGtmCreate(userMybatis.getGmtCreate());</span><br><span class="line">            <span class="comment">// 将对象放入集合中</span></span><br><span class="line">            userList.add(viewVO);</span><br><span class="line">        &#125;</span><br><span class="line">        responseVO.success(<span class="string">"请求用户列表成功！"</span>);</span><br><span class="line">        responseVO.setData(<span class="string">"viewVO"</span>, userList);</span><br><span class="line">        <span class="keyword">return</span> responseVO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 用户修改密码 */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span>(rollbackFor = Exception<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">ResponseVO</span> <span class="title">modify</span>(<span class="title">ModifyDTO</span> <span class="title">modifyDTO</span>) </span>&#123;</span><br><span class="line">        ResponseVO responseVO = <span class="keyword">new</span> ResponseVO();</span><br><span class="line">        <span class="comment">// 判断是否有新密码且新旧密码是否一致</span></span><br><span class="line">        <span class="keyword">if</span>(modifyDTO.getNewPassword() != <span class="keyword">null</span> &amp;&amp; modifyDTO.getConfirmNewPassword() != <span class="keyword">null</span></span><br><span class="line">                &amp;&amp; !modifyDTO.getConfirmNewPassword().equals(modifyDTO.getNewPassword()))&#123;</span><br><span class="line">            responseVO.fail(<span class="string">"新密码和确认新密码不一致，请检查！"</span>);</span><br><span class="line">            <span class="keyword">return</span> responseVO;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 判断用户的原密码是否正确</span></span><br><span class="line">        UserMybatis userMybatis = userMybatisMapper.findUserMybatisByUsernameAndPasswordAndType(</span><br><span class="line">                modifyDTO.getUsername(), Md5Util.md5(modifyDTO.getPassword()), modifyDTO.getType()</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">if</span>(userMybatis == <span class="keyword">null</span>)&#123;</span><br><span class="line">            responseVO.fail(<span class="string">"用户原密码不正确，请检查！"</span>);</span><br><span class="line">            <span class="keyword">return</span> responseVO;</span><br><span class="line">        &#125;</span><br><span class="line">        Date date = <span class="keyword">new</span> Date();</span><br><span class="line">        <span class="comment">// 确认满足修改条件后对用户信息进行更新</span></span><br><span class="line">        userMybatis.setPassword(Md5Util.md5(modifyDTO.getNewPassword()));</span><br><span class="line">        userMybatis.setGmtModified(date);</span><br><span class="line">        userMybatisMapper.update(userMybatis);</span><br><span class="line">        responseVO.success(<span class="string">"密码修改成功！"</span>);</span><br><span class="line">        <span class="keyword">return</span> responseVO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 删除用户 */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span>(rollbackFor = Exception<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">ResponseVO</span> <span class="title">delete</span>(<span class="title">DeleteDTO</span> <span class="title">deleteDTO</span>) </span>&#123;</span><br><span class="line">        ResponseVO responseVO = <span class="keyword">new</span> ResponseVO();</span><br><span class="line">        Date date = <span class="keyword">new</span> Date();</span><br><span class="line">        <span class="keyword">int</span> deleteResult = userMybatisMapper.updateStatusByUserId(deleteDTO.getUerId(),date);</span><br><span class="line">        <span class="keyword">if</span>(deleteResult != <span class="number">1</span>)&#123;</span><br><span class="line">            responseVO.fail(<span class="string">"删除失败，没有更新到或者更新了多条记录！"</span>);</span><br><span class="line">            <span class="keyword">return</span>  responseVO;</span><br><span class="line">        &#125;</span><br><span class="line">        responseVO.success(<span class="string">"用户删除成功！"</span>);</span><br><span class="line">        <span class="keyword">return</span> responseVO;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="测试用例"><a href="#测试用例" class="headerlink" title="测试用例"></a>测试用例</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringRunner<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">SpringBootTest</span></span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">JavaSpringWingoApplicationTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span>(name = <span class="string">"userServiceMybatisImpl"</span>)</span><br><span class="line">    UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Md5Util 输出 */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMd5</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(Md5Util.md5(<span class="string">"e10adc3949ba59abbe56e057f20f883e"</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 测试注册接口 */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@Rollback</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testRegister</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 构造注册的测试数据</span></span><br><span class="line">        RegisterDTO registerDTO = <span class="keyword">new</span> RegisterDTO();</span><br><span class="line">        registerDTO.setUsername(<span class="string">"Jay"</span>);</span><br><span class="line">        registerDTO.setPassword(<span class="string">"123456"</span>);</span><br><span class="line">        <span class="comment">// 处理业务</span></span><br><span class="line">        ResponseVO responseVO = userService.register(registerDTO);</span><br><span class="line">        <span class="comment">// 测试断言</span></span><br><span class="line">        assertEquals(ResponseConstant.SUCCESS, responseVO.get(<span class="string">"code"</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 测试登录接口 */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testLogin</span><span class="params">()</span></span>&#123;</span><br><span class="line">        LoginDTO loginDTO = <span class="keyword">new</span> LoginDTO();</span><br><span class="line">        loginDTO.setUsername(<span class="string">"Tom"</span>);</span><br><span class="line">        loginDTO.setPassword(<span class="string">"123456"</span>);</span><br><span class="line">        loginDTO.setType(<span class="number">0</span>);</span><br><span class="line">        ResponseVO responseVO = userService.login(loginDTO);</span><br><span class="line">        assertEquals(ResponseConstant.SUCCESS, responseVO.get(<span class="string">"code"</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 测试添加接口 */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@Rollback</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAdd</span><span class="params">()</span></span>&#123;</span><br><span class="line">        AddDTO addDTO = <span class="keyword">new</span> AddDTO();</span><br><span class="line">        addDTO.setUsername(<span class="string">"Tim"</span>);</span><br><span class="line">        addDTO.setPassword(<span class="string">"123456"</span>);</span><br><span class="line">        ResponseVO responseVO = userService.add(addDTO);</span><br><span class="line">        assertEquals(ResponseConstant.SUCCESS, responseVO.get(<span class="string">"code"</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 测试用户列表接口 */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testView</span><span class="params">()</span></span>&#123;</span><br><span class="line">        ResponseVO responseVO = userService.view();</span><br><span class="line">        System.out.println(responseVO);</span><br><span class="line">        assertEquals(ResponseConstant.SUCCESS, responseVO.get(<span class="string">"code"</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 测试修改密码接口*/</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@Rollback</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testModify</span><span class="params">()</span></span>&#123;</span><br><span class="line">        ModifyDTO modifyDTO = <span class="keyword">new</span> ModifyDTO();</span><br><span class="line">        modifyDTO.setUsername(<span class="string">"Jay"</span>);</span><br><span class="line">        modifyDTO.setType(<span class="number">0</span>);</span><br><span class="line">        modifyDTO.setPassword(<span class="string">"123456"</span>);</span><br><span class="line">        modifyDTO.setNewPassword(<span class="string">"654321"</span>);</span><br><span class="line">        modifyDTO.setConfirmNewPassword(<span class="string">"654321"</span>);</span><br><span class="line">        ResponseVO responseVO = userService.modify(modifyDTO);</span><br><span class="line">        assertEquals(ResponseConstant.SUCCESS, responseVO.get(<span class="string">"code"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="控制层"><a href="#控制层" class="headerlink" title="控制层"></a>控制层</h3><h4 id="Swagger-整合"><a href="#Swagger-整合" class="headerlink" title="Swagger 整合"></a>Swagger 整合</h4><p>用于浏览器请求测试。</p>
<blockquote>
<p>也可采用 Spring Boot 提供的 swagger 的 stater，利用启动器的方式添加依赖，可以直在 Spring Boot 的配置文件中配置 swagger 的配置信息。</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 添加 Swagger 的支持 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>配置类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableSwagger</span>2</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SwaggerConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Docket <span class="title">createRestApi</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2).apiInfo(apiInfo())</span><br><span class="line">                .select()</span><br><span class="line">                .apis(RequestHandlerSelectors.basePackage(<span class="string">"com.wingo.user.controller"</span>))</span><br><span class="line">                .paths(PathSelectors.any()).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> ApiInfo <span class="title">apiInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ApiInfoBuilder().title(<span class="string">"Swagger RESTful APIs"</span>)</span><br><span class="line">                .description(<span class="string">"Swagger API 服务"</span>)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="代码编写"><a href="#代码编写" class="headerlink" title="代码编写"></a>代码编写</h4><blockquote>
<ul>
<li>Model model：Spring MVC 提供了一个<code>Model</code>用于暴露后端传递给页面的信息，通过<code>addAttribute(K, V)</code>方法添加数据，并且在前端的模板引擎页面通过<code>${K}</code>取得对应的<code>V</code>；</li>
<li>HttpServletResponse httpServletResponse：<code>encodeRedirectURL(Url)</code>方法进行页面跳转，跳转的同时携带域中的信息；</li>
<li>HttpSession httpSession：<code>setAttribute(K, V)</code>方法在 Session 域中添加信息。</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 注入 UserService */</span></span><br><span class="line">    <span class="meta">@Resource</span>(name = <span class="string">"userServiceMybatisImpl"</span>)</span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 处理用户注册的请求 */</span></span><br><span class="line">    <span class="meta">@ApiOperation</span>(<span class="string">"用户注册接口"</span>)</span><br><span class="line">    <span class="meta">@PostMapping</span>(value = <span class="string">"/register"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">register</span><span class="params">(Model model, @Valid @ModelAttribute(value = <span class="string">"registerDTO"</span>)</span> RegisterDTO registerDTO, HttpServletResponse httpServletResponse) </span>&#123;</span><br><span class="line">        ResponseVO responseVO = userService.register(registerDTO);</span><br><span class="line">        model.addAttribute(ResponseConstant.RESPONSE_VO, responseVO);</span><br><span class="line">        <span class="keyword">if</span> (ResponseConstant.SUCCESS.equals(responseVO.get(ResponseConstant.CODE))) &#123;</span><br><span class="line">            <span class="comment">// 注册成功，重定向到前端登录页面 login.html，并且携带数据过去</span></span><br><span class="line">            <span class="keyword">return</span> httpServletResponse.encodeRedirectURL(UrlConstant.LOGIN);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 注册失败，跳转到注册页面，并将失败的信息返回</span></span><br><span class="line">        <span class="keyword">return</span> httpServletResponse.encodeRedirectURL(UrlConstant.REGISTER);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成图形验证码</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> NoSuchAlgorithmException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiIgnore</span></span><br><span class="line">    <span class="meta">@GetMapping</span>(value = <span class="string">"/imageCode"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">imageCode</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> IOException, NoSuchAlgorithmException </span>&#123;</span><br><span class="line">        OutputStream os = response.getOutputStream();</span><br><span class="line">        <span class="comment">// 生成验证码</span></span><br><span class="line">        Map&lt;String, Object&gt; map = ImageCodeUtil.getImageCode(<span class="number">60</span>, <span class="number">20</span>, <span class="number">4</span>);</span><br><span class="line">        <span class="comment">// 放入客户端的 Session 对象中</span></span><br><span class="line">        request.getSession().setAttribute(ImageCodeConstant.SIMPLE_CAPTCHA,</span><br><span class="line">                                          map.get(ImageCodeConstant.CAPTCHA_VALUE).toString().toLowerCase());</span><br><span class="line">        <span class="comment">// 设置验证码的生成时间，并放入客户端 Session 对象中</span></span><br><span class="line">        request.getSession().setAttribute(ImageCodeConstant.CODE_TIME, System.currentTimeMillis());</span><br><span class="line">        <span class="comment">// 将生成的验证码图片写到图片输出流</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ImageIO.write((BufferedImage) map.get(ImageCodeConstant.IMAGE), ImageCodeConstant.JPEG, os);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            log.error(<span class="string">"图形验证码生成异常"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 处理用户的登录请求 */</span></span><br><span class="line">    <span class="meta">@ApiIgnore</span></span><br><span class="line">    <span class="meta">@PostMapping</span>(value = <span class="string">"/login"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">(Model model, @Valid @ModelAttribute(value = <span class="string">"loginDTO"</span>)</span> LoginDTO loginDTO,</span></span><br><span class="line"><span class="function">                        HttpServletResponse httpServletResponse, HttpSession httpSession) </span>&#123;</span><br><span class="line">        ResponseVO responseVO = <span class="keyword">new</span> ResponseVO();</span><br><span class="line">        <span class="comment">// 取得用户填写的验证码</span></span><br><span class="line">        String checkCode = loginDTO.getCheckCode();</span><br><span class="line">        <span class="comment">// 从 Session 中取得存入的验证码信息</span></span><br><span class="line">        Object sessionImageCode = httpSession.getAttribute(ImageCodeConstant.SIMPLE_CAPTCHA);</span><br><span class="line">        <span class="comment">// 获取验证码信息失败</span></span><br><span class="line">        <span class="keyword">if</span>(sessionImageCode == <span class="keyword">null</span>)&#123;</span><br><span class="line">            responseVO.fail(<span class="string">"请填写验证码"</span>);</span><br><span class="line">            model.addAttribute(ResponseConstant.RESPONSE_VO, responseVO);</span><br><span class="line">            <span class="keyword">return</span> httpServletResponse.encodeRedirectURL(UrlConstant.LOGIN);</span><br><span class="line">        &#125;</span><br><span class="line">        String code = sessionImageCode.toString();</span><br><span class="line">        <span class="comment">// 检测验证码</span></span><br><span class="line">        Date date = <span class="keyword">new</span> Date();</span><br><span class="line">        Long codeTime = Long.valueOf(httpSession.getAttribute(ImageCodeConstant.CODE_TIME) + <span class="string">""</span>);</span><br><span class="line">        <span class="comment">// 验证码是否填写正确</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isBlank(checkCode) || StringUtils.isBlank(code) || !(checkCode.equalsIgnoreCase(code))) &#123;</span><br><span class="line">            responseVO.fail(<span class="string">"验证码不一致"</span>);</span><br><span class="line">            model.addAttribute(ResponseConstant.RESPONSE_VO, responseVO);</span><br><span class="line">            <span class="keyword">return</span> httpServletResponse.encodeRedirectURL(UrlConstant.LOGIN);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 验证码是否过期（有效期为 5 分钟）</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((date.getTime() - codeTime) / ImageCodeConstant.MILLISECOND_CONVERSION</span><br><span class="line">                 / ImageCodeConstant.MINUTE_CONVERSION &gt; ImageCodeConstant.CAPTCHA_EXPIRY_TIME) &#123;</span><br><span class="line">            responseVO.fail(<span class="string">"验证码已过期"</span>);</span><br><span class="line">            model.addAttribute(ResponseConstant.RESPONSE_VO, responseVO);</span><br><span class="line">            <span class="keyword">return</span> httpServletResponse.encodeRedirectURL(UrlConstant.LOGIN);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 处理用户登录业务</span></span><br><span class="line">        responseVO = userService.login(loginDTO);</span><br><span class="line">        <span class="comment">// 将结果放入 model 中，在模板中可以取到 model 中的值</span></span><br><span class="line">        <span class="comment">// 这里就是交互的一个重要地方，我们可以在模板中通过这些属性值访问到数据</span></span><br><span class="line">        model.addAttribute(ResponseConstant.RESPONSE_VO, responseVO);</span><br><span class="line">        <span class="comment">// 设置登录 session，模版引擎使用</span></span><br><span class="line">        httpSession.setAttribute(UserConstant.USERNAME, loginDTO.getUsername());</span><br><span class="line">        httpSession.setAttribute(UserConstant.TYPE, loginDTO.getType());</span><br><span class="line">        <span class="comment">// 将类型码转换为中文说明</span></span><br><span class="line">        httpSession.setAttribute(UserConstant.TYPE_NAME, UserTypeConstant.typeToDesc(loginDTO.getType()));</span><br><span class="line">        <span class="comment">// 组装结果返回</span></span><br><span class="line">        <span class="keyword">if</span> (responseVO == <span class="keyword">null</span> || !ResponseConstant.SUCCESS.equals(responseVO.get(ResponseConstant.CODE))) &#123;</span><br><span class="line">            <span class="comment">// 登录失败则跳转到前端登录页面 login.html</span></span><br><span class="line">            <span class="keyword">return</span> httpServletResponse.encodeRedirectURL(UrlConstant.LOGIN);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 登录成功重定向到前端首页 index.html，并且携带数据过去</span></span><br><span class="line">        <span class="keyword">return</span> httpServletResponse.encodeRedirectURL(UrlConstant.INDEX);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 处理查看用户列表的请求 */</span></span><br><span class="line">    <span class="meta">@ApiIgnore</span></span><br><span class="line">    <span class="meta">@GetMapping</span>(value = <span class="string">"/users"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">users</span><span class="params">(Model model, HttpServletResponse httpServletResponse)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 处理用户列表查看业务</span></span><br><span class="line">        ResponseVO responseVO = userService.view();</span><br><span class="line">        model.addAttribute(ResponseConstant.RESPONSE_VO, responseVO);</span><br><span class="line">        <span class="comment">// 开始重定向前端用户列表也 view.html，携带数据过去了。</span></span><br><span class="line">        <span class="keyword">return</span> httpServletResponse.encodeRedirectURL(UrlConstant.VIEW);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 处理新增用户的请求 */</span></span><br><span class="line">    <span class="meta">@ApiOperation</span>(<span class="string">"用户新增接口"</span>)</span><br><span class="line">    <span class="meta">@PostMapping</span>(value = <span class="string">"/user"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">user</span><span class="params">(Model model, @Valid @ModelAttribute(value = <span class="string">"addDTO"</span>)</span> AddDTO addDTO,</span></span><br><span class="line"><span class="function">                       HttpServletResponse httpServletResponse) </span>&#123;</span><br><span class="line">        <span class="comment">// 处理新增用户业务</span></span><br><span class="line">        ResponseVO responseVO = userService.add(addDTO);</span><br><span class="line">        <span class="comment">// 将处理结果写入到返回对象中</span></span><br><span class="line">        model.addAttribute(ResponseConstant.RESPONSE_VO, responseVO);</span><br><span class="line">        <span class="comment">// 用户添加失败，重定向到前端页面 user.html</span></span><br><span class="line">        <span class="keyword">if</span> (responseVO == <span class="keyword">null</span> || !ResponseConstant.SUCCESS.equals(responseVO.get(ResponseConstant.CODE)))&#123;</span><br><span class="line">            <span class="keyword">return</span> httpServletResponse.encodeRedirectURL(UrlConstant.USER);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 处理成功</span></span><br><span class="line">        responseVO = userService.view();</span><br><span class="line">        model.addAttribute(ResponseConstant.RESPONSE_VO, responseVO);</span><br><span class="line">        <span class="comment">// 开始重定向，携带数据过去</span></span><br><span class="line">        <span class="keyword">return</span> httpServletResponse.encodeRedirectURL(UrlConstant.VIEW);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 删除用户 */</span></span><br><span class="line">    <span class="meta">@ApiOperation</span>(<span class="string">"删除用户接口"</span>)</span><br><span class="line">    <span class="meta">@GetMapping</span>(value = <span class="string">"/delete"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">delete</span><span class="params">(Model model, @Valid @ModelAttribute(value = <span class="string">"deleteDTO"</span>)</span> DeleteDTO deleteDTO,</span></span><br><span class="line"><span class="function">                         HttpServletResponse httpServletResponse) </span>&#123;</span><br><span class="line">        <span class="comment">// 处理逻辑删除用户业务</span></span><br><span class="line">        ResponseVO responseVO = userService.delete(deleteDTO);</span><br><span class="line">        <span class="comment">// 删除失败返回错误信息</span></span><br><span class="line">        <span class="keyword">if</span>(responseVO.get(ResponseConstant.CODE).equals(ResponseConstant.FAIL))&#123;</span><br><span class="line">            model.addAttribute(ResponseConstant.RESPONSE_VO, responseVO);</span><br><span class="line">            <span class="keyword">return</span> httpServletResponse.encodeRedirectURL(UrlConstant.VIEW);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 删除成功后再查询用户列表数据，返回删除后的最新用户列表数据</span></span><br><span class="line">        responseVO = userService.view();</span><br><span class="line">        <span class="keyword">if</span> (responseVO != <span class="keyword">null</span>) &#123;</span><br><span class="line">            model.addAttribute(ResponseConstant.RESPONSE_VO, responseVO);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 逻辑删除用户后，跳转到用户前端列表页 view.jsp</span></span><br><span class="line">        <span class="keyword">return</span> httpServletResponse.encodeRedirectURL(UrlConstant.VIEW);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 处理用户信息修改的请求 */</span></span><br><span class="line">    <span class="meta">@ApiIgnore</span></span><br><span class="line">    <span class="meta">@PostMapping</span>(value = <span class="string">"/modify"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toModify</span><span class="params">(Model model, @Valid @ModelAttribute(value = <span class="string">"modifyDTO"</span>)</span> ModifyDTO modifyDTO,</span></span><br><span class="line"><span class="function">                           HttpServletResponse httpServletResponse, HttpSession httpSession) </span>&#123;</span><br><span class="line">        <span class="comment">// 从 Session 中取得用户名字及类型</span></span><br><span class="line">        String strUsername = httpSession.getAttribute(UserConstant.USERNAME).toString();</span><br><span class="line">        String strType = httpSession.getAttribute(UserConstant.TYPE).toString();</span><br><span class="line">        modifyDTO.setUsername(strUsername);</span><br><span class="line">        modifyDTO.setType(strType);</span><br><span class="line">        <span class="comment">// 处理用户信息修改业务</span></span><br><span class="line">        ResponseVO responseVO = userService.modify(modifyDTO);</span><br><span class="line">        <span class="comment">// 将结果放入 Model 中，在模板中可以取到 Model 中的值</span></span><br><span class="line">        model.addAttribute(ResponseConstant.RESPONSE_VO, responseVO);</span><br><span class="line">        <span class="keyword">if</span> (responseVO == <span class="keyword">null</span> || !ResponseConstant.SUCCESS.equals(responseVO.get(ResponseConstant.CODE))) &#123;</span><br><span class="line">            <span class="comment">// 修改失败时，继续重定向到前端用户信息修改页面 modify.html</span></span><br><span class="line">            <span class="keyword">return</span> httpServletResponse.encodeRedirectURL(UrlConstant.MODIFY);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 密码修改成功，从 Session 中删除 user 属性，用户退出登录</span></span><br><span class="line">        httpSession.removeAttribute(UserConstant.USERNAME);</span><br><span class="line">        httpSession.removeAttribute(UserConstant.TYPE);</span><br><span class="line">        httpSession.removeAttribute(UserConstant.TYPE_NAME);</span><br><span class="line">        <span class="comment">// 开始重定向前端登录页面 login.html，并且携带数据过去</span></span><br><span class="line">        <span class="keyword">return</span> httpServletResponse.encodeRedirectURL(UrlConstant.LOGIN);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 注销登录 */</span></span><br><span class="line">    <span class="meta">@ApiIgnore</span></span><br><span class="line">    <span class="meta">@GetMapping</span>(value = <span class="string">"/loginOut"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">loginOut</span><span class="params">(HttpSession httpSession, HttpServletResponse httpServletResponse)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 从 Session 中删除 user 属性，用户退出登录</span></span><br><span class="line">        httpSession.removeAttribute(UserConstant.USERNAME);</span><br><span class="line">        httpSession.removeAttribute(UserConstant.TYPE);</span><br><span class="line">        httpSession.removeAttribute(UserConstant.TYPE_NAME);</span><br><span class="line">        <span class="comment">// 开始重定向到前端页面 login.html</span></span><br><span class="line">        <span class="keyword">return</span> httpServletResponse.encodeRedirectURL(UrlConstant.LOGIN);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 处理 Get:/index 请求 */</span></span><br><span class="line">    <span class="meta">@ApiIgnore</span></span><br><span class="line">    <span class="meta">@GetMapping</span>(value=<span class="string">"/index"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">index</span><span class="params">(HttpServletResponse httpServletResponse)</span></span>&#123;</span><br><span class="line">        <span class="comment">// 重定向到前端页面 index.html</span></span><br><span class="line">        <span class="keyword">return</span> httpServletResponse.encodeRedirectURL(UrlConstant.INDEX);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 省略余下页面跳方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Thymeleaf"><a href="#Thymeleaf" class="headerlink" title="Thymeleaf"></a>Thymeleaf</h3><p>引入依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 支持 Thymeleaf --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>配置 Thymeleaf：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## Thymeleaf 配置</span></span><br><span class="line"><span class="meta">spring.thymeleaf.prefix</span>=<span class="string">classpath:/templates</span></span><br><span class="line"><span class="meta">spring.thymeleaf.suffix</span>=<span class="string">.html</span></span><br><span class="line"><span class="meta">spring.thymeleaf.mode</span>=<span class="string">HTML</span></span><br><span class="line"><span class="meta">spring.thymeleaf.servlet.content-type</span>=<span class="string">text/html</span></span><br><span class="line"><span class="meta">spring.thymeleaf.cache</span>=<span class="string">false</span></span><br><span class="line"><span class="meta">spring.thymeleaf.enabled</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure>

<h4 id="login-html"><a href="#login-html" class="headerlink" title="login.html"></a>login.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">"http://www.thymeleaf.org"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">th:if</span>=<span class="string">"$&#123;responseVO != null &amp;&amp; responseVO.get('message') != null&#125;"</span> <span class="attr">th:text</span>=<span class="string">"$&#123;responseVO.get('message')&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">th:action</span>=<span class="string">"@&#123;/login&#125;"</span> <span class="attr">th:object</span>=<span class="string">"$&#123;loginDTO&#125;"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"height: 27px"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"username"</span>&gt;</span>用户名: <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">id</span>=<span class="string">"username"</span> <span class="attr">placeholder</span>=<span class="string">"用户名"</span></span></span><br><span class="line"><span class="tag">                       <span class="attr">th:value</span>=<span class="string">"$&#123;registerDTO !=null &amp;&amp; registerDTO.username != null&#125; ? $&#123;registerDTO.username&#125; : ''"</span></span></span><br><span class="line"><span class="tag">                       /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"height: 27px"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"password"</span>&gt;</span>密码: <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">id</span>=<span class="string">"password"</span> <span class="attr">placeholder</span>=<span class="string">"密码"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"height: 27px"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"checkCode"</span> <span class="attr">class</span>=<span class="string">"green"</span>&gt;</span>验证码: <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"checkCode"</span> <span class="attr">name</span>=<span class="string">"checkCode"</span> <span class="attr">class</span>=<span class="string">"checkCode"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">placeholder</span>=<span class="string">"验证码"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">img</span> <span class="attr">style</span>=<span class="string">"cursor: pointer; margin-left: 3px;"</span> <span class="attr">th:src</span>=<span class="string">"@&#123;/imageCode&#125;"</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">onclick</span>=<span class="string">"this.src=this.src + '?' + new Date().valueOf();"</span> <span class="attr">id</span>=<span class="string">"validateImg"</span> <span class="attr">alt</span>=<span class="string">"验证码"</span> <span class="attr">class</span>=<span class="string">"codePic"</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">title</span>=<span class="string">"验证码。点击此处更新验证码。"</span></span></span><br><span class="line"><span class="tag">       			/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"height: 27px"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"type"</span>&gt;</span>用户类型: <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"type"</span> <span class="attr">name</span>=<span class="string">"type"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">option</span> <span class="attr">type</span>=<span class="string">"number"</span> <span class="attr">value</span>=<span class="string">"0"</span> &gt;</span>普通用户<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">option</span> <span class="attr">type</span>=<span class="string">"number"</span> <span class="attr">value</span>=<span class="string">"1"</span> &gt;</span>管理员用户<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"登录"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="index-html"><a href="#index-html" class="headerlink" title="index.html"></a>index.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">"http://www.thymeleaf.org"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>登录后的首页<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h4</span>&gt;</span></span><br><span class="line">        欢迎您：<span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"color: red"</span> <span class="attr">th:text</span>=<span class="string">"$&#123;session.username&#125;?$&#123;session.username&#125;:'（您未登录）'"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span>, 用户身份是：<span class="tag">&lt;<span class="name">span</span></span></span><br><span class="line"><span class="tag">            <span class="attr">style</span>=<span class="string">"color: red"</span> <span class="attr">th:text</span>=<span class="string">"$&#123;session.typeName&#125;?$&#123;session.typeName&#125;:'（您未登录）'"</span></span></span><br><span class="line"><span class="tag">        &gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th:block</span> <span class="attr">th:if</span>=<span class="string">"$&#123;session.username != null&#125;"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">"@&#123;/users&#125;"</span> <span class="attr">th:if</span>=<span class="string">"$&#123;session.typeName eq '管理员'&#125;"</span>&gt;</span>查看用户列表<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">"@&#123;/user&#125;"</span> <span class="attr">th:if</span>=<span class="string">"$&#123;session.typeName eq '管理员'&#125; "</span>&gt;</span>添加用户<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">"@&#123;/modify&#125;"</span>&gt;</span>修改密码<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">"@&#123;/loginOut&#125;"</span>&gt;</span>注销登录<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">th:block</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="modify-html"><a href="#modify-html" class="headerlink" title="modify.html"></a>modify.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">"http://www.thymeleaf.org"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>修改密码<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">th:if</span>=<span class="string">"$&#123;responseVO != null &amp;&amp; responseVO.get('message') != null&#125;"</span> <span class="attr">th:text</span>=<span class="string">"$&#123;responseVO.get('message')&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th:block</span> <span class="attr">th:if</span>=<span class="string">"$&#123;session.username != null&#125;"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">th:action</span>=<span class="string">"@&#123;/modify&#125;"</span> <span class="attr">th:object</span>=<span class="string">"$&#123;modifyDTO&#125;"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"password"</span>&gt;</span>原密码:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">id</span>=<span class="string">"password"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"newPassword"</span>&gt;</span>新密码:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"newPassword"</span> <span class="attr">id</span>=<span class="string">"newPassword"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"confirmNewPassword"</span>&gt;</span>确认新密码:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"confirmNewPassword"</span> <span class="attr">id</span>=<span class="string">"confirmNewPassword"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"确认修改"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">th:block</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="register-html"><a href="#register-html" class="headerlink" title="register.html"></a>register.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">"http://www.thymeleaf.org"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>用户注册<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">th:if</span>=<span class="string">"$&#123;responseVO != null &amp;&amp; responseVO.get('message') != null&#125;"</span> <span class="attr">th:text</span>=<span class="string">"$&#123;responseVO.get('message')&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">th:action</span>=<span class="string">"@&#123;/register&#125;"</span> <span class="attr">th:object</span>=<span class="string">"$&#123;registerDTO&#125;"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"username"</span>&gt;</span>用户名:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">id</span>=<span class="string">"username"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"password"</span>&gt;</span>密码:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">id</span>=<span class="string">"password"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"注册"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="user-html"><a href="#user-html" class="headerlink" title="user.html"></a>user.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">"http://www.thymeleaf.org"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>添加用户<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">th:if</span>=<span class="string">"$&#123;responseVO != null &amp;&amp; responseVO.get('message') != null&#125;"</span> <span class="attr">th:text</span>=<span class="string">"$&#123;responseVO.get('message')&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th:block</span> <span class="attr">th:if</span>=<span class="string">"$&#123;session.username != null &amp;&amp; session.typeName == '管理员'&#125;"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">th:action</span>=<span class="string">"@&#123;/user&#125;"</span> <span class="attr">th:object</span>=<span class="string">"$&#123;addDTO&#125;"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"username"</span>&gt;</span>用户名:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">id</span>=<span class="string">"username"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"password"</span>&gt;</span>密码:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">id</span>=<span class="string">"password"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"添加"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">th:block</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="view-html"><a href="#view-html" class="headerlink" title="view.html"></a>view.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">"http://www.thymeleaf.org"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>查看用户列表<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>ID<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>名字<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>用户类型<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>注册时间<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>操作类型<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">th:block</span> <span class="attr">th:if</span>=<span class="string">"$&#123;session.username != null &amp;&amp; session.typeName == '管理员'&#125;"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 循环展示普通用户清单 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th:block</span> <span class="attr">th:if</span>=<span class="string">"$&#123;responseVO.get('data').viewVO != null&#125;"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:each</span>=<span class="string">"ViewVO : $&#123;responseVO.get('data').viewVO&#125;"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">"$&#123;ViewVO.userId&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">"$&#123;ViewVO.username&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">"$&#123;ViewVO.type&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">"$&#123;#dates.format(ViewVO.gmtCreate, 'yyyy-MM-dd')&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">"@&#123;/delete(uerId=$&#123;ViewVO.userId&#125;)&#125;"</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">th:block</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">th:block</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="过滤器"><a href="#过滤器" class="headerlink" title="过滤器"></a>过滤器</h3><p>对某些特定页面的访问需要有一定的前提条件：比如用户是否登录，用户是否拥有访问此页面的权限等。要实现这样的功能可以使用 Filter。</p>
<blockquote>
<p>过滤器执行顺序：<br>(1) 通过实例化 FilterRegistrationBean 类自定义 Filter，setOrder() 方法可以定义执行顺序。（小的优先）<br>(2) 通过限定类名限定 Filter 的顺序。（默认初始化过滤器时进行了类名的排序）</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@WebFilter</span>(filterName = <span class="string">"/Filter0Session"</span>, </span><br><span class="line">           urlPatterns = &#123;<span class="string">"/index"</span>, <span class="string">"/add"</span>, <span class="string">"/modify"</span>, <span class="string">"/view"</span>, <span class="string">"/delete"</span>, <span class="string">"/loginOut"</span>&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Filter0Session</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Filter0Session</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 过滤器初始化方法，web 服务器根据配置创建 Filter 实例 */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig fConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">        <span class="comment">// Do nothing.</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        HttpServletRequest httpServletRequest = (HttpServletRequest) request;</span><br><span class="line">        HttpServletResponse httpServletResponse = (HttpServletResponse) response;</span><br><span class="line">        HttpSession httpSession = httpServletRequest.getSession(<span class="keyword">false</span>);</span><br><span class="line">        <span class="keyword">if</span> (httpSession != <span class="keyword">null</span> &amp;&amp; httpSession.getAttribute(UserConstant.USERNAME) != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 用户已登录则放行</span></span><br><span class="line">            chain.doFilter(request, response);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 检测到用户未登录则跳转重定向到登陆页面</span></span><br><span class="line">            httpServletResponse.sendRedirect(<span class="string">"/login"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/** 过滤器销毁方法，可以释放过滤器使用的资源 */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Do nothing.</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@WebFilter</span>(filterName = <span class="string">"/Filter1Admin"</span>, urlPatterns = &#123;<span class="string">"/add"</span>, <span class="string">"/view"</span>, <span class="string">"/delete"</span>&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Filter1Admin</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Filter1Admin</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig fConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">        <span class="comment">// Do nothing.</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        HttpServletRequest httpServletRequest = (HttpServletRequest) request;</span><br><span class="line">        HttpServletResponse httpServletResponse = (HttpServletResponse) response;</span><br><span class="line">        HttpSession httpSession = httpServletRequest.getSession(<span class="keyword">false</span>);</span><br><span class="line">        <span class="comment">// 检测用户是否登录，并且用户类型是否为管理员</span></span><br><span class="line">        <span class="keyword">if</span> (httpSession != <span class="keyword">null</span> &amp;&amp; httpSession.getAttribute(UserConstant.USERNAME) != <span class="keyword">null</span></span><br><span class="line">            &amp;&amp; httpSession.getAttribute(UserConstant.TYPE) != <span class="keyword">null</span></span><br><span class="line">            &amp;&amp; UserTypeConstant.ADMIN.equals(httpSession.getAttribute(UserConstant.TYPE))) &#123;</span><br><span class="line">            chain.doFilter(request, response);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            httpServletResponse.sendRedirect( <span class="string">"/login"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Do nothing.</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>！！！@ServletComponentScan(value = “com.wingo.user.filter”)</p>
</blockquote>
<h3 id="全局异常处理"><a href="#全局异常处理" class="headerlink" title="全局异常处理"></a>全局异常处理</h3><p>对于前端传输的数据，在 DTO 类中添加 JSR303 校验，在测试的时候发现此校验的抛出异常时，Spring Boot 会自动跳转到默认的 error 页面。原因在于项目中未对此校验索抛出的异常进行处理。先看看校验后所抛出的异常信息。</p>
<p>Spring Boot 默认的错误提示页面：</p>
<p><img src="http://welab-wingo.gitee.io/image/2020/03/UserManagementSystem/ValidError01.png" alt=""></p>
<p>控制台抛出的异常<code>BindException: org.springframework.validation.BeanPropertyBindingResult: 3 errors</code></p>
<blockquote>
<p>可以在 controller 类中添加 try{ }catch{ } 异常处理块捕捉异常抛出，并进行处理（如返回 Json）。但这样代码很不美观，推荐使用的方式是用注解 @ControllerAdvice + @ExceptionHandler 全局处理 Controller 层异常。</p>
</blockquote>
<p>编写全局处理类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@ControllerAdvice</span> <span class="comment">// 声明全局的异常处理类</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalExceptionHandler</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// 定义捕捉的异常</span></span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(BindException<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    @<span class="title">ResponseStatus</span>(<span class="title">HttpStatus</span>.<span class="title">BAD_REQUEST</span>)</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">ResponseVO</span> <span class="title">resolveMethodArgumentNotValidException</span>(<span class="title">BindException</span> <span class="title">exception</span>) </span>&#123;</span><br><span class="line">        ResponseVO response = <span class="keyword">new</span> ResponseVO();</span><br><span class="line">        <span class="comment">// 定义字段及校验异常信息的 key / value 结构</span></span><br><span class="line">        Map&lt;String, String&gt; fieldAndMessage = <span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">16</span>);</span><br><span class="line">        StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="comment">// 组装字段及校验异常信息</span></span><br><span class="line">        <span class="keyword">for</span> (FieldError fieldError : exception.getBindingResult().getFieldErrors()) &#123;</span><br><span class="line">            fieldAndMessage.put(fieldError.getField(), fieldError.getDefaultMessage());</span><br><span class="line">            sb.append(fieldError.getField()).append(<span class="string">":"</span>).append(fieldError.getDefaultMessage()).append(<span class="string">";"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        String strField = sb.toString();</span><br><span class="line">        <span class="comment">// 组装异常信息：从自定义的异常信息枚举类中取得信息</span></span><br><span class="line">        response.setCode(ResponseCodeTypeEnum.PARAMETER_ERROR.getCode());</span><br><span class="line">        response.setMessage(ResponseCodeTypeEnum.PARAMETER_ERROR.getMessage());</span><br><span class="line">        <span class="comment">// 方便调试：将异常统一打印出来</span></span><br><span class="line">        log.warn(<span class="string">"BindException.class 异常信息: &#123;&#125;"</span>, strField);</span><br><span class="line">        <span class="comment">// 返回 Json</span></span><br><span class="line">        <span class="keyword">return</span> response;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：此时已不显示默认的错误页面，而是显示由用户定义的 Json 字符串。</p>
<p><img src="http://welab-wingo.gitee.io/image/2020/03/UserManagementSystem/ValidError02.png" alt=""></p>
<p>控制台输出：方便开发调试。</p>
<p><img src="http://welab-wingo.gitee.io/image/2020/03/UserManagementSystem/ValidError03.png" alt=""></p>
<h3 id="自定义-SQL-日志打印"><a href="#自定义-SQL-日志打印" class="headerlink" title="自定义 SQL 日志打印"></a>自定义 SQL 日志打印</h3><p>当开启 Mybatis 的默认日志打印，控制台的 SQL 默认打印样式：</p>
<p><img src="http://welab-wingo.gitee.io/image/2020/03/UserManagementSystem/SQLLog01.png" alt=""></p>
<p>自定义拦截器：</p>
<p>[Mybatis 插件拦截器]([<a href="https://welab-wingo.cn/2020/03/29/Software/Mybatis/Mybatis%20%E6%8F%92%E4%BB%B6%E4%B9%8B%E6%8B%A6%E6%88%AA%E5%99%A8/]" target="_blank" rel="noopener">https://welab-wingo.cn/2020/03/29/Software/Mybatis/Mybatis%20%E6%8F%92%E4%BB%B6%E4%B9%8B%E6%8B%A6%E6%88%AA%E5%99%A8/]</a>(<a href="https://welab-wingo.cn/2020/03/29/Software/Mybatis/Mybatis" target="_blank" rel="noopener">https://welab-wingo.cn/2020/03/29/Software/Mybatis/Mybatis</a> 插件之拦截器/))</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Intercepts</span>(&#123;<span class="meta">@Signature</span>(type = Executor<span class="class">.<span class="keyword">class</span>, <span class="title">method</span> </span>= <span class="string">"update"</span>, </span><br><span class="line">                        args = &#123;MappedStatement<span class="class">.<span class="keyword">class</span>, <span class="title">Object</span>.<span class="title">class</span>&#125;),</span></span><br><span class="line"><span class="class">        @<span class="title">Signature</span>(<span class="title">type</span> </span>= Executor<span class="class">.<span class="keyword">class</span>, <span class="title">method</span> </span>= <span class="string">"query"</span>,</span><br><span class="line">                args = &#123;MappedStatement<span class="class">.<span class="keyword">class</span>, <span class="title">Object</span>.<span class="title">class</span>, <span class="title">RowBounds</span>.<span class="title">class</span>, <span class="title">ResultHandler</span>.<span class="title">class</span>&#125;)&#125;)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">SqlInterceptor</span> <span class="keyword">implements</span> <span class="title">Interceptor</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Properties properties;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">intercept</span><span class="params">(Invocation invocation)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        <span class="comment">// MappedStatement 维护了一条 mapper.xml 文件里面 select 、update、delete、insert 节点的封装</span></span><br><span class="line">        MappedStatement mappedStatement = (MappedStatement) invocation.getArgs()[<span class="number">0</span>];</span><br><span class="line">        Object parameter = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (invocation.getArgs().length &gt; <span class="number">1</span>) &#123;</span><br><span class="line">            parameter = invocation.getArgs()[<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        String sqlId = mappedStatement.getId();</span><br><span class="line">        <span class="comment">// 获取动态生成的 SQL 语句以及相应的参数信息对象</span></span><br><span class="line">        BoundSql boundSql = mappedStatement.getBoundSql(parameter);</span><br><span class="line">        <span class="comment">// MyBatis 所有的配置信息都维持在 Configuration 对象之中，包括 id、Statement 类型、SQL 类型、mapper 的 xml 文件的绝对地址、是否使用缓存等配置</span></span><br><span class="line">        Configuration configuration = mappedStatement.getConfiguration();</span><br><span class="line">        Object returnValue = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line">        <span class="comment">// 继续执行原目标方法</span></span><br><span class="line">        returnValue = invocation.proceed();</span><br><span class="line">        <span class="comment">// 获取实体类</span></span><br><span class="line">        Class&lt;?&gt; parameterType = getParameterType(mappedStatement);</span><br><span class="line">        <span class="comment">/** 判断实体类上是否包含 <span class="doctag">@SqlPrint</span> 注解，不包含的话直接返回 */</span></span><br><span class="line">        <span class="keyword">if</span> (!hasSqlPrintAnnotation(parameterType)) &#123;</span><br><span class="line">            <span class="keyword">return</span> returnValue;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">long</span> end = System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">long</span> time = (end - start);</span><br><span class="line">        <span class="comment">/** 当 SQL 执行大于 1 毫秒时打印 SQL，所以也可以用于慢 SQL 的打印及监控 */</span></span><br><span class="line">        <span class="keyword">if</span> (time &gt; <span class="number">1</span>) &#123;</span><br><span class="line">            String sql = getSql(configuration, boundSql, sqlId, time);</span><br><span class="line">            log.info(sql);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 返回执行后的结果</span></span><br><span class="line">        <span class="keyword">return</span> returnValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 作用：包装目标对象，包装的意思就是为目标对象创建一个代理对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">plugin</span><span class="params">(Object target)</span> </span>&#123;</span><br><span class="line">        <span class="comment">/** 判断下需要拦截的目标对象类型，需要拦截时才拦截，否则直接返回本身，减少被代理的次数 */</span></span><br><span class="line">        <span class="keyword">if</span> (target <span class="keyword">instanceof</span> Executor) &#123;</span><br><span class="line">            <span class="comment">// 借助 Plugin 的 wrap 方法来使用当前的拦截器包装我们的目标对象，返回的就是为当前 target 创建的动态代理</span></span><br><span class="line">            <span class="comment">// 使用 JDK 的动态代理，给 target 对象创建一个 delegate 代理对象，以此来实现方法拦截和增强功能，它会回调 intercept() 方法。</span></span><br><span class="line">            <span class="keyword">return</span> Plugin.wrap(target, <span class="keyword">this</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 无需拦截则直接返回目标对象本身</span></span><br><span class="line">            <span class="keyword">return</span> target;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将插件注册时的 property 属性设置进来</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProperties</span><span class="params">(Properties properties)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.properties = properties;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 组装需要打印的信息，包括 SQL 语句、特殊标记、SQL 执行时间等</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> configuration MyBatis 所有的配置信息都维持在 Configuration 对象之中</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> boundSql 表示动态生成的 SQL 语句以及相应的参数信息对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sqlId 拦截的执行 SQL 的id（可以理解为方法）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time SQL 执行时间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">getSql</span><span class="params">(Configuration configuration, BoundSql boundSql, String sqlId, <span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">        String sql = showSql(configuration, boundSql);</span><br><span class="line">        StringBuilder str = <span class="keyword">new</span> StringBuilder(<span class="number">100</span>);</span><br><span class="line">        <span class="comment">// 拦截的执行 SQL 的id（可以理解为方法），例如：com.gorge4j.user.mapper.UserManageDemoMyBatisMapper.update</span></span><br><span class="line">        str.append(sqlId);</span><br><span class="line">        str.append(<span class="string">" : "</span>);</span><br><span class="line">        <span class="comment">// 具体执行的 SQL 语句</span></span><br><span class="line">        str.append(sql);</span><br><span class="line">        str.append(<span class="string">" &gt;&gt;&gt;&gt;&gt;&gt; "</span>);</span><br><span class="line">        <span class="comment">// SQL 执行的时间</span></span><br><span class="line">        str.append(<span class="string">"SQL执行耗时: "</span>);</span><br><span class="line">        str.append(time);</span><br><span class="line">        str.append(<span class="string">"ms"</span>);</span><br><span class="line">        <span class="keyword">return</span> str.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 按类型格式化 SQL 里的参数 */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">getFormatParameterValue</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">        String value = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">            value = <span class="string">"'"</span> + obj.toString() + <span class="string">"'"</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> Date) &#123;</span><br><span class="line">            DateFormat formatter = DateFormat.getDateTimeInstance(DateFormat.DEFAULT, DateFormat.DEFAULT, Locale.CHINA);</span><br><span class="line">            value = <span class="string">"'"</span> + formatter.format(<span class="keyword">new</span> Date()) + <span class="string">"'"</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (obj != <span class="keyword">null</span>) &#123;</span><br><span class="line">                value = obj.toString();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                value = <span class="string">""</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 组装需要打印的 SQL */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">showSql</span><span class="params">(Configuration configuration, BoundSql boundSql)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 取得参数的对象，实际上就是一个多个参数的 map 结构</span></span><br><span class="line">        <span class="comment">// 示例：parameterObject:MapperMethod&#123;password=123456,name=xxxxxx,type=O,param3=O,param1=xxxxxx,param2=123456&#125;</span></span><br><span class="line">        Object parameterObject = boundSql.getParameterObject();</span><br><span class="line">        <span class="comment">// 查询 SQL 中的参数</span></span><br><span class="line">        List&lt;ParameterMapping&gt; parameterMappings = boundSql.getParameterMappings();</span><br><span class="line">        <span class="comment">// 将 SQL 中一个或多个回车换行符号替换成一个空格</span></span><br><span class="line">        String sql = boundSql.getSql().replaceAll(<span class="string">"[\\s]+"</span>, <span class="string">" "</span>);</span><br><span class="line">        <span class="keyword">if</span> (!parameterMappings.isEmpty() &amp;&amp; parameterObject != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// Mybatis 在启动时就会通过 TypeHandlerRegistry 进行注册，即建立 JdbcType, JavaType, TypeHandler 三者之间的关系。</span></span><br><span class="line">            <span class="comment">// 因此，这意味着在 Mybatis 启动时我们也需要通过 TypeHandlerRegistry 将我们的所有的枚举类型（JavaType）与自定义的枚举</span></span><br><span class="line">            <span class="comment">// TypeHandler（EnumTypeHandler）建立联系</span></span><br><span class="line">            TypeHandlerRegistry typeHandlerRegistry = configuration.getTypeHandlerRegistry();</span><br><span class="line">            <span class="comment">// 自定义 TypeHandler 时会走这个逻辑，建立 JavaType 和 JdbcType 之间的联系</span></span><br><span class="line">            <span class="keyword">if</span> (typeHandlerRegistry.hasTypeHandler(parameterObject.getClass())) &#123;</span><br><span class="line">                <span class="comment">// 替换 SQL 中的占位符 “?” 为具体的参数，replaceFirst 作为是替换匹配到的第一个占位符 “?”</span></span><br><span class="line">                sql = sql.replaceFirst(<span class="string">"\\?"</span>, getFormatParameterValue(parameterObject));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 没有自定义的 TypeHandler，走通用逻辑</span></span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 拿到 target（拦截对象）的元数据</span></span><br><span class="line">                MetaObject metaObject = configuration.newMetaObject(parameterObject);</span><br><span class="line">                <span class="comment">// 参数是按顺序存储的，下面逻辑按顺序来替换</span></span><br><span class="line">                <span class="keyword">for</span> (ParameterMapping parameterMapping : parameterMappings) &#123;</span><br><span class="line">                    <span class="comment">// 获取参数的名称</span></span><br><span class="line">                    String propertyName = parameterMapping.getProperty();</span><br><span class="line">                    <span class="comment">// 如果元数据对象中存在该参数，则替换相应的占位符 “?”</span></span><br><span class="line">                    <span class="keyword">if</span> (metaObject.hasGetter(propertyName)) &#123;</span><br><span class="line">                        Object obj = metaObject.getValue(propertyName);</span><br><span class="line">                        sql = sql.replaceFirst(<span class="string">"\\?"</span>, getFormatParameterValue(obj));</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// 如果有额外的参数，走下面的逻辑</span></span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span> (boundSql.hasAdditionalParameter(propertyName)) &#123;</span><br><span class="line">                        Object obj = boundSql.getAdditionalParameter(propertyName);</span><br><span class="line">                        sql = sql.replaceFirst(<span class="string">"\\?"</span>, getFormatParameterValue(obj));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 返回组装好的 SQL</span></span><br><span class="line">        <span class="keyword">return</span> sql;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 获取实体对象类：class com.gorge4j.user.entity.UserManageDemoMyBatis */</span></span><br><span class="line">    <span class="keyword">private</span> Class&lt;?&gt; getParameterType(MappedStatement statement) &#123;</span><br><span class="line">        <span class="keyword">if</span> (statement.getParameterMap() == <span class="keyword">null</span> || statement.getParameterMap().getType() == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> statement.getParameterMap().getType();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 判断实体类上是否包含自定义的 SQl 打印的注解 <span class="doctag">@SqlPrint</span> */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">hasSqlPrintAnnotation</span><span class="params">(Class&lt;?&gt; classType)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> classType == <span class="keyword">null</span> ? Boolean.FALSE : classType.isAnnotationPresent(SqlPrint<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：需要在实体类上添加自定义注解 @SqlPrint </p>
</blockquote>
<p>自定义注解类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Retention</span>(RUNTIME)</span><br><span class="line"><span class="meta">@Target</span>(TYPE)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SqlPrint &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>自定义的 SQL 日志打印样式：</p>
<p><img src="http://welab-wingo.gitee.io/image/2020/03/UserManagementSystem/SQLLog03.png" alt=""></p>
<h3 id="跨域"><a href="#跨域" class="headerlink" title="跨域"></a>跨域</h3><blockquote>
<p>跨域，是指浏览器不能执行其他网站的脚本。它是由浏览器的同源策略造成的，是浏览器对 JavaScript 实施的安全策略。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CorsConfig</span> <span class="keyword">extends</span> <span class="title">WebMvcConfigurationSupport</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addCorsMappings</span><span class="params">(CorsRegistry registry)</span> </span>&#123;</span><br><span class="line">		registry.addMapping(<span class="string">"/**"</span>)</span><br><span class="line">            .allowedOrigins(<span class="string">"*"</span>)</span><br><span class="line">            .allowCredentials(<span class="keyword">true</span>)</span><br><span class="line">            .allowedHeaders(<span class="string">"*"</span>)</span><br><span class="line">            .allowedMethods(<span class="string">"GET"</span>, <span class="string">"POST"</span>, <span class="string">"DELETE"</span>, <span class="string">"PUT"</span>, <span class="string">"OPTIONS"</span>)</span><br><span class="line">            .maxAge(<span class="number">3600</span>);</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="comment">// 配置 Swagger 的资源映射</span></span><br><span class="line">     <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        registry.addResourceHandler(<span class="string">"swagger-ui.html"</span>)</span><br><span class="line">                .addResourceLocations(<span class="string">"classpath:/META-INF/resources/"</span>);</span><br><span class="line"></span><br><span class="line">        registry.addResourceHandler(<span class="string">"/webjars/**"</span>)</span><br><span class="line">                .addResourceLocations(<span class="string">"classpath:/META-INF/resources/webjars/"</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> EnableWebMvc 用了此注解默认配置的 MVC 失效，需要用户重新配置</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> WebMvcConfigurer</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebMvcConfigurationSupport</span> ...</span></span><br></pre></td></tr></table></figure>

<h3 id="自定义校验"><a href="#自定义校验" class="headerlink" title="自定义校验"></a>自定义校验</h3><blockquote>
<p>除了使用默认提供的 Validator，用户还可以提供具有自定义校验规则的 Validator。</p>
</blockquote>
<h4 id="注解类"><a href="#注解类" class="headerlink" title="注解类"></a>注解类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target</span>(&#123;ElementType.FIELD&#125;)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Constraint</span>(validatedBy = UsernameValidator<span class="class">.<span class="keyword">class</span>) // 引入校验规则类进行校验</span></span><br><span class="line"><span class="class"><span class="title">public</span> @<span class="title">interface</span> <span class="title">Username</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 错误提示消息 @Username(message = "")</span></span><br><span class="line">    <span class="function">String <span class="title">message</span><span class="params">()</span> <span class="keyword">default</span> "</span>&#123;com.wingo.user.annotaion.Username.message&#125;<span class="string">";</span></span><br><span class="line"><span class="string">    Class&lt;?&gt;[] groups() default &#123;&#125;;</span></span><br><span class="line"><span class="string">    Class&lt;? extends Payload&gt;[] payload() default &#123;&#125;;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target</span>(&#123;ElementType.FIELD&#125;)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Constraint</span>(validatedBy = PasswordValidator<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> @<span class="title">interface</span> <span class="title">Password</span> </span>&#123;</span><br><span class="line">    <span class="function">String <span class="title">message</span><span class="params">()</span> <span class="keyword">default</span> "</span>&#123;com.wingo.user.annotaion.Password.message&#125;<span class="string">";</span></span><br><span class="line"><span class="string">    Class&lt;?&gt;[] groups() default &#123;&#125;;</span></span><br><span class="line"><span class="string">    Class&lt;? extends Payload&gt;[] payload() default &#123;&#125;;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="校验类"><a href="#校验类" class="headerlink" title="校验类"></a>校验类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UsernameValidator</span> <span class="keyword">implements</span> <span class="title">ConstraintValidator</span>&lt;<span class="title">Username</span>, <span class="title">String</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initialize</span><span class="params">(Username constraintAnnotation)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// do nothing</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isValid</span><span class="params">(String value, ConstraintValidatorContext context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isBlank(value)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Pattern.matches(RegexConstant.REGEX_USERNAME, value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PasswordValidator</span> <span class="keyword">implements</span> <span class="title">ConstraintValidator</span>&lt;<span class="title">Password</span>, <span class="title">String</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initialize</span><span class="params">(Password constraintAnnotation)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// do nothing</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isValid</span><span class="params">(String value, ConstraintValidatorContext context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isBlank(value)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 正则匹配</span></span><br><span class="line">        <span class="keyword">return</span> Pattern.matches(RegexConstant.REGEX_PASS, value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="请求响应打印"><a href="#请求响应打印" class="headerlink" title="请求响应打印"></a>请求响应打印</h3><blockquote>
<p>切面：方法前打印请求信息参数；方法后打印响应信息。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReqAndRespLogAspect</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 请求参数的日志打印</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> joinPoint 切点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Before</span>(<span class="string">"within(com.wingo.user.controller.*)"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">(JoinPoint joinPoint)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 获取传入目标方法的参数对象</span></span><br><span class="line">        Object[] args = joinPoint.getArgs();</span><br><span class="line">        <span class="comment">// 获取封装了署名信息的对象,在该对象中可以获取到目标方法名,所属类的Class等信息</span></span><br><span class="line">        MethodSignature methodSignature = (MethodSignature) joinPoint.getSignature();</span><br><span class="line">        <span class="comment">// 获取方法对象</span></span><br><span class="line">        Method method = methodSignature.getMethod();</span><br><span class="line">        <span class="comment">// 分割组装参数</span></span><br><span class="line">        String strArgs = StringUtils.join(args, <span class="string">","</span>);</span><br><span class="line">        log.info(<span class="string">"&#123;&#125;.&#123;&#125; - 请求参数: &#123;&#125;"</span>, method.getDeclaringClass().getName(), method.getName(), strArgs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 响应结果的日志打印</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> joinPoint 切点</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> res 响应结果对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@AfterReturning</span>(value = <span class="string">"within(com.wingo.user.controller.*)"</span>, returning = <span class="string">"res"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">after</span><span class="params">(JoinPoint joinPoint, Object res)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 获取封装了署名信息的对象,在该对象中可以获取到目标方法名,所属类的 Class 等信息</span></span><br><span class="line">        MethodSignature methodSignature = (MethodSignature) joinPoint.getSignature();</span><br><span class="line">        <span class="comment">// 获取方法对象</span></span><br><span class="line">        Method method = methodSignature.getMethod();</span><br><span class="line">        <span class="comment">// 将返回对象转换成 Json 字符串，项目的返回如果不是 Json 的数据格式，那么返回参数就只有 URL</span></span><br><span class="line">        <span class="comment">// String strRes = JSONUtils.toJSONString(res);</span></span><br><span class="line">        String strRes = res.toString();</span><br><span class="line">        log.info(<span class="string">"&#123;&#125;.&#123;&#125; - 返回结果: &#123;&#125;"</span>, method.getDeclaringClass().getName(), method.getName(), strRes);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2020-04-19T06:45:04.725Z" itemprop="dateUpdated">2020-04-19 14:45:04</time>
</span><br>


        
    </div>
    
    <footer>
        <a href="http://yoursite.com">
            <img src="/img/avatar.jpg" alt="Wingo">
            Wingo
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Project/" rel="tag">Project</a></li></ul>


            


        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2020/03/12/Software/%E5%BC%80%E5%8F%91%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E7%B1%BB/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">开发常用工具类</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2020/03/06/English/CET6%20%E5%86%99%E4%BD%9C%E7%9C%9F%E9%A2%98/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">CET6 写作真题</h4>
      </a>
    </div>
  
</nav>



    




















</article>



</div>

        <footer class="footer">
    <div class="top">
        

        <p>
            
            <span>得失从缘，心无增减</span>
        </p>
    </div> 
    <div class="bottom">
        <p><span>Wingo &copy; 2020</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>


    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: false, REWARD: false };


</script>

<script src="/js/main.min.js?v=1.7.2"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.min.js?v=1.7.2" async></script>










</body>
</html>
