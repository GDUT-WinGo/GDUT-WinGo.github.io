<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>sklearn | Wingo&#39;s Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="Machine Learning,sklearn">
    <meta name="description" content="简单了解机器学习的基本概念以及常规流程，并简单介绍 Python 的机器学习库 sklearn 的使用。">
<meta property="og:type" content="article">
<meta property="og:title" content="sklearn">
<meta property="og:url" content="http://yoursite.com/2020/04/23/Python/sklearn/index.html">
<meta property="og:site_name" content="Wingo&#39;s Blog">
<meta property="og:description" content="简单了解机器学习的基本概念以及常规流程，并简单介绍 Python 的机器学习库 sklearn 的使用。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://welab-wingo.gitee.io/image/2020/04/SKlearn/ML01.jpg">
<meta property="og:image" content="http://welab-wingo.gitee.io/image/2020/04/SKlearn/Flower.png">
<meta property="og:image" content="http://welab-wingo.gitee.io/image/2020/04/SKlearn/MinMax.png">
<meta property="og:image" content="http://welab-wingo.gitee.io/image/2020/04/SKlearn/StandardScore.png">
<meta property="og:image" content="http://welab-wingo.gitee.io/image/2020/04/SKlearn/Table.png">
<meta property="og:image" content="http://welab-wingo.gitee.io/image/2020/04/SKlearn/CrossValidate.png">
<meta property="og:image" content="http://welab-wingo.gitee.io/image/2020/04/SKlearn/DecisionTree.png">
<meta property="og:image" content="http://welab-wingo.gitee.io/image/2020/04/SKlearn/Facebook.png">
<meta property="og:image" content="http://welab-wingo.gitee.io/image/2020/04/SKlearn/Facebook01.png">
<meta property="og:image" content="http://welab-wingo.gitee.io/image/2020/04/SKlearn/Facebook02.png">
<meta property="article:published_time" content="2020-04-23T03:07:44.000Z">
<meta property="article:modified_time" content="2020-04-30T03:49:06.999Z">
<meta property="article:author" content="Wingo">
<meta property="article:tag" content="Machine Learning">
<meta property="article:tag" content="sklearn">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://welab-wingo.gitee.io/image/2020/04/SKlearn/ML01.jpg">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="/css/style.css?v=1.7.2">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

<meta name="generator" content="Hexo 4.2.0"></head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Wingo</h5>
          <a href="mailto:1318263468@qq.com" title="1318263468@qq.com" class="mail">1318263468@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                Home
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">sklearn</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">sklearn</h1>
        <h5 class="subtitle">
            
                <time datetime="2020-04-23T03:07:44.000Z" itemprop="datePublished" class="page-time">
  2020-04-23
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Python/">Python</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Jupyter-安装配置"><span class="post-toc-number">1.</span> <span class="post-toc-text">Jupyter 安装配置</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#机器学习概述"><span class="post-toc-number">2.</span> <span class="post-toc-text">机器学习概述</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#数据获取"><span class="post-toc-number">3.</span> <span class="post-toc-text">数据获取</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#特征工程"><span class="post-toc-number">4.</span> <span class="post-toc-text">特征工程</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#字典特征提取"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">字典特征提取</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#文本特征提取"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">文本特征提取</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#CountVectorizer"><span class="post-toc-number">4.2.1.</span> <span class="post-toc-text">CountVectorizer</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#TfidfVectorizer"><span class="post-toc-number">4.2.2.</span> <span class="post-toc-text">TfidfVectorizer</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#特征预处理"><span class="post-toc-number">4.3.</span> <span class="post-toc-text">特征预处理</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#归一化"><span class="post-toc-number">4.3.1.</span> <span class="post-toc-text">归一化</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#标准化"><span class="post-toc-number">4.3.2.</span> <span class="post-toc-text">标准化</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#特征降维"><span class="post-toc-number">4.4.</span> <span class="post-toc-text">特征降维</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#Filter"><span class="post-toc-number">4.4.1.</span> <span class="post-toc-text">Filter</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#主成分分析"><span class="post-toc-number">4.4.2.</span> <span class="post-toc-text">主成分分析</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#案例分析：购物车"><span class="post-toc-number">5.</span> <span class="post-toc-text">案例分析：购物车</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#分类算法"><span class="post-toc-number">6.</span> <span class="post-toc-text">分类算法</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#K-近邻算法"><span class="post-toc-number">6.1.</span> <span class="post-toc-text">K - 近邻算法</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#鸢尾花分类案例"><span class="post-toc-number">6.1.1.</span> <span class="post-toc-text">鸢尾花分类案例</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#模型选择与调优"><span class="post-toc-number">6.2.</span> <span class="post-toc-text">模型选择与调优</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#交叉验证"><span class="post-toc-number">6.2.1.</span> <span class="post-toc-text">交叉验证</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#网格搜索"><span class="post-toc-number">6.2.2.</span> <span class="post-toc-text">网格搜索</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#鸢尾花-K-值调优"><span class="post-toc-number">6.2.3.</span> <span class="post-toc-text">鸢尾花 K 值调优</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#朴素贝叶斯"><span class="post-toc-number">6.3.</span> <span class="post-toc-text">朴素贝叶斯</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#决策树"><span class="post-toc-number">6.4.</span> <span class="post-toc-text">决策树</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#随机森林"><span class="post-toc-number">6.5.</span> <span class="post-toc-text">随机森林</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#案例分析：签到预测"><span class="post-toc-number">7.</span> <span class="post-toc-text">案例分析：签到预测</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#案例分析：生存预测"><span class="post-toc-number">8.</span> <span class="post-toc-text">案例分析：生存预测</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#回归算法"><span class="post-toc-number">9.</span> <span class="post-toc-text">回归算法</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#线性回归"><span class="post-toc-number">9.1.</span> <span class="post-toc-text">线性回归</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#正规方程"><span class="post-toc-number">9.1.1.</span> <span class="post-toc-text">正规方程</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#梯度下降"><span class="post-toc-number">9.1.2.</span> <span class="post-toc-text">梯度下降</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#岭回归"><span class="post-toc-number">9.1.3.</span> <span class="post-toc-text">岭回归</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#逻辑回归"><span class="post-toc-number">9.2.</span> <span class="post-toc-text">逻辑回归</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#精确率"><span class="post-toc-number">9.2.1.</span> <span class="post-toc-text">精确率</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#召回率"><span class="post-toc-number">9.2.2.</span> <span class="post-toc-text">召回率</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#F1-score"><span class="post-toc-number">9.2.3.</span> <span class="post-toc-text">F1-score</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#案例分析：肿瘤预测"><span class="post-toc-number">10.</span> <span class="post-toc-text">案例分析：肿瘤预测</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#K-means"><span class="post-toc-number">11.</span> <span class="post-toc-text">K-means</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#购物车案例"><span class="post-toc-number">11.1.</span> <span class="post-toc-text">购物车案例</span></a></li></ol></li></ol>
        </nav>
    </aside>


<article id="post-Python/sklearn"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">sklearn</h1>
        <div class="post-meta">
            <time class="post-time" title="2020-04-23 11:07:44" datetime="2020-04-23T03:07:44.000Z"  itemprop="datePublished">2020-04-23</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Python/">Python</a></li></ul>



            

        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <p>简单了解机器学习的基本概念以及常规流程，并简单介绍 Python 的机器学习库 sklearn 的使用。</p>
<a id="more"></a>

<h3 id="Jupyter-安装配置"><a href="#Jupyter-安装配置" class="headerlink" title="Jupyter 安装配置"></a>Jupyter 安装配置</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pip3 install jupyter -i https://pypi.tuna.tsinghua.edu.cn/simple/ # 国内镜像下载 jupyter</span><br><span class="line">jupyter notebook --generate-config # 生成默认的配置文件</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Writing default config to: C:\Users\wingo\.jupyter\jupyter_notebook_config.py</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># C.NotebookApp.notebook_dir='' 修改此项配置</span></span></span><br><span class="line">jupyter notebook # 启动 Jupyter notebook</span><br><span class="line">pip3 install -U scikit-learn -i https://pypi.tuna.tsinghua.edu.cn/simple/ # 下载库</span><br></pre></td></tr></table></figure>

<h3 id="机器学习概述"><a href="#机器学习概述" class="headerlink" title="机器学习概述"></a>机器学习概述</h3><p>数据 👉 模型 👉 预测，即从历史数据中获得规律。</p>
<img src="http://welab-wingo.gitee.io/image/2020/04/SKlearn/ML01.jpg" style="zoom: 80%;" />

<p>数据集的构成：特征值 + 目标值。</p>
<blockquote>
<p>根据是否有目标值，可以分为无监督学习（无目标值）、监督学习（有目标值）。</p>
<p>根据数据的形式，可以分为分类问题（类别）、回归问题（连续性数据）。</p>
</blockquote>
<p>机器学习的普遍开发流程：</p>
<blockquote>
<p>1）获取数据；<br>2）数据处理；<br>3）特征工程；<br>4）模型训练；<br>5）模型评估；<br>6）实际应用。</p>
</blockquote>
<h3 id="数据获取"><a href="#数据获取" class="headerlink" title="数据获取"></a>数据获取</h3><p>sklearn 自带了许多数据，供开发者进行测试使用。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入满满的数据库</span></span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> datasets</span><br><span class="line"><span class="comment"># 分割数据的模块，把数据集分为训练集和测试集</span></span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"></span><br><span class="line"><span class="comment"># 载入数据，经典鸢尾花数据</span></span><br><span class="line">iris = datasets.load_iris()</span><br><span class="line"><span class="comment"># random_state 为了保证程序每次运行都分割一样的训练集合测试集。否则，同样的算法模型在不同的训练集和测试集上的效果不一样。</span></span><br><span class="line">x_train, x_test, y_train, y_test = train_test_split(iris.data, iris.target, test_size=<span class="number">0.2</span>, random_state=<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>查看此数据集的详细描述：</p>
<img src="http://welab-wingo.gitee.io/image/2020/04/SKlearn/Flower.png" style="zoom:80%;" />

<p>数据集的划分：</p>
<blockquote>
<p>训练数据，用于训练，构建模型；<br>测试数据，在模型检验时使用，用于评估模型是否有效。</p>
</blockquote>
<h3 id="特征工程"><a href="#特征工程" class="headerlink" title="特征工程"></a>特征工程</h3><blockquote>
<p>Feature Engineering：特征工程就是对特征值进行处理，选择有意义的特征输入机器学习的算法和模型进行训练。</p>
</blockquote>
<h4 id="字典特征提取"><a href="#字典特征提取" class="headerlink" title="字典特征提取"></a>字典特征提取</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.feature_extraction <span class="keyword">import</span> DictVectorizer</span><br><span class="line"></span><br><span class="line"><span class="comment"># list:[dict&#123;&#125;, dict&#123;&#125;, dict&#123;&#125;]</span></span><br><span class="line">data = [&#123;<span class="string">'city'</span>: <span class="string">'北京'</span>,<span class="string">'temperature'</span>:<span class="number">100</span>&#125;, &#123;<span class="string">'city'</span>: <span class="string">'上海'</span>,<span class="string">'temperature'</span>:<span class="number">60</span>&#125;, &#123;<span class="string">'city'</span>: <span class="string">'深圳'</span>,<span class="string">'temperature'</span>:<span class="number">30</span>&#125;]</span><br><span class="line"><span class="comment"># 实例化一个转换器类，此处 sparse=True 设置结果为稀疏矩阵方便查看</span></span><br><span class="line">transfer = DictVectorizer(sparse=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># 调用 fit_transform() 进行特征提取</span></span><br><span class="line">data_new = transfer.fit_transform(data)</span><br><span class="line"><span class="comment"># 打印特征提取结果</span></span><br><span class="line">print(<span class="string">"data_new_sparse:\n"</span>, data_new, <span class="string">"\n"</span>, type(data_new))</span><br><span class="line">print(<span class="string">"data_new:\n"</span>, data_new.toarray())</span><br><span class="line">print(<span class="string">"特征名字:\n"</span>, transfer.get_feature_names())</span><br><span class="line"><span class="string">""" 打印结果</span></span><br><span class="line"><span class="string">data_new_sparse:</span></span><br><span class="line"><span class="string">  (0, 1)	1.0</span></span><br><span class="line"><span class="string">  (0, 3)	100.0</span></span><br><span class="line"><span class="string">  (1, 0)	1.0</span></span><br><span class="line"><span class="string">  (1, 3)	60.0</span></span><br><span class="line"><span class="string">  (2, 2)	1.0</span></span><br><span class="line"><span class="string">  (2, 3)	30.0 </span></span><br><span class="line"><span class="string"> &lt;class 'scipy.sparse.csr.csr_matrix'&gt;</span></span><br><span class="line"><span class="string">data_new:</span></span><br><span class="line"><span class="string"> [[  0.   1.   0. 100.]</span></span><br><span class="line"><span class="string"> [  1.   0.   0.  60.]</span></span><br><span class="line"><span class="string"> [  0.   0.   1.  30.]]</span></span><br><span class="line"><span class="string">特征名字:</span></span><br><span class="line"><span class="string"> ['city=上海', 'city=北京', 'city=深圳', 'temperature']</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure>

<p>由上面的例子可以看出，经过 sklearn 的字典特征转换后，其类型转换为 matrix，即一个矩阵类型。</p>
<p>原始数据中的特征值只有 2 个：city、temperature；但转换出来的特征矩阵却有 4 列，这是为了将特征值变量转换为机器学习算法易于利用的一种形式，此转换过程称为 <strong>one hot 编码</strong>。</p>
<h4 id="文本特征提取"><a href="#文本特征提取" class="headerlink" title="文本特征提取"></a>文本特征提取</h4><h5 id="CountVectorizer"><a href="#CountVectorizer" class="headerlink" title="CountVectorizer"></a>CountVectorizer</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.feature_extraction.text <span class="keyword">import</span> CountVectorizer</span><br><span class="line">data = [<span class="string">"How to shift your mindset and choose your future"</span>, <span class="string">"I like python, Do you like python?"</span>]</span><br><span class="line"><span class="comment"># 实例化一个转换器类，可以屏蔽一些没有意义的词语</span></span><br><span class="line">transfer = CountVectorizer(stop_words=[<span class="string">"and"</span>, <span class="string">"to"</span>])</span><br><span class="line"><span class="comment"># 调用 fit_transform</span></span><br><span class="line">data_new = transfer.fit_transform(data)</span><br><span class="line">print(<span class="string">"data_new:\n"</span>, data_new.toarray())</span><br><span class="line">print(<span class="string">"特征名字：\n"</span>, transfer.get_feature_names())</span><br><span class="line"><span class="string">""" 打印结果</span></span><br><span class="line"><span class="string">data_new:</span></span><br><span class="line"><span class="string"> [[1 0 1 1 0 1 0 1 0 2]</span></span><br><span class="line"><span class="string"> [0 1 0 0 2 0 2 0 1 0]]</span></span><br><span class="line"><span class="string">特征名字：</span></span><br><span class="line"><span class="string"> ['choose', 'do', 'future', 'how', 'like', 'mindset', 'python', 'shift', 'you', 'your']</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure>

<p>思考：若是对一句中文文本进行文本特征提取，那会出现什么结果？</p>
<blockquote>
<p>对于中文文本，因为词语之间不存在空格，所以需要分词库先进行分词：<code>&quot; &quot;.join(list(jieba.cut(text)))</code></p>
</blockquote>
<h5 id="TfidfVectorizer"><a href="#TfidfVectorizer" class="headerlink" title="TfidfVectorizer"></a>TfidfVectorizer</h5><blockquote>
<p>Term Frequency - Inverse Document Frequency，即词频 - 逆文本频率，由 TF 和 IDF 组成。</p>
<p>TF，即普通的词频统计，这个比较好理解，<br>IDF，用于反应一个词的重要性，进而修正仅仅用词频表示的词特征值。比如，”to” 这个词的词频非常高，但它在每一篇文章中都出现了，那么它这个高词频就没有什么太大的意义。</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.feature_extraction.text <span class="keyword">import</span> TfidfVectorizer</span><br><span class="line"><span class="keyword">from</span> sklearn.feature_extraction.text <span class="keyword">import</span> CountVectorizer</span><br><span class="line"><span class="keyword">import</span> jieba</span><br><span class="line">data = [<span class="string">"今天是星期一，有点快乐"</span>, <span class="string">"今天是星期二，无敌快乐"</span>, <span class="string">"今天是星期三，超级快乐"</span>]</span><br><span class="line">data_new = []</span><br><span class="line"><span class="keyword">for</span> sent <span class="keyword">in</span> data:</span><br><span class="line">    data_new.append(<span class="string">" "</span>.join(list(jieba.cut(sent))))</span><br><span class="line"><span class="string">"""data_new</span></span><br><span class="line"><span class="string">['今天 是 星期一 ， 有点 快乐', '今天 是 星期二 ， 无敌 快乐', '今天 是 星期三 ， 超级 快乐']</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="comment"># 转换器</span></span><br><span class="line">transfer = TfidfVectorizer()</span><br><span class="line">transfer_normal = CountVectorizer()</span><br><span class="line"><span class="comment"># 特征提取</span></span><br><span class="line">data_final = transfer.fit_transform(data_new)</span><br><span class="line">data_normal = transfer_normal.fit_transform(data_new)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"data_new:\n"</span>, data_final.toarray())</span><br><span class="line">print(<span class="string">"data_new_normal:\n"</span>, data_normal.toarray())</span><br><span class="line">print(<span class="string">"特征名字：\n"</span>, transfer.get_feature_names())</span><br><span class="line"><span class="string">"""打印结果</span></span><br><span class="line"><span class="string">data_new:</span></span><br><span class="line"><span class="string"> [[0.35959372 0.35959372 0.         0.6088451  0.         0.</span></span><br><span class="line"><span class="string">  0.6088451  0.        ]</span></span><br><span class="line"><span class="string"> [0.35959372 0.35959372 0.6088451  0.         0.         0.6088451</span></span><br><span class="line"><span class="string">  0.         0.        ]</span></span><br><span class="line"><span class="string"> [0.35959372 0.35959372 0.         0.         0.6088451  0.</span></span><br><span class="line"><span class="string">  0.         0.6088451 ]]</span></span><br><span class="line"><span class="string">data_new_normal:</span></span><br><span class="line"><span class="string"> [[1 1 0 1 0 0 1 0]</span></span><br><span class="line"><span class="string"> [1 1 1 0 0 1 0 0]</span></span><br><span class="line"><span class="string"> [1 1 0 0 1 0 0 1]]</span></span><br><span class="line"><span class="string">特征名字：</span></span><br><span class="line"><span class="string"> ['今天', '快乐', '无敌', '星期一', '星期三', '星期二', '有点', '超级']</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>分析上述结果，普通的词频分析得出的结果是词频相同，而 tf-idf 分析，对于每个句子中都出现的词的重要性会有所降低。</p>
</blockquote>
<h4 id="特征预处理"><a href="#特征预处理" class="headerlink" title="特征预处理"></a>特征预处理</h4><blockquote>
<p>无量纲化：进行无量纲化后表征不同属性（单位不同）的各特征之间才有可比性，如 1cm 与 0.1kg 如何比较？</p>
</blockquote>
<h5 id="归一化"><a href="#归一化" class="headerlink" title="归一化"></a>归一化</h5><blockquote>
<p>无法处理异常值（最大值，最小值）；</p>
</blockquote>
<p><img src="http://welab-wingo.gitee.io/image/2020/04/SKlearn/MinMax.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> MinMaxScaler</span><br><span class="line"></span><br><span class="line">x_mm = [[<span class="number">1</span>,<span class="number">-1</span>,<span class="number">2</span>],[<span class="number">2</span>,<span class="number">0</span>,<span class="number">0</span>],[<span class="number">0</span>,<span class="number">1</span>,<span class="number">-1</span>]]</span><br><span class="line">x_mm_new = MinMaxScaler().fit_transform(x_mm)</span><br><span class="line"><span class="string">"""x_mm_new</span></span><br><span class="line"><span class="string">array([[0.5       , 0.        , 1.        ],</span></span><br><span class="line"><span class="string">       [1.        , 0.5       , 0.33333333],</span></span><br><span class="line"><span class="string">       [0.        , 1.        , 0.        ]])</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure>

<h5 id="标准化"><a href="#标准化" class="headerlink" title="标准化"></a>标准化</h5><blockquote>
<p>标准差（描述样本集中程度，异常值对总样本的集中程度的影响不大），在已有样本足够多的情况下比较稳定，适合现代嘈杂大数据场景。</p>
</blockquote>
<p><img src="http://welab-wingo.gitee.io/image/2020/04/SKlearn/StandardScore.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> StandardScaler</span><br><span class="line">x = [[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],[<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>],[<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>]]</span><br><span class="line">x_new = StandardScaler().fit_transform(x)</span><br><span class="line"><span class="string">"""x_new</span></span><br><span class="line"><span class="string">array([[-0.70710678, -0.70710678, -0.16222142],</span></span><br><span class="line"><span class="string">       [ 1.41421356,  1.41421356,  1.29777137],</span></span><br><span class="line"><span class="string">       [-0.70710678, -0.70710678, -1.13554995]])</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure>

<h4 id="特征降维"><a href="#特征降维" class="headerlink" title="特征降维"></a>特征降维</h4><blockquote>
<p>这里的降维的维度，不是指矩阵、向量、标量等，而是指降低特征的个数，让最终得到的数据中的每个特征之间互不相关。</p>
</blockquote>
<p>思考：特征之间相关度过高会有什么问题？？？若 m、n 都可以得出 r，那么去掉 m 、n 中的任意一个特征对结果都不会影响，在一个庞大的数据中，去掉某些相关性特别高的特征可以节省很多算力与内存空间，模型更加高效。</p>
<h5 id="Filter"><a href="#Filter" class="headerlink" title="Filter"></a>Filter</h5><blockquote>
<p>方差选择法：低方差特征过滤，即过滤差别不大的特征。</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.feature_selection <span class="keyword">import</span> VarianceThreshold</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> scipy.stats <span class="keyword">import</span> pearsonr</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取数据</span></span><br><span class="line">data = pd.read_csv(<span class="string">"factor_returns.csv"</span>)</span><br><span class="line"><span class="comment"># 保留每一行，保留从[第二列到倒数第二列)</span></span><br><span class="line">data = data.iloc[:, <span class="number">1</span>:<span class="number">-2</span>]</span><br><span class="line">data_v = data.values</span><br><span class="line">print(<span class="string">"data:\n"</span>, data_v.shape)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 实例化一个转换器类</span></span><br><span class="line">transfer = VarianceThreshold(threshold=<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用 fit_transform</span></span><br><span class="line">data_new = transfer.fit_transform(data)</span><br><span class="line">print(<span class="string">"data_new:\n"</span>,data_new.shape)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算某两个变量之间的相关系数</span></span><br><span class="line">r1 = pearsonr(data[<span class="string">"pe_ratio"</span>], data[<span class="string">"pb_ratio"</span>])</span><br><span class="line">print(<span class="string">"pe_ratio 与 pb_ratio 之间的相关性：\n"</span>, r1)</span><br><span class="line">r2 = pearsonr(data[<span class="string">'revenue'</span>], data[<span class="string">'total_expense'</span>])</span><br><span class="line">print(<span class="string">"revenue 与 total_expense 之间的相关性：\n"</span>, r2)</span><br><span class="line"></span><br><span class="line"><span class="string">"""打印结果</span></span><br><span class="line"><span class="string">data:</span></span><br><span class="line"><span class="string"> (2318, 9)</span></span><br><span class="line"><span class="string">data_new:</span></span><br><span class="line"><span class="string"> (2318, 7)</span></span><br><span class="line"><span class="string">pe_ratio 与 pb_ratio 之间的相关性：</span></span><br><span class="line"><span class="string"> (-0.0043893227799362685, 0.8327205496564927)</span></span><br><span class="line"><span class="string">revenue 与 total_expense 之间的相关性：</span></span><br><span class="line"><span class="string"> (0.9958450413136116, 0.0)</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>pearsonr：皮尔逊相关系数，取值范围：–1≤ r ≤+1。</p>
</blockquote>
<p>若特征与特征之间相关性很高：</p>
<blockquote>
<p>选取其中一个；<br>加权求和；<br>主成分分析；</p>
</blockquote>
<h5 id="主成分分析"><a href="#主成分分析" class="headerlink" title="主成分分析"></a>主成分分析</h5><blockquote>
<p>PCA，Principal components analysis。</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transfer = PCA(n_components=<span class="number">0.95</span>) <span class="comment"># 进行 PCA 降维，并保存 95% 的信息。</span></span><br></pre></td></tr></table></figure>

<h3 id="案例分析：购物车"><a href="#案例分析：购物车" class="headerlink" title="案例分析：购物车"></a>案例分析：购物车</h3><blockquote>
<p>预测某个 user_id 下次会购买 aisle。</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取数据</span></span><br><span class="line"><span class="comment"># 订单与商品信息</span></span><br><span class="line">order_products = pd.read_csv(<span class="string">"./instacart/order_products__prior.csv"</span>)</span><br><span class="line"><span class="comment"># 商品详细信息</span></span><br><span class="line">products = pd.read_csv(<span class="string">"./instacart/products.csv"</span>)</span><br><span class="line"><span class="comment"># 订单详细信息</span></span><br><span class="line">orders = pd.read_csv(<span class="string">"./instacart/orders.csv"</span>)</span><br><span class="line"><span class="comment"># 商品所属类别信息</span></span><br><span class="line">aisles = pd.read_csv(<span class="string">"./instacart/aisles.csv"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印特征值找规律，将所有的特征值合并到一张表中然后进行 PCA 降维</span></span><br><span class="line">print(order_products.columns.values.tolist(),<span class="string">"\n"</span>, products.columns.values.tolist(),</span><br><span class="line">      <span class="string">"\n"</span>, orders.columns.values.tolist(),<span class="string">"\n"</span>, aisles.columns.values.tolist())</span><br><span class="line"></span><br><span class="line"><span class="string">"""打印结果</span></span><br><span class="line"><span class="string">['order_id', 'product_id', 'add_to_cart_order', 'reordered'] </span></span><br><span class="line"><span class="string">['product_id', 'product_name', 'aisle_id', 'department_id'] </span></span><br><span class="line"><span class="string">['order_id', 'user_id', 'eval_set', 'order_number', 'order_dow', 'order_hour_of_day', 'days_since_prior_order'] </span></span><br><span class="line"><span class="string">['aisle_id', 'aisle']</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line">tab1 = pd.merge(aisles, products, on=[<span class="string">"aisle_id"</span>, <span class="string">"aisle_id"</span>])</span><br><span class="line">tab2 = pd.merge(tab1, order_products, on=[<span class="string">"product_id"</span>, <span class="string">"product_id"</span>])</span><br><span class="line">tab3 = pd.merge(tab2, orders, on=[<span class="string">"order_id"</span>, <span class="string">"order_id"</span>])</span><br><span class="line">tab3.columns.values.tolist()</span><br><span class="line"></span><br><span class="line"><span class="string">"""打印结果</span></span><br><span class="line"><span class="string">['aisle_id', 'aisle', 'product_id', 'product_name', 'department_id', </span></span><br><span class="line"><span class="string">'order_id', 'add_to_cart_order', 'reordered', 'user_id', 'eval_set', </span></span><br><span class="line"><span class="string">'order_number', 'order_dow', 'order_hour_of_day', 'days_since_prior_order']</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="comment"># 虽然所有的数据特征都在一个表中，但表的形式不是需要的 user_id 与 aisle 的关系</span></span><br><span class="line"><span class="comment"># 利用交叉表反映的 user_id 和 aisle 之间的关系</span></span><br><span class="line">table = pd.crosstab(tab3[<span class="string">"user_id"</span>], tab3[<span class="string">"aisle"</span>])</span><br></pre></td></tr></table></figure>

<p><img src="http://welab-wingo.gitee.io/image/2020/04/SKlearn/Table.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 有大量的特征值，对数据进行降维处理</span></span><br><span class="line"><span class="keyword">from</span> sklearn.decomposition <span class="keyword">import</span> PCA</span><br><span class="line">data = table[:<span class="number">10000</span>]</span><br><span class="line">data.shape</span><br><span class="line"><span class="comment"># (10000, 134)</span></span><br><span class="line"><span class="keyword">from</span> sklearn.decomposition <span class="keyword">import</span> PCA</span><br><span class="line"><span class="comment"># 实例化一个转换器类</span></span><br><span class="line">transfer = PCA(n_components=<span class="number">0.95</span>)</span><br><span class="line"><span class="comment"># 调用 fit_transform</span></span><br><span class="line">data_new = transfer.fit_transform(data)</span><br><span class="line">data_new.shape</span><br><span class="line"><span class="comment"># (10000, 42)</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>在上述案例中，通过 PCA 降维，将 134 个特征值降到了 42 个，并且还保留了原本数据 95% 的信息，可见 PCA 降维还是挺好用的。</p>
</blockquote>
<h3 id="分类算法"><a href="#分类算法" class="headerlink" title="分类算法"></a>分类算法</h3><p>sklearn 的转换器和估计器。</p>
<p>转换器（transformer），特征工程的父类；</p>
<blockquote>
<p>fit_transform() 其实是两个过程：fit() 计算每一列的平均值、标准差；transform() 实现最终的转换。</p>
</blockquote>
<p>估计器（estimator），机器学习算法的实现。</p>
<blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">estimator.fit(x_train, y_train) <span class="comment"># 计算生成模型</span></span><br><span class="line">y_predict = estimator.predict(x_test) <span class="comment"># 对测试数据进行测试</span></span><br><span class="line">y_test == y_predict <span class="comment"># 测试结果与原有结果进行对比</span></span><br><span class="line">accuracy = estimator.score(x_test, y_test) <span class="comment"># 计算准确率</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="K-近邻算法"><a href="#K-近邻算法" class="headerlink" title="K - 近邻算法"></a>K - 近邻算法</h4><blockquote>
<p>即，根据邻近的类型来推测出自身类型。邻近指的是距离： 欧氏距离；曼哈顿距离（绝对值距离），明可夫斯基距离。</p>
</blockquote>
<h5 id="鸢尾花分类案例"><a href="#鸢尾花分类案例" class="headerlink" title="鸢尾花分类案例"></a>鸢尾花分类案例</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.datasets <span class="keyword">import</span> load_iris</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> StandardScaler</span><br><span class="line"><span class="keyword">from</span> sklearn.neighbors <span class="keyword">import</span> KNeighborsClassifier</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取数据</span></span><br><span class="line">iris = load_iris()</span><br><span class="line"><span class="comment"># 划分数据集</span></span><br><span class="line">x_train, x_test, y_train, y_test = train_test_split(iris.data, iris.target, random_state=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 特征工程</span></span><br><span class="line">transfer = StandardScaler()</span><br><span class="line"><span class="comment"># 训练集和测试集都要做一样的处理</span></span><br><span class="line">x_train = transfer.fit_transform(x_train)</span><br><span class="line"><span class="comment"># 测试基使用测试机的 fit() 进行计算</span></span><br><span class="line">x_test = transfer.transform(x_test)</span><br><span class="line"></span><br><span class="line"><span class="comment"># KNN 算法预估器，自定义距离（不断尝试出一个准确率较高的距离）</span></span><br><span class="line">estimator = KNeighborsClassifier(n_neighbors=<span class="number">3</span>)</span><br><span class="line">estimator.fit(x_train, y_train)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 模型评估</span></span><br><span class="line">y_predict = estimator.predict(x_test)</span><br><span class="line">print(<span class="string">"y_predict:\n"</span>, y_predict)</span><br><span class="line">print(<span class="string">"直接比对真实值和预测值:\n"</span>, y_test == y_predict)</span><br><span class="line"><span class="string">"""结果打印</span></span><br><span class="line"><span class="string">y_predict:</span></span><br><span class="line"><span class="string"> [2 1 0 2 0 2 0 1 1 1 2 1 1 1 1 0 1 1 0 0 2 1 0 0 2 0 0 1 1 0 2 1 0 2 2 1 0</span></span><br><span class="line"><span class="string"> 2]</span></span><br><span class="line"><span class="string">直接比对真实值和预测值:</span></span><br><span class="line"><span class="string"> [ True  True  True  True  True  True  True  True  True  True  True  True</span></span><br><span class="line"><span class="string">  True  True  True  True  True  True  True  True  True  True  True  True</span></span><br><span class="line"><span class="string">  True  True  True  True  True  True  True  True  True  True  True  True</span></span><br><span class="line"><span class="string">  True False]</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算准确率</span></span><br><span class="line">score = estimator.score(x_test, y_test)</span><br><span class="line">print(<span class="string">"准确率为：\n"</span>, score)</span><br><span class="line"><span class="string">"""结果打印</span></span><br><span class="line"><span class="string">准确率为：</span></span><br><span class="line"><span class="string"> 0.9736842105263158</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>优点：简单，易于理解，易于实现，无需训练;<br>缺点：必须指定 K 值，K 值选择不当则分类精度不能保证；懒惰算法，对测试样本分类时的计算量大，内存开销大；<br>使用场景：小数据场景，几千～几万样本，具体场景具体业务去测试。</p>
</blockquote>
<h4 id="模型选择与调优"><a href="#模型选择与调优" class="headerlink" title="模型选择与调优"></a>模型选择与调优</h4><blockquote>
<p>有时候得到的模型的准确率不尽人意，这时就需要使用某些算法对模型进行选择和调优了。</p>
</blockquote>
<h5 id="交叉验证"><a href="#交叉验证" class="headerlink" title="交叉验证"></a>交叉验证</h5><blockquote>
<p>验证集的数量不够，那么最好还是用交叉验证吧。至于分成几份比较好，一般都是分成 3、5 和 10 份。</p>
</blockquote>
<p><img src="http://welab-wingo.gitee.io/image/2020/04/SKlearn/CrossValidate.png" alt=""></p>
<h5 id="网格搜索"><a href="#网格搜索" class="headerlink" title="网格搜索"></a>网格搜索</h5><blockquote>
<p>又称为超参数搜索。对 KNN 的 K 值进行参数调优，把一组 K 值传入网格搜索中，找出最优值。</p>
</blockquote>
<h5 id="鸢尾花-K-值调优"><a href="#鸢尾花-K-值调优" class="headerlink" title="鸢尾花 K 值调优"></a>鸢尾花 K 值调优</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">estimator = KNeighborsClassifier()</span><br><span class="line"><span class="comment"># 加入网格搜索与交叉验证</span></span><br><span class="line"><span class="comment"># 参数准备</span></span><br><span class="line">param_dict = &#123;<span class="string">"n_neighbors"</span>: [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">11</span>]&#125;</span><br><span class="line"><span class="comment"># cv=10，进行10折交叉验证</span></span><br><span class="line">estimator = GridSearchCV(estimator, param_grid=param_dict, cv=<span class="number">10</span>)</span><br><span class="line">estimator.fit(x_train, y_train)</span><br><span class="line"></span><br><span class="line">y_predict = estimator.predict(x_test)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"y_predict:\n"</span>, y_predict)</span><br><span class="line">print(<span class="string">"直接比对真实值和预测值:\n"</span>, y_test == y_predict)</span><br><span class="line">score = estimator.score(x_test, y_test)</span><br><span class="line">print(<span class="string">"准确率为：\n"</span>, score)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 最佳参数：best_params_</span></span><br><span class="line">print(<span class="string">"最佳参数：\n"</span>, estimator.best_params_)</span><br><span class="line"><span class="comment"># 最佳结果：best_score_</span></span><br><span class="line">print(<span class="string">"最佳结果：\n"</span>, estimator.best_score_)</span><br><span class="line"><span class="comment"># 最佳估计器：best_estimator_</span></span><br><span class="line">print(<span class="string">"最佳估计器:\n"</span>, estimator.best_estimator_)</span><br><span class="line"><span class="comment"># 交叉验证结果：cv_results_</span></span><br><span class="line">print(<span class="string">"交叉验证结果:\n"</span>, estimator.cv_results_)</span><br></pre></td></tr></table></figure>

<h4 id="朴素贝叶斯"><a href="#朴素贝叶斯" class="headerlink" title="朴素贝叶斯"></a>朴素贝叶斯</h4><blockquote>
<p>Naive Bayesian。朴素？即，假设特征与特征之间是相互独立。</p>
<p>应用场景：文本分类，单词作为特征。</p>
</blockquote>
<h4 id="决策树"><a href="#决策树" class="headerlink" title="决策树"></a>决策树</h4><p>哪个特征值的信息增益大，那就应该先用这个特征值做过滤。</p>
<p>缺点：容易产生过拟合，即一个 overfitted 模型记住太多 training data 的细节从而降低了 generalization 的能力。</p>
<blockquote>
<p>欠拟合：光看书不做题觉得自己会了，上了考场啥都不会；<br>过拟合: 做课后题全都能做对，上了考场还是啥都不会。</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.datasets <span class="keyword">import</span> load_iris</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"><span class="keyword">from</span> sklearn.tree <span class="keyword">import</span> DecisionTreeClassifier, export_graphviz</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取数据集</span></span><br><span class="line">iris = load_iris()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 划分数据集</span></span><br><span class="line">x_train, x_test, y_train, y_test = train_test_split(iris.data, iris.target, random_state=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 决策树预估器</span></span><br><span class="line">estimator = DecisionTreeClassifier(criterion=<span class="string">"entropy"</span>)</span><br><span class="line">estimator.fit(x_train, y_train)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 模型评估</span></span><br><span class="line"><span class="comment"># 直接比对真实值和预测值</span></span><br><span class="line">y_predict = estimator.predict(x_test)</span><br><span class="line">print(<span class="string">"y_predict:\n"</span>, y_predict)</span><br><span class="line">print(<span class="string">"直接比对真实值和预测值:\n"</span>, y_test == y_predict)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算准确率</span></span><br><span class="line">score = estimator.score(x_test, y_test)</span><br><span class="line">print(<span class="string">"准确率为：\n"</span>, score)</span><br><span class="line"></span><br><span class="line"><span class="string">"""结果打印</span></span><br><span class="line"><span class="string">y_predict:</span></span><br><span class="line"><span class="string"> [0 2 1 2 1 1 1 1 1 0 2 1 2 2 0 2 1 1 1 1 0 2 0 1 2 0 2 2 2 1 0 0 1 1 1 0 0</span></span><br><span class="line"><span class="string"> 0]</span></span><br><span class="line"><span class="string">直接比对真实值和预测值:</span></span><br><span class="line"><span class="string"> [ True  True  True  True  True  True  True False  True  True  True  True</span></span><br><span class="line"><span class="string">  True  True  True  True  True  True False  True  True  True  True  True</span></span><br><span class="line"><span class="string">  True  True  True  True  True False  True  True  True  True  True  True</span></span><br><span class="line"><span class="string">  True  True]</span></span><br><span class="line"><span class="string">准确率为：</span></span><br><span class="line"><span class="string"> 0.9210526315789473</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 可视化决策树</span></span><br><span class="line">export_graphviz(estimator, out_file=<span class="string">"iris_tree.dot"</span>, feature_names=iris.feature_names)</span><br></pre></td></tr></table></figure>

<p><a href="https://dreampuf.github.io/GraphvizOnline/" target="_blank" rel="noopener">在线可视化</a></p>
<img src="http://welab-wingo.gitee.io/image/2020/04/SKlearn/DecisionTree.png" style="zoom:50%;" />

<h4 id="随机森林"><a href="#随机森林" class="headerlink" title="随机森林"></a>随机森林</h4><blockquote>
<p>森林：包含多个决策树的分类器。</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 数据同决策树</span></span><br><span class="line"><span class="keyword">from</span> sklearn.ensemble <span class="keyword">import</span> RandomForestClassifier</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用随机森林</span></span><br><span class="line">estimator = RandomForestClassifier()</span><br><span class="line">estimator.fit(x_train, y_train)</span><br><span class="line">y_predict = estimator.predict(x_test)</span><br><span class="line">print(estimator.score(x_test, y_test))</span><br></pre></td></tr></table></figure>

<h3 id="案例分析：签到预测"><a href="#案例分析：签到预测" class="headerlink" title="案例分析：签到预测"></a>案例分析：签到预测</h3><blockquote>
<p>根据给定的数据，预测人们最可能在地图上的哪个位置进行签到。</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取数据</span></span><br><span class="line">data = pd.read_csv(<span class="string">"./FBlocation/train.csv"</span>)</span><br><span class="line">data.head()</span><br></pre></td></tr></table></figure>

<p><img src="http://welab-wingo.gitee.io/image/2020/04/SKlearn/Facebook.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 缩小范围，方便实验</span></span><br><span class="line">data = data.query(<span class="string">"x &lt; 2.5 &amp; x &gt; 2 &amp; y &lt; 1.5 &amp; y &gt; 1.0"</span>)</span><br><span class="line"><span class="comment"># 对数据进行处理，这个时间看的很难受</span></span><br><span class="line"><span class="comment"># 时间处理成便于观察的形式</span></span><br><span class="line">time_value = pd.to_datetime(data[<span class="string">"time"</span>], unit=<span class="string">"s"</span>)</span><br><span class="line">time_value.head()</span><br><span class="line"><span class="comment"># 年月的差别不大，可不考虑</span></span><br><span class="line"><span class="string">"""结果打印</span></span><br><span class="line"><span class="string">112    1970-01-08 05:06:14</span></span><br><span class="line"><span class="string">180    1970-01-08 01:29:55</span></span><br><span class="line"><span class="string">367    1970-01-07 17:01:07</span></span><br><span class="line"><span class="string">874    1970-01-02 15:52:46</span></span><br><span class="line"><span class="string">1022   1970-01-03 09:46:33</span></span><br><span class="line"><span class="string">Name: time, dtype: datetime64[ns]</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="comment"># 得到时间列</span></span><br><span class="line">date = pd.DatetimeIndex(time_value)</span><br><span class="line"><span class="comment"># 给数据增加日期，星期，时间这些特征值</span></span><br><span class="line">data[<span class="string">"day"</span>] = date.day</span><br><span class="line">data[<span class="string">"weekday"</span>] = date.weekday</span><br><span class="line">data[<span class="string">"hour"</span>] = date.hour</span><br></pre></td></tr></table></figure>

<p><img src="http://welab-wingo.gitee.io/image/2020/04/SKlearn/Facebook01.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 根据 place_id 成组，过滤签到次数比较少的地点</span></span><br><span class="line">place_count = data.groupby(<span class="string">"place_id"</span>).count()[<span class="string">"row_id"</span>]</span><br></pre></td></tr></table></figure>

<p><img src="http://welab-wingo.gitee.io/image/2020/04/SKlearn/Facebook02.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 过滤</span></span><br><span class="line">place_count[place_count &gt; <span class="number">3</span>].head()</span><br><span class="line"><span class="comment"># 根据得到的 place_id 对数据进行过滤</span></span><br><span class="line">data_final = data[data[<span class="string">"place_id"</span>].isin(place_count[place_count &gt; <span class="number">3</span>].index.values)]</span><br><span class="line"><span class="comment"># 筛选特征值和目标值</span></span><br><span class="line">x = data_final[[<span class="string">"x"</span>, <span class="string">"y"</span>, <span class="string">"accuracy"</span>, <span class="string">"day"</span>, <span class="string">"weekday"</span>, <span class="string">"hour"</span>]]</span><br><span class="line">y = data_final[<span class="string">"place_id"</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> StandardScaler</span><br><span class="line"><span class="keyword">from</span> sklearn.neighbors <span class="keyword">import</span> KNeighborsClassifier</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> GridSearchCV</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据集划分</span></span><br><span class="line">x_train, x_test, y_train, y_test = train_test_split(x, y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 特征工程：标准化</span></span><br><span class="line">transfer = StandardScaler()</span><br><span class="line">x_train = transfer.fit_transform(x_train)</span><br><span class="line">x_test = transfer.transform(x_test)</span><br><span class="line"></span><br><span class="line"><span class="comment"># KNN 算法预估器</span></span><br><span class="line">estimator = KNeighborsClassifier()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加入网格搜索与交叉验证</span></span><br><span class="line"><span class="comment"># 参数准备</span></span><br><span class="line">param_dict = &#123;<span class="string">"n_neighbors"</span>: [<span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>]&#125;</span><br><span class="line">estimator = GridSearchCV(estimator, param_grid=param_dict, cv=<span class="number">3</span>)</span><br><span class="line">estimator.fit(x_train, y_train)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 模型评估</span></span><br><span class="line"><span class="comment"># 直接比对真实值和预测值</span></span><br><span class="line">y_predict = estimator.predict(x_test)</span><br><span class="line">print(<span class="string">"y_predict:\n"</span>, y_predict)</span><br><span class="line">print(<span class="string">"直接比对真实值和预测值:\n"</span>, y_test == y_predict)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算准确率</span></span><br><span class="line">score = estimator.score(x_test, y_test)</span><br><span class="line">print(<span class="string">"准确率为：\n"</span>, score)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 最佳参数：best_params_</span></span><br><span class="line">print(<span class="string">"最佳参数：\n"</span>, estimator.best_params_)</span><br><span class="line"><span class="comment"># 最佳结果：best_score_</span></span><br><span class="line">print(<span class="string">"最佳结果：\n"</span>, estimator.best_score_)</span><br><span class="line"><span class="comment"># 最佳估计器：best_estimator_</span></span><br><span class="line">print(<span class="string">"最佳估计器:\n"</span>, estimator.best_estimator_)</span><br><span class="line"><span class="comment"># 交叉验证结果：cv_results_</span></span><br><span class="line">print(<span class="string">"交叉验证结果:\n"</span>, estimator.cv_results_)</span><br></pre></td></tr></table></figure>

<h3 id="案例分析：生存预测"><a href="#案例分析：生存预测" class="headerlink" title="案例分析：生存预测"></a>案例分析：生存预测</h3><blockquote>
<p>根据人的信息预测此人在此灾难中存活下来的概率。</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">titanic = pd.read_csv(<span class="string">"titanic.csv"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 筛选特征值和目标值</span></span><br><span class="line">x = titanic[[<span class="string">"pclass"</span>, <span class="string">"age"</span>, <span class="string">"sex"</span>]]</span><br><span class="line">y = titanic[<span class="string">"survived"</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 缺失值处理</span></span><br><span class="line">x[<span class="string">"age"</span>].fillna(x[<span class="string">"age"</span>].mean(), inplace=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 转换成字典，方便处理</span></span><br><span class="line">x = x.to_dict(orient=<span class="string">"records"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"><span class="comment"># 数据集划分</span></span><br><span class="line">x_train, x_test, y_train, y_test = train_test_split(x, y, random_state=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 字典特征抽取</span></span><br><span class="line"><span class="keyword">from</span> sklearn.feature_extraction <span class="keyword">import</span> DictVectorizer</span><br><span class="line"><span class="keyword">from</span> sklearn.tree <span class="keyword">import</span> DecisionTreeClassifier</span><br><span class="line"></span><br><span class="line">transfer = DictVectorizer()</span><br><span class="line">x_train = transfer.fit_transform(x_train)</span><br><span class="line">x_test = transfer.transform(x_test)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 预估器</span></span><br><span class="line">estimator = DecisionTreeClassifier(criterion=<span class="string">"entropy"</span>, max_depth=<span class="number">3</span>)</span><br><span class="line">estimator.fit(x_train, y_train)</span><br><span class="line"></span><br><span class="line">y_predict = estimator.predict(x_test)</span><br><span class="line">print(<span class="string">"y_predict:\n"</span>, y_predict)</span><br><span class="line">print(<span class="string">"直接比对真实值和预测值:\n"</span>, y_test == y_predict)</span><br><span class="line"></span><br><span class="line">score = estimator.score(x_test, y_test)</span><br><span class="line">print(<span class="string">"准确率为：\n"</span>, score)</span><br></pre></td></tr></table></figure>

<h3 id="回归算法"><a href="#回归算法" class="headerlink" title="回归算法"></a>回归算法</h3><h4 id="线性回归"><a href="#线性回归" class="headerlink" title="线性回归"></a>线性回归</h4><blockquote>
<p>目标值为连续性的数据。</p>
</blockquote>
<h5 id="正规方程"><a href="#正规方程" class="headerlink" title="正规方程"></a>正规方程</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.datasets <span class="keyword">import</span> load_boston</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> StandardScaler</span><br><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> LinearRegression</span><br><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> mean_squared_error</span><br><span class="line"></span><br><span class="line"><span class="comment"># 正规方程的优化方法对波士顿房价进行预测</span></span><br><span class="line"><span class="comment"># 获取数据</span></span><br><span class="line">boston = load_boston()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 划分数据集</span></span><br><span class="line">x_train, x_test, y_train, y_test = train_test_split(boston.data, boston.target, random_state=<span class="number">22</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 标准化</span></span><br><span class="line">transfer = StandardScaler()</span><br><span class="line">x_train = transfer.fit_transform(x_train)</span><br><span class="line">x_test = transfer.transform(x_test)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 预估器</span></span><br><span class="line">estimator = LinearRegression()</span><br><span class="line">estimator.fit(x_train, y_train)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 得出模型</span></span><br><span class="line">print(<span class="string">"正规方程-权重系数为：\n"</span>, estimator.coef_)</span><br><span class="line">print(<span class="string">"正规方程-偏置为：\n"</span>, estimator.intercept_)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 模型评估</span></span><br><span class="line">y_predict = estimator.predict(x_test)</span><br><span class="line">print(<span class="string">"预测房价：\n"</span>, y_predict)</span><br><span class="line">error = mean_squared_error(y_test, y_predict)</span><br><span class="line">print(<span class="string">"正规方程-均方误差为：\n"</span>, error)</span><br></pre></td></tr></table></figure>

<h5 id="梯度下降"><a href="#梯度下降" class="headerlink" title="梯度下降"></a>梯度下降</h5><blockquote>
<p>一个不断逼近的，勤奋努力的算法。</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.datasets <span class="keyword">import</span> load_boston</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> StandardScaler</span><br><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> SGDRegressor</span><br><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> mean_squared_error</span><br><span class="line"></span><br><span class="line"><span class="comment"># 梯度下降的优化方法对波士顿房价进行预测</span></span><br><span class="line"><span class="comment"># 获取数据</span></span><br><span class="line">boston = load_boston()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 划分数据集</span></span><br><span class="line">x_train, x_test, y_train, y_test = train_test_split(boston.data, boston.target, random_state=<span class="number">22</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 标准化</span></span><br><span class="line">transfer = StandardScaler()</span><br><span class="line">x_train = transfer.fit_transform(x_train)</span><br><span class="line">x_test = transfer.transform(x_test)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 预估器</span></span><br><span class="line">estimator = SGDRegressor(learning_rate=<span class="string">"constant"</span>, eta0=<span class="number">0.01</span>, max_iter=<span class="number">10000</span>, penalty=<span class="string">"l1"</span>)</span><br><span class="line">estimator.fit(x_train, y_train)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 得出模型</span></span><br><span class="line">print(<span class="string">"梯度下降-权重系数为：\n"</span>, estimator.coef_)</span><br><span class="line">print(<span class="string">"梯度下降-偏置为：\n"</span>, estimator.intercept_)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 模型评估</span></span><br><span class="line">y_predict = estimator.predict(x_test)</span><br><span class="line">print(<span class="string">"预测房价：\n"</span>, y_predict)</span><br><span class="line">error = mean_squared_error(y_test, y_predict)</span><br><span class="line">print(<span class="string">"梯度下降-均方误差为：\n"</span>, error)</span><br></pre></td></tr></table></figure>

<h5 id="岭回归"><a href="#岭回归" class="headerlink" title="岭回归"></a>岭回归</h5><blockquote>
<p>带有 L2 正则化的线性回归：岭回归</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.datasets <span class="keyword">import</span> load_boston</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> StandardScaler</span><br><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> Ridge</span><br><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> mean_squared_error</span><br><span class="line"></span><br><span class="line"><span class="comment"># 梯度下降的优化方法对波士顿房价进行预测</span></span><br><span class="line"><span class="comment"># 获取数据</span></span><br><span class="line">boston = load_boston()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 划分数据集</span></span><br><span class="line">x_train, x_test, y_train, y_test = train_test_split(boston.data, boston.target, random_state=<span class="number">22</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 标准化</span></span><br><span class="line">transfer = StandardScaler()</span><br><span class="line">x_train = transfer.fit_transform(x_train)</span><br><span class="line">x_test = transfer.transform(x_test)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 预估器</span></span><br><span class="line">estimator = Ridge(alpha=<span class="number">0.5</span>, max_iter=<span class="number">10000</span>)</span><br><span class="line">estimator.fit(x_train, y_train)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 得出模型</span></span><br><span class="line">print(<span class="string">"岭回归-权重系数为：\n"</span>, estimator.coef_)</span><br><span class="line">print(<span class="string">"岭回归-偏置为：\n"</span>, estimator.intercept_)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 模型评估</span></span><br><span class="line">y_predict = estimator.predict(x_test)</span><br><span class="line">print(<span class="string">"预测房价：\n"</span>, y_predict)</span><br><span class="line">error = mean_squared_error(y_test, y_predict)</span><br><span class="line">print(<span class="string">"岭回归-均方误差为：\n"</span>, error)</span><br></pre></td></tr></table></figure>

<h4 id="逻辑回归"><a href="#逻辑回归" class="headerlink" title="逻辑回归"></a>逻辑回归</h4><blockquote>
<p>逻辑回归（Logistic Regression）是一种用于解决二分类（0 or 1）问题的机器学习方法，用于估计某种事物的可能性。</p>
</blockquote>
<h5 id="精确率"><a href="#精确率" class="headerlink" title="精确率"></a>精确率</h5><blockquote>
<p>Precision 即，查的准不准。</p>
</blockquote>
<h5 id="召回率"><a href="#召回率" class="headerlink" title="召回率"></a>召回率</h5><blockquote>
<p>Recall 即，查的全不全。</p>
</blockquote>
<h5 id="F1-score"><a href="#F1-score" class="headerlink" title="F1-score"></a>F1-score</h5><blockquote>
<p>模型的稳健性。</p>
</blockquote>
<h3 id="案例分析：肿瘤预测"><a href="#案例分析：肿瘤预测" class="headerlink" title="案例分析：肿瘤预测"></a>案例分析：肿瘤预测</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取数据</span></span><br><span class="line">path = <span class="string">"https://archive.ics.uci.edu/ml/machine-learning-databases/breast-cancer-wisconsin/breast-cancer-wisconsin.data"</span></span><br><span class="line">column_name = [<span class="string">'Sample code number'</span>, <span class="string">'Clump Thickness'</span>, <span class="string">'Uniformity of Cell Size'</span>, <span class="string">'Uniformity of Cell Shape'</span>,</span><br><span class="line">                   <span class="string">'Marginal Adhesion'</span>, <span class="string">'Single Epithelial Cell Size'</span>, <span class="string">'Bare Nuclei'</span>, <span class="string">'Bland Chromatin'</span>,</span><br><span class="line">                   <span class="string">'Normal Nucleoli'</span>, <span class="string">'Mitoses'</span>, <span class="string">'Class'</span>]</span><br><span class="line"></span><br><span class="line">data = pd.read_csv(path, names=column_name)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 缺失值处理</span></span><br><span class="line"><span class="comment"># 替换 》 np.nan</span></span><br><span class="line">data = data.replace(to_replace=<span class="string">"?"</span>, value=np.nan)</span><br><span class="line"><span class="comment"># 删除缺失样本</span></span><br><span class="line">data.dropna(inplace=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># 检查是否还存在缺失值</span></span><br><span class="line">data.isnull().any()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 划分数据集</span></span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"><span class="comment"># 筛选特征值和目标值</span></span><br><span class="line">x = data.iloc[:, <span class="number">1</span>:<span class="number">-1</span>]</span><br><span class="line">y = data[<span class="string">"Class"</span>]</span><br><span class="line">x_train, x_test, y_train, y_test = train_test_split(x, y, random_state=<span class="number">0</span>)</span><br><span class="line"><span class="comment"># 标准化</span></span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> StandardScaler</span><br><span class="line">transfer = StandardScaler()</span><br><span class="line">x_train = transfer.fit_transform(x_train)</span><br><span class="line">x_test = transfer.transform(x_test)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 逻辑回归预测</span></span><br><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> LogisticRegression</span><br><span class="line"></span><br><span class="line">estimator = LogisticRegression()</span><br><span class="line">estimator.fit(x_train, y_train)</span><br><span class="line"><span class="comment"># 逻辑回归的模型参数：回归系数和偏置</span></span><br><span class="line">print(<span class="string">"逻辑回归-回归系数："</span>, estimator.coef_, <span class="string">"逻辑回归-偏置："</span> , estimator.intercept_)</span><br><span class="line"></span><br><span class="line">y_predict = estimator.predict(x_test)</span><br><span class="line">print(<span class="string">"y_predict:\n"</span>, y_predict)</span><br><span class="line">print(<span class="string">"直接比对真实值和预测值:\n"</span>, y_test == y_predict)</span><br><span class="line"></span><br><span class="line">score = estimator.score(x_test, y_test)</span><br><span class="line">print(<span class="string">"准确率为：\n"</span>, score)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看精确率、召回率、F1-score</span></span><br><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> classification_report</span><br><span class="line">report = classification_report(y_test, y_predict, target_names=[<span class="string">"良性"</span>, <span class="string">"恶性"</span>])</span><br><span class="line"><span class="comment"># y_true：每个样本的真实类别，必须为 0 反，1 正标记</span></span><br><span class="line"><span class="comment"># 将 y_test 转换成 0 1</span></span><br><span class="line">y_true = np.where(y_test &gt; <span class="number">3</span>, <span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> roc_auc_score</span><br><span class="line">roc_auc_score(y_true, y_predict)</span><br></pre></td></tr></table></figure>

<h3 id="K-means"><a href="#K-means" class="headerlink" title="K-means"></a>K-means</h3><blockquote>
<p>无监督算法。</p>
</blockquote>
<h4 id="购物车案例"><a href="#购物车案例" class="headerlink" title="购物车案例"></a>购物车案例</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 预估器流程</span><br><span class="line">from sklearn.cluster import KMeans</span><br><span class="line"></span><br><span class="line">estimator &#x3D; KMeans(n_clusters&#x3D;3)</span><br><span class="line">estimator.fit(data_new)</span><br><span class="line"></span><br><span class="line">y_predict &#x3D; estimator.predict(data_new)</span><br><span class="line">y_predict[:300]</span><br><span class="line"></span><br><span class="line"># 模型评估-轮廓系数</span><br><span class="line">from sklearn.metrics import silhouette_score</span><br><span class="line">silhouette_score(data_new, y_predict)</span><br></pre></td></tr></table></figure>


        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2020-04-30T03:49:06.999Z" itemprop="dateUpdated">2020-04-30 11:49:06</time>
</span><br>


        
    </div>
    
    <footer>
        <a href="http://yoursite.com">
            <img src="/img/avatar.jpg" alt="Wingo">
            Wingo
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Machine-Learning/" rel="tag">Machine Learning</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/sklearn/" rel="tag">sklearn</a></li></ul>


            


        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2020/04/25/BigData/Hadoop%20%E5%85%A5%E9%97%A8/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">Hadoop 入门</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2020/04/20/Software/RabbitMQ%20%E5%88%9D%E6%AD%A5%E4%BD%BF%E7%94%A8/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">RabbitMQ 初步使用</h4>
      </a>
    </div>
  
</nav>



    




















</article>



</div>

        <footer class="footer">
    <div class="top">
        

        <p>
            
            <span>得失从缘，心无增减</span>
        </p>
    </div> 
    <div class="bottom">
        <p><span>Wingo &copy; 2020</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>


    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: false, REWARD: false };


</script>

<script src="/js/main.min.js?v=1.7.2"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.min.js?v=1.7.2" async></script>










</body>
</html>
